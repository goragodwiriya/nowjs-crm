var __defProp=Object.defineProperty,__defNormalProp=(t,e,i)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,__publicField=(t,e,i)=>__defNormalProp(t,"symbol"!=typeof e?e+"":e,i);!function(){"use strict";var t;window.GraphRenderer=class GraphRenderer{constructor(t,e={}){if(__publicField(this,"themes",{light:{backgroundColor:"#ffffff",textColor:"#333333",gridColor:"#e0e0e0",axisColor:"#666666"},dark:{backgroundColor:"#2d2d2d",textColor:"#ffffff",gridColor:"#404040",axisColor:"#808080"}}),!t)throw new Error("Container element is required");this.container=t,this.width=t.clientWidth,this.height=t.clientHeight;const i=window.getComputedStyle(this.container),n=parseInt(i.fontSize,10),a=i.fontFamily||"Arial, sans-serif",s=i.color||"#000000";let o=i.backgroundColor;o&&"transparent"!==o&&"rgba(0, 0, 0, 0)"!==o||(o="#ffffff"),this.defaultConfig={colors:["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F9ED69","#F08A5D","#B83B5E","#6A2C70","#00B8A9","#F8F3D4","#3F72AF"],backgroundColor:o,showGrid:!0,gridColor:"#E0E0E0",axisColor:"#333333",curve:!0,maxGaugeValue:100,centerText:null,showCenterText:!0,gap:2,borderWidth:1,borderColor:"auto",pointRadius:4,lineWidth:2,fillArea:!1,fillOpacity:.1,fontFamily:a,textColor:s,fontSize:isNaN(n)?16:n,showAxisLabels:!0,showAxis:!0,animationDuration:1e3,donutThickness:30,gaugeCurveWidth:20,showLegend:!0,legendPosition:"bottom",showTooltip:!0,tooltipFormatter:null,showDataLabels:!0,showValueInsteadOfPercent:!0,animation:!1,maxDataPoints:20,type:"line",table:null,data:null,onClick:null,fontUrl:null},this.readConfigFromDataAttributes(),this.config={...this.defaultConfig,...e,...this.configFromData},this.data=[],this.minValue=0,this.maxValue=0,this.currentChartType=this.config.type,this.legend=null,this.state={initialized:!1},this.validateOptions(this.config),this.calculateFontSize(),this.setMargins(),this.visibleDataCount=this.calculateVisibleDataCount(),this.config.table?(this.createSVG(),this.initialize()):this.config.data&&(this.createSVG(),this.setData(this.config.data),this.renderGraph()),this.svg&&(this.handleResize=this.debounce(this.handleResize.bind(this),200),window.addEventListener("resize",this.handleResize)),this.state.initialized=!0}readConfigFromDataAttributes(){const t=this.container.dataset;this.configFromData={};for(const e in t)if(t.hasOwnProperty(e)){const i=this.kebabToCamel(e),n=this.parseConfigValue(t[e]);this.configFromData[i]=n}}kebabToCamel(t){return t.replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}parseConfigValue(t){if("true"===t)return!0;if("false"===t)return!1;if(!isNaN(t))return Number(t);try{return JSON.parse(t)}catch(e){return t}}validateOptions(t){if(t.colors&&!Array.isArray(t.colors))throw new TypeError('Option "colors" must be an array.');if("boolean"!=typeof t.showGrid)throw new TypeError('Option "showGrid" must be a boolean.');if("string"!=typeof t.legendPosition)throw new TypeError('Option "legendPosition" must be a string.');if("number"!=typeof t.maxGaugeValue)throw new TypeError('Option "maxGaugeValue" must be a number.')}createSVG(){if(this.width>0&&this.height>0){this.svg=this.createSVGElement("svg",{width:"100%",height:"100%",viewBox:`0 0 ${this.width} ${this.height}`,role:"img","aria-label":"Data Visualization Graph",tabindex:"0"}),this.svg.addEventListener("keydown",this.handleKeyboardNavigation.bind(this));const t=this.createSVGElement("desc");t.textContent=this.getAccessibilityDescription(),this.svg.appendChild(t),this.container.appendChild(this.svg)}}handleKeyboardNavigation(t){t.key}getAccessibilityDescription(){return this.data&&this.data.length>0?`Graph showing ${this.data.length} data series with values ranging from ${this.minValue} to ${this.maxValue}`:"Graph showing 0 data series"}createSVGElement(t,e={}){const i=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach(t=>i.setAttribute(t,e[t])),i}clear(){this.svg&&this.container.contains(this.svg)&&this.container.removeChild(this.svg),this.createSVG()}debounce(t,e){let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>t.apply(this,n),e)}}calculateFontSize(){var t,e;if(null==(t=this.config)?void 0:t.fontSize)if("gauge"===(null==(e=this.config)?void 0:e.type))this.config.labelFontSize=.5*this.config.fontSize;else{const t=Math.min(this.width,this.height);t>0&&(this.config.fontSize=Math.max(10,Math.min(this.config.fontSize,t/20)),this.config.labelFontSize=.8*this.config.fontSize)}}calculateVisibleDataCount(){return this.data&&0!==this.data.length&&this.data[0].data?0===this.config.maxDataPoints?this.data[0].data.length:Math.min(this.config.maxDataPoints,this.data[0].data.length):0}handleResize(){const t=this.container.clientWidth,e=this.container.clientHeight;0!==t&&0!==e?(this.width=t,this.height=e,this.svg&&this.width>0&&this.height>0&&(this.svg.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),this.calculateFontSize(),this.setMargins(),this.visibleDataCount=this.calculateVisibleDataCount(),this.redrawGraph())):this._waitingForSize||(this._waitingForSize=!0,setTimeout(()=>{this._waitingForSize=!1,this.handleResize()},100))}loadAndProcessTableData(t){const e=this.loadFromTable(t);return this.processTableData(e)}loadFromTable(t){const e={headers:{title:"",items:[]},rows:[]};t.querySelectorAll("thead > tr:first-child > th").forEach((t,i)=>{0===i?e.headers.title=t.textContent.trim():e.headers.items.push(t.innerHTML)});return t.querySelectorAll("tbody > tr").forEach(t=>{const i={title:"",items:[]};t.querySelectorAll("th, td").forEach((t,e)=>{if("TH"===t.tagName)i.title=t.textContent.trim();else{const e=parseFloat(t.textContent.replace(/,/g,""));i.items.push(e)}}),e.rows.push(i)}),e}processTableData(t){const e=[];return t.rows.forEach((i,n)=>{const a={name:i.title,data:[]};t.headers.items.forEach((t,e)=>{const n=i.items[e];a.data.push({label:t,value:n,tooltip:`${i.title} ${t}: ${this.formatValue(n)}`})}),e.push(a)}),e}setData(t){try{if(this.validateData(t),!Array.isArray(t))throw new Error("Data must be an array of series.");this.data=t;const e=t.flatMap(t=>t.data.map(t=>t.value));this.minValue=Math.min(...e),this.maxValue=Math.max(...e),this.calculateNiceRange(),this.visibleDataCount=this.calculateVisibleDataCount(),this.redrawGraph()}catch(e){throw console.error("Error setting data:",e),EventManager.emit("graph:error",{type:"data",error:e}),e}}validateData(t){if(!Array.isArray(t))throw new Error("Data must be an array of series");return t.forEach((t,e)=>{if(!t.name||!Array.isArray(t.data))throw new Error(`Invalid series at index ${e}`);t.data.forEach((e,i)=>{if(!e.hasOwnProperty("value")||!e.hasOwnProperty("label"))throw new Error(`Invalid data point in series "${t.name}" at index ${i}`)})}),!0}calculateNiceRange(){const t=this.maxValue-this.minValue;if(0===t)return this.minNice=this.minValue-1,void(this.maxNice=this.maxValue+1);const e=t/5,i=Math.pow(10,Math.floor(Math.log10(e))),n=Math.ceil(e/i)*i;this.minNice=Math.floor(this.minValue/n)*n,this.maxNice=Math.ceil(this.maxValue/n)*n,this.minValue>0&&(this.minValue===this.minNice&&(this.minNice=Math.max(0,this.minNice-n)),this.maxValue===this.maxNice&&(this.maxNice+=n)),this.maxValue<0&&(this.maxValue===this.maxNice&&(this.maxNice=Math.min(0,this.maxNice+n)),this.minValue===this.minNice&&(this.minNice-=n))}drawAxes(){const t=this.createSVGElement("g",{class:"axes"});let e=0;this.minNice>0?e=this.minNice:this.maxNice<0&&(e=this.maxNice);const i=this.createSVGElement("line",{x1:this.margin.left,y1:this.getPointY(e),x2:this.width-this.margin.right,y2:this.getPointY(e),stroke:this.config.axisColor,"stroke-width":"2"});t.appendChild(i);const n=this.createSVGElement("line",{x1:this.margin.left,y1:this.margin.top,x2:this.margin.left,y2:this.height-this.margin.bottom,stroke:this.config.axisColor,"stroke-width":"2"});t.appendChild(n),this.config.showAxisLabels&&this.drawYAxisLabels(t),this.svg.appendChild(t)}drawYAxisLabels(t){for(let e=0;e<=5;e++){const i=this.minNice+e/5*(this.maxNice-this.minNice),n=this.getPointY(i),a=this.createSVGElement("text",{x:this.margin.left-10,y:n,"text-anchor":"end","alignment-baseline":"middle","font-size":this.config.labelFontSize,"font-family":this.config.fontFamily,fill:this.config.textColor});a.textContent=this.formatValue(i),t.appendChild(a)}}drawVerticalGridLines(t){const e=this.createSVGElement("g",{class:"vertical-grid"});t.forEach(t=>{const i=this.createSVGElement("line",{x1:t,y1:this.margin.top,x2:t,y2:this.height-this.margin.bottom,stroke:this.config.gridColor,"stroke-dasharray":"5,5"});e.appendChild(i)}),this.svg.appendChild(e)}drawHorizontalGridLines(t){const e=this.createSVGElement("line",{x1:this.margin.left,y1:t,x2:this.width-this.margin.right,y2:t,stroke:this.config.gridColor,"stroke-width":"1","stroke-dasharray":"5,5"});this.svg.appendChild(e)}drawLabel(t,e,i,n){const a=this.createSVGElement("text",{x:t,y:e,"text-anchor":"middle","font-size":this.config.labelFontSize,"font-family":this.config.fontFamily,fill:this.config.textColor});a.textContent=i,n&&a.setAttribute("transform",`rotate(45, ${t}, ${e})`),this.svg.appendChild(a)}addAnimation(t,e){if(this.config.animation){const i=this.createSVGElement("animate");for(const[t,n]of Object.entries(e))i.setAttribute(t,n);t.appendChild(i)}}renderGraph(t=this.config.animation){const e=this.ensureSVG();if(e)try{if(this.width=this.container.clientWidth,this.height=this.container.clientHeight,this.width<50||this.height<50)return void setTimeout(()=>this.redrawGraph(),100);for(;e.firstChild;)e.removeChild(e.firstChild);const i=this.config.animation;switch(this.config.animation=t,this.clear(),this.setMargins(),this.currentChartType){case"line":this.drawLineGraph();break;case"bar":this.drawBarGraph();break;case"pie":this.drawPieChart(!1);break;case"donut":this.drawPieChart(!0);break;case"gauge":this.drawGauge();break;default:throw new Error(`Unknown chart type: ${this.currentChartType}`)}this.drawLegend(),this.config.animation=i}catch(i){console.error("Error in renderGraph():",i)}}redrawGraph(t=this.config.animation){this.renderGraph(t)}getPointX(t){if(this.visibleDataCount<=1)return this.margin.left+(this.width-this.margin.left-this.margin.right)/2;const e=this.width-this.margin.left-this.margin.right;return this.margin.left+t/(this.visibleDataCount-1)*e}getPointY(t){const e=this.height-this.margin.top-this.margin.bottom;return this.maxNice===this.minNice?this.margin.top+e/2:this.margin.top+(this.maxNice-t)/(this.maxNice-this.minNice)*e}getLinearPath(t){return t.map((t,e)=>`${0===e?"M":"L"}${this.getPointX(e)},${this.getPointY(t.value)}`).join(" ")}getCurvePath(t){if(0===t.length)return"";let e=`M${this.getPointX(0)},${this.getPointY(t[0].value)}`;for(let i=1;i<t.length;i++){const n=this.getPointX(i-1),a=this.getPointY(t[i-1].value),s=this.getPointX(i),o=this.getPointY(t[i].value);e+=` C${n+(s-n)/3},${a} ${s-(s-n)/3},${o} ${s},${o}`}return e}describeArc(t,e,i,n,a){const s=this.polarToCartesian(t,e,i,a),o=this.polarToCartesian(t,e,i,n),r=a-n<=Math.PI?"0":"1";return["M",s.x,s.y,"A",i,i,0,r,0,o.x,o.y].join(" ")}polarToCartesian(t,e,i,n){return{x:t+i*Math.cos(n),y:e+i*Math.sin(n)}}addDataPoint(t,e=0){if(e>=this.data.length)console.error("Series index out of range.");else{if(this.data[e].data.push(t),0!==this.config.maxDataPoints&&this.data[e].data.length>this.config.maxDataPoints){const t=this.data[e].data.shift();if(t.value===this.minValue||t.value===this.maxValue){const t=this.data.flatMap(t=>t.data.map(t=>t.value));this.minValue=Math.min(...t),this.maxValue=Math.max(...t)}}else this.minValue=Math.min(this.minValue,t.value),this.maxValue=Math.max(this.maxValue,t.value);this.calculateNiceRange(),this.visibleDataCount=this.calculateVisibleDataCount(),this.redrawGraph()}}drawLineGraph(){const t=this.visibleDataCount;if(0===t)return;const e=this.data.length,i=this.margin,n=this.width-i.left-i.right;if(this.config.showGrid){const e=5;for(let t=0;t<=e;t++){const i=this.getPointY(this.minNice+t/e*(this.maxNice-this.minNice));this.drawHorizontalGridLines(i)}const i=new Set;for(let a=0;a<t;a++){const t=this.getPointX(a);i.add(t)}const n=Array.from(i);this.drawVerticalGridLines(n)}if(this.config.showAxisLabels&&e>0){const e=this.data[0].data.slice(0,this.visibleDataCount).map(t=>this.stripTags(t.label)),i=e.join(" "),a=n<this.estimateTextWidth(i)+10*t;e.forEach((t,e)=>{const i=this.getPointX(e);this.drawLabel(i,this.height-this.margin.bottom+20,t,a)})}this.config.showAxis&&this.drawAxes();const a=this.createSVGElement("g",{class:"lines"}),s=`clipPath-${Date.now()}`,o=this.createSVGElement("clipPath",{id:s});if(this.config.animation){const t=this.createSVGElement("rect",{x:i.left,y:i.top,width:"0",height:this.height-i.top-i.bottom}),e=this.createSVGElement("animate",{attributeName:"width",from:"0",to:n,dur:`${this.config.animationDuration}ms`,fill:"freeze"});t.appendChild(e),o.appendChild(t),this.svg.appendChild(o)}this.data.forEach((t,e)=>{const i=t.color||this.config.colors[e%this.config.colors.length],n=this.createSVGElement("path",{d:this.config.curve?this.getCurvePath(t.data.slice(0,this.visibleDataCount)):this.getLinearPath(t.data.slice(0,this.visibleDataCount)),stroke:i,fill:"none","stroke-width":this.config.lineWidth});if(this.config.fillArea){const e=this.createSVGElement("path",{fill:i,"fill-opacity":this.config.fillOpacity,"clip-path":`url(#${s})`}),o=this.minNice>=0?this.getPointY(this.minNice):this.maxNice<=0?this.getPointY(this.maxNice):this.getPointY(0),r=`${n.getAttribute("d")} L${this.getPointX(this.visibleDataCount-1)},${o} L${this.getPointX(0)},${o} Z`;let h="";if(this.config.animation){n.setAttribute("clip-path",`url(#${s})`),h=t.data.slice(0,this.visibleDataCount).map((t,e)=>`${0===e?"M":"L"}${this.getPointX(e)},${o}`).join(" ")+" Z",e.setAttribute("d",h);const i=this.createSVGElement("animate",{attributeName:"d",from:h,to:r,dur:`${this.config.animationDuration}ms`,fill:"freeze"});e.appendChild(i)}else e.setAttribute("d",r);a.appendChild(e)}if(this.config.animation){const t=n.getTotalLength();n.setAttribute("stroke-dasharray",t),n.setAttribute("stroke-dashoffset",t);const e=this.createSVGElement("animate",{attributeName:"stroke-dashoffset",from:t,to:"0",dur:`${this.config.animationDuration}ms`,fill:"freeze"});n.appendChild(e)}"function"==typeof this.config.onClick&&(n.style.cursor="pointer",n.addEventListener("click",()=>{this.config.onClick({type:"line",series:t,data:t.data.slice(0,this.visibleDataCount)})})),a.appendChild(n)}),this.svg.appendChild(a);const r=this.createSVGElement("g",{class:"points"});if(this.data.forEach((t,e)=>{const i=t.color||this.config.colors[e%this.config.colors.length];t.data.slice(0,this.visibleDataCount).forEach((e,n)=>{const a=this.getPointX(n),s=this.getPointY(e.value);if(this.config.showDataLabels){const n=5,o=a+n,h=s+-15,l=this.createSVGElement("line",{x1:a,y1:s,x2:this.config.animation?a:o,y2:this.config.animation?s:h,stroke:i,"stroke-width":"1"});if(this.config.animation){const t=this.createSVGElement("animate",{attributeName:"y2",from:s,to:h,dur:"0.5s",fill:"freeze"});l.appendChild(t);const e=this.createSVGElement("animate",{attributeName:"x2",from:a,to:o,dur:"0.5s",fill:"freeze"});l.appendChild(e)}r.appendChild(l);const c=o+n,d=this.createSVGElement("line",{x1:o,y1:h,y2:h,stroke:i,"stroke-width":"1"});if(this.config.animation){d.setAttribute("x2",o);const t=this.createSVGElement("animate",{attributeName:"x2",from:o,to:c,dur:"0.5s",begin:"0.5s",fill:"freeze"});d.appendChild(t)}else d.setAttribute("x2",c);r.appendChild(d);const g=this.createSVGElement("text",{x:c,y:h,"text-anchor":c>a?"start":"end","alignment-baseline":"middle","font-size":this.config.labelFontSize,"font-family":this.config.fontFamily,fill:i});if(g.textContent=this.getLabelContent(t,e),this.config.animation){g.setAttribute("opacity","0");const t=this.createSVGElement("animate",{attributeName:"opacity",from:"0",to:"1",dur:"0.5s",begin:"0.5s",fill:"freeze"});g.appendChild(t);const e=this.createSVGElement("animateTransform",{attributeName:"transform",type:"translate",from:"0,0",to:`${n},0`,dur:"0.5s",begin:"0.5s",fill:"freeze"});g.appendChild(e)}r.appendChild(g)}const o=this.createSVGElement("circle",{cx:a,cy:s,r:this.config.animation?"0":this.config.pointRadius,fill:this.config.backgroundColor,stroke:i,"stroke-width":2});if(this.config.showTooltip){const i=this.createSVGElement("title");i.textContent=this.getTooltipContent(t,e),o.appendChild(i),o.setAttribute("cursor","pointer")}if("function"==typeof this.config.onClick&&(o.style.cursor="pointer",o.addEventListener("click",()=>{this.config.onClick({type:"point",series:t,data:e})})),this.config.animation){const t=this.createSVGElement("animate",{attributeName:"r",from:"0",to:this.config.pointRadius,dur:`${this.config.animationDuration}ms`,fill:"freeze"});o.appendChild(t);const e=this.createSVGElement("animate",{attributeName:"opacity",from:"0",to:"1",dur:`${this.config.animationDuration}ms`,fill:"freeze"});o.appendChild(e)}r.appendChild(o)})}),this.svg.appendChild(r),this.config.showCenterText){const t=this.createSVGElement("text",{x:this.width/2,y:this.height/2,"text-anchor":"middle","font-size":this.config.fontSize,"font-family":this.config.fontFamily,fill:this.config.textColor,"font-weight":"bold"});t.textContent=this.config.centerText||"",this.svg.appendChild(t)}}drawBarGraph(){const t=this.visibleDataCount;if(0===t)return;const e=this.data.length,i=this.margin,n=this.width-i.left-i.right,a=n/t,s=a/(e+1),o=(a-e*s)/(e+1),r=this.getPointY(0),h=this.createSVGElement("defs"),l=this.createSVGElement("filter",{id:"barShadow",x:"-20%",y:"-20%",width:"140%",height:"140%"}),c=this.createSVGElement("feOffset",{dx:"2",dy:"-2",result:"offsetBlur"}),d=this.createSVGElement("feGaussianBlur",{in:"offsetBlur",stdDeviation:"2",result:"blur"}),g=this.createSVGElement("feFlood",{"flood-color":"#000000","flood-opacity":"0.3",result:"color"}),m=this.createSVGElement("feComposite",{in:"color",in2:"blur",operator:"in",result:"shadow"}),f=this.createSVGElement("feMerge"),p=this.createSVGElement("feMergeNode",{in:"shadow"}),u=this.createSVGElement("feMergeNode",{in:"SourceGraphic"});if(l.appendChild(c),l.appendChild(d),l.appendChild(g),l.appendChild(m),l.appendChild(f),f.appendChild(p),f.appendChild(u),h.appendChild(l),this.svg.appendChild(h),this.config.showGrid){const t=5;for(let e=0;e<=t;e++){const i=this.getPointY(this.minNice+e/t*(this.maxNice-this.minNice));this.drawHorizontalGridLines(i)}}const b=[];for(let C=0;C<t;C++){const t=i.left+C*a;b.push(t)}if(this.config.showGrid&&this.drawVerticalGridLines(b.map(t=>t+a)),this.config.showAxisLabels&&this.data.length>0){const e=this.data[0].data.slice(0,this.visibleDataCount).map(t=>this.stripTags(t.label)),s=e.join(" "),o=n<this.estimateTextWidth(s)+10*t;e.forEach((t,e)=>{const n=b[e]+a/2;this.drawLabel(n,this.height-i.bottom+20,t,o)})}this.data.forEach((e,i)=>{e.data.slice(0,t).forEach((t,n)=>{const a=b[n]+o+i*(s+o);let h,l;const c=this.getPointY(t.value);this.minNice>=0&&this.maxNice>=0?(h=c,l=this.getPointY(this.minNice)-c):this.minNice<=0&&this.maxNice<=0?(h=this.getPointY(this.maxNice),l=c-h):(h=Math.min(r,c),l=Math.abs(r-c));const d=t.color||e.color||this.config.colors[i%this.config.colors.length],g=this.createSVGElement("rect",{x:a,width:s,height:this.config.animation?"0":l,fill:d,filter:"url(#barShadow)"});if(this.config.borderColor&&(g.setAttribute("stroke","auto"===this.config.borderColor?this.darkenColor(d):this.config.borderColor),g.setAttribute("stroke-width",this.config.borderWidth)),this.config.showTooltip){const i=this.createSVGElement("title");i.textContent=this.getTooltipContent(e,t),g.appendChild(i),g.setAttribute("cursor","pointer")}let m;if("function"==typeof this.config.onClick&&(g.style.cursor="pointer",g.addEventListener("click",()=>{this.config.onClick({type:"bar",series:e,data:t})})),m=this.minNice>=0&&this.maxNice>=0?this.getPointY(this.minNice):this.minNice<0&&this.maxNice<0?this.getPointY(this.maxNice):this.getPointY(0),this.config.animation){g.setAttribute("y",h);const t=this.createSVGElement("animate",{attributeName:"height",from:"0",to:l,dur:`${this.config.animationDuration}ms`,fill:"freeze"});g.appendChild(t);const e=this.createSVGElement("animate",{attributeName:"y",from:m,to:h,dur:`${this.config.animationDuration}ms`,fill:"freeze"});g.appendChild(e)}else g.setAttribute("y",h),g.setAttribute("height",l);if(this.svg.appendChild(g),this.config.showDataLabels){const i=this.createSVGElement("text",{x:a+s/2,"text-anchor":"middle","font-size":this.config.labelFontSize,"font-family":this.config.fontFamily,fill:d});if(i.textContent=this.getLabelContent(e,t),t.value>=0){if(i.setAttribute("y",h-5),this.config.animation){const t=this.createSVGElement("animate",{attributeName:"y",from:m-5,to:h-5,dur:`${this.config.animationDuration}ms`,fill:"freeze"});i.appendChild(t)}}else if(i.setAttribute("y",h+l+15),this.config.animation){const t=this.createSVGElement("animate",{attributeName:"y",from:m+15,to:h+l+15,dur:`${this.config.animationDuration}ms`,fill:"freeze"});i.appendChild(t)}this.svg.appendChild(i)}})}),this.config.showAxis&&this.drawAxes()}drawPieChart(t=!1){if(!this.data||!this.data.length)return;const e=Math.min(this.width-this.margin.left-this.margin.right,this.height-this.margin.top-this.margin.bottom)/2,i=this.margin.left+(this.width-this.margin.left-this.margin.right)/2,n=this.margin.top+(this.height-this.margin.top-this.margin.bottom)/2;let a=-Math.PI/2;const s=this.data.reduce((t,e)=>t+e.data.reduce((t,e)=>t+e.value,0),0);if(0===s)return void console.warn("Total value of pie chart is 0. Cannot draw pie chart.");const o=this.createSVGElement("g",{class:"pie-group"});if(this.data.forEach((t,r)=>{t.data.forEach((r,h)=>{const l=r.value/s*2*Math.PI,c=a+l,d=a+l/2,g=r.color||t.color||this.config.colors[h%this.config.colors.length],m=i+e*Math.cos(a),f=n+e*Math.sin(a),p=i+e*Math.cos(c),u=n+e*Math.sin(c),b=l>Math.PI?"1":"0",C=[`M ${i} ${n}`,`L ${m} ${f}`,`A ${e} ${e} 0 ${b} 1 ${p} ${u}`,"Z"].join(" "),w="auto"===this.config.borderColor?this.darkenColor(g):this.config.borderColor,y=this.createSVGElement("path",{d:C,fill:g,stroke:this.config.gap>0?this.config.backgroundColor:this.config.borderWidth>0?w||"#000":null,"stroke-width":this.config.gap>0||this.config.borderWidth>0?this.config.gap>0?this.config.gap:this.config.borderWidth:null});if(this.config.showTooltip){const e=this.createSVGElement("title");e.textContent=this.getTooltipContent(t,r),y.appendChild(e),y.setAttribute("cursor","pointer")}if("function"==typeof this.config.onClick&&(y.style.cursor="pointer",y.addEventListener("click",()=>{this.config.onClick({type:"pie",series:t,data:r})})),this.config.animation){const t=y.getTotalLength();y.setAttribute("stroke-dasharray",t),y.setAttribute("stroke-dashoffset",t);const e=this.createSVGElement("animate",{attributeName:"stroke-dashoffset",from:t,to:"0",dur:`${this.config.animationDuration}ms`,fill:"freeze"});y.appendChild(e)}if(o.appendChild(y),this.config.showDataLabels){const a=1.2*e,s=i+a*Math.cos(d),h=n+a*Math.sin(d),l=i+e*Math.cos(d),c=n+e*Math.sin(d),m=this.createSVGElement("line",{x1:l,y1:c,x2:this.config.animation?l:s,y2:this.config.animation?c:h,stroke:g,"stroke-width":"1"});if(this.config.animation){const t=this.createSVGElement("animate",{attributeName:"x2",from:l,to:s,dur:"0.5s",fill:"freeze"});m.appendChild(t);const e=this.createSVGElement("animate",{attributeName:"y2",from:c,to:h,dur:"0.5s",fill:"freeze"});m.appendChild(e)}o.appendChild(m);const f=5,p=s>i?s+f:s-f,u=this.createSVGElement("line",{x1:s,y1:h,y2:h,stroke:g,"stroke-width":"1"});if(this.config.animation){u.setAttribute("x2",s);const t=this.createSVGElement("animate",{attributeName:"x2",from:s,to:p,dur:"0.5s",begin:this.config.animationDuration/2+"ms",fill:"freeze"});u.appendChild(t)}else u.setAttribute("x2",p);o.appendChild(u);const b=this.createSVGElement("text",{x:p+(s>i?5:-5),y:h,"text-anchor":s>i?"start":"end","alignment-baseline":"middle","font-size":this.config.labelFontSize,fill:g});if(b.textContent=this.getLabelContent(t,r),this.config.animation){b.setAttribute("opacity","0");const t=this.createSVGElement("animate",{attributeName:"opacity",from:"0",to:"1",dur:"0.5s",begin:this.config.animationDuration/2+"ms",fill:"freeze"});b.appendChild(t);const e=this.createSVGElement("animateTransform",{attributeName:"transform",type:"translate",to:"0,0",from:s>i?`-${f+5},0`:`${f+5},0`,dur:"0.5s",begin:this.config.animationDuration/2+"ms",fill:"freeze"});b.appendChild(e)}o.appendChild(b)}a=c})}),t){const t=this.createSVGElement("circle",{cx:i,cy:n,r:Math.max(0,e-this.config.donutThickness),fill:this.config.backgroundColor});if(this.config.gap<=0&&this.config.borderWidth>0){const e="auto"===this.config.borderColor?this.darkenColor(this.config.colors[0]):this.config.borderColor;t.setAttribute("stroke",e||"#000"),t.setAttribute("stroke-width",this.config.borderWidth)}o.appendChild(t)}if(this.config.showCenterText){const e=this.createSVGElement("text",{x:i,y:n,"text-anchor":"middle","alignment-baseline":"middle","font-size":this.config.fontSize,fill:this.config.textColor,"font-weight":"bold"});e.textContent=null!==this.config.centerText?this.config.centerText:t?`Total: ${s}`:"",this.svg.appendChild(e)}this.svg.appendChild(o)}drawGauge(){const t=this.margin.left+(this.width-this.margin.left-this.margin.right)/2,e=this.margin.top+(this.height-this.margin.top-this.margin.bottom)/2,i=Math.min(this.width-this.margin.left-this.margin.right,this.height-this.margin.top-this.margin.bottom)/2,n=.75*-Math.PI,a=.75*Math.PI,s=this.createSVGElement("path",{d:this.describeArc(t,e,i,n,a),fill:"none",stroke:this.config.gridColor,"stroke-width":this.config.gaugeCurveWidth});this.svg.appendChild(s);const o=this.data[0].data[0].value/(this.config.maxGaugeValue||100)*100,r=n+o/100*(a-n),h=this.createSVGElement("path",{d:this.describeArc(t,e,i,n,r),fill:"none",stroke:this.data[0].color||this.config.colors[0],"stroke-width":this.config.gaugeCurveWidth,"stroke-linecap":"round"});if("function"==typeof this.config.onClick&&(h.style.cursor="pointer",h.addEventListener("click",()=>{this.config.onClick({type:"gauge",series:this.data[0],data:this.data[0].data[0]})})),this.config.animation){const t=h.getTotalLength();h.setAttribute("stroke-dasharray",t),h.setAttribute("stroke-dashoffset",t);const e=this.createSVGElement("animate",{attributeName:"stroke-dashoffset",from:t,to:"0",dur:`${this.config.animationDuration}ms`,fill:"freeze"});h.appendChild(e)}if(this.svg.appendChild(h),this.config.showCenterText){const i=this.createSVGElement("text",{x:t,y:e,"text-anchor":"middle","dominant-baseline":"middle","font-size":this.config.fontSize,"font-family":this.config.fontFamily,fill:this.config.textColor,"font-weight":"bold"});i.textContent=null!==this.config.centerText?this.config.centerText:`${this.formatValue(o)}%`,this.svg.appendChild(i);const n=this.createSVGElement("text",{x:t,y:e+30,"text-anchor":"middle","font-size":.8*this.config.fontSize,"font-family":this.config.fontFamily,fill:this.config.textColor});n.textContent=this.data[0].data[0].label||"",this.svg.appendChild(n)}}drawLegend(){this.config.showLegend&&(this.legend&&this.container.parentElement.removeChild(this.legend),this.legend=document.createElement("div"),this.legend.className="ggraphs-legend",this.legend.style.display="flex",this.legend.style.justifyContent="center",this.legend.style.flexWrap="wrap",this.legend.style.columnGap="20px","pie"===this.currentChartType||"donut"===this.currentChartType?this.data.forEach(t=>{t.data.forEach((e,i)=>{const n=e.color||t.color||this.config.colors[i%this.config.colors.length],a=this.createLegendItem(n,e.label);this.legend.appendChild(a)})}):this.data.forEach((t,e)=>{const i=t.color||this.config.colors[e%this.config.colors.length],n=this.createLegendItem(i,t.name||`Series ${e+1}`);this.legend.appendChild(n)}),"top"===this.config.legendPosition?this.container.parentElement.insertBefore(this.legend,this.container):this.container.parentElement.appendChild(this.legend))}createLegendItem(t,e){const i=document.createElement("div");i.style.display="-webkit-box",i.style.webkitBoxOrient="vertical",i.style.webkitLineClamp=1,i.style.overflow="hidden";const n=document.createElement("span");n.style.backgroundColor=t,n.style.width="1em",n.style.height="1em",n.style.backgroundColor=t,n.style.borderRadius="9999px",n.style.display="inline-block",n.style.marginRight="5px";const a=document.createElement("span");return a.innerHTML=e,i.appendChild(n),i.appendChild(a),i}getTooltipContent(t,e){return this.config.tooltipFormatter?this.config.tooltipFormatter(t,e):`${t.name}: ${this.stripTags(e.label)} - ${this.formatValue(e.value)}`}getLabelContent(t,e){return"pie"===this.currentChartType||"donut"===this.currentChartType?this.config.showValueInsteadOfPercent?this.formatValue(e.value):`${this.formatValue(e.value/this.getTotal(t)*100)}%`:this.formatValue(e.value)}stripTags(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}formatValue(t){if("number"!=typeof t||isNaN(t))return t;const e=(t=Number(t.toFixed(1))).toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}estimateTextWidth(t){const e=this.createSVGElement("text",{"font-size":this.config.labelFontSize,"font-family":this.config.fontFamily});e.textContent=t,this.svg.appendChild(e);const i=e.getBBox();return this.svg.removeChild(e),i.width}getTotal(t){return t.data.reduce((t,e)=>t+e.value,0)}setMargins(){let t={top:50,right:50,bottom:50,left:50};"gauge"===this.config.type?t={top:66,right:66,bottom:66,left:66}:this.config.showDataLabels||(["pie","donut"].includes(this.config.type)?t={top:30,right:30,bottom:30,left:30}:this.config.showAxisLabels||(t={top:10,right:10,bottom:10,left:10})),this.margin=t}darkenColor(t,e=.2){let i=t.startsWith("#")?t.slice(1):t;3===i.length&&(i=i.split("").map(t=>t+t).join(""));const n=Math.max(0,Math.min(255,Math.round(parseInt(i.slice(0,2),16)*(1-e)))),a=Math.max(0,Math.min(255,Math.round(parseInt(i.slice(2,4),16)*(1-e)))),s=Math.max(0,Math.min(255,Math.round(parseInt(i.slice(4,6),16)*(1-e))));return`#${n.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}loadAndProcessTableData(t){const e=this.loadFromTable(t);return this.processTableData(e)}calculateNiceRange(){const t=this.maxValue-this.minValue;if(0===t)return this.minNice=this.minValue-1,void(this.maxNice=this.maxValue+1);const e=t/5,i=Math.pow(10,Math.floor(Math.log10(e))),n=Math.ceil(e/i)*i;this.minNice=Math.floor(this.minValue/n)*n,this.maxNice=Math.ceil(this.maxValue/n)*n,this.minValue>0&&(this.minValue===this.minNice&&(this.minNice=Math.max(0,this.minNice-n)),this.maxValue===this.maxNice&&(this.maxNice+=n)),this.maxValue<0&&(this.maxValue===this.maxNice&&(this.maxNice=Math.min(0,this.maxNice+n)),this.minValue===this.minNice&&(this.minNice-=n))}initialize(){if(this.clear(),this.calculateFontSize(),this.setMargins(),this.config.table){const t=document.getElementById(this.config.table);if(t){const e=this.loadAndProcessTableData(t);this.setData(e)}else console.warn(`Table with ID "${this.config.table}" not found.`)}else this.config.data&&this.setData(this.config.data);this.renderGraph()}destroy(){window.removeEventListener("resize",this.handleResize),this.container&&this.svg&&this.container.contains(this.svg)&&this.container.removeChild(this.svg)}throttle(t,e){let i;return function(...n){i||(t.apply(this,n),i=!0,setTimeout(()=>i=!1,e))}}animate(t,e,i=1e3){if(!this.config.animation)return;const n=[];return Object.entries(e).forEach(([e,a])=>{const s=t.animate([{[e]:t.getAttribute(e)},{[e]:a}],{duration:i,easing:"ease-in-out",fill:"forwards"});n.push(s)}),Promise.all(n.map(t=>t.finished))}getPathLength(t){const e=this.createSVGElement("path",{d:t}),i=e.getTotalLength();return e.remove(),i}handleTouchStart(t){this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY}handleTouchMove(t){if(!this.touchStartX||!this.touchStartY)return;const e=this.touchStartX-t.touches[0].clientX,i=this.touchStartY-t.touches[0].clientY;Math.abs(e)>Math.abs(i)?this.pan(e):this.zoom(i)}handleTouchEnd(){this.touchStartX=0,this.touchStartY=0}exportToImage(t="graph",e="png",i=this.width,n=null,a=.8,s=1){if(["png","jpeg","svg"].includes(e)||(console.warn(`Invalid format "${e}". Defaulting to "png".`),e="png"),!this.svg)return void console.error("No SVG content to export.");const o=this.disableAnimations(),r=this.height/this.width,h="svg"===e?this.width:i*s,l="svg"===e?this.height:(null!==n?n:i*r)*s,c=this.svg.cloneNode(!0);c.setAttribute("width",h),c.setAttribute("height",l),c.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),c.insertAdjacentHTML("afterbegin",`<desc>${this.getAccessibilityDescription()}</desc>`);const d=(new XMLSerializer).serializeToString(c);if(this.restoreAnimations(o),"svg"===e){try{const e=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(e),n=document.createElement("a");n.download=`${t}.svg`,n.href=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(f){throw console.error("SVG export failed:",f),f}return}const g="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(d),m=document.createElement("canvas");m.width=h,m.height=l;try{const i=m.getContext("2d");if(!i)throw new Error("Failed to get canvas context");const n=new Image;n.onload=()=>{i.fillStyle=this.config.backgroundColor,i.fillRect(0,0,h,l),i.drawImage(n,0,0,h,l);const s="jpeg"===e?"image/jpeg":"image/png",o="jpeg"===e?m.toDataURL(s,a):m.toDataURL(s),r=document.createElement("a");r.download=`${t}.${e}`,r.href=o,document.body.appendChild(r),r.click(),document.body.removeChild(r)},n.onerror=()=>{console.error("Failed to load SVG for export.")},n.src=g}catch(f){throw console.error("Export failed:",f),f}}disableAnimations(){const t=[],e=this.svg.getElementsByTagName("animate");for(let n=e.length-1;n>=0;n--){const i=e[n],a=i.parentElement,s=i.getAttribute("attributeName"),o=i.getAttribute("to");t.push({element:i.cloneNode(!0),parent:a}),s&&o&&a&&(a.setAttribute(s,o),a.removeChild(i))}const i=this.svg.getElementsByTagName("animateTransform");for(let n=i.length-1;n>=0;n--){const e=i[n],a=e.parentElement,s=e.getAttribute("to");if(t.push({element:e.cloneNode(!0),parent:a}),"translate"===e.getAttribute("type")&&s&&a){const[t,i]=s.split(",");a.setAttribute("transform",`translate(${t}, ${i})`),a.removeChild(e)}}return t}restoreAnimations(t){t.forEach(({element:t,parent:e})=>{e.appendChild(t)})}exportToCSV(){const t=[["Series","Label","Value"]];return this.data.forEach(e=>{e.data.forEach(i=>{t.push([e.name,i.label,i.value])})}),t.map(t=>t.join(",")).join("\n")}setTheme(t){this.config={...this.config,...this.themes[t]},this.redrawGraph()}ensureSVG(){try{return 0===this.container.clientWidth||0===this.container.clientHeight?(this._waitingForSize||(this._waitingForSize=!0,setTimeout(()=>{this._waitingForSize=!1,this.redrawGraph()},100)),null):(this.svg&&this.container.contains(this.svg)||this.createSVG(),this.svg)}catch(t){throw console.error("[GraphRenderer] Error ensuring SVG:",t),t}}};const e={config:{autoload:!0,debug:!1,colors:["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F9ED69","#F08A5D","#B83B5E","#6A2C70","#00B8A9"],backgroundColor:"#ffffff",showGrid:!0,gridColor:"#E0E0E0",axisColor:"#333333",curve:!0,maxGaugeValue:100,centerText:null,showCenterText:!0,gap:2,borderWidth:1,borderColor:"auto",pointRadius:4,lineWidth:2,fillArea:!1,fillOpacity:.1,fontFamily:"Arial, sans-serif",textColor:"#333333",fontSize:16,showAxisLabels:!0,showAxis:!0,animationDuration:1e3,donutThickness:30,gaugeCurveWidth:30,showLegend:!0,legendPosition:"bottom",showTooltip:!0,tooltipFormatter:null,showDataLabels:!0,showValueInsteadOfPercent:!0,animation:!1,maxDataPoints:20,type:"line",table:null,url:null,data:null,onClick:null,onLoad:null,onRender:null,onDataChange:null,pollingInterval:0,refreshEvent:null},state:{instances:new Map,initialized:!1,renderer:null,pendingLoads:new Map,timers:new Map},async init(t={}){var e;return this.state.initialized||(this.config={...this.config,...t},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initElements()):this.initElements(),this.setupObserver(),(null==(e=window.EventManager)?void 0:e.on)&&(this.state.localeChangeHandler=()=>this.refreshAll(),EventManager.on("locale:changed",this.state.localeChangeHandler)),this.state.initialized=!0),this},initElements(){document.querySelectorAll('[data-component="graph"]').forEach(t=>{this.create(t)})},setupObserver(){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(1===t.nodeType){t.dataset&&"graph"===t.dataset.component&&this.create(t);t.querySelectorAll('[data-component="graph"]').forEach(t=>{this.create(t)})}}),t.removedNodes.forEach(t=>{1===t.nodeType&&setTimeout(()=>{t.dataset&&"graph"===t.dataset.component&&(t.isConnected||this.destroy(t));t.querySelectorAll('[data-component="graph"]').forEach(t=>{t.isConnected||this.destroy(t)})},0)})})}).observe(document.body,{childList:!0,subtree:!0})},async create(t,e={}){if("string"==typeof t&&(t=document.querySelector(t)),!t)return console.error("GraphComponent: Element not found"),null;const i=this.getInstance(t);if(i)return i;const n=this.extractOptionsFromElement(t),a={...this.config,...n,...e},s="graph_"+Math.random().toString(36).substring(2,11),o={id:s,element:t,options:a,data:null,state:{loading:!1,error:null,rendered:!1,width:t.clientWidth,height:t.clientHeight},renderer:null,timer:null};return t.dataset.graphComponentId=s,t.classList.add("graph-component"),this.state.instances.set(s,o),await this.ensureRenderer(),this.setupInstance(o),o.options.autoload&&this.loadData(o),o.options.pollingInterval>0&&o.options.url&&this.startPolling(o),o.options.refreshEvent&&this.bindRefreshEvent(o),t.graphInstance=o,this.dispatchEvent(o,"created",{instance:o}),o},setupInstance(t){if(t.setData=e=>this.setData(t,e),t.loadData=e=>this.loadData(t,e),t.refresh=()=>this.refresh(t),t.addDataPoint=(e,i)=>this.addDataPoint(t,e,i),t.setType=e=>this.setType(t,e),t.exportToImage=(e,i,n,a,s,o)=>this.exportToImage(t,e,i,n,a,s,o),t.destroy=()=>this.destroy(t),t.renderer=new this.state.renderer(t.element,t.options),t.options.data)this.setData(t,t.options.data);else if(t.options.table){const e=document.getElementById(t.options.table);if(e){const i=this.loadAndProcessTableData(t,e);this.setData(t,i)}}const e=this.debounce(()=>{if(!t.element)return;const e=t.element.clientWidth,i=t.element.clientHeight;e===t.state.width&&i===t.state.height||(t.state.width=e,t.state.height=i,t.renderer&&t.renderer.handleResize())},200);window.addEventListener("resize",e),t.resizeHandler=e},async ensureRenderer(){return this.state.renderer?this.state.renderer:window.GraphRenderer?(this.state.renderer=window.GraphRenderer,this.state.renderer):(this.state.renderer=this.createInternalRenderer(),this.state.renderer)},createInternalRenderer:()=>class InternalGraphRenderer{constructor(t,e){this.element=t,this.options=e,this.svg=null,this.width=t.clientWidth,this.height=t.clientHeight,this.createSVG()}createSVG(){this.width<=0||this.height<=0||(this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%"),this.svg.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),this.svg.setAttribute("role","img"),this.svg.setAttribute("aria-label","Data Visualization Graph"),this.element.appendChild(this.svg))}setData(t){this.data=t,this.renderGraph()}renderGraph(){this.svg||this.createSVG(),this.svg.innerHTML="";const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",this.width/2),t.setAttribute("y",this.height/2),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","middle"),t.setAttribute("font-family",this.options.fontFamily),t.setAttribute("font-size","14px"),t.textContent="Graph Rendering (Full implementation required)",this.svg.appendChild(t)}handleResize(){this.element&&(this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),this.renderGraph()))}destroy(){this.svg&&this.element.contains(this.svg)&&this.element.removeChild(this.svg)}},setData(t,e){t&&e&&(t.data=e,t.renderer&&(t.renderer.setData(e),t.state.rendered=!0,this.dispatchEvent(t,"data-changed",{data:e}),"function"==typeof t.options.onDataChange&&t.options.onDataChange.call(t,e)))},async loadData(t,e){if(!t)return;const i=e||t.options.url;if(i||!t.options.data){if(!i&&t.options.table){const e=document.getElementById(t.options.table);if(e){const i=this.loadAndProcessTableData(t,e);return void this.setData(t,i)}}if(i){t.state.loading=!0,t.state.error=null,this.dispatchEvent(t,"loading");try{let e;if(window.http&&"function"==typeof window.http.get)e=await window.http.get(i);else{if(!window.simpleFetch||"function"!=typeof window.simpleFetch.get)throw new Error("HttpClient (window.http) or simpleFetch is required");{const t={Accept:"application/json","X-Requested-With":"XMLHttpRequest"};e=await simpleFetch.get(i,{headers:t})}}let n=e.data||e;if(n&&n.data&&(n=n.data),n&&n.data&&Array.isArray(n.data)&&(n=n.data),t.options.path){const e=t.options.path,i=e.split(".");for(const t of i){if(!n||"object"!=typeof n||!(t in n)){console.warn(`GraphComponent: Path "${e}" not found in response data`),n=null;break}n=n[t]}}return n&&this.setData(t,n),t.state.loading=!1,this.dispatchEvent(t,"loaded",{data:n}),"function"==typeof t.options.onLoad&&t.options.onLoad.call(t,n),n}catch(n){if("AbortError"===n.name)return;t.state.loading=!1,t.state.error=n.message,this.dispatchEvent(t,"error",{error:n}),console.error("GraphComponent: Error loading data",n)}}else console.warn("GraphComponent: No data source specified")}else this.setData(t,t.options.data)},addDataPoint(t,e,i=0){t&&t.renderer&&(t.renderer.addDataPoint(e,i),this.dispatchEvent(t,"data-point-added",{point:e,seriesIndex:i}))},setType(t,e){t&&t.renderer&&(t.options.type=e,void 0!==t.renderer.currentChartType?(t.renderer.currentChartType=e,t.renderer.redrawGraph()):(t.renderer.destroy(),t.renderer=new this.state.renderer(t.element,t.options),t.data&&t.renderer.setData(t.data)),this.dispatchEvent(t,"type-changed",{type:e}))},exportToImage(t,e="graph",i="png",n,a,s=.8,o=1){if(t&&t.renderer)return"function"==typeof t.renderer.exportToImage?t.renderer.exportToImage(e,i,n,a,s,o):void console.warn("GraphComponent: Export to image not supported by this renderer")},refresh(t){"string"==typeof t?t=this.state.instances.get(t):t instanceof HTMLElement&&(t=this.getInstance(t)),t&&this.loadData(t)},refreshAll(){this.state.instances.forEach(t=>{this.loadData(t)})},startPolling(t){if(!t||!t.options.url||t.options.pollingInterval<=0)return;this.stopPolling(t);const e=setInterval(()=>{t.state.loading||this.loadData(t)},t.options.pollingInterval);this.state.timers.set(t.id,e),t.timer=e,this.dispatchEvent(t,"polling-started",{interval:t.options.pollingInterval})},stopPolling(t){if(!t)return;const e=this.state.timers.get(t.id);e&&(clearInterval(e),this.state.timers.delete(t.id),t.timer=null,this.dispatchEvent(t,"polling-stopped"))},bindRefreshEvent(t){if(!t||!t.options.refreshEvent)return;const e=t.options.refreshEvent.split(",").map(t=>t.trim());t.eventHandlers=[],e.forEach(e=>{const handler=()=>this.refresh(t);t.eventHandlers.push({eventName:e,handler:handler}),EventManager.on(e,handler)})},unbindRefreshEvent(t){t&&t.eventHandlers&&(t.eventHandlers.forEach(({eventName:t,handler:e})=>{EventManager.off(t,e)}),t.eventHandlers=[])},getInstance(t){if("string"==typeof t)return this.state.instances.get(t);if(t instanceof HTMLElement){if(t.graphInstance)return t.graphInstance;const e=t.dataset.graphComponentId;if(e&&this.state.instances.has(e))return this.state.instances.get(e);for(const[i,n]of this.state.instances.entries())if(n.element===t)return n}return null},extractOptionsFromElement(t){const e={},i=t.dataset;if(i.props)try{const t=JSON.parse(i.props);Object.assign(e,t)}catch(n){console.warn("GraphComponent: Invalid JSON in data-props",n)}for(const[a,s]of Object.entries(i)){if("component"===a||"props"===a||"graphComponentId"===a)continue;e[this.kebabToCamel(a)]=this.parseDataValue(s)}return e},kebabToCamel:t=>t.replace(/-([a-z])/g,(t,e)=>e.toUpperCase()),parseDataValue(t){if("true"===t)return!0;if("false"===t)return!1;if(!isNaN(t)&&""!==t.trim())return Number(t);try{if(t.startsWith("[")&&t.endsWith("]")||t.startsWith("{")&&t.endsWith("}"))return JSON.parse(t)}catch(e){}return t},dispatchEvent(t,e,i={}){if(!t||!t.element)return;const n=new CustomEvent(`graph:${e}`,{bubbles:!0,cancelable:!0,detail:{instance:t,...i}});t.element.dispatchEvent(n),EventManager.emit(`graph:${e}`,{instance:t,...i})},loadAndProcessTableData(t,e){if(!e)return[];if(t.renderer&&"function"==typeof t.renderer.loadAndProcessTableData)return t.renderer.loadAndProcessTableData(e);const i=e.querySelector("thead > tr"),n=e.querySelectorAll("tbody > tr");if(!i||!n.length)return[];const a=Array.from(i.querySelectorAll("th")).slice(1).map(t=>t.innerHTML),s=[];return n.forEach(t=>{var e;const i=(null==(e=t.querySelector("th"))?void 0:e.textContent.trim())||"",n=t.querySelectorAll("td"),o=[];n.forEach((t,e)=>{e<a.length&&o.push({label:a[e],value:parseFloat(t.textContent.replace(/,/g,""))||0})}),o.length>0&&s.push({name:i,data:o})}),s},debounce(t,e){let i;return function(...n){clearTimeout(i),i=setTimeout(()=>t.apply(this,n),e)}},destroy(t){var e,i;if("string"==typeof t?t=this.state.instances.get(t):t instanceof HTMLElement&&(t=this.getInstance(t)),!t)return!1;this.stopPolling(t),this.unbindRefreshEvent(t);const n=this.state.pendingLoads.get(t.id);if(n){const a=window.ApiService||(null==(i=null==(e=window.Now)?void 0:e.getManager)?void 0:i.call(e,"api"));"api"===n.type&&(null==a?void 0:a.abort)&&a.abort(n.url,n.params||{}),this.state.pendingLoads.delete(t.id)}return t.resizeHandler&&window.removeEventListener("resize",t.resizeHandler),t.renderer&&t.renderer.destroy(),t.element&&(delete t.element.graphInstance,delete t.element.dataset.graphComponentId,t.element.classList.remove("graph-component")),this.dispatchEvent(t,"destroyed"),this.state.instances.delete(t.id),!0},destroyAll(){for(const t of this.state.instances.keys())this.destroy(t)}};(null==(t=window.Now)?void 0:t.registerManager)&&Now.registerManager("graph",e),window.ComponentManager&&ComponentManager.define("graph",{template:null,validElement:t=>t.classList.contains("graph-component")||"graph"===t.dataset.component,setupElement(t,i){const n={};if(t.dataset.props)try{const e=JSON.parse(t.dataset.props);Object.assign(n,e)}catch(s){console.warn("Invalid props JSON",s)}const a=e.create(t,n);return t._graphComponent=a,t},beforeDestroy(){this.element&&this.element._graphComponent&&(e.destroy(this.element._graphComponent),delete this.element._graphComponent)}}),window.GraphComponent=e}();
//# sourceMappingURL=now.graph.min.js.map
