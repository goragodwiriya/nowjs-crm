!function(){"use strict";var e;const t={config:{defaultView:"month",locale:"auto",timezone:"local",firstDayOfWeek:0,maxEventsPerDay:3,showNavigation:!0,showToday:!0,showViewSwitcher:!0,views:["month","week","day"],api:null,apiMethod:"GET",eventDataPath:"data",eventColors:["#4285F4","#EA4335","#FBBC04","#34A853","#8E24AA","#E91E63","#00ACC1","#FF7043"],onDateClick:null,onEventClick:null,onEventClickApi:null},state:{instances:new Map,initialized:!1,cleanupHandlers:new WeakMap},i18n:{th:{today:"วันนี้",month:"เดือน",week:"สัปดาห์",day:"วัน",moreEvents:"+{count} เพิ่มเติม",noEvents:"ไม่มีกิจกรรม",allDay:"ทั้งวัน",loading:"กำลังโหลด...",error:"เกิดข้อผิดพลาด",retry:"ลองใหม่",previous:"ก่อนหน้า",next:"ถัดไป",monthNames:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthNamesShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],dayNames:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],dayNamesShort:["อา","จ","อ","พ","พฤ","ศ","ส"]},en:{today:"Today",month:"Month",week:"Week",day:"Day",moreEvents:"+{count} more",noEvents:"No events",allDay:"All day",loading:"Loading...",error:"Error occurred",retry:"Retry",previous:"Previous",next:"Next",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},init(e={}){return this.state.initialized||(this.config={...this.config,...e},document.querySelectorAll("[data-event-calendar]").forEach(e=>{this.create(e)}),this.state.initialized=!0),this},validateConfig(e){const t=[];if(Array.isArray(e.views)&&0!==e.views.length){const n=["month","week","day"],a=e.views.filter(e=>!n.includes(e));a.length>0&&t.push(`Invalid view(s): ${a.join(", ")}. Valid views are: ${n.join(", ")}`)}else t.push("views must be a non-empty array");e.views.includes(e.defaultView)||t.push(`defaultView '${e.defaultView}' is not in views array`),("number"!=typeof e.maxEventsPerDay||e.maxEventsPerDay<1)&&t.push("maxEventsPerDay must be a positive number"),("number"!=typeof e.firstDayOfWeek||e.firstDayOfWeek<0||e.firstDayOfWeek>6)&&t.push("firstDayOfWeek must be a number between 0 (Sunday) and 6 (Saturday)"),e.api&&"string"!=typeof e.api&&t.push("api must be a string URL");const n=["GET","POST","PUT","DELETE","PATCH"];return e.apiMethod&&!n.includes(e.apiMethod.toUpperCase())&&t.push(`apiMethod must be one of: ${n.join(", ")}`),Array.isArray(e.eventColors)&&0!==e.eventColors.length||t.push("eventColors must be a non-empty array"),!(t.length>0)||(console.error("[EventCalendar] Configuration errors:",t),!1)},create(e,t={}){var n,a;if("string"==typeof e&&(e=document.querySelector(e)),!e)return console.error("[EventCalendar] Element not found"),null;if(e._eventCalendar)return e._eventCalendar;const s=this.extractDataOptions(e),i={...this.config,...s,...t};if(!this.validateConfig(i))return console.error("[EventCalendar] Failed to create calendar due to invalid configuration"),null;"auto"===i.locale&&(i.locale=(null==(a=null==(n=window.I18nManager)?void 0:n.getCurrentLanguage)?void 0:a.call(n))||document.documentElement.lang||"en"),i.locale=i.locale.startsWith("th")?"th":"en";const o={element:e,config:i,currentDate:new Date,currentView:i.defaultView,events:[],eventSegments:[],isLoading:!1,error:null,eventListeners:[],segmentCache:new Map};return e._eventCalendar=o,this.state.instances.set(e,o),this.setupCalendar(o),i.api?this.loadEvents(o):this.render(o),o},extractDataOptions(e){const t=e.dataset,n={};if(t.view&&(n.defaultView=t.view),t.locale&&(n.locale=t.locale),t.firstDay&&(n.firstDayOfWeek=parseInt(t.firstDay)),t.maxEvents&&(n.maxEventsPerDay=parseInt(t.maxEvents)),t.api&&(n.api=t.api),t.apiMethod&&(n.apiMethod=t.apiMethod),t.eventDataPath&&(n.eventDataPath=t.eventDataPath),t.onDateClick&&(n.onDateClick=t.onDateClick),t.onEventClick&&(n.onEventClick=t.onEventClick),t.onEventClickApi&&(n.onEventClickApi=t.onEventClickApi),void 0!==t.showNavigation&&(n.showNavigation="false"!==t.showNavigation),void 0!==t.showToday&&(n.showToday="false"!==t.showToday),void 0!==t.showViewSwitcher&&(n.showViewSwitcher="false"!==t.showViewSwitcher),t.views&&(n.views=t.views.split(",").map(e=>e.trim())),t.events)try{n.events=JSON.parse(t.events)}catch(a){console.warn("[EventCalendar] Invalid events JSON")}return n},addTrackedListener(e,t,n,a,s){t.addEventListener(n,a,s),e.eventListeners.push({element:t,event:n,handler:a,options:s})},setupEventDelegation(e){const{element:t}=e;this.addTrackedListener(e,t,"click",t=>{const n=t.target;if(n.closest(".ec-event-bar")){t.stopPropagation();const a=n.closest(".ec-event-bar").dataset.eventId;if(a){const n=e.events.find(e=>e.id===a);n&&this.handleEventClick(e,n,t)}return}if(n.closest(".ec-timed-event")){t.stopPropagation();const a=n.closest(".ec-timed-event").dataset.eventId;if(a){const n=e.events.find(e=>e.id===a);n&&this.handleEventClick(e,n,t)}return}if(n.closest(".ec-allday-event")){const a=n.closest(".ec-allday-event").dataset.eventId;if(a){const n=e.events.find(e=>e.id===a);n&&this.handleEventClick(e,n,t)}return}if(n.closest(".ec-hour-slot")){const a=n.closest(".ec-hour-slot"),s=parseInt(a.dataset.hour),i=a.closest(".ec-day-column");if(i){const n=i.dataset.date,a=new Date(n);a.setHours(s),this.handleDateClick(e,a,t)}return}if(n.closest(".ec-hour-area")){const a=n.closest(".ec-hour-area").closest(".ec-hour-slot"),s=parseInt(a.dataset.hour),i=new Date(e.currentDate);return i.setHours(s),void this.handleDateClick(e,i,t)}})},setupKeyboardNavigation(e){const{element:t}=e;t.hasAttribute("tabindex")||t.setAttribute("tabindex","0");this.addTrackedListener(e,t,"keydown",t=>{const{currentDate:n,currentView:a}=e;switch(t.key){case"ArrowLeft":t.preventDefault(),this.navigate(e,-1);break;case"ArrowRight":t.preventDefault(),this.navigate(e,1);break;case"Home":t.preventDefault(),this.goToToday(e);break;case"t":case"T":t.ctrlKey||t.metaKey||(t.preventDefault(),this.goToToday(e));break;case"m":case"M":t.ctrlKey||t.metaKey||!e.config.views.includes("month")||(t.preventDefault(),this.changeView(e,"month"));break;case"w":case"W":t.ctrlKey||t.metaKey||!e.config.views.includes("week")||(t.preventDefault(),this.changeView(e,"week"));break;case"d":case"D":t.ctrlKey||t.metaKey||!e.config.views.includes("day")||(t.preventDefault(),this.changeView(e,"day"))}})},setupCalendar(e){const{element:t,config:n}=e;t.classList.add("event-calendar"),t.setAttribute("role","application"),t.setAttribute("aria-label","Event Calendar"),t.innerHTML="",this.setupEventDelegation(e),this.setupKeyboardNavigation(e);const a=document.createElement("div");if(a.className="ec-header",n.showNavigation){const t=this.createNavigation(e);a.appendChild(t)}if(n.showViewSwitcher&&n.views.length>1){const t=this.createViewSwitcher(e);a.appendChild(t)}t.appendChild(a),e.headerElement=a;const s=document.createElement("div");s.className="ec-content",t.appendChild(s),e.contentElement=s},createNavigation(e){const{config:t}=e,n=this.i18n[t.locale],a=document.createElement("div");a.className="ec-nav";const s=document.createElement("button");s.className="ec-nav-btn ec-prev",s.setAttribute("aria-label",n.previous||"Previous"),s.setAttribute("type","button"),s.innerHTML='<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.addTrackedListener(e,s,"click",()=>this.navigate(e,-1));const i=document.createElement("div");i.className="ec-current-period",i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),e.currentPeriodElement=i;const o=document.createElement("button");if(o.className="ec-nav-btn ec-next",o.setAttribute("aria-label",n.next||"Next"),o.setAttribute("type","button"),o.innerHTML='<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>',this.addTrackedListener(e,o,"click",()=>this.navigate(e,1)),a.appendChild(s),a.appendChild(i),a.appendChild(o),t.showToday){const t=document.createElement("button");t.className="ec-today-btn",t.setAttribute("type","button"),t.setAttribute("aria-label",n.today),t.textContent=n.today,this.addTrackedListener(e,t,"click",()=>this.goToToday(e)),a.appendChild(t)}return a},createViewSwitcher(e){const{config:t}=e,n=this.i18n[t.locale],a=document.createElement("div");a.className="ec-view-switcher";const s={month:n.month,week:n.week,day:n.day};return t.views.forEach(t=>{const n=document.createElement("button");n.className="ec-view-btn "+(t===e.currentView?"active":""),n.dataset.view=t,n.textContent=s[t]||t,this.addTrackedListener(e,n,"click",()=>this.changeView(e,t)),a.appendChild(n)}),e.viewSwitcherElement=a,a},async loadEvents(e){var t,n,a,s,i;const{config:o}=e;if(o.api){e.isLoading=!0,this.renderLoading(e);try{const r=this.getViewDateRange(e),c=new URLSearchParams({start:this.formatDateISO(r.start),end:this.formatDateISO(r.end)}),l=o.api.includes("?")?`${o.api}&${c}`:`${o.api}?${c}`;let d;if(window.ApiService&&"function"==typeof ApiService.get)d=await ApiService.get(l);else{const e=await fetch(l,{method:o.apiMethod});d=await e.json()}const v=(null==(a=null==(n=null==(t=window.Utils)?void 0:t.object)?void 0:n.get)?void 0:a.call(n,null==d?void 0:d.data,o.eventDataPath,[]))??((null==(s=null==d?void 0:d.data)?void 0:s[o.eventDataPath])||(null==(i=null==d?void 0:d.data)?void 0:i.data)||(null==d?void 0:d.data)||[]);e.events=this.normalizeEvents(v),e.error=null}catch(r){console.error("[EventCalendar] Failed to load events:",r),e.error=r.message,e.events=[]}finally{e.isLoading=!1,this.render(e)}}},parseDate(e,t){if(!e)return new Date;const n=new Date(e);return"UTC"!==t.timezone||e.includes("Z")||e.includes("+")?n:new Date(n.getTime()+6e4*n.getTimezoneOffset())},formatDateForAPI(e,t){return"UTC"===t.timezone?e.toISOString():this.formatDateISO(e)},normalizeEvents(e){return Array.isArray(e)?e.map((e,t)=>{if(!e)return console.warn("[EventCalendar] Null event at index",t),null;let n,a;try{n=e.start?this.parseDate(e.start,this.config):new Date,isNaN(n.getTime())&&(console.warn("[EventCalendar] Invalid start date for event:",e),n=new Date)}catch(s){console.warn("[EventCalendar] Error parsing start date:",s),n=new Date}try{a=e.end?this.parseDate(e.end,this.config):new Date(n),isNaN(a.getTime())&&(console.warn("[EventCalendar] Invalid end date for event:",e),a=new Date(n))}catch(s){console.warn("[EventCalendar] Error parsing end date:",s),a=new Date(n)}return a<n&&(console.warn("[EventCalendar] End date is before start date, swapping"),[n,a]=[a,n]),{id:e.id||`event-${t}-${Date.now()}`,title:e.title||"Untitled",start:n,end:a,allDay:!1!==e.allDay,color:e.color||this.config.eventColors[t%this.config.eventColors.length],category:e.category||null,description:e.description||null,location:e.location||null,data:e}}).filter(e=>null!==e):(console.warn("[EventCalendar] Events data is not an array, received:",typeof e),[])},render(e){if(e.error)this.renderError(e);else if(e.isLoading)this.renderLoading(e);else switch(this.updateCurrentPeriod(e),this.updateViewSwitcher(e),e.currentView){case"month":this.renderMonthView(e);break;case"week":this.renderWeekView(e);break;case"day":this.renderDayView(e)}},renderError(e){const{contentElement:t,config:n,error:a}=e,s=this.i18n[n.locale];t.innerHTML=`\n      <div class="ec-error" role="alert">\n        <div class="ec-error-icon">⚠️</div>\n        <div class="ec-error-title">${s.error}</div>\n        <div class="ec-error-message">${this.escapeHtml(a)}</div>\n        <button type="button" class="ec-retry-btn">${s.retry||"Retry"}</button>\n      </div>\n    `;const i=t.querySelector(".ec-retry-btn");i&&this.addTrackedListener(e,i,"click",()=>{e.error=null,e.config.api?this.loadEvents(e):this.render(e)})},renderLoading(e){const{contentElement:t,config:n}=e,a=this.i18n[n.locale];t.innerHTML=`\n      <div class="ec-loading">\n        <div class="ec-spinner"></div>\n        <span>${a.loading}</span>\n      </div>\n    `},renderMonthView(e){const{contentElement:t,currentDate:n,config:a,events:s}=e,i=this.i18n[a.locale],o=document.createDocumentFragment();t.className="ec-content ec-month-view";const r=document.createElement("div");r.className="ec-month-grid",r.setAttribute("role","grid"),r.setAttribute("aria-label","Calendar month view");const c=document.createElement("div");c.className="ec-weekday-header";const l=document.createDocumentFragment();for(let u=0;u<7;u++){const e=(a.firstDayOfWeek+u)%7,t=document.createElement("div");t.className="ec-weekday",t.textContent=i.dayNamesShort[e],l.appendChild(t)}c.appendChild(l),r.appendChild(c);const d=new Date(n.getFullYear(),n.getMonth(),1);new Date(n.getFullYear(),n.getMonth()+1,0);const v=new Date(d),h=(d.getDay()-a.firstDayOfWeek+7)%7;v.setDate(v.getDate()-h);const m=this.calculateSpanningSegments(e,v,42);for(let u=0;u<6;u++){const t=document.createElement("div");t.className="ec-week-row";const n=document.createElement("div");n.className="ec-event-layer";const a=document.createElement("div");a.className="ec-day-layer";const s=document.createDocumentFragment();for(let r=0;r<7;r++){const t=new Date(v);t.setDate(v.getDate()+7*u+r);const n=this.createDayCell(e,t,d.getMonth());s.appendChild(n)}a.appendChild(s);const i=new Date(v);i.setDate(v.getDate()+7*u);const o=this.getWeekSegments(m,i);this.renderWeekEventBars(e,n,o,i),t.appendChild(n),t.appendChild(a),r.appendChild(t)}o.appendChild(r),t.innerHTML="",t.appendChild(o)},createDayCell(e,t,n){var a,s,i;const{config:o,events:r}=e,c=this.i18n[o.locale],l=new Date,d=document.createElement("div");d.className="ec-day-cell",d.dataset.date=this.formatDateISO(t),d.setAttribute("role","gridcell"),d.setAttribute("aria-label",this.formatDate(t,o.locale)),d.setAttribute("tabindex","-1"),this.isSameDay(t,l)&&d.classList.add("ec-today"),t.getMonth()!==n&&d.classList.add("ec-other-month"),0!==t.getDay()&&6!==t.getDay()||d.classList.add("ec-weekend");const v=document.createElement("div");v.className="ec-day-number",v.textContent=t.getDate(),d.appendChild(v);const h=this.getEventsForDate(r,t),m=Math.max(0,h.length-o.maxEventsPerDay);if(m>0){const n=document.createElement("div");n.className="ec-more-events",n.textContent=c.moreEvents.replace("{count}",m);const moreHandler=n=>{n.stopPropagation(),this.showEventsModal(e,t,h)};this.addTrackedListener(e,n,"click",moreHandler),d.appendChild(n)}this.addTrackedListener(e,d,"click",n=>{this.handleDateClick(e,t,n)});if((null==(i=null==(s=null==(a=window.Utils)?void 0:a.browser)?void 0:s.isMobile)?void 0:i.call(s))||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const mobileClickHandler=n=>{h.length>0&&(n.stopPropagation(),this.showDayDetailModal(e,t,h))};this.addTrackedListener(e,d,"click",mobileClickHandler)}return d},calculateSpanningSegments(e,t,n){const{events:a,config:s,segmentCache:i}=e,o=`${this.formatDateISO(t)}-${n}-${a.length}`;if(i.has(o))return i.get(o);const r=[],c=new Date(t);c.setDate(t.getDate()+n-1),a.forEach(e=>{if(e.end<t||e.start>c)return;const n=this.splitEventIntoWeekSegments(e,t,c,s.firstDayOfWeek);r.push(...n)});const l=this.assignRowPositions(r,s.firstDayOfWeek);if(i.size>10){const e=i.keys().next().value;i.delete(e)}return i.set(o,l),l},splitEventIntoWeekSegments(e,t,n,a){const s=[],i=new Date(Math.max(e.start.getTime(),t.getTime())),o=new Date(Math.min(e.end.getTime(),n.getTime()));let r=new Date(i);for(;r<=o;){const t=this.getEndOfWeek(r,a),n=new Date(Math.min(t.getTime(),o.getTime())),i=Math.floor((n-r)/864e5)+1,c=(r.getDay()-a+7)%7;s.push({event:e,eventId:e.id,start:new Date(r),end:new Date(n),isStart:this.isSameDay(r,e.start),isEnd:this.isSameDay(n,e.end),spanDays:i,dayOffset:c,row:-1}),r=new Date(t),r.setDate(r.getDate()+1)}return s},getEndOfWeek(e,t){const n=new Date(e),a=(6-n.getDay()+t)%7;return n.setDate(n.getDate()+a),n},assignRowPositions(e,t){const n=new Map;return e.forEach(e=>{const a=this.getWeekKey(e.start,t);n.has(a)||n.set(a,[]),n.get(a).push(e)}),n.forEach(e=>{e.sort((e,t)=>e.dayOffset!==t.dayOffset?e.dayOffset-t.dayOffset:t.spanDays-e.spanDays);const t=[];e.forEach(e=>{let n=0,a=!1;for(;!a;){t[n]||(t[n]=[]);t[n].some(t=>{const n=t.dayOffset,a=t.dayOffset+t.spanDays-1,s=e.dayOffset;return!(e.dayOffset+e.spanDays-1<n||s>a)})?n++:(t[n].push(e),e.row=n,a=!0)}})}),e},getWeekKey(e,t){const n=this.getStartOfWeek(e,t);return this.formatDateISO(n)},getStartOfWeek(e,t){const n=new Date(e),a=(n.getDay()-t+7)%7;return n.setDate(n.getDate()-a),n},getWeekSegments(e,t){const n=new Date(t);return n.setDate(t.getDate()+6),e.filter(e=>e.start>=t&&e.start<=n)},renderWeekEventBars(e,t,n,a){const{config:s}=e,i=s.maxEventsPerDay;n.sort((e,t)=>e.row-t.row),n.forEach(e=>{if(e.row>=i)return;const n=document.createElement("div");n.className="ec-event-bar",n.dataset.eventId=e.event.id,n.style.left=e.dayOffset/7*100+"%",n.style.width=e.spanDays/7*100+"%",n.style.top=24*e.row+22+"px",n.style.backgroundColor=e.event.color,e.isStart&&n.classList.add("ec-event-start"),e.isEnd&&n.classList.add("ec-event-end");const a=document.createElement("span");a.className="ec-event-title",a.textContent=e.event.title,n.appendChild(a),t.appendChild(n)})},renderWeekView(e){const{contentElement:t,currentDate:n,config:a,events:s}=e,i=this.i18n[a.locale];t.innerHTML="",t.className="ec-content ec-week-view";const o=this.getStartOfWeek(n,a.firstDayOfWeek),r=document.createElement("div");r.className="ec-week-container";const c=document.createElement("div");c.className="ec-allday-section";const l=document.createElement("div");l.className="ec-allday-label",l.textContent=i.allDay,c.appendChild(l);const d=document.createElement("div");d.className="ec-allday-grid";for(let p=0;p<7;p++){const e=new Date(o);e.setDate(o.getDate()+p);const t=document.createElement("div");t.className="ec-week-day-header",this.isSameDay(e,new Date)&&t.classList.add("ec-today"),t.innerHTML=`\n        <div class="ec-week-dayname">${i.dayNamesShort[e.getDay()]}</div>\n        <div class="ec-week-daynum">${e.getDate()}</div>\n      `,d.appendChild(t)}c.appendChild(d);const v=this.calculateSpanningSegments(e,o,7),h=document.createElement("div");h.className="ec-allday-events",this.renderWeekEventBars(e,h,v,o),c.appendChild(h),r.appendChild(c);const m=document.createElement("div");m.className="ec-time-grid";const u=document.createElement("div");u.className="ec-time-labels";for(let p=0;p<24;p++){const e=document.createElement("div");e.className="ec-time-label",e.textContent=`${p.toString().padStart(2,"0")}:00`,u.appendChild(e)}m.appendChild(u);const g=document.createElement("div");g.className="ec-day-columns";for(let p=0;p<7;p++){const t=new Date(o);t.setDate(o.getDate()+p);const n=document.createElement("div");n.className="ec-day-column",n.dataset.date=this.formatDateISO(t);for(let e=0;e<24;e++){const t=document.createElement("div");t.className="ec-hour-slot",t.dataset.hour=e,n.appendChild(t)}const a=this.getEventsForDate(s,t).filter(e=>!e.allDay);this.renderTimedEvents(e,n,a,t),g.appendChild(n)}m.appendChild(g),r.appendChild(m),t.appendChild(r)},renderTimedEvents(e,t,n,a){n.forEach(e=>{const n=e.start.getHours()+e.start.getMinutes()/60,a=e.end.getHours()+e.end.getMinutes()/60,s=Math.max(a-n,.5),i=document.createElement("div");i.className="ec-timed-event",i.dataset.eventId=e.id,i.style.top=48*n+"px",i.style.height=48*s+"px",i.style.backgroundColor=e.color,i.innerHTML=`\n        <div class="ec-event-time">${this.formatTime(e.start)}</div>\n        <div class="ec-event-title">${this.escapeHtml(e.title)}</div>\n      `,t.appendChild(i)})},renderDayView(e){const{contentElement:t,currentDate:n,config:a,events:s}=e,i=this.i18n[a.locale];t.innerHTML="",t.className="ec-content ec-day-view";const o=document.createElement("div");o.className="ec-day-header",o.innerHTML=`\n      <span class="ec-day-name">${i.dayNames[n.getDay()]}</span>\n      <span class="ec-day-date">${n.getDate()}</span>\n      <span class="ec-day-month">${i.monthNames[n.getMonth()]}</span>\n    `,t.appendChild(o);const r=this.getEventsForDate(s,n),c=r.filter(e=>e.allDay),l=r.filter(e=>!e.allDay);if(c.length>0){const e=document.createElement("div");e.className="ec-day-allday",c.forEach(t=>{const n=document.createElement("div");n.className="ec-allday-event",n.dataset.eventId=t.id,n.style.backgroundColor=t.color,n.textContent=t.title,e.appendChild(n)}),t.appendChild(e)}const d=document.createElement("div");d.className="ec-day-time-grid";for(let v=0;v<24;v++){const e=document.createElement("div");e.className="ec-hour-slot",e.dataset.hour=v;const t=document.createElement("div");t.className="ec-hour-label",t.textContent=`${v.toString().padStart(2,"0")}:00`;const n=document.createElement("div");n.className="ec-hour-area",e.appendChild(t),e.appendChild(n),d.appendChild(e)}this.renderTimedEvents(e,d,l,n),t.appendChild(d)},handleDateClick(e,t,n){var a,s,i;const{config:o}=e;if(this.emitEvent("eventcalendar:dateClick",{date:t,instance:e,element:e.element}),o.onDateClick)if("function"==typeof o.onDateClick)o.onDateClick(t,e);else if("string"==typeof o.onDateClick){const n=(null==(i=null==(s=null==(a=window.Utils)?void 0:a.object)?void 0:s.get)?void 0:i.call(s,window,o.onDateClick))??o.onDateClick.split(".").reduce((e,t)=>null==e?void 0:e[t],window);"function"==typeof n&&n(t,e)}},handleEventClick(e,t,n){var a,s,i;n.stopPropagation();const{config:o}=e;if(this.emitEvent("eventcalendar:eventClick",{event:t,instance:e,element:e.element}),o.onEventClickApi){const n=o.onEventClickApi.replace("{id}",t.id);(async()=>{try{let a;if(window.ApiService&&"function"==typeof ApiService.get)a=await ApiService.get(n);else{const e=await fetch(n);a=await e.json()}window.ResponseHandler&&ResponseHandler.process(a,{element:e.element,data:t})}catch(a){console.error("[EventCalendar] Event click API error:",a)}})()}if(o.onEventClick)if("function"==typeof o.onEventClick)o.onEventClick(t,e);else if("string"==typeof o.onEventClick){const n=(null==(i=null==(s=null==(a=window.Utils)?void 0:a.object)?void 0:s.get)?void 0:i.call(s,window,o.onEventClick))??o.onEventClick.split(".").reduce((e,t)=>null==e?void 0:e[t],window);"function"==typeof n&&n(t,e)}},showDayDetailModal(e,t,n){const{config:a}=e,s=this.i18n[a.locale],i=n.map(e=>`\n      <div class="ec-modal-event" data-event-id="${e.id}" style="border-left-color: ${e.color}">\n        <div class="ec-modal-event-title">${this.escapeHtml(e.title)}</div>\n        ${e.allDay?`<div class="ec-modal-event-time">${s.allDay}</div>`:`<div class="ec-modal-event-time">${this.formatTime(e.start)} - ${this.formatTime(e.end)}</div>`}\n        ${e.location?`<div class="ec-modal-event-location">${this.escapeHtml(e.location)}</div>`:""}\n      </div>\n    `).join(""),o=`\n      <div class="ec-day-modal">\n        <div class="ec-day-modal-date">\n          <span class="ec-day-name">${s.dayNames[t.getDay()]}</span>\n          <span class="ec-day-num">${t.getDate()}</span>\n          <span class="ec-month-name">${s.monthNames[t.getMonth()]}</span>\n        </div>\n        <div class="ec-modal-events">\n          ${n.length>0?i:`<div class="ec-no-events">${s.noEvents}</div>`}\n        </div>\n      </div>\n    `;this.showModal(o,{title:this.formatDate(t,a.locale),onEventClick:t=>{const a=n.find(e=>e.id===t);a&&this.handleEventClick(e,a,{stopPropagation:()=>{}})}})},showEventsModal(e,t,n){this.showDayDetailModal(e,t,n)},showModal(e,t={}){if(window.Modal){const n=new Modal({title:t.title||"",content:e,size:"medium",backdrop:!0,closeOnBackdrop:!0});n.show(),t.onEventClick&&n.element.querySelectorAll(".ec-modal-event").forEach(e=>{e.addEventListener("click",()=>{t.onEventClick(e.dataset.eventId),n.hide()})})}else window.DialogManager&&DialogManager.show({title:t.title||"",content:e,buttons:[{text:"Close",primary:!0}]})},navigate(e,t){const{currentView:n,currentDate:a}=e;switch(n){case"day":a.setDate(a.getDate()+t);break;case"week":a.setDate(a.getDate()+7*t);break;case"month":a.setMonth(a.getMonth()+t)}e.config.api?this.loadEvents(e):this.render(e),this.emitEvent("eventcalendar:navigate",{date:new Date(a),view:n,instance:e})},goToToday(e){e.currentDate=new Date,e.config.api?this.loadEvents(e):this.render(e),this.emitEvent("eventcalendar:today",{date:new Date,instance:e})},changeView(e,t){e.config.views.includes(t)&&(e.currentView=t,this.render(e),this.emitEvent("eventcalendar:viewChange",{view:t,instance:e}))},updateCurrentPeriod(e){const{currentDate:t,currentView:n,config:a}=e,s=this.i18n[a.locale];let i="";switch(n){case"day":i=`${t.getDate()} ${s.monthNames[t.getMonth()]} ${t.getFullYear()}`;break;case"week":const e=this.getStartOfWeek(t,a.firstDayOfWeek),n=new Date(e);n.setDate(e.getDate()+6),i=`${e.getDate()} - ${n.getDate()} ${s.monthNames[n.getMonth()]} ${n.getFullYear()}`;break;case"month":i=`${s.monthNames[t.getMonth()]} ${t.getFullYear()}`}e.currentPeriodElement&&(e.currentPeriodElement.textContent=i)},updateViewSwitcher(e){e.viewSwitcherElement&&e.viewSwitcherElement.querySelectorAll(".ec-view-btn").forEach(t=>{t.classList.toggle("active",t.dataset.view===e.currentView)})},getEventsForDate:(e,t)=>e.filter(e=>{const n=new Date(e.start),a=new Date(e.end),s=new Date(t);s.setHours(0,0,0,0);const i=new Date(n);i.setHours(0,0,0,0);const o=new Date(a);return o.setHours(0,0,0,0),s>=i&&s<=o}),getViewDateRange(e){const{currentDate:t,currentView:n,config:a}=e;let s,i;switch(n){case"day":s=new Date(t),s.setHours(0,0,0,0),i=new Date(t),i.setHours(23,59,59,999);break;case"week":s=this.getStartOfWeek(t,a.firstDayOfWeek),i=new Date(s),i.setDate(s.getDate()+6),i.setHours(23,59,59,999);break;case"month":s=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0),i.setHours(23,59,59,999);const e=(s.getDay()-a.firstDayOfWeek+7)%7;s.setDate(s.getDate()-e);const n=(6-i.getDay()+a.firstDayOfWeek)%7;i.setDate(i.getDate()+n)}return{start:s,end:i}},isSameDay:(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),formatDateISO(e){const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},formatDate(e,t="en"){const n=this.i18n[t]||this.i18n.en;return`${e.getDate()} ${n.monthNames[e.getMonth()]} ${e.getFullYear()}`},formatTime:e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML},emitEvent(e,t){EventManager.emit(e,t);const n=new CustomEvent(e,{detail:t,bubbles:!0});document.dispatchEvent(n)},addEvent(e,t){const n=this.getInstance(e);if(!n)return;const a=this.normalizeEvents([t])[0];n.events.push(a),n.segmentCache.clear(),this.render(n),this.emitEvent("eventcalendar:eventAdd",{event:a,instance:n})},removeEvent(e,t){const n=this.getInstance(e);n&&(n.events=n.events.filter(e=>e.id!==t),n.segmentCache.clear(),this.render(n),this.emitEvent("eventcalendar:eventRemove",{eventId:t,instance:n}))},updateEvent(e,t,n){const a=this.getInstance(e);if(!a)return;const s=a.events.findIndex(e=>e.id===t);-1!==s&&(a.events[s]={...a.events[s],...n},a.segmentCache.clear(),this.render(a),this.emitEvent("eventcalendar:eventUpdate",{event:a.events[s],instance:a}))},getEvents(e,t=null,n=null){const a=this.getInstance(e);if(!a)return[];let s=[...a.events];return t&&n&&(s=s.filter(e=>e.start<=n&&e.end>=t)),s},refreshEvents(e){const t=this.getInstance(e);t&&t.config.api&&this.loadEvents(t)},setEvents(e,t){const n=this.getInstance(e);n&&(n.events=this.normalizeEvents(t),n.segmentCache.clear(),this.render(n))},getInstance:e=>e&&e.element?e:("string"==typeof e&&(e=document.querySelector(e)),(null==e?void 0:e._eventCalendar)||null),destroy(e){const t=this.getInstance(e);if(!t)return;const{element:n}=t;t.eventListeners&&t.eventListeners.length>0&&(t.eventListeners.forEach(({element:e,event:t,handler:n,options:a})=>{e.removeEventListener(t,n,a)}),t.eventListeners=[]),t.updateTimer&&clearInterval(t.updateTimer),n.innerHTML="",n.classList.remove("event-calendar"),delete n._eventCalendar,this.state.instances.delete(n),this.emitEvent("eventcalendar:destroy",{element:n})}};(null==(e=window.Now)?void 0:e.registerManager)&&Now.registerManager("eventCalendar",t),window.EventCalendar=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t.state.initialized||t.init()}):t.state.initialized||t.init()}();
//# sourceMappingURL=eventcalendar.min.js.map
