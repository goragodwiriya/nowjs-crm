{"version":3,"file":"richtext-editor.min.js","sources":["../../js/components/editor/core/EventBus.js","../../js/components/editor/core/CommandManager.js","../../js/components/editor/core/HistoryManager.js","../../js/components/editor/core/SelectionManager.js","../../js/components/editor/core/KeyboardManager.js","../../js/components/editor/ui/Toolbar.js","../../js/components/editor/ui/ContentArea.js","../../js/components/editor/RichTextEditor.js","../../js/components/editor/plugins/PluginBase.js","../../js/components/editor/ui/dialogs/BaseDialog.js","../../js/components/editor/plugins/media/LinkPlugin.js","../../js/components/editor/plugins/media/ImagePlugin.js","../../js/components/editor/plugins/media/TablePlugin.js","../../js/components/editor/plugins/media/VideoPlugin.js","../../js/components/editor/plugins/media/EmojiPlugin.js","../../js/components/editor/plugins/media/SpecialCharsPlugin.js","../../js/components/editor/plugins/utility/SourceViewPlugin.js","../../js/components/editor/plugins/utility/FullscreenPlugin.js","../../js/components/editor/plugins/utility/AutosavePlugin.js","../../js/components/editor/plugins/utility/WordCountPlugin.js","../../js/components/editor/plugins/utility/FindReplacePlugin.js","../../js/components/editor/plugins/utility/MaxLengthPlugin.js","../../js/components/editor/plugins/utility/MentionPlugin.js","../../js/components/editor/configs/profiles.js","../../js/components/editor/configs/defaults.js","../../js/components/editor/index.js","../../js/components/editor/plugins/filebrowser/FileBrowser.js","../../js/components/editor/entry-editor.js"],"sourcesContent":["/**\n * EventBus - Central event system for RichTextEditor\n * Provides pub/sub communication between editor components and plugins\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nclass EventBus {\n  constructor() {\n    this.listeners = new Map();\n    this.onceListeners = new Map();\n  }\n\n  /**\n   * Subscribe to an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   * @param {Object} context - Context for callback (optional)\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback, context = null) {\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n\n    const listener = {callback, context};\n    this.listeners.get(event).push(listener);\n\n    // Return unsubscribe function\n    return () => this.off(event, callback);\n  }\n\n  /**\n   * Subscribe to an event (fires only once)\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   * @param {Object} context - Context for callback (optional)\n   * @returns {Function} Unsubscribe function\n   */\n  once(event, callback, context = null) {\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    if (!this.onceListeners.has(event)) {\n      this.onceListeners.set(event, []);\n    }\n\n    const listener = {callback, context};\n    this.onceListeners.get(event).push(listener);\n\n    return () => {\n      const listeners = this.onceListeners.get(event);\n      if (listeners) {\n        const index = listeners.findIndex(l => l.callback === callback);\n        if (index !== -1) {\n          listeners.splice(index, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function to remove\n   */\n  off(event, callback) {\n    const listeners = this.listeners.get(event);\n    if (listeners) {\n      const index = listeners.findIndex(l => l.callback === callback);\n      if (index !== -1) {\n        listeners.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param {string} event - Event name\n   * @param {...any} args - Arguments to pass to listeners\n   */\n  emit(event, ...args) {\n    // Regular listeners\n    const listeners = this.listeners.get(event);\n    if (listeners) {\n      listeners.forEach(({callback, context}) => {\n        try {\n          callback.apply(context, args);\n        } catch (error) {\n          console.error(`Error in event listener for \"${event}\":`, error);\n        }\n      });\n    }\n\n    // Once listeners\n    const onceListeners = this.onceListeners.get(event);\n    if (onceListeners && onceListeners.length > 0) {\n      const listenersToCall = [...onceListeners];\n      this.onceListeners.set(event, []);\n\n      listenersToCall.forEach(({callback, context}) => {\n        try {\n          callback.apply(context, args);\n        } catch (error) {\n          console.error(`Error in once listener for \"${event}\":`, error);\n        }\n      });\n    }\n  }\n\n  /**\n   * Remove all listeners for an event or all events\n   * @param {string} event - Event name (optional, removes all if not specified)\n   */\n  removeAllListeners(event = null) {\n    if (event) {\n      this.listeners.delete(event);\n      this.onceListeners.delete(event);\n    } else {\n      this.listeners.clear();\n      this.onceListeners.clear();\n    }\n  }\n\n  /**\n   * Get listener count for an event\n   * @param {string} event - Event name\n   * @returns {number} Number of listeners\n   */\n  listenerCount(event) {\n    const regular = this.listeners.get(event)?.length || 0;\n    const once = this.onceListeners.get(event)?.length || 0;\n    return regular + once;\n  }\n\n  /**\n   * Check if event has listeners\n   * @param {string} event - Event name\n   * @returns {boolean}\n   */\n  hasListeners(event) {\n    return this.listenerCount(event) > 0;\n  }\n\n  /**\n   * Destroy event bus\n   */\n  destroy() {\n    this.removeAllListeners();\n  }\n}\n\n// Event name constants\nEventBus.Events = {\n  // Editor lifecycle\n  EDITOR_INIT: 'editor:init',\n  EDITOR_READY: 'editor:ready',\n  EDITOR_DESTROY: 'editor:destroy',\n  EDITOR_FOCUS: 'editor:focus',\n  EDITOR_BLUR: 'editor:blur',\n\n  // Content events\n  CONTENT_CHANGE: 'content:change',\n  CONTENT_BEFORE_CHANGE: 'content:beforeChange',\n  CONTENT_PASTE: 'content:paste',\n  CONTENT_SET: 'content:set',\n\n  // Command events\n  COMMAND_EXECUTE: 'command:execute',\n  COMMAND_BEFORE_EXECUTE: 'command:beforeExecute',\n  COMMAND_UNDO: 'command:undo',\n  COMMAND_REDO: 'command:redo',\n\n  // Selection events\n  SELECTION_CHANGE: 'selection:change',\n\n  // Toolbar events\n  TOOLBAR_UPDATE: 'toolbar:update',\n  TOOLBAR_BUTTON_CLICK: 'toolbar:buttonClick',\n\n  // Plugin events\n  PLUGIN_LOAD: 'plugin:load',\n  PLUGIN_UNLOAD: 'plugin:unload',\n\n  // Dialog events\n  DIALOG_OPEN: 'dialog:open',\n  DIALOG_CLOSE: 'dialog:close',\n\n  // Mode events\n  MODE_CHANGE: 'mode:change',\n\n  // History events\n  HISTORY_CHANGE: 'history:change',\n  HISTORY_SNAPSHOT: 'history:snapshot',\n\n  // Autosave events\n  AUTOSAVE_START: 'autosave:start',\n  AUTOSAVE_SUCCESS: 'autosave:success',\n  AUTOSAVE_ERROR: 'autosave:error'\n};\n\nexport default EventBus;\n","/**\n * CommandManager - Editor command execution system\n * Replaces deprecated document.execCommand with modern approach\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from './EventBus.js';\n\nclass CommandManager {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   */\n  constructor(editor) {\n    this.editor = editor;\n    this.commands = new Map();\n    this.registerBuiltInCommands();\n  }\n\n  /**\n   * Register built-in commands\n   */\n  registerBuiltInCommands() {\n    // Text formatting\n    this.register('bold', {\n      execute: () => this.execNative('bold'),\n      isActive: () => document.queryCommandState('bold'),\n      shortcut: 'Ctrl+B'\n    });\n\n    this.register('italic', {\n      execute: () => this.execNative('italic'),\n      isActive: () => document.queryCommandState('italic'),\n      shortcut: 'Ctrl+I'\n    });\n\n    this.register('underline', {\n      execute: () => this.execNative('underline'),\n      isActive: () => document.queryCommandState('underline'),\n      shortcut: 'Ctrl+U'\n    });\n\n    this.register('strikethrough', {\n      execute: () => this.execNative('strikeThrough'),\n      isActive: () => document.queryCommandState('strikeThrough')\n    });\n\n    // Block formatting\n    this.register('heading', {\n      execute: (level) => this.formatBlock(`h${level}`),\n      isActive: (level) => this.isBlockType(`h${level}`)\n    });\n\n    this.register('paragraph', {\n      execute: () => this.formatBlock('p'),\n      isActive: () => this.isBlockType('p')\n    });\n\n    this.register('blockquote', {\n      execute: () => this.formatBlock('blockquote'),\n      isActive: () => this.isBlockType('blockquote')\n    });\n\n    this.register('pre', {\n      execute: () => this.formatBlock('pre'),\n      isActive: () => this.isBlockType('pre')\n    });\n\n    // Lists\n    this.register('insertOrderedList', {\n      execute: () => this.execNative('insertOrderedList'),\n      isActive: () => document.queryCommandState('insertOrderedList'),\n      shortcut: 'Ctrl+Shift+O'\n    });\n\n    this.register('insertUnorderedList', {\n      execute: () => this.execNative('insertUnorderedList'),\n      isActive: () => document.queryCommandState('insertUnorderedList'),\n      shortcut: 'Ctrl+Shift+L'\n    });\n\n    // Alignment\n    this.register('justifyLeft', {\n      execute: () => this.execNative('justifyLeft'),\n      isActive: () => document.queryCommandState('justifyLeft')\n    });\n\n    this.register('justifyCenter', {\n      execute: () => this.execNative('justifyCenter'),\n      isActive: () => document.queryCommandState('justifyCenter')\n    });\n\n    this.register('justifyRight', {\n      execute: () => this.execNative('justifyRight'),\n      isActive: () => document.queryCommandState('justifyRight')\n    });\n\n    this.register('justifyFull', {\n      execute: () => this.execNative('justifyFull'),\n      isActive: () => document.queryCommandState('justifyFull')\n    });\n\n    // Indentation\n    this.register('indent', {\n      execute: () => this.execNative('indent'),\n      shortcut: 'Tab'\n    });\n\n    this.register('outdent', {\n      execute: () => this.execNative('outdent'),\n      shortcut: 'Shift+Tab'\n    });\n\n    // Insert commands\n    this.register('insertHorizontalRule', {\n      execute: () => this.execNative('insertHorizontalRule')\n    });\n\n    this.register('createLink', {\n      execute: (url) => {\n        if (url) {\n          this.execNative('createLink', url);\n        }\n      },\n      shortcut: 'Ctrl+K'\n    });\n\n    this.register('unlink', {\n      execute: () => this.execNative('unlink')\n    });\n\n    this.register('insertImage', {\n      execute: (url) => {\n        if (url) {\n          this.execNative('insertImage', url);\n        }\n      }\n    });\n\n    this.register('insertHTML', {\n      execute: (html) => {\n        if (html) {\n          this.editor.selection?.insertHtml(html);\n        }\n      }\n    });\n\n    this.register('insertText', {\n      execute: (text) => {\n        if (text) {\n          this.editor.selection?.insertText(text);\n        }\n      }\n    });\n\n    // Color commands\n    this.register('foreColor', {\n      execute: (color) => this.execNative('foreColor', color),\n      getValue: () => document.queryCommandValue('foreColor')\n    });\n\n    this.register('backColor', {\n      execute: (color) => this.execNative('backColor', color),\n      getValue: () => document.queryCommandValue('backColor')\n    });\n\n    // Utility commands\n    this.register('removeFormat', {\n      execute: () => this.execNative('removeFormat')\n    });\n\n    this.register('selectAll', {\n      execute: () => this.editor.selection?.selectAll(),\n      shortcut: 'Ctrl+A'\n    });\n\n    this.register('undo', {\n      execute: () => this.editor.history?.undo(),\n      canExecute: () => this.editor.history?.canUndo() || false,\n      shortcut: 'Ctrl+Z'\n    });\n\n    this.register('redo', {\n      execute: () => this.editor.history?.redo(),\n      canExecute: () => this.editor.history?.canRedo() || false,\n      shortcut: 'Ctrl+Y'\n    });\n  }\n\n  /**\n   * Register a command\n   * @param {string} name - Command name\n   * @param {Object} command - Command definition\n   */\n  register(name, command) {\n    this.commands.set(name, {\n      execute: command.execute,\n      isActive: command.isActive || (() => false),\n      canExecute: command.canExecute || (() => true),\n      getValue: command.getValue || (() => null),\n      shortcut: command.shortcut || null\n    });\n  }\n\n  /**\n   * Unregister a command\n   * @param {string} name - Command name\n   */\n  unregister(name) {\n    this.commands.delete(name);\n  }\n\n  /**\n   * Execute a command\n   * @param {string} name - Command name\n   * @param {...any} args - Command arguments\n   * @returns {boolean} Success\n   */\n  execute(name, ...args) {\n    const command = this.commands.get(name);\n    if (!command) {\n      console.warn(`Command \"${name}\" not found`);\n      return false;\n    }\n\n    // Check if command can execute\n    if (!command.canExecute(...args)) {\n      return false;\n    }\n\n    // Emit before execute event\n    this.editor.events?.emit(EventBus.Events.COMMAND_BEFORE_EXECUTE, {name, args});\n\n    // Ensure editor is focused\n    if (!this.editor.contentArea?.hasFocus()) {\n      this.editor.selection?.focus();\n    }\n\n    // Save selection before command\n    this.editor.selection?.saveSelection();\n\n    try {\n      // Execute command\n      command.execute(...args);\n\n      // Record history\n      this.editor.history?.record();\n\n      // Emit execute event\n      this.editor.events?.emit(EventBus.Events.COMMAND_EXECUTE, {name, args});\n\n      // Update toolbar state\n      this.editor.events?.emit(EventBus.Events.TOOLBAR_UPDATE);\n\n      return true;\n    } catch (error) {\n      console.error(`Error executing command \"${name}\":`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Execute native document.execCommand\n   * @param {string} command - Command name\n   * @param {string} value - Command value\n   * @returns {boolean}\n   */\n  execNative(command, value = null) {\n    try {\n      return document.execCommand(command, false, value);\n    } catch (e) {\n      console.warn(`Native command \"${command}\" failed:`, e);\n      return false;\n    }\n  }\n\n  /**\n   * Format block element\n   * @param {string} tagName - Tag name\n   */\n  formatBlock(tagName) {\n    const normalized = tagName.toLowerCase();\n\n    // Check if already in this block type\n    if (this.isBlockType(normalized)) {\n      // Convert back to paragraph\n      this.execNative('formatBlock', '<p>');\n    } else {\n      this.execNative('formatBlock', `<${normalized}>`);\n    }\n  }\n\n  /**\n   * Check if current selection is in block type\n   * @param {string} tagName - Tag name\n   * @returns {boolean}\n   */\n  isBlockType(tagName) {\n    const block = this.editor.selection?.getParentBlock();\n    return block && block.tagName.toLowerCase() === tagName.toLowerCase();\n  }\n\n  /**\n   * Check if command is active\n   * @param {string} name - Command name\n   * @param {...any} args - Command arguments\n   * @returns {boolean}\n   */\n  isActive(name, ...args) {\n    const command = this.commands.get(name);\n    if (!command || typeof command.isActive !== 'function') {\n      return false;\n    }\n\n    try {\n      return command.isActive(...args);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Check if command can execute\n   * @param {string} name - Command name\n   * @param {...any} args - Command arguments\n   * @returns {boolean}\n   */\n  canExecute(name, ...args) {\n    const command = this.commands.get(name);\n    if (!command) return false;\n\n    try {\n      return command.canExecute(...args);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Get command value\n   * @param {string} name - Command name\n   * @returns {*}\n   */\n  getValue(name) {\n    const command = this.commands.get(name);\n    if (!command || typeof command.getValue !== 'function') {\n      return null;\n    }\n\n    try {\n      return command.getValue();\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * Get command shortcut\n   * @param {string} name - Command name\n   * @returns {string|null}\n   */\n  getShortcut(name) {\n    const command = this.commands.get(name);\n    return command?.shortcut || null;\n  }\n\n  /**\n   * Get all command names\n   * @returns {string[]}\n   */\n  getCommandNames() {\n    return Array.from(this.commands.keys());\n  }\n\n  /**\n   * Check if command exists\n   * @param {string} name - Command name\n   * @returns {boolean}\n   */\n  hasCommand(name) {\n    return this.commands.has(name);\n  }\n\n  /**\n   * Get current formatting state\n   * @returns {Object}\n   */\n  getFormattingState() {\n    return {\n      bold: this.isActive('bold'),\n      italic: this.isActive('italic'),\n      underline: this.isActive('underline'),\n      strikethrough: this.isActive('strikethrough'),\n      orderedList: this.isActive('insertOrderedList'),\n      unorderedList: this.isActive('insertUnorderedList'),\n      justifyLeft: this.isActive('justifyLeft'),\n      justifyCenter: this.isActive('justifyCenter'),\n      justifyRight: this.isActive('justifyRight'),\n      justifyFull: this.isActive('justifyFull'),\n      foreColor: this.getValue('foreColor'),\n      backColor: this.getValue('backColor')\n    };\n  }\n\n  /**\n   * Destroy command manager\n   */\n  destroy() {\n    this.commands.clear();\n  }\n}\n\nexport default CommandManager;\n","/**\n * HistoryManager - Undo/Redo stack management\n * Records content snapshots and allows navigation through history\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from './EventBus.js';\n\nclass HistoryManager {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   * @param {Object} options - Configuration options\n   */\n  constructor(editor, options = {}) {\n    this.editor = editor;\n    this.options = {\n      maxHistory: 100,\n      debounceDelay: 300,\n      ...options\n    };\n\n    this.undoStack = [];\n    this.redoStack = [];\n    this.currentState = null;\n    this.debounceTimer = null;\n    this.isRecording = true;\n    this.batchLevel = 0;\n    this.batchState = null;\n  }\n\n  /**\n   * Initialize history with current content\n   */\n  init() {\n    const content = this.editor.contentArea?.getContent() || '';\n    this.currentState = this.createSnapshot(content);\n    this.undoStack = [];\n    this.redoStack = [];\n  }\n\n  /**\n   * Create a snapshot of the current state\n   * @param {string} content - HTML content\n   * @returns {Object} Snapshot object\n   */\n  createSnapshot(content) {\n    return {\n      content,\n      timestamp: Date.now(),\n      selection: this.editor.selection?.saveSelection()\n    };\n  }\n\n  /**\n   * Record current state (debounced)\n   * @param {boolean} force - Force immediate recording\n   */\n  record(force = false) {\n    if (!this.isRecording || this.batchLevel > 0) return;\n\n    if (this.debounceTimer) {\n      clearTimeout(this.debounceTimer);\n    }\n\n    if (force) {\n      this.recordImmediate();\n    } else {\n      this.debounceTimer = setTimeout(() => {\n        this.recordImmediate();\n      }, this.options.debounceDelay);\n    }\n  }\n\n  /**\n   * Record state immediately\n   */\n  recordImmediate() {\n    const content = this.editor.contentArea?.getContent() || '';\n\n    // Don't record if content hasn't changed\n    if (this.currentState && this.currentState.content === content) {\n      return;\n    }\n\n    // Push current state to undo stack\n    if (this.currentState) {\n      this.undoStack.push(this.currentState);\n\n      // Limit stack size\n      if (this.undoStack.length > this.options.maxHistory) {\n        this.undoStack.shift();\n      }\n    }\n\n    // Create new current state\n    this.currentState = this.createSnapshot(content);\n\n    // Clear redo stack on new action\n    this.redoStack = [];\n\n    // Emit event\n    this.editor.events?.emit(EventBus.Events.HISTORY_CHANGE, {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    });\n\n    this.editor.events?.emit(EventBus.Events.HISTORY_SNAPSHOT, this.currentState);\n  }\n\n  /**\n   * Start batch operation (changes won't be recorded individually)\n   */\n  startBatch() {\n    if (this.batchLevel === 0) {\n      this.batchState = this.currentState;\n    }\n    this.batchLevel++;\n  }\n\n  /**\n   * End batch operation\n   */\n  endBatch() {\n    this.batchLevel--;\n    if (this.batchLevel === 0) {\n      this.recordImmediate();\n    }\n  }\n\n  /**\n   * Execute function as batch (single undo point)\n   * @param {Function} fn - Function to execute\n   */\n  batch(fn) {\n    this.startBatch();\n    try {\n      fn();\n    } finally {\n      this.endBatch();\n    }\n  }\n\n  /**\n   * Check if undo is available\n   * @returns {boolean}\n   */\n  canUndo() {\n    return this.undoStack.length > 0;\n  }\n\n  /**\n   * Check if redo is available\n   * @returns {boolean}\n   */\n  canRedo() {\n    return this.redoStack.length > 0;\n  }\n\n  /**\n   * Undo last action\n   * @returns {boolean} Success\n   */\n  undo() {\n    if (!this.canUndo()) return false;\n\n    // Record current state if changed\n    const currentContent = this.editor.contentArea?.getContent() || '';\n    if (this.currentState && this.currentState.content !== currentContent) {\n      this.currentState = this.createSnapshot(currentContent);\n    }\n\n    // Push current state to redo stack\n    if (this.currentState) {\n      this.redoStack.push(this.currentState);\n    }\n\n    // Pop from undo stack\n    this.currentState = this.undoStack.pop();\n\n    // Restore content\n    this.isRecording = false;\n    this.editor.contentArea?.setContent(this.currentState.content);\n\n    // Restore selection\n    if (this.currentState.selection) {\n      this.editor.selection.savedSelection = this.currentState.selection;\n      this.editor.selection.restoreSelection();\n    }\n    this.isRecording = true;\n\n    // Emit events\n    this.editor.events?.emit(EventBus.Events.COMMAND_UNDO, this.currentState);\n    this.editor.events?.emit(EventBus.Events.HISTORY_CHANGE, {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    });\n\n    return true;\n  }\n\n  /**\n   * Redo last undone action\n   * @returns {boolean} Success\n   */\n  redo() {\n    if (!this.canRedo()) return false;\n\n    // Push current state to undo stack\n    if (this.currentState) {\n      this.undoStack.push(this.currentState);\n    }\n\n    // Pop from redo stack\n    this.currentState = this.redoStack.pop();\n\n    // Restore content\n    this.isRecording = false;\n    this.editor.contentArea?.setContent(this.currentState.content);\n\n    // Restore selection\n    if (this.currentState.selection) {\n      this.editor.selection.savedSelection = this.currentState.selection;\n      this.editor.selection.restoreSelection();\n    }\n    this.isRecording = true;\n\n    // Emit events\n    this.editor.events?.emit(EventBus.Events.COMMAND_REDO, this.currentState);\n    this.editor.events?.emit(EventBus.Events.HISTORY_CHANGE, {\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    });\n\n    return true;\n  }\n\n  /**\n   * Clear all history\n   */\n  clear() {\n    this.undoStack = [];\n    this.redoStack = [];\n    this.currentState = this.createSnapshot(this.editor.contentArea?.getContent() || '');\n\n    this.editor.events?.emit(EventBus.Events.HISTORY_CHANGE, {\n      canUndo: false,\n      canRedo: false\n    });\n  }\n\n  /**\n   * Pause recording\n   */\n  pause() {\n    this.isRecording = false;\n  }\n\n  /**\n   * Resume recording\n   */\n  resume() {\n    this.isRecording = true;\n  }\n\n  /**\n   * Get history info\n   * @returns {Object}\n   */\n  getInfo() {\n    return {\n      undoCount: this.undoStack.length,\n      redoCount: this.redoStack.length,\n      canUndo: this.canUndo(),\n      canRedo: this.canRedo()\n    };\n  }\n\n  /**\n   * Destroy history manager\n   */\n  destroy() {\n    if (this.debounceTimer) {\n      clearTimeout(this.debounceTimer);\n    }\n    this.undoStack = [];\n    this.redoStack = [];\n    this.currentState = null;\n  }\n}\n\nexport default HistoryManager;\n","/**\n * SelectionManager - Text selection and range management\n * Handles saving, restoring, and manipulating text selections\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nclass SelectionManager {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   */\n  constructor(editor) {\n    this.editor = editor;\n    this.savedSelection = null;\n  }\n\n  /**\n   * Get current selection\n   * @returns {Selection|null}\n   */\n  getSelection() {\n    return window.getSelection();\n  }\n\n  /**\n   * Get current range\n   * @returns {Range|null}\n   */\n  getRange() {\n    const selection = this.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      return selection.getRangeAt(0);\n    }\n    return null;\n  }\n\n  /**\n   * Check if selection is within editor\n   * @returns {boolean}\n   */\n  isWithinEditor() {\n    const range = this.getRange();\n    if (!range || !this.editor.contentArea) return false;\n\n    const container = this.editor.contentArea.getElement();\n    return container && container.contains(range.commonAncestorContainer);\n  }\n\n  /**\n   * Check if there is a selection (not collapsed)\n   * @returns {boolean}\n   */\n  hasSelection() {\n    const range = this.getRange();\n    return range && !range.collapsed;\n  }\n\n  /**\n   * Get selected text\n   * @returns {string}\n   */\n  getSelectedText() {\n    const selection = this.getSelection();\n    return selection ? selection.toString() : '';\n  }\n\n  /**\n   * Get selected HTML\n   * @returns {string}\n   */\n  getSelectedHtml() {\n    const range = this.getRange();\n    if (!range) return '';\n\n    const fragment = range.cloneContents();\n    const div = document.createElement('div');\n    div.appendChild(fragment);\n    return div.innerHTML;\n  }\n\n  /**\n   * Save current selection state\n   * @returns {Object|null}\n   */\n  saveSelection() {\n    const range = this.getRange();\n    if (!range || !this.isWithinEditor()) {\n      return null;\n    }\n\n    this.savedSelection = {\n      startContainer: range.startContainer,\n      startOffset: range.startOffset,\n      endContainer: range.endContainer,\n      endOffset: range.endOffset,\n      collapsed: range.collapsed\n    };\n\n    return this.savedSelection;\n  }\n\n  /**\n   * Restore saved selection\n   * @returns {boolean} Success\n   */\n  restoreSelection() {\n    if (!this.savedSelection) return false;\n\n    try {\n      const selection = this.getSelection();\n      const range = document.createRange();\n\n      range.setStart(this.savedSelection.startContainer, this.savedSelection.startOffset);\n      range.setEnd(this.savedSelection.endContainer, this.savedSelection.endOffset);\n\n      selection.removeAllRanges();\n      selection.addRange(range);\n\n      return true;\n    } catch (e) {\n      console.warn('Failed to restore selection:', e);\n      return false;\n    }\n  }\n\n  /**\n   * Clear saved selection\n   */\n  clearSavedSelection() {\n    this.savedSelection = null;\n  }\n\n  /**\n   * Select all content in editor\n   */\n  selectAll() {\n    const container = this.editor.contentArea?.getElement();\n    if (!container) return;\n\n    const range = document.createRange();\n    range.selectNodeContents(container);\n\n    const selection = this.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  /**\n   * Collapse selection to start\n   */\n  collapseToStart() {\n    const selection = this.getSelection();\n    if (selection) {\n      selection.collapseToStart();\n    }\n  }\n\n  /**\n   * Collapse selection to end\n   */\n  collapseToEnd() {\n    const selection = this.getSelection();\n    if (selection) {\n      selection.collapseToEnd();\n    }\n  }\n\n  /**\n   * Set cursor position at end of element\n   * @param {HTMLElement} element\n   */\n  setCursorAtEnd(element) {\n    const range = document.createRange();\n    const selection = this.getSelection();\n\n    range.selectNodeContents(element);\n    range.collapse(false);\n\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  /**\n   * Set cursor position at start of element\n   * @param {HTMLElement} element\n   */\n  setCursorAtStart(element) {\n    const range = document.createRange();\n    const selection = this.getSelection();\n\n    range.selectNodeContents(element);\n    range.collapse(true);\n\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }\n\n  /**\n   * Insert HTML at cursor position\n   * @param {string} html - HTML to insert\n   */\n  insertHtml(html) {\n    const container = this.editor.contentArea?.getElement();\n    if (!container) return;\n\n    let range = this.getRange();\n\n    // If no range or not within editor, create one at end of content\n    if (!range || !this.isWithinEditor()) {\n      // Focus the editor first\n      container.focus();\n\n      // Create a range at the end of content\n      range = document.createRange();\n      if (container.lastChild) {\n        range.setStartAfter(container.lastChild);\n      } else {\n        range.setStart(container, 0);\n      }\n      range.collapse(true);\n\n      const selection = this.getSelection();\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n\n    range.deleteContents();\n\n    const fragment = document.createRange().createContextualFragment(html);\n    const lastNode = fragment.lastChild;\n\n    range.insertNode(fragment);\n\n    // Move cursor after inserted content\n    if (lastNode) {\n      const newRange = document.createRange();\n      newRange.setStartAfter(lastNode);\n      newRange.collapse(true);\n\n      const selection = this.getSelection();\n      selection.removeAllRanges();\n      selection.addRange(newRange);\n    }\n  }\n\n  /**\n   * Insert text at cursor position\n   * @param {string} text - Text to insert\n   */\n  insertText(text) {\n    const range = this.getRange();\n    if (!range || !this.isWithinEditor()) return;\n\n    range.deleteContents();\n\n    const textNode = document.createTextNode(text);\n    range.insertNode(textNode);\n\n    // Move cursor after inserted text\n    const newRange = document.createRange();\n    newRange.setStartAfter(textNode);\n    newRange.collapse(true);\n\n    const selection = this.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  /**\n   * Wrap selection with element\n   * @param {string} tagName - Tag name to wrap with\n   * @param {Object} attributes - Attributes for the element\n   * @returns {HTMLElement|null} Created element\n   */\n  wrapSelection(tagName, attributes = {}) {\n    const range = this.getRange();\n    if (!range || range.collapsed || !this.isWithinEditor()) return null;\n\n    const wrapper = document.createElement(tagName);\n    Object.entries(attributes).forEach(([key, value]) => {\n      wrapper.setAttribute(key, value);\n    });\n\n    try {\n      range.surroundContents(wrapper);\n      return wrapper;\n    } catch (e) {\n      // surroundContents fails if selection spans multiple elements\n      // Use alternative approach\n      const fragment = range.extractContents();\n      wrapper.appendChild(fragment);\n      range.insertNode(wrapper);\n      return wrapper;\n    }\n  }\n\n  /**\n   * Unwrap selection from element\n   * @param {string} tagName - Tag name to unwrap\n   */\n  unwrapSelection(tagName) {\n    const range = this.getRange();\n    if (!range || !this.isWithinEditor()) return;\n\n    const container = range.commonAncestorContainer;\n    const element = container.nodeType === Node.ELEMENT_NODE\n      ? container\n      : container.parentElement;\n\n    const target = element.closest(tagName);\n    if (target && this.editor.contentArea?.getElement().contains(target)) {\n      const parent = target.parentNode;\n      while (target.firstChild) {\n        parent.insertBefore(target.firstChild, target);\n      }\n      parent.removeChild(target);\n    }\n  }\n\n  /**\n   * Get parent block element of selection\n   * @returns {HTMLElement|null}\n   */\n  getParentBlock() {\n    const range = this.getRange();\n    if (!range) return null;\n\n    const blockTags = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'DIV', 'LI', 'BLOCKQUOTE', 'PRE'];\n    let node = range.commonAncestorContainer;\n\n    if (node.nodeType === Node.TEXT_NODE) {\n      node = node.parentElement;\n    }\n\n    while (node && node !== this.editor.contentArea?.getElement()) {\n      if (node.nodeType === Node.ELEMENT_NODE && blockTags.includes(node.tagName)) {\n        return node;\n      }\n      node = node.parentElement;\n    }\n\n    return null;\n  }\n\n  /**\n   * Get nearest ancestor matching selector\n   * @param {string} selector - CSS selector\n   * @returns {HTMLElement|null}\n   */\n  getAncestor(selector) {\n    const range = this.getRange();\n    if (!range) return null;\n\n    let node = range.commonAncestorContainer;\n    if (node.nodeType === Node.TEXT_NODE) {\n      node = node.parentElement;\n    }\n\n    if (node && typeof node.closest === 'function') {\n      const ancestor = node.closest(selector);\n      if (ancestor && this.editor.contentArea?.getElement().contains(ancestor)) {\n        return ancestor;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Check if selection contains element matching selector\n   * @param {string} selector - CSS selector\n   * @returns {boolean}\n   */\n  containsElement(selector) {\n    return this.getAncestor(selector) !== null;\n  }\n\n  /**\n   * Check if current style is applied\n   * @param {string} command - Style command (bold, italic, etc)\n   * @returns {boolean}\n   */\n  isStyleApplied(command) {\n    try {\n      return document.queryCommandState(command);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Focus editor and restore selection\n   */\n  focus() {\n    const container = this.editor.contentArea?.getElement();\n    if (container) {\n      container.focus();\n      this.restoreSelection();\n    }\n  }\n\n  /**\n   * Destroy selection manager\n   */\n  destroy() {\n    this.savedSelection = null;\n  }\n}\n\nexport default SelectionManager;\n","/**\n * KeyboardManager - Keyboard shortcuts management\n * Handles keyboard shortcuts for editor commands\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from './EventBus.js';\n\nclass KeyboardManager {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   */\n  constructor(editor) {\n    this.editor = editor;\n    this.shortcuts = new Map();\n    this.enabled = true;\n\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  /**\n   * Initialize keyboard manager\n   */\n  init() {\n    this.registerDefaultShortcuts();\n    this.attachListeners();\n  }\n\n  /**\n   * Register default keyboard shortcuts\n   */\n  registerDefaultShortcuts() {\n    // Text formatting\n    this.register('ctrl+b', 'bold');\n    this.register('ctrl+i', 'italic');\n    this.register('ctrl+u', 'underline');\n\n    // Undo/Redo\n    this.register('ctrl+z', 'undo');\n    this.register('ctrl+y', 'redo');\n    this.register('ctrl+shift+z', 'redo');\n\n    // Lists\n    this.register('ctrl+shift+l', 'insertUnorderedList');\n    this.register('ctrl+shift+o', 'insertOrderedList');\n\n    // Link\n    this.register('ctrl+k', () => {\n      this.editor.events?.emit('toolbar:buttonClick', {id: 'link'});\n    });\n\n    // Select all\n    this.register('ctrl+a', 'selectAll');\n\n    // Tab for indent (prevent default tab behavior)\n    this.register('tab', (e) => {\n      e.preventDefault();\n      this.editor.commands?.execute('indent');\n    });\n\n    this.register('shift+tab', (e) => {\n      e.preventDefault();\n      this.editor.commands?.execute('outdent');\n    });\n\n    // Escape to blur/close dialogs\n    this.register('escape', () => {\n      this.editor.events?.emit(EventBus.Events.DIALOG_CLOSE);\n    });\n  }\n\n  /**\n   * Attach event listeners\n   */\n  attachListeners() {\n    const container = this.editor.contentArea?.getElement();\n    if (container) {\n      container.addEventListener('keydown', this.handleKeyDown);\n    }\n  }\n\n  /**\n   * Detach event listeners\n   */\n  detachListeners() {\n    const container = this.editor.contentArea?.getElement();\n    if (container) {\n      container.removeEventListener('keydown', this.handleKeyDown);\n    }\n  }\n\n  /**\n   * Handle keydown event\n   * @param {KeyboardEvent} event\n   */\n  handleKeyDown(event) {\n    if (!this.enabled) return;\n\n    const shortcut = this.normalizeShortcut(event);\n    const handler = this.shortcuts.get(shortcut);\n\n    if (handler) {\n      if (typeof handler === 'string') {\n        // Handler is command name\n        event.preventDefault();\n        this.editor.commands?.execute(handler);\n      } else if (typeof handler === 'function') {\n        // Handler is custom function\n        handler(event);\n      }\n    }\n  }\n\n  /**\n   * Normalize keyboard event to shortcut string\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  normalizeShortcut(event) {\n    const parts = [];\n\n    if (event.ctrlKey || event.metaKey) parts.push('ctrl');\n    if (event.shiftKey) parts.push('shift');\n    if (event.altKey) parts.push('alt');\n\n    // Get key name\n    let key = event.key.toLowerCase();\n\n    // Handle special keys\n    const keyMap = {\n      ' ': 'space',\n      'control': null, // Skip modifier keys\n      'shift': null,\n      'alt': null,\n      'meta': null,\n      'arrowup': 'up',\n      'arrowdown': 'down',\n      'arrowleft': 'left',\n      'arrowright': 'right',\n      'enter': 'enter',\n      'escape': 'escape',\n      'backspace': 'backspace',\n      'delete': 'delete',\n      'tab': 'tab'\n    };\n\n    if (keyMap.hasOwnProperty(key)) {\n      key = keyMap[key];\n    }\n\n    if (key) {\n      parts.push(key);\n    }\n\n    return parts.join('+');\n  }\n\n  /**\n   * Parse shortcut string to normalized form\n   * @param {string} shortcut\n   * @returns {string}\n   */\n  parseShortcut(shortcut) {\n    const parts = shortcut.toLowerCase().split('+').map(p => p.trim());\n\n    // Sort modifiers in consistent order\n    const modifiers = [];\n    let key = '';\n\n    parts.forEach(part => {\n      if (['ctrl', 'cmd', 'meta'].includes(part)) {\n        modifiers.push('ctrl');\n      } else if (['shift'].includes(part)) {\n        modifiers.push('shift');\n      } else if (['alt', 'option'].includes(part)) {\n        modifiers.push('alt');\n      } else {\n        key = part;\n      }\n    });\n\n    // Sort modifiers\n    modifiers.sort();\n\n    // Combine\n    return [...modifiers, key].join('+');\n  }\n\n  /**\n   * Register a keyboard shortcut\n   * @param {string} shortcut - Shortcut string (e.g., 'ctrl+b', 'ctrl+shift+z')\n   * @param {string|Function} handler - Command name or handler function\n   */\n  register(shortcut, handler) {\n    const normalized = this.parseShortcut(shortcut);\n    this.shortcuts.set(normalized, handler);\n  }\n\n  /**\n   * Unregister a keyboard shortcut\n   * @param {string} shortcut - Shortcut string\n   */\n  unregister(shortcut) {\n    const normalized = this.parseShortcut(shortcut);\n    this.shortcuts.delete(normalized);\n  }\n\n  /**\n   * Check if shortcut is registered\n   * @param {string} shortcut - Shortcut string\n   * @returns {boolean}\n   */\n  hasShortcut(shortcut) {\n    const normalized = this.parseShortcut(shortcut);\n    return this.shortcuts.has(normalized);\n  }\n\n  /**\n   * Get handler for shortcut\n   * @param {string} shortcut - Shortcut string\n   * @returns {string|Function|null}\n   */\n  getHandler(shortcut) {\n    const normalized = this.parseShortcut(shortcut);\n    return this.shortcuts.get(normalized) || null;\n  }\n\n  /**\n   * Get all registered shortcuts\n   * @returns {Map}\n   */\n  getAllShortcuts() {\n    return new Map(this.shortcuts);\n  }\n\n  /**\n   * Format shortcut for display\n   * @param {string} shortcut - Shortcut string\n   * @returns {string}\n   */\n  formatForDisplay(shortcut) {\n    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n\n    const parts = shortcut.split('+');\n    const formatted = parts.map(part => {\n      switch (part.toLowerCase()) {\n        case 'ctrl':\n          return isMac ? '⌘' : 'Ctrl';\n        case 'shift':\n          return isMac ? '⇧' : 'Shift';\n        case 'alt':\n          return isMac ? '⌥' : 'Alt';\n        case 'enter':\n          return isMac ? '↩' : 'Enter';\n        case 'escape':\n          return 'Esc';\n        case 'tab':\n          return 'Tab';\n        case 'backspace':\n          return isMac ? '⌫' : 'Backspace';\n        case 'delete':\n          return isMac ? '⌦' : 'Del';\n        case 'up':\n          return '↑';\n        case 'down':\n          return '↓';\n        case 'left':\n          return '←';\n        case 'right':\n          return '→';\n        default:\n          return part.toUpperCase();\n      }\n    });\n\n    return isMac ? formatted.join('') : formatted.join('+');\n  }\n\n  /**\n   * Enable keyboard shortcuts\n   */\n  enable() {\n    this.enabled = true;\n  }\n\n  /**\n   * Disable keyboard shortcuts\n   */\n  disable() {\n    this.enabled = false;\n  }\n\n  /**\n   * Check if keyboard manager is enabled\n   * @returns {boolean}\n   */\n  isEnabled() {\n    return this.enabled;\n  }\n\n  /**\n   * Destroy keyboard manager\n   */\n  destroy() {\n    this.detachListeners();\n    this.shortcuts.clear();\n  }\n}\n\nexport default KeyboardManager;\n","/**\n * Toolbar - Editor toolbar component\n * Manages toolbar buttons, dropdowns, and state\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from '../core/EventBus.js';\n\nclass Toolbar {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   * @param {Object} options - Configuration options\n   */\n  constructor(editor, options = {}) {\n    this.editor = editor;\n    this.options = {\n      items: Toolbar.defaultItems,\n      sticky: false,\n      ...options\n    };\n\n    this.element = null;\n    this.buttons = new Map();\n    this.dropdowns = new Map();\n    this.activeDropdown = null;\n\n    this.handleButtonClick = this.handleButtonClick.bind(this);\n    this.handleButtonMousedown = this.handleButtonMousedown.bind(this);\n    this.handleDocumentClick = this.handleDocumentClick.bind(this);\n    this.updateButtonStates = this.updateButtonStates.bind(this);\n  }\n\n  /**\n   * Create and return the toolbar element\n   * @returns {HTMLElement}\n   */\n  create() {\n    this.element = document.createElement('div');\n    this.element.className = 'rte-toolbar';\n    this.element.setAttribute('role', 'toolbar');\n    this.element.setAttribute('aria-label', 'Text formatting toolbar');\n\n    if (this.options.sticky) {\n      this.element.classList.add('sticky');\n    }\n\n    // Build toolbar items\n    this.buildItems();\n\n    // Listen for toolbar updates\n    this.editor.events?.on(EventBus.Events.TOOLBAR_UPDATE, this.updateButtonStates);\n    this.editor.events?.on(EventBus.Events.SELECTION_CHANGE, this.updateButtonStates);\n\n    // Close dropdowns on outside click\n    document.addEventListener('click', this.handleDocumentClick);\n\n    return this.element;\n  }\n\n  /**\n   * Build toolbar items from configuration\n   */\n  buildItems() {\n    const items = this.options.items;\n\n    // Handle array of arrays (groups) or flat array\n    const groups = Array.isArray(items[0]) ? items : [items];\n\n    groups.forEach((group, groupIndex) => {\n      const groupElement = document.createElement('div');\n      groupElement.className = 'rte-toolbar-group';\n\n      group.forEach(item => {\n        if (item === '|' || item === 'separator') {\n          // Add separator\n          const separator = document.createElement('div');\n          separator.className = 'rte-toolbar-separator';\n          groupElement.appendChild(separator);\n        } else {\n          // Add button or dropdown\n          const buttonDef = Toolbar.buttonDefinitions[item];\n          if (buttonDef) {\n            const buttonEl = this.createButton(item, buttonDef);\n            groupElement.appendChild(buttonEl);\n          }\n        }\n      });\n\n      this.element.appendChild(groupElement);\n    });\n  }\n\n  /**\n   * Create a toolbar button\n   * @param {string} id - Button ID\n   * @param {Object} def - Button definition\n   * @returns {HTMLElement}\n   */\n  createButton(id, def) {\n    if (def.type === 'dropdown') {\n      return this.createDropdownButton(id, def);\n    }\n\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'rte-toolbar-btn';\n    button.dataset.command = id;\n    button.setAttribute('aria-label', window.translate?.(def.title) || def.title);\n    button.setAttribute('title', this.getButtonTooltip(id, def));\n\n    if (def.icon) {\n      const icon = document.createElement('span');\n      icon.className = `rte-icon ${def.icon}`;\n      icon.setAttribute('aria-hidden', 'true');\n      button.appendChild(icon);\n    } else if (def.text) {\n      button.textContent = window.translate?.(def.text) || def.text;\n    }\n\n    // Save selection on mousedown (before focus is lost)\n    button.addEventListener('mousedown', this.handleButtonMousedown);\n    button.addEventListener('click', (e) => this.handleButtonClick(e, id, def));\n\n    this.buttons.set(id, {element: button, definition: def});\n\n    return button;\n  }\n\n  /**\n   * Create a dropdown button\n   * @param {string} id - Button ID\n   * @param {Object} def - Button definition\n   * @returns {HTMLElement}\n   */\n  createDropdownButton(id, def) {\n    const container = document.createElement('div');\n    container.className = 'rte-toolbar-dropdown';\n\n    // Trigger button\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'rte-toolbar-btn rte-dropdown-trigger';\n    button.dataset.command = id;\n    button.setAttribute('aria-haspopup', 'true');\n    button.setAttribute('aria-expanded', 'false');\n    button.setAttribute('title', this.getButtonTooltip(id, def));\n\n    if (def.icon) {\n      const icon = document.createElement('span');\n      icon.className = `rte-icon ${def.icon}`;\n      icon.setAttribute('aria-hidden', 'true');\n      button.appendChild(icon);\n    }\n\n    // Dropdown arrow\n    const arrow = document.createElement('span');\n    arrow.className = 'rte-dropdown-arrow';\n    arrow.innerHTML = '▼';\n    button.appendChild(arrow);\n\n    // Dropdown menu\n    const menu = document.createElement('div');\n    menu.className = 'rte-dropdown-menu';\n    menu.setAttribute('role', 'menu');\n\n    // Build menu items\n    if (def.items) {\n      def.items.forEach(item => {\n        const menuItem = document.createElement('button');\n        menuItem.type = 'button';\n        menuItem.className = 'rte-dropdown-item';\n        menuItem.dataset.value = item.value;\n        menuItem.setAttribute('role', 'menuitem');\n\n        if (item.icon) {\n          const icon = document.createElement('span');\n          icon.className = `rte-icon ${item.icon}`;\n          menuItem.appendChild(icon);\n        }\n\n        const label = document.createElement('span');\n        label.className = 'rte-dropdown-item-label';\n        label.textContent = window.translate?.(item.label) || item.label;\n\n        if (item.tag) {\n          const tag = document.createElement(item.tag);\n          tag.style.margin = '0';\n          tag.style.fontSize = item.fontSize || 'inherit';\n          tag.textContent = window.translate?.(item.label) || item.label;\n          menuItem.appendChild(tag);\n        } else {\n          menuItem.appendChild(label);\n        }\n\n        menuItem.addEventListener('click', (e) => {\n          e.stopPropagation();\n          this.handleDropdownItemClick(id, item, def);\n        });\n\n        menu.appendChild(menuItem);\n      });\n    }\n\n    // Color picker type\n    if (def.colorPicker) {\n      const picker = this.createColorPicker(id, def);\n      menu.appendChild(picker);\n    }\n\n    // Save selection on mousedown\n    button.addEventListener('mousedown', this.handleButtonMousedown);\n    button.addEventListener('click', (e) => {\n      e.stopPropagation();\n      this.toggleDropdown(id, container, button);\n    });\n\n    container.appendChild(button);\n    container.appendChild(menu);\n\n    this.buttons.set(id, {element: button, definition: def});\n    this.dropdowns.set(id, {container, button, menu});\n\n    return container;\n  }\n\n  /**\n   * Create color picker\n   * @param {string} id - Picker ID\n   * @param {Object} def - Definition\n   * @returns {HTMLElement}\n   */\n  createColorPicker(id, def) {\n    const picker = document.createElement('div');\n    picker.className = 'rte-color-picker';\n\n    const colors = def.colors || Toolbar.defaultColors;\n\n    // Color grid\n    const grid = document.createElement('div');\n    grid.className = 'rte-color-grid';\n\n    colors.forEach(color => {\n      const colorBtn = document.createElement('button');\n      colorBtn.type = 'button';\n      colorBtn.className = 'rte-color-btn';\n      colorBtn.style.backgroundColor = color;\n      colorBtn.dataset.color = color;\n      colorBtn.setAttribute('title', color);\n\n      colorBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        this.handleColorSelect(id, color, def);\n      });\n\n      grid.appendChild(colorBtn);\n    });\n\n    picker.appendChild(grid);\n\n    // Custom color input\n    const customRow = document.createElement('div');\n    customRow.className = 'rte-color-custom';\n\n    const customInput = document.createElement('input');\n    customInput.type = 'color';\n    customInput.className = 'rte-color-input';\n    customInput.value = '#000000';\n\n    const customLabel = document.createElement('span');\n    customLabel.textContent = window.translate?.('Custom color') || 'Custom color';\n\n    customInput.addEventListener('change', (e) => {\n      this.handleColorSelect(id, e.target.value, def);\n    });\n\n    customRow.appendChild(customInput);\n    customRow.appendChild(customLabel);\n    picker.appendChild(customRow);\n\n    // Clear color button\n    if (def.allowClear) {\n      const clearBtn = document.createElement('button');\n      clearBtn.type = 'button';\n      clearBtn.className = 'rte-color-clear';\n      clearBtn.textContent = window.translate?.('Remove color') || 'Remove color';\n      clearBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        this.handleColorSelect(id, null, def);\n      });\n      picker.appendChild(clearBtn);\n    }\n\n    return picker;\n  }\n\n  /**\n   * Get button tooltip with shortcut\n   * @param {string} id - Button ID\n   * @param {Object} def - Button definition\n   * @returns {string}\n   */\n  getButtonTooltip(id, def) {\n    let tooltip = window.translate?.(def.title) || def.title;\n    const shortcut = this.editor.keyboard?.getHandler(def.command || id);\n\n    if (typeof shortcut === 'string') {\n      const formatted = this.editor.keyboard?.formatForDisplay(shortcut);\n      if (formatted) {\n        tooltip += ` (${formatted})`;\n      }\n    }\n\n    return tooltip;\n  }\n\n  /**\n   * Handle button mousedown - save selection before focus is lost\n   * @param {MouseEvent} event\n   */\n  handleButtonMousedown(event) {\n    // Prevent default to avoid editor losing focus\n    event.preventDefault();\n\n    // Save selection immediately on mousedown (before focus changes)\n    if (this.editor.selection?.isWithinEditor()) {\n      this.editor.selection.saveSelection();\n    }\n  }\n\n  /**\n   * Handle button click\n   * @param {MouseEvent} event\n   * @param {string} id - Button ID\n   * @param {Object} def - Button definition\n   */\n  handleButtonClick(event, id, def) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Restore selection before executing command\n    this.editor.selection?.restoreSelection();\n\n    if (def.command) {\n      this.editor.commands?.execute(def.command, def.value);\n    } else {\n      // Emit event for plugins to handle\n      this.editor.events?.emit(EventBus.Events.TOOLBAR_BUTTON_CLICK, {id, def});\n    }\n  }\n\n  /**\n   * Handle dropdown item click\n   * @param {string} id - Dropdown ID\n   * @param {Object} item - Item clicked\n   * @param {Object} def - Dropdown definition\n   */\n  handleDropdownItemClick(id, item, def) {\n    this.closeAllDropdowns();\n\n    // Restore selection\n    this.editor.selection?.restoreSelection();\n\n    if (item.command) {\n      this.editor.commands?.execute(item.command, item.value);\n    } else if (def.command) {\n      this.editor.commands?.execute(def.command, item.value);\n    } else {\n      this.editor.events?.emit(EventBus.Events.TOOLBAR_BUTTON_CLICK, {id, item, def});\n    }\n  }\n\n  /**\n   * Handle color selection\n   * @param {string} id - Picker ID\n   * @param {string|null} color - Selected color\n   * @param {Object} def - Definition\n   */\n  handleColorSelect(id, color, def) {\n    this.closeAllDropdowns();\n\n    // Restore selection\n    this.editor.selection?.restoreSelection();\n\n    if (def.command) {\n      if (color) {\n        this.editor.commands?.execute(def.command, color);\n      } else {\n        // Remove color\n        this.editor.commands?.execute('removeFormat');\n      }\n    }\n  }\n\n  /**\n   * Toggle dropdown visibility\n   * @param {string} id - Dropdown ID\n   * @param {HTMLElement} container - Dropdown container\n   * @param {HTMLElement} button - Trigger button\n   */\n  toggleDropdown(id, container, button) {\n    const isOpen = container.classList.contains('open');\n\n    // Close all dropdowns first\n    this.closeAllDropdowns();\n\n    if (!isOpen) {\n      // Save selection before opening dropdown\n      this.editor.selection?.saveSelection();\n\n      container.classList.add('open');\n      button.setAttribute('aria-expanded', 'true');\n      this.activeDropdown = id;\n    }\n  }\n\n  /**\n   * Close all dropdowns\n   */\n  closeAllDropdowns() {\n    this.dropdowns.forEach(({container, button}) => {\n      container.classList.remove('open');\n      button.setAttribute('aria-expanded', 'false');\n    });\n    this.activeDropdown = null;\n  }\n\n  /**\n   * Handle document click (close dropdowns)\n   * @param {MouseEvent} event\n   */\n  handleDocumentClick(event) {\n    if (this.activeDropdown) {\n      const dropdown = this.dropdowns.get(this.activeDropdown);\n      if (dropdown && !dropdown.container.contains(event.target)) {\n        this.closeAllDropdowns();\n      }\n    }\n  }\n\n  /**\n   * Update button states based on current selection\n   */\n  updateButtonStates() {\n    if (!this.editor.contentArea?.hasFocus()) return;\n\n    this.buttons.forEach(({element, definition}, id) => {\n      if (definition.command) {\n        const isActive = this.editor.commands?.isActive(definition.command, definition.value);\n        element.classList.toggle('active', isActive);\n        element.setAttribute('aria-pressed', isActive);\n      }\n\n      // Handle canExecute\n      if (definition.canExecute) {\n        const canExecute = typeof definition.canExecute === 'function'\n          ? definition.canExecute(this.editor)\n          : this.editor.commands?.canExecute(definition.command);\n        element.disabled = !canExecute;\n      }\n    });\n  }\n\n  /**\n   * Get toolbar element\n   * @returns {HTMLElement}\n   */\n  getElement() {\n    return this.element;\n  }\n\n  /**\n   * Set toolbar items\n   * @param {Array} items - Toolbar items\n   */\n  setItems(items) {\n    this.options.items = items;\n    if (this.element) {\n      this.element.innerHTML = '';\n      this.buttons.clear();\n      this.dropdowns.clear();\n      this.buildItems();\n    }\n  }\n\n  /**\n   * Enable a button\n   * @param {string} id - Button ID\n   */\n  enableButton(id) {\n    const btn = this.buttons.get(id);\n    if (btn) {\n      btn.element.disabled = false;\n    }\n  }\n\n  /**\n   * Disable a button\n   * @param {string} id - Button ID\n   */\n  disableButton(id) {\n    const btn = this.buttons.get(id);\n    if (btn) {\n      btn.element.disabled = true;\n    }\n  }\n\n  /**\n   * Show a button\n   * @param {string} id - Button ID\n   */\n  showButton(id) {\n    const btn = this.buttons.get(id);\n    if (btn) {\n      btn.element.style.display = '';\n    }\n  }\n\n  /**\n   * Hide a button\n   * @param {string} id - Button ID\n   */\n  hideButton(id) {\n    const btn = this.buttons.get(id);\n    if (btn) {\n      btn.element.style.display = 'none';\n    }\n  }\n\n  /**\n   * Destroy toolbar\n   */\n  destroy() {\n    document.removeEventListener('click', this.handleDocumentClick);\n\n    this.editor.events?.off(EventBus.Events.TOOLBAR_UPDATE, this.updateButtonStates);\n    this.editor.events?.off(EventBus.Events.SELECTION_CHANGE, this.updateButtonStates);\n\n    if (this.element && this.element.parentNode) {\n      this.element.parentNode.removeChild(this.element);\n    }\n\n    this.buttons.clear();\n    this.dropdowns.clear();\n    this.element = null;\n  }\n}\n\n// Default toolbar items\nToolbar.defaultItems = [\n  'bold', 'italic', 'underline', 'strikethrough', '|',\n  'heading', '|',\n  'bulletList', 'numberedList', '|',\n  'alignLeft', 'alignCenter', 'alignRight', '|',\n  'indent', 'outdent', '|',\n  'link', 'image', '|',\n  'textColor', 'backgroundColor', '|',\n  'undo', 'redo', '|',\n  'removeFormat', 'sourceView'\n];\n\n// Default colors\nToolbar.defaultColors = [\n  '#000000', '#434343', '#666666', '#999999', '#b7b7b7', '#cccccc', '#d9d9d9', '#efefef', '#f3f3f3', '#ffffff',\n  '#980000', '#ff0000', '#ff9900', '#ffff00', '#00ff00', '#00ffff', '#4a86e8', '#0000ff', '#9900ff', '#ff00ff',\n  '#e6b8af', '#f4cccc', '#fce5cd', '#fff2cc', '#d9ead3', '#d0e0e3', '#c9daf8', '#cfe2f3', '#d9d2e9', '#ead1dc',\n  '#dd7e6b', '#ea9999', '#f9cb9c', '#ffe599', '#b6d7a8', '#a2c4c9', '#a4c2f4', '#9fc5e8', '#b4a7d6', '#d5a6bd'\n];\n\n// Button definitions\nToolbar.buttonDefinitions = {\n  bold: {\n    icon: 'icon-bold',\n    title: 'Bold',\n    command: 'bold'\n  },\n  italic: {\n    icon: 'icon-italic',\n    title: 'Italic',\n    command: 'italic'\n  },\n  underline: {\n    icon: 'icon-underline',\n    title: 'Underline',\n    command: 'underline'\n  },\n  strikethrough: {\n    icon: 'icon-strikethrough',\n    title: 'Strikethrough',\n    command: 'strikethrough'\n  },\n  heading: {\n    icon: 'icon-heading',\n    title: 'Heading',\n    type: 'dropdown',\n    items: [\n      {label: 'Paragraph', value: 'p', tag: 'p', command: 'paragraph'},\n      {label: 'Heading 1', value: 1, tag: 'h1', fontSize: '2em', command: 'heading'},\n      {label: 'Heading 2', value: 2, tag: 'h2', fontSize: '1.5em', command: 'heading'},\n      {label: 'Heading 3', value: 3, tag: 'h3', fontSize: '1.17em', command: 'heading'},\n      {label: 'Heading 4', value: 4, tag: 'h4', fontSize: '1em', command: 'heading'},\n      {label: 'Heading 5', value: 5, tag: 'h5', fontSize: '0.83em', command: 'heading'},\n      {label: 'Heading 6', value: 6, tag: 'h6', fontSize: '0.67em', command: 'heading'}\n    ]\n  },\n  bulletList: {\n    icon: 'icon-list',\n    title: 'Bullet list',\n    command: 'insertUnorderedList'\n  },\n  numberedList: {\n    icon: 'icon-list-ol',\n    title: 'Numbered list',\n    command: 'insertOrderedList'\n  },\n  alignLeft: {\n    icon: 'icon-align-left',\n    title: 'Align left',\n    command: 'justifyLeft'\n  },\n  alignCenter: {\n    icon: 'icon-align-center',\n    title: 'Align center',\n    command: 'justifyCenter'\n  },\n  alignRight: {\n    icon: 'icon-align-right',\n    title: 'Align right',\n    command: 'justifyRight'\n  },\n  alignJustify: {\n    icon: 'icon-align-justify',\n    title: 'Justify',\n    command: 'justifyFull'\n  },\n  indent: {\n    icon: 'icon-indent',\n    title: 'Increase indent',\n    command: 'indent'\n  },\n  outdent: {\n    icon: 'icon-outdent',\n    title: 'Decrease indent',\n    command: 'outdent'\n  },\n  link: {\n    icon: 'icon-link',\n    title: 'Insert link'\n    // Handled by LinkPlugin\n  },\n  image: {\n    icon: 'icon-image',\n    title: 'Insert image'\n    // Handled by ImagePlugin\n  },\n  video: {\n    icon: 'icon-video',\n    title: 'Insert video'\n    // Handled by VideoPlugin\n  },\n  table: {\n    icon: 'icon-table',\n    title: 'Insert table'\n    // Handled by TablePlugin\n  },\n  horizontalRule: {\n    icon: 'icon-minus',\n    title: 'Horizontal line',\n    command: 'insertHorizontalRule'\n  },\n  blockquote: {\n    icon: 'icon-blockquote',\n    title: 'Blockquote',\n    command: 'blockquote'\n  },\n  codeBlock: {\n    icon: 'icon-code',\n    title: 'Code block',\n    command: 'pre'\n  },\n  textColor: {\n    icon: 'icon-text-color',\n    title: 'Text color',\n    type: 'dropdown',\n    colorPicker: true,\n    command: 'foreColor'\n  },\n  backgroundColor: {\n    icon: 'icon-highlight',\n    title: 'Background color',\n    type: 'dropdown',\n    colorPicker: true,\n    allowClear: true,\n    command: 'backColor'\n  },\n  specialChars: {\n    icon: 'icon-omega',\n    title: 'Special characters'\n    // Handled by SpecialCharsPlugin\n  },\n  emoji: {\n    icon: 'icon-emoji',\n    title: 'Emoji'\n    // Handled by EmojiPlugin\n  },\n  undo: {\n    icon: 'icon-undo',\n    title: 'Undo',\n    command: 'undo',\n    canExecute: (editor) => editor.history?.canUndo()\n  },\n  redo: {\n    icon: 'icon-redo',\n    title: 'Redo',\n    command: 'redo',\n    canExecute: (editor) => editor.history?.canRedo()\n  },\n  removeFormat: {\n    icon: 'icon-eraser',\n    title: 'Clear formatting',\n    command: 'removeFormat'\n  },\n  sourceView: {\n    icon: 'icon-code-alt',\n    title: 'Source code'\n    // Handled by SourceViewPlugin\n  },\n  fullscreen: {\n    icon: 'icon-fullscreen',\n    title: 'Fullscreen'\n    // Handled by FullscreenPlugin\n  },\n  findReplace: {\n    icon: 'icon-search',\n    title: 'Find and replace'\n    // Handled by FindReplacePlugin\n  }\n};\n\nexport default Toolbar;\n","/**\n * ContentArea - Content editable area component\n * Handles the main editing area with paste handling and content management\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from '../core/EventBus.js';\n\nclass ContentArea {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   * @param {Object} options - Configuration options\n   */\n  constructor(editor, options = {}) {\n    this.editor = editor;\n    this.options = {\n      minHeight: 200,\n      maxHeight: null,\n      autoResize: true,\n      placeholder: '',\n      readOnly: false,\n      ...options\n    };\n\n    this.element = null;\n    this.focused = false;\n\n    this.handleInput = this.handleInput.bind(this);\n    this.handleFocus = this.handleFocus.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.handlePaste = this.handlePaste.bind(this);\n    this.handleDrop = this.handleDrop.bind(this);\n    this.handleDragOver = this.handleDragOver.bind(this);\n  }\n\n  /**\n   * Create and return the content area element\n   * @returns {HTMLElement}\n   */\n  create() {\n    // Container\n    this.container = document.createElement('div');\n    this.container.className = 'rte-content-wrapper';\n\n    // Editable area\n    this.element = document.createElement('div');\n    this.element.className = 'rte-content';\n    this.element.contentEditable = !this.options.readOnly;\n    this.element.setAttribute('role', 'textbox');\n    this.element.setAttribute('aria-multiline', 'true');\n    this.element.setAttribute('aria-label', 'Rich text editor content');\n    this.element.setAttribute('data-placeholder', this.options.placeholder);\n\n    // Set initial styles\n    if (this.options.minHeight) {\n      this.element.style.minHeight = `${this.options.minHeight}px`;\n    }\n    if (this.options.maxHeight) {\n      this.element.style.maxHeight = `${this.options.maxHeight}px`;\n      this.element.style.overflowY = 'auto';\n    }\n\n    this.container.appendChild(this.element);\n\n    // Attach listeners\n    this.attachListeners();\n\n    return this.container;\n  }\n\n  /**\n   * Attach event listeners\n   */\n  attachListeners() {\n    this.element.addEventListener('input', this.handleInput);\n    this.element.addEventListener('focus', this.handleFocus);\n    this.element.addEventListener('blur', this.handleBlur);\n    this.element.addEventListener('paste', this.handlePaste);\n    this.element.addEventListener('drop', this.handleDrop);\n    this.element.addEventListener('dragover', this.handleDragOver);\n\n    // Selection change on mouseup and keyup\n    this.element.addEventListener('mouseup', () => {\n      this.editor.events?.emit(EventBus.Events.SELECTION_CHANGE);\n    });\n\n    this.element.addEventListener('keyup', (e) => {\n      // Emit selection change for navigation keys\n      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(e.key)) {\n        this.editor.events?.emit(EventBus.Events.SELECTION_CHANGE);\n      }\n    });\n  }\n\n  /**\n   * Detach event listeners\n   */\n  detachListeners() {\n    if (!this.element) return;\n\n    this.element.removeEventListener('input', this.handleInput);\n    this.element.removeEventListener('focus', this.handleFocus);\n    this.element.removeEventListener('blur', this.handleBlur);\n    this.element.removeEventListener('paste', this.handlePaste);\n    this.element.removeEventListener('drop', this.handleDrop);\n    this.element.removeEventListener('dragover', this.handleDragOver);\n  }\n\n  /**\n   * Handle input event\n   */\n  handleInput() {\n    this.editor.history?.record();\n    this.editor.events?.emit(EventBus.Events.CONTENT_CHANGE, this.getContent());\n  }\n\n  /**\n   * Handle focus event\n   */\n  handleFocus() {\n    this.focused = true;\n    this.container?.classList.add('focused');\n    this.editor.events?.emit(EventBus.Events.EDITOR_FOCUS);\n  }\n\n  /**\n   * Handle blur event\n   */\n  handleBlur() {\n    this.focused = false;\n    this.container?.classList.remove('focused');\n    this.editor.events?.emit(EventBus.Events.EDITOR_BLUR);\n  }\n\n  /**\n   * Handle paste event\n   * @param {ClipboardEvent} event\n   */\n  handlePaste(event) {\n    // Emit event to allow plugins to handle\n    this.editor.events?.emit(EventBus.Events.CONTENT_PASTE, event);\n\n    // If event not prevented by plugin, do default clean paste\n    if (!event.defaultPrevented) {\n      const clipboardData = event.clipboardData || window.clipboardData;\n\n      if (clipboardData) {\n        // Try to get HTML first\n        const html = clipboardData.getData('text/html');\n        const text = clipboardData.getData('text/plain');\n\n        if (html) {\n          event.preventDefault();\n          const cleanedHtml = this.cleanPastedHtml(html);\n          this.editor.selection?.insertHtml(cleanedHtml);\n          this.handleInput();\n        } else if (text) {\n          // Let browser handle plain text paste\n          // or convert to paragraphs if needed\n        }\n      }\n    }\n  }\n\n  /**\n   * Clean pasted HTML (remove Word-specific styles, etc.)\n   * @param {string} html - Raw HTML\n   * @returns {string} Cleaned HTML\n   */\n  cleanPastedHtml(html) {\n    // Create temporary container\n    const temp = document.createElement('div');\n    temp.innerHTML = html;\n\n    // Remove Word-specific elements\n    const msElements = temp.querySelectorAll('[class^=\"Mso\"], [style*=\"mso-\"]');\n    msElements.forEach(el => {\n      // Remove mso- styles but keep element\n      if (el.hasAttribute('style')) {\n        const style = el.getAttribute('style');\n        const cleanedStyle = style\n          .split(';')\n          .filter(s => !s.trim().startsWith('mso-'))\n          .join(';');\n        if (cleanedStyle.trim()) {\n          el.setAttribute('style', cleanedStyle);\n        } else {\n          el.removeAttribute('style');\n        }\n      }\n      // Remove Mso classes\n      el.className = el.className.split(' ')\n        .filter(c => !c.startsWith('Mso'))\n        .join(' ');\n      if (!el.className) {\n        el.removeAttribute('class');\n      }\n    });\n\n    // Remove script and style tags\n    temp.querySelectorAll('script, style, meta, link').forEach(el => el.remove());\n\n    // Remove comments\n    const iterator = document.createNodeIterator(\n      temp,\n      NodeFilter.SHOW_COMMENT,\n      null,\n      false\n    );\n    let comment;\n    while (comment = iterator.nextNode()) {\n      comment.parentNode.removeChild(comment);\n    }\n\n    // Remove empty spans\n    temp.querySelectorAll('span:empty').forEach(el => el.remove());\n\n    // Clean up excessive nested spans\n    temp.querySelectorAll('span').forEach(span => {\n      if (!span.hasAttribute('style') && !span.hasAttribute('class')) {\n        // Replace span with its children\n        while (span.firstChild) {\n          span.parentNode.insertBefore(span.firstChild, span);\n        }\n        span.parentNode.removeChild(span);\n      }\n    });\n\n    // Remove font tags\n    temp.querySelectorAll('font').forEach(font => {\n      while (font.firstChild) {\n        font.parentNode.insertBefore(font.firstChild, font);\n      }\n      font.parentNode.removeChild(font);\n    });\n\n    return temp.innerHTML;\n  }\n\n  /**\n   * Handle drop event\n   * @param {DragEvent} event\n   */\n  handleDrop(event) {\n    const files = event.dataTransfer?.files;\n    if (files && files.length > 0) {\n      // Let image plugin handle file drops\n      this.editor.events?.emit('content:drop', {\n        event,\n        files: Array.from(files)\n      });\n    }\n  }\n\n  /**\n   * Handle dragover event\n   * @param {DragEvent} event\n   */\n  handleDragOver(event) {\n    // Allow drop\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'copy';\n  }\n\n  /**\n   * Check if content is empty\n   * @returns {boolean}\n   */\n  isEmpty() {\n    if (!this.element) return true;\n\n    const text = this.element.textContent?.trim();\n    const html = this.element.innerHTML?.trim();\n\n    // Check for truly empty content\n    return !text && (\n      !html ||\n      html === '<br>' ||\n      html === '<p></p>' ||\n      html === '<p><br></p>' ||\n      html === '<div></div>' ||\n      html === '<div><br></div>'\n    );\n  }\n\n  /**\n   * Get element\n   * @returns {HTMLElement}\n   */\n  getElement() {\n    return this.element;\n  }\n\n  /**\n   * Get container\n   * @returns {HTMLElement}\n   */\n  getContainer() {\n    return this.container;\n  }\n\n  /**\n   * Get content as HTML\n   * @returns {string}\n   */\n  getContent() {\n    if (!this.element) return '';\n\n    // Don't return placeholder content\n    if (this.isEmpty()) return '';\n\n    return this.element.innerHTML;\n  }\n\n  /**\n   * Set content\n   * @param {string} html - HTML content\n   * @param {boolean} recordHistory - Whether to record in history\n   */\n  setContent(html, recordHistory = false) {\n    if (!this.element) return;\n\n    this.element.innerHTML = html;\n\n    if (recordHistory) {\n      this.editor.history?.record(true);\n    }\n\n    this.editor.events?.emit(EventBus.Events.CONTENT_SET, html);\n  }\n\n  /**\n   * Clear content\n   */\n  clear() {\n    this.setContent('', true);\n  }\n\n  /**\n   * Focus the content area\n   */\n  focus() {\n    if (this.element) {\n      this.element.focus();\n    }\n  }\n\n  /**\n   * Blur the content area\n   */\n  blur() {\n    if (this.element) {\n      this.element.blur();\n    }\n  }\n\n  /**\n   * Check if content area has focus\n   * @returns {boolean}\n   */\n  hasFocus() {\n    return this.focused;\n  }\n\n  /**\n   * Set read-only mode\n   * @param {boolean} readOnly\n   */\n  setReadOnly(readOnly) {\n    this.options.readOnly = readOnly;\n    if (this.element) {\n      this.element.contentEditable = !readOnly;\n    }\n  }\n\n  /**\n   * Check if read-only\n   * @returns {boolean}\n   */\n  isReadOnly() {\n    return this.options.readOnly;\n  }\n\n  /**\n   * Set placeholder\n   * @param {string} placeholder\n   */\n  setPlaceholder(placeholder) {\n    this.options.placeholder = placeholder;\n    if (this.element) {\n      this.element.setAttribute('data-placeholder', placeholder);\n    }\n  }\n\n  /**\n   * Get text content (no HTML)\n   * @returns {string}\n   */\n  getTextContent() {\n    return this.element?.textContent || '';\n  }\n\n  /**\n   * Get word count\n   * @returns {number}\n   */\n  getWordCount() {\n    const text = this.getTextContent().trim();\n    if (!text) return 0;\n\n    return text.split(/\\s+/).filter(word => word.length > 0).length;\n  }\n\n  /**\n   * Get character count\n   * @param {boolean} excludeSpaces - Exclude spaces from count\n   * @returns {number}\n   */\n  getCharacterCount(excludeSpaces = false) {\n    const text = this.getTextContent();\n    if (excludeSpaces) {\n      return text.replace(/\\s/g, '').length;\n    }\n    return text.length;\n  }\n\n  /**\n   * Destroy content area\n   */\n  destroy() {\n    this.detachListeners();\n\n    if (this.container && this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n    }\n\n    this.element = null;\n    this.container = null;\n  }\n}\n\nexport default ContentArea;\n","/**\n * RichTextEditor - Main entry point for the Rich Text Editor\n * A modular, plugin-based WYSIWYG editor inspired by CKEditor\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from './core/EventBus.js';\nimport CommandManager from './core/CommandManager.js';\nimport HistoryManager from './core/HistoryManager.js';\nimport SelectionManager from './core/SelectionManager.js';\nimport KeyboardManager from './core/KeyboardManager.js';\nimport Toolbar from './ui/Toolbar.js';\nimport ContentArea from './ui/ContentArea.js';\n\nclass RichTextEditor {\n  /**\n   * Create a RichTextEditor instance\n   * @param {string|HTMLElement} element - Target element or selector\n   * @param {Object} options - Configuration options\n   */\n  constructor(element, options = {}) {\n    // Get target element\n    this.targetElement = typeof element === 'string'\n      ? document.querySelector(element)\n      : element;\n\n    if (!this.targetElement) {\n      throw new Error('RichTextEditor: Target element not found');\n    }\n\n    // Default options\n    this.options = {\n      height: 'auto',\n      minHeight: 200,\n      maxHeight: null,\n      placeholder: '',\n      readOnly: false,\n      toolbar: Toolbar.defaultItems,\n      stickyToolbar: false,\n      plugins: [],\n      autofocus: false,\n      sanitize: true,\n      ...options\n    };\n\n    // Core components\n    this.events = null;\n    this.commands = null;\n    this.history = null;\n    this.selection = null;\n    this.keyboard = null;\n    this.toolbar = null;\n    this.contentArea = null;\n\n    // State\n    this.container = null;\n    this.plugins = new Map();\n    this.initialized = false;\n    this.isSourceMode = false;\n    this.isFullscreen = false;\n\n    // Initialize\n    this.init();\n  }\n\n  /**\n   * Initialize the editor\n   */\n  init() {\n    // Create event bus first\n    this.events = new EventBus();\n\n    // Create core managers\n    this.selection = new SelectionManager(this);\n    this.commands = new CommandManager(this);\n    this.history = new HistoryManager(this, {\n      maxHistory: this.options.maxHistory || 100\n    });\n    this.keyboard = new KeyboardManager(this);\n\n    // Build UI\n    this.buildUI();\n\n    // Initialize managers that need UI\n    this.keyboard.init();\n\n    // Initialize history with current content\n    this.history.init();\n\n    // Load plugins\n    this.loadPlugins();\n\n    // Set initial content if target was textarea\n    if (this.targetElement.tagName === 'TEXTAREA') {\n      const content = this.targetElement.value;\n      if (content) {\n        this.setContent(content);\n      }\n    }\n\n    this.initialized = true;\n\n    // Emit init event\n    this.events.emit(EventBus.Events.EDITOR_INIT, this);\n\n    // Auto focus if requested\n    if (this.options.autofocus) {\n      this.focus();\n    }\n\n    // Emit ready event on next tick\n    requestAnimationFrame(() => {\n      this.events.emit(EventBus.Events.EDITOR_READY, this);\n      this.plugins.forEach(plugin => plugin.onReady?.());\n    });\n  }\n\n  /**\n   * Build the editor UI\n   */\n  buildUI() {\n    // Create main container\n    this.container = document.createElement('div');\n    this.container.className = 'rte-container';\n\n    if (this.options.height !== 'auto') {\n      this.container.style.height = typeof this.options.height === 'number'\n        ? `${this.options.height}px`\n        : this.options.height;\n    }\n\n    // Create toolbar\n    this.toolbar = new Toolbar(this, {\n      items: this.options.toolbar,\n      sticky: this.options.stickyToolbar\n    });\n    this.container.appendChild(this.toolbar.create());\n\n    // Create content area\n    this.contentArea = new ContentArea(this, {\n      minHeight: this.options.minHeight,\n      maxHeight: this.options.maxHeight,\n      placeholder: this.options.placeholder,\n      readOnly: this.options.readOnly\n    });\n    this.container.appendChild(this.contentArea.create());\n\n    // Create footer (for word count, etc.)\n    this.footer = document.createElement('div');\n    this.footer.className = 'rte-footer';\n    this.container.appendChild(this.footer);\n\n    // Replace target or insert after\n    if (this.targetElement.tagName === 'TEXTAREA') {\n      this.targetElement.style.display = 'none';\n      this.targetElement.parentNode.insertBefore(this.container, this.targetElement.nextSibling);\n\n      // Sync content to textarea on change\n      this.events.on(EventBus.Events.CONTENT_CHANGE, () => {\n        this.targetElement.value = this.getContent();\n      });\n    } else {\n      // Get existing content\n      const existingContent = this.targetElement.innerHTML;\n\n      // Replace element contents\n      this.targetElement.innerHTML = '';\n      this.targetElement.appendChild(this.container);\n\n      // Set existing content\n      if (existingContent.trim()) {\n        this.setContent(existingContent);\n      }\n    }\n  }\n\n  /**\n   * Load configured plugins\n   */\n  loadPlugins() {\n    const pluginConfigs = this.options.plugins;\n\n    pluginConfigs.forEach(pluginConfig => {\n      let PluginClass;\n      let pluginOptions = {};\n\n      if (typeof pluginConfig === 'string') {\n        // Plugin name string - load from registered plugins\n        PluginClass = RichTextEditor.registeredPlugins.get(pluginConfig);\n        pluginOptions = this.options[pluginConfig] || {};\n      } else if (typeof pluginConfig === 'object') {\n        // Plugin config object\n        PluginClass = pluginConfig.plugin || RichTextEditor.registeredPlugins.get(pluginConfig.name);\n        pluginOptions = pluginConfig.options || this.options[pluginConfig.name] || {};\n      } else if (typeof pluginConfig === 'function') {\n        // Plugin class directly\n        PluginClass = pluginConfig;\n      }\n\n      if (PluginClass) {\n        this.loadPlugin(PluginClass, pluginOptions);\n      } else if (typeof pluginConfig === 'string') {\n        console.warn(`RichTextEditor: Plugin \"${pluginConfig}\" not found`);\n      }\n    });\n  }\n\n  /**\n   * Load a single plugin\n   * @param {Function} PluginClass - Plugin class\n   * @param {Object} options - Plugin options\n   */\n  loadPlugin(PluginClass, options = {}) {\n    const pluginName = PluginClass.pluginName || PluginClass.name;\n\n    // Check if already loaded\n    if (this.plugins.has(pluginName)) {\n      console.warn(`RichTextEditor: Plugin \"${pluginName}\" already loaded`);\n      return;\n    }\n\n    // Check dependencies\n    const requires = PluginClass.requires || [];\n    for (const dep of requires) {\n      if (!this.plugins.has(dep)) {\n        console.warn(`RichTextEditor: Plugin \"${pluginName}\" requires \"${dep}\"`);\n      }\n    }\n\n    // Create and initialize plugin\n    const plugin = new PluginClass(this, options);\n    plugin.init();\n\n    this.plugins.set(pluginName, plugin);\n\n    // Emit event\n    this.events.emit(EventBus.Events.PLUGIN_LOAD, {name: pluginName, plugin});\n  }\n\n  /**\n   * Unload a plugin\n   * @param {string} pluginName - Plugin name\n   */\n  unloadPlugin(pluginName) {\n    const plugin = this.plugins.get(pluginName);\n    if (plugin) {\n      plugin.destroy();\n      this.plugins.delete(pluginName);\n      this.events.emit(EventBus.Events.PLUGIN_UNLOAD, {name: pluginName});\n    }\n  }\n\n  /**\n   * Get a loaded plugin\n   * @param {string} pluginName - Plugin name\n   * @returns {PluginBase|null}\n   */\n  getPlugin(pluginName) {\n    return this.plugins.get(pluginName) || null;\n  }\n\n  /**\n   * Get editor content (HTML)\n   * @returns {string}\n   */\n  getContent() {\n    if (this.isSourceMode) {\n      return this.sourceEditor?.value || '';\n    }\n    return this.contentArea?.getContent() || '';\n  }\n\n  /**\n   * Set editor content\n   * @param {string} html - HTML content\n   * @param {boolean} recordHistory - Whether to record in history\n   */\n  setContent(html, recordHistory = true) {\n    const cleanedHtml = this.options.sanitize ? this.sanitizeHtml(html) : html;\n\n    if (this.isSourceMode) {\n      if (this.sourceEditor) {\n        this.sourceEditor.value = cleanedHtml;\n      }\n    } else {\n      this.contentArea?.setContent(cleanedHtml, recordHistory);\n    }\n\n    this.events.emit(EventBus.Events.CONTENT_SET, cleanedHtml);\n  }\n\n  /**\n   * Sanitize HTML content\n   * @param {string} html - Raw HTML\n   * @returns {string} Sanitized HTML\n   */\n  sanitizeHtml(html) {\n    if (!html) return '';\n\n    const temp = document.createElement('div');\n    temp.innerHTML = html;\n\n    // Remove script tags\n    temp.querySelectorAll('script').forEach(el => el.remove());\n\n    // Remove event handlers\n    temp.querySelectorAll('*').forEach(el => {\n      Array.from(el.attributes).forEach(attr => {\n        if (attr.name.startsWith('on') || attr.value.includes('javascript:')) {\n          el.removeAttribute(attr.name);\n        }\n      });\n    });\n\n    return temp.innerHTML;\n  }\n\n  /**\n   * Clear editor content\n   */\n  clear() {\n    this.setContent('');\n  }\n\n  /**\n   * Focus the editor\n   */\n  focus() {\n    this.contentArea?.focus();\n  }\n\n  /**\n   * Blur the editor\n   */\n  blur() {\n    this.contentArea?.blur();\n  }\n\n  /**\n   * Check if editor has focus\n   * @returns {boolean}\n   */\n  hasFocus() {\n    return this.contentArea?.hasFocus() || false;\n  }\n\n  /**\n   * Execute a command\n   * @param {string} command - Command name\n   * @param {...any} args - Command arguments\n   */\n  execute(command, ...args) {\n    return this.commands?.execute(command, ...args);\n  }\n\n  /**\n   * Subscribe to editor event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   * @returns {Function} Unsubscribe function\n   */\n  on(event, callback) {\n    return this.events?.on(event, callback);\n  }\n\n  /**\n   * Unsubscribe from editor event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  off(event, callback) {\n    this.events?.off(event, callback);\n  }\n\n  /**\n   * Emit editor event\n   * @param {string} event - Event name\n   * @param {...any} args - Event arguments\n   */\n  emit(event, ...args) {\n    this.events?.emit(event, ...args);\n  }\n\n  /**\n   * Get text content (no HTML)\n   * @returns {string}\n   */\n  getTextContent() {\n    return this.contentArea?.getTextContent() || '';\n  }\n\n  /**\n   * Get word count\n   * @returns {number}\n   */\n  getWordCount() {\n    return this.contentArea?.getWordCount() || 0;\n  }\n\n  /**\n   * Get character count\n   * @param {boolean} excludeSpaces - Exclude spaces\n   * @returns {number}\n   */\n  getCharacterCount(excludeSpaces = false) {\n    return this.contentArea?.getCharacterCount(excludeSpaces) || 0;\n  }\n\n  /**\n   * Check if content is empty\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return this.contentArea?.isEmpty() || true;\n  }\n\n  /**\n   * Set read-only mode\n   * @param {boolean} readOnly\n   */\n  setReadOnly(readOnly) {\n    this.options.readOnly = readOnly;\n    this.contentArea?.setReadOnly(readOnly);\n\n    if (readOnly) {\n      this.container?.classList.add('readonly');\n    } else {\n      this.container?.classList.remove('readonly');\n    }\n  }\n\n  /**\n   * Check if editor is read-only\n   * @returns {boolean}\n   */\n  isReadOnly() {\n    return this.options.readOnly;\n  }\n\n  /**\n   * Toggle source view mode\n   * @param {boolean} enabled - Enable source view\n   */\n  toggleSourceView(enabled) {\n    this.isSourceMode = enabled !== undefined ? enabled : !this.isSourceMode;\n    this.events.emit(EventBus.Events.MODE_CHANGE, {mode: this.isSourceMode ? 'source' : 'wysiwyg'});\n  }\n\n  /**\n   * Toggle fullscreen mode\n   * @param {boolean} enabled - Enable fullscreen\n   */\n  toggleFullscreen(enabled) {\n    this.isFullscreen = enabled !== undefined ? enabled : !this.isFullscreen;\n\n    if (this.isFullscreen) {\n      this.container?.classList.add('fullscreen');\n      document.body.classList.add('rte-fullscreen-active');\n    } else {\n      this.container?.classList.remove('fullscreen');\n      document.body.classList.remove('rte-fullscreen-active');\n    }\n\n    this.events.emit(EventBus.Events.MODE_CHANGE, {fullscreen: this.isFullscreen});\n  }\n\n  /**\n   * Show notification\n   * @param {string} message - Notification message\n   * @param {string} type - Notification type (success, error, warning, info)\n   * @param {number} duration - Duration in ms\n   */\n  showNotification(message, type = 'info', duration = 3000) {\n    const notification = document.createElement('div');\n    notification.className = `rte-notification rte-notification-${type}`;\n    notification.textContent = window.translate?.(message) || message;\n\n    this.container?.appendChild(notification);\n\n    // Show animation\n    requestAnimationFrame(() => {\n      notification.classList.add('show');\n    });\n\n    // Auto hide\n    setTimeout(() => {\n      notification.classList.remove('show');\n      setTimeout(() => notification.remove(), 300);\n    }, duration);\n  }\n\n  /**\n   * Get container element\n   * @returns {HTMLElement}\n   */\n  getContainer() {\n    return this.container;\n  }\n\n  /**\n   * Get content element\n   * @returns {HTMLElement}\n   */\n  getContentElement() {\n    return this.contentArea?.getElement();\n  }\n\n  /**\n   * Destroy the editor\n   */\n  destroy() {\n    // Emit destroy event\n    this.events?.emit(EventBus.Events.EDITOR_DESTROY, this);\n\n    // Destroy plugins\n    this.plugins.forEach(plugin => plugin.destroy());\n    this.plugins.clear();\n\n    // Destroy components\n    this.keyboard?.destroy();\n    this.history?.destroy();\n    this.commands?.destroy();\n    this.selection?.destroy();\n    this.toolbar?.destroy();\n    this.contentArea?.destroy();\n    this.events?.destroy();\n\n    // Restore original element if textarea\n    if (this.targetElement?.tagName === 'TEXTAREA') {\n      this.targetElement.style.display = '';\n    }\n\n    // Remove container\n    if (this.container?.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n    }\n\n    // Cleanup references\n    this.container = null;\n    this.targetElement = null;\n    this.initialized = false;\n  }\n\n  /**\n   * Static: Register a plugin\n   * @param {string} name - Plugin name\n   * @param {Function} PluginClass - Plugin class\n   */\n  static registerPlugin(name, PluginClass) {\n    RichTextEditor.registeredPlugins.set(name, PluginClass);\n  }\n\n  /**\n   * Static: Unregister a plugin\n   * @param {string} name - Plugin name\n   */\n  static unregisterPlugin(name) {\n    RichTextEditor.registeredPlugins.delete(name);\n  }\n\n  /**\n   * Static: Get all registered plugins\n   * @returns {Map}\n   */\n  static getRegisteredPlugins() {\n    return RichTextEditor.registeredPlugins;\n  }\n\n  /**\n   * Static: Create editor instance\n   * @param {string|HTMLElement} element - Target element\n   * @param {Object} options - Options\n   * @returns {RichTextEditor}\n   */\n  static create(element, options = {}) {\n    return new RichTextEditor(element, options);\n  }\n}\n\n// Static plugin registry\nRichTextEditor.registeredPlugins = new Map();\n\n// Event constants\nRichTextEditor.Events = EventBus.Events;\n\n// Export for ES modules\nexport default RichTextEditor;\n\n// Export for global usage\nif (typeof window !== 'undefined') {\n  window.RichTextEditor = RichTextEditor;\n}\n","/**\n * PluginBase - Base class for RichTextEditor plugins\n * Provides common functionality and lifecycle methods\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\n\nclass PluginBase {\n  /**\n   * Plugin name (must be overridden)\n   * @type {string}\n   */\n  static pluginName = 'base';\n\n  /**\n   * Plugin dependencies\n   * @type {string[]}\n   */\n  static requires = [];\n\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   * @param {Object} options - Plugin options\n   */\n  constructor(editor, options = {}) {\n    this.editor = editor;\n    this.options = options;\n    this.initialized = false;\n    this.eventSubscriptions = [];\n  }\n\n  /**\n   * Initialize the plugin\n   * Called when plugin is loaded\n   */\n  init() {\n    this.initialized = true;\n  }\n\n  /**\n   * Called when editor is ready\n   */\n  onReady() {\n    // Override in subclass\n  }\n\n  /**\n   * Get plugin name\n   * @returns {string}\n   */\n  getName() {\n    return this.constructor.pluginName;\n  }\n\n  /**\n   * Subscribe to editor event\n   * @param {string} event - Event name\n   * @param {Function} callback - Callback function\n   */\n  subscribe(event, callback) {\n    const boundCallback = callback.bind(this);\n    this.editor.events?.on(event, boundCallback);\n    this.eventSubscriptions.push({event, callback: boundCallback});\n  }\n\n  /**\n   * Execute editor command\n   * @param {string} command - Command name\n   * @param {...any} args - Command arguments\n   */\n  execute(command, ...args) {\n    return this.editor.commands?.execute(command, ...args);\n  }\n\n  /**\n   * Register editor command\n   * @param {string} name - Command name\n   * @param {Object} definition - Command definition\n   */\n  registerCommand(name, definition) {\n    this.editor.commands?.register(name, definition);\n  }\n\n  /**\n   * Register keyboard shortcut\n   * @param {string} shortcut - Shortcut string\n   * @param {string|Function} handler - Command name or handler function\n   */\n  registerShortcut(shortcut, handler) {\n    this.editor.keyboard?.register(shortcut, handler);\n  }\n\n  /**\n   * Get editor selection manager\n   * @returns {SelectionManager}\n   */\n  getSelection() {\n    return this.editor.selection;\n  }\n\n  /**\n   * Get current selection range\n   * @returns {Range|null}\n   */\n  getRange() {\n    return this.editor.selection?.getRange();\n  }\n\n  /**\n   * Save current selection\n   */\n  saveSelection() {\n    this.editor.selection?.saveSelection();\n  }\n\n  /**\n   * Restore saved selection\n   */\n  restoreSelection() {\n    this.editor.selection?.restoreSelection();\n  }\n\n  /**\n   * Insert HTML at cursor\n   * @param {string} html - HTML to insert\n   */\n  insertHtml(html) {\n    this.editor.selection?.insertHtml(html);\n  }\n\n  /**\n   * Get editor content\n   * @returns {string}\n   */\n  getContent() {\n    return this.editor.getContent();\n  }\n\n  /**\n   * Set editor content\n   * @param {string} html - HTML content\n   */\n  setContent(html) {\n    this.editor.setContent(html);\n  }\n\n  /**\n   * Emit event\n   * @param {string} event - Event name\n   * @param {...any} args - Event arguments\n   */\n  emit(event, ...args) {\n    this.editor.events?.emit(event, ...args);\n  }\n\n  /**\n   * Translate text\n   * @param {string} key - Translation key\n   * @param {Object} params - Parameters\n   * @returns {string}\n   */\n  translate(key, params = {}) {\n    if (window.translate) {\n      return window.translate(key, params);\n    }\n    return key;\n  }\n\n  /**\n   * Show notification\n   * @param {string} message - Notification message\n   * @param {string} type - Notification type (success, error, warning, info)\n   */\n  notify(message, type = 'info') {\n    this.editor.showNotification?.(message, type);\n  }\n\n  /**\n   * Get toolbar button element\n   * @param {string} id - Button ID\n   * @returns {HTMLElement|null}\n   */\n  getToolbarButton(id) {\n    return this.editor.toolbar?.buttons.get(id)?.element;\n  }\n\n  /**\n   * Update toolbar button state\n   * @param {string} id - Button ID\n   * @param {boolean} active - Active state\n   */\n  setButtonActive(id, active) {\n    const button = this.getToolbarButton(id);\n    if (button) {\n      button.classList.toggle('active', active);\n      button.setAttribute('aria-pressed', active);\n    }\n  }\n\n  /**\n   * Enable toolbar button\n   * @param {string} id - Button ID\n   */\n  enableButton(id) {\n    const button = this.getToolbarButton(id);\n    if (button) {\n      button.disabled = false;\n    }\n  }\n\n  /**\n   * Disable toolbar button\n   * @param {string} id - Button ID\n   */\n  disableButton(id) {\n    const button = this.getToolbarButton(id);\n    if (button) {\n      button.disabled = true;\n    }\n  }\n\n  /**\n   * Focus editor\n   */\n  focusEditor() {\n    this.editor.focus();\n  }\n\n  /**\n   * Check if editor has focus\n   * @returns {boolean}\n   */\n  hasFocus() {\n    return this.editor.contentArea?.hasFocus() || false;\n  }\n\n  /**\n   * Record history snapshot\n   * @param {boolean} force - Force immediate recording\n   */\n  recordHistory(force = false) {\n    this.editor.history?.record(force);\n  }\n\n  /**\n   * Start batch history operation\n   */\n  startBatch() {\n    this.editor.history?.startBatch();\n  }\n\n  /**\n   * End batch history operation\n   */\n  endBatch() {\n    this.editor.history?.endBatch();\n  }\n\n  /**\n   * Execute function as single history batch\n   * @param {Function} fn - Function to execute\n   */\n  batch(fn) {\n    this.editor.history?.batch(fn);\n  }\n\n  /**\n   * Destroy the plugin\n   * Called when plugin is unloaded or editor is destroyed\n   */\n  destroy() {\n    // Unsubscribe from all events\n    this.eventSubscriptions.forEach(({event, callback}) => {\n      this.editor.events?.off(event, callback);\n    });\n    this.eventSubscriptions = [];\n\n    this.initialized = false;\n  }\n}\n\nexport default PluginBase;\n","/**\n * BaseDialog - Base class for modal dialogs\n * Provides common functionality for all editor dialogs\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport EventBus from '../../core/EventBus.js';\n\nclass BaseDialog {\n  /**\n   * @param {RichTextEditor} editor - Editor instance\n   * @param {Object} options - Dialog options\n   */\n  constructor(editor, options = {}) {\n    this.editor = editor;\n    this.options = {\n      title: 'Dialog',\n      width: 450,\n      closable: true,\n      closeOnOverlay: true,\n      closeOnEscape: true,\n      ...options\n    };\n\n    this.overlay = null;\n    this.dialog = null;\n    this.isOpen = false;\n    this.savedSelection = null;\n\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleOverlayClick = this.handleOverlayClick.bind(this);\n  }\n\n  /**\n   * Translate text\n   * @param {string} key - Translation key\n   * @param {Object} params - Parameters\n   * @returns {string}\n   */\n  translate(key, params = {}) {\n    if (window.translate) {\n      return window.translate(key, params);\n    }\n    return key;\n  }\n\n  /**\n   * Create dialog DOM structure\n   * @returns {HTMLElement}\n   */\n  create() {\n    // Overlay\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'rte-dialog-overlay';\n\n    // Dialog container\n    this.dialog = document.createElement('div');\n    this.dialog.className = 'rte-dialog';\n    this.dialog.style.width = `${this.options.width}px`;\n    this.dialog.setAttribute('role', 'dialog');\n    this.dialog.setAttribute('aria-modal', 'true');\n    this.dialog.setAttribute('aria-labelledby', 'rte-dialog-title');\n\n    // Header\n    const header = document.createElement('div');\n    header.className = 'rte-dialog-header';\n\n    const title = document.createElement('h3');\n    title.id = 'rte-dialog-title';\n    title.className = 'rte-dialog-title';\n    title.textContent = window.translate?.(this.options.title) || this.options.title;\n    header.appendChild(title);\n\n    if (this.options.closable) {\n      const closeBtn = document.createElement('button');\n      closeBtn.type = 'button';\n      closeBtn.className = 'rte-dialog-close';\n      closeBtn.innerHTML = '&times;';\n      closeBtn.setAttribute('aria-label', window.translate?.('Close') || 'Close');\n      closeBtn.addEventListener('click', () => this.close());\n      header.appendChild(closeBtn);\n    }\n\n    // Body (to be filled by subclasses)\n    this.body = document.createElement('div');\n    this.body.className = 'rte-dialog-body';\n\n    // Footer\n    this.footer = document.createElement('div');\n    this.footer.className = 'rte-dialog-footer';\n\n    // Assemble dialog\n    this.dialog.appendChild(header);\n    this.dialog.appendChild(this.body);\n    this.dialog.appendChild(this.footer);\n    this.overlay.appendChild(this.dialog);\n\n    return this.overlay;\n  }\n\n  /**\n   * Build dialog body content (override in subclass)\n   */\n  buildBody() {\n    // Override in subclass\n  }\n\n  /**\n   * Build dialog footer (override in subclass)\n   */\n  buildFooter() {\n    // Default cancel and confirm buttons\n    const cancelBtn = document.createElement('button');\n    cancelBtn.type = 'button';\n    cancelBtn.className = 'rte-dialog-btn rte-dialog-btn-cancel';\n    cancelBtn.textContent = window.translate?.('Cancel') || 'Cancel';\n    cancelBtn.addEventListener('click', () => this.close());\n\n    const confirmBtn = document.createElement('button');\n    confirmBtn.type = 'button';\n    confirmBtn.className = 'rte-dialog-btn rte-dialog-btn-primary';\n    confirmBtn.textContent = window.translate?.('Confirm') || 'Confirm';\n    confirmBtn.addEventListener('click', () => this.handleConfirm());\n\n    this.footer.appendChild(cancelBtn);\n    this.footer.appendChild(confirmBtn);\n\n    this.confirmBtn = confirmBtn;\n    this.cancelBtn = cancelBtn;\n  }\n\n  /**\n   * Create form field\n   * @param {Object} config - Field configuration\n   * @returns {HTMLElement}\n   */\n  createField(config) {\n    const field = document.createElement('div');\n    field.className = 'rte-dialog-field';\n\n    if (config.label) {\n      const label = document.createElement('label');\n      label.className = 'rte-dialog-label';\n      label.textContent = window.translate?.(config.label) || config.label;\n      if (config.id) {\n        label.setAttribute('for', config.id);\n      }\n      field.appendChild(label);\n    }\n\n    let input;\n\n    switch (config.type) {\n      case 'text':\n      case 'url':\n      case 'email':\n      case 'number':\n        input = document.createElement('input');\n        input.type = config.type;\n        input.className = 'rte-dialog-input';\n        break;\n\n      case 'textarea':\n        input = document.createElement('textarea');\n        input.className = 'rte-dialog-textarea';\n        input.rows = config.rows || 3;\n        break;\n\n      case 'select':\n        input = document.createElement('select');\n        input.className = 'rte-dialog-select';\n        if (config.options) {\n          config.options.forEach(opt => {\n            const option = document.createElement('option');\n            option.value = opt.value;\n            option.textContent = window.translate?.(opt.label) || opt.label;\n            input.appendChild(option);\n          });\n        }\n        break;\n\n      case 'checkbox':\n        const checkWrapper = document.createElement('label');\n        checkWrapper.className = 'rte-dialog-checkbox';\n        input = document.createElement('input');\n        input.type = 'checkbox';\n        checkWrapper.appendChild(input);\n        const checkLabel = document.createElement('span');\n        checkLabel.textContent = window.translate?.(config.checkLabel) || config.checkLabel || '';\n        checkWrapper.appendChild(checkLabel);\n        field.appendChild(checkWrapper);\n        break;\n\n      default:\n        input = document.createElement('input');\n        input.type = 'text';\n        input.className = 'rte-dialog-input';\n    }\n\n    if (input && config.type !== 'checkbox') {\n      if (config.id) input.id = config.id;\n      if (config.name) input.name = config.name;\n      if (config.placeholder) input.placeholder = window.translate?.(config.placeholder) || config.placeholder;\n      if (config.value !== undefined) input.value = config.value;\n      if (config.required) input.required = true;\n      if (config.pattern) input.pattern = config.pattern;\n\n      field.appendChild(input);\n    } else if (config.type === 'checkbox' && input) {\n      if (config.id) input.id = config.id;\n      if (config.name) input.name = config.name;\n      if (config.checked) input.checked = true;\n    }\n\n    if (config.help) {\n      const help = document.createElement('div');\n      help.className = 'rte-dialog-help';\n      help.textContent = window.translate?.(config.help) || config.help;\n      field.appendChild(help);\n    }\n\n    return field;\n  }\n\n  /**\n   * Get input element from field\n   * @param {HTMLElement} field\n   * @returns {HTMLInputElement|HTMLTextAreaElement|HTMLSelectElement}\n   */\n  getInputFromField(field) {\n    return field.querySelector('input, textarea, select');\n  }\n\n  /**\n   * Open the dialog\n   * @param {Object} data - Initial data for the dialog\n   */\n  open(data = {}) {\n    if (this.isOpen) return;\n\n    // Save selection before opening\n    this.savedSelection = this.editor.selection?.saveSelection();\n\n    // Create dialog if not exists\n    if (!this.overlay) {\n      this.create();\n      this.buildBody();\n      this.buildFooter();\n    }\n\n    // Populate with data\n    this.populate(data);\n\n    // Add to DOM\n    document.body.appendChild(this.overlay);\n\n    // Show with animation\n    requestAnimationFrame(() => {\n      this.overlay.classList.add('open');\n      this.dialog.classList.add('open');\n    });\n\n    // Add event listeners\n    if (this.options.closeOnOverlay) {\n      this.overlay.addEventListener('click', this.handleOverlayClick);\n    }\n    if (this.options.closeOnEscape) {\n      document.addEventListener('keydown', this.handleKeyDown);\n    }\n\n    this.isOpen = true;\n\n    // Focus first input\n    this.focusFirst();\n\n    // Emit event\n    this.editor.events?.emit(EventBus.Events.DIALOG_OPEN, {dialog: this});\n  }\n\n  /**\n   * Close the dialog\n   */\n  close() {\n    if (!this.isOpen) return;\n\n    // Hide with animation\n    this.overlay.classList.remove('open');\n    this.dialog.classList.remove('open');\n\n    // Remove from DOM after animation\n    setTimeout(() => {\n      if (this.overlay && this.overlay.parentNode) {\n        this.overlay.parentNode.removeChild(this.overlay);\n      }\n    }, 200);\n\n    // Remove event listeners\n    this.overlay.removeEventListener('click', this.handleOverlayClick);\n    document.removeEventListener('keydown', this.handleKeyDown);\n\n    this.isOpen = false;\n\n    // Restore selection\n    if (this.savedSelection) {\n      this.editor.selection.savedSelection = this.savedSelection;\n      this.editor.selection.restoreSelection();\n      this.savedSelection = null;\n    }\n\n    // Emit event\n    this.editor.events?.emit(EventBus.Events.DIALOG_CLOSE, {dialog: this});\n  }\n\n  /**\n   * Populate dialog with data (override in subclass)\n   * @param {Object} data\n   */\n  populate(data) {\n    // Override in subclass\n  }\n\n  /**\n   * Get data from dialog (override in subclass)\n   * @returns {Object}\n   */\n  getData() {\n    // Override in subclass\n    return {};\n  }\n\n  /**\n   * Validate dialog data (override in subclass)\n   * @returns {boolean}\n   */\n  validate() {\n    // Override in subclass\n    return true;\n  }\n\n  /**\n   * Handle confirm button click\n   */\n  handleConfirm() {\n    if (!this.validate()) return;\n\n    const data = this.getData();\n    this.onConfirm(data);\n    this.close();\n  }\n\n  /**\n   * Called when dialog is confirmed (override in subclass)\n   * @param {Object} data\n   */\n  onConfirm(data) {\n    // Override in subclass\n  }\n\n  /**\n   * Handle overlay click\n   * @param {MouseEvent} event\n   */\n  handleOverlayClick(event) {\n    if (event.target === this.overlay) {\n      this.close();\n    }\n  }\n\n  /**\n   * Handle keydown\n   * @param {KeyboardEvent} event\n   */\n  handleKeyDown(event) {\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      this.close();\n    } else if (event.key === 'Enter' && !event.shiftKey) {\n      // Submit on Enter (unless in textarea)\n      if (event.target.tagName !== 'TEXTAREA') {\n        event.preventDefault();\n        this.handleConfirm();\n      }\n    }\n  }\n\n  /**\n   * Focus first input in dialog\n   */\n  focusFirst() {\n    const firstInput = this.body.querySelector('input, textarea, select');\n    if (firstInput) {\n      firstInput.focus();\n      if (firstInput.select) {\n        firstInput.select();\n      }\n    }\n  }\n\n  /**\n   * Show error message\n   * @param {string} message\n   * @param {HTMLElement} field - Field to highlight\n   */\n  showError(message, field = null) {\n    // Remove existing error\n    this.clearError();\n\n    // Create error element\n    const error = document.createElement('div');\n    error.className = 'rte-dialog-error';\n    error.textContent = window.translate?.(message) || message;\n\n    if (field) {\n      field.classList.add('error');\n      field.appendChild(error);\n    } else {\n      this.body.insertBefore(error, this.body.firstChild);\n    }\n  }\n\n  /**\n   * Clear error messages\n   */\n  clearError() {\n    const errors = this.body.querySelectorAll('.rte-dialog-error');\n    errors.forEach(e => e.remove());\n\n    const errorFields = this.body.querySelectorAll('.error');\n    errorFields.forEach(f => f.classList.remove('error'));\n  }\n\n  /**\n   * Set button loading state\n   * @param {boolean} loading\n   */\n  setLoading(loading) {\n    if (this.confirmBtn) {\n      this.confirmBtn.disabled = loading;\n      this.confirmBtn.classList.toggle('loading', loading);\n    }\n  }\n\n  /**\n   * Destroy dialog\n   */\n  destroy() {\n    this.close();\n    this.overlay = null;\n    this.dialog = null;\n    this.body = null;\n    this.footer = null;\n  }\n}\n\nexport default BaseDialog;\n","/**\n * LinkPlugin - Insert, edit, and remove links\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass LinkDialog extends BaseDialog {\n  constructor(editor) {\n    super(editor, {\n      title: 'Insert Link',\n      width: 400\n    });\n  }\n\n  buildBody() {\n    // URL field\n    this.urlField = this.createField({\n      type: 'url',\n      label: 'URL',\n      id: 'rte-link-url',\n      placeholder: 'https://example.com',\n      required: true\n    });\n    this.body.appendChild(this.urlField);\n\n    // Display text field\n    this.textField = this.createField({\n      type: 'text',\n      label: 'Display text',\n      id: 'rte-link-text',\n      placeholder: 'Link text'\n    });\n    this.body.appendChild(this.textField);\n\n    // Title field\n    this.titleField = this.createField({\n      type: 'text',\n      label: 'Title',\n      id: 'rte-link-title',\n      placeholder: 'Tooltip text (optional)'\n    });\n    this.body.appendChild(this.titleField);\n\n    // Open in new tab\n    this.newTabField = this.createField({\n      type: 'checkbox',\n      id: 'rte-link-newtab',\n      checkLabel: 'Open in new tab'\n    });\n    this.body.appendChild(this.newTabField);\n  }\n\n  buildFooter() {\n    // Remove link button (only when editing)\n    this.removeBtn = document.createElement('button');\n    this.removeBtn.type = 'button';\n    this.removeBtn.className = 'rte-dialog-btn rte-dialog-btn-danger';\n    this.removeBtn.textContent = this.translate('Remove link');\n    this.removeBtn.style.marginRight = 'auto';\n    this.removeBtn.style.display = 'none';\n    this.removeBtn.addEventListener('click', () => {\n      this.onRemove();\n      this.close();\n    });\n    this.footer.appendChild(this.removeBtn);\n\n    // Default cancel/confirm\n    super.buildFooter();\n  }\n\n  populate(data) {\n    const urlInput = this.urlField.querySelector('input');\n    const textInput = this.textField.querySelector('input');\n    const titleInput = this.titleField.querySelector('input');\n    const newTabInput = this.newTabField.querySelector('input');\n\n    urlInput.value = data.url || '';\n    textInput.value = data.text || '';\n    titleInput.value = data.title || '';\n    newTabInput.checked = data.newTab || false;\n\n    // Show remove button if editing existing link\n    this.removeBtn.style.display = data.isEdit ? 'block' : 'none';\n\n    // Store editing state\n    this.isEdit = data.isEdit || false;\n    this.existingLink = data.element || null;\n  }\n\n  getData() {\n    const urlInput = this.urlField.querySelector('input');\n    const textInput = this.textField.querySelector('input');\n    const titleInput = this.titleField.querySelector('input');\n    const newTabInput = this.newTabField.querySelector('input');\n\n    return {\n      url: urlInput.value.trim(),\n      text: textInput.value.trim(),\n      title: titleInput.value.trim(),\n      newTab: newTabInput.checked,\n      isEdit: this.isEdit,\n      existingLink: this.existingLink\n    };\n  }\n\n  validate() {\n    this.clearError();\n    const data = this.getData();\n\n    if (!data.url) {\n      this.showError('Please enter a URL', this.urlField);\n      return false;\n    }\n\n    // Basic URL validation\n    if (!data.url.match(/^(https?:\\/\\/|mailto:|tel:|#)/i)) {\n      // Auto-add https://\n      const urlInput = this.urlField.querySelector('input');\n      urlInput.value = 'https://' + data.url;\n    }\n\n    return true;\n  }\n\n  onRemove() {\n    // Override in plugin\n  }\n}\n\nclass LinkPlugin extends PluginBase {\n  static pluginName = 'link';\n\n  init() {\n    super.init();\n\n    // Create dialog\n    this.dialog = new LinkDialog(this.editor);\n    this.dialog.onConfirm = (data) => this.insertLink(data);\n    this.dialog.onRemove = () => this.removeLink();\n\n    // Register command\n    this.registerCommand('insertLink', {\n      execute: (data) => this.insertLink(data),\n      isActive: () => this.isInLink()\n    });\n\n    this.registerCommand('removeLink', {\n      execute: () => this.removeLink()\n    });\n\n    // Register shortcut\n    this.registerShortcut('ctrl+k', () => this.openDialog());\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'link') {\n        this.openDialog();\n      }\n    });\n  }\n\n  /**\n   * Open link dialog\n   */\n  openDialog() {\n    // Selection is already saved by toolbar's mousedown handler\n    // Restore it temporarily to check if we're editing existing link\n    this.restoreSelection();\n\n    const link = this.getSelection().getAncestor('a');\n    const selectedText = this.getSelection().getSelectedText();\n\n    const data = {\n      url: '',\n      text: selectedText,\n      title: '',\n      newTab: false,\n      isEdit: false,\n      element: null\n    };\n\n    if (link) {\n      data.url = link.href;\n      data.text = link.textContent;\n      data.title = link.title || '';\n      data.newTab = link.target === '_blank';\n      data.isEdit = true;\n      data.element = link;\n    }\n\n    this.dialog.open(data);\n  }\n\n  /**\n   * Insert or update link\n   * @param {Object} data - Link data\n   */\n  insertLink(data) {\n    this.restoreSelection();\n\n    if (data.isEdit && data.existingLink) {\n      // Update existing link\n      data.existingLink.href = data.url;\n      data.existingLink.title = data.title || '';\n\n      if (data.newTab) {\n        data.existingLink.target = '_blank';\n        data.existingLink.rel = 'noopener noreferrer';\n      } else {\n        data.existingLink.removeAttribute('target');\n        data.existingLink.removeAttribute('rel');\n      }\n\n      if (data.text) {\n        data.existingLink.textContent = data.text;\n      }\n    } else {\n      // Create new link\n      const text = data.text || data.url;\n      let html = `<a href=\"${this.escapeHtml(data.url)}\"`;\n\n      if (data.title) {\n        html += ` title=\"${this.escapeHtml(data.title)}\"`;\n      }\n\n      if (data.newTab) {\n        html += ' target=\"_blank\" rel=\"noopener noreferrer\"';\n      }\n\n      html += `>${this.escapeHtml(text)}</a>`;\n\n      // If there's a selection, wrap it\n      if (this.getSelection().hasSelection()) {\n        this.execute('createLink', data.url);\n        // Update the created link with additional attributes\n        const newLink = this.getSelection().getAncestor('a');\n        if (newLink) {\n          if (data.title) newLink.title = data.title;\n          if (data.newTab) {\n            newLink.target = '_blank';\n            newLink.rel = 'noopener noreferrer';\n          }\n        }\n      } else {\n        this.insertHtml(html);\n      }\n    }\n\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  /**\n   * Remove link\n   */\n  removeLink() {\n    this.restoreSelection();\n    this.execute('unlink');\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  /**\n   * Check if cursor is in a link\n   * @returns {boolean}\n   */\n  isInLink() {\n    return this.getSelection().containsElement('a');\n  }\n\n  /**\n   * Escape HTML entities\n   * @param {string} str\n   * @returns {string}\n   */\n  escapeHtml(str) {\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n\n  destroy() {\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\nexport default LinkPlugin;\n","/**\n * ImagePlugin - Insert and manage images\n * Integrates with FileBrowser for file selection\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass ImageDialog extends BaseDialog {\n  constructor(editor, options = {}) {\n    super(editor, {\n      title: 'Insert Image',\n      width: 500\n    });\n    this.pluginOptions = options;\n  }\n\n  buildBody() {\n    // Tab navigation\n    const tabs = document.createElement('div');\n    tabs.className = 'rte-dialog-tabs';\n\n    const urlTab = document.createElement('button');\n    urlTab.type = 'button';\n    urlTab.className = 'rte-dialog-tab active';\n    urlTab.textContent = this.translate('URL');\n    urlTab.dataset.tab = 'url';\n\n    const uploadTab = document.createElement('button');\n    uploadTab.type = 'button';\n    uploadTab.className = 'rte-dialog-tab';\n    uploadTab.textContent = this.translate('Upload');\n    uploadTab.dataset.tab = 'upload';\n\n    tabs.appendChild(urlTab);\n    tabs.appendChild(uploadTab);\n    this.body.appendChild(tabs);\n\n    // Tab contents\n    this.urlContent = document.createElement('div');\n    this.urlContent.className = 'rte-dialog-tab-content active';\n    this.urlContent.dataset.tab = 'url';\n\n    this.uploadContent = document.createElement('div');\n    this.uploadContent.className = 'rte-dialog-tab-content';\n    this.uploadContent.dataset.tab = 'upload';\n\n    // URL tab content\n    this.urlField = this.createField({\n      type: 'url',\n      label: 'Image URL',\n      id: 'rte-image-url',\n      placeholder: 'https://example.com/image.jpg'\n    });\n    this.urlContent.appendChild(this.urlField);\n\n    // Upload tab content\n    const uploadZone = document.createElement('div');\n    uploadZone.className = 'rte-upload-zone';\n    uploadZone.innerHTML = `\n      <div class=\"rte-upload-icon\">📷</div>\n      <div class=\"rte-upload-text\">${this.translate('Drop image here or click to browse')}</div>\n      <input type=\"file\" accept=\"image/*\" style=\"display: none;\">\n    `;\n\n    this.fileInput = uploadZone.querySelector('input[type=\"file\"]');\n    uploadZone.addEventListener('click', () => this.fileInput.click());\n    uploadZone.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      uploadZone.classList.add('dragover');\n    });\n    uploadZone.addEventListener('dragleave', () => {\n      uploadZone.classList.remove('dragover');\n    });\n    uploadZone.addEventListener('drop', (e) => {\n      e.preventDefault();\n      uploadZone.classList.remove('dragover');\n      if (e.dataTransfer.files[0]) {\n        this.handleFileSelect(e.dataTransfer.files[0]);\n      }\n    });\n    this.fileInput.addEventListener('change', (e) => {\n      if (e.target.files[0]) {\n        this.handleFileSelect(e.target.files[0]);\n      }\n    });\n\n    this.uploadContent.appendChild(uploadZone);\n\n    // Preview area\n    this.previewArea = document.createElement('div');\n    this.previewArea.className = 'rte-image-preview';\n    this.previewArea.style.display = 'none';\n    this.uploadContent.appendChild(this.previewArea);\n\n    // FileBrowser button\n    if (this.pluginOptions.fileBrowser?.enabled !== false) {\n      const browseBtn = document.createElement('button');\n      browseBtn.type = 'button';\n      browseBtn.className = 'rte-dialog-btn rte-dialog-btn-secondary';\n      browseBtn.style.marginTop = '12px';\n      browseBtn.textContent = this.translate('Browse files');\n      browseBtn.addEventListener('click', () => this.openFileBrowser());\n      this.uploadContent.appendChild(browseBtn);\n    }\n\n    this.body.appendChild(this.urlContent);\n    this.body.appendChild(this.uploadContent);\n\n    // Common fields (shown for both tabs)\n    const commonFields = document.createElement('div');\n    commonFields.className = 'rte-dialog-common-fields';\n    commonFields.style.marginTop = '16px';\n    commonFields.style.paddingTop = '16px';\n    commonFields.style.borderTop = '1px solid var(--rte-border-color)';\n\n    // Alt text\n    this.altField = this.createField({\n      type: 'text',\n      label: 'Alt text',\n      id: 'rte-image-alt',\n      placeholder: 'Description for accessibility'\n    });\n    commonFields.appendChild(this.altField);\n\n    // Width/Height\n    const sizeRow = document.createElement('div');\n    sizeRow.style.display = 'flex';\n    sizeRow.style.gap = '12px';\n\n    this.widthField = this.createField({\n      type: 'number',\n      label: 'Width',\n      id: 'rte-image-width',\n      placeholder: 'Auto'\n    });\n    this.widthField.style.flex = '1';\n\n    this.heightField = this.createField({\n      type: 'number',\n      label: 'Height',\n      id: 'rte-image-height',\n      placeholder: 'Auto'\n    });\n    this.heightField.style.flex = '1';\n\n    sizeRow.appendChild(this.widthField);\n    sizeRow.appendChild(this.heightField);\n    commonFields.appendChild(sizeRow);\n\n    // Alignment\n    this.alignField = this.createField({\n      type: 'select',\n      label: 'Alignment',\n      id: 'rte-image-align',\n      options: [\n        {value: '', label: 'None'},\n        {value: 'left', label: 'Left'},\n        {value: 'center', label: 'Center'},\n        {value: 'right', label: 'Right'}\n      ]\n    });\n    commonFields.appendChild(this.alignField);\n\n    this.body.appendChild(commonFields);\n\n    // Tab switching\n    tabs.addEventListener('click', (e) => {\n      if (e.target.classList.contains('rte-dialog-tab')) {\n        tabs.querySelectorAll('.rte-dialog-tab').forEach(t => t.classList.remove('active'));\n        e.target.classList.add('active');\n\n        const tabName = e.target.dataset.tab;\n        this.body.querySelectorAll('.rte-dialog-tab-content').forEach(c => {\n          c.classList.toggle('active', c.dataset.tab === tabName);\n        });\n      }\n    });\n\n    // Add tab styles\n    this.addTabStyles();\n  }\n\n  addTabStyles() {\n    if (document.getElementById('rte-image-dialog-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'rte-image-dialog-styles';\n    style.textContent = `\n      .rte-dialog-tabs {\n        display: flex;\n        gap: 4px;\n        margin-bottom: 16px;\n        border-bottom: 1px solid var(--rte-border-color);\n      }\n      .rte-dialog-tab {\n        padding: 8px 16px;\n        border: none;\n        background: none;\n        color: var(--rte-text-secondary);\n        cursor: pointer;\n        border-bottom: 2px solid transparent;\n        transition: all 0.2s;\n      }\n      .rte-dialog-tab.active {\n        color: var(--rte-primary-color);\n        border-bottom-color: var(--rte-primary-color);\n      }\n      .rte-dialog-tab-content {\n        display: none;\n      }\n      .rte-dialog-tab-content.active {\n        display: block;\n      }\n      .rte-upload-zone {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 32px;\n        border: 2px dashed var(--rte-border-color);\n        border-radius: 8px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .rte-upload-zone:hover,\n      .rte-upload-zone.dragover {\n        border-color: var(--rte-primary-color);\n        background: var(--rte-primary-light);\n      }\n      .rte-upload-icon {\n        font-size: 48px;\n        margin-bottom: 8px;\n      }\n      .rte-upload-text {\n        color: var(--rte-text-secondary);\n      }\n      .rte-image-preview {\n        margin-top: 12px;\n        text-align: center;\n      }\n      .rte-image-preview img {\n        max-width: 100%;\n        max-height: 200px;\n        border-radius: 4px;\n      }\n      .rte-dialog-btn-secondary {\n        background: var(--rte-bg-secondary);\n        border: 1px solid var(--rte-border-color);\n        color: var(--rte-text-color);\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  handleFileSelect(file) {\n    if (!file.type.startsWith('image/')) {\n      this.showError('Please select an image file');\n      return;\n    }\n\n    // Store file for upload\n    this.selectedFile = file;\n\n    // Show preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      this.previewArea.innerHTML = `<img src=\"${e.target.result}\" alt=\"Preview\">`;\n      this.previewArea.style.display = 'block';\n      this.previewDataUrl = e.target.result;\n    };\n    reader.readAsDataURL(file);\n  }\n\n  openFileBrowser() {\n    if (typeof FileBrowser !== 'undefined') {\n      const fb = new FileBrowser({\n        ...this.pluginOptions.fileBrowser?.options,\n        allowedFileTypes: 'image/*',\n        multiSelect: false,\n        onSelect: (file) => {\n          const urlInput = this.urlField.querySelector('input');\n          urlInput.value = file.url;\n\n          // Switch to URL tab\n          this.body.querySelectorAll('.rte-dialog-tab').forEach(t => {\n            t.classList.toggle('active', t.dataset.tab === 'url');\n          });\n          this.body.querySelectorAll('.rte-dialog-tab-content').forEach(c => {\n            c.classList.toggle('active', c.dataset.tab === 'url');\n          });\n        }\n      });\n      fb.open();\n    }\n  }\n\n  populate(data) {\n    const urlInput = this.urlField.querySelector('input');\n    const altInput = this.altField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n    const heightInput = this.heightField.querySelector('input');\n    const alignSelect = this.alignField.querySelector('select');\n\n    urlInput.value = data.src || '';\n    altInput.value = data.alt || '';\n    widthInput.value = data.width || '';\n    heightInput.value = data.height || '';\n    alignSelect.value = data.align || '';\n\n    this.selectedFile = null;\n    this.previewDataUrl = null;\n    this.previewArea.style.display = 'none';\n\n    // Store editing state\n    this.isEdit = data.isEdit || false;\n    this.existingImage = data.element || null;\n  }\n\n  getData() {\n    const urlInput = this.urlField.querySelector('input');\n    const altInput = this.altField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n    const heightInput = this.heightField.querySelector('input');\n    const alignSelect = this.alignField.querySelector('select');\n\n    return {\n      src: urlInput.value.trim() || this.previewDataUrl,\n      alt: altInput.value.trim(),\n      width: widthInput.value.trim(),\n      height: heightInput.value.trim(),\n      align: alignSelect.value,\n      file: this.selectedFile,\n      isEdit: this.isEdit,\n      existingImage: this.existingImage\n    };\n  }\n\n  validate() {\n    this.clearError();\n    const data = this.getData();\n\n    if (!data.src && !data.file) {\n      this.showError('Please provide an image URL or upload a file');\n      return false;\n    }\n\n    return true;\n  }\n}\n\nclass ImagePlugin extends PluginBase {\n  static pluginName = 'image';\n\n  init() {\n    super.init();\n\n    // Create dialog\n    this.dialog = new ImageDialog(this.editor, this.options);\n    this.dialog.onConfirm = (data) => this.insertImage(data);\n\n    // Register command\n    this.registerCommand('insertImage', {\n      execute: (data) => this.insertImage(data)\n    });\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'image') {\n        this.openDialog();\n      }\n    });\n\n    // Listen for file drops\n    this.subscribe('content:drop', (event) => {\n      const imageFiles = event.files.filter(f => f.type.startsWith('image/'));\n      if (imageFiles.length > 0) {\n        event.event.preventDefault();\n        this.handleDroppedFiles(imageFiles);\n      }\n    });\n  }\n\n  /**\n   * Open image dialog\n   */\n  openDialog() {\n    // Restore selection (saved by toolbar's mousedown) to check if on image\n    this.restoreSelection();\n\n    // Check if cursor is on an image\n    const img = this.getSelectedImage();\n\n    const data = {\n      src: '',\n      alt: '',\n      width: '',\n      height: '',\n      align: '',\n      isEdit: false,\n      element: null\n    };\n\n    if (img) {\n      data.src = img.src;\n      data.alt = img.alt;\n      data.width = img.width || '';\n      data.height = img.height || '';\n      data.align = this.getImageAlignment(img);\n      data.isEdit = true;\n      data.element = img;\n    }\n\n    this.dialog.open(data);\n  }\n\n  /**\n   * Get selected image\n   * @returns {HTMLImageElement|null}\n   */\n  getSelectedImage() {\n    const selection = this.getSelection();\n    const range = selection.getRange();\n\n    if (range && range.collapsed) {\n      const node = range.startContainer;\n      if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'IMG') {\n        return node;\n      }\n      if (node.parentElement && node.parentElement.tagName === 'IMG') {\n        return node.parentElement;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get image alignment\n   * @param {HTMLImageElement} img\n   * @returns {string}\n   */\n  getImageAlignment(img) {\n    const style = img.style;\n    if (style.float === 'left') return 'left';\n    if (style.float === 'right') return 'right';\n    if (style.display === 'block' && style.marginLeft === 'auto' && style.marginRight === 'auto') {\n      return 'center';\n    }\n    return '';\n  }\n\n  /**\n   * Insert or update image\n   * @param {Object} data - Image data\n   */\n  async insertImage(data) {\n    let src = data.src;\n\n    // If there's a file to upload\n    if (data.file && this.options.uploadUrl) {\n      try {\n        src = await this.uploadImage(data.file);\n      } catch (error) {\n        this.notify('Failed to upload image', 'error');\n        return;\n      }\n    }\n\n    this.restoreSelection();\n\n    if (data.isEdit && data.existingImage) {\n      // Update existing image\n      const img = data.existingImage;\n      img.src = src;\n      img.alt = data.alt;\n\n      if (data.width) img.width = parseInt(data.width);\n      else img.removeAttribute('width');\n\n      if (data.height) img.height = parseInt(data.height);\n      else img.removeAttribute('height');\n\n      this.applyImageAlignment(img, data.align);\n    } else {\n      // Create new image\n      const img = document.createElement('img');\n      img.src = src;\n      img.alt = data.alt;\n\n      if (data.width) img.width = parseInt(data.width);\n      if (data.height) img.height = parseInt(data.height);\n\n      this.applyImageAlignment(img, data.align);\n\n      this.insertHtml(img.outerHTML);\n    }\n\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  /**\n   * Apply alignment to image\n   * @param {HTMLImageElement} img\n   * @param {string} align\n   */\n  applyImageAlignment(img, align) {\n    img.style.float = '';\n    img.style.display = '';\n    img.style.marginLeft = '';\n    img.style.marginRight = '';\n\n    switch (align) {\n      case 'left':\n        img.style.float = 'left';\n        img.style.marginRight = '1em';\n        break;\n      case 'right':\n        img.style.float = 'right';\n        img.style.marginLeft = '1em';\n        break;\n      case 'center':\n        img.style.display = 'block';\n        img.style.marginLeft = 'auto';\n        img.style.marginRight = 'auto';\n        break;\n    }\n  }\n\n  /**\n   * Upload image to server\n   * @param {File} file\n   * @returns {Promise<string>} Image URL\n   */\n  async uploadImage(file) {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    if (this.options.uploadPath) {\n      formData.append('path', this.options.uploadPath);\n    }\n\n    const response = await fetch(this.options.uploadUrl, {\n      method: 'POST',\n      body: formData,\n      credentials: 'include'\n    });\n\n    if (!response.ok) {\n      throw new Error('Upload failed');\n    }\n\n    const result = await response.json();\n    return result.url || result.data?.url;\n  }\n\n  /**\n   * Handle dropped files\n   * @param {File[]} files\n   */\n  handleDroppedFiles(files) {\n    files.forEach(async (file) => {\n      if (this.options.uploadUrl) {\n        try {\n          const url = await this.uploadImage(file);\n          this.insertImage({src: url, alt: file.name});\n        } catch (error) {\n          this.notify('Failed to upload image', 'error');\n        }\n      } else {\n        // Use data URL as fallback\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          this.insertImage({src: e.target.result, alt: file.name});\n        };\n        reader.readAsDataURL(file);\n      }\n    });\n  }\n\n  destroy() {\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\nexport default ImagePlugin;\n","/**\n * TablePlugin - Insert and manage tables\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass TableDialog extends BaseDialog {\n  constructor(editor) {\n    super(editor, {\n      title: 'Insert Table',\n      width: 350\n    });\n  }\n\n  buildBody() {\n    // Rows field\n    this.rowsField = this.createField({\n      type: 'number',\n      label: 'Rows',\n      id: 'rte-table-rows',\n      value: 3,\n      placeholder: '3'\n    });\n    const rowsInput = this.rowsField.querySelector('input');\n    rowsInput.min = 1;\n    rowsInput.max = 50;\n    this.body.appendChild(this.rowsField);\n\n    // Columns field\n    this.colsField = this.createField({\n      type: 'number',\n      label: 'Columns',\n      id: 'rte-table-cols',\n      value: 3,\n      placeholder: '3'\n    });\n    const colsInput = this.colsField.querySelector('input');\n    colsInput.min = 1;\n    colsInput.max = 20;\n    this.body.appendChild(this.colsField);\n\n    // Header row checkbox\n    this.headerField = this.createField({\n      type: 'checkbox',\n      id: 'rte-table-header',\n      checkLabel: 'First row as header',\n      checked: true\n    });\n    this.body.appendChild(this.headerField);\n\n    // Border checkbox\n    this.borderField = this.createField({\n      type: 'checkbox',\n      id: 'rte-table-border',\n      checkLabel: 'Show border',\n      checked: true\n    });\n    this.body.appendChild(this.borderField);\n\n    // Width field\n    this.widthField = this.createField({\n      type: 'text',\n      label: 'Width',\n      id: 'rte-table-width',\n      placeholder: '100% or 500px'\n    });\n    this.body.appendChild(this.widthField);\n  }\n\n  populate(data) {\n    const rowsInput = this.rowsField.querySelector('input');\n    const colsInput = this.colsField.querySelector('input');\n    const headerInput = this.headerField.querySelector('input');\n    const borderInput = this.borderField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n\n    rowsInput.value = data.rows || 3;\n    colsInput.value = data.cols || 3;\n    headerInput.checked = data.hasHeader !== false;\n    borderInput.checked = data.hasBorder !== false;\n    widthInput.value = data.width || '100%';\n  }\n\n  getData() {\n    const rowsInput = this.rowsField.querySelector('input');\n    const colsInput = this.colsField.querySelector('input');\n    const headerInput = this.headerField.querySelector('input');\n    const borderInput = this.borderField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n\n    return {\n      rows: parseInt(rowsInput.value) || 3,\n      cols: parseInt(colsInput.value) || 3,\n      hasHeader: headerInput.checked,\n      hasBorder: borderInput.checked,\n      width: widthInput.value.trim() || '100%'\n    };\n  }\n\n  validate() {\n    this.clearError();\n    const data = this.getData();\n\n    if (data.rows < 1 || data.rows > 50) {\n      this.showError('Rows must be between 1 and 50', this.rowsField);\n      return false;\n    }\n\n    if (data.cols < 1 || data.cols > 20) {\n      this.showError('Columns must be between 1 and 20', this.colsField);\n      return false;\n    }\n\n    return true;\n  }\n}\n\nclass TablePlugin extends PluginBase {\n  static pluginName = 'table';\n\n  init() {\n    super.init();\n\n    // Create dialog\n    this.dialog = new TableDialog(this.editor);\n    this.dialog.onConfirm = (data) => this.insertTable(data);\n\n    // Create context menu for table operations\n    this.setupContextMenu();\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'table') {\n        this.openDialog();\n      }\n    });\n\n    // Register commands\n    this.registerCommand('insertTable', {\n      execute: (data) => this.insertTable(data)\n    });\n\n    this.registerCommand('addRowBefore', {\n      execute: () => this.addRow('before')\n    });\n\n    this.registerCommand('addRowAfter', {\n      execute: () => this.addRow('after')\n    });\n\n    this.registerCommand('addColBefore', {\n      execute: () => this.addColumn('before')\n    });\n\n    this.registerCommand('addColAfter', {\n      execute: () => this.addColumn('after')\n    });\n\n    this.registerCommand('deleteRow', {\n      execute: () => this.deleteRow()\n    });\n\n    this.registerCommand('deleteCol', {\n      execute: () => this.deleteColumn()\n    });\n\n    this.registerCommand('deleteTable', {\n      execute: () => this.deleteTable()\n    });\n  }\n\n  /**\n   * Setup context menu for table operations\n   */\n  setupContextMenu() {\n    const contentEl = this.editor.contentArea?.getElement();\n    if (!contentEl) return;\n\n    contentEl.addEventListener('contextmenu', (e) => {\n      const cell = e.target.closest('td, th');\n      if (!cell) return;\n\n      e.preventDefault();\n      this.showTableContextMenu(e, cell);\n    });\n  }\n\n  /**\n   * Show table context menu\n   * @param {MouseEvent} event\n   * @param {HTMLTableCellElement} cell\n   */\n  showTableContextMenu(event, cell) {\n    // Remove existing context menu\n    this.hideContextMenu();\n\n    const menu = document.createElement('div');\n    menu.className = 'rte-table-context-menu';\n    menu.style.cssText = `\n      position: fixed;\n      left: ${event.clientX}px;\n      top: ${event.clientY}px;\n      background: var(--rte-bg-color, #fff);\n      border: 1px solid var(--rte-border-color, #ddd);\n      border-radius: 6px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      padding: 4px 0;\n      z-index: 10001;\n      min-width: 180px;\n    `;\n\n    const menuItems = [\n      {label: 'Insert row above', action: () => this.addRow('before')},\n      {label: 'Insert row below', action: () => this.addRow('after')},\n      {type: 'separator'},\n      {label: 'Insert column left', action: () => this.addColumn('before')},\n      {label: 'Insert column right', action: () => this.addColumn('after')},\n      {type: 'separator'},\n      {label: 'Delete row', action: () => this.deleteRow()},\n      {label: 'Delete column', action: () => this.deleteColumn()},\n      {type: 'separator'},\n      {label: 'Delete table', action: () => this.deleteTable(), danger: true}\n    ];\n\n    menuItems.forEach(item => {\n      if (item.type === 'separator') {\n        const sep = document.createElement('div');\n        sep.style.cssText = 'height: 1px; background: var(--rte-border-color, #ddd); margin: 4px 0;';\n        menu.appendChild(sep);\n      } else {\n        const btn = document.createElement('button');\n        btn.type = 'button';\n        btn.textContent = this.translate(item.label);\n        btn.style.cssText = `\n          display: block;\n          width: 100%;\n          padding: 8px 16px;\n          border: none;\n          background: transparent;\n          text-align: left;\n          cursor: pointer;\n          color: ${item.danger ? '#f44336' : 'inherit'};\n        `;\n        btn.addEventListener('mouseover', () => {\n          btn.style.background = 'var(--rte-bg-hover, #f0f0f0)';\n        });\n        btn.addEventListener('mouseout', () => {\n          btn.style.background = 'transparent';\n        });\n        btn.addEventListener('click', () => {\n          this.hideContextMenu();\n          item.action();\n        });\n        menu.appendChild(btn);\n      }\n    });\n\n    document.body.appendChild(menu);\n    this.contextMenu = menu;\n\n    // Store current cell for operations\n    this.currentCell = cell;\n\n    // Close on outside click\n    const closeHandler = (e) => {\n      if (!menu.contains(e.target)) {\n        this.hideContextMenu();\n        document.removeEventListener('click', closeHandler);\n      }\n    };\n    setTimeout(() => {\n      document.addEventListener('click', closeHandler);\n    }, 0);\n  }\n\n  /**\n   * Hide context menu\n   */\n  hideContextMenu() {\n    if (this.contextMenu) {\n      this.contextMenu.remove();\n      this.contextMenu = null;\n    }\n  }\n\n  /**\n   * Open table dialog\n   */\n  openDialog() {\n    this.saveSelection();\n    this.dialog.open({});\n  }\n\n  /**\n   * Insert table\n   * @param {Object} data - Table data\n   */\n  insertTable(data) {\n    this.restoreSelection();\n\n    const {rows, cols, hasHeader, hasBorder, width} = data;\n\n    let html = `<table style=\"width: ${width}; border-collapse: collapse;\">`;\n\n    for (let r = 0; r < rows; r++) {\n      html += '<tr>';\n      for (let c = 0; c < cols; c++) {\n        const isHeader = hasHeader && r === 0;\n        const tag = isHeader ? 'th' : 'td';\n        const borderStyle = hasBorder ? 'border: 1px solid #ddd;' : '';\n        const headerBg = isHeader ? 'background: #f5f5f5;' : '';\n\n        html += `<${tag} style=\"${borderStyle} ${headerBg} padding: 8px;\">&nbsp;</${tag}>`;\n      }\n      html += '</tr>';\n    }\n\n    html += '</table><p></p>';\n\n    this.insertHtml(html);\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  /**\n   * Get current table context\n   * @returns {Object|null}\n   */\n  getTableContext() {\n    const cell = this.currentCell || this.getSelection()?.getAncestor('td, th');\n    if (!cell) return null;\n\n    const row = cell.parentElement;\n    const table = cell.closest('table');\n    if (!table || !row) return null;\n\n    const cells = Array.from(row.cells);\n    const colIndex = cells.indexOf(cell);\n    const rows = Array.from(table.rows);\n    const rowIndex = rows.indexOf(row);\n\n    return {table, row, cell, rowIndex, colIndex};\n  }\n\n  /**\n   * Add row\n   * @param {string} position - 'before' or 'after'\n   */\n  addRow(position) {\n    const ctx = this.getTableContext();\n    if (!ctx) return;\n\n    const colCount = ctx.row.cells.length;\n    const newRow = ctx.table.insertRow(position === 'before' ? ctx.rowIndex : ctx.rowIndex + 1);\n\n    for (let i = 0; i < colCount; i++) {\n      const cell = newRow.insertCell();\n      cell.innerHTML = '&nbsp;';\n      cell.style.cssText = ctx.row.cells[0]?.style.cssText || 'border: 1px solid #ddd; padding: 8px;';\n    }\n\n    this.recordHistory(true);\n  }\n\n  /**\n   * Add column\n   * @param {string} position - 'before' or 'after'\n   */\n  addColumn(position) {\n    const ctx = this.getTableContext();\n    if (!ctx) return;\n\n    const insertIndex = position === 'before' ? ctx.colIndex : ctx.colIndex + 1;\n\n    Array.from(ctx.table.rows).forEach((row, rowIndex) => {\n      const isHeader = rowIndex === 0 && row.cells[0]?.tagName === 'TH';\n      const cell = row.insertCell(insertIndex);\n\n      if (isHeader) {\n        // Convert to th\n        const th = document.createElement('th');\n        th.innerHTML = '&nbsp;';\n        th.style.cssText = row.cells[0]?.style.cssText || 'border: 1px solid #ddd; padding: 8px; background: #f5f5f5;';\n        row.replaceChild(th, cell);\n      } else {\n        cell.innerHTML = '&nbsp;';\n        cell.style.cssText = row.cells[0]?.style.cssText || 'border: 1px solid #ddd; padding: 8px;';\n      }\n    });\n\n    this.recordHistory(true);\n  }\n\n  /**\n   * Delete row\n   */\n  deleteRow() {\n    const ctx = this.getTableContext();\n    if (!ctx) return;\n\n    if (ctx.table.rows.length <= 1) {\n      this.deleteTable();\n      return;\n    }\n\n    ctx.table.deleteRow(ctx.rowIndex);\n    this.recordHistory(true);\n  }\n\n  /**\n   * Delete column\n   */\n  deleteColumn() {\n    const ctx = this.getTableContext();\n    if (!ctx) return;\n\n    if (ctx.row.cells.length <= 1) {\n      this.deleteTable();\n      return;\n    }\n\n    Array.from(ctx.table.rows).forEach(row => {\n      if (row.cells[ctx.colIndex]) {\n        row.deleteCell(ctx.colIndex);\n      }\n    });\n\n    this.recordHistory(true);\n  }\n\n  /**\n   * Delete entire table\n   */\n  deleteTable() {\n    const ctx = this.getTableContext();\n    if (!ctx) return;\n\n    ctx.table.remove();\n    this.recordHistory(true);\n  }\n\n  destroy() {\n    this.hideContextMenu();\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\nexport default TablePlugin;\n","/**\n * VideoPlugin - Embed videos from YouTube, Vimeo, or custom URLs\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass VideoDialog extends BaseDialog {\n  constructor(editor) {\n    super(editor, {\n      title: 'Insert Video',\n      width: 500\n    });\n  }\n\n  buildBody() {\n    // URL field\n    this.urlField = this.createField({\n      type: 'url',\n      label: 'Video URL',\n      id: 'rte-video-url',\n      placeholder: 'https://www.youtube.com/watch?v=...',\n      help: 'Supports YouTube, Vimeo, or direct video URLs'\n    });\n    this.body.appendChild(this.urlField);\n\n    // Preview area\n    this.previewArea = document.createElement('div');\n    this.previewArea.className = 'rte-video-preview';\n    this.previewArea.style.cssText = `\n      margin-top: 16px;\n      padding: 16px;\n      background: var(--rte-bg-secondary);\n      border-radius: 6px;\n      display: none;\n    `;\n    this.body.appendChild(this.previewArea);\n\n    // width/height row\n    const sizeRow = document.createElement('div');\n    sizeRow.style.display = 'flex';\n    sizeRow.style.gap = '12px';\n    sizeRow.style.marginTop = '16px';\n\n    this.widthField = this.createField({\n      type: 'text',\n      label: 'Width',\n      id: 'rte-video-width',\n      value: '100%',\n      placeholder: '100% or 560px'\n    });\n    this.widthField.style.flex = '1';\n\n    this.heightField = this.createField({\n      type: 'text',\n      label: 'Height',\n      id: 'rte-video-height',\n      value: '315',\n      placeholder: '315'\n    });\n    this.heightField.style.flex = '1';\n\n    sizeRow.appendChild(this.widthField);\n    sizeRow.appendChild(this.heightField);\n    this.body.appendChild(sizeRow);\n\n    // Responsive checkbox\n    this.responsiveField = this.createField({\n      type: 'checkbox',\n      id: 'rte-video-responsive',\n      checkLabel: 'Make video responsive (16:9)',\n      checked: true\n    });\n    this.body.appendChild(this.responsiveField);\n\n    // Auto-preview on URL change\n    const urlInput = this.urlField.querySelector('input');\n    urlInput.addEventListener('input', () => {\n      this.updatePreview();\n    });\n  }\n\n  updatePreview() {\n    const urlInput = this.urlField.querySelector('input');\n    const url = urlInput.value.trim();\n\n    if (!url) {\n      this.previewArea.style.display = 'none';\n      return;\n    }\n\n    const embedUrl = this.getEmbedUrl(url);\n    if (embedUrl) {\n      this.previewArea.style.display = 'block';\n      this.previewArea.innerHTML = `\n        <div style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\">\n          <iframe src=\"${embedUrl}\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;\" allowfullscreen></iframe>\n        </div>\n      `;\n    } else {\n      this.previewArea.style.display = 'block';\n      this.previewArea.innerHTML = `<p style=\"color: var(--rte-text-muted); text-align: center;\">Cannot preview this URL</p>`;\n    }\n  }\n\n  getEmbedUrl(url) {\n    // YouTube\n    let match = url.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/ ]{11})/);\n    if (match) {\n      return `https://www.youtube.com/embed/${match[1]}`;\n    }\n\n    // Vimeo\n    match = url.match(/(?:vimeo\\.com\\/)(\\d+)/);\n    if (match) {\n      return `https://player.vimeo.com/video/${match[1]}`;\n    }\n\n    // Direct video URL\n    if (url.match(/\\.(mp4|webm|ogg)$/i)) {\n      return null; // Will use video tag instead\n    }\n\n    return null;\n  }\n\n  populate(data) {\n    const urlInput = this.urlField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n    const heightInput = this.heightField.querySelector('input');\n    const responsiveInput = this.responsiveField.querySelector('input');\n\n    urlInput.value = data.url || '';\n    widthInput.value = data.width || '100%';\n    heightInput.value = data.height || '315';\n    responsiveInput.checked = data.responsive !== false;\n\n    if (data.url) {\n      this.updatePreview();\n    }\n  }\n\n  getData() {\n    const urlInput = this.urlField.querySelector('input');\n    const widthInput = this.widthField.querySelector('input');\n    const heightInput = this.heightField.querySelector('input');\n    const responsiveInput = this.responsiveField.querySelector('input');\n\n    return {\n      url: urlInput.value.trim(),\n      width: widthInput.value.trim() || '100%',\n      height: heightInput.value.trim() || '315',\n      responsive: responsiveInput.checked\n    };\n  }\n\n  validate() {\n    this.clearError();\n    const data = this.getData();\n\n    if (!data.url) {\n      this.showError('Please enter a video URL', this.urlField);\n      return false;\n    }\n\n    return true;\n  }\n}\n\nclass VideoPlugin extends PluginBase {\n  static pluginName = 'video';\n\n  init() {\n    super.init();\n\n    // Create dialog\n    this.dialog = new VideoDialog(this.editor);\n    this.dialog.onConfirm = (data) => this.insertVideo(data);\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'video') {\n        this.openDialog();\n      }\n    });\n\n    // Register command\n    this.registerCommand('insertVideo', {\n      execute: (data) => this.insertVideo(data)\n    });\n  }\n\n  /**\n   * Open video dialog\n   */\n  openDialog() {\n    this.saveSelection();\n    this.dialog.open({});\n  }\n\n  /**\n   * Insert video\n   * @param {Object} data - Video data\n   */\n  insertVideo(data) {\n    this.restoreSelection();\n\n    const embedUrl = this.getEmbedUrl(data.url);\n    let html;\n\n    if (embedUrl) {\n      // YouTube/Vimeo embed\n      if (data.responsive) {\n        html = `\n          <div class=\"rte-video-wrapper\" style=\"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin: 1em 0;\">\n            <iframe src=\"${embedUrl}\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;\" allowfullscreen></iframe>\n          </div>\n        `;\n      } else {\n        html = `\n          <div class=\"rte-video-wrapper\" style=\"margin: 1em 0;\">\n            <iframe src=\"${embedUrl}\" width=\"${data.width}\" height=\"${data.height}\" style=\"border: 0;\" allowfullscreen></iframe>\n          </div>\n        `;\n      }\n    } else if (data.url.match(/\\.(mp4|webm|ogg)$/i)) {\n      // Direct video file\n      if (data.responsive) {\n        html = `\n          <div class=\"rte-video-wrapper\" style=\"margin: 1em 0;\">\n            <video src=\"${data.url}\" style=\"width: 100%; height: auto;\" controls></video>\n          </div>\n        `;\n      } else {\n        html = `\n          <div class=\"rte-video-wrapper\" style=\"margin: 1em 0;\">\n            <video src=\"${data.url}\" width=\"${data.width}\" height=\"${data.height}\" controls></video>\n          </div>\n        `;\n      }\n    } else {\n      // Fallback - just create a link\n      html = `<a href=\"${data.url}\" target=\"_blank\">${data.url}</a>`;\n    }\n\n    this.insertHtml(html);\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  /**\n   * Get embed URL from video URL\n   * @param {string} url\n   * @returns {string|null}\n   */\n  getEmbedUrl(url) {\n    // YouTube\n    let match = url.match(/(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/ ]{11})/);\n    if (match) {\n      return `https://www.youtube.com/embed/${match[1]}`;\n    }\n\n    // Vimeo\n    match = url.match(/(?:vimeo\\.com\\/)(\\d+)/);\n    if (match) {\n      return `https://player.vimeo.com/video/${match[1]}`;\n    }\n\n    return null;\n  }\n\n  destroy() {\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\nexport default VideoPlugin;\n","/**\n * EmojiPlugin - Emoji picker for inserting emojis\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass EmojiPlugin extends PluginBase {\n  static pluginName = 'emoji';\n\n  init() {\n    super.init();\n\n    this.picker = null;\n    this.isOpen = false;\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'emoji') {\n        this.toggle();\n      }\n    });\n\n    // Close on outside click\n    document.addEventListener('click', this.handleDocumentClick.bind(this));\n  }\n\n  /**\n   * Toggle emoji picker\n   */\n  toggle() {\n    if (this.isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  /**\n   * Open emoji picker\n   */\n  open() {\n    this.saveSelection();\n\n    if (!this.picker) {\n      this.createPicker();\n    }\n\n    // Position near toolbar button\n    const btn = this.getToolbarButton('emoji');\n    if (btn) {\n      const rect = btn.getBoundingClientRect();\n      this.picker.style.top = `${rect.bottom + 4}px`;\n      this.picker.style.left = `${rect.left}px`;\n    }\n\n    this.picker.style.display = 'block';\n    this.isOpen = true;\n  }\n\n  /**\n   * Close emoji picker\n   */\n  close() {\n    if (this.picker) {\n      this.picker.style.display = 'none';\n    }\n    this.isOpen = false;\n  }\n\n  /**\n   * Handle document click\n   * @param {MouseEvent} event\n   */\n  handleDocumentClick(event) {\n    if (this.isOpen && this.picker && !this.picker.contains(event.target)) {\n      const btn = this.getToolbarButton('emoji');\n      if (!btn || !btn.contains(event.target)) {\n        this.close();\n      }\n    }\n  }\n\n  /**\n   * Create emoji picker element\n   */\n  createPicker() {\n    this.picker = document.createElement('div');\n    this.picker.className = 'rte-emoji-picker';\n    this.picker.style.cssText = `\n      position: fixed;\n      z-index: 10001;\n      background: var(--rte-bg-color, #fff);\n      border: 1px solid var(--rte-border-color, #ddd);\n      border-radius: 8px;\n      box-shadow: 0 4px 16px rgba(0,0,0,0.15);\n      padding: 12px;\n      width: 253px;\n      max-height: 350px;\n      display: none;\n    `;\n\n    // Search input\n    const searchInput = document.createElement('input');\n    searchInput.type = 'text';\n    searchInput.placeholder = this.translate('Search emoji...');\n    searchInput.className = 'rte-emoji-search';\n    searchInput.style.cssText = `\n      width: 100%;\n      padding: 8px 12px;\n      border: 1px solid var(--rte-border-color, #ddd);\n      border-radius: 6px;\n      margin-bottom: 12px;\n      font-size: 14px;\n    `;\n    searchInput.addEventListener('input', (e) => this.filterEmojis(e.target.value));\n    this.picker.appendChild(searchInput);\n\n    // Categories tabs\n    const tabs = document.createElement('div');\n    tabs.className = 'rte-emoji-tabs';\n    tabs.style.cssText = `\n      display: flex;\n      gap: 4px;\n      margin-bottom: 8px;\n      border-bottom: 1px solid var(--rte-border-color, #ddd);\n      padding-bottom: 8px;\n    `;\n\n    EmojiPlugin.categories.forEach((cat, index) => {\n      const tab = document.createElement('button');\n      tab.type = 'button';\n      tab.className = 'rte-emoji-tab';\n      tab.textContent = cat.icon;\n      tab.title = this.translate(cat.name);\n      tab.style.cssText = `\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        font-size: 18px;\n        cursor: pointer;\n        border-radius: 4px;\n        transition: background 0.2s;\n      `;\n      tab.addEventListener('mouseover', () => tab.style.background = 'var(--rte-bg-hover, #f0f0f0)');\n      tab.addEventListener('mouseout', () => tab.style.background = 'transparent');\n      tab.addEventListener('click', () => this.showCategory(index));\n      tabs.appendChild(tab);\n    });\n    this.picker.appendChild(tabs);\n\n    // Emoji grid container\n    this.emojiGrid = document.createElement('div');\n    this.emojiGrid.className = 'rte-emoji-grid';\n    this.emojiGrid.style.cssText = `\n      display: flex;\n      flex-wrap: wrap;\n      gap: 4px;\n      max-height: 220px;\n      overflow-y: auto;\n    `;\n    this.picker.appendChild(this.emojiGrid);\n\n    // Show first category\n    this.showCategory(0);\n\n    document.body.appendChild(this.picker);\n  }\n\n  /**\n   * Show emojis from category\n   * @param {number} categoryIndex\n   */\n  showCategory(categoryIndex) {\n    const category = EmojiPlugin.categories[categoryIndex];\n    if (!category) return;\n\n    this.currentEmojis = category.emojis;\n    this.renderEmojis(category.emojis);\n  }\n\n  /**\n   * Filter emojis by search term\n   * @param {string} term\n   */\n  filterEmojis(term) {\n    if (!term) {\n      this.renderEmojis(this.currentEmojis || EmojiPlugin.categories[0].emojis);\n      return;\n    }\n\n    const lowerTerm = term.toLowerCase();\n    const filtered = [];\n\n    EmojiPlugin.categories.forEach(cat => {\n      cat.emojis.forEach(emoji => {\n        if (emoji.name && emoji.name.toLowerCase().includes(lowerTerm)) {\n          filtered.push(emoji);\n        }\n      });\n    });\n\n    this.renderEmojis(filtered);\n  }\n\n  /**\n   * Render emojis to grid\n   * @param {Array} emojis\n   */\n  renderEmojis(emojis) {\n    this.emojiGrid.innerHTML = '';\n\n    emojis.forEach(emoji => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'rte-emoji-btn';\n      btn.textContent = emoji.char;\n      btn.title = emoji.name || '';\n      btn.style.cssText = `\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        font-size: 20px;\n        cursor: pointer;\n        border-radius: 4px;\n        transition: all 0.15s;\n      `;\n      btn.addEventListener('mouseover', () => {\n        btn.style.background = 'var(--rte-bg-hover, #f0f0f0)';\n        btn.style.transform = 'scale(1.2)';\n      });\n      btn.addEventListener('mouseout', () => {\n        btn.style.background = 'transparent';\n        btn.style.transform = 'scale(1)';\n      });\n      btn.addEventListener('click', () => this.insertEmoji(emoji.char));\n      this.emojiGrid.appendChild(btn);\n    });\n  }\n\n  /**\n   * Insert emoji at cursor\n   * @param {string} emoji\n   */\n  insertEmoji(emoji) {\n    this.restoreSelection();\n    this.insertHtml(emoji);\n    this.recordHistory(true);\n    this.close();\n    this.focusEditor();\n  }\n\n  destroy() {\n    if (this.picker && this.picker.parentNode) {\n      this.picker.parentNode.removeChild(this.picker);\n    }\n    document.removeEventListener('click', this.handleDocumentClick);\n    super.destroy();\n  }\n}\n\n// Emoji categories with common emojis\nEmojiPlugin.categories = [\n  {\n    name: 'Smileys',\n    icon: '😀',\n    emojis: [\n      {char: '😀', name: 'grinning'}, {char: '😃', name: 'smiley'}, {char: '😄', name: 'smile'},\n      {char: '😁', name: 'grin'}, {char: '😆', name: 'laughing'}, {char: '😅', name: 'sweat smile'},\n      {char: '🤣', name: 'rofl'}, {char: '😂', name: 'joy'}, {char: '🙂', name: 'slightly smiling'},\n      {char: '😉', name: 'wink'}, {char: '😊', name: 'blush'}, {char: '😇', name: 'innocent'},\n      {char: '🥰', name: 'smiling hearts'}, {char: '😍', name: 'heart eyes'}, {char: '🤩', name: 'star struck'},\n      {char: '😘', name: 'kissing heart'}, {char: '😗', name: 'kissing'}, {char: '😚', name: 'kissing closed eyes'},\n      {char: '😙', name: 'kissing smiling'}, {char: '🥲', name: 'smiling tear'}, {char: '😋', name: 'yum'},\n      {char: '😛', name: 'stuck out tongue'}, {char: '😜', name: 'winking tongue'}, {char: '🤪', name: 'zany'},\n      {char: '😝', name: 'squinting tongue'}, {char: '🤑', name: 'money mouth'}, {char: '🤗', name: 'hugging'},\n      {char: '🤭', name: 'hand over mouth'}, {char: '🤫', name: 'shushing'}, {char: '🤔', name: 'thinking'},\n      {char: '🤐', name: 'zipper mouth'}, {char: '🤨', name: 'raised eyebrow'}, {char: '😐', name: 'neutral'},\n      {char: '😑', name: 'expressionless'}, {char: '😶', name: 'no mouth'}, {char: '😏', name: 'smirk'},\n      {char: '😒', name: 'unamused'}, {char: '🙄', name: 'rolling eyes'}, {char: '😬', name: 'grimacing'},\n      {char: '😮‍💨', name: 'exhaling'}, {char: '🤥', name: 'lying'}, {char: '😌', name: 'relieved'},\n      {char: '😔', name: 'pensive'}, {char: '😪', name: 'sleepy'}, {char: '🤤', name: 'drooling'},\n      {char: '😴', name: 'sleeping'}, {char: '😷', name: 'mask'}, {char: '🤒', name: 'thermometer'},\n      {char: '🤕', name: 'bandage'}, {char: '🤢', name: 'nauseated'}, {char: '🤮', name: 'vomiting'},\n      {char: '😵', name: 'dizzy'}, {char: '🤯', name: 'exploding head'}, {char: '🥳', name: 'partying'},\n      {char: '🥸', name: 'disguised'}, {char: '😎', name: 'sunglasses'}, {char: '🤓', name: 'nerd'},\n      {char: '😕', name: 'confused'}, {char: '😟', name: 'worried'}, {char: '🙁', name: 'frowning'},\n      {char: '😮', name: 'open mouth'}, {char: '😯', name: 'hushed'}, {char: '😲', name: 'astonished'},\n      {char: '😳', name: 'flushed'}, {char: '🥺', name: 'pleading'}, {char: '😦', name: 'frowning open'},\n      {char: '😧', name: 'anguished'}, {char: '😨', name: 'fearful'}, {char: '😰', name: 'cold sweat'},\n      {char: '😥', name: 'sad relieved'}, {char: '😢', name: 'crying'}, {char: '😭', name: 'loudly crying'},\n      {char: '😱', name: 'screaming'}, {char: '😖', name: 'confounded'}, {char: '😣', name: 'persevering'},\n      {char: '😞', name: 'disappointed'}, {char: '😓', name: 'sweat'}, {char: '😩', name: 'weary'},\n      {char: '😫', name: 'tired'}, {char: '🥱', name: 'yawning'}, {char: '😤', name: 'triumph'},\n      {char: '😡', name: 'pouting'}, {char: '😠', name: 'angry'}, {char: '🤬', name: 'cursing'},\n      {char: '😈', name: 'smiling devil'}, {char: '👿', name: 'angry devil'}, {char: '💀', name: 'skull'},\n      {char: '☠️', name: 'skull crossbones'}, {char: '💩', name: 'poop'}, {char: '🤡', name: 'clown'},\n      {char: '👹', name: 'ogre'}, {char: '👺', name: 'goblin'}, {char: '👻', name: 'ghost'},\n      {char: '👽', name: 'alien'}, {char: '👾', name: 'alien monster'}, {char: '🤖', name: 'robot'}\n    ]\n  },\n  {\n    name: 'Gestures',\n    icon: '👍',\n    emojis: [\n      {char: '👍', name: 'thumbs up'}, {char: '👎', name: 'thumbs down'}, {char: '👌', name: 'ok'},\n      {char: '✌️', name: 'victory'}, {char: '🤞', name: 'crossed fingers'}, {char: '🤟', name: 'love you'},\n      {char: '🤘', name: 'rock on'}, {char: '🤙', name: 'call me'}, {char: '👋', name: 'waving'},\n      {char: '🤚', name: 'raised back'}, {char: '🖐️', name: 'raised hand'}, {char: '✋', name: 'raised palm'},\n      {char: '🖖', name: 'vulcan'}, {char: '👏', name: 'clapping'}, {char: '🙌', name: 'raised hands'},\n      {char: '🤲', name: 'palms up'}, {char: '🤝', name: 'handshake'}, {char: '🙏', name: 'pray'},\n      {char: '✍️', name: 'writing'}, {char: '💪', name: 'strong'}, {char: '🦾', name: 'mechanical arm'},\n      {char: '🖕', name: 'middle finger'}, {char: '☝️', name: 'point up'}, {char: '👆', name: 'pointing up'},\n      {char: '👇', name: 'pointing down'}, {char: '👈', name: 'pointing left'}, {char: '👉', name: 'pointing right'},\n      {char: '✊', name: 'raised fist'}, {char: '👊', name: 'punch'}, {char: '🤛', name: 'left fist'},\n      {char: '🤜', name: 'right fist'}\n    ]\n  },\n  {\n    name: 'Hearts',\n    icon: '❤️',\n    emojis: [\n      {char: '❤️', name: 'red heart'}, {char: '🧡', name: 'orange heart'}, {char: '💛', name: 'yellow heart'},\n      {char: '💚', name: 'green heart'}, {char: '💙', name: 'blue heart'}, {char: '💜', name: 'purple heart'},\n      {char: '🖤', name: 'black heart'}, {char: '🤍', name: 'white heart'}, {char: '🤎', name: 'brown heart'},\n      {char: '💔', name: 'broken heart'}, {char: '❤️‍🔥', name: 'heart fire'}, {char: '❤️‍🩹', name: 'mending heart'},\n      {char: '💕', name: 'two hearts'}, {char: '💞', name: 'revolving hearts'}, {char: '💓', name: 'beating heart'},\n      {char: '💗', name: 'growing heart'}, {char: '💖', name: 'sparkling heart'}, {char: '💘', name: 'heart arrow'},\n      {char: '💝', name: 'heart ribbon'}, {char: '💟', name: 'heart decoration'}, {char: '💌', name: 'love letter'}\n    ]\n  },\n  {\n    name: 'Objects',\n    icon: '📦',\n    emojis: [\n      {char: '⌚', name: 'watch'}, {char: '📱', name: 'phone'}, {char: '💻', name: 'laptop'},\n      {char: '⌨️', name: 'keyboard'}, {char: '🖥️', name: 'computer'}, {char: '🖨️', name: 'printer'},\n      {char: '🖱️', name: 'mouse'}, {char: '💾', name: 'floppy disk'}, {char: '💿', name: 'cd'},\n      {char: '📷', name: 'camera'}, {char: '📹', name: 'video camera'}, {char: '🎥', name: 'movie camera'},\n      {char: '📺', name: 'tv'}, {char: '📻', name: 'radio'}, {char: '🎙️', name: 'microphone'},\n      {char: '🔋', name: 'battery'}, {char: '🔌', name: 'plug'}, {char: '💡', name: 'light bulb'},\n      {char: '🔦', name: 'flashlight'}, {char: '📚', name: 'books'}, {char: '📖', name: 'book'},\n      {char: '📝', name: 'memo'}, {char: '✏️', name: 'pencil'}, {char: '📎', name: 'paperclip'},\n      {char: '📌', name: 'pushpin'}, {char: '✂️', name: 'scissors'}, {char: '📁', name: 'folder'},\n      {char: '🗂️', name: 'folders'}, {char: '📅', name: 'calendar'}, {char: '📆', name: 'tear calendar'}\n    ]\n  },\n  {\n    name: 'Symbols',\n    icon: '✅',\n    emojis: [\n      {char: '✅', name: 'check mark'}, {char: '❌', name: 'cross'}, {char: '❓', name: 'question'},\n      {char: '❗', name: 'exclamation'}, {char: '💯', name: '100'}, {char: '🔥', name: 'fire'},\n      {char: '⭐', name: 'star'}, {char: '🌟', name: 'glowing star'}, {char: '✨', name: 'sparkles'},\n      {char: '💫', name: 'dizzy'}, {char: '🎯', name: 'target'}, {char: '🏆', name: 'trophy'},\n      {char: '🎉', name: 'party'}, {char: '🎊', name: 'confetti'}, {char: '🎁', name: 'gift'},\n      {char: '🔔', name: 'bell'}, {char: '🔕', name: 'no bell'}, {char: '🔒', name: 'lock'},\n      {char: '🔓', name: 'unlock'}, {char: '🔑', name: 'key'}, {char: '⚙️', name: 'gear'},\n      {char: '🔧', name: 'wrench'}, {char: '🔨', name: 'hammer'}, {char: '⚡', name: 'lightning'},\n      {char: '💎', name: 'gem'}, {char: '🔗', name: 'link'}, {char: '📍', name: 'pin'},\n      {char: '🏷️', name: 'tag'}, {char: '⏰', name: 'alarm'}, {char: '⏳', name: 'hourglass'}\n    ]\n  },\n  {\n    name: 'Arrows',\n    icon: '➡️',\n    emojis: [\n      {char: '⬆️', name: 'up'}, {char: '⬇️', name: 'down'}, {char: '⬅️', name: 'left'},\n      {char: '➡️', name: 'right'}, {char: '↗️', name: 'up right'}, {char: '↘️', name: 'down right'},\n      {char: '↙️', name: 'down left'}, {char: '↖️', name: 'up left'}, {char: '↕️', name: 'up down'},\n      {char: '↔️', name: 'left right'}, {char: '🔄', name: 'arrows'}, {char: '🔃', name: 'clockwise'},\n      {char: '🔀', name: 'shuffle'}, {char: '🔁', name: 'repeat'}, {char: '🔂', name: 'repeat one'},\n      {char: '▶️', name: 'play'}, {char: '⏸️', name: 'pause'}, {char: '⏹️', name: 'stop'},\n      {char: '⏺️', name: 'record'}, {char: '⏭️', name: 'next'}, {char: '⏮️', name: 'previous'},\n      {char: '⏩', name: 'fast forward'}, {char: '⏪', name: 'rewind'}, {char: '🔼', name: 'up button'},\n      {char: '🔽', name: 'down button'}\n    ]\n  }\n];\n\nexport default EmojiPlugin;\n","/**\n * SpecialCharsPlugin - Insert special characters\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass SpecialCharsDialog extends BaseDialog {\n  constructor(editor, plugin) {\n    super(editor, {\n      title: 'Special Characters',\n      width: 500\n    });\n    this.plugin = plugin;\n  }\n\n  buildBody() {\n    // Category tabs\n    const tabs = document.createElement('div');\n    tabs.className = 'rte-specialchars-tabs';\n    tabs.style.cssText = `\n      display: flex;\n      flex-wrap: wrap;\n      gap: 4px;\n      margin-bottom: 16px;\n      border-bottom: 1px solid var(--rte-border-color);\n      padding-bottom: 8px;\n    `;\n\n    SpecialCharsPlugin.categories.forEach((cat, index) => {\n      const tab = document.createElement('button');\n      tab.type = 'button';\n      tab.className = `rte-specialchars-tab ${index === 0 ? 'active' : ''}`;\n      tab.textContent = this.translate(cat.name);\n      tab.style.cssText = `\n        padding: 6px 12px;\n        border: none;\n        background: transparent;\n        font-size: 13px;\n        cursor: pointer;\n        border-radius: 4px;\n        transition: all 0.2s;\n        color: var(--rte-text-secondary);\n      `;\n      if (index === 0) {\n        tab.style.background = 'var(--rte-primary-light)';\n        tab.style.color = 'var(--rte-primary-color)';\n      }\n      tab.addEventListener('click', () => {\n        tabs.querySelectorAll('.rte-specialchars-tab').forEach(t => {\n          t.style.background = 'transparent';\n          t.style.color = 'var(--rte-text-secondary)';\n        });\n        tab.style.background = 'var(--rte-primary-light)';\n        tab.style.color = 'var(--rte-primary-color)';\n        this.showCategory(index);\n      });\n      tabs.appendChild(tab);\n    });\n    this.body.appendChild(tabs);\n\n    // Character grid\n    this.charGrid = document.createElement('div');\n    this.charGrid.className = 'rte-specialchars-grid';\n    this.charGrid.style.cssText = `\n      display: flex;\n      flex-wrap: wrap;\n      gap: 4px;\n      max-height: 300px;\n      overflow-y: auto;\n    `;\n    this.body.appendChild(this.charGrid);\n\n    // Selected character preview\n    this.preview = document.createElement('div');\n    this.preview.className = 'rte-specialchars-preview';\n    this.preview.style.cssText = `\n      margin-top: 16px;\n      padding: 12px;\n      background: var(--rte-bg-secondary);\n      border-radius: 6px;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n    `;\n    this.preview.innerHTML = `\n      <span class=\"preview-char\" style=\"font-size: 32px; width: 48px; text-align: center;\"></span>\n      <div class=\"preview-info\">\n        <div class=\"preview-name\" style=\"font-weight: 500; margin-bottom: 4px;\"></div>\n        <div class=\"preview-code\" style=\"font-size: 12px; color: var(--rte-text-muted); font-family: monospace;\"></div>\n      </div>\n    `;\n    this.body.appendChild(this.preview);\n\n    // Show first category\n    this.showCategory(0);\n  }\n\n  buildFooter() {\n    const insertBtn = document.createElement('button');\n    insertBtn.type = 'button';\n    insertBtn.className = 'rte-dialog-btn rte-dialog-btn-primary';\n    insertBtn.textContent = this.translate('Insert');\n    insertBtn.addEventListener('click', () => {\n      if (this.selectedChar) {\n        this.plugin.insertChar(this.selectedChar);\n        this.close();\n      }\n    });\n\n    const closeBtn = document.createElement('button');\n    closeBtn.type = 'button';\n    closeBtn.className = 'rte-dialog-btn';\n    closeBtn.textContent = this.translate('Close');\n    closeBtn.addEventListener('click', () => this.close());\n\n    this.footer.appendChild(closeBtn);\n    this.footer.appendChild(insertBtn);\n  }\n\n  showCategory(categoryIndex) {\n    const category = SpecialCharsPlugin.categories[categoryIndex];\n    if (!category) return;\n\n    this.charGrid.innerHTML = '';\n\n    category.chars.forEach(charInfo => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'rte-specialchar-btn';\n      btn.textContent = charInfo.char;\n      btn.title = charInfo.name;\n      btn.style.cssText = `\n        width: 36px;\n        height: 36px;\n        border: 1px solid var(--rte-border-color);\n        background: var(--rte-bg-color);\n        font-size: 18px;\n        cursor: pointer;\n        border-radius: 4px;\n        transition: all 0.15s;\n      `;\n      btn.addEventListener('mouseover', () => {\n        btn.style.background = 'var(--rte-bg-hover)';\n        btn.style.transform = 'scale(1.1)';\n      });\n      btn.addEventListener('mouseout', () => {\n        btn.style.background = 'var(--rte-bg-color)';\n        btn.style.transform = 'scale(1)';\n        if (this.selectedCharBtn !== btn) {\n          btn.style.borderColor = 'var(--rte-border-color)';\n        }\n      });\n      btn.addEventListener('click', () => {\n        this.selectChar(charInfo, btn);\n      });\n      btn.addEventListener('dblclick', () => {\n        this.plugin.insertChar(charInfo.char);\n        this.close();\n      });\n      this.charGrid.appendChild(btn);\n    });\n  }\n\n  selectChar(charInfo, btn) {\n    // Update selection style\n    if (this.selectedCharBtn) {\n      this.selectedCharBtn.style.borderColor = 'var(--rte-border-color)';\n    }\n    btn.style.borderColor = 'var(--rte-primary-color)';\n    this.selectedCharBtn = btn;\n\n    // Update preview\n    this.selectedChar = charInfo.char;\n    this.preview.querySelector('.preview-char').textContent = charInfo.char;\n    this.preview.querySelector('.preview-name').textContent = charInfo.name;\n    this.preview.querySelector('.preview-code').textContent = charInfo.code || `U+${charInfo.char.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0')}`;\n  }\n}\n\nclass SpecialCharsPlugin extends PluginBase {\n  static pluginName = 'specialChars';\n\n  init() {\n    super.init();\n\n    this.dialog = new SpecialCharsDialog(this.editor, this);\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'specialChars') {\n        this.openDialog();\n      }\n    });\n  }\n\n  openDialog() {\n    this.saveSelection();\n    this.dialog.open();\n  }\n\n  insertChar(char) {\n    this.restoreSelection();\n    this.insertHtml(char);\n    this.recordHistory(true);\n    this.focusEditor();\n  }\n\n  destroy() {\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\n// Character categories\nSpecialCharsPlugin.categories = [\n  {\n    name: 'Currency',\n    chars: [\n      {char: '$', name: 'Dollar', code: 'U+0024'},\n      {char: '€', name: 'Euro', code: 'U+20AC'},\n      {char: '£', name: 'Pound', code: 'U+00A3'},\n      {char: '¥', name: 'Yen', code: 'U+00A5'},\n      {char: '¢', name: 'Cent', code: 'U+00A2'},\n      {char: '₹', name: 'Rupee', code: 'U+20B9'},\n      {char: '₩', name: 'Won', code: 'U+20A9'},\n      {char: '₽', name: 'Ruble', code: 'U+20BD'},\n      {char: '฿', name: 'Baht', code: 'U+0E3F'},\n      {char: '₿', name: 'Bitcoin', code: 'U+20BF'},\n      {char: '₫', name: 'Dong', code: 'U+20AB'},\n      {char: '₱', name: 'Peso', code: 'U+20B1'}\n    ]\n  },\n  {\n    name: 'Math',\n    chars: [\n      {char: '±', name: 'Plus Minus', code: 'U+00B1'},\n      {char: '×', name: 'Multiplication', code: 'U+00D7'},\n      {char: '÷', name: 'Division', code: 'U+00F7'},\n      {char: '≠', name: 'Not Equal', code: 'U+2260'},\n      {char: '≈', name: 'Approximately', code: 'U+2248'},\n      {char: '≤', name: 'Less or Equal', code: 'U+2264'},\n      {char: '≥', name: 'Greater or Equal', code: 'U+2265'},\n      {char: '∞', name: 'Infinity', code: 'U+221E'},\n      {char: '√', name: 'Square Root', code: 'U+221A'},\n      {char: '∑', name: 'Sum', code: 'U+2211'},\n      {char: '∏', name: 'Product', code: 'U+220F'},\n      {char: '∫', name: 'Integral', code: 'U+222B'},\n      {char: '∂', name: 'Partial Derivative', code: 'U+2202'},\n      {char: 'π', name: 'Pi', code: 'U+03C0'},\n      {char: 'Ω', name: 'Omega', code: 'U+03A9'},\n      {char: 'µ', name: 'Micro', code: 'U+00B5'},\n      {char: '∆', name: 'Delta', code: 'U+2206'},\n      {char: '∇', name: 'Nabla', code: 'U+2207'},\n      {char: '∈', name: 'Element Of', code: 'U+2208'},\n      {char: '∉', name: 'Not Element Of', code: 'U+2209'},\n      {char: '∅', name: 'Empty Set', code: 'U+2205'},\n      {char: '∩', name: 'Intersection', code: 'U+2229'},\n      {char: '∪', name: 'Union', code: 'U+222A'},\n      {char: '⊂', name: 'Subset', code: 'U+2282'}\n    ]\n  },\n  {\n    name: 'Greek',\n    chars: [\n      {char: 'α', name: 'Alpha'}, {char: 'β', name: 'Beta'}, {char: 'γ', name: 'Gamma'},\n      {char: 'δ', name: 'Delta'}, {char: 'ε', name: 'Epsilon'}, {char: 'ζ', name: 'Zeta'},\n      {char: 'η', name: 'Eta'}, {char: 'θ', name: 'Theta'}, {char: 'ι', name: 'Iota'},\n      {char: 'κ', name: 'Kappa'}, {char: 'λ', name: 'Lambda'}, {char: 'μ', name: 'Mu'},\n      {char: 'ν', name: 'Nu'}, {char: 'ξ', name: 'Xi'}, {char: 'ο', name: 'Omicron'},\n      {char: 'π', name: 'Pi'}, {char: 'ρ', name: 'Rho'}, {char: 'σ', name: 'Sigma'},\n      {char: 'τ', name: 'Tau'}, {char: 'υ', name: 'Upsilon'}, {char: 'φ', name: 'Phi'},\n      {char: 'χ', name: 'Chi'}, {char: 'ψ', name: 'Psi'}, {char: 'ω', name: 'Omega'},\n      {char: 'Α', name: 'Alpha (Upper)'}, {char: 'Β', name: 'Beta (Upper)'}, {char: 'Γ', name: 'Gamma (Upper)'},\n      {char: 'Δ', name: 'Delta (Upper)'}, {char: 'Σ', name: 'Sigma (Upper)'}, {char: 'Ω', name: 'Omega (Upper)'}\n    ]\n  },\n  {\n    name: 'Punctuation',\n    chars: [\n      {char: '—', name: 'Em Dash', code: 'U+2014'},\n      {char: '–', name: 'En Dash', code: 'U+2013'},\n      {char: '…', name: 'Ellipsis', code: 'U+2026'},\n      {char: '‹', name: 'Single Left Quote'},\n      {char: '›', name: 'Single Right Quote'},\n      {char: '«', name: 'Double Left Quote'},\n      {char: '»', name: 'Double Right Quote'},\n      {char: '\"', name: 'Left Double Quote'},\n      {char: '\"', name: 'Right Double Quote'},\n      {char: '\\'', name: 'Single Quote'},\n      {char: '•', name: 'Bullet', code: 'U+2022'},\n      {char: '·', name: 'Middle Dot', code: 'U+00B7'},\n      {char: '†', name: 'Dagger', code: 'U+2020'},\n      {char: '‡', name: 'Double Dagger', code: 'U+2021'},\n      {char: '§', name: 'Section', code: 'U+00A7'},\n      {char: '¶', name: 'Paragraph', code: 'U+00B6'},\n      {char: '©', name: 'Copyright', code: 'U+00A9'},\n      {char: '®', name: 'Registered', code: 'U+00AE'},\n      {char: '™', name: 'Trademark', code: 'U+2122'},\n      {char: '°', name: 'Degree', code: 'U+00B0'},\n      {char: '′', name: 'Prime', code: 'U+2032'},\n      {char: '″', name: 'Double Prime', code: 'U+2033'},\n      {char: '№', name: 'Numero', code: 'U+2116'}\n    ]\n  },\n  {\n    name: 'Arrows',\n    chars: [\n      {char: '←', name: 'Left Arrow'}, {char: '→', name: 'Right Arrow'},\n      {char: '↑', name: 'Up Arrow'}, {char: '↓', name: 'Down Arrow'},\n      {char: '↔', name: 'Left Right Arrow'}, {char: '↕', name: 'Up Down Arrow'},\n      {char: '↖', name: 'Up Left Arrow'}, {char: '↗', name: 'Up Right Arrow'},\n      {char: '↘', name: 'Down Right Arrow'}, {char: '↙', name: 'Down Left Arrow'},\n      {char: '⇐', name: 'Double Left Arrow'}, {char: '⇒', name: 'Double Right Arrow'},\n      {char: '⇑', name: 'Double Up Arrow'}, {char: '⇓', name: 'Double Down Arrow'},\n      {char: '⇔', name: 'Double Left Right'}, {char: '⇕', name: 'Double Up Down'},\n      {char: '↩', name: 'Left Hook'}, {char: '↪', name: 'Right Hook'},\n      {char: '↺', name: 'Anticlockwise'}, {char: '↻', name: 'Clockwise'},\n      {char: '⟵', name: 'Long Left'}, {char: '⟶', name: 'Long Right'},\n      {char: '▲', name: 'Triangle Up'}, {char: '▼', name: 'Triangle Down'}\n    ]\n  },\n  {\n    name: 'Shapes',\n    chars: [\n      {char: '■', name: 'Black Square'}, {char: '□', name: 'White Square'},\n      {char: '▪', name: 'Small Black Square'}, {char: '▫', name: 'Small White Square'},\n      {char: '●', name: 'Black Circle'}, {char: '○', name: 'White Circle'},\n      {char: '◆', name: 'Black Diamond'}, {char: '◇', name: 'White Diamond'},\n      {char: '★', name: 'Black Star'}, {char: '☆', name: 'White Star'},\n      {char: '▶', name: 'Right Triangle'}, {char: '◀', name: 'Left Triangle'},\n      {char: '▲', name: 'Up Triangle'}, {char: '▼', name: 'Down Triangle'},\n      {char: '►', name: 'Right Pointer'}, {char: '◄', name: 'Left Pointer'},\n      {char: '♠', name: 'Spade'}, {char: '♣', name: 'Club'},\n      {char: '♥', name: 'Heart'}, {char: '♦', name: 'Diamond'},\n      {char: '♪', name: 'Music Note'}, {char: '♫', name: 'Music Notes'},\n      {char: '✓', name: 'Check Mark'}, {char: '✗', name: 'Cross Mark'}\n    ]\n  },\n  {\n    name: 'Latin',\n    chars: [\n      {char: 'À', name: 'A Grave'}, {char: 'Á', name: 'A Acute'}, {char: 'Â', name: 'A Circumflex'},\n      {char: 'Ã', name: 'A Tilde'}, {char: 'Ä', name: 'A Umlaut'}, {char: 'Å', name: 'A Ring'},\n      {char: 'Æ', name: 'AE'}, {char: 'Ç', name: 'C Cedilla'}, {char: 'È', name: 'E Grave'},\n      {char: 'É', name: 'E Acute'}, {char: 'Ê', name: 'E Circumflex'}, {char: 'Ë', name: 'E Umlaut'},\n      {char: 'Ñ', name: 'N Tilde'}, {char: 'Ö', name: 'O Umlaut'}, {char: 'Ü', name: 'U Umlaut'},\n      {char: 'ß', name: 'Sharp S'}, {char: 'à', name: 'a Grave'}, {char: 'á', name: 'a Acute'},\n      {char: 'â', name: 'a Circumflex'}, {char: 'ã', name: 'a Tilde'}, {char: 'ä', name: 'a Umlaut'},\n      {char: 'å', name: 'a Ring'}, {char: 'æ', name: 'ae'}, {char: 'ç', name: 'c Cedilla'},\n      {char: 'è', name: 'e Grave'}, {char: 'é', name: 'e Acute'}, {char: 'ê', name: 'e Circumflex'},\n      {char: 'ë', name: 'e Umlaut'}, {char: 'ñ', name: 'n Tilde'}, {char: 'ö', name: 'o Umlaut'},\n      {char: 'ü', name: 'u Umlaut'}, {char: 'ÿ', name: 'y Umlaut'}, {char: 'œ', name: 'OE'}\n    ]\n  }\n];\n\nexport default SpecialCharsPlugin;\n","/**\n * SourceViewPlugin - Toggle HTML source view\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass SourceViewPlugin extends PluginBase {\n  static pluginName = 'sourceView';\n\n  init() {\n    super.init();\n\n    this.sourceEditor = null;\n    this.isActive = false;\n\n    // Create source editor element\n    this.createSourceEditor();\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'sourceView') {\n        this.toggle();\n      }\n    });\n\n    // Register command\n    this.registerCommand('sourceView', {\n      execute: () => this.toggle(),\n      isActive: () => this.isActive\n    });\n  }\n\n  /**\n   * Create source editor element\n   */\n  createSourceEditor() {\n    this.sourceEditor = document.createElement('textarea');\n    this.sourceEditor.className = 'rte-source-view';\n    this.sourceEditor.spellcheck = false;\n    this.sourceEditor.setAttribute('aria-label', 'HTML source code');\n\n    // Add to container after content area\n    const container = this.editor.getContainer();\n    const contentWrapper = this.editor.contentArea?.getContainer();\n\n    if (container && contentWrapper) {\n      container.insertBefore(this.sourceEditor, contentWrapper.nextSibling);\n    }\n\n    // Sync on input\n    this.sourceEditor.addEventListener('input', () => {\n      // Don't record history on every keystroke in source view\n      // Will sync when switching back\n    });\n  }\n\n  /**\n   * Toggle source view\n   * @param {boolean} enabled - Force enable/disable\n   */\n  toggle(enabled) {\n    this.isActive = enabled !== undefined ? enabled : !this.isActive;\n\n    const container = this.editor.getContainer();\n    const contentWrapper = this.editor.contentArea?.getContainer();\n\n    if (this.isActive) {\n      // Switch to source view\n      const content = this.editor.contentArea?.getContent() || '';\n      this.sourceEditor.value = this.formatHtml(content);\n\n      container.classList.add('source-mode');\n      contentWrapper.style.display = 'none';\n      this.sourceEditor.style.display = 'block';\n\n      // Focus source editor\n      this.sourceEditor.focus();\n    } else {\n      // Switch back to WYSIWYG\n      const html = this.sourceEditor.value;\n      this.editor.contentArea?.setContent(html, true);\n\n      container.classList.remove('source-mode');\n      contentWrapper.style.display = '';\n      this.sourceEditor.style.display = 'none';\n\n      // Focus editor\n      this.focusEditor();\n    }\n\n    // Update toolbar button state\n    this.setButtonActive('sourceView', this.isActive);\n\n    // Emit mode change event\n    this.emit(EventBus.Events.MODE_CHANGE, {\n      mode: this.isActive ? 'source' : 'wysiwyg'\n    });\n\n    // Update editor state\n    this.editor.isSourceMode = this.isActive;\n  }\n\n  /**\n   * Format HTML for better readability\n   * @param {string} html\n   * @returns {string}\n   */\n  formatHtml(html) {\n    if (!html) return '';\n\n    // Simple formatting - add newlines after block elements\n    let formatted = html\n      .replace(/(<\\/?(p|div|h[1-6]|ul|ol|li|blockquote|pre|table|tr|thead|tbody|hr)[^>]*>)/gi, '\\n$1')\n      .replace(/^\\n/, '')\n      .trim();\n\n    // Remove excessive newlines\n    formatted = formatted.replace(/\\n{3,}/g, '\\n\\n');\n\n    return formatted;\n  }\n\n  /**\n   * Get source content\n   * @returns {string}\n   */\n  getSource() {\n    return this.sourceEditor?.value || '';\n  }\n\n  /**\n   * Set source content\n   * @param {string} html\n   */\n  setSource(html) {\n    if (this.sourceEditor) {\n      this.sourceEditor.value = this.formatHtml(html);\n    }\n  }\n\n  /**\n   * Check if source view is active\n   * @returns {boolean}\n   */\n  isSourceViewActive() {\n    return this.isActive;\n  }\n\n  destroy() {\n    if (this.sourceEditor && this.sourceEditor.parentNode) {\n      this.sourceEditor.parentNode.removeChild(this.sourceEditor);\n    }\n    super.destroy();\n  }\n}\n\nexport default SourceViewPlugin;\n","/**\n * FullscreenPlugin - Fullscreen editing mode\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass FullscreenPlugin extends PluginBase {\n  static pluginName = 'fullscreen';\n\n  init() {\n    super.init();\n\n    this.isActive = false;\n    this.originalStyles = null;\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'fullscreen') {\n        this.toggle();\n      }\n    });\n\n    // Register command\n    this.registerCommand('fullscreen', {\n      execute: () => this.toggle(),\n      isActive: () => this.isActive\n    });\n\n    // Register ESC shortcut to exit fullscreen\n    this.registerShortcut('escape', () => {\n      if (this.isActive) {\n        this.toggle(false);\n      }\n    });\n\n    // Listen for F11 key\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n  }\n\n  /**\n   * Handle keydown event\n   * @param {KeyboardEvent} event\n   */\n  handleKeyDown(event) {\n    if (event.key === 'F11') {\n      event.preventDefault();\n      this.toggle();\n    }\n  }\n\n  /**\n   * Toggle fullscreen mode\n   * @param {boolean} enabled - Force enable/disable\n   */\n  toggle(enabled) {\n    this.isActive = enabled !== undefined ? enabled : !this.isActive;\n\n    const container = this.editor.getContainer();\n    if (!container) return;\n\n    if (this.isActive) {\n      this.enterFullscreen(container);\n    } else {\n      this.exitFullscreen(container);\n    }\n\n    // Update toolbar button state\n    this.setButtonActive('fullscreen', this.isActive);\n\n    // Emit mode change event\n    this.emit(EventBus.Events.MODE_CHANGE, {\n      fullscreen: this.isActive\n    });\n\n    // Update editor state\n    this.editor.isFullscreen = this.isActive;\n  }\n\n  /**\n   * Enter fullscreen mode\n   * @param {HTMLElement} container\n   */\n  enterFullscreen(container) {\n    // Save original styles\n    this.originalStyles = {\n      position: container.style.position,\n      top: container.style.top,\n      left: container.style.left,\n      right: container.style.right,\n      bottom: container.style.bottom,\n      width: container.style.width,\n      height: container.style.height,\n      zIndex: container.style.zIndex,\n      borderRadius: container.style.borderRadius\n    };\n\n    // Apply fullscreen styles\n    container.style.position = 'fixed';\n    container.style.top = '0';\n    container.style.left = '0';\n    container.style.right = '0';\n    container.style.bottom = '0';\n    container.style.width = '100%';\n    container.style.height = '100%';\n    container.style.zIndex = '9999';\n    container.style.borderRadius = '0';\n\n    container.classList.add('fullscreen');\n    document.body.classList.add('rte-fullscreen-active');\n\n    // Expand content area\n    const contentWrapper = this.editor.contentArea?.getContainer();\n    if (contentWrapper) {\n      contentWrapper.style.flex = '1';\n      contentWrapper.style.maxHeight = 'none';\n    }\n\n    // Update content area height\n    const content = this.editor.contentArea?.getElement();\n    if (content) {\n      content.style.minHeight = 'auto';\n      content.style.maxHeight = 'none';\n    }\n  }\n\n  /**\n   * Exit fullscreen mode\n   * @param {HTMLElement} container\n   */\n  exitFullscreen(container) {\n    // Restore original styles\n    if (this.originalStyles) {\n      Object.entries(this.originalStyles).forEach(([key, value]) => {\n        container.style[key] = value;\n      });\n    }\n\n    container.classList.remove('fullscreen');\n    document.body.classList.remove('rte-fullscreen-active');\n\n    // Restore content area\n    const contentWrapper = this.editor.contentArea?.getContainer();\n    if (contentWrapper) {\n      contentWrapper.style.flex = '';\n      contentWrapper.style.maxHeight = '';\n    }\n\n    const content = this.editor.contentArea?.getElement();\n    if (content) {\n      content.style.minHeight = '';\n      content.style.maxHeight = '';\n    }\n  }\n\n  /**\n   * Check if fullscreen is active\n   * @returns {boolean}\n   */\n  isFullscreenActive() {\n    return this.isActive;\n  }\n\n  destroy() {\n    // Make sure to exit fullscreen\n    if (this.isActive) {\n      this.toggle(false);\n    }\n\n    document.removeEventListener('keydown', this.handleKeyDown);\n    super.destroy();\n  }\n}\n\nexport default FullscreenPlugin;\n","/**\n * AutosavePlugin - Auto-save content with configurable interval\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass AutosavePlugin extends PluginBase {\n  static pluginName = 'autosave';\n\n  init() {\n    super.init();\n\n    this.options = {\n      interval: 30000, // 30 seconds\n      key: 'rte-autosave',\n      saveHandler: null,\n      useLocalStorage: true,\n      showIndicator: true,\n      ...this.options\n    };\n\n    this.saveTimer = null;\n    this.isDirty = false;\n    this.lastSavedContent = '';\n    this.indicator = null;\n\n    // Create save indicator\n    if (this.options.showIndicator) {\n      this.createIndicator();\n    }\n\n    // Listen for content changes\n    this.subscribe(EventBus.Events.CONTENT_CHANGE, () => {\n      this.markDirty();\n    });\n\n    // Check for recovered content\n    this.checkRecovery();\n\n    // Start autosave timer\n    this.startTimer();\n\n    // Save before unload\n    window.addEventListener('beforeunload', this.handleBeforeUnload.bind(this));\n  }\n\n  /**\n   * Create save indicator element\n   */\n  createIndicator() {\n    this.indicator = document.createElement('span');\n    this.indicator.className = 'rte-autosave-indicator';\n    this.indicator.style.cssText = `\n      display: none;\n      padding: 2px 8px;\n      font-size: 11px;\n      color: var(--rte-text-muted);\n    `;\n\n    const footer = this.editor.footer;\n    if (footer) {\n      footer.appendChild(this.indicator);\n    }\n  }\n\n  /**\n   * Mark content as dirty (changed)\n   */\n  markDirty() {\n    this.isDirty = true;\n    this.updateIndicator('Unsaved changes', 'warning');\n  }\n\n  /**\n   * Mark content as clean (saved)\n   */\n  markClean() {\n    this.isDirty = false;\n    this.lastSavedContent = this.getContent();\n  }\n\n  /**\n   * Update indicator text\n   * @param {string} text\n   * @param {string} type - 'success', 'warning', 'error'\n   */\n  updateIndicator(text, type = 'info') {\n    if (!this.indicator) return;\n\n    this.indicator.textContent = text;\n    this.indicator.style.display = 'inline';\n\n    switch (type) {\n      case 'success':\n        this.indicator.style.color = 'var(--rte-notification-success)';\n        break;\n      case 'warning':\n        this.indicator.style.color = 'var(--rte-notification-warning)';\n        break;\n      case 'error':\n        this.indicator.style.color = 'var(--rte-notification-error)';\n        break;\n      default:\n        this.indicator.style.color = 'var(--rte-text-muted)';\n    }\n\n    // Auto-hide success message\n    if (type === 'success') {\n      setTimeout(() => {\n        if (this.indicator) {\n          this.indicator.style.display = 'none';\n        }\n      }, 3000);\n    }\n  }\n\n  /**\n   * Start autosave timer\n   */\n  startTimer() {\n    if (this.saveTimer) {\n      clearInterval(this.saveTimer);\n    }\n\n    this.saveTimer = setInterval(() => {\n      this.save();\n    }, this.options.interval);\n  }\n\n  /**\n   * Stop autosave timer\n   */\n  stopTimer() {\n    if (this.saveTimer) {\n      clearInterval(this.saveTimer);\n      this.saveTimer = null;\n    }\n  }\n\n  /**\n   * Save content\n   * @param {boolean} force - Force save even if not dirty\n   * @returns {Promise<boolean>}\n   */\n  async save(force = false) {\n    if (!force && !this.isDirty) {\n      return true;\n    }\n\n    const content = this.getContent();\n\n    // Skip if content hasn't changed\n    if (content === this.lastSavedContent) {\n      this.isDirty = false;\n      return true;\n    }\n\n    this.emit(EventBus.Events.AUTOSAVE_START, {content});\n    this.updateIndicator('Saving...', 'info');\n\n    try {\n      // Custom save handler\n      if (typeof this.options.saveHandler === 'function') {\n        await this.options.saveHandler(content);\n      }\n\n      // LocalStorage backup\n      if (this.options.useLocalStorage) {\n        this.saveToLocalStorage(content);\n      }\n\n      this.markClean();\n      this.updateIndicator('Saved', 'success');\n      this.emit(EventBus.Events.AUTOSAVE_SUCCESS, {content});\n\n      return true;\n    } catch (error) {\n      console.error('Autosave failed:', error);\n      this.updateIndicator('Save failed', 'error');\n      this.emit(EventBus.Events.AUTOSAVE_ERROR, {error});\n\n      // Still save to localStorage as backup\n      if (this.options.useLocalStorage) {\n        this.saveToLocalStorage(content);\n      }\n\n      return false;\n    }\n  }\n\n  /**\n   * Save to localStorage\n   * @param {string} content\n   */\n  saveToLocalStorage(content) {\n    try {\n      const data = {\n        content,\n        timestamp: Date.now(),\n        key: this.options.key\n      };\n      localStorage.setItem(this.options.key, JSON.stringify(data));\n    } catch (e) {\n      console.warn('Failed to save to localStorage:', e);\n    }\n  }\n\n  /**\n   * Get from localStorage\n   * @returns {Object|null}\n   */\n  getFromLocalStorage() {\n    try {\n      const data = localStorage.getItem(this.options.key);\n      if (data) {\n        return JSON.parse(data);\n      }\n    } catch (e) {\n      console.warn('Failed to get from localStorage:', e);\n    }\n    return null;\n  }\n\n  /**\n   * Clear localStorage\n   */\n  clearLocalStorage() {\n    try {\n      localStorage.removeItem(this.options.key);\n    } catch (e) {\n      console.warn('Failed to clear localStorage:', e);\n    }\n  }\n\n  /**\n   * Check for recovered content\n   */\n  checkRecovery() {\n    const saved = this.getFromLocalStorage();\n    if (!saved || !saved.content) return;\n\n    const currentContent = this.getContent();\n\n    // If saved content is different and newer\n    if (saved.content !== currentContent && saved.content.trim()) {\n      const savedDate = new Date(saved.timestamp);\n      const timeAgo = this.formatTimeAgo(saved.timestamp);\n\n      const recover = confirm(\n        `${this.translate('Recovered content found from')} ${timeAgo}.\\n\\n` +\n        `${this.translate('Do you want to restore this content?')}`\n      );\n\n      if (recover) {\n        this.setContent(saved.content);\n        this.recordHistory(true);\n        this.notify('Content restored', 'success');\n      } else {\n        this.clearLocalStorage();\n      }\n    }\n  }\n\n  /**\n   * Format timestamp to relative time\n   * @param {number} timestamp\n   * @returns {string}\n   */\n  formatTimeAgo(timestamp) {\n    const seconds = Math.floor((Date.now() - timestamp) / 1000);\n\n    if (seconds < 60) return `${seconds} seconds ago`;\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;\n    return `${Math.floor(seconds / 86400)} days ago`;\n  }\n\n  /**\n   * Handle before unload\n   * @param {BeforeUnloadEvent} event\n   */\n  handleBeforeUnload(event) {\n    if (this.isDirty) {\n      // Save before leaving\n      this.save(true);\n\n      // Show warning\n      event.preventDefault();\n      event.returnValue = 'You have unsaved changes. Are you sure you want to leave?';\n      return event.returnValue;\n    }\n  }\n\n  /**\n   * Check if content is dirty\n   * @returns {boolean}\n   */\n  isDirtyContent() {\n    return this.isDirty;\n  }\n\n  /**\n   * Force save now\n   * @returns {Promise<boolean>}\n   */\n  saveNow() {\n    return this.save(true);\n  }\n\n  /**\n   * Set save interval\n   * @param {number} interval - Interval in ms\n   */\n  setInterval(interval) {\n    this.options.interval = interval;\n    this.startTimer();\n  }\n\n  destroy() {\n    // Final save before destroy\n    if (this.isDirty) {\n      this.save(true);\n    }\n\n    this.stopTimer();\n    window.removeEventListener('beforeunload', this.handleBeforeUnload);\n\n    if (this.indicator && this.indicator.parentNode) {\n      this.indicator.parentNode.removeChild(this.indicator);\n    }\n\n    super.destroy();\n  }\n}\n\nexport default AutosavePlugin;\n","/**\n * WordCountPlugin - Word and character count in footer\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass WordCountPlugin extends PluginBase {\n  static pluginName = 'wordcount';\n\n  init() {\n    super.init();\n\n    this.options = {\n      showWords: true,\n      showCharacters: true,\n      showCharactersWithoutSpaces: false,\n      ...this.options\n    };\n\n    this.element = null;\n\n    // Create counter element\n    this.createCounter();\n\n    // Listen for content changes\n    this.subscribe(EventBus.Events.CONTENT_CHANGE, () => {\n      this.update();\n    });\n\n    this.subscribe(EventBus.Events.CONTENT_SET, () => {\n      this.update();\n    });\n\n    // Initial update\n    this.update();\n  }\n\n  /**\n   * Create counter element\n   */\n  createCounter() {\n    this.element = document.createElement('div');\n    this.element.className = 'rte-wordcount';\n    this.element.style.cssText = `\n      display: flex;\n      gap: 16px;\n      font-size: 12px;\n      color: var(--rte-text-muted);\n    `;\n\n    const footer = this.editor.footer;\n    if (footer) {\n      footer.appendChild(this.element);\n    }\n  }\n\n  /**\n   * Update counts\n   */\n  update() {\n    if (!this.element) return;\n\n    const parts = [];\n\n    if (this.options.showWords) {\n      const words = this.editor.getWordCount();\n      parts.push(`${words} ${this.translate(words === 1 ? 'word' : 'words')}`);\n    }\n\n    if (this.options.showCharacters) {\n      const chars = this.editor.getCharacterCount(false);\n      parts.push(`${chars} ${this.translate(chars === 1 ? 'character' : 'characters')}`);\n    }\n\n    if (this.options.showCharactersWithoutSpaces) {\n      const charsNoSpace = this.editor.getCharacterCount(true);\n      parts.push(`${charsNoSpace} ${this.translate('characters (no spaces)')}`);\n    }\n\n    this.element.textContent = parts.join(' | ');\n  }\n\n  /**\n   * Get word count\n   * @returns {number}\n   */\n  getWordCount() {\n    return this.editor.getWordCount();\n  }\n\n  /**\n   * Get character count\n   * @param {boolean} excludeSpaces\n   * @returns {number}\n   */\n  getCharacterCount(excludeSpaces = false) {\n    return this.editor.getCharacterCount(excludeSpaces);\n  }\n\n  destroy() {\n    if (this.element && this.element.parentNode) {\n      this.element.parentNode.removeChild(this.element);\n    }\n    super.destroy();\n  }\n}\n\nexport default WordCountPlugin;\n","/**\n * FindReplacePlugin - Find and replace functionality\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport BaseDialog from '../../ui/dialogs/BaseDialog.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass FindReplaceDialog extends BaseDialog {\n  constructor(editor, plugin) {\n    super(editor, {\n      title: 'Find and Replace',\n      width: 450,\n      closeOnEscape: false // Handle ESC differently\n    });\n    this.plugin = plugin;\n  }\n\n  buildBody() {\n    // Find field\n    this.findField = this.createField({\n      type: 'text',\n      label: 'Find',\n      id: 'rte-find-text',\n      placeholder: 'Text to find'\n    });\n    this.body.appendChild(this.findField);\n\n    // Replace field\n    this.replaceField = this.createField({\n      type: 'text',\n      label: 'Replace with',\n      id: 'rte-replace-text',\n      placeholder: 'Replacement text'\n    });\n    this.body.appendChild(this.replaceField);\n\n    // Options row\n    const optionsRow = document.createElement('div');\n    optionsRow.style.cssText = 'display: flex; gap: 16px; margin-top: 8px;';\n\n    this.matchCaseField = this.createField({\n      type: 'checkbox',\n      id: 'rte-find-matchcase',\n      checkLabel: 'Match case'\n    });\n    optionsRow.appendChild(this.matchCaseField);\n\n    this.wholeWordField = this.createField({\n      type: 'checkbox',\n      id: 'rte-find-wholeword',\n      checkLabel: 'Whole word'\n    });\n    optionsRow.appendChild(this.wholeWordField);\n\n    this.body.appendChild(optionsRow);\n\n    // Results counter\n    this.resultsCounter = document.createElement('div');\n    this.resultsCounter.className = 'rte-find-results';\n    this.resultsCounter.style.cssText = `\n      margin-top: 16px;\n      padding: 8px 12px;\n      background: var(--rte-bg-secondary);\n      border-radius: 4px;\n      font-size: 13px;\n      color: var(--rte-text-secondary);\n    `;\n    this.resultsCounter.textContent = 'No results';\n    this.body.appendChild(this.resultsCounter);\n\n    // Live search on input\n    const findInput = this.findField.querySelector('input');\n    findInput.addEventListener('input', () => {\n      this.plugin.find(findInput.value);\n    });\n\n    // Handle Enter key\n    findInput.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          this.plugin.findPrevious();\n        } else {\n          this.plugin.findNext();\n        }\n      }\n    });\n  }\n\n  buildFooter() {\n    // Find buttons\n    const findPrevBtn = document.createElement('button');\n    findPrevBtn.type = 'button';\n    findPrevBtn.className = 'rte-dialog-btn';\n    findPrevBtn.textContent = '◀ ' + this.translate('Previous');\n    findPrevBtn.addEventListener('click', () => this.plugin.findPrevious());\n\n    const findNextBtn = document.createElement('button');\n    findNextBtn.type = 'button';\n    findNextBtn.className = 'rte-dialog-btn';\n    findNextBtn.textContent = this.translate('Next') + ' ▶';\n    findNextBtn.addEventListener('click', () => this.plugin.findNext());\n\n    // Replace buttons\n    const replaceBtn = document.createElement('button');\n    replaceBtn.type = 'button';\n    replaceBtn.className = 'rte-dialog-btn rte-dialog-btn-secondary';\n    replaceBtn.textContent = this.translate('Replace');\n    replaceBtn.addEventListener('click', () => this.plugin.replace());\n\n    const replaceAllBtn = document.createElement('button');\n    replaceAllBtn.type = 'button';\n    replaceAllBtn.className = 'rte-dialog-btn rte-dialog-btn-primary';\n    replaceAllBtn.textContent = this.translate('Replace All');\n    replaceAllBtn.addEventListener('click', () => this.plugin.replaceAll());\n\n    // Close button\n    const closeBtn = document.createElement('button');\n    closeBtn.type = 'button';\n    closeBtn.className = 'rte-dialog-btn';\n    closeBtn.textContent = this.translate('Close');\n    closeBtn.addEventListener('click', () => this.close());\n\n    this.footer.appendChild(findPrevBtn);\n    this.footer.appendChild(findNextBtn);\n    this.footer.appendChild(replaceBtn);\n    this.footer.appendChild(replaceAllBtn);\n    this.footer.appendChild(closeBtn);\n  }\n\n  getData() {\n    const findInput = this.findField.querySelector('input');\n    const replaceInput = this.replaceField.querySelector('input');\n    const matchCaseInput = this.matchCaseField.querySelector('input');\n    const wholeWordInput = this.wholeWordField.querySelector('input');\n\n    return {\n      find: findInput.value,\n      replace: replaceInput.value,\n      matchCase: matchCaseInput.checked,\n      wholeWord: wholeWordInput.checked\n    };\n  }\n\n  updateResultsCount(current, total) {\n    if (total === 0) {\n      this.resultsCounter.textContent = 'No results';\n    } else {\n      this.resultsCounter.textContent = `${current} of ${total} matches`;\n    }\n  }\n\n  close() {\n    this.plugin.clearHighlights();\n    super.close();\n  }\n}\n\nclass FindReplacePlugin extends PluginBase {\n  static pluginName = 'findReplace';\n\n  init() {\n    super.init();\n\n    this.dialog = new FindReplaceDialog(this.editor, this);\n    this.matches = [];\n    this.currentMatchIndex = -1;\n    this.highlightClass = 'rte-find-highlight';\n    this.currentHighlightClass = 'rte-find-current';\n\n    // Add highlight styles\n    this.addStyles();\n\n    // Listen for toolbar button click\n    this.subscribe(EventBus.Events.TOOLBAR_BUTTON_CLICK, (event) => {\n      if (event.id === 'findReplace') {\n        this.openDialog();\n      }\n    });\n\n    // Register shortcut\n    this.registerShortcut('ctrl+f', () => this.openDialog());\n    this.registerShortcut('ctrl+h', () => this.openDialog());\n  }\n\n  /**\n   * Add highlight styles\n   */\n  addStyles() {\n    if (document.getElementById('rte-find-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'rte-find-styles';\n    style.textContent = `\n      .${this.highlightClass} {\n        background-color: #fff3cd;\n        padding: 1px 0;\n      }\n      .${this.currentHighlightClass} {\n        background-color: #ffc107;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Open find/replace dialog\n   */\n  openDialog() {\n    const selectedText = this.getSelection().getSelectedText();\n    this.dialog.open({find: selectedText});\n\n    if (selectedText) {\n      this.find(selectedText);\n    }\n  }\n\n  /**\n   * Find text and highlight matches\n   * @param {string} searchText\n   */\n  find(searchText) {\n    this.clearHighlights();\n    this.matches = [];\n    this.currentMatchIndex = -1;\n\n    if (!searchText) {\n      this.dialog.updateResultsCount(0, 0);\n      return;\n    }\n\n    const options = this.dialog.getData();\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return;\n\n    // Build regex\n    let flags = 'g';\n    if (!options.matchCase) flags += 'i';\n\n    let pattern = searchText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    if (options.wholeWord) {\n      pattern = `\\\\b${pattern}\\\\b`;\n    }\n\n    const regex = new RegExp(pattern, flags);\n\n    // Find text nodes and highlight matches\n    this.highlightMatches(content, regex);\n\n    // Update counter\n    this.dialog.updateResultsCount(\n      this.matches.length > 0 ? 1 : 0,\n      this.matches.length\n    );\n\n    // Go to first match\n    if (this.matches.length > 0) {\n      this.currentMatchIndex = 0;\n      this.highlightCurrentMatch();\n    }\n  }\n\n  /**\n   * Highlight matches in content\n   * @param {HTMLElement} container\n   * @param {RegExp} regex\n   */\n  highlightMatches(container, regex) {\n    const walker = document.createTreeWalker(\n      container,\n      NodeFilter.SHOW_TEXT,\n      null,\n      false\n    );\n\n    const textNodes = [];\n    while (walker.nextNode()) {\n      textNodes.push(walker.currentNode);\n    }\n\n    textNodes.forEach(node => {\n      const text = node.textContent;\n      const matches = [];\n      let match;\n\n      regex.lastIndex = 0;\n      while ((match = regex.exec(text)) !== null) {\n        matches.push({\n          index: match.index,\n          length: match[0].length,\n          text: match[0]\n        });\n      }\n\n      if (matches.length > 0) {\n        this.replaceWithHighlights(node, matches);\n      }\n    });\n  }\n\n  /**\n   * Replace text node with highlighted spans\n   * @param {Text} textNode\n   * @param {Array} matches\n   */\n  replaceWithHighlights(textNode, matches) {\n    const text = textNode.textContent;\n    const fragment = document.createDocumentFragment();\n    let lastIndex = 0;\n\n    matches.forEach((match, i) => {\n      // Add text before match\n      if (match.index > lastIndex) {\n        fragment.appendChild(\n          document.createTextNode(text.substring(lastIndex, match.index))\n        );\n      }\n\n      // Add highlighted span\n      const span = document.createElement('span');\n      span.className = this.highlightClass;\n      span.textContent = match.text;\n      span.dataset.matchIndex = this.matches.length;\n\n      fragment.appendChild(span);\n      this.matches.push(span);\n\n      lastIndex = match.index + match.length;\n    });\n\n    // Add remaining text\n    if (lastIndex < text.length) {\n      fragment.appendChild(\n        document.createTextNode(text.substring(lastIndex))\n      );\n    }\n\n    textNode.parentNode.replaceChild(fragment, textNode);\n  }\n\n  /**\n   * Highlight current match\n   */\n  highlightCurrentMatch() {\n    // Remove current highlight from all\n    this.matches.forEach(span => {\n      span.classList.remove(this.currentHighlightClass);\n    });\n\n    // Add to current\n    if (this.currentMatchIndex >= 0 && this.matches[this.currentMatchIndex]) {\n      const current = this.matches[this.currentMatchIndex];\n      current.classList.add(this.currentHighlightClass);\n\n      // Scroll into view\n      current.scrollIntoView({behavior: 'smooth', block: 'center'});\n    }\n\n    this.dialog.updateResultsCount(\n      this.currentMatchIndex + 1,\n      this.matches.length\n    );\n  }\n\n  /**\n   * Find next match\n   */\n  findNext() {\n    if (this.matches.length === 0) return;\n\n    this.currentMatchIndex = (this.currentMatchIndex + 1) % this.matches.length;\n    this.highlightCurrentMatch();\n  }\n\n  /**\n   * Find previous match\n   */\n  findPrevious() {\n    if (this.matches.length === 0) return;\n\n    this.currentMatchIndex--;\n    if (this.currentMatchIndex < 0) {\n      this.currentMatchIndex = this.matches.length - 1;\n    }\n    this.highlightCurrentMatch();\n  }\n\n  /**\n   * Replace current match\n   */\n  replace() {\n    if (this.currentMatchIndex < 0 || !this.matches[this.currentMatchIndex]) return;\n\n    const options = this.dialog.getData();\n    const current = this.matches[this.currentMatchIndex];\n\n    // Replace the text\n    current.textContent = options.replace;\n    current.classList.remove(this.highlightClass, this.currentHighlightClass);\n\n    // Remove from matches array\n    this.matches.splice(this.currentMatchIndex, 1);\n\n    // Record history\n    this.recordHistory(true);\n\n    // Move to next match\n    if (this.matches.length > 0) {\n      if (this.currentMatchIndex >= this.matches.length) {\n        this.currentMatchIndex = 0;\n      }\n      this.highlightCurrentMatch();\n    } else {\n      this.dialog.updateResultsCount(0, 0);\n    }\n  }\n\n  /**\n   * Replace all matches\n   */\n  replaceAll() {\n    if (this.matches.length === 0) return;\n\n    const options = this.dialog.getData();\n    let count = 0;\n\n    this.matches.forEach(span => {\n      span.textContent = options.replace;\n      span.classList.remove(this.highlightClass, this.currentHighlightClass);\n      count++;\n    });\n\n    this.matches = [];\n    this.currentMatchIndex = -1;\n\n    this.recordHistory(true);\n    this.dialog.updateResultsCount(0, 0);\n    this.notify(`Replaced ${count} occurrences`, 'success');\n  }\n\n  /**\n   * Clear all highlights\n   */\n  clearHighlights() {\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return;\n\n    const highlights = content.querySelectorAll(`.${this.highlightClass}`);\n    highlights.forEach(span => {\n      const text = document.createTextNode(span.textContent);\n      span.parentNode.replaceChild(text, span);\n    });\n\n    // Normalize text nodes\n    content.normalize();\n\n    this.matches = [];\n    this.currentMatchIndex = -1;\n  }\n\n  destroy() {\n    this.clearHighlights();\n    this.dialog?.destroy();\n    super.destroy();\n  }\n}\n\nexport default FindReplacePlugin;\n","/**\n * MaxLengthPlugin - Limit content length\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass MaxLengthPlugin extends PluginBase {\n  static pluginName = 'maxLength';\n\n  init() {\n    super.init();\n\n    this.options = {\n      maxLength: 10000,\n      maxWords: null,\n      countMode: 'characters', // 'characters' or 'words'\n      showCounter: true,\n      showWarning: true,\n      warningThreshold: 0.9, // Show warning at 90%\n      enforceLimit: true,\n      ...this.options\n    };\n\n    this.counterElement = null;\n    this.isWarning = false;\n    this.isOverLimit = false;\n\n    // Create counter\n    if (this.options.showCounter) {\n      this.createCounter();\n    }\n\n    // Listen for content changes\n    this.subscribe(EventBus.Events.CONTENT_CHANGE, () => {\n      this.checkLimit();\n    });\n\n    // Listen for paste events to intercept\n    this.subscribe(EventBus.Events.CONTENT_PASTE, (event) => {\n      if (this.options.enforceLimit) {\n        this.handlePaste(event);\n      }\n    });\n\n    // Initial check\n    this.checkLimit();\n  }\n\n  /**\n   * Create counter element\n   */\n  createCounter() {\n    this.counterElement = document.createElement('span');\n    this.counterElement.className = 'rte-maxlength-counter';\n    this.counterElement.style.cssText = `\n      padding: 2px 8px;\n      font-size: 12px;\n      color: var(--rte-text-muted);\n      transition: color 0.2s;\n    `;\n\n    const footer = this.editor.footer;\n    if (footer) {\n      footer.appendChild(this.counterElement);\n    }\n\n    this.updateCounter();\n  }\n\n  /**\n   * Update counter display\n   */\n  updateCounter() {\n    if (!this.counterElement) return;\n\n    const current = this.getCurrentCount();\n    const max = this.getMaxCount();\n    const remaining = max - current;\n    const percentage = current / max;\n\n    // Update text\n    if (this.options.countMode === 'words') {\n      this.counterElement.textContent = `${current} / ${max} ${this.translate('words')}`;\n    } else {\n      this.counterElement.textContent = `${current} / ${max}`;\n    }\n\n    // Update color based on state\n    if (current > max) {\n      this.counterElement.style.color = 'var(--rte-notification-error)';\n      this.counterElement.style.fontWeight = '600';\n    } else if (percentage >= this.options.warningThreshold) {\n      this.counterElement.style.color = 'var(--rte-notification-warning)';\n      this.counterElement.style.fontWeight = '500';\n    } else {\n      this.counterElement.style.color = 'var(--rte-text-muted)';\n      this.counterElement.style.fontWeight = 'normal';\n    }\n  }\n\n  /**\n   * Get current count\n   * @returns {number}\n   */\n  getCurrentCount() {\n    if (this.options.countMode === 'words') {\n      return this.editor.getWordCount();\n    }\n    return this.editor.getCharacterCount();\n  }\n\n  /**\n   * Get max count\n   * @returns {number}\n   */\n  getMaxCount() {\n    if (this.options.countMode === 'words') {\n      return this.options.maxWords || this.options.maxLength;\n    }\n    return this.options.maxLength;\n  }\n\n  /**\n   * Check if over limit\n   */\n  checkLimit() {\n    const current = this.getCurrentCount();\n    const max = this.getMaxCount();\n    const percentage = current / max;\n\n    // Update counter\n    this.updateCounter();\n\n    // Check warning threshold\n    const wasWarning = this.isWarning;\n    this.isWarning = percentage >= this.options.warningThreshold && current <= max;\n\n    if (this.isWarning && !wasWarning && this.options.showWarning) {\n      this.emit('maxLength:warning', {current, max, remaining: max - current});\n    }\n\n    // Check over limit\n    const wasOverLimit = this.isOverLimit;\n    this.isOverLimit = current > max;\n\n    if (this.isOverLimit && !wasOverLimit) {\n      this.emit('maxLength:exceeded', {current, max, over: current - max});\n\n      if (this.options.showWarning) {\n        this.notify(this.translate('Content exceeds maximum length'), 'warning');\n      }\n\n      // Enforce limit if enabled\n      if (this.options.enforceLimit) {\n        this.trimContent();\n      }\n    }\n  }\n\n  /**\n   * Trim content to max length\n   */\n  trimContent() {\n    if (this.options.countMode === 'words') {\n      this.trimToWords(this.getMaxCount());\n    } else {\n      this.trimToCharacters(this.getMaxCount());\n    }\n  }\n\n  /**\n   * Trim to max characters\n   * @param {number} maxChars\n   */\n  trimToCharacters(maxChars) {\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return;\n\n    const text = content.textContent;\n    if (text.length <= maxChars) return;\n\n    // Find the position in the HTML where we need to cut\n    let charCount = 0;\n    const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n      const nodeLength = node.textContent.length;\n\n      if (charCount + nodeLength >= maxChars) {\n        const cutAt = maxChars - charCount;\n        node.textContent = node.textContent.substring(0, cutAt);\n\n        // Remove remaining nodes\n        let next = walker.nextNode();\n        while (next) {\n          const toRemove = next;\n          next = walker.nextNode();\n          toRemove.parentNode.removeChild(toRemove);\n        }\n        break;\n      }\n\n      charCount += nodeLength;\n    }\n\n    this.recordHistory(true);\n  }\n\n  /**\n   * Trim to max words\n   * @param {number} maxWords\n   */\n  trimToWords(maxWords) {\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return;\n\n    let wordCount = 0;\n    const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n      const words = node.textContent.split(/\\s+/).filter(w => w.length > 0);\n\n      if (wordCount + words.length >= maxWords) {\n        const remainingWords = maxWords - wordCount;\n        const trimmedWords = words.slice(0, remainingWords);\n        node.textContent = trimmedWords.join(' ');\n\n        // Remove remaining nodes\n        let next = walker.nextNode();\n        while (next) {\n          const toRemove = next;\n          next = walker.nextNode();\n          toRemove.parentNode.removeChild(toRemove);\n        }\n        break;\n      }\n\n      wordCount += words.length;\n    }\n\n    this.recordHistory(true);\n  }\n\n  /**\n   * Handle paste to prevent exceeding limit\n   * @param {ClipboardEvent} event\n   */\n  handlePaste(event) {\n    const clipboardData = event.clipboardData || window.clipboardData;\n    if (!clipboardData) return;\n\n    const pastedText = clipboardData.getData('text/plain');\n    if (!pastedText) return;\n\n    const currentCount = this.getCurrentCount();\n    const maxCount = this.getMaxCount();\n    const remaining = maxCount - currentCount;\n\n    if (this.options.countMode === 'words') {\n      const pastedWords = pastedText.split(/\\s+/).filter(w => w.length > 0);\n      if (pastedWords.length > remaining) {\n        event.preventDefault();\n\n        // Insert only allowed words\n        const allowedText = pastedWords.slice(0, remaining).join(' ');\n        this.insertHtml(allowedText);\n\n        this.notify(this.translate('Pasted content was trimmed to fit limit'), 'warning');\n      }\n    } else {\n      if (pastedText.length > remaining) {\n        event.preventDefault();\n\n        // Insert only allowed characters\n        const allowedText = pastedText.substring(0, remaining);\n        this.insertHtml(allowedText);\n\n        this.notify(this.translate('Pasted content was trimmed to fit limit'), 'warning');\n      }\n    }\n  }\n\n  /**\n   * Get remaining count\n   * @returns {number}\n   */\n  getRemainingCount() {\n    return this.getMaxCount() - this.getCurrentCount();\n  }\n\n  /**\n   * Check if content is at limit\n   * @returns {boolean}\n   */\n  isAtLimit() {\n    return this.getCurrentCount() >= this.getMaxCount();\n  }\n\n  /**\n   * Check if content exceeds limit\n   * @returns {boolean}\n   */\n  isExceeded() {\n    return this.isOverLimit;\n  }\n\n  /**\n   * Set max length\n   * @param {number} max\n   */\n  setMaxLength(max) {\n    this.options.maxLength = max;\n    this.checkLimit();\n  }\n\n  /**\n   * Set max words\n   * @param {number} max\n   */\n  setMaxWords(max) {\n    this.options.maxWords = max;\n    this.options.countMode = 'words';\n    this.checkLimit();\n  }\n\n  destroy() {\n    if (this.counterElement && this.counterElement.parentNode) {\n      this.counterElement.parentNode.removeChild(this.counterElement);\n    }\n    super.destroy();\n  }\n}\n\nexport default MaxLengthPlugin;\n","/**\n * MentionPlugin - @mentions with autocomplete\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nimport PluginBase from '../PluginBase.js';\nimport EventBus from '../../core/EventBus.js';\n\nclass MentionPlugin extends PluginBase {\n  static pluginName = 'mention';\n\n  init() {\n    super.init();\n\n    this.options = {\n      trigger: '@',\n      minChars: 1,\n      maxSuggestions: 10,\n      debounceTime: 200,\n      dataSource: null, // Function that returns Promise<Array>\n      renderItem: null, // Custom render function\n      insertTemplate: null, // Custom insert template\n      linkTemplate: null, // Generate link from item\n      ...this.options\n    };\n\n    this.dropdown = null;\n    this.isOpen = false;\n    this.searchQuery = '';\n    this.selectedIndex = -1;\n    this.suggestions = [];\n    this.debounceTimer = null;\n    this.triggerPosition = null;\n\n    this.createDropdown();\n    this.attachListeners();\n  }\n\n  /**\n   * Create dropdown element\n   */\n  createDropdown() {\n    this.dropdown = document.createElement('div');\n    this.dropdown.className = 'rte-mention-dropdown';\n    this.dropdown.style.cssText = `\n      position: absolute;\n      z-index: 10002;\n      background: var(--rte-bg-color, #fff);\n      border: 1px solid var(--rte-border-color, #ddd);\n      border-radius: 8px;\n      box-shadow: 0 4px 16px rgba(0,0,0,0.15);\n      max-width: 300px;\n      min-width: 200px;\n      max-height: 250px;\n      overflow-y: auto;\n      display: none;\n    `;\n\n    document.body.appendChild(this.dropdown);\n  }\n\n  /**\n   * Attach event listeners\n   */\n  attachListeners() {\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return;\n\n    // Listen for input events\n    content.addEventListener('input', this.handleInput.bind(this));\n\n    // Listen for keydown for navigation\n    content.addEventListener('keydown', this.handleKeyDown.bind(this));\n\n    // Close on outside click\n    document.addEventListener('click', this.handleDocumentClick.bind(this));\n  }\n\n  /**\n   * Handle input event\n   * @param {InputEvent} event\n   */\n  handleInput(event) {\n    // Check if trigger character was typed\n    if (this.checkTrigger()) {\n      this.open();\n    } else if (this.isOpen) {\n      // Update search if dropdown is open\n      const query = this.getSearchQuery();\n      if (query !== null) {\n        this.search(query);\n      } else {\n        this.close();\n      }\n    }\n  }\n\n  /**\n   * Check if trigger was typed\n   * @returns {boolean}\n   */\n  checkTrigger() {\n    const range = this.getRange();\n    if (!range || !range.collapsed) return false;\n\n    const text = this.getTextBeforeCursor();\n    if (!text) return false;\n\n    // Check for trigger at the end, after whitespace or at start\n    const triggerPattern = new RegExp(`(^|\\\\s)${this.escapeRegex(this.options.trigger)}$`);\n    return triggerPattern.test(text);\n  }\n\n  /**\n   * Get text before cursor\n   * @returns {string}\n   */\n  getTextBeforeCursor() {\n    const range = this.getRange();\n    if (!range) return '';\n\n    const selection = this.getSelection();\n    const content = this.editor.contentArea?.getElement();\n    if (!content) return '';\n\n    const preRange = document.createRange();\n    preRange.selectNodeContents(content);\n    preRange.setEnd(range.startContainer, range.startOffset);\n\n    const text = preRange.toString();\n    return text;\n  }\n\n  /**\n   * Get search query after trigger\n   * @returns {string|null}\n   */\n  getSearchQuery() {\n    const text = this.getTextBeforeCursor();\n\n    // Find the trigger in text\n    const triggerIndex = text.lastIndexOf(this.options.trigger);\n    if (triggerIndex === -1) return null;\n\n    // Check if there's whitespace after trigger start\n    const query = text.substring(triggerIndex + this.options.trigger.length);\n\n    // If query contains whitespace, the mention is complete\n    if (/\\s/.test(query)) return null;\n\n    return query;\n  }\n\n  /**\n   * Handle keydown for navigation\n   * @param {KeyboardEvent} event\n   */\n  handleKeyDown(event) {\n    if (!this.isOpen) return;\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        this.selectNext();\n        break;\n\n      case 'ArrowUp':\n        event.preventDefault();\n        this.selectPrevious();\n        break;\n\n      case 'Enter':\n      case 'Tab':\n        if (this.selectedIndex >= 0) {\n          event.preventDefault();\n          this.insertMention(this.suggestions[this.selectedIndex]);\n        }\n        break;\n\n      case 'Escape':\n        event.preventDefault();\n        this.close();\n        break;\n    }\n  }\n\n  /**\n   * Handle document click\n   * @param {MouseEvent} event\n   */\n  handleDocumentClick(event) {\n    if (this.isOpen && !this.dropdown.contains(event.target)) {\n      this.close();\n    }\n  }\n\n  /**\n   * Open dropdown\n   */\n  open() {\n    this.isOpen = true;\n    this.selectedIndex = -1;\n    this.triggerPosition = this.getCaretPosition();\n    this.search('');\n  }\n\n  /**\n   * Close dropdown\n   */\n  close() {\n    this.isOpen = false;\n    this.dropdown.style.display = 'none';\n    this.selectedIndex = -1;\n    this.suggestions = [];\n  }\n\n  /**\n   * Search for suggestions\n   * @param {string} query\n   */\n  search(query) {\n    this.searchQuery = query;\n\n    // Cancel previous debounce\n    if (this.debounceTimer) {\n      clearTimeout(this.debounceTimer);\n    }\n\n    // Debounce search\n    this.debounceTimer = setTimeout(async () => {\n      await this.performSearch(query);\n    }, this.options.debounceTime);\n  }\n\n  /**\n   * Perform the search\n   * @param {string} query\n   */\n  async performSearch(query) {\n    if (query.length < this.options.minChars && query.length > 0) {\n      this.renderSuggestions([]);\n      return;\n    }\n\n    let results = [];\n\n    if (typeof this.options.dataSource === 'function') {\n      try {\n        results = await this.options.dataSource(query);\n      } catch (e) {\n        console.error('Mention search error:', e);\n      }\n    } else if (Array.isArray(this.options.dataSource)) {\n      // Filter local data\n      results = this.options.dataSource.filter(item => {\n        const name = item.name || item.label || item;\n        return name.toLowerCase().includes(query.toLowerCase());\n      });\n    }\n\n    // Limit results\n    results = results.slice(0, this.options.maxSuggestions);\n\n    this.suggestions = results;\n    this.renderSuggestions(results);\n  }\n\n  /**\n   * Render suggestions\n   * @param {Array} items\n   */\n  renderSuggestions(items) {\n    this.dropdown.innerHTML = '';\n\n    if (items.length === 0) {\n      this.dropdown.style.display = 'none';\n      return;\n    }\n\n    items.forEach((item, index) => {\n      const el = document.createElement('div');\n      el.className = 'rte-mention-item';\n      el.style.cssText = `\n        padding: 10px 14px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        transition: background 0.15s;\n      `;\n\n      // Custom render or default\n      if (typeof this.options.renderItem === 'function') {\n        el.innerHTML = this.options.renderItem(item);\n      } else {\n        el.innerHTML = this.defaultRenderItem(item);\n      }\n\n      // Hover effect\n      el.addEventListener('mouseover', () => {\n        el.style.background = 'var(--rte-bg-hover, #f0f0f0)';\n        this.selectedIndex = index;\n        this.updateSelection();\n      });\n      el.addEventListener('mouseout', () => {\n        if (this.selectedIndex !== index) {\n          el.style.background = 'transparent';\n        }\n      });\n\n      // Click to insert\n      el.addEventListener('click', () => {\n        this.insertMention(item);\n      });\n\n      this.dropdown.appendChild(el);\n    });\n\n    // Position and show dropdown\n    this.positionDropdown();\n    this.dropdown.style.display = 'block';\n\n    // Select first item\n    if (items.length > 0) {\n      this.selectedIndex = 0;\n      this.updateSelection();\n    }\n  }\n\n  /**\n   * Default item render\n   * @param {*} item\n   * @returns {string}\n   */\n  defaultRenderItem(item) {\n    if (typeof item === 'string') {\n      return `<span>${this.escapeHtml(item)}</span>`;\n    }\n\n    let html = '';\n\n    // Avatar\n    if (item.avatar || item.image) {\n      html += `<img src=\"${item.avatar || item.image}\" style=\"width: 32px; height: 32px; border-radius: 50%; object-fit: cover;\">`;\n    }\n\n    // Name and description\n    html += '<div style=\"flex: 1; min-width: 0;\">';\n    html += `<div style=\"font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${this.escapeHtml(item.name || item.label)}</div>`;\n\n    if (item.description || item.username) {\n      html += `<div style=\"font-size: 12px; color: var(--rte-text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${this.escapeHtml(item.description || '@' + item.username)}</div>`;\n    }\n\n    html += '</div>';\n\n    return html;\n  }\n\n  /**\n   * Position dropdown near caret\n   */\n  positionDropdown() {\n    if (!this.triggerPosition) return;\n\n    const content = this.editor.contentArea?.getContainer();\n    if (!content) return;\n\n    const contentRect = content.getBoundingClientRect();\n\n    // Position below caret\n    let top = this.triggerPosition.top + this.triggerPosition.height + 4;\n    let left = this.triggerPosition.left;\n\n    // Adjust if would go off screen\n    const dropdownRect = this.dropdown.getBoundingClientRect();\n\n    if (left + 300 > window.innerWidth) {\n      left = window.innerWidth - 310;\n    }\n\n    if (top + 250 > window.innerHeight) {\n      top = this.triggerPosition.top - 260;\n    }\n\n    this.dropdown.style.top = `${top}px`;\n    this.dropdown.style.left = `${left}px`;\n  }\n\n  /**\n   * Get caret position\n   * @returns {Object}\n   */\n  getCaretPosition() {\n    const range = this.getRange();\n    if (!range) return {top: 0, left: 0, height: 20};\n\n    const rect = range.getBoundingClientRect();\n    return {\n      top: rect.bottom || rect.top + 20,\n      left: rect.left,\n      height: rect.height || 20\n    };\n  }\n\n  /**\n   * Select next suggestion\n   */\n  selectNext() {\n    if (this.suggestions.length === 0) return;\n\n    this.selectedIndex = (this.selectedIndex + 1) % this.suggestions.length;\n    this.updateSelection();\n  }\n\n  /**\n   * Select previous suggestion\n   */\n  selectPrevious() {\n    if (this.suggestions.length === 0) return;\n\n    this.selectedIndex--;\n    if (this.selectedIndex < 0) {\n      this.selectedIndex = this.suggestions.length - 1;\n    }\n    this.updateSelection();\n  }\n\n  /**\n   * Update selection visual\n   */\n  updateSelection() {\n    const items = this.dropdown.querySelectorAll('.rte-mention-item');\n    items.forEach((item, index) => {\n      if (index === this.selectedIndex) {\n        item.style.background = 'var(--rte-bg-hover, #f0f0f0)';\n        item.scrollIntoView({block: 'nearest'});\n      } else {\n        item.style.background = 'transparent';\n      }\n    });\n  }\n\n  /**\n   * Insert mention\n   * @param {*} item\n   */\n  insertMention(item) {\n    this.close();\n\n    // Delete the trigger and query from content\n    this.deleteTriggerAndQuery();\n\n    // Generate mention HTML\n    let html;\n\n    if (typeof this.options.insertTemplate === 'function') {\n      html = this.options.insertTemplate(item);\n    } else {\n      const name = item.name || item.label || item;\n      const link = typeof this.options.linkTemplate === 'function'\n        ? this.options.linkTemplate(item)\n        : null;\n\n      if (link) {\n        html = `<a href=\"${this.escapeHtml(link)}\" class=\"rte-mention\" contenteditable=\"false\">@${this.escapeHtml(name)}</a>&nbsp;`;\n      } else {\n        html = `<span class=\"rte-mention\" contenteditable=\"false\" data-mention-id=\"${this.escapeHtml(item.id || '')}\">@${this.escapeHtml(name)}</span>&nbsp;`;\n      }\n    }\n\n    // Insert mention\n    this.insertHtml(html);\n    this.recordHistory(true);\n\n    // Emit event\n    this.emit('mention:insert', {item});\n  }\n\n  /**\n   * Delete the trigger character and search query\n   */\n  deleteTriggerAndQuery() {\n    const range = this.getRange();\n    if (!range) return;\n\n    const text = this.getTextBeforeCursor();\n    const triggerIndex = text.lastIndexOf(this.options.trigger);\n    if (triggerIndex === -1) return;\n\n    const deleteLength = text.length - triggerIndex;\n\n    // Create range to delete\n    const deleteRange = document.createRange();\n    deleteRange.setStart(range.startContainer, range.startOffset - deleteLength);\n    deleteRange.setEnd(range.startContainer, range.startOffset);\n    deleteRange.deleteContents();\n  }\n\n  /**\n   * Escape HTML\n   * @param {string} str\n   * @returns {string}\n   */\n  escapeHtml(str) {\n    if (typeof str !== 'string') return '';\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  }\n\n  /**\n   * Escape regex special characters\n   * @param {string} str\n   * @returns {string}\n   */\n  escapeRegex(str) {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  }\n\n  destroy() {\n    if (this.dropdown && this.dropdown.parentNode) {\n      this.dropdown.parentNode.removeChild(this.dropdown);\n    }\n    if (this.debounceTimer) {\n      clearTimeout(this.debounceTimer);\n    }\n    super.destroy();\n  }\n}\n\nexport default MentionPlugin;\n","/**\n * RichTextEditor - Config Profiles\n * Pre-defined configurations for common use cases\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\n\n/**\n * Full profile - All features enabled\n */\nexport const full = {\n  name: 'full',\n  plugins: [\n    'link', 'image', 'table', 'video',\n    'emoji', 'specialChars',\n    'sourceView', 'fullscreen', 'findReplace',\n    'autosave', 'wordcount', 'maxLength', 'mention'\n  ],\n  toolbar: [\n    ['bold', 'italic', 'underline', 'strikethrough'],\n    ['heading'],\n    ['bulletList', 'numberedList'],\n    ['alignLeft', 'alignCenter', 'alignRight', 'alignJustify'],\n    ['indent', 'outdent'],\n    ['link', 'image', 'video', 'table'],\n    ['blockquote', 'codeBlock', 'horizontalRule'],\n    ['textColor', 'backgroundColor'],\n    ['emoji', 'specialChars'],\n    ['undo', 'redo'],\n    ['removeFormat', 'findReplace', 'sourceView', 'fullscreen']\n  ],\n  options: {\n    minHeight: 300,\n    autosave: {\n      interval: 30000,\n      useLocalStorage: true\n    },\n    maxLength: {\n      maxLength: 50000,\n      showCounter: true\n    },\n    wordcount: {\n      showWords: true,\n      showCharacters: true\n    }\n  }\n};\n\n/**\n * Basic profile - Common features for general use\n */\nexport const basic = {\n  name: 'basic',\n  plugins: [\n    'link', 'image', 'table',\n    'sourceView', 'wordcount'\n  ],\n  toolbar: [\n    ['bold', 'italic', 'underline'],\n    ['heading'],\n    ['bulletList', 'numberedList'],\n    ['alignLeft', 'alignCenter', 'alignRight'],\n    ['link', 'image', 'table'],\n    ['textColor', 'backgroundColor'],\n    ['undo', 'redo'],\n    ['removeFormat', 'sourceView']\n  ],\n  options: {\n    minHeight: 250,\n    wordcount: {\n      showWords: true,\n      showCharacters: false\n    }\n  }\n};\n\n/**\n * Minimal profile - Text formatting only\n */\nexport const minimal = {\n  name: 'minimal',\n  plugins: [],\n  toolbar: [\n    ['bold', 'italic', 'underline'],\n    ['bulletList', 'numberedList'],\n    ['undo', 'redo'],\n    ['removeFormat']\n  ],\n  options: {\n    minHeight: 150\n  }\n};\n\n/**\n * Comment profile - For short comments/replies\n */\nexport const comment = {\n  name: 'comment',\n  plugins: ['link', 'emoji'],\n  toolbar: [\n    ['bold', 'italic'],\n    ['link', 'emoji'],\n    ['undo', 'redo']\n  ],\n  options: {\n    minHeight: 100,\n    maxLength: {\n      maxLength: 2000,\n      showCounter: true\n    }\n  }\n};\n\n/**\n * Email profile - For composing emails\n */\nexport const email = {\n  name: 'email',\n  plugins: ['link', 'image', 'autosave'],\n  toolbar: [\n    ['bold', 'italic', 'underline'],\n    ['bulletList', 'numberedList'],\n    ['alignLeft', 'alignCenter', 'alignRight'],\n    ['link', 'image'],\n    ['textColor'],\n    ['undo', 'redo']\n  ],\n  options: {\n    minHeight: 300,\n    autosave: {\n      interval: 10000,\n      useLocalStorage: true\n    }\n  }\n};\n\n/**\n * All available profiles\n */\nexport const profiles = {\n  full,\n  basic,\n  minimal,\n  comment,\n  email\n};\n\nexport default profiles;\n","/**\n * RichTextEditor - Default Configuration\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\n\nexport const defaults = {\n  // Container\n  height: 'auto',\n  minHeight: 200,\n  maxHeight: null,\n  placeholder: '',\n  readOnly: false,\n  autofocus: false,\n  sanitize: true,\n\n  // Toolbar\n  toolbar: [\n    'bold', 'italic', 'underline', '|',\n    'heading', '|',\n    'bulletList', 'numberedList', '|',\n    'alignLeft', 'alignCenter', 'alignRight', '|',\n    'link', 'image', '|',\n    'textColor', 'backgroundColor', '|',\n    'undo', 'redo', '|',\n    'removeFormat'\n  ],\n  stickyToolbar: false,\n\n  // Plugins\n  plugins: [],\n\n  // Plugin options\n  autosave: {\n    interval: 30000,\n    key: 'rte-autosave',\n    saveHandler: null,\n    useLocalStorage: true,\n    showIndicator: true\n  },\n\n  wordcount: {\n    showWords: true,\n    showCharacters: true,\n    showCharactersWithoutSpaces: false\n  },\n\n  maxLength: {\n    maxLength: 10000,\n    maxWords: null,\n    countMode: 'characters',\n    showCounter: true,\n    showWarning: true,\n    warningThreshold: 0.9,\n    enforceLimit: true\n  },\n\n  mention: {\n    trigger: '@',\n    minChars: 1,\n    maxSuggestions: 10,\n    debounceTime: 200,\n    dataSource: null,\n    renderItem: null,\n    insertTemplate: null,\n    linkTemplate: null\n  },\n\n  image: {\n    uploadUrl: null,\n    fileBrowser: {\n      enabled: true,\n      options: {\n        apiActions: {\n          getPresetCategories: '../../js/components/editor/php/filebrowser.php?action=get_preset_categories',\n          getPresets: '../../js/components/editor/php/filebrowser.php?action=get_presets',\n          getFiles: '../../js/components/editor/php/filebrowser.php?action=get_files',\n          getFolderTree: '../../js/components/editor/php/filebrowser.php?action=get_folder_tree',\n          upload: '../../js/components/editor/php/filebrowser.php?action=upload',\n          createFolder: '../../js/components/editor/php/filebrowser.php?action=create_folder',\n          rename: '../../js/components/editor/php/filebrowser.php?action=rename',\n          delete: '../../js/components/editor/php/filebrowser.php?action=delete',\n          copy: '../../js/components/editor/php/filebrowser.php?action=copy',\n          move: '../../js/components/editor/php/filebrowser.php?action=move'\n        }\n      }\n    },\n    maxFileSize: 5 * 1024 * 1024,\n    allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\n  },\n\n  video: {\n    allowedProviders: ['youtube', 'vimeo'],\n    responsive: true\n  },\n\n  findReplace: {\n    matchCase: false,\n    wholeWord: false\n  },\n\n  // Theme (CSS variables override)\n  theme: {\n    primaryColor: null,\n    borderRadius: null,\n    fontFamily: null\n  }\n};\n\n/**\n * Merge user options with defaults\n * @param {Object} userOptions\n * @param {Object} profileOptions\n * @returns {Object}\n */\nexport function mergeOptions(userOptions = {}, profileOptions = {}) {\n  const merged = {...defaults};\n\n  // Merge profile options\n  Object.keys(profileOptions).forEach(key => {\n    if (typeof profileOptions[key] === 'object' && !Array.isArray(profileOptions[key])) {\n      merged[key] = {...merged[key], ...profileOptions[key]};\n    } else {\n      merged[key] = profileOptions[key];\n    }\n  });\n\n  // Merge user options (highest priority)\n  Object.keys(userOptions).forEach(key => {\n    if (typeof userOptions[key] === 'object' && !Array.isArray(userOptions[key]) && merged[key]) {\n      merged[key] = {...merged[key], ...userOptions[key]};\n    } else {\n      merged[key] = userOptions[key];\n    }\n  });\n\n  return merged;\n}\n\nexport default defaults;\n","/**\n * RichTextEditor - Main Entry Point\n * Single file to import all components and plugins\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\n\n// Core\nimport RichTextEditor from './RichTextEditor.js';\nimport EventBus from './core/EventBus.js';\nimport CommandManager from './core/CommandManager.js';\nimport HistoryManager from './core/HistoryManager.js';\nimport SelectionManager from './core/SelectionManager.js';\nimport KeyboardManager from './core/KeyboardManager.js';\n\n// Plugins - Media\nimport LinkPlugin from './plugins/media/LinkPlugin.js';\nimport ImagePlugin from './plugins/media/ImagePlugin.js';\nimport TablePlugin from './plugins/media/TablePlugin.js';\nimport VideoPlugin from './plugins/media/VideoPlugin.js';\nimport EmojiPlugin from './plugins/media/EmojiPlugin.js';\nimport SpecialCharsPlugin from './plugins/media/SpecialCharsPlugin.js';\n\n// Plugins - Utility\nimport SourceViewPlugin from './plugins/utility/SourceViewPlugin.js';\nimport FullscreenPlugin from './plugins/utility/FullscreenPlugin.js';\nimport AutosavePlugin from './plugins/utility/AutosavePlugin.js';\nimport WordCountPlugin from './plugins/utility/WordCountPlugin.js';\nimport FindReplacePlugin from './plugins/utility/FindReplacePlugin.js';\nimport MaxLengthPlugin from './plugins/utility/MaxLengthPlugin.js';\nimport MentionPlugin from './plugins/utility/MentionPlugin.js';\n\n// Config\nimport profiles from './configs/profiles.js';\nimport defaults, {mergeOptions} from './configs/defaults.js';\n\n// Auto-register all plugins\nconst allPlugins = {\n  link: LinkPlugin,\n  image: ImagePlugin,\n  table: TablePlugin,\n  video: VideoPlugin,\n  emoji: EmojiPlugin,\n  specialChars: SpecialCharsPlugin,\n  sourceView: SourceViewPlugin,\n  fullscreen: FullscreenPlugin,\n  autosave: AutosavePlugin,\n  wordcount: WordCountPlugin,\n  findReplace: FindReplacePlugin,\n  maxLength: MaxLengthPlugin,\n  mention: MentionPlugin\n};\n\n// Register all plugins\nObject.entries(allPlugins).forEach(([name, plugin]) => {\n  RichTextEditor.registerPlugin(name, plugin);\n});\n\n/**\n * Create editor with profile\n * @param {string|HTMLElement} selector - CSS selector or element\n * @param {string|Object} profileOrOptions - Profile name or options object\n * @returns {RichTextEditor}\n */\nRichTextEditor.create = function(selector, profileOrOptions = 'basic') {\n  let options = {};\n\n  if (typeof profileOrOptions === 'string') {\n    // Use named profile\n    const profile = profiles[profileOrOptions];\n    if (!profile) {\n      console.warn(`Profile \"${profileOrOptions}\" not found, using \"basic\"`);\n      options = mergeOptions({}, profiles.basic.options);\n      options.plugins = profiles.basic.plugins;\n      options.toolbar = profiles.basic.toolbar;\n    } else {\n      options = mergeOptions({}, profile.options);\n      options.plugins = profile.plugins;\n      options.toolbar = profile.toolbar;\n    }\n  } else if (typeof profileOrOptions === 'object') {\n    // Use custom options with optional profile base\n    const profileName = profileOrOptions.profile || 'basic';\n    const profile = profiles[profileName] || profiles.basic;\n\n    options = mergeOptions(profileOrOptions, profile.options);\n\n    // Use profile's plugins/toolbar unless overridden\n    options.plugins = profileOrOptions.plugins || profile.plugins;\n    options.toolbar = profileOrOptions.toolbar || profile.toolbar;\n  }\n\n  return new RichTextEditor(selector, options);\n};\n\n/**\n * Get available profiles\n * @returns {Object}\n */\nRichTextEditor.getProfiles = function() {\n  return {...profiles};\n};\n\n/**\n * Get default options\n * @returns {Object}\n */\nRichTextEditor.getDefaults = function() {\n  return {...defaults};\n};\n\n/**\n * Register custom profile\n * @param {string} name\n * @param {Object} profile\n */\nRichTextEditor.registerProfile = function(name, profile) {\n  profiles[name] = profile;\n};\n\n// Exports\nexport {\n  RichTextEditor,\n  EventBus,\n  CommandManager,\n  HistoryManager,\n  SelectionManager,\n  KeyboardManager,\n  LinkPlugin,\n  ImagePlugin,\n  TablePlugin,\n  VideoPlugin,\n  EmojiPlugin,\n  SpecialCharsPlugin,\n  SourceViewPlugin,\n  FullscreenPlugin,\n  AutosavePlugin,\n  WordCountPlugin,\n  FindReplacePlugin,\n  MaxLengthPlugin,\n  MentionPlugin,\n  profiles,\n  defaults,\n  mergeOptions\n};\n\nexport default RichTextEditor;\n","/**\n * FileBrowser - ระบบจัดการไฟล์แบบ Modal สำหรับการเลือกไฟล์\n * รองรับการแสดงผลเป็น 2 แท็บ: ไฟล์ที่เตรียมไว้ และ File Browser\n * มีฟังก์ชันอัปโหลด สร้างโฟลเดอร์ เปลี่ยนชื่อ และลบไฟล์\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\nclass FileBrowser {\n  constructor(options = {}) {\n    this.options = {\n      apiActions: {\n        getPresetCategories: '/file-browser/get_preset_categories',\n        getPresets: '/file-browser/get_presets',\n        getFiles: '/file-browser/get_files',\n        getFolderTree: '/file-browser/get_folder_tree',\n        upload: '/file-browser/upload',\n        createFolder: '/file-browser/create_folder',\n        rename: '/file-browser/rename',\n        delete: '/file-browser/delete',\n        copy: '/file-browser/copy',\n        move: '/file-browser/move'\n      },\n      requestTransformer: null,\n      responseTransformer: null,\n      showPresetTab: true,\n      presetTabName: 'Prepared file',\n      browserTabName: 'File management',\n      allowedFileTypes: window.CONFIG?.FILE_UPLOAD?.ALLOWED_FILE_TYPES || 'image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt',\n      thumbnailSize: 120,\n      maxFileSize: window.CONFIG?.FILE_UPLOAD?.MAX_FILE_SIZE || 5 * 1024 * 1024,\n      onSelect: null,\n      onClose: null,\n      onError: null,\n      activeTab: 1,\n      multiSelect: false,\n      customContextMenuItems: [],\n      useApiClient: typeof window.ApiClient !== 'undefined',\n      auth: {\n        type: 'token',\n        getToken: null,\n        headerName: 'Authorization',\n        headerFormat: 'Bearer {token}',\n        credentials: 'include',\n      },\n      ...options\n    };\n\n    if (!window.translate) {\n      window.translate = (key) => {return key};\n    }\n\n    if (this.options.useApiClient && !window.ApiClient) {\n      console.warn('ApiClient not found. Setting useApiClient to false.');\n      this.options.useApiClient = false;\n    }\n\n    this.currentPath = '/';\n    this.currentPresetCategory = null;\n    this.selectedFiles = [];\n    this.clipboardFile = null;\n    this.clipboardAction = null;\n    this.searchTerm = '';\n    this.sortBy = 'name';\n    this.sortDir = 'asc';\n    this.viewMode = 'grid';\n    this.isLoading = false;\n    this.breadcrumbs = [{name: 'Home', path: '/'}];\n\n    this.fileIcons = {\n      'default': 'icon-file',\n      'folder': 'icon-folder',\n      'image': 'icon-image',\n      'pdf': 'icon-pdf',\n      'doc': 'icon-word',\n      'docx': 'icon-word',\n      'xls': 'icon-excel',\n      'xlsx': 'icon-excel',\n      'ppt': 'icon-ppt',\n      'pptx': 'icon-ppt',\n      'txt': 'icon-document',\n      'zip': 'icon-zip',\n      'rar': 'icon-zip',\n      'mp3': 'icon-song',\n      'mp4': 'icon-video',\n      'mov': 'icon-video'\n    };\n\n    // Image extensions for thumbnail detection\n    this.imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'ico', 'bmp'];\n\n    this.bindMethods();\n    this.createDOMElements();\n    this.addEventListeners();\n  }\n\n  /**\n   * Check if extension is an image type\n   */\n  isImageExtension(ext) {\n    if (!ext) return false;\n    return this.imageExtensions.includes(ext.toLowerCase().replace('.', ''));\n  }\n\n  bindMethods() {\n    this.open = this.open.bind(this);\n    this.close = this.close.bind(this);\n    this.loadFiles = this.loadFiles.bind(this);\n    this.loadPresets = this.loadPresets.bind(this);\n    this.loadPresetCategories = this.loadPresetCategories.bind(this);\n    this.switchTab = this.switchTab.bind(this);\n    this.selectFile = this.selectFile.bind(this);\n    this.uploadFiles = this.uploadFiles.bind(this);\n    this.createFolder = this.createFolder.bind(this);\n    this.renameFile = this.renameFile.bind(this);\n    this.deleteFile = this.deleteFile.bind(this);\n    this.showContextMenu = this.showContextMenu.bind(this);\n    this.hideContextMenu = this.hideContextMenu.bind(this);\n    this.navigateToFolder = this.navigateToFolder.bind(this);\n    this.search = this.search.bind(this);\n    this.sort = this.sort.bind(this);\n    this.confirmSelection = this.confirmSelection.bind(this);\n    this.pasteFromClipboard = this.pasteFromClipboard.bind(this);\n    this.changeViewMode = this.changeViewMode.bind(this);\n    this.handleEscapeKey = this.handleEscapeKey.bind(this);\n    this.handleDragOver = this.handleDragOver.bind(this);\n    this.handleDrop = this.handleDrop.bind(this);\n    this.updateStatus = this.updateStatus.bind(this);\n    this.makeApiRequest = this.makeApiRequest.bind(this);\n    this.uploadFilesWithApi = this.uploadFilesWithApi.bind(this);\n  }\n\n  async makeApiRequest(endpoint, data, method = 'POST') {\n    try {\n      let endpointUrl = this.options.apiActions[endpoint] || endpoint;\n      let requestData = data;\n      let result;\n\n      if (typeof this.options.requestTransformer === 'function') {\n        requestData = this.options.requestTransformer(endpoint, data);\n      }\n\n      if (this.options.useApiClient && window.ApiClient) {\n        return window.ApiClient.fetch(endpointUrl, {\n          method: method,\n          headers: {\n            'Content-Type': 'application/json'\n          },\n\n          body: method !== 'GET' ? requestData : undefined\n        }).then(response => {\n          if (typeof this.options.responseTransformer === 'function') {\n            return this.options.responseTransformer(endpoint, response);\n          }\n          return response;\n        });\n      } else {\n        const fetchOptions = {\n          method: method,\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          credentials: this.options.auth.credentials || 'include'\n        };\n\n        if (method !== 'GET' && requestData) {\n          fetchOptions.body = JSON.stringify(requestData);\n        }\n\n        fetchOptions.headers = this.addAuthToRequest(fetchOptions.headers);\n\n        const url = endpointUrl;\n        const response = await fetch(url, fetchOptions);\n\n        if (response.status === 401 || response.status === 403) {\n          throw new Error('Authentication required');\n        }\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          throw new Error(errorData.message || `Request failed with status ${response.status}`);\n        }\n\n        result = await response.json();\n\n        if (typeof this.options.responseTransformer === 'function') {\n          result = this.options.responseTransformer(endpoint, result);\n        }\n      }\n\n      return result;\n    } catch (error) {\n      console.error('API request error:', error);\n      this.updateStatus('Error: ' + (error.message || 'Unknown error'));\n      if (this.options.onError) {\n        this.options.onError(error);\n      }\n      throw error;\n    }\n  }\n\n  addAuthToRequest(headers) {\n    const auth = this.options.auth;\n\n    if (!auth || auth.type === 'none') {\n      return headers;\n    }\n\n    switch (auth.type) {\n      case 'token':\n        const token = typeof auth.getToken === 'function' ? auth.getToken() : null;\n        if (token) {\n          headers[auth.headerName] = auth.headerFormat.replace('{token}', token);\n        }\n        break;\n      case 'basic':\n\n        if (auth.username && auth.password) {\n          const credentials = btoa(`${auth.username}:${auth.password}`);\n          headers[auth.headerName] = `Basic ${credentials}`;\n        }\n        break;\n      case 'custom':\n\n        if (typeof auth.customHandler === 'function') {\n          headers = auth.customHandler(headers);\n        }\n        break;\n    }\n\n    return headers;\n  }\n\n  async uploadFilesWithApi(files, path) {\n    try {\n      const validFiles = Array.from(files).filter(file => {\n        if (file.size > this.options.maxFileSize) {\n          this.logSecurityIssue(`File too large: ${this.sanitizeFileName(file.name)}`);\n          return false;\n        }\n\n        if (!this.isAllowedFileType(file)) {\n          this.logSecurityIssue(`File type not allowed: ${this.sanitizeFileName(file.name)}`);\n          return false;\n        }\n\n        return true;\n      });\n\n      if (validFiles.length === 0) {\n        this.updateStatus('No valid files to upload');\n        return {success: false, message: 'No valid files to upload'};\n      }\n\n      const endpoint = this.options.apiActions.upload || '/file-browser/upload';\n\n      const additionalData = {\n        path: path || this.currentPath\n      };\n\n      if (this.options.useApiClient && window.ApiClient) {\n        const result = await window.ApiClient.uploadFile(endpoint, validFiles, additionalData);\n\n        if (typeof this.options.responseTransformer === 'function') {\n          return this.options.responseTransformer('upload', result);\n        }\n\n        return result;\n      } else {\n        const formData = new FormData();\n\n        Object.keys(additionalData).forEach(key => {\n          formData.append(key, additionalData[key]);\n        });\n\n        validFiles.forEach(file => {\n          formData.append(this.options.fileFieldName || 'files[]', file);\n        });\n\n        let requestOptions = {\n          method: 'POST',\n          body: formData,\n          credentials: this.options.auth.credentials || 'include'\n        };\n\n        const headers = {};\n        requestOptions.headers = this.addAuthToRequest(headers);\n\n        const response = await fetch(endpoint, requestOptions);\n        const result = await response.json();\n\n        if (typeof this.options.responseTransformer === 'function') {\n          return this.options.responseTransformer('upload', result);\n        }\n\n        return result;\n      }\n    } catch (error) {\n      console.error('File upload error:', error);\n      if (this.options.onError) {\n        this.options.onError(error);\n      }\n      return {success: false, message: error.message || 'Upload failed'};\n    }\n  }\n\n  /**\n   * ตรวจสอบ CSRF token จาก meta tag\n   */\n  checkCsrfMetaTag() {\n    const metaTag = document.querySelector('meta[name=\"csrf-token\"]');\n    if (metaTag) {\n      this.csrfToken = metaTag.getAttribute('content');\n    }\n  }\n\n  /**\n   * ดึง CSRF token\n   * @returns {Promise<string>} - CSRF token\n   */\n  async getCsrfToken() {\n    if (this.csrfToken && this.csrfToken !== '') {\n      return this.csrfToken;\n    }\n\n    if (!this.options.csrfProtection) {\n      return '';\n    }\n\n    try {\n      const response = await fetch(this.options.csrfTokenUrl, {\n        method: 'GET',\n        credentials: 'same-origin'\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to get CSRF token: ${response.status}`);\n      }\n\n      const result = await response.json();\n\n      if (!result.success || !result.data.csrf_token) {\n        throw new Error('Invalid CSRF token response');\n      }\n\n      this.csrfToken = result.data.csrf_token;\n      return this.csrfToken;\n    } catch (error) {\n      console.error('Error getting CSRF token:', error);\n      if (this.options.onError) {\n        this.options.onError(error);\n      }\n      return '';\n    }\n  }\n\n  /**\n   * สร้าง DOM elements\n   */\n  createDOMElements() {\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'file-browser-overlay';\n\n    this.modal = document.createElement('div');\n    this.modal.className = 'file-browser-modal';\n\n    const header = document.createElement('div');\n    header.className = 'file-browser-header';\n\n    const title = document.createElement('h3');\n    title.textContent = window.translate('Select the file');\n\n    const closeButton = document.createElement('button');\n    closeButton.type = 'button';\n    closeButton.className = 'file-browser-close';\n    closeButton.innerHTML = '&times;';\n    closeButton.title = window.translate('Close');\n    closeButton.addEventListener('click', this.close);\n\n    header.appendChild(title);\n    header.appendChild(closeButton);\n\n    const tabNav = document.createElement('div');\n    tabNav.className = 'file-browser-tabs';\n\n    if (this.options.showPresetTab) {\n      const presetTab = document.createElement('button');\n      presetTab.type = 'button';\n      presetTab.className = 'file-browser-tab active';\n      presetTab.textContent = window.translate(this.options.presetTabName);\n      presetTab.dataset.tab = 'preset';\n      presetTab.addEventListener('click', () => this.switchTab('preset'));\n      tabNav.appendChild(presetTab);\n    }\n\n    const browserTab = document.createElement('button');\n    browserTab.type = 'button';\n    browserTab.className = 'file-browser-tab';\n    browserTab.textContent = window.translate(this.options.browserTabName);\n    browserTab.dataset.tab = 'browser';\n    browserTab.addEventListener('click', () => this.switchTab('browser'));\n    tabNav.appendChild(browserTab);\n\n    this.content = document.createElement('div');\n    this.content.className = 'file-browser-content';\n\n    this.presetContent = document.createElement('div');\n    this.presetContent.className = 'file-browser-tab-content active';\n    this.presetContent.id = 'preset-content';\n\n    const categoriesSidebar = document.createElement('div');\n    categoriesSidebar.className = 'file-browser-categories';\n    this.presetContent.appendChild(categoriesSidebar);\n\n    const presetFilesContainer = document.createElement('div');\n    presetFilesContainer.className = 'file-browser-files-container';\n\n    const presetSearch = document.createElement('div');\n    presetSearch.className = 'file-browser-search';\n\n    const presetSearchInput = document.createElement('input');\n    presetSearchInput.type = 'text';\n    presetSearchInput.placeholder = window.translate('Search');\n    presetSearchInput.addEventListener('input', (e) => {\n      this.searchTerm = e.target.value.trim();\n      this.loadPresets();\n    });\n\n    const presetSearchIcon = document.createElement('span');\n    presetSearchIcon.className = 'search-icon icon-search';\n\n    presetSearch.appendChild(presetSearchInput);\n    presetSearch.appendChild(presetSearchIcon);\n\n    const presetToolbar = document.createElement('div');\n    presetToolbar.className = 'file-browser-toolbar';\n\n    presetToolbar.appendChild(presetSearch);\n\n    const presetViewOptions = document.createElement('div');\n    presetViewOptions.className = 'view-options';\n\n    const gridViewButton = document.createElement('button');\n    gridViewButton.type = 'button';\n    gridViewButton.className = 'view-option active';\n    gridViewButton.innerHTML = '<span class=\"icon-grid\"></span>';\n    gridViewButton.title = window.translate('Grid view');\n    gridViewButton.addEventListener('click', () => this.changeViewMode('grid'));\n\n    const listViewButton = document.createElement('button');\n    listViewButton.type = 'button';\n    listViewButton.className = 'view-option';\n    listViewButton.innerHTML = '<span class=\"icon-listview\"></span>';\n    listViewButton.title = window.translate('List view');\n    listViewButton.addEventListener('click', () => this.changeViewMode('list'));\n\n    presetViewOptions.appendChild(gridViewButton);\n    presetViewOptions.appendChild(listViewButton);\n\n    presetToolbar.appendChild(presetViewOptions);\n\n    const presetFiles = document.createElement('div');\n    presetFiles.className = 'file-browser-files grid-view';\n\n    presetFilesContainer.appendChild(presetToolbar);\n    presetFilesContainer.appendChild(presetFiles);\n\n    this.presetContent.appendChild(presetFilesContainer);\n\n    this.browserContent = document.createElement('div');\n    this.browserContent.className = 'file-browser-tab-content';\n    this.browserContent.id = 'browser-content';\n\n    const folderTreeContainer = document.createElement('div');\n    folderTreeContainer.className = 'file-browser-sidebar';\n\n    const folderTreeTitle = document.createElement('div');\n    folderTreeTitle.className = 'sidebar-title';\n    folderTreeTitle.textContent = window.translate('Folder');\n\n    this.folderTree = document.createElement('div');\n    this.folderTree.className = 'folder-tree';\n\n    folderTreeContainer.appendChild(folderTreeTitle);\n    folderTreeContainer.appendChild(this.folderTree);\n\n    this.browserContent.appendChild(folderTreeContainer);\n\n    const browserMainContent = document.createElement('div');\n    browserMainContent.className = 'file-browser-main-content';\n\n    const browserToolbar = document.createElement('div');\n    browserToolbar.className = 'file-browser-toolbar';\n\n    const breadcrumbsContainer = document.createElement('div');\n    breadcrumbsContainer.className = 'file-browser-breadcrumbs';\n\n    browserToolbar.appendChild(breadcrumbsContainer);\n\n    const actionsContainer = document.createElement('div');\n    actionsContainer.className = 'file-browser-actions';\n\n    const uploadButton = document.createElement('button');\n    uploadButton.type = 'button';\n    uploadButton.className = 'action-button';\n    uploadButton.innerHTML = `<span class=\"icon-upload\"></span> ${window.translate('Upload')}`;\n    uploadButton.addEventListener('click', () => {\n      const fileInput = document.createElement('input');\n      fileInput.type = 'file';\n      fileInput.multiple = true;\n      fileInput.accept = this.options.allowedFileTypes;\n      fileInput.style.display = 'none';\n      document.body.appendChild(fileInput);\n\n      fileInput.addEventListener('change', (e) => {\n        if (e.target.files.length > 0) {\n          this.uploadFiles(e.target.files);\n        }\n        document.body.removeChild(fileInput);\n      });\n\n      fileInput.click();\n    });\n\n    const newFolderButton = document.createElement('button');\n    newFolderButton.type = 'button';\n    newFolderButton.className = 'action-button';\n    newFolderButton.innerHTML = `<span class=\"icon-create-folder\"></span> ${window.translate('Create a folder')}`;\n    newFolderButton.addEventListener('click', this.createFolder);\n\n    actionsContainer.appendChild(uploadButton);\n    actionsContainer.appendChild(newFolderButton);\n\n    browserToolbar.appendChild(actionsContainer);\n\n    const searchAndViewContainer = document.createElement('div');\n    searchAndViewContainer.className = 'search-view-container';\n\n    const browserSearch = document.createElement('div');\n    browserSearch.className = 'file-browser-search';\n\n    const browserSearchInput = document.createElement('input');\n    browserSearchInput.type = 'text';\n    browserSearchInput.placeholder = window.translate('Search');\n    browserSearchInput.addEventListener('input', (e) => {\n      this.searchTerm = e.target.value.trim();\n      this.loadFiles();\n    });\n\n    const browserSearchIcon = document.createElement('span');\n    browserSearchIcon.className = 'search-icon icon-search';\n\n    browserSearch.appendChild(browserSearchInput);\n    browserSearch.appendChild(browserSearchIcon);\n\n    const browserViewOptions = document.createElement('div');\n    browserViewOptions.className = 'view-options';\n\n    const browserGridViewButton = document.createElement('button');\n    browserGridViewButton.type = 'button';\n    browserGridViewButton.className = 'view-option active';\n    browserGridViewButton.innerHTML = '<span class=\"icon-grid\"></span>';\n    browserGridViewButton.title = window.translate('Grid view');\n    browserGridViewButton.addEventListener('click', () => this.changeViewMode('grid'));\n\n    const browserListViewButton = document.createElement('button');\n    browserListViewButton.type = 'button';\n    browserListViewButton.className = 'view-option';\n    browserListViewButton.innerHTML = '<span class=\"icon-listview\"></span>';\n    browserListViewButton.title = window.translate('List view');\n    browserListViewButton.addEventListener('click', () => this.changeViewMode('list'));\n\n    browserViewOptions.appendChild(browserGridViewButton);\n    browserViewOptions.appendChild(browserListViewButton);\n\n    searchAndViewContainer.appendChild(browserSearch);\n    searchAndViewContainer.appendChild(browserViewOptions);\n\n    browserToolbar.appendChild(searchAndViewContainer);\n\n    const dropArea = document.createElement('div');\n    dropArea.className = 'file-browser-drop-area';\n    dropArea.innerHTML = `<div class=\"drop-message\"><span class=\"icon-upload\"></span><p>${window.translate('Drag the file here to upload.')}</p></div>`;\n    dropArea.addEventListener('dragover', this.handleDragOver);\n    dropArea.addEventListener('drop', this.handleDrop);\n    dropArea.addEventListener('dragleave', () => {\n      dropArea.classList.remove('drag-over');\n    });\n\n    this.fileList = document.createElement('div');\n    this.fileList.className = 'file-browser-files grid-view';\n\n    dropArea.appendChild(this.fileList);\n\n    browserMainContent.appendChild(browserToolbar);\n    browserMainContent.appendChild(dropArea);\n\n    this.browserContent.appendChild(browserMainContent);\n\n    const footer = document.createElement('div');\n    footer.className = 'file-browser-footer';\n\n    this.status = document.createElement('div');\n    this.status.className = 'file-browser-status';\n    this.status.textContent = window.translate('Ready to use');\n\n    const buttonsContainer = document.createElement('div');\n    buttonsContainer.className = 'file-browser-buttons';\n\n    const cancelButton = document.createElement('button');\n    cancelButton.type = 'button';\n    cancelButton.className = 'file-browser-button cancel border';\n    cancelButton.textContent = window.translate('Cancel');\n    cancelButton.addEventListener('click', this.close);\n\n    const selectButton = document.createElement('button');\n    selectButton.type = 'button';\n    selectButton.className = 'file-browser-button select';\n    selectButton.textContent = window.translate('Choose');\n    selectButton.addEventListener('click', this.confirmSelection);\n\n    buttonsContainer.appendChild(cancelButton);\n    buttonsContainer.appendChild(selectButton);\n\n    footer.appendChild(this.status);\n    footer.appendChild(buttonsContainer);\n\n    this.contextMenu = document.createElement('div');\n    this.contextMenu.className = 'file-browser-context-menu';\n    this.contextMenu.style.display = 'none';\n    document.body.appendChild(this.contextMenu);\n\n    this.content.appendChild(this.presetContent);\n    this.content.appendChild(this.browserContent);\n    if (this.options.showPresetTab) {\n      this.content.appendChild(this.presetContent);\n    }\n\n    this.modal.appendChild(header);\n    this.modal.appendChild(tabNav);\n    this.modal.appendChild(this.content);\n    this.modal.appendChild(footer);\n\n    this.overlay.appendChild(this.modal);\n  }\n\n  /**\n   * เพิ่ม event listeners\n   */\n  addEventListeners() {\n    document.addEventListener('keydown', this.handleEscapeKey);\n\n    document.addEventListener('click', this.hideContextMenu);\n  }\n\n  /**\n   * จัดการกับการกด ESC key\n   * @param {KeyboardEvent} e - เหตุการณ์ keydown\n   */\n  handleEscapeKey(e) {\n    if (e.key === 'Escape') {\n      if (this.contextMenu.style.display !== 'none') {\n        this.hideContextMenu();\n      } else {\n        this.close();\n      }\n    }\n  }\n\n  /**\n   * ขอ token จากเซิร์ฟเวอร์\n   * @returns {Promise<string>} - token\n   */\n  async getToken() {\n    if (!this.options.useToken) {\n      return null;\n    }\n\n    try {\n      const response = await fetch(this.options.tokenUrl, {\n        method: 'GET',\n        credentials: 'same-origin'\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to get token: ${response.status}`);\n      }\n\n      const data = await response.json();\n\n      if (!data.success || !data.token) {\n        throw new Error('Invalid token response');\n      }\n\n      this.token = data.token;\n\n      this.setupTokenRefresh();\n\n      return this.token;\n    } catch (error) {\n      console.error('Error getting token:', error);\n      if (this.options.onError) {\n        this.options.onError(error);\n      }\n      return null;\n    }\n  }\n\n  /**\n   * ตั้งเวลาสำหรับรีเฟรช token\n   */\n  setupTokenRefresh() {\n    if (this.tokenRefreshTimer) {\n      clearTimeout(this.tokenRefreshTimer);\n    }\n\n    this.tokenRefreshTimer = setTimeout(\n      this.refreshToken,\n      this.options.refreshTokenInterval\n    );\n  }\n\n  /**\n   * รีเฟรช token\n   */\n  async refreshToken() {\n    await this.getToken();\n  }\n\n  /**\n   * เปิด FileBrowser modal\n   */\n  open() {\n    try {\n      // Show modal directly (auth is handled by the PHP endpoint)\n      document.body.appendChild(this.overlay);\n\n      if (this.options.activeTab === 2) {\n        this.switchTab('browser');\n      } else {\n        this.switchTab('preset');\n      }\n\n      this.loadPresetCategories();\n\n      setTimeout(() => {\n        this.overlay.classList.add('active');\n        this.modal.classList.add('active');\n      }, 10);\n\n      this.selectedFiles = [];\n      this.updateStatus();\n    } catch (error) {\n      console.error('Error opening file browser:', error);\n      if (this.options.onError) {\n        this.options.onError(error);\n      }\n    }\n  }\n\n  /**\n   * ปิด FileBrowser modal\n   */\n  close() {\n    this.overlay.classList.remove('active');\n    this.modal.classList.remove('active');\n\n    setTimeout(() => {\n      if (this.overlay.parentNode) {\n        document.body.removeChild(this.overlay);\n      }\n    }, 300);\n\n    if (typeof this.options.onClose === 'function') {\n      this.options.onClose();\n    }\n  }\n\n  /**\n   * สลับ tab ระหว่าง preset และ browser\n   * @param {string} tabName - ชื่อ tab ('preset' หรือ 'browser')\n   */\n  switchTab(tabName) {\n    const tabs = this.modal.querySelectorAll('.file-browser-tab');\n    const tabContents = this.modal.querySelectorAll('.file-browser-tab-content');\n\n    tabs.forEach(tab => {\n      tab.classList.remove('active');\n      if (tab.dataset.tab === tabName) {\n        tab.classList.add('active');\n      }\n    });\n\n    tabContents.forEach(content => {\n      content.classList.remove('active');\n    });\n\n    if (tabName === 'preset') {\n      this.presetContent.classList.add('active');\n      this.loadPresets().catch(err => console.error('Error in loadPresets:', err));\n    } else {\n      this.browserContent.classList.add('active');\n      this.loadFiles().catch(err => console.error('Error in loadFiles:', err));\n      this.loadFolderTree().catch(err => console.error('Error in loadFolderTree:', err));\n    }\n  }\n\n  async loadPresetCategories() {\n    try {\n      this.updateStatus('Loading');\n\n      const endpoint = this.options.apiActions.getPresetCategories || '/file-browser/get_preset_categories';\n\n      const result = await this.makeApiRequest(endpoint, null, 'GET');\n\n      if (result.success && result.data.categories) {\n        this.renderPresetCategories(result.data.categories);\n      } else {\n        this.updateStatus('Unable to load the category');\n      }\n    } catch (error) {\n      console.error('Error loading preset categories:', error);\n      this.updateStatus('There is an error in loading categories.');\n    }\n  }\n\n  /**\n   * แสดงรายการหมวดหมู่\n   * @param {Array} categories - ข้อมูลหมวดหมู่\n   */\n  renderPresetCategories(categories) {\n    if (!this.presetContent) return;\n\n    const categoriesContainer = this.presetContent.querySelector('.file-browser-categories');\n    if (!categoriesContainer) return;\n\n    categoriesContainer.innerHTML = '';\n\n    const categoriesList = document.createElement('ul');\n\n    const allItem = document.createElement('li');\n    allItem.className = this.currentPresetCategory === null ? 'active' : '';\n    allItem.innerHTML = `<span class=\"icon-folder\"></span> ${window.translate('all')}`;\n    allItem.addEventListener('click', () => {\n      this.currentPresetCategory = null;\n      this.loadPresets();\n\n      categoriesList.querySelectorAll('li').forEach(item => {\n        item.classList.remove('active');\n      });\n      allItem.classList.add('active');\n    });\n\n    categoriesList.appendChild(allItem);\n\n    categories.forEach(category => {\n      const item = document.createElement('li');\n      item.className = this.currentPresetCategory === category.id ? 'active' : '';\n      item.innerHTML = `<span class=\"${category.icon || 'icon-folder'}\"></span> ${window.translate(category.name)}`;\n\n      if (category.description) {\n        item.title = category.description;\n      }\n\n      item.addEventListener('click', () => {\n        this.currentPresetCategory = category.id;\n        this.loadPresets();\n\n        categoriesList.querySelectorAll('li').forEach(item => {\n          item.classList.remove('active');\n        });\n        item.classList.add('active');\n      });\n\n      categoriesList.appendChild(item);\n    });\n\n    categoriesContainer.appendChild(categoriesList);\n  }\n\n  async loadPresets() {\n    const filesContainer = this.presetContent.querySelector('.file-browser-files');\n    filesContainer.innerHTML = '';\n\n    this.isLoading = true;\n    this.updateStatus('Loading');\n\n    const params = new URLSearchParams({\n      category: this.currentPresetCategory || 'all',\n      search: this.searchTerm,\n      sort_by: this.sortBy,\n      sort_dir: this.sortDir\n    });\n\n    try {\n      const endpoint = this.options.apiActions.getPresets || '/file-browser/get_presets';\n      const separator = endpoint.includes('?') ? '&' : '?';\n      const url = `${endpoint}${separator}${params.toString()}`;\n\n      const result = await this.makeApiRequest(url, null, 'GET');\n\n      if (result.success) {\n        this.displayFiles(filesContainer, result.data.files, 'preset');\n        this.updateStatus('{items} items.', {items: result.data.files.length});\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error loading presets:', error);\n      this.updateStatus('Unable to load data');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  async loadFiles() {\n    const filesContainer = this.browserContent.querySelector('.file-browser-files');\n    filesContainer.innerHTML = '';\n\n    this.isLoading = true;\n    this.updateStatus('Loading');\n\n    this.updateBreadcrumbs();\n\n    const params = new URLSearchParams({\n      path: this.currentPath,\n      search: this.searchTerm,\n      sort_by: this.sortBy,\n      sort_dir: this.sortDir\n    });\n\n    try {\n      const endpoint = this.options.apiActions.getFiles || '/file-browser/get_files';\n      const separator = endpoint.includes('?') ? '&' : '?';\n      const url = `${endpoint}${separator}${params.toString()}`;\n\n      const result = await this.makeApiRequest(url, null, 'GET');\n\n      if (result.success) {\n        this.displayFiles(filesContainer, result.data.files, 'browser');\n        this.updateStatus('{items} items.', {items: result.data.files.length});\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error loading files:', error);\n      this.updateStatus('Unable to load data');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  async loadFolderTree() {\n    this.folderTree.innerHTML = `<div class=\"loading\">${window.translate('Loading')}...</div>`;\n\n    try {\n      const endpoint = this.options.apiActions.getFolderTree || '/file-browser/get_folder_tree';\n\n      const result = await this.makeApiRequest(endpoint, null, 'GET');\n\n      if (result.success) {\n        this.displayFolderTree(result.data.folders);\n      } else {\n        this.folderTree.innerHTML = `<div class=\"error\">${window.translate(result.message)}</div>`;\n      }\n    } catch (error) {\n      console.error('Error loading folder tree:', error);\n      this.folderTree.innerHTML = `<div class=\"error\">${window.translate('Unable to download the list of folders')}</div>`;\n    }\n  }\n\n  /**\n   * แสดงรายการโฟลเดอร์แบบ tree\n   * @param {Array} folders - รายการโฟลเดอร์\n   * @param {HTMLElement} parent - องค์ประกอบ parent (ถ้ามี)\n   */\n  displayFolderTree(folders, parent = null) {\n    const ul = document.createElement('ul');\n    ul.className = 'folder-tree-list';\n\n    if (!parent) {\n      this.folderTree.innerHTML = '';\n      this.folderTree.appendChild(ul);\n\n      const rootItem = document.createElement('li');\n      rootItem.className = 'folder-tree-item' + (this.currentPath === '/' ? ' active' : '');\n\n      const rootLink = document.createElement('a');\n      rootLink.href = '#';\n      rootLink.className = 'folder-tree-link';\n      rootLink.innerHTML = `<span class=\"icon-folder\"></span> ${window.translate('Home')}`;\n      rootLink.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.navigateToFolder('/');\n      });\n\n      rootItem.appendChild(rootLink);\n      ul.appendChild(rootItem);\n\n      folders.forEach(folder => {\n        const item = this.createFolderTreeItem(folder);\n        ul.appendChild(item);\n      });\n    } else {\n      folders.forEach(folder => {\n        const item = this.createFolderTreeItem(folder);\n        ul.appendChild(item);\n      });\n\n      if (ul.children.length > 0) {\n        parent.appendChild(ul);\n      }\n    }\n  }\n\n  /**\n   * สร้าง folder tree item\n   * @param {Object} folder - ข้อมูลโฟลเดอร์\n   * @returns {HTMLElement} - องค์ประกอบ li\n   */\n  createFolderTreeItem(folder) {\n    const item = document.createElement('li');\n    item.className = 'folder-tree-item';\n\n    const isActive = this.currentPath === folder.path;\n    if (isActive) {\n      item.classList.add('active');\n    }\n\n    const link = document.createElement('a');\n    link.href = '#';\n    link.className = 'folder-tree-link';\n    link.dataset.path = folder.path;\n\n    const hasChildren = folder.children && folder.children.length > 0;\n    let expandIcon = '';\n\n    if (hasChildren) {\n      expandIcon = '<span class=\"expand-icon\"></span>';\n      item.classList.add('has-children');\n    }\n\n    link.innerHTML = `${expandIcon}<span class=\"icon-folder\"></span> ${folder.name}`;\n\n    link.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.navigateToFolder(folder.path);\n    });\n\n    if (hasChildren) {\n      link.querySelector('.expand-icon').addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (item.classList.contains('expanded')) {\n          item.classList.remove('expanded');\n          const subList = item.querySelector('ul');\n          if (subList) {\n            item.removeChild(subList);\n          }\n        } else {\n          item.classList.add('expanded');\n          this.displayFolderTree(folder.children, item);\n        }\n      });\n    }\n\n    item.appendChild(link);\n\n    link.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n\n      const menuItems = [\n        {label: 'เปิด', icon: 'icon-folder-open', action: () => this.navigateToFolder(folder.path)},\n        {label: 'สร้างโฟลเดอร์ใหม่', icon: 'icon-create-folder', action: () => this.createFolder(folder.path)},\n        {label: 'เปลี่ยนชื่อ', icon: 'icon-edit', action: () => this.renameFile(folder.path, 'folder')},\n        {label: 'ลบ', icon: 'icon-delete', action: () => this.deleteFile(folder.path, 'folder')}\n      ];\n\n      if (this.options.customContextMenuItems.length > 0) {\n        menuItems.push({type: 'separator'});\n        this.options.customContextMenuItems.forEach(customItem => {\n          menuItems.push(customItem);\n        });\n      }\n\n      this.showContextMenu(e, menuItems);\n    });\n\n    return item;\n  }\n\n  async createFolder(parentPathOrEvent = null) {\n    let path;\n\n    if (parentPathOrEvent && typeof parentPathOrEvent === 'object' && parentPathOrEvent.preventDefault) {\n      path = this.currentPath;\n    } else if (typeof parentPathOrEvent === 'string') {\n      path = parentPathOrEvent;\n    } else {\n      path = this.currentPath;\n    }\n\n    const folderName = prompt(window.translate('Please specify the name of the new folder.'));\n\n    if (!folderName) return;\n\n    if (!/^[a-zA-Z0-9_\\-]+$/.test(folderName)) {\n      alert(window.translate('The name of the folder is incorrect. Please use the numbers, numbers, numbers and signs only.'));\n      return;\n    }\n\n    this.isLoading = true;\n    this.updateStatus('Creating a folder');\n\n    const data = {\n      path: path,\n      name: folderName\n    };\n\n    try {\n      const endpoint = this.options.apiActions.createFolder || '/file-browser/create_folder';\n\n      const result = await this.makeApiRequest(endpoint, data);\n\n      if (result.success) {\n        this.updateStatus('Already created the folder');\n\n        this.loadFiles();\n        this.loadFolderTree();\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error creating folder:', error);\n      this.updateStatus('Unable to create a folder');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /**\n   * แสดงรายการไฟล์\n   * @param {HTMLElement} container - องค์ประกอบสำหรับแสดงไฟล์\n   * @param {Array} files - รายการไฟล์\n   * @param {string} mode - โหมดการแสดง ('preset' หรือ 'browser')\n   */\n  displayFiles(container, files, mode) {\n    container.innerHTML = '';\n\n    if (files.length === 0) {\n      const emptyMessage = document.createElement('div');\n      emptyMessage.className = 'empty-message';\n      emptyMessage.textContent = window.translate('Not found files');\n      container.appendChild(emptyMessage);\n      return;\n    }\n\n    files.sort((a, b) => {\n      if (a.type === 'folder' && b.type !== 'folder') return -1;\n      if (a.type !== 'folder' && b.type === 'folder') return 1;\n\n      const valueA = a[this.sortBy];\n      const valueB = b[this.sortBy];\n\n      if (this.sortDir === 'asc') {\n        return valueA > valueB ? 1 : -1;\n      } else {\n        return valueA < valueB ? 1 : -1;\n      }\n    });\n\n    files.forEach(file => {\n      const fileItem = this.createFileItem(file, mode);\n      container.appendChild(fileItem);\n    });\n  }\n\n  /**\n   * สร้างองค์ประกอบแสดงไฟล์\n   * @param {Object} file - ข้อมูลไฟล์\n   * @param {string} mode - โหมดการแสดง ('preset' หรือ 'browser')\n   * @returns {HTMLElement} - องค์ประกอบแสดงไฟล์\n   */\n  createFileItem(file, mode) {\n    const item = document.createElement('div');\n    item.className = 'file-item';\n    item.dataset.path = file.path;\n    item.dataset.type = file.type;\n    item.dataset.mode = mode;\n\n    const isSelected = this.selectedFiles.some(selectedFile =>\n      selectedFile.path === file.path && selectedFile.mode === mode);\n\n    if (isSelected) {\n      item.classList.add('selected');\n    }\n\n    const thumbnail = document.createElement('div');\n    thumbnail.className = 'file-thumbnail';\n\n    // Check if it's an image using mimeType, type, extension or thumbnail\n    const isImage = file.thumbnail ||\n      (file.mimeType && file.mimeType.startsWith('image/')) ||\n      (file.type && file.type.startsWith('image/')) ||\n      this.isImageExtension(file.extension);\n\n    if (file.type === 'folder') {\n      thumbnail.innerHTML = '<span class=\"icon-folder\"></span>';\n    } else if (isImage) {\n      // Use thumbnail URL or file URL for images\n      const imgUrl = file.thumbnail || file.url;\n      thumbnail.innerHTML = `<span style=\"background-image:url(${imgUrl})\"></span>`;\n    } else {\n      const ext = file.extension ? file.extension.toLowerCase().replace('.', '') : 'default';\n      const iconClass = this.fileIcons[ext] || this.fileIcons['default'];\n      thumbnail.innerHTML = `<span class=\"${iconClass}\"></span>`;\n    }\n\n    const info = document.createElement('div');\n    info.className = 'file-info';\n\n    const name = document.createElement('div');\n    name.className = 'file-name';\n    name.textContent = file.name;\n    name.title = file.name;\n\n    info.appendChild(name);\n\n    if (this.viewMode === 'list') {\n      const details = document.createElement('div');\n      details.className = 'file-details';\n\n      if (file.type !== 'folder') {\n        const size = document.createElement('span');\n        size.className = 'file-size';\n        size.textContent = this.formatFileSize(file.size);\n        details.appendChild(size);\n      }\n\n      const date = document.createElement('span');\n      date.className = 'file-date';\n      date.textContent = this.formatDate(file.modified);\n      details.appendChild(date);\n\n      info.appendChild(details);\n    }\n\n    item.appendChild(thumbnail);\n    item.appendChild(info);\n\n    item.addEventListener('click', (e) => {\n      if (file.type === 'folder' && mode === 'browser') {\n        this.navigateToFolder(file.path);\n        return;\n      }\n\n      this.selectFile(file, mode, e.ctrlKey || e.metaKey);\n    });\n\n    item.addEventListener('dblclick', () => {\n      if (file.type === 'folder' && mode === 'browser') {\n        this.navigateToFolder(file.path);\n        return;\n      }\n\n      this.selectedFiles = [{...file, mode}];\n      this.confirmSelection();\n    });\n\n    item.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n\n      if (!isSelected) {\n        this.selectFile(file, mode, false);\n      }\n\n      const menuItems = [];\n\n      if (file.type === 'folder' && mode === 'browser') {\n        menuItems.push(\n          {label: 'Open', icon: 'icon-folder-open', action: () => this.navigateToFolder(file.path)},\n          {label: 'Create a new folder', icon: 'icon-create-folder', action: () => this.createFolder(file.path)}\n        );\n      } else {\n        menuItems.push(\n          {label: 'Choose', icon: 'icon-valid', action: () => this.confirmSelection()}\n        );\n      }\n\n      if (mode === 'browser') {\n        menuItems.push(\n          {label: 'Rename', icon: 'icon-edit', action: () => this.renameFile(file.path, file.type)},\n          {label: 'Delete', icon: 'icon-delete', action: () => this.deleteFile(file.path, file.type)}\n        );\n\n        if (this.clipboardFile) {\n          menuItems.push(\n            {type: 'separator'},\n            {label: 'Paste', icon: 'icon-paste', action: () => this.pasteFromClipboard(file.path)}\n          );\n        }\n      }\n\n      if (this.options.customContextMenuItems.length > 0) {\n        menuItems.push({type: 'separator'});\n        this.options.customContextMenuItems.forEach(customItem => {\n          menuItems.push(customItem);\n        });\n      }\n\n      this.showContextMenu(e, menuItems);\n    });\n\n    return item;\n  }\n\n  /**\n   * เลือกไฟล์\n   * @param {Object} file - ข้อมูลไฟล์\n   * @param {string} mode - โหมดการแสดง ('preset' หรือ 'browser')\n   * @param {boolean} multiSelect - เป็นการเลือกหลายไฟล์หรือไม่\n   */\n  selectFile(file, mode, multiSelect = false) {\n    if (multiSelect && !this.options.multiSelect) {\n      multiSelect = false;\n    }\n\n    const fileWithMode = {...file, mode};\n\n    if (multiSelect) {\n      const index = this.selectedFiles.findIndex(selectedFile =>\n        selectedFile.path === file.path && selectedFile.mode === mode);\n\n      if (index !== -1) {\n        this.selectedFiles.splice(index, 1);\n      } else {\n        this.selectedFiles.push(fileWithMode);\n      }\n    } else {\n      this.selectedFiles = [fileWithMode];\n    }\n\n    this.updateFileSelection();\n    this.updateStatus();\n  }\n\n  /**\n   * อัปเดทการแสดงผลไฟล์ที่เลือก\n   */\n  updateFileSelection() {\n    const allFileItems = this.modal.querySelectorAll('.file-item');\n    allFileItems.forEach(item => item.classList.remove('selected'));\n\n    this.selectedFiles.forEach(file => {\n      const selector = `.file-item[data-path=\"${file.path}\"][data-mode=\"${file.mode}\"]`;\n      const fileItem = this.modal.querySelector(selector);\n      if (fileItem) {\n        fileItem.classList.add('selected');\n      }\n    });\n  }\n\n  /**\n   * อัปเดท breadcrumbs\n   */\n  updateBreadcrumbs() {\n    const breadcrumbsContainer = this.browserContent.querySelector('.file-browser-breadcrumbs');\n    if (!breadcrumbsContainer) return;\n\n    breadcrumbsContainer.innerHTML = '';\n\n    const paths = this.currentPath.split('/').filter(p => p);\n    let currentPath = '/';\n\n    const homeItem = document.createElement('a');\n    homeItem.href = '#';\n    homeItem.className = 'breadcrumb-item';\n    homeItem.innerHTML = '<span class=\"icon-home\"></span>';\n    homeItem.title = window.translate('Home');\n    homeItem.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.navigateToFolder('/');\n    });\n\n    breadcrumbsContainer.appendChild(homeItem);\n\n    const separator = document.createElement('span');\n    separator.className = 'breadcrumb-separator';\n    separator.textContent = '/';\n    breadcrumbsContainer.appendChild(separator.cloneNode(true));\n\n    paths.forEach((path, index) => {\n      currentPath += path + '/';\n\n      const item = document.createElement('a');\n      item.href = '#';\n      item.className = 'breadcrumb-item';\n      item.textContent = path;\n      item.dataset.path = currentPath;\n      item.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.navigateToFolder(currentPath);\n      });\n\n      breadcrumbsContainer.appendChild(item);\n\n      if (index < paths.length - 1) {\n        breadcrumbsContainer.appendChild(separator.cloneNode(true));\n      }\n    });\n  }\n\n  /**\n   * นำทางไปยังโฟลเดอร์\n   * @param {string} path - path ของโฟลเดอร์\n   */\n  navigateToFolder(path) {\n    this.currentPath = path;\n    this.loadFiles();\n\n    const folderItems = this.folderTree.querySelectorAll('.folder-tree-item');\n    folderItems.forEach(item => {\n      item.classList.remove('active');\n      const link = item.querySelector('.folder-tree-link');\n      if (link && link.dataset.path === path) {\n        item.classList.add('active');\n      }\n    });\n  }\n\n  /**\n   * อัปโหลดไฟล์\n   * @param {FileList} files - รายการไฟล์ที่จะอัปโหลด\n   */\n  async uploadFiles(files) {\n    if (files.length === 0) return;\n\n    this.isLoading = true;\n    this.updateStatus('Uploading 0/{length}', {length: files.length});\n\n    try {\n      const result = await this.uploadFilesWithApi(files, this.currentPath);\n\n      if (result.success) {\n        this.updateStatus(`Uploading {uploaded}/{total} files`, {\n          uploaded: result.uploaded,\n          total: result.total\n        });\n\n        if (window.Editor && window.Editor.showNotification) {\n          window.Editor.showNotification('The upload is finished.', 'success');\n        }\n\n        setTimeout(() => {\n          this.loadFiles();\n        }, 1000);\n      } else {\n        this.updateStatus('Unable to upload files');\n\n        if (window.Editor && window.Editor.showNotification) {\n          window.Editor.showNotification('Unable to upload files', 'error');\n        }\n      }\n    } catch (error) {\n      console.error('Error uploading files:', error);\n      this.updateStatus('Unable to upload files');\n\n      if (window.Editor && window.Editor.showNotification) {\n        window.Editor.showNotification('Unable to upload files', 'error');\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /**\n   * บันทึกปัญหาความปลอดภัย\n   * @param {string} message - ข้อความแจ้งเตือน\n   */\n  logSecurityIssue(message) {\n    console.warn('Security Issue:', message);\n  }\n\n  /**\n   * ตรวจสอบประเภทไฟล์\n   * @param {File} file - ไฟล์ที่ต้องการตรวจสอบ\n   * @returns {boolean} - ผลการตรวจสอบ\n   */\n  isAllowedFileType(file) {\n    const allowedTypes = this.options.allowedFileTypes.split(',');\n    const fileName = file.name.toLowerCase();\n    const fileType = file.type;\n\n    let isAllowed = false;\n\n    for (const type of allowedTypes) {\n      const cleanType = type.trim();\n\n      if (cleanType === '*') {\n        isAllowed = true;\n        break;\n      }\n\n      if (cleanType === fileType) {\n        isAllowed = true;\n        break;\n      }\n\n      if (cleanType.startsWith('.')) {\n        const ext = '.' + fileName.split('.').pop();\n        if (ext === cleanType.toLowerCase()) {\n          isAllowed = true;\n          break;\n        }\n      }\n\n      if (cleanType.endsWith('/*')) {\n        const category = cleanType.replace('/*', '');\n        if (fileType.startsWith(category + '/')) {\n          isAllowed = true;\n          break;\n        }\n      }\n    }\n\n    return isAllowed;\n  }\n\n  /**\n   * ทำความสะอาดชื่อไฟล์สำหรับการแสดงผล\n   * @param {string} filename - ชื่อไฟล์\n   * @returns {string} - ชื่อไฟล์ที่ทำความสะอาดแล้ว\n   */\n  sanitizeFileName(filename) {\n    if (filename.length > 30) {\n      return filename.substring(0, 15) + '...' + filename.substring(filename.length - 10);\n    }\n    return filename;\n  }\n\n  async renameFile(path, type) {\n    const name = path.split('/').pop();\n    const newName = prompt(window.translate('Please specify a new name for {type}', {type: type === 'folder' ? 'folder' : 'file'}), name);\n\n    if (!newName || newName === name) return;\n\n    if (!/^[a-zA-Z0-9_\\-\\.]+$/.test(newName)) {\n      alert(window.translate('Incorrect name Please use the numbers, numbers, numbers and signs only.'));\n      return;\n    }\n\n    this.isLoading = true;\n    this.updateStatus('Renaming');\n\n    const data = {\n      path: path,\n      new_name: newName\n    };\n\n    try {\n      const endpoint = this.options.apiActions.rename || '/file-browser/rename';\n\n      const result = await this.makeApiRequest(endpoint, data, 'POST');\n\n      if (result.success) {\n        this.updateStatus('The name has been changed.');\n\n        this.loadFiles();\n        if (type === 'folder') {\n          this.loadFolderTree();\n        }\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error renaming:', error);\n      this.updateStatus('Unable to change the name');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  async deleteFile(path, type) {\n    const name = path.split('/').pop();\n    const isFolder = type === 'folder';\n\n    let message = window.translate('Want to delete {type} \"{name}\" or not?', {\n      type: isFolder ? 'folder' : 'file',\n      name\n    });\n    if (isFolder) {\n      message += `\\n\\n${window.translate('Warning: Deleting the folder will delete all files in the folder as well.')}`;\n    }\n\n    if (!confirm(message)) {\n      return;\n    }\n\n    this.isLoading = true;\n    this.updateStatus('Delete');\n\n    const data = {\n      path: path\n    };\n\n    try {\n      const endpoint = this.options.apiActions.delete || '/file-browser/delete';\n\n      const result = await this.makeApiRequest(endpoint, data, 'POST');\n\n      if (result.success) {\n        this.updateStatus('Already deleted');\n\n        this.loadFiles();\n        if (isFolder) {\n          this.loadFolderTree();\n        }\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error deleting:', error);\n      this.updateStatus('Unable to delete');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /**\n   * วางไฟล์หรือโฟลเดอร์จาก clipboard\n   * @param {string} destination - path ปลายทาง\n   */\n  async pasteFromClipboard(destination = null) {\n    if (!this.clipboardFile) return;\n\n    const dest = destination || this.currentPath;\n\n    this.isLoading = true;\n    this.updateStatus('Operating');\n\n    const data = {\n      action: this.clipboardAction === 'cut' ? 'move' : 'copy',\n      source: this.clipboardFile.path,\n      destination: dest\n    };\n\n    try {\n      const result = await this.makeApiRequest('/file-browser', data);\n\n      if (result.success) {\n        this.updateStatus(this.clipboardAction === 'cut' ? 'Already moved' : 'Already copied');\n\n        if (this.clipboardAction === 'cut') {\n          this.clipboardFile = null;\n          this.clipboardAction = null;\n        }\n\n        this.loadFiles();\n        this.loadFolderTree();\n      } else {\n        this.updateStatus('Error: {message}', {message: result.message});\n      }\n    } catch (error) {\n      console.error('Error pasting:', error);\n      this.updateStatus('Cannot be placed');\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /**\n   * แสดง context menu\n   * @param {MouseEvent} event - เหตุการณ์ mousedown\n   * @param {Array} items - รายการเมนู\n   */\n  showContextMenu(event, items) {\n    this.contextMenu.innerHTML = '';\n\n    items.forEach(item => {\n      if (item.type === 'separator') {\n        const separator = document.createElement('div');\n        separator.className = 'context-menu-separator';\n        this.contextMenu.appendChild(separator);\n        return;\n      }\n\n      const menuItem = document.createElement('div');\n      menuItem.className = 'context-menu-item';\n\n      if (item.icon) {\n        const icon = document.createElement('span');\n        icon.className = item.icon;\n        menuItem.appendChild(icon);\n      }\n\n      const label = document.createElement('span');\n      label.className = 'context-menu-label';\n      label.textContent = window.translate(item.label);\n      menuItem.appendChild(label);\n\n      if (item.disabled) {\n        menuItem.classList.add('disabled');\n      } else {\n        menuItem.addEventListener('click', () => {\n          this.hideContextMenu();\n          if (typeof item.action === 'function') {\n            item.action();\n          }\n        });\n      }\n\n      this.contextMenu.appendChild(menuItem);\n    });\n\n    this.contextMenu.style.display = 'block';\n    this.contextMenu.style.left = `${event.pageX}px`;\n    this.contextMenu.style.top = `${event.pageY}px`;\n\n    const menuRect = this.contextMenu.getBoundingClientRect();\n    const windowWidth = window.innerWidth;\n    const windowHeight = window.innerHeight;\n\n    if (menuRect.right > windowWidth) {\n      this.contextMenu.style.left = `${windowWidth - menuRect.width - 5}px`;\n    }\n\n    if (menuRect.bottom > windowHeight) {\n      this.contextMenu.style.top = `${event.pageY - menuRect.height}px`;\n    }\n  }\n\n  /**\n   * ซ่อน context menu\n   */\n  hideContextMenu() {\n    this.contextMenu.style.display = 'none';\n  }\n\n  /**\n   * เปลี่ยนโหมดการแสดงผล\n   * @param {string} mode - โหมดการแสดงผล ('grid' หรือ 'list')\n   */\n  changeViewMode(mode) {\n    this.viewMode = mode;\n\n    const gridButtons = this.modal.querySelectorAll('.view-option:first-child');\n    const listButtons = this.modal.querySelectorAll('.view-option:last-child');\n\n    gridButtons.forEach(button => {\n      button.classList.toggle('active', mode === 'grid');\n    });\n\n    listButtons.forEach(button => {\n      button.classList.toggle('active', mode === 'list');\n    });\n\n    const fileContainers = this.modal.querySelectorAll('.file-browser-files');\n    fileContainers.forEach(container => {\n      container.className = `file-browser-files ${mode}-view`;\n    });\n\n    if (this.presetContent.classList.contains('active')) {\n      this.loadPresets();\n    } else {\n      this.loadFiles();\n    }\n  }\n\n  /**\n   * ค้นหาไฟล์\n   * @param {string} term - คำค้นหา\n   */\n  search(term) {\n    this.searchTerm = term;\n\n    if (this.presetContent.classList.contains('active')) {\n      this.loadPresets();\n    } else {\n      this.loadFiles();\n    }\n  }\n\n  /**\n   * เรียงลำดับไฟล์\n   * @param {string} by - เรียงตามอะไร ('name', 'size', 'modified')\n   * @param {string} direction - ทิศทาง ('asc', 'desc')\n   */\n  sort(by, direction = null) {\n    if (!direction) {\n      direction = by === this.sortBy && this.sortDir === 'asc' ? 'desc' : 'asc';\n    }\n\n    this.sortBy = by;\n    this.sortDir = direction;\n\n    if (this.presetContent.classList.contains('active')) {\n      this.loadPresets();\n    } else {\n      this.loadFiles();\n    }\n  }\n\n  /**\n   * อัปเดทสถานะ\n   * @param {string} message - ข้อความสถานะ\n   */\n  updateStatus(message = null, params) {\n    if (message) {\n      this.status.textContent = window.translate(message, params);\n    } else {\n      if (this.selectedFiles.length > 0) {\n        this.status.textContent = window.translate(`Select {items}`, {items: this.selectedFiles.length});\n      } else {\n        this.status.textContent = window.translate('Ready to use');\n      }\n    }\n  }\n\n  /**\n   * ยืนยันการเลือกไฟล์\n   */\n  confirmSelection() {\n    if (this.selectedFiles.length === 0) {\n      alert(window.translate('Please select the file.'));\n      return;\n    }\n\n    if (typeof this.options.onSelect === 'function') {\n      const files = this.selectedFiles.map(file => ({\n        name: file.name,\n        path: file.path,\n        url: file.url,\n        type: file.type,\n        size: file.size,\n        extension: file.extension,\n        thumbnail: file.thumbnail\n      }));\n\n      this.options.onSelect(this.options.multiSelect ? files : files[0]);\n    }\n\n    this.close();\n  }\n\n  /**\n   * จัดการ dragover event\n   * @param {DragEvent} e - เหตุการณ์ dragover\n   */\n  handleDragOver(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.dataTransfer.dropEffect = 'copy';\n\n    const dropArea = e.currentTarget;\n    dropArea.classList.add('drag-over');\n  }\n\n  /**\n   * จัดการ drop event\n   * @param {DragEvent} e - เหตุการณ์ drop\n   */\n  handleDrop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const dropArea = e.currentTarget;\n    dropArea.classList.remove('drag-over');\n\n    if (e.dataTransfer.files.length > 0) {\n      this.uploadFiles(e.dataTransfer.files);\n    }\n  }\n\n  /**\n   * จัดรูปแบบขนาดไฟล์\n   * @param {number} bytes - ขนาดไฟล์ในไบต์\n   * @returns {string} - ขนาดไฟล์ที่จัดรูปแบบแล้ว\n   */\n  formatFileSize(bytes) {\n    if (bytes === 0) return '0 B';\n\n    const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n\n    return parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + ' ' + units[i];\n  }\n\n  /**\n   * จัดรูปแบบวันที่\n   * @param {string|number} date - วันที่\n   * @returns {string} - วันที่ที่จัดรูปแบบแล้ว\n   */\n  formatDate(date) {\n    if (!date) return '';\n\n    const d = new Date(date);\n\n    return `${d.getDate().toString().padStart(2, '0')}/${(d.getMonth() + 1).toString().padStart(2, '0')}/${d.getFullYear()} ${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;\n  }\n\n  /**\n   * ทำความสะอาดเมื่อเลิกใช้งาน\n   */\n  destroy() {\n    if (this.tokenRefreshTimer) {\n      clearTimeout(this.tokenRefreshTimer);\n    }\n\n    document.removeEventListener('keydown', this.handleEscapeKey);\n    document.removeEventListener('click', this.hideContextMenu);\n\n    if (this.contextMenu && this.contextMenu.parentNode) {\n      this.contextMenu.parentNode.removeChild(this.contextMenu);\n    }\n\n    if (this.overlay && this.overlay.parentNode) {\n      this.overlay.parentNode.removeChild(this.overlay);\n    }\n  }\n}\nexport default FileBrowser;\n","/**\n * RichTextEditor - Vite Entry Point for Bundle\n * This file is the entry point for building the bundled version\n *\n * @author Goragod Wiriya\n * @version 1.0\n */\n\n// Import CSS\nimport './RichTextEditor.css';\nimport './plugins/filebrowser/filebrowser.css';\n\n// Import main module\nimport RichTextEditor, {\n  EventBus,\n  CommandManager,\n  HistoryManager,\n  SelectionManager,\n  KeyboardManager,\n  profiles,\n  defaults,\n  mergeOptions\n} from './index.js';\n\n// Import FileBrowser\nimport FileBrowser from './plugins/filebrowser/FileBrowser.js';\n\n// Expose to window for IIFE build\nif (typeof window !== 'undefined') {\n  window.RichTextEditor = RichTextEditor;\n  window.FileBrowser = FileBrowser;\n\n  // Also expose utilities on RichTextEditor\n  window.RichTextEditor.EventBus = EventBus;\n  window.RichTextEditor.CommandManager = CommandManager;\n  window.RichTextEditor.HistoryManager = HistoryManager;\n  window.RichTextEditor.SelectionManager = SelectionManager;\n  window.RichTextEditor.KeyboardManager = KeyboardManager;\n  window.RichTextEditor.profiles = profiles;\n  window.RichTextEditor.defaults = defaults;\n  window.RichTextEditor.mergeOptions = mergeOptions;\n  window.RichTextEditor.FileBrowser = FileBrowser;\n}\n\n// Only default export for IIFE build compatibility\nexport default RichTextEditor;\n"],"names":["EventBus","constructor","this","listeners","Map","onceListeners","on","event","callback","context","Error","has","set","listener","get","push","off","once","index","findIndex","l","splice","emit","args","forEach","apply","error","console","length","listenersToCall","removeAllListeners","delete","clear","listenerCount","_a","_b","hasListeners","destroy","Events","EDITOR_INIT","EDITOR_READY","EDITOR_DESTROY","EDITOR_FOCUS","EDITOR_BLUR","CONTENT_CHANGE","CONTENT_BEFORE_CHANGE","CONTENT_PASTE","CONTENT_SET","COMMAND_EXECUTE","COMMAND_BEFORE_EXECUTE","COMMAND_UNDO","COMMAND_REDO","SELECTION_CHANGE","TOOLBAR_UPDATE","TOOLBAR_BUTTON_CLICK","PLUGIN_LOAD","PLUGIN_UNLOAD","DIALOG_OPEN","DIALOG_CLOSE","MODE_CHANGE","HISTORY_CHANGE","HISTORY_SNAPSHOT","AUTOSAVE_START","AUTOSAVE_SUCCESS","AUTOSAVE_ERROR","CommandManager","editor","commands","registerBuiltInCommands","register","execute","execNative","isActive","document","queryCommandState","shortcut","level","formatBlock","isBlockType","url","html","selection","insertHtml","text","insertText","color","getValue","queryCommandValue","selectAll","history","undo","canExecute","canUndo","redo","canRedo","name","command","unregister","warn","events","contentArea","hasFocus","_c","focus","_d","saveSelection","_e","record","_f","_g","value","execCommand","e","tagName","normalized","toLowerCase","block","getParentBlock","getShortcut","getCommandNames","Array","from","keys","hasCommand","getFormattingState","bold","italic","underline","strikethrough","orderedList","unorderedList","justifyLeft","justifyCenter","justifyRight","justifyFull","foreColor","backColor","HistoryManager","options","maxHistory","debounceDelay","undoStack","redoStack","currentState","debounceTimer","isRecording","batchLevel","batchState","init","content","getContent","createSnapshot","timestamp","Date","now","force","clearTimeout","recordImmediate","setTimeout","shift","startBatch","endBatch","batch","fn","currentContent","pop","setContent","savedSelection","restoreSelection","pause","resume","getInfo","undoCount","redoCount","SelectionManager","getSelection","window","getRange","rangeCount","getRangeAt","isWithinEditor","range","container","getElement","contains","commonAncestorContainer","hasSelection","collapsed","getSelectedText","toString","getSelectedHtml","fragment","cloneContents","div","createElement","appendChild","innerHTML","startContainer","startOffset","endContainer","endOffset","createRange","setStart","setEnd","removeAllRanges","addRange","clearSavedSelection","selectNodeContents","collapseToStart","collapseToEnd","setCursorAtEnd","element","collapse","setCursorAtStart","lastChild","setStartAfter","deleteContents","createContextualFragment","lastNode","insertNode","newRange","textNode","createTextNode","wrapSelection","attributes","wrapper","Object","entries","key","setAttribute","surroundContents","extractContents","unwrapSelection","target","nodeType","Node","ELEMENT_NODE","parentElement","closest","parent","parentNode","firstChild","insertBefore","removeChild","blockTags","node","TEXT_NODE","includes","getAncestor","selector","ancestor","containsElement","isStyleApplied","KeyboardManager","shortcuts","enabled","handleKeyDown","bind","registerDefaultShortcuts","attachListeners","id","preventDefault","addEventListener","detachListeners","removeEventListener","normalizeShortcut","handler","parts","ctrlKey","metaKey","shiftKey","altKey","keyMap","control","alt","meta","arrowup","arrowdown","arrowleft","arrowright","enter","escape","backspace","tab","hasOwnProperty","join","parseShortcut","split","map","p","trim","modifiers","part","sort","hasShortcut","getHandler","getAllShortcuts","formatForDisplay","isMac","navigator","platform","toUpperCase","indexOf","formatted","enable","disable","isEnabled","Toolbar","items","defaultItems","sticky","buttons","dropdowns","activeDropdown","handleButtonClick","handleButtonMousedown","handleDocumentClick","updateButtonStates","create","className","classList","add","buildItems","isArray","group","groupIndex","groupElement","item","separator","buttonDef","buttonDefinitions","buttonEl","createButton","def","type","createDropdownButton","button","dataset","translate","title","getButtonTooltip","icon","textContent","call","definition","arrow","menu","menuItem","label","tag","style","margin","fontSize","stopPropagation","handleDropdownItemClick","colorPicker","picker","createColorPicker","toggleDropdown","colors","defaultColors","grid","colorBtn","backgroundColor","handleColorSelect","customRow","customInput","customLabel","allowClear","clearBtn","tooltip","keyboard","closeAllDropdowns","isOpen","remove","dropdown","toggle","disabled","setItems","enableButton","btn","disableButton","showButton","display","hideButton","heading","bulletList","numberedList","alignLeft","alignCenter","alignRight","alignJustify","indent","outdent","link","image","video","table","horizontalRule","blockquote","codeBlock","textColor","specialChars","emoji","removeFormat","sourceView","fullscreen","findReplace","ContentArea","minHeight","maxHeight","autoResize","placeholder","readOnly","focused","handleInput","handleFocus","handleBlur","handlePaste","handleDrop","handleDragOver","contentEditable","overflowY","defaultPrevented","clipboardData","getData","cleanedHtml","cleanPastedHtml","temp","querySelectorAll","el","hasAttribute","cleanedStyle","getAttribute","filter","s","startsWith","removeAttribute","c","iterator","createNodeIterator","NodeFilter","SHOW_COMMENT","comment","nextNode","span","font","files","dataTransfer","dropEffect","isEmpty","getContainer","recordHistory","blur","setReadOnly","isReadOnly","setPlaceholder","getTextContent","getWordCount","word","getCharacterCount","excludeSpaces","replace","RichTextEditor","targetElement","querySelector","height","toolbar","stickyToolbar","plugins","autofocus","sanitize","initialized","isSourceMode","isFullscreen","buildUI","loadPlugins","requestAnimationFrame","plugin","onReady","footer","nextSibling","existingContent","pluginConfig","PluginClass","pluginOptions","registeredPlugins","loadPlugin","pluginName","requires","dep","unloadPlugin","getPlugin","sourceEditor","sanitizeHtml","attr","toggleSourceView","mode","toggleFullscreen","body","showNotification","message","duration","notification","getContentElement","_h","_i","_j","registerPlugin","unregisterPlugin","getRegisteredPlugins","PluginBase","eventSubscriptions","getName","subscribe","boundCallback","registerCommand","registerShortcut","params","notify","getToolbarButton","setButtonActive","active","focusEditor","__publicField","BaseDialog","width","closable","closeOnOverlay","closeOnEscape","overlay","dialog","handleOverlayClick","header","closeBtn","close","buildBody","buildFooter","cancelBtn","confirmBtn","handleConfirm","createField","config","field","input","rows","opt","option","checkWrapper","checkLabel","required","pattern","checked","help","getInputFromField","open","data","populate","focusFirst","validate","onConfirm","firstInput","select","showError","clearError","f","setLoading","loading","LinkDialog","super","urlField","textField","titleField","newTabField","removeBtn","marginRight","onRemove","urlInput","textInput","titleInput","newTabInput","newTab","isEdit","existingLink","match","LinkPlugin","insertLink","removeLink","isInLink","openDialog","href","rel","escapeHtml","newLink","str","ImageDialog","tabs","urlTab","uploadTab","urlContent","uploadContent","uploadZone","fileInput","click","handleFileSelect","previewArea","fileBrowser","browseBtn","marginTop","openFileBrowser","commonFields","paddingTop","borderTop","altField","sizeRow","gap","widthField","flex","heightField","alignField","t","tabName","addTabStyles","getElementById","head","file","selectedFile","reader","FileReader","onload","result","previewDataUrl","readAsDataURL","FileBrowser","allowedFileTypes","multiSelect","onSelect","altInput","widthInput","heightInput","alignSelect","src","align","existingImage","ImagePlugin","insertImage","imageFiles","handleDroppedFiles","img","getSelectedImage","getImageAlignment","float","marginLeft","uploadUrl","uploadImage","parseInt","applyImageAlignment","outerHTML","formData","FormData","append","uploadPath","response","fetch","method","credentials","ok","json","async","TableDialog","rowsField","rowsInput","min","max","colsField","colsInput","headerField","borderField","headerInput","borderInput","cols","hasHeader","hasBorder","TablePlugin","insertTable","setupContextMenu","addRow","addColumn","deleteRow","deleteColumn","deleteTable","contentEl","cell","showTableContextMenu","hideContextMenu","cssText","clientX","clientY","action","danger","sep","background","contextMenu","currentCell","closeHandler","r","isHeader","getTableContext","row","colIndex","cells","rowIndex","position","ctx","colCount","newRow","insertRow","i","insertCell","insertIndex","th","replaceChild","deleteCell","VideoDialog","responsiveField","updatePreview","embedUrl","getEmbedUrl","responsiveInput","responsive","VideoPlugin","insertVideo","_EmojiPlugin","createPicker","rect","getBoundingClientRect","top","bottom","left","searchInput","filterEmojis","categories","cat","showCategory","emojiGrid","categoryIndex","category","currentEmojis","emojis","renderEmojis","term","lowerTerm","filtered","char","transform","insertEmoji","EmojiPlugin","SpecialCharsDialog","SpecialCharsPlugin","charGrid","preview","insertBtn","selectedChar","insertChar","chars","charInfo","selectedCharBtn","borderColor","selectChar","code","charCodeAt","padStart","SourceViewPlugin","createSourceEditor","spellcheck","contentWrapper","formatHtml","getSource","setSource","isSourceViewActive","FullscreenPlugin","originalStyles","enterFullscreen","exitFullscreen","right","zIndex","borderRadius","isFullscreenActive","AutosavePlugin","interval","saveHandler","useLocalStorage","showIndicator","saveTimer","isDirty","lastSavedContent","indicator","createIndicator","markDirty","checkRecovery","startTimer","handleBeforeUnload","updateIndicator","markClean","clearInterval","setInterval","save","stopTimer","saveToLocalStorage","localStorage","setItem","JSON","stringify","getFromLocalStorage","getItem","parse","clearLocalStorage","removeItem","saved","timeAgo","formatTimeAgo","confirm","seconds","Math","floor","returnValue","isDirtyContent","saveNow","WordCountPlugin","showWords","showCharacters","showCharactersWithoutSpaces","createCounter","update","words","charsNoSpace","FindReplaceDialog","findField","replaceField","optionsRow","matchCaseField","wholeWordField","resultsCounter","findInput","find","findPrevious","findNext","findPrevBtn","findNextBtn","replaceBtn","replaceAllBtn","replaceAll","replaceInput","matchCaseInput","wholeWordInput","matchCase","wholeWord","updateResultsCount","current","total","clearHighlights","FindReplacePlugin","matches","currentMatchIndex","highlightClass","currentHighlightClass","addStyles","selectedText","searchText","flags","regex","RegExp","highlightMatches","highlightCurrentMatch","walker","createTreeWalker","SHOW_TEXT","textNodes","currentNode","lastIndex","exec","replaceWithHighlights","createDocumentFragment","substring","matchIndex","scrollIntoView","behavior","count","normalize","MaxLengthPlugin","maxLength","maxWords","countMode","showCounter","showWarning","warningThreshold","enforceLimit","counterElement","isWarning","isOverLimit","checkLimit","updateCounter","getCurrentCount","getMaxCount","percentage","fontWeight","wasWarning","remaining","wasOverLimit","over","trimContent","trimToWords","trimToCharacters","maxChars","charCount","nodeLength","cutAt","next","toRemove","wordCount","w","remainingWords","trimmedWords","slice","pastedText","currentCount","pastedWords","allowedText","getRemainingCount","isAtLimit","isExceeded","setMaxLength","setMaxWords","MentionPlugin","trigger","minChars","maxSuggestions","debounceTime","dataSource","renderItem","insertTemplate","linkTemplate","searchQuery","selectedIndex","suggestions","triggerPosition","createDropdown","checkTrigger","query","getSearchQuery","search","getTextBeforeCursor","escapeRegex","test","preRange","triggerIndex","lastIndexOf","selectNext","selectPrevious","insertMention","getCaretPosition","performSearch","renderSuggestions","results","defaultRenderItem","updateSelection","positionDropdown","avatar","description","username","innerWidth","innerHeight","deleteTriggerAndQuery","deleteLength","deleteRange","profiles","full","autosave","wordcount","basic","minimal","email","defaults","mention","apiActions","getPresetCategories","getPresets","getFiles","getFolderTree","upload","createFolder","rename","copy","move","maxFileSize","allowedTypes","allowedProviders","theme","primaryColor","fontFamily","mergeOptions","userOptions","profileOptions","merged","allPlugins","profileOrOptions","profile","profileName","getProfiles","getDefaults","registerProfile","FileBrowser$1","requestTransformer","responseTransformer","showPresetTab","presetTabName","browserTabName","CONFIG","FILE_UPLOAD","ALLOWED_FILE_TYPES","thumbnailSize","MAX_FILE_SIZE","onClose","onError","activeTab","customContextMenuItems","useApiClient","ApiClient","auth","getToken","headerName","headerFormat","currentPath","currentPresetCategory","selectedFiles","clipboardFile","clipboardAction","searchTerm","sortBy","sortDir","viewMode","isLoading","breadcrumbs","path","fileIcons","default","folder","pdf","doc","docx","xls","xlsx","ppt","pptx","txt","zip","rar","mp3","mp4","mov","imageExtensions","bindMethods","createDOMElements","addEventListeners","isImageExtension","ext","loadFiles","loadPresets","loadPresetCategories","switchTab","selectFile","uploadFiles","renameFile","deleteFile","showContextMenu","navigateToFolder","confirmSelection","pasteFromClipboard","changeViewMode","handleEscapeKey","updateStatus","makeApiRequest","uploadFilesWithApi","endpoint","endpointUrl","requestData","headers","then","fetchOptions","addAuthToRequest","status","errorData","catch","token","password","btoa","customHandler","validFiles","size","logSecurityIssue","sanitizeFileName","isAllowedFileType","success","additionalData","uploadFile","fileFieldName","requestOptions","checkCsrfMetaTag","metaTag","csrfToken","getCsrfToken","csrfProtection","csrfTokenUrl","csrf_token","modal","closeButton","tabNav","presetTab","browserTab","presetContent","categoriesSidebar","presetFilesContainer","presetSearch","presetSearchInput","presetSearchIcon","presetToolbar","presetViewOptions","gridViewButton","listViewButton","presetFiles","browserContent","folderTreeContainer","folderTreeTitle","folderTree","browserMainContent","browserToolbar","breadcrumbsContainer","actionsContainer","uploadButton","multiple","accept","newFolderButton","searchAndViewContainer","browserSearch","browserSearchInput","browserSearchIcon","browserViewOptions","browserGridViewButton","browserListViewButton","dropArea","fileList","buttonsContainer","cancelButton","selectButton","useToken","tokenUrl","setupTokenRefresh","tokenRefreshTimer","refreshToken","refreshTokenInterval","tabContents","err","loadFolderTree","renderPresetCategories","categoriesContainer","categoriesList","allItem","filesContainer","URLSearchParams","sort_by","sort_dir","displayFiles","updateBreadcrumbs","displayFolderTree","folders","ul","createFolderTreeItem","children","rootItem","rootLink","hasChildren","expandIcon","subList","menuItems","customItem","parentPathOrEvent","folderName","prompt","alert","emptyMessage","a","b","valueA","valueB","fileItem","createFileItem","isSelected","some","thumbnail","isImage","mimeType","extension","imgUrl","iconClass","info","details","formatFileSize","date","formatDate","modified","fileWithMode","updateFileSelection","paths","homeItem","cloneNode","uploaded","Editor","fileName","fileType","isAllowed","cleanType","endsWith","filename","newName","new_name","isFolder","destination","dest","source","pageX","pageY","menuRect","windowWidth","windowHeight","gridButtons","listButtons","by","direction","currentTarget","bytes","log","parseFloat","pow","toFixed","d","getDate","getMonth","getFullYear","getHours","getMinutes"],"mappings":"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"}