{"version":3,"file":"now.core.min.js","sources":["../Now.js","../js/Utils.js","../js/NotificationManager.js","../js/ErrorManager.js","../js/ErrorRenderer.js","../js/I18nManager.js","../js/BackdropManager.js","../js/Modal.js","../js/ModalDataBinder.js","../js/EventManager.js","../js/EventSystemManager.js","../js/StateManager.js","../js/ScrollManager.js","../js/DialogManager.js","../js/TemplateManager.js","../js/ReactiveHelpers.js","../js/ComponentManager.js","../js/ReactiveManager.js","../js/ExpressionEvaluator.js","../js/WatchManager.js","../js/StorageManager.js","../js/SyncManager.js","../js/TokenService.js","../js/AuthManager.js","../js/RouterManager.js","../js/SecurityConfig.js","../js/SecurityManager.js","../js/ResponseHandler.js","../js/HttpClient.js","../js/ApiService.js","../js/ApiComponent.js","../js/ElementManager.js","../js/Autocomplete.js","../js/FormError.js","../js/FormManager.js","../js/ElementFactory.js","../js/DropdownPanel.js","../js/TextElementFactory.js","../js/MaskElementFactory.js","../js/NumberElementFactory.js","../js/SelectElementFactory.js","../js/CascadingSelectManager.js","../js/TextareaElementFactory.js","../js/FileElementFactory.js","../js/SearchElementFactory.js","../js/DateElementFactory.js","../js/ColorElementFactory.js","../js/TagsElementFactory.js","../js/MultiSelectElementFactory.js","../js/RangeElementFactory.js","../js/PasswordElementFactory.js","../js/CalendarManager.js","../js/FilterManager.js","../js/MenuManager.js","../js/Sortable.js","../js/TabsComponent.js","../js/AnimationManager.js","../js/MediaViewer.js","../js/EditInPlaceManager.js","../js/ThemeManager.js"],"sourcesContent":["/**\n * Now.js - Modern JavaScript Framework\n * Version 1.0.0\n *\n * Features:\n * - Integrated Authentication & Routing\n * - Component Management\n * - State Management\n * - Performance Monitoring\n * - Developer Tools\n * - Plugin System\n */\nconst Now = {\n  version: '1.0.0',\n  managers: new Map(),\n  plugins: new Map(),\n\n  paths: {\n    framework: '/Now',\n    application: '/',\n    components: '/js/components',\n    plugins: '/plugins',\n    templates: '/templates',\n    translations: '/translations'\n  },\n\n  resources: {\n    core: [\n      '/js/Utils.js',\n      '/js/NotificationManager.js',\n      '/js/ErrorManager.js',\n      '/js/ErrorRenderer.js',\n      '/js/I18nManager.js',\n      '/js/BackdropManager.js',\n      '/js/Modal.js',\n      '/js/ModalDataBinder.js',\n      '/js/EventManager.js',\n      '/js/EventSystemManager.js',\n      '/js/ThemeManager.js',\n      '/js/StateManager.js',\n      '/js/ScrollManager.js',\n      '/js/DialogManager.js',\n      '/js/TemplateManager.js',\n      '/js/ReactiveHelpers.js',\n      '/js/ComponentManager.js',\n      '/js/ReactiveManager.js',\n      '/js/ExpressionEvaluator.js',\n      '/js/WatchManager.js',\n      '/js/StorageManager.js',\n      '/js/SyncManager.js',\n      '/js/TokenService.js',\n      '/js/AuthManager.js',\n      '/js/RouterManager.js',\n      '/js/SecurityConfig.js',\n      '/js/SecurityManager.js',\n      '/js/ResponseHandler.js',\n      '/js/HttpClient.js',\n      '/js/ApiService.js',\n      '/js/ApiComponent.js',\n      '/js/ElementManager.js',\n      '/js/Autocomplete.js',\n      '/js/FormError.js',\n      '/js/FormManager.js',\n      '/js/ElementFactory.js',\n      '/js/DropdownPanel.js',\n      '/js/TextElementFactory.js',\n      '/js/MaskElementFactory.js',\n      '/js/NumberElementFactory.js',\n      '/js/SelectElementFactory.js',\n      '/js/CascadingSelectManager.js',\n      '/js/TextareaElementFactory.js',\n      '/js/FileElementFactory.js',\n      '/js/SearchElementFactory.js',\n      '/js/DateElementFactory.js',\n      '/js/ColorElementFactory.js',\n      '/js/TagsElementFactory.js',\n      '/js/MultiSelectElementFactory.js',\n      '/js/RangeElementFactory.js',\n      '/js/PasswordElementFactory.js',\n      '/js/CalendarManager.js',\n      '/js/FilterManager.js',\n      '/js/MenuManager.js',\n      '/js/Sortable.js',\n      '/js/AnimationManager.js',\n      '/js/MediaViewer.js'\n    ],\n    components: [],\n    plugins: []\n  },\n\n  /**\n   * Enhanced configuration with auth and router defaults\n   */\n  DEFAULT_CONFIG: {\n    debug: false,\n    environment: 'development',\n    strictMode: true,\n    mainSelector: '#main, [role=\"main\"]',\n\n    auth: {\n      enabled: false,  // ปิดเป็นค่าเริ่มต้น - เปิดเมื่อต้องการใช้งานจริง\n      type: 'jwt-httponly',\n      autoInit: false,\n      endpoints: {\n        login: 'api/auth/login',\n        logout: 'api/auth/logout',\n        verify: 'api/auth/verify',\n        refresh: 'api/auth/refresh'\n      },\n\n      redirects: {\n        afterLogin: '/',\n        afterLogout: '/login',\n        unauthorized: '/login',\n        forbidden: '/403'\n      }\n    },\n\n    router: {\n      enabled: false,\n      mode: 'history',\n      base: '/',\n      auth: {\n        enabled: false,  // ปิดเป็นค่าเริ่มต้น\n        autoGuard: false,\n        defaultRequireAuth: false,\n        publicPaths: ['/login', '/register', '/forgot-password'],\n        guestOnlyPaths: ['/login', '/register'],\n        conventions: {\n          '/auth/*': {public: true},\n          '/admin/*': {roles: ['admin']},\n          '/api/*': {skipRouter: true}\n        }\n      },\n      errorHandling: {\n        unauthorized: {\n          action: 'redirect',\n          target: '/login',\n          preservePath: true,\n          message: 'Please login to continue'\n        },\n        forbidden: {\n          action: 'render',\n          template: '/errors/403.html',\n          notify: true\n        },\n        notFound: {\n          action: 'render',\n          template: '/errors/404.html',\n          title: 'Page Not Found'\n        }\n      }\n    },\n\n    component: {\n      reactive: false,\n      autoRender: true,\n      batchUpdates: true,\n      batchDelay: 16,\n      devTools: {\n        enabled: true,\n        logStateChanges: true\n      }\n    },\n\n    stateManager: {\n      persistent: false,\n      storage: 'localStorage',\n      devTools: true\n    },\n\n    security: {\n      csrf: {\n        enabled: false,  // ปิดเป็นค่าเริ่มต้น - เปิดเมื่อต้องการใช้งาน form submission\n        tokenName: '_token',\n        headerName: 'X-CSRF-Token'\n      },\n      xss: {\n        enabled: false   // ปิดเป็นค่าเริ่มต้น\n      },\n      csp: {\n        enabled: false   // ปิดเป็นค่าเริ่มต้น\n      },\n      validateInput: {\n        enabled: false   // ปิดเป็นค่าเริ่มต้น\n      },\n      sanitizeOutput: {\n        enabled: false   // ปิดเป็นค่าเริ่มต้น\n      }\n    },\n\n    devTools: {\n      enabled: false,\n      performance: true,\n      logger: true,\n      inspector: true\n    },\n\n    performance: {\n      monitoring: false,\n      metrics: true,\n      warnings: true,\n      errorReporting: true\n    },\n\n    i18n: {\n      enabled: false,\n      defaultLocale: 'en',\n      availableLocales: ['en', 'th'],\n      fallbackLocale: 'en'\n    },\n\n    serviceWorker: {\n      enabled: false,\n      debug: false,\n      serviceWorkerPath: '/service-worker.js',\n      scope: '/'\n    },\n\n    http: {\n      baseURL: '',\n      timeout: 30000,\n      retries: 3,\n      retryDelay: 1000\n    },\n\n    storage: {\n      enabled: true,\n      type: 'indexeddb',\n      name: 'now_app_storage'\n    },\n\n    app: {\n      name: 'Now.js Application',\n      version: '1.0.0',\n      description: '',\n      author: '',\n      homepage: ''\n    }\n  },\n\n  state: {\n    initialized: false,\n    loading: false,\n    error: null,\n    loadedResources: new Set(),\n    activeApp: null,\n    performance: {\n      startTime: null,\n      metrics: new Map()\n    }\n  },\n\n  managers: new Map(),\n\n  async init(options = {}) {\n    try {\n      this.state.loading = true;\n\n      if (!this.state.loadedResources) {\n        this.state.loadedResources = new Set();\n      }\n\n      if (!this.state.performance) {\n        this.state.performance = {\n          startTime: null,\n          metrics: new Map()\n        };\n      }\n\n      this.setupErrorHandling();\n\n      this.config = this.mergeConfig(this.DEFAULT_CONFIG, options);\n\n      if (options.paths) {\n        this.paths = {...this.paths, ...options.paths};\n      }\n\n      // Auto-detect base path before loading any resources\n      const detectedBasePath = await this.detectBasePath();\n      // Normalize and store base path for managers to consume\n      try {\n        let base = detectedBasePath || '';\n        if (!base) base = '/';\n        if (!base.startsWith('/')) base = '/' + base;\n        if (base.length > 1 && base.endsWith('/')) base = base.slice(0, -1);\n        this.basePath = base;\n        // Mirror into router config if not explicitly provided\n        if (!this.config.router) this.config.router = {};\n        if (!this.config.router.base || this.config.router.base === '/') {\n          this.config.router.base = base;\n        }\n      } catch (e) {\n        console.warn('[Now.js] Failed to normalize detected base path', e);\n      }\n\n      if (this.config.environment === 'development') {\n        this.setupDevTools();\n      }\n\n      // Check if we should use bundle or individual files\n      const useBundle = this.config.environment === 'production';\n\n      if (!useBundle) {\n        await this.loadResources(this.resources.core, 'framework');\n      }\n\n      await this.initializeManagers();\n\n      if (options.resources?.plugins?.length > 0) {\n        await this.loadResources(options.resources.plugins, 'plugins');\n        await this.initializePlugins(options.resources.plugins);\n      }\n\n      if (options.resources?.components?.length > 0) {\n        await this.loadResources(options.resources.components, 'components');\n        await this.initializeComponents(options.resources.components);\n      }\n\n      this.state.initialized = true;\n\n      if (this.config.auth?.enabled) {\n        //await this.setupAuth(this.config.auth);\n      }\n\n      if (this.config.router?.enabled) {\n        //await this.setupRouterWithAuth(this.config.router);\n      }\n\n      if (this.config.authTemplate?.enabled || (this.config.auth?.enabled && this.config.template?.auth)) {\n        const AuthTemplateManager = window.AuthTemplateManager;\n        if (AuthTemplateManager) {\n          await AuthTemplateManager.init(this.config.authTemplate || this.config.template?.auth || {});\n          this.registerManager('authTemplate', AuthTemplateManager);\n        }\n      }\n\n      this.state.loading = false;\n\n      this.endPerformanceTracking('initialization');\n\n      return this;\n\n    } catch (error) {\n      this.state.loading = false;\n      this.handleError(error);\n      throw error;\n    }\n  },\n\n  async createApp(config = {}) {\n    if (!this.state.initialized) {\n      throw new Error('Framework must be initialized first');\n    }\n\n    try {\n      this.startPerformanceTracking('app-creation');\n\n      const app = {\n        config: this.mergeConfig(this.config.app, config),\n        framework: this,\n        managers: this.managers,\n        plugins: this.plugins,\n        state: {},\n        mount: async (el) => this.mountApp(app, el)\n      };\n\n      if (config.state && this.managers.has('state')) {\n        app.state = await this.managers.get('state').init(config.state);\n      }\n\n      if (config.i18n && this.managers.has('i18n')) {\n        await this.managers.get('i18n').init(config.i18n);\n      }\n\n      if (config.plugins) {\n        await this.initializeAppPlugins(app, config.plugins);\n      }\n\n      this.endPerformanceTracking('app-creation');\n      this.state.activeApp = app;\n\n      return app;\n\n    } catch (error) {\n      this.handleError(error);\n      throw error;\n    }\n  },\n\n  /**\n   * Route Registration Helpers\n   */\n\n  publicRoute(path, config) {\n    if (!RouterManager.state.initialized) {\n      throw new Error('RouterManager must be initialized first');\n    }\n\n    return RouterManager.register(path, {\n      ...config,\n      requireAuth: false,\n      isPublic: true\n    });\n  },\n\n  protectedRoute(path, config) {\n    if (!RouterManager.state.initialized) {\n      throw new Error('RouterManager must be initialized first');\n    }\n\n    return RouterManager.register(path, {\n      ...config,\n      requireAuth: true\n    });\n  },\n\n  adminRoute(path, config) {\n    if (!RouterManager.state.initialized) {\n      throw new Error('RouterManager must be initialized first');\n    }\n\n    const AuthGuards = window.AuthGuards;\n    return RouterManager.register(path, {\n      ...config,\n      requireAuth: true,\n      roles: ['admin'],\n      beforeEnter: AuthGuards ? AuthGuards.adminOnly() : null\n    });\n  },\n\n  roleRoute(path, roles, config) {\n    if (!RouterManager.state.initialized) {\n      throw new Error('RouterManager must be initialized first');\n    }\n\n    const AuthGuards = window.AuthGuards;\n    return RouterManager.register(path, {\n      ...config,\n      requireAuth: true,\n      roles: Array.isArray(roles) ? roles : [roles],\n      beforeEnter: AuthGuards ? AuthGuards.requireRole(roles) : null\n    });\n  },\n\n  guestRoute(path, config) {\n    if (!RouterManager.state.initialized) {\n      throw new Error('RouterManager must be initialized first');\n    }\n\n    const AuthGuards = window.AuthGuards;\n    return RouterManager.register(path, {\n      ...config,\n      requireGuest: true,\n      beforeEnter: AuthGuards ? AuthGuards.requireGuest() : null\n    });\n  },\n\n  /**\n   * Template Auth Helpers\n   */\n  updateAuthTemplates(container = document.body) {\n    const authTemplateManager = this.getManager('authTemplate');\n    if (authTemplateManager) {\n      authTemplateManager.processContainer(container);\n    }\n  },\n\n  async refreshAuthTemplates() {\n    const authTemplateManager = this.getManager('authTemplate');\n    if (authTemplateManager) {\n      await authTemplateManager.forceUpdate();\n    }\n  },\n\n  translate(key, params = {}) {\n    const i18n = this.getManager('i18n');\n    return i18n ? i18n.translate(key, params) : key;\n  },\n\n  emit(event, data = {}) {\n    const eventManager = this.getManager('event');\n    if (eventManager) {\n      return eventManager.emit(event, {\n        ...data,\n        timestamp: Date.now()\n      });\n    }\n  },\n\n  async mountApp(app, el) {\n    try {\n      this.startPerformanceTracking('app-mount');\n\n      const mountEl = typeof el === 'string' ?\n        document.querySelector(el) : el;\n\n      if (!mountEl) {\n        throw new Error('Mount element not found');\n      }\n\n      mountEl.innerHTML = '';\n\n      if (this.managers.has('component')) {\n        await this.managers.get('component').init(mountEl);\n      }\n\n      if (this.managers.has('event')) {\n        this.managers.get('event').emit('app:mounted', {app});\n      }\n\n      this.endPerformanceTracking('app-mount');\n\n    } catch (error) {\n      this.handleError(error);\n      throw error;\n    }\n  },\n\n  use(plugin, config = {}) {\n    if (!plugin.name) {\n      throw new Error('Plugin must have a name');\n    }\n\n    if (this.plugins.has(plugin.name)) {\n      return this;\n    }\n\n    this.plugins.set(plugin.name, {\n      instance: plugin,\n      config\n    });\n\n    return this;\n  },\n\n  /**\n   * Register Manager\n   */\n  registerManager(name, manager) {\n    if (this.managers.has(name)) {\n      return this;\n    }\n\n    this.managers.set(name, manager);\n    return this;\n  },\n\n  async initializeComponents(components) {\n    const componentManager = this.getManager('component');\n\n    if (!componentManager) {\n      return;\n    }\n\n    for (const component of components) {\n      try {\n        // Extract filename without extension\n        const filename = component.split('/').pop().replace('.js', '');\n\n        // Convert to lowercase and remove 'Component' suffix to match registration name\n        const registrationName = filename\n          .replace(/Component$/, '')\n          .toLowerCase();\n\n        let retries = 0;\n        const maxRetries = 5;\n\n        while (retries < maxRetries) {\n          // Check if component is registered using the lowercase name\n          if (componentManager.has(registrationName)) {\n            break;\n          }\n          await new Promise(resolve => setTimeout(resolve, 100));\n          retries++;\n        }\n\n        if (retries === maxRetries) {\n          const errorMsg =\n            `❌ Component initialization failed!\\n` +\n            `\\n` +\n            `Expected component name: \"${registrationName}\"\\n` +\n            `From file: ${filename}.js\\n` +\n            `Full path: ${component}\\n` +\n            `\\n` +\n            `The component was not registered within ${maxRetries * 100}ms.\\n` +\n            `\\n` +\n            `Common causes:\\n` +\n            `1. Component name mismatch - Check that the component registers as \"${registrationName}\"\\n` +\n            `   Example: Now.getManager('component').define('${registrationName}', {...})\\n` +\n            `\\n` +\n            `2. Component name conflict - Another component may already use this name\\n` +\n            `   Check console for \"Component name conflict\" warnings\\n` +\n            `\\n` +\n            `3. JavaScript error in component file - Check browser console for errors\\n` +\n            `\\n` +\n            `4. File not loaded - Verify the file path is correct\\n` +\n            `\\n` +\n            `Registered components: ${Array.from(componentManager.components.keys()).join(', ') || 'none'}`;\n\n          if (this.config.strictMode) {\n            throw new Error(errorMsg);\n          } else {\n            console.error(errorMsg);\n          }\n        }\n\n      } catch (error) {\n        if (this.config.strictMode) {\n          throw error;\n        } else {\n          console.error('Component initialization error:', error);\n        }\n      }\n    }\n  },\n\n  async loadResources(resources, type) {\n    if (!resources || resources.length === 0) return;\n\n    for (const resource of resources) {\n      if (this.state.loadedResources.has(resource)) continue;\n\n      try {\n        const path = this.resolvePath(resource, type);\n\n        await this.loadResource(path);\n\n        this.state.loadedResources.add(resource);\n\n        const match = path.match(/(([^\\/]+)Manager).js$/);\n        if (match) {\n          const manager = window[match[1]];\n          if (manager) {\n            this.managers.set(match[2].toLowerCase(), manager);\n          }\n        }\n      } catch (error) {\n        if (this.config.strictMode) {\n          throw error;\n        }\n      }\n    }\n  },\n\n  async loadResource(url) {\n    const startTime = performance.now();\n\n    try {\n      const ext = url.split('.').pop().toLowerCase();\n      let element;\n\n      switch (ext) {\n        case 'css':\n          element = document.createElement('link');\n          element.rel = 'stylesheet';\n          element.href = url;\n          break;\n\n        case 'js':\n          element = document.createElement('script');\n          element.src = url;\n          element.async = true;\n          break;\n\n        default:\n          throw new Error(`Unsupported resource type: ${ext}`);\n      }\n\n      await new Promise((resolve, reject) => {\n        element.onload = resolve;\n        element.onerror = () => reject(new Error(`Failed to load: ${url}`));\n        document.head.appendChild(element);\n      });\n\n      const endTime = performance.now();\n      this.recordPerformance('resource-load', {\n        url,\n        duration: endTime - startTime,\n        type: ext\n      });\n\n      return true;\n\n    } catch (error) {\n      const failed = document.querySelector(`[src=\"${url}\"], [href=\"${url}\"]`);\n      if (failed) {\n        failed.remove();\n      }\n\n      this.recordPerformance('resource-error', {\n        url,\n        error: error.message\n      });\n\n      throw error;\n    }\n  },\n\n  resolvePath(resource, type = 'framework') {\n    // Normalize resource (remove leading ../, ./ or /)\n    resource = String(resource || '').replace(/^(?:\\.\\.\\/|\\.\\/|\\/)+/, '');\n\n    const pathMap = {\n      framework: this.paths.framework,\n      application: this.paths.application,\n      components: this.paths.components,\n      plugins: this.paths.plugins,\n      templates: this.paths.templates,\n      translations: this.paths.translations\n    };\n\n    const typeBase = String(pathMap[type] || '');\n\n    // Build parts: [basePath (if not '/'), typeBase (if not '/'), resource]\n    const parts = [];\n\n    // canonical basePath (Now.basePath) - may be '/'\n    let base = String(this.basePath || '').trim();\n    if (base && base !== '/') {\n      base = base.replace(/^\\/+|\\/+$/g, '');\n      if (base) parts.push(base);\n    }\n\n    // canonical type base (from this.paths)\n    if (typeBase && typeBase !== '/') {\n      const tb = typeBase.replace(/^\\/+|\\/+$/g, '');\n      if (tb) parts.push(tb);\n    }\n\n    // resource (no leading slash)\n    const res = resource.replace(/^\\/+/, '');\n    if (res) parts.push(res);\n\n    // join with single slashes; ensure leading slash\n    return '/' + parts.join('/');\n  },\n\n  /**\n   * Get the current base path\n   * @returns {string} The base path (e.g., '/nowjs' or '/')\n   */\n  getBasePath() {\n    return this.basePath || '/';\n  },\n\n  /**\n   * Resolve a URL relative to the application base path\n   * @param {string} url - The URL to resolve (can be relative or absolute)\n   * @returns {string} The resolved URL with base path applied\n   */\n  resolveUrl(url) {\n    if (!url) return this.getBasePath();\n\n    const u = String(url).trim();\n\n    // Return absolute URLs as-is\n    if (/^(https?:)?\\/\\//i.test(u)) return u;\n\n    // Return root-absolute paths as-is (explicit absolute)\n    if (u.startsWith('/')) return u;\n\n    // For relative URLs, prepend base path\n    const base = this.getBasePath();\n    if (base === '/') {\n      return '/' + u;\n    }\n    return base + '/' + u;\n  },\n\n  /**\n   * Build a URL with base path applied\n   * @param {...string} parts - URL parts to join\n   * @returns {string} The complete URL with base path\n   */\n  buildUrl(...parts) {\n    const cleanParts = parts\n      .filter(part => part != null && part !== '')\n      .map(part => String(part).replace(/^\\/+|\\/+$/g, ''))\n      .filter(part => part !== '');\n\n    const base = this.getBasePath();\n    const allParts = [];\n\n    if (base && base !== '/') {\n      allParts.push(base.replace(/^\\/+|\\/+$/g, ''));\n    }\n\n    allParts.push(...cleanParts);\n\n    return '/' + allParts.join('/');\n  },\n\n  /**\n   * Get the current full path including base path (without trailing slash)\n   * @returns {string} The current path including base path (e.g., '/nowjs/examples/playground')\n   */\n  getCurrentPath() {\n    const path = window.location.pathname || '/';\n    // Remove trailing slash except for root path\n    return path === '/' ? '/' : path.replace(/\\/+$/, '');\n  },\n\n  /**\n   * Get the current directory path including base path with trailing slash\n   * @returns {string} The current directory path (e.g., '/nowjs/examples/playground/')\n   */\n  getCurrentDir() {\n    const path = this.getCurrentPath();\n    return path.endsWith('/') ? path : path + '/';\n  },\n\n  /**\n   * Get the current relative path (removes base path from current location)\n   * @returns {string} The relative path from base (e.g., '/examples/playground/' if base is '/nowjs')\n   */\n  getCurrentRelativePath() {\n    const currentPath = this.getCurrentPath();\n    const basePath = this.getBasePath();\n\n    if (basePath === '/' || !currentPath.startsWith(basePath)) {\n      return currentPath;\n    }\n\n    const relativePath = currentPath.substring(basePath.length);\n    return relativePath.startsWith('/') ? relativePath : '/' + relativePath;\n  },\n\n  async detectBasePath() {\n    // Detect framework path from the current Now.js script tag\n    const scripts = document.getElementsByTagName('script');\n    const nowScript = Array.from(scripts).find(script =>\n      script.src && (script.src.includes('Now.js') || script.src.includes('now.core'))\n    );\n\n    let detectedBasePath = '';\n\n    if (nowScript) {\n      const scriptSrc = nowScript.src;\n\n      const url = new URL(scriptSrc);\n      const pathname = url.pathname;\n\n      if (pathname.endsWith('/Now/Now.js')) {\n        const basePathWithTrailing = pathname.replace('/Now/Now.js', '');\n        detectedBasePath = basePathWithTrailing || '';\n      }\n    }\n\n    // Note: We no longer modify this.paths here since resolvePath() handles base path combination\n    return detectedBasePath;\n  },\n\n  /**\n   * Check if the bundled core file is available\n   * @returns {Promise<boolean>}\n   */\n  async isBundleAvailable() {\n    try {\n      const bundlePath = this.resolvePath('/dist/now.core.min.js', 'framework');\n      const response = await fetch(bundlePath, {method: 'HEAD'});\n      return response.ok;\n    } catch (error) {\n      return false;\n    }\n  },\n\n\n  async initializeManagers() {\n    for (const [name, manager] of this.managers) {\n      if (typeof manager.init === 'function') {\n        try {\n          await manager.init(this.config[name]);\n        } catch (error) {\n          if (this.config.strictMode) {\n            throw error;\n          }\n        }\n      }\n    }\n  },\n\n  async initializePlugins(plugins) {\n    for (const plugin of plugins) {\n      try {\n        const match = plugin.match(/(([^\\/]+)Plugin).js$/);\n        if (match) {\n          const instance = window[match[1]];\n          if (typeof instance?.init === 'function') {\n            const config = this.config[match[2].toLowerCase()];\n            await instance.init(this, config);\n          }\n        }\n      } catch (error) {\n        if (this.config.strictMode) {\n          throw error;\n        }\n        console.warn(`Failed to initialize plugin ${plugin}:`, error);\n      }\n    }\n  },\n\n  async initializeAppPlugins(app, plugins) {\n    for (const plugin of plugins) {\n      try {\n        if (typeof plugin.init === 'function') {\n          await plugin.init(app);\n        }\n      } catch (error) {\n        if (this.config.strictMode) {\n          throw error;\n        }\n        console.warn('Failed to initialize app plugin:', error);\n      }\n    }\n  },\n\n  handleEvent(method, element) {\n    const componentId = element.closest('[data-component]')?.dataset.componentId;\n    if (!componentId) return;\n\n    const componentManager = this.getManager('component');\n    if (componentManager) {\n      const instance = componentManager.instances.get(componentId);\n      if (instance?.methods[method]) {\n        instance.methods[method].call(instance);\n      }\n    }\n  },\n\n  setupErrorHandling() {\n    window.onerror = (message, source, line, column, error) => {\n      this.handleError(error || new Error(message), {\n        source, line, column\n      });\n    };\n\n    window.onunhandledrejection = (event) => {\n      this.handleError(event.reason, {\n        type: 'unhandledrejection'\n      });\n    };\n  },\n\n  handleError(error, context = {}) {\n    this.state.error = error;\n    this.state.loading = false;\n\n    const errorData = {\n      message: error.message,\n      stack: error.stack,\n      timestamp: Date.now(),\n      ...context\n    };\n\n    if (this.config.debug) {\n      console.error('Framework Error:', errorData);\n    }\n\n    try {\n      const notification = this.getManager('notification');\n      if (notification) {\n        notification.error(error.message || 'An error occurred');\n      }\n    } catch (notificationError) {\n      console.error('Failed to show error notification:', notificationError);\n    }\n\n    try {\n      const eventManager = this.getManager('event');\n      if (eventManager) {\n        eventManager.emit('error', {error, context});\n      }\n    } catch (eventError) {\n      console.error('Failed to emit error event:', eventError);\n    }\n\n    if (this.config.performance?.errorReporting &&\n      this.state.performance?.metrics) {\n      this.logErrorMetrics(error, context);\n    }\n  },\n\n  setupDevTools() {\n    if (!this.config.devTools.enabled) return;\n\n    window.__NOW_DEV__ = {\n      framework: this,\n      inspect: () => this.inspect(),\n      getManagers: () => Array.from(this.managers.keys()),\n      getPlugins: () => Array.from(this.plugins.keys()),\n      getResources: () => Array.from(this.state.loadedResources),\n      getConfig: () => this.config,\n      getState: () => this.state,\n      getPerformance: () => this.getPerformanceMetrics(),\n      reload: () => window.location.reload(),\n      clearCache: () => {\n        this.state.loadedResources.clear();\n        this.state.performance.metrics.clear();\n      }\n    };\n\n    console.log('Now.js Dev Tools available at window.__NOW_DEV__');\n  },\n\n  startPerformanceTracking(label = 'general') {\n    if (!this.config.performance.monitoring) return;\n\n    const metric = {\n      start: performance.now(),\n      end: null,\n      duration: null\n    };\n\n    this.state.performance.metrics.set(label, metric);\n  },\n\n  endPerformanceTracking(label = 'general') {\n    if (!this.config.performance.monitoring) return;\n\n    const metric = this.state.performance.metrics.get(label);\n    if (metric) {\n      metric.end = performance.now();\n      metric.duration = metric.end - metric.start;\n\n      this.recordPerformance(label, {\n        duration: metric.duration,\n        start: metric.start,\n        end: metric.end\n      });\n    }\n  },\n\n  recordPerformance(name, data) {\n    if (!this.config.performance.monitoring) return;\n\n    const metric = {\n      name,\n      timestamp: Date.now(),\n      ...data\n    };\n\n    this.state.performance.metrics.set(`${name}_${Date.now()}`, metric);\n\n    const event = this.getManager('event');\n    if (event) {\n      event.emit('performance:recorded', metric);\n    }\n\n    if (this.config.performance.warnings) {\n      this.checkPerformanceWarning(metric);\n    }\n  },\n\n  checkPerformanceWarning(metric) {\n    const thresholds = {\n      'resource-load': 2000,\n      'initialization': 5000,\n      'app-mount': 1000,\n      'component-render': 100,\n      'app-creation': 500\n    };\n\n    const threshold = thresholds[metric.name];\n    if (threshold && metric.duration > threshold) {\n      const warning = `Performance warning: ${metric.name} took ${metric.duration.toFixed(2)}ms (threshold: ${threshold}ms)`;\n\n      if (this.config.debug) {\n        console.warn(warning);\n      }\n\n      const notification = this.getManager('notification');\n      if (notification && this.config.devTools.enabled) {\n        notification.warning(warning, {duration: 3000});\n      }\n    }\n  },\n\n  getPerformanceMetrics() {\n    const metrics = {};\n    this.state.performance.metrics.forEach((metric, label) => {\n      metrics[label] = {\n        duration: metric.duration,\n        timestamp: metric.start || metric.timestamp\n      };\n    });\n    return metrics;\n  },\n\n  inspect() {\n    return {\n      version: this.version,\n      state: {\n        initialized: this.state.initialized,\n        loading: this.state.loading,\n        error: this.state.error,\n        resources: Array.from(this.state.loadedResources),\n        performance: this.getPerformanceMetrics()\n      },\n      config: this.config,\n      managers: Array.from(this.managers.keys()),\n      plugins: Array.from(this.plugins.keys()),\n      activeApp: this.state.activeApp ? {\n        name: this.state.activeApp.config.name,\n        version: this.state.activeApp.config.version,\n        plugins: Object.keys(this.state.activeApp.plugins || {})\n      } : null\n    };\n  },\n\n  logErrorMetrics(error, context = {}) {\n    const metric = {\n      timestamp: Date.now(),\n      type: error.name,\n      message: error.message,\n      stack: error.stack,\n      location: window.location.href,\n      context\n    };\n\n    this.state.performance.metrics.set(`error_${Date.now()}`, metric);\n  },\n\n  mergeConfig(base, override) {\n    const merged = {...base};\n\n    for (const [key, value] of Object.entries(override)) {\n      if (value && typeof value === 'object' && !Array.isArray(value)) {\n        merged[key] = this.mergeConfig(base[key] || {}, value);\n      } else {\n        merged[key] = value;\n      }\n    }\n\n    return merged;\n  },\n\n  /**\n   * Get Manager\n   */\n  getManager(name) {\n    return this.managers.get(name) || null;\n  },\n\n  getPlugin(name) {\n    return this.plugins.get(name)?.instance || null;\n  },\n\n  async cleanup() {\n    for (const [name, manager] of this.managers) {\n      if (typeof manager.cleanup === 'function') {\n        try {\n          await manager.cleanup();\n        } catch (error) {\n          console.warn(`Failed to cleanup manager ${name}:`, error);\n        }\n      }\n    }\n\n    for (const [name, plugin] of this.plugins) {\n      if (typeof plugin.instance?.cleanup === 'function') {\n        try {\n          await plugin.instance.cleanup();\n        } catch (error) {\n          console.warn(`Failed to cleanup plugin ${name}:`, error);\n        }\n      }\n    }\n\n    this.state.loadedResources.clear();\n    this.state.performance.metrics.clear();\n    this.state.activeApp = null;\n    this.state.error = null;\n  },\n\n  async reset() {\n    await this.cleanup();\n\n    this.managers.clear();\n    this.plugins.clear();\n    this.state.initialized = false;\n    this.state.loading = false;\n\n    this.config = {...this.DEFAULT_CONFIG};\n  }\n};\n\nwindow.Now = Now;\n","const Utils = {\n  string: {\n    random(length = 8) {\n      return Array.from(crypto.getRandomValues(new Uint8Array(length)))\n        .map(b => b.toString(16).padStart(2, '0'))\n        .join('');\n    },\n\n    escape(unsafe) {\n      return unsafe\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#039;\");\n    },\n\n    sanitizeFilename(filename) {\n      return filename.replace(/[^a-z0-9.-]/gi, '_');\n    },\n\n    capitalize(str) {\n      return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    /**\n     * Convert snake_case, kebab-case, or camelCase to human-readable text\n     * - snake_case (underscore) → Sentence case: 'multi_select' → 'Multi select'\n     * - kebab-case (hyphen) → Title Case: 'multi-select' → 'Multi Select'\n     * - camelCase → Title Case: 'firstName' → 'First Name'\n     * - UPPER_CASE → Sentence case: 'UPPER_CASE' → 'Upper case'\n     * @param {string} str - Input string\n     * @returns {string} Humanized string\n     */\n    humanize(str) {\n      const s = String(str);\n      const hasUnderscore = s.includes('_');\n\n      // Process the string\n      let result = s\n        .replace(/([a-z])([A-Z])/g, '$1 $2')  // camelCase → camel Case\n        .replace(/[_-]+/g, ' ')               // separators → spaces\n        .replace(/\\s+/g, ' ')\n        .trim();\n\n      if (hasUnderscore) {\n        // snake_case / UPPER_CASE → Sentence case\n        result = result.toLowerCase();\n        return result.charAt(0).toUpperCase() + result.slice(1);\n      } else {\n        // kebab-case / camelCase → Title Case\n        return result.replace(/\\b\\w/g, c => c.toUpperCase());\n      }\n    },\n\n    truncate(str, length = 100, ending = '...') {\n      if (str.length > length) {\n        return str.substring(0, length - ending.length) + ending;\n      }\n      return str;\n    },\n\n    slugify(str) {\n      return str.normalize(\"NFKD\")\n        .toLowerCase()\n        .replace(/[^\\w\\s-]/g, '')\n        .replace(/\\s+/g, '-')\n        .replace(/-+/g, '-')\n        .replace(/^-+|-+$/g, '');\n    },\n\n    stripTags(html) {\n      const div = document.createElement('div');\n      div.innerHTML = html;\n      return div.textContent || div.innerText || '';\n    },\n\n    applyFormatters(value, formatters, context) {\n      return formatters.reduce((val, formatter) => {\n        const [name, ...args] = formatter.split(':');\n\n        // Skip empty formatter names (e.g., from \"value | \" or number literals)\n        if (!name || name.trim() === '' || !isNaN(name)) {\n          return val;\n        }\n\n        const format = context.filters?.[name] || this.builtinFormatters[name];\n\n        if (typeof format === 'function') {\n          return format(val, ...args);\n        }\n\n        console.warn(`[Utils] Formatter \"${name}\" not found`);\n        return val;\n      }, value);\n    },\n\n    builtinFormatters: {\n      number: (value, decimals = 0) => {\n        return Number(value).toLocaleString(undefined, {\n          minimumFractionDigits: parseInt(decimals),\n          maximumFractionDigits: parseInt(decimals)\n        });\n      },\n\n      currency: (value, currency = 'USD') => {\n        return Number(value).toLocaleString(undefined, {\n          style: 'currency',\n          currency: currency\n        });\n      },\n\n      percent: (value, decimals = 0) => {\n        return (Number(value) * 100).toFixed(decimals) + '%';\n      },\n\n      lowercase: value => String(value).toLowerCase(),\n      uppercase: value => String(value).toUpperCase(),\n      capitalize: value => {\n        const str = String(value);\n        return str.charAt(0).toUpperCase() + str.slice(1);\n      },\n      humanize: value => Utils.string.humanize(value),\n\n      date: (value, format = 'medium') => {\n        const date = new Date(value);\n        return date.toLocaleDateString(undefined, {\n          dateStyle: format\n        });\n      },\n\n      time: (value, format = 'medium') => {\n        const date = new Date(value);\n        return date.toLocaleTimeString(undefined, {\n          timeStyle: format\n        });\n      },\n\n      default: (value, defaultValue = '') => {\n        return value == null ? defaultValue : value;\n      }\n    }\n  },\n\n  number: {\n    format(num, decimals = 0) {\n      return Number(num).toLocaleString(undefined, {\n        minimumFractionDigits: decimals,\n        maximumFractionDigits: decimals\n      });\n    },\n\n    /**\n     * Format as currency\n     * @param {number} amount - Amount to format\n     * @param {string|null} currency - Currency code (e.g., 'THB', 'USD'). If null, no symbol shown.\n     * @param {string} locale - Locale for formatting\n     * @returns {string} Formatted currency string\n     * @example\n     *   currency(1234.56)           // '1,234.56' (no symbol)\n     *   currency(1234.56, 'THB')    // '฿1,234.56'\n     *   currency(1234.56, 'USD')    // '$1,234.56'\n     */\n    currency(amount, currency = null, locale = 'en-US') {\n      if (currency) {\n        return new Intl.NumberFormat(locale, {\n          style: 'currency',\n          currency: currency\n        }).format(amount);\n      }\n      // No currency symbol - just formatted number with 2 decimals\n      return new Intl.NumberFormat(locale, {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n      }).format(amount);\n    },\n\n    percentage(num, decimals = 0) {\n      return (num * 100).toFixed(decimals) + '%';\n    },\n\n    fileSize(bytes) {\n      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n      if (bytes === 0) return '0 Byte';\n      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));\n      return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];\n    },\n\n    round(val, precision = 2) {\n      const factor = Math.pow(10, precision);\n      return Math.round(val * factor) / factor;\n    },\n\n    ceil(val, precision = 2) {\n      const factor = Math.pow(10, precision);\n      return Math.ceil(val * factor) / factor;\n    },\n\n    floor(val, precision = 2) {\n      const factor = Math.pow(10, precision);\n      return Math.floor(val * factor) / factor;\n    },\n\n    truncate(val, precision = 2) {\n      const factor = Math.pow(10, precision);\n      return Math.trunc(val * factor) / factor;\n    }\n  },\n\n  date: {\n    /**\n     * Format date with standard tokens and locale-based year system\n     *\n     * Standard Format Tokens (ISO 8601 / Unicode LDML compatible):\n     *\n     * Year:\n     *   YYYY = 4-digit year (2025 CE or 2568 BE based on locale)\n     *   YY = 2-digit year (25 or 68 based on locale)\n     *\n     * Month:\n     *   MMMM = Full month name localized (January/มกราคม)\n     *   MMM = Short month name localized (Jan/ม.ค.)\n     *   MM = Month with zero (01-12)\n     *   M = Month without zero (1-12)\n     *\n     * Day:\n     *   DD = Day with zero (01-31)\n     *   D = Day without zero (1-31)\n     *\n     * Time:\n     *   HH = Hours 24h with zero (00-23)\n     *   H = Hours 24h without zero (0-23)\n     *   hh = Hours 12h with zero (01-12)\n     *   h = Hours 12h without zero (1-12)\n     *   mm = Minutes with zero (00-59)\n     *   ss = Seconds with zero (00-59)\n     *   A = AM/PM uppercase\n     *   a = am/pm lowercase\n     *\n     * Locale Behavior:\n     *   'th' or 'th-TH' = Buddhist Era (BE): YYYY shows 2568\n     *   'th-CE' = Force Christian Era: YYYY shows 2025\n     *   'en' or others = Christian Era (CE): YYYY shows 2025\n     *\n     * Examples:\n     *   Utils.date.format(date, 'D MMMM YYYY') // Auto locale\n     *   Utils.date.format(date, 'D MMMM YYYY', 'th') // \"15 พฤษภาคม 2568\"\n     *   Utils.date.format(date, 'D MMMM YYYY', 'th-CE') // \"15 พฤษภาคม 2025\"\n     *   Utils.date.format(date, 'D MMMM YYYY', 'en') // \"15 May 2025\"\n     *\n     * @param {Date|string} date - Date to format\n     * @param {string} format - Format pattern (standard tokens)\n     * @param {string} locale - Locale code (auto-detect if not provided)\n     *   - 'th' or 'th-TH' = Thai with BE year\n     *   - 'th-CE' = Thai with CE year\n     *   - 'en' or others = English with CE year\n     * @returns {string} Formatted date string\n     */\n    format(date, format = 'YYYY-MM-DD', locale = null) {\n      const d = new Date(date);\n      if (isNaN(d.getTime())) return '';\n\n      // Auto-detect locale if not provided\n      if (!locale) {\n        // Try I18nManager first (primary source)\n        const i18n = window.Now?.getManager?.('i18n') || window.I18nManager;\n        if (i18n?.getCurrentLocale) {\n          locale = i18n.getCurrentLocale();\n        } else if (window.LanguageManager?.getCurrentLanguage) {\n          locale = window.LanguageManager.getCurrentLanguage();\n        }\n\n        // Fallback to browser language\n        if (!locale) {\n          const browserLang = navigator.language || navigator.userLanguage || 'en';\n          locale = browserLang.startsWith('th') ? 'th' : 'en';\n        }\n      }\n\n      // Determine if we should use BE (Buddhist Era) or CE (Christian Era)\n      const useBE = locale.startsWith('th') && !locale.includes('-CE');\n      const baseLocale = locale.split('-')[0]; // Extract base locale (th, en, etc.)\n\n      const year = d.getFullYear();\n      const displayYear = useBE ? year + 543 : year;\n      const month = d.getMonth();\n\n      // Month names\n      const monthNamesTh = [\n        'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',\n        'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'\n      ];\n      const monthNamesThShort = [\n        'ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.',\n        'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'\n      ];\n      const monthNamesEn = [\n        'January', 'February', 'March', 'April', 'May', 'June',\n        'July', 'August', 'September', 'October', 'November', 'December'\n      ];\n      const monthNamesEnShort = [\n        'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n      ];\n\n      const monthFull = baseLocale === 'th' ? monthNamesTh[month] : monthNamesEn[month];\n      const monthShort = baseLocale === 'th' ? monthNamesThShort[month] : monthNamesEnShort[month];\n\n      const tokens = {\n        // Year (locale-based: BE for Thai, CE for others)\n        'YYYY': displayYear,\n        'YY': String(displayYear).slice(-2),\n        // Month\n        'MMMM': monthFull,\n        'MMM': monthShort,\n        'MM': String(month + 1).padStart(2, '0'),\n        'M': month + 1,\n        // Day\n        'DD': String(d.getDate()).padStart(2, '0'),\n        'D': d.getDate(),\n        // Time\n        'HH': String(d.getHours()).padStart(2, '0'),\n        'H': d.getHours(),\n        'hh': String(d.getHours() % 12 || 12).padStart(2, '0'),\n        'h': d.getHours() % 12 || 12,\n        'mm': String(d.getMinutes()).padStart(2, '0'),\n        'ss': String(d.getSeconds()).padStart(2, '0'),\n        'A': d.getHours() < 12 ? 'AM' : 'PM',\n        'a': d.getHours() < 12 ? 'am' : 'pm'\n      };\n\n      return format.replace(/YYYY|YY|MMMM|MMM|MM|M|DD|D|HH|H|hh|h|mm|ss|A|a/g, match => tokens[match]);\n    },\n\n    fromTimestamp(timestamp) {\n      return new Date(timestamp * 1000);\n    },\n\n    toTimestamp(date) {\n      return Math.floor(new Date(date).getTime() / 1000);\n    },\n\n    add(date, amount, unit) {\n      const d = new Date(date);\n      switch (unit) {\n        case 'years': d.setFullYear(d.getFullYear() + amount); break;\n        case 'months': d.setMonth(d.getMonth() + amount); break;\n        case 'days': d.setDate(d.getDate() + amount); break;\n        case 'hours': d.setHours(d.getHours() + amount); break;\n        case 'minutes': d.setMinutes(d.getMinutes() + amount); break;\n        case 'seconds': d.setSeconds(d.getSeconds() + amount); break;\n      }\n      return d;\n    },\n\n    moveDate(date, days) {\n      const d = new Date(date);\n      d.setDate(d.getDate() + days);\n      return d;\n    },\n\n    moveMonth(date, months) {\n      const d = new Date(date);\n      d.setMonth(d.getMonth() + months);\n      return d;\n    },\n\n    moveYear(date, years) {\n      const d = new Date(date);\n      d.setFullYear(d.getFullYear() + years);\n      return d;\n    },\n\n    timeToMinute(timeStr) {\n      const [hours, minutes] = timeStr.split(':').map(Number);\n      return hours * 60 + minutes;\n    },\n\n    timeToSecond(timeStr) {\n      const [hours, minutes, seconds] = timeStr.split(':').map(Number);\n      return hours * 3600 + minutes * 60 + (seconds || 0);\n    },\n\n    isLeapYear(year) {\n      return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);\n    },\n\n    daysInMonth(year, month) {\n      return new Date(year, month, 0).getDate();\n    },\n\n    compare(date1, date2) {\n      const d1 = new Date(date1);\n      const d2 = new Date(date2);\n      const diffTime = d1.getTime() - d2.getTime();\n      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n      const diffMonths = d1.getMonth() - d2.getMonth() + (12 * (d1.getFullYear() - d2.getFullYear()));\n      const diffYears = d1.getFullYear() - d2.getFullYear();\n      return {days: diffDays, months: diffMonths, years: diffYears};\n    },\n\n    /**\n     * Get locale with auto-detection from I18nManager\n     * @param {string|null} locale - Locale override or null for auto-detect\n     * @returns {string} Resolved locale code\n     */\n    getLocale(locale = null) {\n      if (locale) return locale;\n      const i18n = window.Now?.getManager?.('i18n') || window.I18nManager;\n      if (i18n?.getCurrentLocale) {\n        return i18n.getCurrentLocale();\n      }\n      const browserLang = navigator.language || navigator.userLanguage || 'en';\n      return browserLang.split('-')[0];\n    },\n\n    /**\n     * Get localized month names (full form)\n     * @param {string|null} locale - Locale code or null for auto-detect\n     * @returns {string[]} Array of 12 month names\n     */\n    getMonthNames(locale = null) {\n      const loc = this.getLocale(locale);\n      const baseLocale = loc.split('-')[0];\n\n      if (baseLocale === 'th') {\n        return [\n          'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',\n          'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'\n        ];\n      }\n      return [\n        'January', 'February', 'March', 'April', 'May', 'June',\n        'July', 'August', 'September', 'October', 'November', 'December'\n      ];\n    },\n\n    /**\n     * Get localized month names (short form)\n     * @param {string|null} locale - Locale code or null for auto-detect\n     * @returns {string[]} Array of 12 short month names\n     */\n    getMonthNamesShort(locale = null) {\n      const loc = this.getLocale(locale);\n      const baseLocale = loc.split('-')[0];\n\n      if (baseLocale === 'th') {\n        return [\n          'ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.',\n          'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'\n        ];\n      }\n      return [\n        'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n      ];\n    },\n\n    /**\n     * Get localized day names (short form)\n     * @param {string|null} locale - Locale code or null for auto-detect\n     * @returns {string[]} Array of 7 day names starting from Sunday\n     */\n    getDayNames(locale = null) {\n      const loc = this.getLocale(locale);\n      const baseLocale = loc.split('-')[0];\n\n      if (baseLocale === 'th') {\n        return ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'];\n      }\n      return ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    },\n\n    /**\n     * Get localized day names (narrow/single character)\n     * @param {string|null} locale - Locale code or null for auto-detect\n     * @returns {string[]} Array of 7 narrow day names starting from Sunday\n     */\n    getDayNamesNarrow(locale = null) {\n      const loc = this.getLocale(locale);\n      const baseLocale = loc.split('-')[0];\n\n      if (baseLocale === 'th') {\n        return ['อ', 'จ', 'อ', 'พ', 'พ', 'ศ', 'ส'];\n      }\n      return ['S', 'M', 'T', 'W', 'T', 'F', 'S'];\n    }\n  },\n\n  object: {\n    deepClone(obj) {\n      if (obj === null || typeof obj !== 'object') return obj;\n      if (Array.isArray(obj)) return obj.map(item => this.deepClone(item));\n      const clone = {};\n      for (let key in obj) {\n        clone[key] = this.deepClone(obj[key]);\n      }\n      return clone;\n    },\n\n    merge(target, ...sources) {\n      if (!sources.length) return target;\n      const source = sources.shift();\n\n      if (this.isObject(target) && this.isObject(source)) {\n        for (const key in source) {\n          if (this.isObject(source[key])) {\n            if (!target[key]) Object.assign(target, {[key]: {}});\n            this.merge(target[key], source[key]);\n          } else {\n            Object.assign(target, {[key]: source[key]});\n          }\n        }\n      }\n\n      return this.merge(target, ...sources);\n    },\n\n    isObject(item) {\n      return item && typeof item === 'object' && !Array.isArray(item);\n    },\n\n    get(obj, path, defaultValue = null) {\n      if (!obj || !path) {\n        console.warn('[Utils.object.get] Invalid parameters');\n        return defaultValue;\n      }\n      const travel = regexp =>\n        String.prototype.split\n          .call(path, regexp)\n          .filter(Boolean)\n          .reduce((res, key) => (res !== null && res !== undefined ? res[key] : res), obj);\n      const result = travel(/[,[\\]]+?/) || travel(/[,[\\].]+?/);\n      return result === undefined || result === obj ? defaultValue : result;\n    }\n  },\n\n  array: {\n    chunk(arr, size) {\n      if (!Array.isArray(arr)) throw new Error('[Utils.array.chunk] Input must be an array');\n      if (typeof size !== 'number' || size <= 0) throw new Error('[Utils.array.chunk] Size must be a positive number');\n      return Array.from(\n        {length: Math.ceil(arr.length / size)},\n        (v, i) => arr.slice(i * size, i * size + size)\n      );\n    },\n\n    unique(arr, key = null) {\n      if (!Array.isArray(arr)) throw new Error('[Utils.array.unique] Input must be an array');\n      if (!key) return [...new Set(arr)];\n      const seen = new Set();\n      return arr.filter(item => {\n        const k = key ? item[key] : item;\n        return seen.has(k) ? false : seen.add(k);\n      });\n    },\n\n    shuffle(arr) {\n      if (!Array.isArray(arr)) throw new Error('[Utils.array.shuffle] Input must be an array');\n      const result = [...arr];\n      for (let i = result.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [result[i], result[j]] = [result[j], result[i]];\n      }\n      return result;\n    },\n\n    groupBy(arr, key) {\n      return arr.reduce((grouped, item) => ({\n        ...grouped,\n        [item[key]]: [...(grouped[item[key]] || []), item]\n      }), {});\n    },\n\n    flatten(arr, depth = 1) {\n      if (!Array.isArray(arr)) throw new Error('[Utils.array.flatten] Input must be an array');\n      return arr.reduce((flat, item) =>\n        flat.concat(depth > 0 && Array.isArray(item) ? this.flatten(item, depth - 1) : item), []);\n    },\n\n    findBy(arr, key, value) {\n      if (!Array.isArray(arr)) throw new Error('[Utils.array.findBy] Input must be an array');\n      return arr.find(item => item[key] === value);\n    }\n  },\n\n  validate: {\n    email(email) {\n      return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n    },\n\n    url(url) {\n      try {\n        new URL(url);\n        return true;\n      } catch {\n        return false;\n      }\n    },\n\n    phone(phone) {\n      if (typeof phone !== 'string') return false;\n      const digitsOnly = phone.replace(/[^\\d]/g, '');\n      if (digitsOnly.length < 9 || digitsOnly.length > 15) return false;\n      return /^\\+?[\\d\\s().-]{10,}$/.test(phone);\n    },\n\n    password(password) {\n      const strength = {\n        0: \"Too weak\",\n        1: \"Weak\",\n        2: \"Medium\",\n        3: \"Strong\"\n      };\n\n      let score = 0;\n      if (password.length >= 8) score++;\n      if (/[A-Z]/.test(password) && /[a-z]/.test(password)) score++;\n      if (/[0-9]/.test(password)) score++;\n      if (/[^A-Za-z0-9]/.test(password)) score++;\n\n      return {\n        score,\n        label: strength[score],\n        isStrong: score >= 3\n      };\n    }\n  },\n\n  dom: {\n    create(tag, attributes = {}, children = []) {\n      const element = document.createElement(tag);\n      Object.entries(attributes).forEach(([key, value]) => {\n        if (key === 'className') {\n          element.className = value;\n        } else if (key === 'dataset') {\n          Object.entries(value).forEach(([dataKey, dataValue]) => {\n            element.dataset[dataKey] = dataValue;\n          });\n        } else {\n          element.setAttribute(key, value);\n        }\n      });\n      children.forEach(child => {\n        if (typeof child === 'string') {\n          element.appendChild(document.createTextNode(child));\n        } else {\n          element.appendChild(child);\n        }\n      });\n      return element;\n    },\n\n    toggleClass(element, ...classNames) {\n      classNames.forEach(className =>\n        element.classList.toggle(className)\n      );\n    },\n\n    closest(element, selector) {\n      return element.closest(selector);\n    },\n\n    isVisible(element) {\n      return !!(element.offsetWidth || element.offsetHeight || element.getClientRects().length);\n    },\n\n    /**\n     * Copy text to clipboard\n     * @param {string} text - Text to copy\n     * @returns {Promise<boolean>} - Returns true if successful, false otherwise\n     */\n    async copyToClipboard(text) {\n      if (typeof text !== 'string') {\n        console.error('[Utils.dom.copyToClipboard] Text must be a string');\n        return false;\n      }\n\n      // Modern Clipboard API (preferred method)\n      if (navigator.clipboard && window.isSecureContext) {\n        try {\n          await navigator.clipboard.writeText(text);\n          return true;\n        } catch (error) {\n          console.warn('[Utils.dom.copyToClipboard] Clipboard API failed, trying fallback:', error);\n        }\n      }\n\n      // Fallback method for older browsers or non-secure contexts\n      try {\n        const textArea = document.createElement('textarea');\n        textArea.value = text;\n        textArea.style.position = 'fixed';\n        textArea.style.left = '-999999px';\n        textArea.style.top = '-999999px';\n        textArea.setAttribute('aria-hidden', 'true');\n        document.body.appendChild(textArea);\n\n        textArea.focus();\n        textArea.select();\n\n        const successful = document.execCommand('copy');\n        document.body.removeChild(textArea);\n\n        if (successful) {\n          return true;\n        } else {\n          console.error('[Utils.dom.copyToClipboard] Fallback method failed');\n          return false;\n        }\n      } catch (error) {\n        console.error('[Utils.dom.copyToClipboard] Failed to copy text:', error);\n        return false;\n      }\n    }\n  },\n\n  browser: {\n    info() {\n      const ua = navigator.userAgent;\n      let tem;\n      let M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n\n      if (/trident/i.test(M[1])) {\n        tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\n        return {name: 'IE', version: tem[1] || ''};\n      }\n\n      if (M[1] === 'Chrome') {\n        tem = ua.match(/\\bOPR|Edge\\/(\\d+)/);\n        if (tem != null) {\n          return {name: 'Opera', version: tem[1]};\n        }\n      }\n\n      M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];\n      if ((tem = ua.match(/version\\/(\\d+)/i)) != null) {\n        M.splice(1, 1, tem[1]);\n      }\n\n      return {\n        name: M[0],\n        version: M[1]\n      };\n    },\n\n    isMobile() {\n      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n    },\n\n    orientation() {\n      return window.innerHeight > window.innerWidth ? 'portrait' : 'landscape';\n    }\n  },\n\n  session: {\n    set(key, value, ttl = null) {\n      const item = {\n        value: value,\n        timestamp: new Date().getTime()\n      };\n\n      if (ttl) {\n        item.expires = item.timestamp + (ttl * 1000);\n      }\n\n      try {\n        sessionStorage.setItem(key, JSON.stringify(item));\n      } catch (error) {\n        console.error(`[Utils.session.set] Error setting key ${key}:`, error);\n      }\n    },\n\n    get(key, defaultValue = null) {\n      try {\n        const item = sessionStorage.getItem(key);\n        if (!item) return defaultValue;\n\n        const parsed = JSON.parse(item);\n\n        if (parsed.expires && new Date().getTime() > parsed.expires) {\n          this.remove(key);\n          return defaultValue;\n        }\n\n        return parsed.value;\n      } catch (error) {\n        console.error(`[Utils.session.get] Error getting key ${key}:`, error);\n        return defaultValue;\n      }\n    },\n\n    remove(key) {\n      try {\n        sessionStorage.removeItem(key);\n      } catch (error) {\n        console.error(`[Utils.session.remove] Error removing key ${key}:`, error);\n      }\n    },\n\n    clear() {\n      try {\n        sessionStorage.clear();\n      } catch (error) {\n        console.error('[Utils.session.clear] Error clearing session:', error);\n      }\n    },\n\n    has(key) {\n      return sessionStorage.getItem(key) !== null;\n    },\n\n    size() {\n      return sessionStorage.length;\n    },\n\n    keys() {\n      return Object.keys(sessionStorage);\n    }\n  },\n\n  generateUUID() {\n    if (crypto && crypto.randomUUID) {\n      return crypto.randomUUID();\n    } else {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        const r = (Math.random() * 16) | 0;\n        const v = c === 'x' ? r : (r & 0x3) | 0x8;\n        return v.toString(16);\n      });\n    }\n  },\n\n  function: {\n    debounce(func, wait = 300) {\n      let timeout;\n      return function executedFunction(...args) {\n        const later = () => {\n          clearTimeout(timeout);\n          func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n      };\n    },\n\n    throttle(func, limit = 300) {\n      let inThrottle;\n      return function executedFunction(...args) {\n        if (!inThrottle) {\n          func(...args);\n          inThrottle = true;\n          setTimeout(() => inThrottle = false, limit);\n        }\n      };\n    },\n\n    debounceAsync(func, wait = 300) {\n      let timeout;\n      return function executedFunction(...args) {\n        return new Promise((resolve) => {\n          const later = async () => {\n            clearTimeout(timeout);\n            try {\n              const result = await func(...args);\n              resolve(result);\n            } catch (error) {\n              resolve(Promise.reject(error));\n            }\n          };\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n        });\n      };\n    }\n  },\n\n  cookie: {\n    set: function(name, value, options = {}) {\n      if (typeof name !== 'string' || typeof value !== 'string') {\n        throw new Error('[Utils.cookie.set] Name and value must be strings');\n      }\n\n      const defaultOptions = {\n        days: 7,\n        path: '/',\n        domain: '',\n        secure: true,\n        sameSite: 'Strict'\n      };\n      const opts = {...defaultOptions, ...options};\n\n      // Build cookie string\n      let cookieStr = `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;\n      if (typeof opts.days === 'number' && opts.days !== 0) {\n        const d = new Date();\n        d.setTime(d.getTime() + (opts.days * 24 * 60 * 60 * 1000));\n        cookieStr += `;expires=${d.toUTCString()}`;\n      }\n      if (opts.path) cookieStr += `;path=${opts.path}`;\n      if (opts.domain) cookieStr += `;domain=${opts.domain}`;\n      if (opts.secure) cookieStr += ';secure';\n      if (opts.sameSite) cookieStr += `;samesite=${opts.sameSite}`;\n\n      try {\n        document.cookie = cookieStr;\n      } catch (error) {\n        console.error(`[Utils.cookie.set] Failed to set cookie ${name}:`, error);\n      }\n    },\n\n    get: function(name) {\n      if (typeof name !== 'string') {\n        throw new Error('[Utils.cookie.get] Name must be a string');\n      }\n\n      const escapedName = name.replace(/([.*+?^${}()|[\\]\\\\])/g, '\\\\$1');\n      const regex = new RegExp(`(?:^|;)\\\\s*${escapedName}=([^;]*)`);\n      const match = document.cookie.match(regex);\n      return match ? decodeURIComponent(match[1]) : null;\n    },\n\n    remove: function(name, options = {}) {\n      if (typeof name !== 'string') {\n        throw new Error('[Utils.cookie.remove] Name must be a string');\n      }\n\n      const removeOptions = {\n        days: -1,\n        path: options.path || '/',\n        domain: options.domain || ''\n      };\n      this.set(name, '', removeOptions);\n    },\n\n    isEnabled() {\n      try {\n        document.cookie = 'cookietest=1';\n        const result = document.cookie.indexOf('cookietest=') !== -1;\n        document.cookie = 'cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT';\n        return result;\n      } catch (e) {\n        return false;\n      }\n    }\n  },\n\n  url: {\n    getQueryParams(url) {\n      const params = {};\n      new URL(url).searchParams.forEach((value, key) => {\n        params[key] = value;\n      });\n      return params;\n    },\n\n    addQueryParams(url, params) {\n      const urlObj = new URL(url);\n      Object.entries(params).forEach(([key, value]) => {\n        urlObj.searchParams.append(key, value);\n      });\n      return urlObj.toString();\n    }\n  },\n\n  path: {\n    join(...parts) {\n      return parts\n        .map(part => part.replace(/^\\/+|\\/+$/g, ''))\n        .filter(part => part.length > 0)\n        .join('/');\n    },\n\n    normalize(path) {\n      return path.replace(/\\/+/g, '/');\n    },\n\n    basename(path) {\n      return path.split('/').pop();\n    },\n\n    dirname(path) {\n      return path.split('/').slice(0, -1).join('/');\n    },\n\n    extname(path) {\n      const basename = this.basename(path);\n      const lastDotIndex = basename.lastIndexOf('.');\n      return lastDotIndex === -1 ? '' : basename.slice(lastDotIndex);\n    }\n  },\n\n  keyboard: {\n    isKey(event, key, modifiers = {}) {\n      if (event.key !== key) return false;\n\n      if (modifiers.shift !== undefined && event.shiftKey !== modifiers.shift) return false;\n      if (modifiers.ctrl !== undefined && event.ctrlKey !== modifiers.ctrl) return false;\n      if (modifiers.alt !== undefined && event.altKey !== modifiers.alt) return false;\n      if (modifiers.meta !== undefined && event.metaKey !== modifiers.meta) return false;\n\n      return true;\n    },\n    isEnter: (e) => e.key === 'Enter',\n    isShiftEnter: (e) => e.key === 'Enter' && e.shiftKey,\n    isCtrlEnter: (e) => e.key === 'Enter' && e.ctrlKey,\n    isEscape: (e) => e.key === 'Escape',\n    isTab: (e) => e.key === 'Tab',\n    isShiftTab: (e) => e.key === 'Tab' && e.shiftKey,\n    isArrow: (e) => ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)\n  }\n};\n\nwindow.Utils = Utils;\n","const NotificationManager = {\n  config: {\n    position: 'top-right',    // top-right, top-left, bottom-right, bottom-left\n    duration: 3000,\n    maxVisible: 5,\n    animation: true,\n    dismissible: true,\n    rtl: document.dir === 'rtl',\n    progressBar: false,\n    pauseOnHover: false,\n    closeButton: true,\n    icons: true,\n    aria: true\n  },\n\n  state: {\n    notifications: new Set(),\n    queue: [],\n    isProcessing: false,\n    container: null,\n    initialized: false\n  },\n\n  async init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n    this.createContainer();\n    this.setupEventListeners();\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  createContainer() {\n    const container = document.createElement('div');\n    container.className = `notification-container notification-${this.config.position}`;\n    if (this.config.rtl) {\n      container.setAttribute('dir', 'rtl');\n    }\n    if (this.config.aria) {\n      container.setAttribute('role', 'alert');\n      container.setAttribute('aria-live', 'polite');\n    }\n    document.body.appendChild(container);\n    this.state.container = container;\n  },\n\n  setPosition(position) {\n    const validPositions = ['top-right', 'top-left', 'bottom-right', 'bottom-left'];\n    if (!validPositions.includes(position)) {\n      console.warn(`Invalid position: ${position}. Valid positions are: ${validPositions.join(', ')}`);\n      return;\n    }\n\n    this.config.position = position;\n\n    if (this.state.container) {\n      // Remove all position classes\n      validPositions.forEach(pos => {\n        this.state.container.classList.remove(`notification-${pos}`);\n      });\n      // Add new position class\n      this.state.container.classList.add(`notification-${position}`);\n    } else {\n      this.createContainer();\n    }\n  },\n\n  show(options = {}) {\n    // Auto-init if not initialized or container was destroyed\n    if (!this.state.initialized || !this.state.container) {\n      this.state.initialized = false;\n      this.init();\n    }\n\n    const notification = this.createNotification(options);\n\n    // Auto-dismiss existing notifications of the same type to prevent overflow\n    if (notification.type && notification.type !== 'loading') {\n      const existingOfSameType = Array.from(this.state.notifications)\n        .filter(n => n.type === notification.type);\n\n      if (existingOfSameType.length > 0) {\n        // Dismiss existing notifications with animation\n        existingOfSameType.forEach(n => {\n          this.dismiss(n.id);\n        });\n      }\n    }\n\n    if (this.state.notifications.size >= this.config.maxVisible) {\n      this.state.queue.push(notification);\n      return notification.id;\n    }\n\n    this.renderNotification(notification);\n    return notification.id;\n  },\n\n  createNotification(options) {\n    if (typeof options === 'string') {\n      options = {message: options};\n    }\n\n    // Translate message if I18nManager is available\n    if (options.message && window.I18nManager?.translate) {\n      options.message = I18nManager.translate(options.message);\n    }\n\n    return {\n      id: Utils.generateUUID(),\n      type: 'info',\n      duration: this.config.duration,\n      dismissible: this.config.dismissible,\n      animation: this.config.animation,\n      progressBar: this.config.progressBar,\n      timestamp: Date.now(),\n      ...options\n    };\n  },\n\n  renderNotification(notification) {\n    const element = document.createElement('div');\n    element.className = `notification notification-${notification.type}`;\n    element.id = notification.id;\n\n    const content = document.createElement('div');\n    content.className = 'notification-content';\n\n    const message = document.createElement('div');\n    let messageClass = 'notification-message';\n    if (this.config.icons && notification.icon) {\n      messageClass += ` icon-${notification.icon}`;\n    }\n    message.className = messageClass;\n    message.textContent = notification.message;\n    content.appendChild(message);\n\n    if (notification.dismissible && this.config.closeButton) {\n      const closeBtn = document.createElement('button');\n      closeBtn.className = 'btn-close';\n      closeBtn.onclick = () => this.dismiss(notification.id);\n      content.appendChild(closeBtn);\n    }\n\n    element.appendChild(content);\n\n    if (notification.progressBar && notification.duration > 0) {\n      this.addProgressBar(element, notification);\n    }\n\n    // Container should always exist due to auto-init in show()\n    // But add safety check just in case\n    if (!this.state.container) {\n      this.createContainer();\n    }\n    this.state.container.appendChild(element);\n    this.state.notifications.add(notification);\n\n    requestAnimationFrame(() => {\n      element.classList.add('notification-show');\n    });\n\n    if (notification.duration > 0) {\n      this.setupAutoDismiss(notification);\n    }\n  },\n\n  addProgressBar(element, notification) {\n    const progress = document.createElement('div');\n    progress.className = 'notification-progress';\n    const progressBar = document.createElement('div');\n    progressBar.className = 'notification-progress-bar';\n    progress.appendChild(progressBar);\n    element.appendChild(progress);\n\n    notification.progressBar = {\n      element: progressBar,\n      startTime: Date.now(),\n      duration: notification.duration,\n      paused: false\n    };\n\n    requestAnimationFrame(() => {\n      progressBar.style.width = '0%';\n      progressBar.style.transition = `width ${notification.duration}ms linear`;\n    });\n  },\n\n  setupAutoDismiss(notification) {\n    let timeLeft = notification.duration;\n    let lastUpdate = Date.now();\n\n    const checkDismiss = () => {\n      if (notification.progressBar?.paused) {\n        lastUpdate = Date.now();\n        requestAnimationFrame(checkDismiss);\n        return;\n      }\n\n      const now = Date.now();\n      timeLeft -= (now - lastUpdate);\n      lastUpdate = now;\n\n      if (timeLeft <= 0) {\n        this.dismiss(notification.id);\n      } else {\n        requestAnimationFrame(checkDismiss);\n      }\n    };\n\n    requestAnimationFrame(checkDismiss);\n  },\n\n  dismiss(id) {\n    const notification = Array.from(this.state.notifications)\n      .find(n => n.id === id);\n\n    if (!notification) return;\n\n    const element = document.getElementById(id);\n    if (!element) return;\n\n    element.classList.remove('notification-show');\n    element.classList.add('notification-hide');\n\n    let removed = false;\n    const cleanUp = () => {\n      if (removed) return;\n      removed = true;\n      try {element.remove();} catch (e) {}\n      this.state.notifications.delete(notification);\n      this.processQueue();\n    };\n\n    element.addEventListener('transitionend', () => {\n      cleanUp();\n    }, {once: true});\n\n    window.setTimeout(() => cleanUp(), 3000);\n  },\n\n  processQueue() {\n    if (this.state.isProcessing || this.state.queue.length === 0) return;\n\n    this.state.isProcessing = true;\n    const notification = this.state.queue.shift();\n\n    this.renderNotification(notification);\n    this.state.isProcessing = false;\n\n    if (this.state.queue.length > 0) {\n      this.processQueue();\n    }\n  },\n\n  setupEventListeners() {\n    if (this.config.pauseOnHover) {\n      this.state.container.addEventListener('mouseenter', (e) => {\n        const notification = e.target.closest('.notification');\n        if (notification) {\n          const id = notification.id;\n          const notificationObj = Array.from(this.state.notifications)\n            .find(n => n.id === id);\n          if (notificationObj?.progressBar) {\n            notificationObj.progressBar.paused = true;\n          }\n        }\n      });\n\n      this.state.container.addEventListener('mouseleave', (e) => {\n        const notification = e.target.closest('.notification');\n        if (notification) {\n          const id = notification.id;\n          const notificationObj = Array.from(this.state.notifications)\n            .find(n => n.id === id);\n          if (notificationObj?.progressBar) {\n            notificationObj.progressBar.paused = false;\n          }\n        }\n      });\n    }\n\n    window.addEventListener('beforeunload', () => {\n      this.destroy();\n    });\n\n    // Note: Removed visibilitychange listener that was destroying container\n    // when tab became hidden, which caused position issues when tab was restored\n  },\n\n  // Utility methods for different notification types\n  success(message, options = {}) {\n    return this.show({\n      type: 'success',\n      message,\n      icon: 'valid',\n      ...options\n    });\n  },\n\n  error(message, options = {}) {\n    return this.show({\n      type: 'error',\n      message,\n      icon: 'ban',\n      duration: 8000,\n      ...options\n    });\n  },\n\n  warning(message, options = {}) {\n    return this.show({\n      type: 'warning',\n      message,\n      icon: 'warning',\n      duration: 8000,\n      ...options\n    });\n  },\n\n  info(message, options = {}) {\n    return this.show({\n      type: 'info',\n      message,\n      icon: 'info',\n      ...options\n    });\n  },\n\n  loading(message, options = {}) {\n    return this.show({\n      type: 'loading',\n      message,\n      icon: 'loader',\n      duration: 0,\n      dismissible: false,\n      progressBar: false,\n      ...options\n    });\n  },\n\n  clear() {\n    Array.from(this.state.notifications).forEach(notification => {\n      this.dismiss(notification.id);\n    });\n    this.state.queue = [];\n  },\n\n  destroy() {\n    this.clear();\n    if (this.state.container) {\n      this.state.container.remove();\n      this.state.container = null;\n    }\n    // Reset initialized flag so init() can be called again\n    this.state.initialized = false;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('notification', NotificationManager);\n}\n\n// Expose globally\nwindow.NotificationManager = NotificationManager;\n","const ErrorManager = {\n  config: {\n    debug: true,\n    notificationDuration: 5000\n  },\n\n  lastError: null,\n\n  init(options = {}) {\n    this.config = {...this.config, ...options};\n    return this;\n  },\n\n  createError(message, additional) {\n    if (!Array.isArray(additional)) {\n      additional = [];\n    }\n    additional.forEach((param, index) => {\n      if (param !== undefined && param !== null) {\n        message = message.replace(`{${index}}`, param.toString());\n      }\n    });\n\n    return new Error(message);\n  },\n\n  normalizeError(error) {\n    if (typeof error === 'string') {\n      return this.createError(error);\n    }\n    return error;\n  },\n\n  handle(error, options = {}) {\n    if (!error) {\n      throw new Error('Error parameter is required');\n    }\n\n    if (typeof options === 'string') {\n      options = {context: options};\n    }\n\n    let normalizedError;\n    if (error instanceof Error) {\n      normalizedError = error;\n    } else if (options.error && options.error instanceof Error) {\n      normalizedError = options.error;\n      normalizedError.message = error.toString();\n    } else {\n      normalizedError = new Error(error.toString());\n    }\n\n    this.lastError = normalizedError;\n\n    const {\n      context = '',\n      notify = false,\n      logLevel = 'error',\n      data = []\n    } = options;\n\n    const message = normalizedError.message;\n\n    if (this.config.debug || options.debug) {\n      if (this.config.debug) {\n        console[logLevel](normalizedError.stack, {\n          message,\n          context,\n          ...data,\n        });\n      } else {\n        console[logLevel](`[${context}] ${message}`);\n      }\n    }\n\n    if (notify && typeof window !== 'undefined' && window.NotificationManager) {\n      const level = NotificationManager[logLevel] ? logLevel : 'error';\n      NotificationManager[level](message, {\n        duration: this.config.notificationDuration\n      });\n    }\n\n    if (options.type) {\n      EventManager.emit(options.type, {\n        message,\n        context,\n        data\n      });\n    }\n\n    return normalizedError;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('error', ErrorManager);\n}\n\nwindow.ErrorManager = ErrorManager;\n","/**\n * ErrorRenderer - Renders formatted error pages\n * Used to display beautiful error pages with full functionality\n */\nclass ErrorRenderer {\n  /**\n   * Render application error\n   * @param {Error} error - Error object\n   * @param {Object} options - Rendering options\n   * @param {string} options.containerId - Container element ID (default: 'main')\n   * @param {string} options.title - Error title\n   * @param {string} options.message - Error message\n   * @param {boolean} options.showStack - Show stack trace (default: false)\n   * @param {Array} options.actions - Custom action buttons\n   */\n  static renderError(error, options = {}) {\n    const config = {\n      containerId: 'main',\n      title: 'Application Error',\n      message: 'The application failed to initialize. Please try again later.',\n      showStack: false,\n      showDetails: true,\n      actions: null,\n      ...options\n    };\n\n    const container = document.getElementById(config.containerId);\n    if (!container) {\n      console.error(`Container element #${config.containerId} not found`);\n      return;\n    }\n\n    const errorHtml = this.generateErrorHtml(error, config);\n    container.innerHTML = errorHtml;\n\n    // Add event listeners after rendering is complete\n    this.attachEventListeners(container, config);\n  }\n\n  /**\n   * Generate error HTML\n   * @private\n   */\n  static generateErrorHtml(error, config) {\n    const errorMessage = error?.message || 'Unknown error occurred';\n    const errorStack = error?.stack || '';\n    let button = '';\n    if (config.showStack && errorStack) {\n      button = `<div class=\"error-details-toggle\">\n                  <button type=\"button\" class=\"error-toggle-btn\" data-action=\"toggle-details\">\n                    <span class=\"toggle-text\">Show Details</span>\n                    <svg class=\"toggle-icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                      <polyline points=\"6 9 12 15 18 9\"></polyline>\n                    </svg>\n                  </button>\n                </div>`;\n    }\n\n    return `\n      <div class=\"error-container\">\n        <div class=\"error-card\">\n          <div class=\"error-icon\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"64\" height=\"64\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#fee2e2\" />\n              <path d=\"M12 8v5\" stroke=\"#ef4444\" stroke-width=\"2\" stroke-linecap=\"round\" />\n              <circle cx=\"12\" cy=\"16\" r=\"1\" fill=\"#ef4444\" />\n            </svg>\n          </div>\n          <h1 class=\"error-title\">${config.title}</h1>\n          <p class=\"error-message\">${config.message}</p>\n          <div class=\"error-details\">\n            <div class=\"error-code-heading\"><div>Error Message:</div>${button}</div>\n            <pre class=\"error-code\">${this.escapeHtml(errorMessage)}</pre>\n            <div class=\"error-details-content\" style=\"display: none;\">\n              ${config.showStack && errorStack ? `\n                <div class=\"error-code-heading\">Stack Trace:</div>\n                <pre class=\"error-code\">${this.escapeHtml(errorStack)}</pre>\n              ` : ''}\n            </div>\n          </div>\n          <div class=\"error-help\">\n            If the problem persists, please contact your system administrator or try clearing your browser cache.\n          </div>\n        </div>\n      </div>`;\n  }\n\n  /**\n   * Attach event listeners\n   * @private\n   */\n  static attachEventListeners(container, config) {\n    // Toggle details\n    const toggleBtn = container.querySelector('[data-action=\"toggle-details\"]');\n    if (toggleBtn) {\n      toggleBtn.addEventListener('click', () => {\n        const content = container.querySelector('.error-details-content');\n        const icon = toggleBtn.querySelector('.toggle-icon');\n        const text = toggleBtn.querySelector('.toggle-text');\n\n        if (content.style.display === 'none') {\n          content.style.display = 'block';\n          text.textContent = 'Hide Details';\n          icon.style.transform = 'rotate(180deg)';\n        } else {\n          content.style.display = 'none';\n          text.textContent = 'Show Details';\n          icon.style.transform = 'rotate(0deg)';\n        }\n      });\n    }\n\n    // Default actions\n    const reloadBtn = container.querySelector('[data-action=\"reload\"]');\n    if (reloadBtn) {\n      reloadBtn.addEventListener('click', () => window.location.reload());\n    }\n\n    const homeBtn = container.querySelector('[data-action=\"home\"]');\n    if (homeBtn) {\n      homeBtn.addEventListener('click', () => window.location.href = '/');\n    }\n\n    // Custom actions\n    const customBtns = container.querySelectorAll('[data-action]:not([data-action=\"reload\"]):not([data-action=\"home\"]):not([data-action=\"toggle-details\"])');\n    customBtns.forEach(btn => {\n      const action = btn.dataset.action;\n      if (config.customHandlers && config.customHandlers[action]) {\n        btn.addEventListener('click', config.customHandlers[action]);\n      }\n    });\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   * @private\n   */\n  static escapeHtml(unsafe) {\n    if (typeof unsafe !== 'string') return '';\n\n    return unsafe\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&#039;\");\n  }\n\n  /**\n   * Render 404 error\n   */\n  static render404(options = {}) {\n    return this.renderError(new Error('Page not found'), {\n      title: '404 - Page Not Found',\n      message: \"The page you're looking for doesn't exist.\",\n      showDetails: false,\n      ...options\n    });\n  }\n\n  /**\n   * Render network error\n   */\n  static renderNetworkError(options = {}) {\n    return this.renderError(new Error('Network connection failed'), {\n      title: 'Connection Error',\n      message: 'Unable to connect to the server. Please check your internet connection.',\n      actions: [\n        {\n          text: 'Try Again',\n          type: 'primary',\n          action: 'retry'\n        },\n        {\n          text: 'Go Home',\n          type: 'secondary',\n          action: 'home'\n        }\n      ],\n      customHandlers: {\n        retry: () => window.location.reload()\n      },\n      ...options\n    });\n  }\n\n  /**\n   * Render authentication error\n   */\n  static renderAuthError(options = {}) {\n    return this.renderError(new Error('Authentication failed'), {\n      title: 'Authentication Required',\n      message: 'You need to log in to access this page.',\n      showDetails: false,\n      actions: [\n        {\n          text: 'Go to Login',\n          type: 'primary',\n          action: 'login'\n        }\n      ],\n      customHandlers: {\n        login: () => window.location.href = '/login'\n      },\n      ...options\n    });\n  }\n}\n\n// Export for module use\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = ErrorRenderer;\n}\n\n// Expose globally\nwindow.ErrorRenderer = ErrorRenderer;","const I18nManager = {\n  config: {\n    enabled: false,\n    defaultLocale: 'en',\n    availableLocales: ['en'],\n    storageKey: 'app_lang',\n    useBrowserLocale: true,\n    noTranslateEnglish: true\n  },\n\n  state: {\n    current: null,\n    initialized: false,\n    translations: new Map()\n  },\n\n  /**\n   * Configuration options:\n   * - enabled: Whether the i18n system is active\n   * - defaultLocale: The default language code to use\n   * - availableLocales: List of supported language codes\n   * - storageKey: localStorage key to save the selected language\n   * - useBrowserLocale: Whether to use the browser's language as default\n   * - noTranslateEnglish: When true, English translations will not be translated\n   *   as the current locale will be used directly without translation lookup.\n   *   This is useful for multilingual applications where some content may already\n   *   be in the target language and doesn't need translation.\n   */\n\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    if (!this.config.enabled) {\n      this.state.disabled = true;\n      return this;\n    }\n\n    await this.loadInitialLocale();\n\n    this.state.initialized = true;\n\n    EventManager.emit('i18n:initialized');\n\n    return this;\n  },\n\n  async setLocale(locale, force = false) {\n    try {\n      if (!this.config.enabled) return;\n\n      if (!this.config.availableLocales.includes(locale)) {\n        throw new Error(`Unsupported locale: ${locale}`);\n      }\n\n      if (locale === this.state.current && !force) {\n        return;\n      }\n\n      // Try to load translations, but don't fail if file doesn't exist\n      // This allows using data-i18n as fallback for languages without translation files\n      if ((!this.config.noTranslateEnglish || locale !== 'en') && !this.state.translations.has(locale)) {\n        try {\n          await this.loadTranslations(locale);\n        } catch (error) {\n          // If translation file doesn't exist, that's okay - we'll use data-i18n as fallback\n        }\n      }\n\n      this.state.current = locale;\n      document.documentElement.setAttribute('lang', locale);\n\n      this.setStoredLocale(locale);\n\n      window.setTimeout(() => {\n        this.updateTranslations();\n      }, 100);\n\n      EventManager.emit('locale:changed', {\n        locale,\n        forced: force\n      });\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'I18nManager.setLocale',\n        type: 'error:i18n',\n        data: {locale, force},\n        notify: true\n      });\n    }\n  },\n\n  getCurrentLocale() {\n    return this.state.current;\n  },\n\n  async loadTranslations(locale, retries = 2) {\n    const url = `${Now.resolvePath(locale, 'translations')}.json`;\n\n    for (let attempt = 0; attempt <= retries; attempt++) {\n      try {\n        // Use native fetch for reliability\n        const response = await fetch(url, {\n          method: 'GET',\n          headers: {\n            'Accept': 'application/json',\n            'Cache-Control': 'no-cache'\n          },\n          credentials: 'same-origin'\n        });\n\n        // Check HTTP status\n        if (!response.ok) {\n          if (response.status === 404) {\n            // Translation file not found - this is acceptable\n            console.warn(`Translation file not found for locale: ${locale}`);\n\n            // Emit event even for 404 so components know to render with fallback\n            EventManager.emit('i18n:loaded', {\n              locale,\n              success: false,\n              reason: '404'\n            });\n            return;\n          }\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        // Parse JSON\n        const translations = await response.json();\n\n        // Validate response structure\n        if (!translations || typeof translations !== 'object') {\n          throw new Error('Invalid translation format: expected object');\n        }\n\n        // Store translations\n        this.state.translations.set(locale, translations);\n\n        // Emit event that translations loaded successfully\n        EventManager.emit('i18n:loaded', {\n          locale,\n          success: true,\n          translationCount: Object.keys(translations).length\n        });\n\n        // Success - exit retry loop\n        return;\n\n      } catch (error) {\n        const isLastAttempt = attempt === retries;\n\n        // Don't retry on 404 or JSON parse errors\n        if (error.name === 'SyntaxError' || error.message.includes('404')) {\n          throw error;\n        }\n\n        if (isLastAttempt) {\n          // Final attempt failed\n          ErrorManager.handle(error, {\n            context: 'I18nManager.loadTranslations',\n            type: 'error:i18n',\n            data: {\n              locale,\n              url,\n              attempts: attempt + 1,\n              errorType: error.name,\n              errorMessage: error.message\n            },\n            notify: true\n          });\n          throw new Error(`Failed to load translations for ${locale} after ${attempt + 1} attempts: ${error.message}`);\n        }\n\n        // Wait before retry with exponential backoff\n        const delay = Math.min(1000 * Math.pow(2, attempt), 3000);\n        console.warn(`Translation load failed (attempt ${attempt + 1}/${retries + 1}), retrying in ${delay}ms...`, error);\n        await new Promise(resolve => setTimeout(resolve, delay));\n      }\n    }\n  },\n\n  updateTranslations() {\n    const translations = this.state.translations.get(this.state.current);\n\n    // Translate elements with data-i18n\n    const elements = document.querySelectorAll('[data-i18n]');\n    elements.forEach(element => {\n      const dataI18n = element.getAttribute('data-i18n')?.trim();\n      const key = dataI18n ? dataI18n.trim() : element.textContent.trim();\n      if (!key) return;\n\n      let translation;\n      if (!translations) {\n        translation = this.interpolate(key, {}, {});\n      } else {\n        translation = this.getTranslation(key, translations);\n        if (!translation || translation === key) {\n          translation = this.interpolate(key, {}, translations);\n        }\n      }\n\n      element.textContent = translation;\n      if (!dataI18n) {\n        element.setAttribute('data-i18n', key);\n      }\n    });\n\n    // Translate placeholder and title attributes containing {LNG_xxx}\n    this.translateAttributes();\n\n    // Emit event to notify components that translations have been applied\n    EventManager.emit('i18n:updated', {\n      locale: this.state.current,\n      elementsUpdated: elements.length\n    });\n  },\n\n  translateAttributes() {\n    this.translateAttributesIn(document);\n  },\n\n  getTranslation(key, translations, params = {}) {\n    let value;\n\n    // If key contains spaces, it's a plain text key, not a nested path\n    // So we should look it up directly without splitting by '.'\n    if (key.includes(' ')) {\n      value = translations[key];\n    } else {\n      value = key.split('.').reduce((obj, k) => obj?.[k], translations);\n    }\n\n    if (!value) {\n      value = key;\n    }\n\n    return this.interpolate(value, params, translations);\n  },\n\n  async loadInitialLocale() {\n    let locale = this.config.defaultLocale;\n\n    const htmlLang = document.documentElement.getAttribute('lang');\n    if (htmlLang && this.config.availableLocales.includes(htmlLang)) {\n      locale = htmlLang;\n    } else {\n      const stored = this.getStoredLocale();\n      if (stored && this.config.availableLocales.includes(stored)) {\n        locale = stored;\n      } else if (this.config.useBrowserLocale) {\n        const browserLocale = navigator.language.split('-')[0];\n        if (this.config.availableLocales.includes(browserLocale)) {\n          locale = browserLocale;\n        }\n      }\n    }\n\n    await this.setLocale(locale);\n  },\n\n  /**\n   * Update translations for specific elements\n   */\n  async updateElements(container = document) {\n    if (!this.config.enabled || !this.state.initialized) {\n      return;\n    }\n\n    const translations = this.state.translations.get(this.state.current);\n\n    const elements = container.querySelectorAll('[data-i18n]');\n    elements.forEach(element => {\n      const dataI18n = element.getAttribute('data-i18n')?.trim();\n      const key = dataI18n ? dataI18n.trim() : element.textContent.trim();\n      if (!key) return;\n\n      let translation;\n      if (!translations) {\n        translation = this.interpolate(key, {}, {});\n      } else {\n        translation = this.getTranslation(key, translations);\n        if (!translation || translation === key) {\n          translation = this.interpolate(key, {}, translations);\n        }\n      }\n\n      element.textContent = translation;\n      if (!dataI18n) {\n        element.setAttribute('data-i18n', key);\n      }\n    });\n\n    // Translate placeholder and title attributes in container\n    this.translateAttributesIn(container);\n\n    // Emit event for debugging/monitoring\n    EventManager.emit('i18n:elements:updated', {\n      container,\n      elementsUpdated: elements.length,\n      locale: this.state.current\n    });\n  },\n\n  translateAttributesIn(container) {\n    const translations = this.state.translations.get(this.state.current) || {};\n    const lngPattern = /\\{LNG_[^}]+\\}/;\n    const attrs = ['placeholder', 'title', 'alt', 'aria-label', 'aria-placeholder', 'label'];\n    const selector = attrs.map(a => `[${a}]`).join(', ');\n\n    container.querySelectorAll(selector).forEach(element => {\n      attrs.forEach(attr => {\n        const value = element.getAttribute(attr);\n        if (value && lngPattern.test(value)) {\n          element.setAttribute(attr, this.interpolate(value, {}, translations));\n        }\n      });\n    });\n  },\n\n  translate(key, params = {}, locale = null) {\n    if (typeof key !== 'string') return key;\n\n    const currentLocale = locale || this.getCurrentLocale();\n    if (currentLocale === 'en' && this.config.noTranslateEnglish) return key;\n\n    const translations = this.state.translations.get(currentLocale);\n\n    if (!translations) {\n      return this.getFallbackTranslation(key, params);\n    }\n\n    return this.getTranslation(key, translations, params);\n  },\n\n  getFallbackTranslation(key, params) {\n    if (!params || Object.keys(params).length === 0) {\n      return key;\n    }\n\n    if (this.state.current !== this.config.defaultLocale) {\n      const defaultTranslations = this.state.translations.get(this.config.defaultLocale);\n      if (defaultTranslations) {\n        // If key contains spaces, look it up directly\n        const value = key.includes(' ')\n          ? defaultTranslations[key]\n          : key.split('.').reduce((obj, k) => obj?.[k], defaultTranslations);\n        if (value) {\n          return this.interpolate(value, params);\n        }\n      }\n    }\n\n    return this.interpolate(key, params);\n  },\n\n  interpolate(text, params, translations) {\n    const trans = translations || this.getTranslations();\n\n    // Handle {LNG_xxx} pattern first\n    let result = text.replace(/\\{LNG_([^}]+)\\}/g, (match, key) => {\n      return trans[key] ?? key;\n    });\n\n    // Handle {xxx} pattern (existing behavior)\n    result = result.replace(/\\{([^}]+)\\}/g, (match, key) => {\n      if (params[key] !== undefined) {\n        return params[key];\n      }\n      if (trans[key]) {\n        return trans[key];\n      }\n      return key;\n    });\n\n    return result;\n  },\n\n  getTranslator(locale) {\n    return (key, params = {}) => this.translate(key, params, locale);\n  },\n\n  getTranslations(locale = null) {\n    const targetLocale = locale || this.getCurrentLocale();\n    return this.state.translations.get(targetLocale) || {};\n  },\n\n  getKeyTranslations(key) {\n    const translations = {};\n    this.state.translations.forEach((value, locale) => {\n      // If key contains spaces, look it up directly\n      const translation = key.includes(' ')\n        ? value[key]\n        : key.split('.').reduce((obj, k) => obj?.[k], value);\n      if (translation) {\n        translations[locale] = translation;\n      }\n    });\n    return translations;\n  },\n\n  hasTranslation(key, locale = null) {\n    const translations = this.getTranslations(locale);\n    // If key contains spaces, look it up directly\n    if (key.includes(' ')) {\n      return translations[key] !== undefined;\n    }\n    return key.split('.').reduce((obj, k) => obj?.[k], translations) !== undefined;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('i18n', I18nManager);\n}\n\nwindow.I18nManager = I18nManager;\n\n// LocalStorage helpers (safe)\nI18nManager.getStoredLocale = function() {\n  if (!this.config.storageKey) return null;\n  try {\n    return localStorage.getItem(this.config.storageKey);\n  } catch (e) {\n    console.warn('I18nManager: Unable to read from localStorage', e);\n    return null;\n  }\n};\n\nI18nManager.setStoredLocale = function(locale) {\n  if (!this.config.storageKey) return;\n  try {\n    localStorage.setItem(this.config.storageKey, locale);\n  } catch (e) {\n    console.warn('I18nManager: Unable to write to localStorage', e);\n  }\n};\n\n// Component: lang-toggle\n// Provides an easy declarative language switcher. Usage:\n// <button data-component=\"lang-toggle\" data-locales=\"en,th\" data-theme-map=\"en:light,th:dark\">EN</button>\n(() => {\n  const registerLangToggle = () => {\n    if (I18nManager._langToggleRegistered) return true;\n\n    const compManager = (Now.getManager ? Now.getManager('component') : null) || window.ComponentManager;\n    if (!compManager || typeof compManager.define !== 'function') return false;\n\n    compManager.define('lang-toggle', {\n      mounted() {\n        const el = this.element;\n\n        // Determine locales (attribute or i18n config availableLocales)\n        const i18n = Now.getManager ? Now.getManager('i18n') : null;\n        const avail = (i18n && i18n.config && Array.isArray(i18n.config.availableLocales))\n          ? i18n.config.availableLocales : ['en'];\n\n        const localesAttr = (el.getAttribute('data-locales') || avail.join(',')).trim();\n        let locales = localesAttr.split(',').map(s => s.trim()).filter(Boolean);\n\n        // Optional theme map: 'en:light,th:dark'\n        const themeMapAttr = el.getAttribute('data-theme-map') || '';\n        const themeMap = {};\n        themeMapAttr.split(',').map(p => p.trim()).forEach(pair => {\n          if (!pair) return;\n          const [k, v] = pair.split(':').map(s => s.trim());\n          if (k && v) themeMap[k] = v;\n        });\n\n        const labelEl = el.querySelector('[data-lang-label]') || el.querySelector('span');\n        const menuEl = el.querySelector('ul');\n        const menuItems = menuEl ? Array.from(menuEl.querySelectorAll('a')) : [];\n\n        // If menu anchors provided, use them to derive locales\n        const menuLocales = menuItems\n          .map(a => (a.getAttribute('data-locale') || a.textContent || '').trim())\n          .filter(Boolean);\n        if (menuLocales.length) {\n          locales = menuLocales;\n        }\n\n        const updateLabel = () => {\n          try {\n            const cur = (i18n && typeof i18n.getCurrentLocale === 'function') ? i18n.getCurrentLocale() : document.documentElement.lang || locales[0];\n            const display = (cur || locales[0] || '').toUpperCase();\n            if (labelEl) {\n              labelEl.textContent = display;\n              labelEl.setAttribute('aria-label', `Language: ${cur}`);\n            } else {\n              el.setAttribute('data-lang', display);\n            }\n\n            // Mark active item in menu\n            menuItems.forEach(a => {\n              const l = (a.getAttribute('data-locale') || a.textContent || '').trim();\n              const isActive = l === cur;\n              if (isActive) {\n                a.classList.add('active');\n                a.setAttribute('aria-current', 'true');\n              } else {\n                a.classList.remove('active');\n                a.removeAttribute('aria-current');\n              }\n            });\n          } catch (e) { /* ignore */}\n        };\n\n        const clickHandler = (event) => {\n          const link = event.target.closest('a');\n          if (link) {\n            event.preventDefault();\n            const next = (link.getAttribute('data-locale') || link.textContent || '').trim();\n            if (i18n && typeof i18n.setLocale === 'function' && next) {\n              i18n.setLocale(next);\n              // Apply theme mapping if configured and ThemeManager available\n              try {\n                const themeMgr = Now.getManager ? Now.getManager('theme') : null;\n                if (themeMgr && typeof themeMgr.setTheme === 'function' && themeMap[next]) {\n                  themeMgr.setTheme(themeMap[next]);\n                }\n              } catch (err) { /* ignore */}\n            }\n            return;\n          }\n\n          // Fallback: cycle locales when clicking button body\n          if (!i18n || typeof i18n.setLocale !== 'function') return;\n          const cur = i18n.getCurrentLocale() || locales[0];\n          const idx = locales.indexOf(cur);\n          const nextLocale = locales[(idx + 1) % locales.length] || locales[0];\n          i18n.setLocale(nextLocale);\n          try {\n            const themeMgr = Now.getManager ? Now.getManager('theme') : null;\n            if (themeMgr && typeof themeMgr.setTheme === 'function' && themeMap[nextLocale]) {\n              themeMgr.setTheme(themeMap[nextLocale]);\n            }\n          } catch (err) { /* ignore */}\n        };\n\n        // Register listeners\n        el.__langToggleClick = clickHandler;\n        el.addEventListener('click', clickHandler);\n\n        // Update on locale change\n        el.__langToggleUpdate = updateLabel;\n        try {\n          EventManager.on('locale:changed', updateLabel);\n        } catch (e) {\n          // best-effort\n        }\n\n        // Initial label\n        updateLabel();\n      },\n      destroyed() {\n        const el = this.element;\n        try {\n          if (el.__langToggleClick) el.removeEventListener('click', el.__langToggleClick);\n        } catch (e) {}\n        try {\n          if (el.__langToggleUpdate) EventManager.off && EventManager.off('locale:changed', el.__langToggleUpdate);\n        } catch (e) {}\n      }\n    });\n\n    I18nManager._langToggleRegistered = true;\n    return true;\n  };\n\n  // Try immediate registration; if ComponentManager isn't ready yet, retry after DOM ready\n  if (!registerLangToggle()) {\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', registerLangToggle, {once: true});\n    } else {\n      setTimeout(registerLangToggle, 0);\n    }\n  }\n})();\n","const BackdropManager = {\n  config: {\n    baseZIndex: 990,\n    animation: true,\n    duration: 200,\n    className: 'backdrop',\n    background: 'rgba(0,0,0,0.5)',\n    opacity: 0.5,\n    useTransition: true,\n    preventScroll: true,\n    debug: false\n  },\n\n  state: {\n    backdrops: new Map(),\n    activeBackdrops: [],\n    nextId: 1,\n    isInitialized: false\n  },\n\n  async init(options = {}) {\n    if (this.state.isInitialized) return this;\n\n    this.config = {...this.config, ...options};\n    this.handleKeydown = this.handleKeydown.bind(this);\n\n    document.addEventListener('keydown', this.handleKeydown);\n\n    this.state.isInitialized = true;\n    return this;\n  },\n\n  createBackdropElement(targetElement, options) {\n    const backdrop = document.createElement('div');\n    backdrop.className = `${this.config.className} ${options.className || ''}`.trim();\n    backdrop.setAttribute('aria-hidden', 'true');\n    backdrop.setAttribute('role', 'presentation');\n\n    const styles = {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '100vw',\n      height: '100vh',\n      background: options.background || this.config.background,\n      opacity: 0,\n      pointerEvents: 'auto',\n      zIndex: options.zIndex || this.config.baseZIndex\n    };\n\n    if (this.config.useTransition) {\n      styles.transition = `opacity ${this.config.duration}ms`;\n    }\n\n    Object.assign(backdrop.style, styles);\n\n    if (targetElement?.parentNode) {\n      targetElement.parentNode.insertBefore(backdrop, targetElement);\n    } else {\n      document.body.appendChild(backdrop);\n    }\n\n    return backdrop;\n  },\n\n  show(element, onClick = null, options = {}) {\n    try {\n      const id = this.state.nextId++;\n\n      const backdropOptions = {\n        ...this.config,\n        ...options,\n        zIndex: this.config.baseZIndex + (this.state.activeBackdrops.length * 10)\n      };\n\n      const backdropData = {\n        id,\n        element: this.createBackdropElement(element, backdropOptions),\n        targetElement: element,\n        onClick,\n        options: backdropOptions\n      };\n\n      if (onClick) {\n        backdropData.element.addEventListener('click', onClick);\n      }\n\n      this.state.backdrops.set(id, backdropData);\n      this.state.activeBackdrops.push(id);\n\n      if (backdropOptions.preventScroll) {\n        document.body.style.overflow = 'hidden';\n      }\n\n      requestAnimationFrame(() => {\n        backdropData.element.style.opacity = backdropOptions.opacity;\n      });\n\n      return id;\n    } catch (error) {\n      console.error('Error showing backdrop:', error);\n      return null;\n    }\n  },\n\n  hide(id) {\n    try {\n      const backdropData = this.state.backdrops.get(id);\n      if (!backdropData) return;\n\n      backdropData.element.style.opacity = 0;\n\n      const cleanup = () => {\n        if (backdropData.onClick) {\n          backdropData.element.removeEventListener('click', backdropData.onClick);\n        }\n\n        backdropData.element.remove();\n        this.state.backdrops.delete(id);\n\n        const index = this.state.activeBackdrops.indexOf(id);\n        if (index > -1) {\n          this.state.activeBackdrops.splice(index, 1);\n        }\n\n        if (this.state.activeBackdrops.length === 0) {\n          document.body.style.overflow = '';\n        }\n      };\n\n      if (this.config.useTransition) {\n        setTimeout(cleanup, this.config.duration);\n      } else {\n        cleanup();\n      }\n    } catch (error) {\n      console.error('Error hiding backdrop:', error);\n    }\n  },\n\n  update(element, options = {}) {\n    const backdropData = this.state.backdrops.get(element);\n    if (!backdropData) return;\n\n    const backdrop = backdropData.element;\n    const newOptions = {...backdropData.options, ...options};\n\n    backdrop.style.background = newOptions.background;\n    backdrop.style.opacity = this.state.activeBackdrops.indexOf(backdropData) !== -1 ?\n      newOptions.opacity : '0';\n    backdrop.style.zIndex = newOptions.zIndex;\n\n    backdropData.options = newOptions;\n  },\n\n  hideAll() {\n    [...this.state.activeBackdrops].forEach(id => this.hide(id));\n  },\n\n\n  handleKeydown(event) {\n    if (event.key === 'Escape' && this.state.activeBackdrops.length > 0) {\n      const lastId = this.state.activeBackdrops[this.state.activeBackdrops.length - 1];\n      this.hide(lastId);\n    }\n  },\n\n  getBackdropById(id) {\n    for (const backdropData of this.state.backdrops.values()) {\n      if (backdropData.id === id) {\n        return backdropData.element;\n      }\n    }\n    return null;\n  },\n\n  isActive(element) {\n    const backdropData = this.state.backdrops.get(element);\n    return backdropData && this.state.activeBackdrops.includes(backdropData);\n  },\n\n  destroy() {\n    this.hideAll();\n    document.removeEventListener('keydown', this.handleKeydown);\n    this.state.isInitialized = false;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('backdrop', BackdropManager);\n}\n\nwindow.BackdropManager = BackdropManager;\n","/**\n * Modal Component\n * A reusable modal dialog component\n *\n * Features:\n * - Show/hide with animation\n * - Custom header, body and footer\n * - Close button\n * - Event handling\n * - Backdrop click to close\n * - ESC key to close\n * - Focus trap\n * - Accessibility\n *\n * @requires DialogManager\n */\nclass Modal {\n  /**\n   * Create modal instance\n   * @param {Object} options Modal options\n   */\n  constructor(options = {}) {\n    this.options = {\n      id: null, // Modal ID\n      title: '', // Modal title\n      content: '', // Modal content\n      width: 'auto',\n      maxWidth: '90%',\n      height: 'auto',\n      maxHeight: '90vh',\n      closeButton: true,\n      animation: true,\n      backdrop: true,\n      keyboard: true,\n      focus: true,\n      className: '',\n      onShow: null,\n      onShown: null,\n      onHide: null,\n      onHidden: null,\n      backdropOpacity: 0.5,\n      backdropColor: 'rgba(0,0,0,0.5)',\n      ...options\n    };\n\n    this.id = this.options.id || 'modal_' + Math.random().toString(36).substr(2, 9);\n    this.backdropId = null; // Store backdrop ID\n    this.visible = false;\n    this.boundData = {}; // Store bound data for data binding\n    this.createModal();\n    this.bindEvents();\n  }\n\n  /**\n   * Create modal DOM structure\n   * @private\n   */\n  createModal() {\n    // Create modal elements\n    this.modal = document.createElement('div');\n    this.modal.id = this.id;\n    this.modal.className = `modal ${this.options.className}`.trim();\n    this.modal.setAttribute('role', 'dialog');\n    this.modal.setAttribute('aria-modal', 'true');\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.modal.inert = true; // Initially inert (prevent focus and interactions)\n\n    // Modal dialog\n    this.dialog = document.createElement('div');\n    this.dialog.className = 'modal-dialog';\n    this.dialog.style.width = this.options.width;\n    this.dialog.style.maxWidth = this.options.maxWidth;\n    this.dialog.style.height = this.options.height;\n    this.dialog.style.maxHeight = this.options.maxHeight;\n\n    // Modal header\n    if (this.options.title) {\n      this.header = document.createElement('div');\n      this.header.className = 'modal-header';\n      this.header.innerHTML = `\n        <h4 class=\"modal-title\">${this.options.title}</h4>\n        ${this.options.closeButton ? '<button type=\"button\" class=\"modal-close\" aria-label=\"Close\"></button>' : ''}\n      `;\n      this.dialog.appendChild(this.header);\n    }\n\n    // Modal body\n    this.body = document.createElement('div');\n    this.body.className = 'modal-body';\n    this.body.innerHTML = this.options.content;\n    this.dialog.appendChild(this.body);\n\n    // Add dialog to modal\n    this.modal.appendChild(this.dialog);\n\n    // Add to document\n    document.body.appendChild(this.modal);\n  }\n\n  /**\n   * Bind modal events\n   * @private\n   */\n  bindEvents() {\n    window.setTimeout(() => {\n      // Close button click\n      this._bindCloseButtons(this.modal);\n    }, 100);\n\n    // ESC key\n    if (this.options.keyboard) {\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && this.visible) {\n          this.hide();\n        }\n      });\n    }\n\n    // Focus trap\n    if (this.options.focus) {\n      this.modal.addEventListener('keydown', (e) => {\n        if (e.key === 'Tab') {\n          const focusable = this.modal.querySelectorAll(\n            'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n          );\n          const firstFocusable = focusable[0];\n          const lastFocusable = focusable[focusable.length - 1];\n\n          if (e.shiftKey) {\n            if (document.activeElement === firstFocusable) {\n              lastFocusable.focus();\n              e.preventDefault();\n            }\n          } else {\n            if (document.activeElement === lastFocusable) {\n              firstFocusable.focus();\n              e.preventDefault();\n            }\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * Show modal\n   */\n  show() {\n    if (this.visible) return;\n\n    // Show backdrop first\n    this.backdropId = BackdropManager.show(() => {\n      // Close on backdrop click if enabled\n      if (this.options.backdrop) {\n        this.hide();\n      }\n    }, {\n      opacity: this.options.backdropOpacity,\n      background: this.options.backdropColor\n    });\n\n    // Call onShow callback\n    if (typeof this.options.onShow === 'function') {\n      this.options.onShow.call(this);\n    }\n\n    // Show modal and remove inert\n    this.modal.setAttribute('aria-hidden', 'false');\n    this.modal.inert = false; // Allow interactions\n    document.body.classList.add('modal-open');\n\n    if (this.options.animation) {\n      this.modal.classList.add('fade-in');\n      setTimeout(() => {\n        this.modal.classList.add('show');\n\n        // Call onShown callback\n        if (typeof this.options.onShown === 'function') {\n          this.options.onShown.call(this);\n        }\n      }, 150);\n    } else {\n      this.modal.classList.add('show');\n      if (typeof this.options.onShown === 'function') {\n        this.options.onShown.call(this);\n      }\n    }\n\n    this.visible = true;\n\n    // Focus first focusable element\n    if (this.options.focus) {\n      const focusable = this.modal.querySelector(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n      focusable?.focus();\n    }\n  }\n\n  /**\n   * Hide modal\n   */\n  hide() {\n    if (!this.visible) return;\n\n    // Hide backdrop\n    if (this.backdropId !== null) {\n      BackdropManager.hide(this.backdropId);\n      this.backdropId = null;\n    }\n\n    // Call onHide callback\n    if (typeof this.options.onHide === 'function') {\n      this.options.onHide.call(this);\n    }\n\n    // Remove focus from any element inside modal before hiding\n    const focusedElement = this.modal.querySelector(':focus');\n    if (focusedElement) {\n      focusedElement.blur();\n    }\n\n    // Hide modal and make it inert\n    this.modal.setAttribute('aria-hidden', 'true');\n    this.modal.inert = true; // Prevent all interactions\n    document.body.classList.remove('modal-open');\n\n    if (this.options.animation) {\n      this.modal.classList.remove('fade-in');\n      this.modal.classList.add('fade-out');\n    } else {\n      this.modal.classList.remove('show');\n      if (typeof this.options.onHidden === 'function') {\n        this.options.onHidden.call(this);\n      }\n    }\n\n    this.visible = false;\n\n    // Cleanup elements and clear content after hide animation\n    setTimeout(() => {\n      this._cleanupModalElements();\n      this.body.innerHTML = '';\n\n      if (this.options.animation) {\n        this.modal.classList.remove('show', 'fade-out');\n\n        // Call onHidden callback\n        if (typeof this.options.onHidden === 'function') {\n          this.options.onHidden.call(this);\n        }\n      }\n    }, 150);\n  }\n\n  /**\n   * Cleanup modal elements before clearing content\n   * @private\n   */\n  _cleanupModalElements() {\n    // Phase 1: Cleanup forms (form will cleanup its elements)\n    if (window.FormManager && typeof window.FormManager.destroyContainer === 'function') {\n      window.FormManager.destroyContainer(this.body);\n    }\n\n    // Phase 2: Cleanup any standalone elements (not in forms)\n    if (window.ElementManager && typeof window.ElementManager.destroyContainer === 'function') {\n      window.ElementManager.destroyContainer(this.body);\n    }\n  }\n\n  /**\n   * Update modal content\n   * @param {string} content New content\n   */\n  setContent(content) {\n    // Cleanup existing elements only if there's existing content\n    if (this.body.children.length > 0) {\n      this._cleanupModalElements();\n      this.body.innerHTML = '';\n    }\n\n    // Handle different content types\n    if (content instanceof DocumentFragment) {\n      // DocumentFragment: append it directly\n      this.body.appendChild(content);\n    } else if (content instanceof Node) {\n      // DOM Node: append it directly\n      this.body.appendChild(content);\n    } else {\n      // String: set as innerHTML\n      this.body.innerHTML = content;\n    }\n\n    // Re-bind close buttons for new content\n    this._bindCloseButtons(this.body);\n\n    // Scan for elements and forms AFTER content is in DOM\n    // This is needed because template processing skips scan for non-connected elements\n    this._scanModalElements();\n  }\n\n  /**\n   * Scan modal body for elements and forms that need enhancement\n   * @private\n   */\n  _scanModalElements() {\n    try {\n      const elementManager = window.ElementManager || window.Now?.getManager?.('element');\n      const formManager = window.FormManager || window.Now?.getManager?.('form');\n\n      if (elementManager && typeof elementManager.scan === 'function') {\n        elementManager.scan(this.body);\n      }\n\n      if (formManager && typeof formManager.scan === 'function') {\n        formManager.scan(this.body);\n      }\n    } catch (err) {\n      console.warn('Modal: Failed to scan elements', err);\n    }\n  }\n\n  /**\n   * Update modal title\n   * @param {string} title New title\n   */\n  setTitle(title) {\n    const titleEl = this.modal.querySelector('.modal-title');\n    if (titleEl) {\n      titleEl.innerHTML = title;\n    }\n  }\n\n  /**\n   * Bind data to modal elements\n   * @param {Object} data Data object to bind\n   * @returns {Modal} Returns this for chaining\n   */\n  bindData(data) {\n    if (!data || typeof data !== 'object') return this;\n\n    // Store bound data\n    this.boundData = {...this.boundData, ...data};\n\n    // Bind data to elements with data-modal-target attribute\n    for (const [key, value] of Object.entries(data)) {\n      const targets = this.modal.querySelectorAll(`[data-modal-target=\"${key}\"]`);\n      targets.forEach(target => {\n        this._setElementContent(target, value, key);\n      });\n    }\n\n    return this;\n  }\n\n  /**\n   * Update existing bound data\n   * @param {Object} data New data to merge and bind\n   * @returns {Modal} Returns this for chaining\n   */\n  updateData(data) {\n    return this.bindData(data);\n  }\n\n  /**\n   * Get currently bound data\n   * @returns {Object} Bound data object\n   */\n  getData() {\n    return {...this.boundData};\n  }\n\n  /**\n   * Set element content based on type\n   * @param {HTMLElement} element Target element\n   * @param {*} value Value to set\n   * @param {string} key Data key for context\n   * @private\n   */\n  _setElementContent(element, value, key) {\n    const tagName = element.tagName.toLowerCase();\n    const sanitizedValue = this._sanitizeValue(value, key);\n\n    // Image elements\n    if (tagName === 'img') {\n      element.src = sanitizedValue;\n      if (!element.alt) {\n        element.alt = key;\n      }\n      return;\n    }\n\n    // Link elements\n    if (tagName === 'a') {\n      element.href = sanitizedValue;\n      return;\n    }\n\n    // Input elements\n    if (tagName === 'input' || tagName === 'textarea') {\n      element.value = sanitizedValue;\n      return;\n    }\n\n    // Video/Audio\n    if (tagName === 'video' || tagName === 'audio') {\n      element.src = sanitizedValue;\n      return;\n    }\n\n    // Source elements\n    if (tagName === 'source') {\n      element.src = sanitizedValue;\n      return;\n    }\n\n    // Check for data-modal-html attribute for HTML content\n    if (element.hasAttribute('data-modal-html')) {\n      element.innerHTML = this._sanitizeHTML(sanitizedValue);\n      return;\n    }\n\n    // Default: set text content\n    element.textContent = sanitizedValue;\n  }\n\n  /**\n   * Sanitize value based on context\n   * @param {*} value Value to sanitize\n   * @param {string} context Context key\n   * @returns {string} Sanitized value\n   * @private\n   */\n  _sanitizeValue(value, context) {\n    if (value === null || value === undefined) return '';\n\n    // Convert to string\n    const strValue = String(value);\n\n    // URL validation for URL-like contexts\n    if (context.includes('url') || context.includes('src') || context.includes('href')) {\n      return this._sanitizeURL(strValue);\n    }\n\n    // Text sanitization (escape HTML)\n    return this._sanitizeText(strValue);\n  }\n\n  /**\n   * Sanitize text content (escape HTML entities)\n   * @param {string} text Text to sanitize\n   * @returns {string} Sanitized text\n   * @private\n   */\n  _sanitizeText(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   * Sanitize HTML content\n   * @param {string} html HTML to sanitize\n   * @returns {string} Sanitized HTML\n   * @private\n   */\n  _sanitizeHTML(html) {\n    // Use DOMPurify if available\n    if (window.DOMPurify) {\n      return DOMPurify.sanitize(html);\n    }\n\n    // Basic sanitization\n    const div = document.createElement('div');\n    div.innerHTML = html;\n\n    // Remove script tags\n    div.querySelectorAll('script').forEach(el => el.remove());\n\n    // Remove event handlers\n    div.querySelectorAll('*').forEach(el => {\n      Array.from(el.attributes).forEach(attr => {\n        if (attr.name.startsWith('on')) {\n          el.removeAttribute(attr.name);\n        }\n      });\n    });\n\n    return div.innerHTML;\n  }\n\n  /**\n   * Sanitize URL\n   * @param {string} url URL to sanitize\n   * @returns {string} Sanitized URL\n   * @private\n   */\n  _sanitizeURL(url) {\n    if (!url) return '';\n\n    try {\n      const parsed = new URL(url, window.location.origin);\n\n      // Allow only safe protocols\n      const safeProtocols = ['http:', 'https:', 'mailto:', 'tel:', 'data:'];\n      if (!safeProtocols.includes(parsed.protocol)) {\n        return '#';\n      }\n\n      return parsed.href;\n    } catch (error) {\n      // Invalid URL - check if it's a relative path\n      if (url.startsWith('/') || url.startsWith('./') || url.startsWith('../')) {\n        return url;\n      }\n      return '#';\n    }\n  }\n\n  /**\n   * Bind close buttons in container\n   * @param {HTMLElement} container Container to search for close buttons\n   * @private\n   */\n  _bindCloseButtons(container) {\n    if (!container) return;\n\n    const closeBtns = container.querySelectorAll('.modal-close');\n    closeBtns.forEach(btn => {\n      // Remove existing listener to prevent duplicates if called multiple times\n      // Note: This only works if we had a reference to the exact function,\n      // but since we use an arrow function in addEventListener, we can't easily remove it.\n      // However, for this specific case, we can check if we already processed it\n      // or just rely on the fact that we are replacing content usually.\n\n      // Better approach: Clone and replace to strip listeners, or just add new one\n      // Since we are mostly calling this on new content, simple add is fine.\n      // But to be safe against double-binding on static parts:\n\n      const newBtn = btn.cloneNode(true);\n      if (btn.parentNode) {\n        btn.parentNode.replaceChild(newBtn, btn);\n        newBtn.addEventListener('click', (e) => {\n          e.preventDefault(); // Prevent form submission if it's a submit button\n          this.hide();\n        });\n      }\n    });\n  }\n\n  /**\n   * Remove modal from DOM\n   */\n  destroy() {\n    this.modal.remove();\n    this.boundData = {};\n  }\n}\n\n// Register with framework\nif (window.Now?.registerManager) {\n  Now.registerManager('modal', Modal);\n}\n\n// Expose globally\nwindow.Modal = Modal;\n","/**\n * ModalDataBinder\n * Extends Modal functionality with data binding from template loops\n *\n * Features:\n * - Bind dynamic data to modal elements\n * - Support for data-modal-bind attribute\n * - Gallery mode with prev/next navigation\n * - Safe content sanitization\n * - Works with TemplateManager\n *\n * @requires Modal\n * @requires DialogManager\n */\nconst ModalDataBinder = {\n  config: {\n    galleryClass: 'modal-gallery',\n    bindAttribute: 'data-modal-bind',\n    targetAttribute: 'data-modal-target',\n    contentAttribute: 'data-gallery-content', // Mark which element should animate\n    sanitize: true,\n    defaultEffect: 'fade',\n    effectDuration: 300,\n    swipeThreshold: 50 // Minimum swipe distance in pixels\n  },\n\n  state: {\n    initialized: false,\n    modalInstances: new Map(), // modalId => Modal instance\n    galleryData: new Map()      // modalId => gallery config\n  },\n\n  /**\n   * Initialize ModalDataBinder\n   */\n  init() {\n    if (this.state.initialized) return;\n\n    this.bindModalTriggers();\n    this.bindGalleryNavigation();\n    this.bindTouchNavigation();\n    this.state.initialized = true;\n  },\n\n  /**\n   * Bind modal trigger elements\n   */\n  bindModalTriggers() {\n    document.addEventListener('click', (e) => {\n      const trigger = e.target.closest('[data-modal]');\n      if (!trigger) return;\n\n      e.preventDefault();\n      this.handleModalTrigger(trigger);\n    });\n  },\n\n  /**\n   * Bind gallery navigation\n   */\n  bindGalleryNavigation() {\n    document.addEventListener('click', (e) => {\n      const navBtn = e.target.closest('[data-modal-nav]');\n      if (!navBtn) return;\n\n      e.preventDefault();\n      const direction = navBtn.dataset.modalNav;\n      const modal = navBtn.closest('.modal');\n\n      if (modal && direction) {\n        this.navigateGallery(modal.id, direction);\n      }\n    });\n  },\n\n  /**\n   * Bind touch/swipe navigation for galleries\n   */\n  bindTouchNavigation() {\n    let touchStartX = 0;\n    let touchStartY = 0;\n    let touchEndX = 0;\n    let touchEndY = 0;\n    let currentModal = null;\n\n    document.addEventListener('touchstart', (e) => {\n      const modal = e.target.closest('.modal.show');\n      if (!modal) return;\n\n      // Only enable swipe for galleries\n      if (!this.state.galleryData.has(modal.id)) return;\n\n      currentModal = modal;\n      touchStartX = e.changedTouches[0].screenX;\n      touchStartY = e.changedTouches[0].screenY;\n    }, {passive: true});\n\n    document.addEventListener('touchend', (e) => {\n      if (!currentModal) return;\n\n      touchEndX = e.changedTouches[0].screenX;\n      touchEndY = e.changedTouches[0].screenY;\n\n      const deltaX = touchEndX - touchStartX;\n      const deltaY = touchEndY - touchStartY;\n\n      // Check if horizontal swipe is dominant\n      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > this.config.swipeThreshold) {\n        if (deltaX < 0) {\n          // Swipe left = next\n          this.navigateGallery(currentModal.id, 'next');\n        } else {\n          // Swipe right = prev\n          this.navigateGallery(currentModal.id, 'prev');\n        }\n      }\n\n      currentModal = null;\n    }, {passive: true});\n  },\n\n  /**\n   * Handle modal trigger click\n   */\n  handleModalTrigger(trigger) {\n    const modalId = trigger.dataset.modal;\n    if (!modalId) return;\n\n    // Parse bind data\n    const bindData = this.parseBindData(trigger.dataset.modalBind);\n\n    // Evaluate expressions in current context\n    const data = this.evaluateBindData(bindData, trigger);\n\n    // Check if gallery mode\n    const isGallery = trigger.dataset.modalGallery === 'true';\n\n    if (isGallery) {\n      this.setupGallery(modalId, trigger, data);\n    }\n\n    // Open modal with data\n    this.openModalWithData(modalId, data, {\n      gallery: isGallery,\n      trigger\n    });\n  },\n\n  /**\n   * Parse bind data string\n   */\n  parseBindData(bindStr) {\n    if (!bindStr) return {};\n\n    const pairs = bindStr.split(',').map(s => s.trim());\n    const data = {};\n\n    pairs.forEach(pair => {\n      const [key, expr] = pair.split(':').map(s => s.trim());\n      if (key && expr) {\n        data[key] = expr;\n      }\n    });\n\n    return data;\n  },\n\n  /**\n   * Evaluate bind data expressions\n   */\n  evaluateBindData(bindData, trigger) {\n    const result = {};\n\n    // Find template context (data-for loop)\n    const templateContext = this.findTemplateContext(trigger);\n\n    for (const [key, expr] of Object.entries(bindData)) {\n      try {\n        const value = this.evaluateExpression(expr, templateContext, trigger);\n        result[key] = value;\n      } catch (error) {\n        result[key] = '';\n      }\n    }\n\n    return result;\n  },\n\n  /**\n   * Find template context for element\n   */\n  findTemplateContext(element) {\n    // Look for closest element with data attributes from template\n    let current = element;\n\n    while (current && current !== document.body) {\n      // Check if element has data attributes that look like template bindings\n      const dataset = current.dataset;\n\n      // Common template data attributes\n      if (dataset.category || dataset.title || dataset.id || dataset.index) {\n        return current;\n      }\n\n      current = current.parentElement;\n    }\n\n    return element;\n  },\n\n  /**\n   * Evaluate expression in context\n   */\n  evaluateExpression(expr, context, trigger) {\n    // Handle special variables\n    if (expr === '$index') {\n      return this.getElementIndex(context);\n    }\n\n    if (expr === '$item') {\n      return context.dataset;\n    }\n\n    // Handle simple data attribute access: item.property\n    if (expr.startsWith('item.')) {\n      const prop = expr.substring(5); // Remove 'item.'\n      const attrName = prop.replace(/([A-Z])/g, '-$1').toLowerCase();\n      return context.dataset[prop] || context.getAttribute(`data-${attrName}`) || '';\n    }\n\n    // Handle direct values\n    if (expr.startsWith('\"') || expr.startsWith(\"'\")) {\n      return expr.slice(1, -1);\n    }\n\n    // Try to get from dataset\n    const value = context.dataset[expr] || context.getAttribute(`data-${expr}`);\n    if (value !== null) {\n      return value;\n    }\n\n    // Return as-is if can't evaluate\n    return expr;\n  },\n\n  /**\n   * Get element index in parent\n   */\n  getElementIndex(element) {\n    if (!element.parentElement) return 0;\n\n    const siblings = Array.from(element.parentElement.children);\n    return siblings.indexOf(element);\n  },\n\n  /**\n   * Setup gallery mode\n   */\n  setupGallery(modalId, trigger, data) {\n    // Find all gallery items in same container\n    const container = trigger.closest('[data-for]')?.parentElement || trigger.parentElement;\n    const items = Array.from(container.querySelectorAll('[data-modal=\"' + modalId + '\"]'));\n\n    const currentIndex = items.indexOf(trigger);\n\n    this.state.galleryData.set(modalId, {\n      items,\n      currentIndex,\n      loop: trigger.dataset.modalGalleryLoop !== 'false',\n      effect: trigger.dataset.modalEffect || this.config.defaultEffect\n    });\n  },\n\n  /**\n   * Navigate gallery\n   */\n  navigateGallery(modalId, direction) {\n    const gallery = this.state.galleryData.get(modalId);\n    if (!gallery) return;\n\n    const {items, currentIndex, loop, effect} = gallery;\n    let newIndex = currentIndex;\n\n    if (direction === 'prev') {\n      newIndex = currentIndex - 1;\n      if (newIndex < 0) {\n        newIndex = loop ? items.length - 1 : 0;\n      }\n    } else if (direction === 'next') {\n      newIndex = currentIndex + 1;\n      if (newIndex >= items.length) {\n        newIndex = loop ? 0 : items.length - 1;\n      }\n    }\n\n    if (newIndex !== currentIndex) {\n      gallery.currentIndex = newIndex;\n      const trigger = items[newIndex];\n\n      // Get new data\n      const bindData = this.parseBindData(trigger.dataset.modalBind);\n      const data = this.evaluateBindData(bindData, trigger);\n\n      // Apply transition effect\n      this.applyGalleryEffect(modalId, data, effect, direction);\n    }\n  },\n\n  /**\n   * Apply gallery transition effect\n   * @param {string} modalId Modal ID\n   * @param {Object} data New data to display\n   * @param {string} effect Effect type (fade, slide-left, slide-right, slide-up, slide-down, zoom)\n   * @param {string} direction Navigation direction (prev, next)\n   */\n  applyGalleryEffect(modalId, data, effect, direction) {\n    const modalRef = this.state.modalInstances.get(modalId);\n    if (!modalRef) return;\n\n    const modalElement = modalRef.isPreExisting ? modalRef.element : modalRef.modal;\n    if (!modalElement) return;\n\n    // Find the content element to animate (not the whole modal)\n    // Priority: 1. [data-gallery-content] 2. .lightbox-body 3. .modal-body 4. first data-modal-target img\n    let content = modalElement.querySelector(`[${this.config.contentAttribute}]`);\n    if (!content) {\n      content = modalElement.querySelector('.lightbox-body, .modal-body');\n    }\n    if (!content) {\n      // Fallback: find the first image with data-modal-target\n      content = modalElement.querySelector('img[data-modal-target]');\n    }\n    if (!content) {\n      // No content wrapper, just update data\n      this.updateModalData(modalId, data);\n      return;\n    }\n\n    // Determine animation classes based on effect and direction\n    let exitClass, enterClass;\n\n    switch (effect) {\n      case 'slide':\n      case 'slide-horizontal':\n        exitClass = direction === 'next' ? 'gallery-slide-out-left' : 'gallery-slide-out-right';\n        enterClass = direction === 'next' ? 'gallery-slide-in-right' : 'gallery-slide-in-left';\n        break;\n      case 'slide-left':\n        exitClass = 'gallery-slide-out-left';\n        enterClass = 'gallery-slide-in-left';\n        break;\n      case 'slide-right':\n        exitClass = 'gallery-slide-out-right';\n        enterClass = 'gallery-slide-in-right';\n        break;\n      case 'slide-up':\n      case 'slide-vertical':\n        exitClass = direction === 'next' ? 'gallery-slide-out-up' : 'gallery-slide-out-down';\n        enterClass = direction === 'next' ? 'gallery-slide-in-up' : 'gallery-slide-in-down';\n        break;\n      case 'slide-down':\n        exitClass = 'gallery-slide-out-down';\n        enterClass = 'gallery-slide-in-down';\n        break;\n      case 'zoom':\n        exitClass = 'gallery-zoom-out';\n        enterClass = 'gallery-zoom-in';\n        break;\n      case 'fade':\n      default:\n        exitClass = 'gallery-fade-out';\n        enterClass = 'gallery-fade-in';\n        break;\n    }\n\n    // Apply exit animation\n    content.classList.add(exitClass);\n\n    // Wait for exit animation to complete\n    setTimeout(() => {\n      content.classList.remove(exitClass);\n\n      // Update data\n      this.updateModalData(modalId, data);\n\n      // Apply enter animation\n      content.classList.add(enterClass);\n\n      // Clean up enter animation\n      setTimeout(() => {\n        content.classList.remove(enterClass);\n      }, this.config.effectDuration);\n    }, this.config.effectDuration / 2);\n  },\n\n  /**\n   * Open modal with data\n   */\n  openModalWithData(modalId, data, options = {}) {\n    const modalElement = document.getElementById(modalId);\n    if (!modalElement) {\n      console.warn(`Modal element with id \"${modalId}\" not found`);\n      return;\n    }\n\n    // Check if this is a pre-existing modal element (has modal class already)\n    const isPreExistingModal = modalElement.classList.contains('modal');\n\n    if (isPreExistingModal) {\n      // Bind data directly to the existing modal\n      this._bindDataToElement(modalElement, data);\n\n      // Show the modal using simple class toggle\n      this._showPreExistingModal(modalElement);\n\n      // Store reference\n      this.state.modalInstances.set(modalId, {element: modalElement, isPreExisting: true});\n    } else {\n      // Get or create Modal instance for dynamic modals\n      let modal = this.state.modalInstances.get(modalId);\n\n      if (!modal || modal.isPreExisting) {\n        // Extract existing content if any\n        const existingContent = modalElement.innerHTML;\n        const existingTitle = modalElement.querySelector('.modal-title')?.textContent || '';\n\n        // Remove existing element\n        modalElement.remove();\n\n        // Create Modal instance\n        modal = new Modal({\n          id: modalId,\n          title: existingTitle,\n          content: existingContent,\n          closeButton: true,\n          backdrop: true,\n          keyboard: true,\n          animation: true\n        });\n\n        // Store instance\n        this.state.modalInstances.set(modalId, modal);\n      }\n\n      // Bind data to modal\n      modal.bindData(data);\n\n      // Show modal\n      modal.show();\n    }\n  },\n\n  /**\n   * Bind data to a modal element (for pre-existing modals)\n   * @private\n   */\n  _bindDataToElement(modalElement, data) {\n    for (const [key, value] of Object.entries(data)) {\n      const targets = modalElement.querySelectorAll(`[${this.config.targetAttribute}=\"${key}\"]`);\n      targets.forEach(target => {\n        this._setElementContent(target, value, key);\n      });\n    }\n  },\n\n  /**\n   * Set element content (for pre-existing modals)\n   * @private\n   */\n  _setElementContent(element, value, key) {\n    const tagName = element.tagName.toLowerCase();\n\n    // Image elements\n    if (tagName === 'img') {\n      element.src = value || '';\n      if (!element.alt) element.alt = key;\n      return;\n    }\n\n    // Link elements\n    if (tagName === 'a') {\n      element.href = value || '#';\n      return;\n    }\n\n    // Input elements\n    if (tagName === 'input' || tagName === 'textarea') {\n      element.value = value || '';\n      return;\n    }\n\n    // Default: set text content\n    element.textContent = value || '';\n  },\n\n  /**\n   * Show pre-existing modal element\n   * @private\n   */\n  _showPreExistingModal(modalElement) {\n    // Initialize events if not already done\n    if (!modalElement.dataset.modalInitialized) {\n      this._bindPreExistingModalEvents(modalElement);\n      modalElement.dataset.modalInitialized = 'true';\n    }\n\n    // Show backdrop\n    if (window.BackdropManager) {\n      modalElement._backdropId = BackdropManager.show(() => this.closeModal(modalElement.id), {\n        zIndex: 1040\n      });\n    }\n\n    // Show modal\n    modalElement.classList.add('show');\n    modalElement.setAttribute('aria-hidden', 'false');\n    document.body.classList.add('modal-open');\n\n    // Focus management\n    requestAnimationFrame(() => {\n      const focusable = modalElement.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])');\n      if (focusable) {\n        focusable.focus();\n      }\n    });\n  },\n\n  /**\n   * Bind events for pre-existing modal\n   * @private\n   */\n  _bindPreExistingModalEvents(modalElement) {\n    // Close buttons\n    const closeBtns = modalElement.querySelectorAll('.modal-close, [data-close], [data-dismiss=\"modal\"]');\n    closeBtns.forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.closeModal(modalElement.id);\n      });\n    });\n\n    // Backdrop click\n    modalElement.addEventListener('click', (e) => {\n      if (e.target === modalElement) {\n        this.closeModal(modalElement.id);\n      }\n    });\n\n    // ESC key\n    const escHandler = (e) => {\n      if (e.key === 'Escape' && modalElement.classList.contains('show')) {\n        this.closeModal(modalElement.id);\n      }\n    };\n    document.addEventListener('keydown', escHandler);\n    modalElement._escHandler = escHandler;\n  },\n\n\n\n  /**\n   * Update modal data\n   */\n  updateModalData(modalId, data) {\n    const modalRef = this.state.modalInstances.get(modalId);\n    if (!modalRef) {\n      console.warn(`Modal \"${modalId}\" not found`);\n      return;\n    }\n\n    if (modalRef.isPreExisting) {\n      // Update pre-existing modal element\n      this._bindDataToElement(modalRef.element, data);\n    } else {\n      // Update Modal instance\n      modalRef.updateData(data);\n    }\n  },\n\n\n\n  /**\n   * Close modal\n   */\n  closeModal(modalId) {\n    const modalRef = this.state.modalInstances.get(modalId);\n\n    if (modalRef) {\n      if (modalRef.isPreExisting) {\n        // Hide pre-existing modal element\n        const modalElement = modalRef.element;\n\n        // Hide backdrop\n        if (modalElement._backdropId && window.BackdropManager) {\n          BackdropManager.hide(modalElement._backdropId);\n          modalElement._backdropId = null;\n        }\n\n        // Hide modal\n        modalElement.classList.remove('show');\n        modalElement.setAttribute('aria-hidden', 'true');\n        document.body.classList.remove('modal-open');\n      } else {\n        // Hide Modal instance\n        modalRef.hide();\n      }\n    }\n\n    // Clean up gallery data\n    this.state.galleryData.delete(modalId);\n  },\n\n  /**\n   * Get modal data\n   */\n  getModalData(modalId) {\n    const modalRef = this.state.modalInstances.get(modalId);\n    if (!modalRef) return null;\n\n    if (modalRef.isPreExisting) {\n      // For pre-existing modals, we don't track data\n      return null;\n    }\n\n    return modalRef.getData();\n  },\n\n  /**\n   * Destroy binder\n   */\n  destroy() {\n    // Destroy all modal instances\n    this.state.modalInstances.forEach(modal => modal.destroy());\n    this.state.modalInstances.clear();\n    this.state.galleryData.clear();\n    this.state.initialized = false;\n  }\n};\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => ModalDataBinder.init());\n} else {\n  ModalDataBinder.init();\n}\n\n// Export for use in modules\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = ModalDataBinder;\n}\n","const EventManager = {\n  config: {\n    asyncTimeout: 5000,\n    maxListeners: 2048,\n    traceEvents: false,\n    cleanup: {\n      enabled: true,\n      interval: 60000,\n      maxAge: 1800000,\n      batchSize: 100\n    }\n  },\n\n  state: {\n    events: new Map(),\n    groups: new Map(),\n    patterns: new Set(),\n    listenerCounts: new Map(),\n    middleware: [],\n    history: [],\n    cleanupTimer: null,\n    lastCleanup: Date.now()\n  },\n\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    if (this.config.cleanup.enabled) {\n      this.startCleanup();\n    }\n\n    return this;\n  },\n\n  removePatternListener(pattern, identifier = null) {\n    let removed = false;\n\n    if (identifier === null) {\n      this.state.patterns.forEach((config, regex) => {\n        if (regex.toString() === pattern) {\n          this.state.patterns.delete(regex);\n          removed = true;\n        }\n      });\n      return removed;\n    }\n\n    for (const [regex, config] of this.state.patterns.entries()) {\n      if (regex.toString() === pattern) {\n        if (\n          (typeof identifier === 'string' && config.id === identifier) ||\n          (typeof identifier === 'function' && config.callback === identifier)\n        ) {\n          this.state.patterns.delete(regex);\n          removed = true;\n        }\n      }\n    }\n\n    return removed;\n  },\n\n  once(event, callback, options = {}) {\n    return this.on(event, callback, {...options, once: true});\n  },\n\n  getEventPath(event) {\n    const parts = event.split('.');\n    const paths = [];\n\n    while (parts.length > 0) {\n      paths.push(parts.join('.'));\n      parts.pop();\n    }\n\n    return paths;\n  },\n\n  async processPromises(promises, context) {\n    if (promises.length === 0) return;\n\n    try {\n      const results = await Promise.allSettled(promises);\n      results.forEach(result => {\n        if (result.status === 'fulfilled' && result.value !== undefined) {\n          context.results.push(result.value);\n        } else if (result.status === 'rejected') {\n          this.handleListenerError(result.reason, context.event);\n        }\n      });\n    } catch (error) {\n      this.handleAsyncError(error, context.event);\n    }\n  },\n\n  async emit(event, data = {}) {\n    try {\n      const shouldContinue = await this.runMiddleware('beforeEmit', {event, data});\n      if (shouldContinue === false) return [];\n\n      const eventPath = this.getEventPath(event);\n\n      const context = {\n        event,\n        data,\n        timestamp: Date.now(),\n        preventDefault: false,\n        stopPropagation: false,\n        stopImmediatePropagation: false,\n        results: [],\n        source: null,\n        path: eventPath,\n        currentPath: null\n      };\n\n      if (this.config.traceEvents) {\n        this.addToHistory(context);\n      }\n\n      for (const currentEvent of eventPath) {\n        if (context.stopPropagation) break;\n\n        await this.emitPatternMatches(currentEvent, context);\n\n        const listeners = this.state.events.get(currentEvent);\n        if (listeners && listeners.size > 0) {\n          const promises = [];\n\n          for (const listener of listeners) {\n            if (context.stopImmediatePropagation) break;\n\n            try {\n              if (listener.options.once) {\n                listeners.delete(listener);\n                this.updateListenerCount(currentEvent, -1);\n              }\n\n              const result = await listener.callback(context);\n\n              if (listener.options.async || result instanceof Promise) {\n                promises.push(this.handleAsyncListener(\n                  Promise.resolve(result),\n                  listener,\n                  context\n                ));\n              } else if (result !== undefined) {\n                context.results.push(result);\n              }\n\n            } catch (error) {\n              this.handleListenerError(error, currentEvent, listener);\n            }\n          }\n\n          await this.processPromises(promises, context);\n        }\n\n        for (const [groupName, groupEvents] of this.state.groups) {\n          if (groupEvents.has(currentEvent)) {\n            const groupListeners = groupEvents.get(currentEvent);\n            const promises = [];\n\n            for (const listener of groupListeners) {\n              if (context.stopImmediatePropagation) break;\n\n              try {\n                if (listener.options.once) {\n                  groupListeners.delete(listener);\n                  this.updateListenerCount(currentEvent, -1);\n                }\n\n                const result = await listener.callback(context);\n\n                if (listener.options.async || result instanceof Promise) {\n                  promises.push(this.handleAsyncListener(\n                    Promise.resolve(result),\n                    listener,\n                    context\n                  ));\n                } else if (result !== undefined) {\n                  context.results.push(result);\n                }\n\n              } catch (error) {\n                this.handleListenerError(error, currentEvent, listener);\n              }\n            }\n\n            await this.processPromises(promises, context);\n          }\n        }\n      }\n\n      await this.runMiddleware('afterEmit', {event, data, context});\n\n      return context.results;\n\n    } catch (error) {\n      this.handleEmitError(error, event);\n      return [];\n    }\n  },\n\n  createPattern(pattern) {\n    return new RegExp(\n      '^' +\n      pattern\n        .replace(/\\./g, '\\\\.')\n        .replace(/\\*/g, '.*')\n        .replace(/\\?/g, '.')\n      + '$'\n    );\n  },\n\n  on(event, callback, options = {}) {\n    try {\n      if (!event || typeof event !== 'string') {\n        throw new Error('Event name must be a non-empty string');\n      }\n\n      if (typeof callback !== 'function') {\n        throw new Error('Callback must be a function');\n      }\n\n      event = event.trim();\n\n      const listenerOptions = {\n        priority: parseInt(options.priority) || 0,\n        once: Boolean(options.once),\n        async: Boolean(options.async),\n        group: options.group || null,\n        timeout: options.timeout || this.config.asyncTimeout,\n        maxRetries: options.maxRetries || 1,\n        onError: options.onError || null\n      };\n\n      if (this.isPattern(event)) {\n        const pattern = this.createPattern(event);\n        const patternListener = {\n          pattern,\n          callback,\n          options: listenerOptions,\n          id: Utils.generateUUID(),\n          timestamp: Date.now()\n        };\n\n        this.state.patterns.add(patternListener);\n\n        return () => {\n          this.state.patterns.delete(patternListener);\n        };\n      }\n\n      const listener = {\n        id: Utils.generateUUID(),\n        callback,\n        options: listenerOptions,\n        timestamp: Date.now(),\n        retryCount: 0,\n        active: true\n      };\n\n      if (!this.state.events.has(event)) {\n        this.state.events.set(event, new Set());\n      }\n\n      const listeners = this.state.events.get(event);\n\n      if (listeners.size >= this.config.maxListeners) {\n        if (options.force) {\n          this.cleanupStaleListeners(event);\n        } else {\n          ErrorManager.handle(`Max listeners exceeded for event: ${event}`, {\n            context: 'EventManager.on',\n            type: 'error:event',\n            notify: true\n          }\n          );\n          return null;\n        }\n      }\n\n      listeners.add(listener);\n      this.updateListenerCount(event, 1);\n\n      if (listenerOptions.group) {\n        this.addToGroup(listenerOptions.group, event, listener);\n      }\n\n      this.sortListeners(event);\n\n      return () => {\n        this.off(event, listener.id);\n      };\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'EventManager.on',\n        type: 'error:event',\n        notify: true\n      });\n      return null;\n    }\n  },\n\n  off(event, identifier = null) {\n    try {\n      if (!event || typeof event !== 'string') {\n        throw new Error('Event name must be a non-empty string');\n      }\n\n      event = event.trim();\n\n      if (this.isPattern(event)) {\n        return this.removePatternListener(event, identifier);\n      }\n\n      const listeners = this.state.events.get(event);\n      if (!listeners || listeners.size === 0) {\n        return false;\n      }\n\n      let removed = false;\n\n      if (identifier === null) {\n        const count = listeners.size;\n        listeners.clear();\n        this.updateListenerCount(event, -count);\n\n        this.state.groups.forEach(groupEvents => {\n          if (groupEvents.has(event)) {\n            groupEvents.delete(event);\n          }\n        });\n\n        if (listeners.size === 0) {\n          this.state.events.delete(event);\n        }\n\n        removed = true;\n      } else {\n        for (const listener of listeners) {\n          if (identifier === listener.id || identifier === listener.callback) {\n            listeners.delete(listener);\n            this.updateListenerCount(event, -1);\n\n            this.state.groups.forEach(groupEvents => {\n              const groupListeners = groupEvents.get(event);\n              if (groupListeners?.has(listener)) {\n                groupListeners.delete(listener);\n                if (groupListeners.size === 0) {\n                  groupEvents.delete(event);\n                }\n              }\n            });\n\n            removed = true;\n          }\n        }\n\n        if (listeners.size === 0) {\n          this.state.events.delete(event);\n        }\n      }\n\n      this.state.groups.forEach((groupEvents, group) => {\n        if (groupEvents.size === 0) {\n          this.state.groups.delete(group);\n        }\n      });\n\n      return removed;\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'EventManager.off',\n        type: 'error:event',\n        notify: true\n      });\n      return false;\n    }\n  },\n\n  async emitPatternMatches(event, context) {\n    if (!this.state.patterns || this.state.patterns.size === 0) {\n      return;\n    }\n\n    const promises = [];\n\n    for (const pattern of this.state.patterns.values()) {\n      if (context.stopImmediatePropagation) break;\n\n      if (pattern.pattern.test(event)) {\n        try {\n          if (pattern.options?.once) {\n            this.state.patterns.delete(pattern);\n          }\n\n          const result = await pattern.callback(context);\n\n          if (pattern.options?.async) {\n            promises.push(this.handleAsyncListener(\n              Promise.resolve(result),\n              pattern,\n              context\n            ));\n          } else if (result instanceof Promise) {\n            promises.push(this.handleAsyncListener(result, pattern, context));\n          } else if (result !== undefined) {\n            context.results.push(result);\n          }\n\n        } catch (error) {\n          this.handleListenerError(error, event, pattern);\n        }\n      }\n    }\n\n    if (promises.length > 0) {\n      try {\n        const asyncResults = await Promise.race([\n          Promise.all(promises),\n          new Promise((_, reject) =>\n            setTimeout(() => reject(new Error('Pattern matching timeout')),\n              this.config.asyncTimeout)\n          )\n        ]);\n        context.results.push(...asyncResults.filter(r => r !== undefined));\n      } catch (error) {\n        this.handleAsyncError(error, event);\n      }\n    }\n  },\n\n  addPatternListener(pattern, callback, options) {\n    const regex = new RegExp(pattern);\n    this.state.patterns.set(regex, {callback, options});\n    return () => this.state.patterns.delete(regex);\n  },\n\n  addToGroup(group, event, listener) {\n    if (!this.state.groups.has(group)) {\n      this.state.groups.set(group, new Map());\n    }\n    const groupEvents = this.state.groups.get(group);\n    if (!groupEvents.has(event)) {\n      groupEvents.set(event, new Set());\n    }\n    groupEvents.get(event).add(listener);\n  },\n\n  removeFromGroup(group, event, listener) {\n    const groupEvents = this.state.groups.get(group);\n    if (!groupEvents) return;\n\n    const listeners = groupEvents.get(event);\n    if (listeners) {\n      listeners.delete(listener);\n      if (listeners.size === 0) {\n        groupEvents.delete(event);\n      }\n    }\n\n    if (groupEvents.size === 0) {\n      this.state.groups.delete(group);\n    }\n  },\n\n  async emitGroup(group, data = {}) {\n    const groupEvents = this.state.groups.get(group);\n    if (!groupEvents) return [];\n\n    const results = [];\n\n    for (const [event, listeners] of groupEvents) {\n      const context = {\n        event,\n        data,\n        timestamp: Date.now(),\n        preventDefault: false,\n        stopPropagation: false,\n        stopImmediatePropagation: false,\n        results: [],\n        source: null,\n        path: [event],\n        currentPath: event\n      };\n\n      const promises = [];\n\n      for (const listener of listeners) {\n        if (context.stopImmediatePropagation) break;\n\n        try {\n          if (listener.options.once) {\n            listeners.delete(listener);\n            this.updateListenerCount(event, -1);\n          }\n\n          const result = await listener.callback(context);\n\n          if (listener.options.async || result instanceof Promise) {\n            promises.push(this.handleAsyncListener(\n              Promise.resolve(result),\n              listener,\n              context\n            ));\n          } else if (result !== undefined) {\n            context.results.push(result);\n          }\n\n        } catch (error) {\n          this.handleListenerError(error, event, listener);\n        }\n      }\n\n      await this.processPromises(promises, context);\n      results.push(...context.results);\n    }\n\n    return results;\n  },\n\n  use(middleware) {\n    if (typeof middleware === 'function') {\n      this.state.middleware.push(middleware);\n    } else if (typeof middleware === 'object') {\n      this.state.middleware.push(middleware);\n    }\n    return this;\n  },\n\n  async runMiddleware(hook, context) {\n    for (const middleware of this.state.middleware) {\n      try {\n        if (typeof middleware === 'function') {\n          const result = await middleware(context);\n          if (result === false) return false;\n        } else if (middleware[hook]) {\n          const result = await middleware[hook](context);\n          if (result === false) return false;\n        }\n      } catch (error) {\n        this.handleMiddlewareError(error, hook);\n      }\n    }\n    return true;\n  },\n\n  startCleanup() {\n    if (this.state.cleanupTimer) {\n      clearInterval(this.state.cleanupTimer);\n    }\n\n    this.state.cleanupTimer = setInterval(() => {\n      this.cleanup();\n    }, this.config.cleanup.interval);\n\n    window.addEventListener('beforeunload', () => {\n      this.cleanup();\n      clearInterval(this.state.cleanupTimer);\n    });\n\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        this.cleanup();\n        clearInterval(this.state.cleanupTimer);\n      }\n    });\n  },\n\n  cleanup() {\n    const now = Date.now();\n    let processed = 0;\n\n    for (const [event, listeners] of this.state.events) {\n      if (processed >= this.config.cleanup.batchSize) break;\n\n      this.cleanupStaleListeners(event);\n\n      if (listeners.size === 0) {\n        this.state.events.delete(event);\n        this.state.listenerCounts.delete(event);\n      }\n\n      processed++;\n    }\n\n    for (const pattern of this.state.patterns) {\n      if (processed >= this.config.cleanup.batchSize) break;\n\n      if (pattern.timestamp && now - pattern.timestamp > this.config.cleanup.maxAge) {\n        this.state.patterns.delete(pattern);\n      }\n\n      processed++;\n    }\n\n    while (\n      this.state.history.length > 0 &&\n      now - this.state.history[0].timestamp > this.config.cleanup.maxAge\n    ) {\n      this.state.history.shift();\n    }\n\n    this.state.lastCleanup = now;\n  },\n\n  cleanupStaleListeners(event) {\n    const listeners = this.state.events.get(event);\n    if (!listeners) return;\n\n    const now = Date.now();\n    let removed = 0;\n\n    for (const listener of listeners) {\n      if (now - listener.timestamp > this.config.cleanup.maxAge) {\n        listeners.delete(listener);\n        removed++;\n      }\n    }\n\n    if (removed > 0) {\n      this.updateListenerCount(event, -removed);\n    }\n  },\n\n  updateListenerCount(event, delta) {\n    const current = this.state.listenerCounts.get(event) || 0;\n    const newCount = Math.max(0, current + delta);\n\n    if (newCount === 0) {\n      this.state.listenerCounts.delete(event);\n    } else {\n      this.state.listenerCounts.set(event, newCount);\n    }\n  },\n\n  addToHistory(context) {\n    this.state.history.push({\n      ...context,\n      stack: new Error().stack\n    });\n\n    while (this.state.history.length > 100) {\n      this.state.history.shift();\n    }\n  },\n\n  sortListeners(event) {\n    const listeners = this.state.events.get(event);\n    if (!listeners) return;\n\n    const sorted = Array.from(listeners).sort((a, b) =>\n      b.options.priority - a.options.priority\n    );\n\n    this.state.events.set(event, new Set(sorted));\n  },\n\n  getParentEvent(event) {\n    const parts = event.split('.');\n    if (parts.length > 1) {\n      return parts.slice(0, -1).join('.');\n    }\n    return null;\n  },\n\n  isPattern(str) {\n    return str.includes('*') || str.includes('?') ||\n      str.includes('+') || str.includes('|');\n  },\n\n  async handleAsyncListener(promise, listener, context) {\n    try {\n      const result = await Promise.race([\n        promise,\n        new Promise((_, reject) =>\n          setTimeout(() => reject(new Error('Async handler timeout')),\n            listener.options.timeout || this.config.asyncTimeout)\n        )\n      ]);\n\n      return result;\n\n    } catch (error) {\n      this.handleListenerError(error, context.event, listener);\n      return undefined;\n    }\n  },\n\n  handleListenerError(error, event, listener) {\n    const errorObj = error || new Error('Listener execution failed');\n\n    ErrorManager.handle(errorObj, {\n      context: 'EventManager.listener',\n      type: 'error:event',\n      data: {\n        event,\n        listenerId: listener.id,\n        listenerOptions: listener.options\n      },\n      notify: true\n    });\n\n    return false;\n  },\n\n  handleAsyncError(error, event) {\n    const errorObj = error || new Error('Async execution failed');\n\n    ErrorManager.handle(errorObj, {\n      context: 'EventManager.async',\n      type: 'error:event',\n      data: {\n        event,\n        timestamp: Date.now()\n      },\n      notify: true\n    });\n\n    return false;\n  },\n\n  handleEmitError(error, event) {\n    const errorObj = error || new Error('Event emission failed');\n\n    ErrorManager.handle(errorObj, {\n      context: 'EventManager.emit',\n      type: 'error:event',\n      data: {\n        event,\n        timestamp: Date.now()\n      },\n      notify: true\n    });\n\n    return false;\n  },\n\n  handleMiddlewareError(error, hook) {\n    const errorObj = error || new Error('Middleware execution failed');\n\n    ErrorManager.handle(errorObj, {\n      context: 'EventManager.middleware',\n      type: 'error:event',\n      data: {\n        hook,\n        timestamp: Date.now()\n      },\n      notify: true\n    });\n\n    return false;\n  },\n\n  getEventInfo(event) {\n    const listeners = this.state.events.get(event);\n    return {\n      name: event,\n      listenerCount: listeners?.size || 0,\n      groups: Array.from(this.state.groups.entries())\n        .filter(([_, events]) => events.has(event))\n        .map(([name]) => name),\n      patterns: Array.from(this.state.patterns.keys())\n        .filter(pattern => pattern.test(event))\n        .map(pattern => pattern.toString())\n    };\n  },\n\n  getDebugInfo() {\n    return {\n      events: Array.from(this.state.events.keys()).map(event => ({\n        name: event,\n        ...this.getEventInfo(event)\n      })),\n\n      patterns: Array.from(this.state.patterns.entries()).map(([pattern, config]) => ({\n        pattern: pattern.toString(),\n        options: config.options\n      })),\n\n      groups: Array.from(this.state.groups.entries()).map(([name, events]) => ({\n        name,\n        eventCount: events.size,\n        events: Array.from(events.keys())\n      })),\n\n      listenerCounts: Object.fromEntries(this.state.listenerCounts),\n\n      history: this.state.history.slice(-20).map(event => ({\n        name: event.event,\n        timestamp: event.timestamp,\n        hasData: !!event.data,\n        prevented: event.preventDefault,\n        propagationStopped: event.stopPropagation\n      })),\n\n      middleware: {\n        count: this.state.middleware.length,\n        types: this.state.middleware.map(m =>\n          typeof m === 'function' ? 'function' : 'object'\n        )\n      },\n\n      state: {\n        lastCleanup: this.state.lastCleanup,\n        historyLength: this.state.history.length\n      },\n\n      config: {\n        ...this.config,\n        onError: this.config.onError ? 'function configured' : 'not configured'\n      },\n\n      system: {\n        timestamp: Date.now(),\n        memoryUsage: performance?.memory ? {\n          usedJSHeapSize: performance.memory.usedJSHeapSize,\n          totalJSHeapSize: performance.memory.totalJSHeapSize\n        } : 'not available'\n      }\n    };\n  },\n\n  clear() {\n    this.state.events.clear();\n    this.state.groups.clear();\n    this.state.patterns.clear();\n    this.state.listenerCounts.clear();\n    this.state.history = [];\n    this.state.middleware = [];\n  },\n\n  destroy() {\n    if (this.state.cleanupTimer) {\n      clearInterval(this.state.cleanupTimer);\n    }\n\n    this.clear();\n\n    window.removeEventListener('unload', this.cleanup);\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('event', EventManager);\n}\n\nwindow.EventManager = EventManager;\n","const EventSystemManager = {\n  config: {\n    cleanupInterval: 600000,\n    maxMemoryUsage: 50 * 1024 * 1024,\n    delegation: {\n      enabled: true,\n      matchingStrategy: 'closestFirst',\n      maxDelegationDepth: 10,\n      optimizeSelectors: true,\n      rootElement: document\n    },\n    memoryManagement: {\n      checkInterval: 30000,\n      maxHandlersPerElement: 100,\n      maxCacheSize: 1000,\n      gcThreshold: 0.8,\n      detailedTracking: true\n    },\n    filtering: {\n      enabled: true,\n      maxThrottleRate: 60, // events per second\n      debounceWait: 100, // ms\n      highFrequencyEvents: null\n    }\n  },\n\n  state: {\n    handlers: new Map(),\n    elementHandlers: new Map(),\n    idCounter: 0,\n    initialized: false,\n    memoryUsage: 0,\n    eventPaths: new WeakMap(),\n    cleanupTimer: null,\n    delegationCache: new WeakMap(),\n    selectorCache: new Map(),\n    delegatedEvents: new Map(),\n    selectorsByType: new Map(),\n    selectorMatchCache: new WeakMap(),\n    uiEventQueue: new Map(),\n    rafScheduled: false,\n    memoryStats: {\n      handlerCount: 0,\n      cacheSize: 0,\n      weakMapSize: 0,\n      lastGC: Date.now(),\n      peakMemoryUsage: 0,\n      memoryWarnings: 0\n    },\n    elementStats: new WeakMap(),\n    gcTimer: null,\n    filtering: {\n      throttleTimers: new Map(),\n      debounceTimers: new Map(),\n      lastEventTimes: new Map(),\n      filteredCount: 0\n    }\n  },\n\n  windowEvents: new Set([\n    'popstate',\n    'hashchange',\n    'resize',\n    'scroll',\n    'load',\n    'pagehide',\n    'visibilitychange',\n    'beforeunload',\n    'online',\n    'offline',\n    'message',\n    'storage'\n  ]),\n\n  // Define events that don't use passive mode and can call preventDefault\n  nonPassiveEvents: new Set([\n    'click',\n    'submit',\n    'dragstart',\n    'dragenter',\n    'dragleave',\n    'dragover',\n    'drop',\n    'touchstart',\n    'touchmove',\n    'wheel',\n    'keydown',\n    'paste'\n  ]),\n\n  supportedEvents: [\n    'click', 'dblclick', 'mousedown', 'mouseup', 'mousemove',\n    'mouseenter', 'mouseleave', 'mouseover', 'mouseout',\n    'submit', 'change', 'input', 'focus', 'blur',\n    'keydown', 'keyup', 'keypress', 'paste',\n    'touchstart', 'touchend', 'touchmove', 'touchcancel',\n    'dragstart', 'dragend', 'dragenter', 'dragleave', 'dragover', 'drop',\n    'scroll', 'resize', 'contextmenu', 'wheel',\n    'popstate', 'hashchange'\n  ],\n\n  uiEvents: new Set([\n    'resize',\n    'scroll',\n    'mousemove',\n    'touchmove',\n    'drag',\n    'dragover'\n  ]),\n\n  init() {\n    if (this.state.initialized) return this;\n\n    this.config.filtering.highFrequencyEvents = new Set([\n      'mousemove',\n      'scroll',\n      'resize',\n      'touchmove',\n      'pointermove'\n    ]);\n\n    this.state.filtering = {\n      throttleTimers: new Map(),\n      debounceTimers: new Map(),\n      lastEventTimes: new Map(),\n      filteredCount: 0\n    };\n\n    this.setupGlobalHandlers();\n    this.setupCleanup();\n    this.observeDOM();\n    this.setupMemoryMonitoring();\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  setupGlobalHandlers() {\n    this.supportedEvents.forEach(type => {\n      this.config.delegation.rootElement.addEventListener(type, e => this.handleEvent(e), {\n        capture: true,\n        passive: !this.nonPassiveEvents.has(type)\n      });\n    });\n\n    this.windowEvents.forEach(type => {\n      window.addEventListener(type, e => this.handleWindowEvent(e), {\n        capture: true,\n        passive: !this.nonPassiveEvents.has(type)\n      });\n    });\n  },\n\n  addHandler(element, type, handler, options = {}) {\n    // Lazy init: ensure global listeners are installed before registering any handler\n    if (!this.state.initialized) {\n      this.init();\n    }\n\n    if (!type || !this.supportedEvents.includes(type)) {\n      throw new Error(`Unsupported event: ${type}`);\n    }\n\n    const isWindowEvent = this.windowEvents.has(type);\n    if (isWindowEvent) {\n      element = window;\n    }\n\n    const isDocumentEvent = element === document;\n\n    if (!element || !(element instanceof Element || element === window || element === document)) {\n      throw new Error('Invalid element provided');\n    }\n\n    if (typeof handler !== 'function') {\n      throw new Error('Handler must be a function');\n    }\n\n    const id = ++this.state.idCounter;\n    const entry = {\n      id,\n      type,\n      handler,\n      element,\n      isWindowEvent,\n      isDocumentEvent,\n      timestamp: Date.now(),\n      options: {\n        capture: Boolean(options.capture),\n        once: Boolean(options.once),\n        passive: Boolean(options.passive),\n        priority: Number(options.priority) || 0,\n        componentId: options.componentId,\n        selector: options.selector\n      }\n    };\n\n    this.state.handlers.set(id, entry);\n    if (!isWindowEvent) {\n      if (!this.state.elementHandlers.has(element)) {\n        this.state.elementHandlers.set(element, new Map());\n      }\n\n      const elementHandlers = this.state.elementHandlers.get(element);\n      if (!elementHandlers.has(type)) {\n        elementHandlers.set(type, new Set());\n      }\n\n      elementHandlers.get(type).add(id);\n\n      if (this.config.delegation.enabled && options.selector) {\n        if (!this.state.delegatedEvents.has(type)) {\n          this.state.delegatedEvents.set(type, new Map());\n        }\n        const typeSelectors = this.state.delegatedEvents.get(type);\n        if (!typeSelectors.has(options.selector)) {\n          typeSelectors.set(options.selector, new Set());\n        }\n        typeSelectors.get(options.selector).add(id);\n      }\n    }\n\n    return id;\n  },\n\n  removeHandler(id) {\n    const entry = this.state.handlers.get(id);\n    if (!entry) return false;\n\n    const {element, type} = entry;\n    const elementHandlers = this.state.elementHandlers.get(element);\n    if (elementHandlers) {\n      const typeHandlers = elementHandlers.get(type);\n      if (typeHandlers) {\n        typeHandlers.delete(id);\n        if (typeHandlers.size === 0) {\n          elementHandlers.delete(type);\n        }\n      }\n      if (elementHandlers.size === 0) {\n        this.state.elementHandlers.delete(element);\n      }\n    }\n\n    return this.state.handlers.delete(id);\n  },\n\n  handleEvent(event) {\n    if (!this.shouldProcessEvent(event)) return;\n\n    try {\n      if (event.type === 'keydown' || event.type === 'keyup' || event.type === 'keypress') {\n        const enhancedKeyEvent = this.handleKeyboardEvent(event);\n        event._enhanced = enhancedKeyEvent;\n      }\n\n      if (this.uiEvents.has(event.type)) {\n        this.queueUIEvent(event);\n        return;\n      }\n\n      this.processEvent(event);\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'EventSystemManager.handleEvent',\n        data: {event}\n      });\n    }\n  },\n\n  handleKeyboardEvent(event) {\n    const enhancedEvent = {\n      originalEvent: event,\n      key: event.key,\n      code: event.code,\n      keyCode: event.keyCode,\n\n      ctrlKey: event.ctrlKey || false,\n      altKey: event.altKey || false,\n      shiftKey: event.shiftKey || false,\n      metaKey: event.metaKey || false,\n\n      isEnter: event.key === 'Enter',\n      isShiftEnter: event.key === 'Enter' && event.shiftKey,\n      isCtrlEnter: event.key === 'Enter' && event.ctrlKey,\n      isAltEnter: event.key === 'Enter' && event.altKey,\n\n      isTab: event.key === 'Tab',\n      isShiftTab: event.key === 'Tab' && event.shiftKey,\n\n      isArrowKey: ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key),\n\n      preventDefault() {\n        event.preventDefault();\n      },\n      stopPropagation() {\n        event.stopPropagation();\n      }\n    };\n\n    return enhancedEvent;\n  },\n\n  handleWindowEvent(event) {\n    if (!this.shouldProcessEvent(event)) {\n      return;\n    }\n\n    try {\n      const context = {\n        stopped: false,\n        immediateStopped: false,\n        path: [window],\n        type: event.type,\n        key: event.key,\n        shiftKey: event.shiftKey,\n        ctrlKey: event.ctrlKey,\n        altKey: event.altKey,\n        metaKey: event.metaKey,\n        originalEvent: event,\n        target: window,\n        currentTarget: window,\n        processedHandlers: new Set()\n      };\n\n      const handlers = Array.from(this.state.handlers.entries())\n        .filter(([_, entry]) =>\n          entry.isWindowEvent &&\n          entry.type === event.type\n        )\n        .sort((a, b) =>\n          (b[1].options.priority || 0) - (a[1].options.priority || 0)\n        );\n\n      for (const [id, entry] of handlers) {\n        if (context.immediateStopped) break;\n\n        if (!context.processedHandlers.has(id)) {\n          context.processedHandlers.add(id);\n          this.executeHandler(entry, context);\n        }\n      }\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'EventSystemManager.handleWindowEvent',\n        data: {event}\n      });\n    }\n  },\n\n  queueUIEvent(event) {\n    const type = event.type;\n    this.state.uiEventQueue.set(type, event);\n\n    if (!this.state.rafScheduled) {\n      this.state.rafScheduled = true;\n      requestAnimationFrame(() => {\n        this.processUIEventQueue();\n      });\n    }\n  },\n\n  processUIEventQueue() {\n    this.state.rafScheduled = false;\n\n    for (const [type, event] of this.state.uiEventQueue) {\n      this.processEvent(event);\n    }\n\n    this.state.uiEventQueue.clear();\n  },\n\n  processEvent(event) {\n    const path = this.getEventPath(event);\n    const type = event.type;\n\n    const context = {\n      stopped: false,\n      immediateStopped: false,\n      path: path,\n      type: type,\n      key: event.key,\n      shiftKey: event.shiftKey,\n      ctrlKey: event.ctrlKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      originalEvent: event,\n      target: event.target,\n      currentTarget: null,\n      processedHandlers: new Set()\n    };\n\n    for (let i = path.length - 1; i >= 0; i--) {\n      if (context.stopped) break;\n      context.currentTarget = path[i];\n      this.processElementHandlers(context, true);\n    }\n\n    if (!context.stopped) {\n      for (let i = 0; i < path.length; i++) {\n        if (context.stopped) break;\n        context.currentTarget = path[i];\n        this.processElementHandlers(context, false);\n      }\n    }\n  },\n\n  processElementHandlers(context, capture) {\n    const elementHandlers = this.state.elementHandlers.get(context.currentTarget);\n    if (!elementHandlers) return;\n\n    const typeHandlers = elementHandlers.get(context.type);\n\n    if (!typeHandlers || typeHandlers.size === 0) return;\n\n    // Collect stale IDs for cleanup\n    const staleIds = [];\n\n    const handlers = Array.from(typeHandlers)\n      .map(id => {\n        const entry = this.state.handlers.get(id);\n        // Track stale IDs for cleanup\n        if (!entry) {\n          staleIds.push(id);\n        }\n        return entry;\n      })\n      .filter(entry => {\n        // Check if entry exists first\n        if (!entry) {\n          return false;\n        }\n        if (context.processedHandlers.has(entry.id)) {\n          return false;\n        }\n        const captureMatch = entry.options.capture === capture;\n        return captureMatch;\n      })\n      .sort((a, b) => (b.options.priority || 0) - (a.options.priority || 0));\n\n    // Clean up stale IDs from typeHandlers to prevent future lookup failures\n    if (staleIds.length > 0) {\n      staleIds.forEach(id => typeHandlers.delete(id));\n    }\n\n    for (const entry of handlers) {\n      if (context.immediateStopped) break;\n\n      const shouldHandle = this.shouldHandleEvent(entry, context);\n      if (shouldHandle) {\n        context.processedHandlers.add(entry.id);\n        this.executeHandler(entry, context);\n      }\n    }\n  },\n\n  shouldHandleEvent(entry, event) {\n    if (entry.options.selector) {\n      const delegateTarget = this.findDelegateTarget(event.target, entry.options.selector);\n      if (!delegateTarget) return false;\n      event.delegateTarget = delegateTarget;\n    }\n    return true;\n  },\n\n  findDelegateTarget(target, selector) {\n    const cacheKey = target;\n    const cache = this.state.selectorMatchCache;\n\n    if (!cache.has(cacheKey)) {\n      cache.set(cacheKey, new Map());\n    }\n\n    const targetCache = cache.get(cacheKey);\n    if (targetCache.has(selector)) {\n      return targetCache.get(selector);\n    }\n\n    try {\n      const closest = target.closest(selector);\n      const result = closest && this.config.delegation.rootElement.contains(closest)\n        ? closest\n        : null;\n\n      targetCache.set(selector, result);\n      return result;\n    } catch (error) {\n      ErrorManager.handle(`Invalid selector: ${selector}`, {\n        context: 'EventSystemManager.findDelegateTarget',\n        data: {target, selector, error}\n      });\n      targetCache.set(selector, null);\n      return null;\n    }\n  },\n\n  executeHandler(entry, context) {\n    try {\n      const wrappedEvent = {\n        type: context.type,\n        key: context.key,\n        shiftKey: context.shiftKey,\n        ctrlKey: context.ctrlKey,\n        altKey: context.altKey,\n        metaKey: context.metaKey,\n        target: context.target,\n        currentTarget: context.currentTarget,\n        delegateTarget: context.delegateTarget,\n        timestamp: Date.now(),\n        originalEvent: context.originalEvent,\n\n        preventDefault() {\n          context.originalEvent.preventDefault();\n        },\n\n        stopPropagation() {\n          context.stopped = true;\n          context.originalEvent.stopPropagation();\n        },\n\n        stopImmediatePropagation() {\n          context.stopped = true;\n          context.immediateStopped = true;\n          context.originalEvent.stopImmediatePropagation();\n        },\n\n        matches(selector) {\n          return context.target.matches?.(selector) || false;\n        }\n      };\n\n      let handlerContext;\n      if (entry.isWindowEvent) {\n        handlerContext = window;\n      } else if (entry.isDocumentEvent) {\n        handlerContext = document;\n      } else if (entry.options.selector && context.delegateTarget) {\n        handlerContext = context.delegateTarget;\n      } else {\n        handlerContext = entry.element;\n      }\n\n      const boundHandler = entry.handler.bind(handlerContext);\n      return boundHandler(wrappedEvent);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'EventSystemManager.executeHandler',\n        data: {\n          handlerId: entry.id,\n          type: context.type,\n          target: context.target\n        }\n      });\n    }\n  },\n\n  getEventPath(event) {\n    if (event && typeof event.composedPath === 'function') {\n      return event.composedPath();\n    }\n\n    // Fallback for event.target-based path construction\n    const target = event?.target || event;\n\n    if (this.state.eventPaths.has(target)) {\n      return this.state.eventPaths.get(target);\n    }\n\n    const path = [];\n    let current = target;\n\n    while (current && current !== window) {\n      path.push(current);\n      current = current.parentElement || current.parentNode;\n    }\n\n    if (document) path.push(document);\n    if (window) path.push(window);\n\n    this.state.eventPaths.set(target, path);\n    return path;\n  },\n\n  setupCleanup() {\n    if (this.state.cleanupTimer) {\n      clearInterval(this.state.cleanupTimer);\n    }\n\n    this.state.cleanupTimer = setInterval(() => {\n      this.cleanup();\n    }, this.config.cleanupInterval);\n  },\n\n  observeDOM() {\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        mutation.removedNodes.forEach(node => {\n          if (node.nodeType === 1) {\n            setTimeout(() => {\n              if (!node.isConnected) {\n                this.removeElementHandlers(node);\n              }\n            }, 0);\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n  },\n\n  removeElementHandlers(element) {\n    const handlers = this.state.elementHandlers.get(element);\n    if (handlers) {\n      handlers.forEach((typeHandlers, type) => {\n        typeHandlers.forEach(id => {\n          this.removeHandler(id);\n        });\n      });\n      this.state.elementHandlers.delete(element);\n    }\n  },\n\n  removeComponentHandlers(componentId) {\n    const handlersToRemove = [];\n    this.state.handlers.forEach((entry, id) => {\n      if (entry.options.componentId === componentId) {\n        handlersToRemove.push(id);\n      }\n    });\n    handlersToRemove.forEach(id => this.removeHandler(id));\n  },\n\n  cleanup() {\n    const now = Date.now();\n\n    this.state.handlers.forEach((entry, id) => {\n      if (entry.element === window || entry.element === document) {\n        return;\n      }\n\n      if (!document.contains(entry.element)) {\n        this.removeHandler(id);\n      }\n    });\n\n    this.state.eventPaths = new WeakMap();\n    this.state.delegationCache = new WeakMap();\n    this.state.selectorMatchCache = new WeakMap();\n\n    this.state.uiEventQueue.clear();\n\n    this.state.filtering = {\n      throttleTimers: new Map(),\n      debounceTimers: new Map(),\n      lastEventTimes: new Map(),\n      filteredCount: 0\n    };\n\n    if (this.state.memoryUsage > this.config.maxMemoryUsage) {\n      this.performGC();\n    }\n  },\n\n  setupMemoryMonitoring() {\n    this.state.gcTimer = setInterval(() => {\n      this.checkMemoryUsage();\n    }, this.config.memoryManagement.checkInterval);\n  },\n\n  checkMemoryUsage() {\n    const stats = this.gatherMemoryStats();\n    this.updateMemoryStats(stats);\n\n    if (this.shouldTriggerGC(stats)) {\n      this.performGC();\n    }\n\n    if (this.config.memoryManagement.detailedTracking) {\n      this.logMemoryWarnings(stats);\n    }\n  },\n\n  gatherMemoryStats() {\n    const stats = {\n      handlerCount: this.state.handlers.size,\n      cacheSize: this.state.selectorCache.size,\n      weakMapSize: this.estimateWeakMapSize(),\n      timestamp: Date.now(),\n      elementHandlers: new Map()\n    };\n\n    this.state.elementHandlers.forEach((handlers, element) => {\n      let count = 0;\n      handlers.forEach(typeHandlers => {\n        count += typeHandlers.size;\n      });\n      if (count > 0) {\n        stats.elementHandlers.set(element, count);\n      }\n    });\n\n    return stats;\n  },\n\n  estimateWeakMapSize() {\n    const sampleSize = Math.min(100, Math.max(20, Math.floor(document.querySelectorAll('*').length * 0.1)));\n\n    const start = performance.now();\n\n    const elements = Array.from(document.querySelectorAll('*'));\n\n    const sample = [];\n    const step = Math.floor(elements.length / sampleSize);\n\n    for (let i = 0; i < elements.length && sample.length < sampleSize; i += step) {\n      sample.push(elements[i]);\n    }\n\n    let sampleCount = 0;\n    sample.forEach(element => {\n      if (this.state.elementHandlers.has(element)) sampleCount++;\n      if (this.state.eventPaths.has(element)) sampleCount++;\n      if (this.state.delegationCache.has(element)) sampleCount++;\n      if (this.state.selectorMatchCache.has(element)) sampleCount++;\n    });\n\n    const estimatedSize = Math.round(\n      (sampleCount / sample.length) * elements.length\n    );\n\n    const duration = performance.now() - start;\n\n    return estimatedSize;\n  },\n\n  updateMemoryStats(stats) {\n    const memoryStats = this.state.memoryStats;\n    memoryStats.handlerCount = stats.handlerCount;\n    memoryStats.cacheSize = stats.cacheSize;\n    memoryStats.weakMapSize = stats.weakMapSize;\n    memoryStats.peakMemoryUsage = Math.max(\n      memoryStats.peakMemoryUsage,\n      stats.handlerCount + stats.cacheSize\n    );\n  },\n\n  shouldTriggerGC(stats) {\n    const threshold = this.config.memoryManagement.gcThreshold;\n    const maxHandlers = this.config.memoryManagement.maxHandlersPerElement;\n\n    return (\n      stats.handlerCount > (this.config.maxMemoryUsage * threshold) ||\n      stats.cacheSize > this.config.memoryManagement.maxCacheSize ||\n      Array.from(stats.elementHandlers.values()).some(count => count > maxHandlers)\n    );\n  },\n\n  performGC() {\n    const now = Date.now();\n    const stats = {\n      handlersRemoved: 0,\n      cachesCleared: 0\n    };\n\n    this.state.handlers.forEach((entry, id) => {\n      if (this.isHandlerStale(entry, now)) {\n        this.removeHandler(id);\n        stats.handlersRemoved++;\n      }\n    });\n\n    this.clearUnusedCaches();\n    stats.cachesCleared = this.state.selectorCache.size;\n\n    this.state.memoryStats.lastGC = now;\n\n    if (this.config.memoryManagement.detailedTracking) {\n      console.info('GC Stats:', stats);\n    }\n  },\n\n  isHandlerStale(entry, now) {\n    if (!entry.timestamp) return false;\n\n    const age = now - entry.timestamp;\n    const element = entry.element;\n\n    return (\n      age > this.config.cleanupInterval * 2 ||\n      !document.contains(element) ||\n      !this.isElementVisible(element)\n    );\n  },\n\n  clearUnusedCaches() {\n    for (const [selector, timestamp] of this.state.selectorCache) {\n      if (Date.now() - timestamp > this.config.cleanupInterval) {\n        this.state.selectorCache.delete(selector);\n      }\n    }\n\n    if (this.state.memoryStats.weakMapSize > this.config.memoryManagement.maxCacheSize) {\n      this.state.eventPaths = new WeakMap();\n      this.state.delegationCache = new WeakMap();\n      this.state.selectorMatchCache = new WeakMap();\n    }\n  },\n\n  logMemoryWarnings(stats) {\n    const warnings = [];\n    const maxHandlers = this.config.memoryManagement.maxHandlersPerElement;\n\n    stats.elementHandlers.forEach((count, element) => {\n      if (count > maxHandlers) {\n        warnings.push(`Element has too many handlers (${count}): ${element.tagName}`);\n      }\n    });\n\n    if (warnings.length > 0) {\n      this.state.memoryStats.memoryWarnings++;\n      console.warn('Memory warnings:', warnings);\n    }\n  },\n\n  destroy() {\n    if (this.state.cleanupTimer) {\n      clearInterval(this.state.cleanupTimer);\n    }\n\n    this.state.handlers.clear();\n    this.state.elementHandlers = new WeakMap();\n    this.state.eventPaths = new WeakMap();\n    this.state.delegationCache = new WeakMap();\n    this.state.selectorCache.clear();\n    this.state.selectorMatchCache = new WeakMap();\n    this.state.uiEventQueue.clear();\n    this.state.initialized = false;\n\n    if (this.state.gcTimer) {\n      clearInterval(this.state.gcTimer);\n    }\n    this.state.memoryStats = {\n      handlerCount: 0,\n      cacheSize: 0,\n      weakMapSize: 0,\n      lastGC: 0,\n      peakMemoryUsage: 0,\n      memoryWarnings: 0\n    };\n  },\n\n  shouldProcessEvent(event) {\n    if (!this.config.filtering.enabled) return true;\n\n    const type = event.type;\n\n    if (!this.config.filtering.highFrequencyEvents?.has(type)) {\n      const now = performance.now();\n      const lastTime = this.state.filtering.lastEventTimes.get(type) || 0;\n      const minInterval = 1000 / this.config.filtering.maxThrottleRate;\n\n      if (now - lastTime < minInterval) {\n        this.state.filtering.filteredCount++;\n        return false;\n      }\n\n      this.state.filtering.lastEventTimes.set(type, now);\n    }\n\n    return true;\n  },\n\n  isRapidFire(event) {\n    const now = performance.now();\n    const type = event.type;\n\n    const lastTime = this.state.filtering.lastEventTimes.get(type) || 0;\n    const minInterval = 1000 / this.config.filtering.maxThrottleRate;\n\n    if (now - lastTime < minInterval) {\n      return true;\n    }\n\n    this.state.filtering.lastEventTimes.set(type, now);\n    return false;\n  },\n\n  throttle(event, handler) {\n    const type = event.type;\n    const now = Date.now();\n    const lastTime = this.state.filtering.throttleTimers.get(type) || 0;\n    const threshold = 1000 / this.config.filtering.maxThrottleRate;\n\n    if (now - lastTime >= threshold) {\n      handler(event);\n      this.state.filtering.throttleTimers.set(type, now);\n    }\n  },\n\n  debounce(event, handler) {\n    const type = event.type;\n    clearTimeout(this.state.filtering.debounceTimers.get(type));\n\n    this.state.filtering.debounceTimers.set(type,\n      setTimeout(() => {\n        handler(event);\n        this.state.filtering.debounceTimers.delete(type);\n      }, this.config.filtering.debounceWait)\n    );\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('eventsystem', EventSystemManager);\n}\n\nwindow.EventSystemManager = EventSystemManager;\n","const StateManager = {\n  config: {\n    debug: false,\n    persistence: {\n      enabled: true,\n      key: 'app_state',\n      blacklist: ['temp', 'ui'],\n      encrypt: false\n    },\n    history: {\n      enabled: true,\n      maxSize: 50,\n      include: ['user', 'data']\n    },\n    batch: {\n      enabled: true,\n      delay: 16\n    },\n    strict: true\n  },\n\n  state: {},\n  modules: new Map(),\n  computed: new Map(),\n  watchers: new Map(),\n  subscriptions: new Map(),\n  subscriberCount: 0,\n  activeSubscriptions: new Set(),\n  history: [],\n  historyIndex: -1,\n  isTimeTraveling: false,\n  middleware: [],\n  batchQueue: new Map(),\n  batchTimeout: null,\n\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    await this.restoreState();\n    this.setupReactivity();\n\n    return this;\n  },\n\n  setupReactivity() {\n    this.state = new Proxy(this.state, {\n      set: (target, property, value) => {\n        target[property] = value;\n        this.notifyWatchers(property);\n        return true;\n      }\n    });\n  },\n\n  hasModule(name) {\n    return this.modules.has(name);\n  },\n\n  registerModule(name, module, options = {}) {\n    if (this.modules.has(name)) {\n      const oldModule = this.modules.get(name);\n\n      if (options.force) {\n        if (oldModule.cleanup) {\n          try {\n            oldModule.cleanup();\n          } catch (error) {\n            console.warn(`[StateManager] Error cleaning up module \"${name}\": ${error.message}`);\n          }\n        }\n\n        this.modules.delete(name);\n        if (this.state[name]) {\n          delete this.state[name];\n        }\n\n        for (const [key, computed] of this.computed.entries()) {\n          if (key.startsWith(`${name}.`)) {\n            this.computed.delete(key);\n          }\n        }\n\n        for (const [path, handlers] of this.watchers.entries()) {\n          if (path.startsWith(`${name}.`)) {\n            this.watchers.delete(path);\n          }\n        }\n\n        for (const [path, subs] of this.subscriptions.entries()) {\n          if (path.startsWith(`${name}.`)) {\n            subs.forEach((sub) => this.unsubscribe(sub.id));\n            this.subscriptions.delete(path);\n          }\n        }\n\n        this.history = this.history.map(entry => {\n          if (entry.state && entry.state[name]) {\n            const newEntry = {...entry};\n            delete newEntry.state[name];\n            return newEntry;\n          }\n          return entry;\n        });\n\n        if (this.config.debug) {\n          console.warn(`[StateManager] Force registering module \"${name}\". Module data completely reset.`);\n        }\n      } else {\n        if (this.config.debug) {\n          console.warn(`[StateManager] Module \"${name}\" already exists. Use force:true to replace.`);\n        }\n        return oldModule;\n      }\n    }\n\n    const initialState = typeof module.state === 'function'\n      ? module.state()\n      : module.state;\n\n    const registeredModule = {\n      ...module,\n      initialState: JSON.parse(JSON.stringify(initialState)),\n      state: initialState\n    };\n\n    this.modules.set(name, registeredModule);\n\n    if (!this.state[name]) {\n      this.state[name] = JSON.parse(JSON.stringify(initialState));\n    }\n\n    if (module.computed) {\n      Object.entries(module.computed).forEach(([key, getter]) => {\n        this.registerComputed(`${name}.${key}`, getter);\n      });\n    }\n\n    if (module.watch) {\n      Object.entries(module.watch).forEach(([path, handler]) => {\n        this.watch(path, handler);\n      });\n    }\n\n    if (registeredModule.init) {\n      registeredModule.init(this.getModuleContext(name));\n    }\n\n    return this;\n  },\n\n  processModule(name, module) {\n    return {\n      name,\n      state: module.state || {},\n      mutations: this.processMutations(module.mutations || {}),\n      actions: this.processActions(module.actions || {}),\n      getters: module.getters || {},\n      init: module.init,\n      computed: module.computed || {},\n      watch: module.watch || {}\n    };\n  },\n\n  processMutations(mutations) {\n    return Object.entries(mutations).reduce((acc, [key, mutation]) => {\n      acc[key] = (state, payload) => {\n        if (this.config.strict && !this.isTimeTraveling) {\n          console.log('[StateManager]', `Mutation: ${key}`, payload);\n        }\n        mutation(state, payload);\n      };\n      return acc;\n    }, {});\n  },\n\n  processActions(actions) {\n    return Object.entries(actions).reduce((acc, [key, action]) => {\n      acc[key] = async (context, payload) => {\n        try {\n          return await action(context, payload);\n        } catch (error) {\n          this.handleError('Action error', {action: key, error}, 'processActions');\n          throw error;\n        }\n      };\n      return acc;\n    }, {});\n  },\n\n  getModuleContext(name) {\n    const module = this.modules.get(name);\n    if (!module) throw new Error(`Module ${name} not found`);\n\n    return {\n      state: this.state[name],\n      getters: this.getModuleGetters(name),\n      commit: (type, payload) => this.commit(`${name}/${type}`, payload),\n      dispatch: (type, payload) => this.dispatch(`${name}/${type}`, payload),\n      watch: (path, handler) => this.watch(`${name}.${path}`, handler)\n    };\n  },\n\n  getModuleGetters(name) {\n    const module = this.modules.get(name);\n    return Object.entries(module.getters).reduce((acc, [key, getter]) => {\n      Object.defineProperty(acc, key, {\n        get: () => getter(this.state[name], acc)\n      });\n      return acc;\n    }, {});\n  },\n\n  commit(type, payload) {\n    try {\n      const [moduleName, mutationName] = type.split('/');\n      const module = this.modules.get(moduleName);\n\n      if (!module) {\n        throw new Error(`Module ${moduleName} not found`);\n      }\n\n      const mutation = module.mutations?.[mutationName];\n      if (!mutation) {\n        throw new Error(`Mutation ${mutationName} not found in module ${moduleName}`);\n      }\n\n      mutation(this.state[moduleName], payload);\n      this.addToHistory(type, payload);\n      this.notifyWatchers(moduleName);\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'StateManager.commit',\n        type: 'error:state',\n        data: {type, payload}\n      });\n      throw error;\n    }\n  },\n\n  async dispatch(type, payload) {\n    try {\n      const [moduleName, actionName] = type.split('/');\n      const module = this.modules.get(moduleName);\n\n      if (!module) {\n        throw new Error(`Module ${moduleName} not found`);\n      }\n\n      const action = module.actions?.[actionName];\n      if (!action) {\n        throw new Error(`Action ${actionName} not found in module ${moduleName}`);\n      }\n\n      const context = this.getModuleContext(moduleName);\n      return await action(context, payload);\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'StateManager.dispatch',\n        type: 'error:state',\n        data: {type, payload}\n      });\n      throw error;\n    }\n  },\n\n  registerComputed(path, getter) {\n    this.computed.set(path, {\n      getter,\n      cache: null,\n      deps: new Set()\n    });\n\n    let currentComputed = null;\n    Object.defineProperty(this.state, path, {\n      get: () => {\n        const computed = this.computed.get(path);\n\n        if (currentComputed && currentComputed !== path) {\n          computed.deps.add(currentComputed);\n        }\n\n        if (computed.cache === null) {\n          currentComputed = path;\n          computed.cache = getter(this.state);\n          currentComputed = null;\n        }\n\n        return computed.cache;\n      }\n    });\n  },\n\n  watch(path, callback) {\n    try {\n      if (!this.isValidPath(path)) {\n        throw new Error(`Invalid state path: ${path}`);\n      }\n\n      if (!this.watchers.has(path)) {\n        this.watchers.set(path, new Set());\n      }\n      this.watchers.get(path).add(callback);\n\n      return () => {\n        const handlers = this.watchers.get(path);\n        if (handlers) {\n          handlers.delete(callback);\n        }\n      };\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'StateManager.watch',\n        type: 'error:state',\n        data: {path}\n      });\n      throw error;\n    }\n  },\n\n  notifyWatchers(moduleName) {\n    this.watchers.forEach((handlers, path) => {\n      if (path.startsWith(moduleName)) {\n        const value = this.getStateValue(path);\n        handlers.forEach(handler => {\n          try {\n            handler(value);\n          } catch (error) {\n            this.handleError('Watcher error', {path, error}, 'notifyWatchers');\n          }\n        });\n      }\n    });\n\n    this.computed.forEach((computed, path) => {\n      if (path.startsWith(moduleName)) {\n        computed.cache = null;\n        computed.deps.forEach(dep => {\n          const dependent = this.computed.get(dep);\n          if (dependent) {\n            dependent.cache = null;\n          }\n        });\n      }\n    });\n  },\n\n  getStateValue(path) {\n    return path.split('.').reduce((obj, key) => obj[key], this.state);\n  },\n\n  use(middleware) {\n    this.middleware.push(middleware);\n    return this;\n  },\n\n  async runMiddleware(hook, context) {\n    for (const middleware of this.middleware) {\n      if (middleware[hook]) {\n        await middleware[hook](context);\n      }\n    }\n  },\n\n  addToHistory(type, payload) {\n    if (!this.config.history.enabled || this.isTimeTraveling) return;\n\n    const snapshot = {};\n    Object.keys(this.state).forEach(module => {\n      if (this.state[module]) {\n        snapshot[module] = JSON.parse(JSON.stringify(this.state[module]));\n      }\n    });\n\n    this.history = this.history.slice(0, this.historyIndex + 1);\n\n    this.history.push({\n      type,\n      payload: payload !== undefined ? JSON.parse(JSON.stringify(payload)) : null,\n      state: snapshot,\n      timestamp: Date.now()\n    });\n\n    if (this.history.length > this.config.history.maxSize) {\n      this.history.shift();\n    }\n\n    this.historyIndex = this.history.length - 1;\n  },\n\n  subscribe(path, callback, options = {}) {\n    if (!path || typeof path !== 'string') {\n      throw new Error('Path must be a string');\n    }\n\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    const subId = `sub_${this.subscriberCount++}`;\n\n    const subscription = {\n      id: subId,\n      path,\n      callback,\n      options: {\n        immediate: true,\n        deep: false,\n        ...options\n      },\n      active: true,\n      timestamp: Date.now()\n    };\n\n    if (!this.subscriptions.has(path)) {\n      this.subscriptions.set(path, new Map());\n    }\n    this.subscriptions.get(path).set(subId, subscription);\n\n    this.activeSubscriptions.add(subId);\n\n    if (subscription.options.immediate) {\n      const value = this.get(path);\n      try {\n        callback(value);\n      } catch (error) {\n        this.handleError('Immediate subscription callback', error, 'subscribe');\n      }\n    }\n\n    return () => this.unsubscribe(subId);\n  },\n\n  unsubscribe(subscriptionId) {\n    let found = false;\n    this.subscriptions.forEach((subs, path) => {\n      if (subs.has(subscriptionId)) {\n        subs.delete(subscriptionId);\n        this.activeSubscriptions.delete(subscriptionId);\n        found = true;\n\n        if (subs.size === 0) {\n          this.subscriptions.delete(path);\n        }\n      }\n    });\n\n    if (!found && this.config.debug) {\n      console.warn(`[StateManager] Subscription ${subscriptionId} not found`);\n    }\n  },\n\n  notifySubscribers(path, value, oldValue) {\n    const subs = this.subscriptions.get(path);\n    if (!subs) return;\n\n    subs.forEach(sub => {\n      if (!sub.active) return;\n\n      try {\n        if (sub.options.deep && typeof value === 'object') {\n          if (JSON.stringify(value) === JSON.stringify(oldValue)) {\n            return;\n          }\n        }\n\n        sub.callback(value, oldValue);\n\n      } catch (error) {\n        this.handleError(`Subscription callback for ${path}`, error, 'notifySubscribers');\n        sub.active = false;\n      }\n    });\n  },\n\n  get(path) {\n    return path.split('.').reduce((obj, key) => obj?.[key], this.state);\n  },\n\n  set(path, value) {\n    const parts = path.split('.');\n    const key = parts.pop();\n    const target = parts.length ?\n      parts.reduce((obj, key) => obj[key], this.state) :\n      this.state;\n\n    if (target) {\n      target[key] = value;\n      this.notifySubscribers(path, value);\n    }\n  },\n\n  cleanupSubscriptions() {\n    const now = Date.now();\n    const maxAge = this.config.cleanup.maxSubscriptionAge || 3600000;\n\n    this.subscriptions.forEach((subs, path) => {\n      subs.forEach((sub, id) => {\n        if (!sub.active || (now - sub.timestamp > maxAge)) {\n          this.unsubscribe(id);\n        }\n      });\n    });\n  },\n\n  timeTravel(index) {\n    try {\n      if (!this.config.history.enabled || index < 0 || index >= this.history.length) {\n        throw new Error('Invalid history index');\n      }\n\n      this.isTimeTraveling = true;\n      try {\n        const historyEntry = this.history[index];\n        if (!historyEntry || !historyEntry.state) {\n          throw new Error('Invalid history entry');\n        }\n\n        Object.keys(historyEntry.state).forEach(module => {\n          if (historyEntry.state[module]) {\n            this.state[module] = JSON.parse(JSON.stringify(historyEntry.state[module]));\n          }\n        });\n\n        this.historyIndex = index;\n\n        Object.keys(this.state).forEach(module => {\n          this.notifyWatchers(module);\n          if (this.state[module] && this.state[module].count !== undefined) {\n            this.notifySubscribers(`${module}.count`, this.state[module].count);\n          }\n        });\n      } catch (error) {\n        throw error;\n      } finally {\n        this.isTimeTraveling = false;\n      }\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'StateManager.timeTravel',\n        type: 'error:state',\n        data: {index}\n      });\n      throw error;\n    }\n  },\n\n  persistState() {\n    try {\n      if (!this.config.persistence.enabled) return;\n\n      const state = JSON.stringify(this.state);\n      localStorage.setItem(this.config.persistence.key, state);\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'StateManager.persistState',\n        type: 'error:state',\n        data: {state: this.state}\n      });\n      throw error;\n    }\n  },\n\n  async restoreState() {\n    if (!this.config.persistence.enabled) return;\n\n    const data = localStorage.getItem(this.config.persistence.key);\n    if (!data) return;\n\n    try {\n      const state = this.config.persistence.encrypt\n        ? await this.decrypt(data)\n        : JSON.parse(data);\n\n      Object.assign(this.state, state);\n\n    } catch (error) {\n      this.handleError('State restoration failed', error, 'restoreState');\n    }\n  },\n\n  batch(callback) {\n    if (!this.config.batch.enabled) {\n      return callback();\n    }\n\n    const execute = async () => {\n      const queue = Array.from(this.batchQueue.values());\n      this.batchQueue.clear();\n\n      for (const task of queue) {\n        await task();\n      }\n    };\n\n    const id = Date.now();\n    this.batchQueue.set(id, callback);\n\n    if (this.batchTimeout) {\n      clearTimeout(this.batchTimeout);\n    }\n\n    this.batchTimeout = setTimeout(\n      execute,\n      this.config.batch.delay\n    );\n  },\n\n  handleError(message, error, type) {\n    const errorObj = error || new Error(message);\n\n    const data = {\n      message,\n      error: error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      } : null,\n      timestamp: new Date().toISOString(),\n      moduleStates: {},\n      activeSubscriptions: Array.from(this.activeSubscriptions),\n      batchQueueSize: this.batchQueue.size\n    };\n\n    this.modules.forEach((module, name) => {\n      data.moduleStates[name] = {\n        hasState: !!this.state[name],\n        subscriberCount: this.getModuleSubscriberCount(name)\n      };\n    });\n\n    ErrorManager.handle(errorObj, {\n      context: `StateManager.${type}`,\n      type: 'error:state',\n      data,\n      notify: true\n    });\n  },\n\n  reset() {\n    this.modules.forEach((module, name) => {\n      if (module.initialState) {\n        this.state[name] = JSON.parse(JSON.stringify(module.initialState));\n      }\n    });\n\n    this.history = [];\n    this.historyIndex = -1;\n    this.computed.forEach(computed => computed.cache = null);\n\n    Object.keys(this.state).forEach(name => {\n      this.notifyWatchers(name);\n      if (this.state[name]?.count !== undefined) {\n        this.notifySubscribers(`${name}.count`, this.state[name].count);\n      }\n    });\n\n    if (this.config.persistence.enabled) {\n      this.persistState();\n    }\n  },\n\n  isValidPath(path) {\n    if (!path || typeof path !== 'string') return false;\n    const parts = path.split('.');\n    return parts.length >= 1 && parts.every(part => part.length > 0);\n  }\n};\n\nwindow.StateManager = StateManager;\n","const ScrollManager = {\n  config: {\n    enabled: false,\n\n    core: {\n      offset: 0,\n      duration: 500,\n      easing: 'easeInOutCubic'\n    },\n\n    selectors: {\n      container: 'body',\n      content: '#main',\n      tracked: '[data-scroll-track]',\n      anchors: '[data-scroll-anchor]',\n      waypoints: '[data-scroll-waypoint]',\n      ignore: '[data-scroll-ignore]',\n      reveal: '[data-scroll-reveal]',\n      nav: '[data-scroll-nav]',\n      sections: '[data-scroll-section]',\n      parallax: '[data-parallax]',\n      progress: '.scroll-progress'\n    },\n\n    animation: {\n      enabled: true,\n      types: {\n        linear: t => t,\n        easeInOutCubic: t => t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\n        easeOutQuart: t => 1 - (--t) * t * t * t,\n        easeInQuad: t => t * t\n      }\n    },\n\n    performance: {\n      throttle: 16,\n      debounce: 100,\n      passive: true,\n      observer: true,\n      requestAnimationFrame: {\n        enabled: true,\n        maxFPS: 60,\n        skipThreshold: 16\n      },\n      batchSize: 5,\n      maxQueue: 100\n    },\n\n    restoration: {\n      enabled: true,\n      key: 'scroll_positions',\n      ttl: 24 * 60 * 60 * 1000\n    },\n\n    mobile: {\n      enabled: true,\n      touchAction: 'pan-y',\n      momentumScroll: true,\n      pullToRefresh: false,\n      touchThreshold: 5\n    },\n\n    accessibility: {\n      enabled: true,\n      announceChanges: true,\n      smoothFocus: true,\n      ariaLabels: true,\n      focusableSelectors: 'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    },\n\n    waypoints: {\n      offset: 0,\n      threshold: 0.5,\n      once: false,\n      delay: 100\n    },\n\n    scroll: {\n      infinite: {\n        enabled: false,\n        threshold: 100,\n        loadMore: null\n      },\n      parallax: {\n        enabled: false,\n        speed: 0.5\n      },\n      progress: {\n        enabled: false,\n        color: 'var(--color-primary)',\n        height: '3px',\n        zIndex: 1000\n      },\n      snap: {\n        enabled: false,\n        type: 'y',\n        stop: true,\n        align: 'start'\n      },\n      section: {\n        highlight: true,\n        threshold: 0.5,\n        activeClass: 'active'\n      },\n      nav: {\n        updateHash: true,\n        highlightClass: 'active',\n        smoothScroll: true\n      }\n    },\n\n    smoothScroll: {\n      enabled: false,\n      autoScroll: false,\n      selector: 'a[href^=\"#\"]',\n      excludeSelector: '.no-smooth',\n      hashChangeEnabled: true,\n    }\n  },\n\n  state: {\n    initialized: false,\n    isScrolling: false,\n    isLoading: false,\n    activeAnimation: null,\n    positions: new Map(),\n    waypoints: new Map(),\n    observers: new Map(),\n    events: new Map(),\n    history: [],\n    lastPosition: null,\n    scrollRestoration: new Map(),\n    rafId: null,\n    lastFrameTime: 0,\n    touchStartY: null,\n    touchStartX: null,\n    scrollQueue: [],\n    activeSection: null,\n    scrollDirection: null,\n    scrollQueueLock: false\n  },\n\n  async init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = Now.mergeConfig(this.config, options);\n\n    if (!this.config.enabled) {\n      this.state.disabled = true;\n      return this;\n    }\n\n    this.setupSmoothScroll();\n\n    if (!window.requestAnimationFrame) {\n      console.warn('requestAnimationFrame not supported');\n      this.config.animation.enabled = false;\n    }\n\n    if (!window.IntersectionObserver) {\n      console.warn('IntersectionObserver not supported');\n      this.config.performance.observer = false;\n    }\n\n    try {\n      this.setupErrorHandling();\n      await this.initializeCore();\n      if (this.config.performance.observer) {\n        this.initializeObservers();\n      }\n      this.setupScrollTracking();\n      this.setupWaypoints();\n      if (this.config.mobile.enabled) {\n        this.initializeMobileSupport();\n      }\n      if (this.config.accessibility.enabled) {\n        this.initializeAccessibility();\n      }\n      if (this.config.restoration.enabled) {\n        this.initScrollRestoration();\n      }\n      await this.initializeScrollFeatures();\n      this.setupEventListeners();\n      this.state.initialized = true;\n      this.emit('scroll:initialized');\n\n      return this;\n\n    } catch (error) {\n      throw ErrorManager.handle('Initialization failed', {\n        context: 'ScrollManager.init',\n        type: 'scroll:error',\n        data: {error}\n      });\n    }\n  },\n\n  async initializeCore() {\n    this.contentArea = document.querySelector(this.config.selectors.content);\n    if (!this.contentArea) {\n      console.warn(`Main content area not found: ${this.config.selectors.content} in ${document.location.href}`);\n    }\n\n    this.state.scrollQueue = [];\n\n    if ('scrollRestoration' in history) {\n      history.scrollRestoration = 'manual';\n    }\n\n    if (this.config.animation.enabled) {\n      this.initializeAnimationSystem();\n    }\n  },\n\n  setupSmoothScroll() {\n    if (!this.config.smoothScroll.enabled) return;\n\n    if (this.config.smoothScroll.selector) {\n      document.addEventListener('click', (e) => {\n        const anchor = e.target.closest(this.config.smoothScroll.selector);\n        if (!anchor || anchor.matches(this.config.smoothScroll.excludeSelector)) return;\n\n        const targetId = anchor.getAttribute('href').slice(1);\n        if (!targetId) return;\n\n        const target = document.getElementById(targetId);\n        if (!target) return;\n\n        e.preventDefault();\n        this.scrollTo(target, {\n          offset: this.config.core.offset,\n          duration: this.config.core.duration,\n          easing: this.config.core.easing\n        });\n      });\n    }\n\n    if (this.config.smoothScroll.hashChangeEnabled) {\n      window.addEventListener('hashchange', () => {\n        const hash = window.location.hash;\n        if (!hash) return;\n\n        const target = document.querySelector(hash);\n        if (target) {\n          this.scrollTo(target, {\n            offset: this.config.core.offset,\n            duration: this.config.core.duration,\n            easing: this.config.core.easing\n          });\n        }\n      });\n    }\n\n    if (this.config.smoothScroll.autoScroll && window.location.hash) {\n      setTimeout(() => {\n        const target = document.querySelector(window.location.hash);\n        if (target) {\n          this.scrollTo(target, {\n            offset: this.config.core.offset,\n            duration: this.config.core.duration,\n            easing: this.config.core.easing\n          });\n        }\n      }, 100);\n    }\n  },\n\n  async initializeScrollFeatures() {\n    const {scroll} = this.config;\n\n    if (scroll.infinite.enabled) {\n      this.initInfiniteScroll(scroll.infinite.loadMore);\n    }\n\n    if (scroll.parallax.enabled) {\n      this.initParallax();\n    }\n\n    if (scroll.progress.enabled) {\n      this.initProgressBar();\n    }\n\n    if (scroll.snap.enabled) {\n      this.initScrollSnap();\n    }\n\n    if (scroll.section.highlight) {\n      this.initSectionHighlight();\n    }\n\n    if (scroll.nav.updateHash) {\n      this.initScrollNav();\n    }\n  },\n\n  initializeObservers() {\n    if ('IntersectionObserver' in window) {\n      this.state.observers.set('intersection', new IntersectionObserver(\n        entries => this.handleIntersection(entries),\n        {\n          threshold: [0, 0.25, 0.5, 0.75, 1],\n          rootMargin: '20px'\n        }\n      ));\n    }\n\n    if ('MutationObserver' in window) {\n      this.state.observers.set('mutation', new MutationObserver(\n        mutations => this.handleMutations(mutations)\n      ));\n    }\n\n    if ('ResizeObserver' in window) {\n      this.state.observers.set('resize', new ResizeObserver(\n        entries => this.handleResize(entries)\n      ));\n    }\n\n    this.startObservers();\n  },\n\n  handleIntersection(entries) {\n    entries.forEach(entry => {\n      this.state.waypoints.forEach((waypoint, id) => {\n        if (waypoint.element === entry.target) {\n          const isVisible = entry.isIntersecting;\n\n          if (isVisible && !waypoint.triggered) {\n            if (waypoint.options.callback) {\n              waypoint.options.callback(entry);\n            }\n            this.emit('waypoint:trigger', {id, entry});\n\n            if (waypoint.options.once) {\n              waypoint.triggered = true;\n            }\n          }\n        }\n      });\n\n      if (entry.target.hasAttribute('data-scroll-reveal') && entry.isIntersecting) {\n        entry.target.classList.add('revealed');\n        this.emit('scroll:reveal', {element: entry.target});\n      }\n\n      if (entry.target.hasAttribute('data-scroll-section') && entry.isIntersecting) {\n        const id = entry.target.id;\n        this.state.activeSection = id;\n        this.emit('section:active', {id});\n\n        if (this.config.scroll.nav.updateHash && id) {\n          history.replaceState(null, null, `#${id}`);\n        }\n\n        document.querySelectorAll(this.config.selectors.nav).forEach(nav => {\n          nav.querySelectorAll('a').forEach(link => {\n            link.classList.toggle(\n              this.config.scroll.nav.highlightClass,\n              link.getAttribute('href') === `#${id}`\n            );\n          });\n        });\n      }\n    });\n  },\n\n  handleMutations(mutations) {\n    let shouldUpdateWaypoints = false;\n\n    mutations.forEach(mutation => {\n      mutation.addedNodes.forEach(node => {\n        if (node.nodeType === 1) {\n          if (node.matches?.(this.config.selectors.waypoints)) {\n            shouldUpdateWaypoints = true;\n          }\n          if (node.matches?.(this.config.selectors.reveal)) {\n            this.state.observers.get('intersection')?.observe(node);\n          }\n        }\n      });\n\n      mutation.removedNodes.forEach(node => {\n        if (node.nodeType === 1 && node.matches?.(this.config.selectors.waypoints)) {\n          shouldUpdateWaypoints = true;\n        }\n      });\n    });\n\n    if (shouldUpdateWaypoints) {\n      this.setupWaypoints();\n    }\n  },\n\n  handleResize(entries) {\n    this.emit('scroll:resize', {entries});\n  },\n\n  startObservers() {\n    const container = document.querySelector(this.config.selectors.container);\n\n    const mutation = this.state.observers.get('mutation');\n    if (mutation && container) {\n      mutation.observe(container, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        attributeFilter: ['data-scroll-track', 'data-scroll-waypoint']\n      });\n    }\n\n    const intersection = this.state.observers.get('intersection');\n    if (intersection) {\n      document.querySelectorAll(this.config.selectors.waypoints).forEach(el => {\n        intersection.observe(el);\n      });\n\n      document.querySelectorAll(this.config.selectors.reveal).forEach(el => {\n        intersection.observe(el);\n      });\n\n      document.querySelectorAll(this.config.selectors.sections).forEach(el => {\n        intersection.observe(el);\n      });\n    }\n\n    const resize = this.state.observers.get('resize');\n    if (resize && container) {\n      resize.observe(container);\n    }\n  },\n\n  initScrollNav() {\n    const navigation = document.querySelector(this.config.selectors.nav);\n    if (!navigation) return;\n\n    navigation.addEventListener('click', e => {\n      const link = e.target.closest('a');\n      if (!link) return;\n\n      const id = link.getAttribute('href')?.slice(1);\n      if (!id) return;\n\n      e.preventDefault();\n\n      const target = document.getElementById(id);\n      if (target) {\n        this.scrollTo(target, {\n          duration: this.config.scroll.nav.smoothScroll ?\n            this.config.core.duration : 0\n        });\n      }\n    });\n  },\n\n  setupEventListeners() {\n    this.on('route:changed', (context) => {\n      this.handleRouteChange(context.data);\n    });\n\n    document.addEventListener('keydown', e => {\n      if (e.key === 'Home') {\n        e.preventDefault();\n        this.scrollToTop();\n      } else if (e.key === 'End') {\n        e.preventDefault();\n        this.scrollToBottom();\n      } else if (e.key === 'PageUp') {\n        e.preventDefault();\n        window.scrollBy({\n          top: -window.innerHeight * 0.9,\n          behavior: 'smooth'\n        });\n      } else if (e.key === 'PageDown') {\n        e.preventDefault();\n        window.scrollBy({\n          top: window.innerHeight * 0.9,\n          behavior: 'smooth'\n        });\n      }\n    });\n  },\n\n  removeAllListeners() {\n    const eventManager = Now.getManager('event');\n\n    this.state.events.forEach((handlers, eventName) => {\n      handlers.forEach(handler => {\n        handlers.delete(handler);\n\n        if (eventManager?.off) {\n          eventManager.off(eventName, handler);\n        }\n      });\n    });\n\n    this.state.events.clear();\n\n    if (eventManager?.emit) {\n      eventManager.emit('scroll:cleanup', {\n        timestamp: Date.now(),\n        source: 'ScrollManager'\n      });\n    }\n  },\n\n  cleanup() {\n    this.cancelScroll();\n\n    this.removeAllListeners();\n\n    this.state.observers.forEach(observer => {\n      if (observer?.disconnect) {\n        observer.disconnect();\n      }\n    });\n    this.state.observers.clear();\n\n    if (this.debounceTimers) {\n      Object.values(this.debounceTimers).forEach(timer => {\n        clearTimeout(timer);\n      });\n      this.debounceTimers = {};\n    }\n\n    this.state.positions.clear();\n    this.state.waypoints.clear();\n    this.state.scrollQueue = [];\n    this.state.history = [];\n    this.state.events.clear();\n\n    this.state.initialized = false;\n    this.state.isScrolling = false;\n    this.state.isProcessingEvents = false;\n\n    if (this.announcer) {\n      this.announcer.remove();\n      this.announcer = null;\n    }\n  },\n\n  cleanSelector(selector) {\n    return selector.replace(/[^\\w\\s\\-_]/g, '');\n  },\n\n  async scrollTo(target, options = {}) {\n    if (!this.config.enabled || !target) return;\n\n    try {\n      let element = null;\n      if (typeof target === 'string') {\n        target = this.cleanSelector(target);\n        element = document.querySelector(target);\n      } else if (target instanceof HTMLElement) {\n        element = target;\n      }\n\n      if (!element) {\n        throw new Error('Invalid scroll target');\n      }\n\n      if (element.matches(this.config.selectors.ignore)) {\n        return;\n      }\n\n      options = {\n        offset: Number(options.offset) || 0,\n        duration: Math.max(0, Number(options.duration)) || 500,\n        easing: typeof options.easing === 'string' ?\n          options.easing : 'easeInOutCubic'\n      };\n\n      const finalOptions = {\n        offset: this.config.core.offset,\n        duration: this.config.core.duration,\n        easing: this.config.core.easing,\n        ...options\n      };\n\n      this.cancelScroll();\n\n      const elementRect = element.getBoundingClientRect();\n      const scrollTop = window.pageYOffset;\n      const targetY = elementRect.top + scrollTop - finalOptions.offset;\n\n      if (this.state.isScrolling) {\n        this.queueScroll(targetY, finalOptions);\n        return;\n      }\n\n      this.emit('scroll:start', {element, options: finalOptions});\n\n      this.state.isScrolling = true;\n\n      if (this.config.animation.enabled && finalOptions.duration > 0) {\n        await this.animateScroll(targetY, finalOptions);\n      } else {\n        window.scrollTo({\n          top: targetY,\n          behavior: 'auto'\n        });\n      }\n\n      if (finalOptions.focus !== false && this.config.accessibility.smoothFocus) {\n        element.focus({preventScroll: true});\n      }\n\n      this.state.isScrolling = false;\n\n      this.processScrollQueue();\n\n      this.updateScrollPosition();\n\n      this.emit('scroll:complete', {\n        element,\n        position: this.getScrollPosition()\n      });\n\n    } catch (error) {\n      ErrorManager.handle('Scroll failed', {\n        context: 'ScrollManager.scrollTo',\n        type: 'scroll:error',\n        data: {error}\n      });\n      this.state.isScrolling = false;\n    }\n  },\n\n  cancelScroll() {\n    if (this.state.activeAnimation) {\n      cancelAnimationFrame(this.state.activeAnimation);\n      this.state.activeAnimation = null;\n      this.state.isScrolling = false;\n      this.emit('scroll:cancel');\n    }\n  },\n\n  async scrollToContent(options = {}) {\n    if (!this.contentArea) return;\n    await this.scrollTo(this.contentArea, options);\n  },\n\n  async scrollToTop(options = {}) {\n    await this.scrollTo(document.documentElement, options);\n  },\n\n  async scrollToBottom(options = {}) {\n    const finalElement = Array.from(document.body.children).pop();\n    await this.scrollTo(finalElement, options);\n  },\n\n  addWaypoint(id, element, options = {}) {\n    if (!id || typeof id !== 'string') {\n      throw new Error('Invalid waypoint ID');\n    }\n    if (!(element instanceof HTMLElement)) {\n      throw new Error('Invalid waypoint element');\n    }\n    if (this.state.waypoints.has(id)) {\n      throw new Error(`Waypoint ${id} already exists`);\n    }\n\n    const waypoint = {\n      element,\n      options: {\n        offset: options.offset || this.config.waypoints.offset,\n        threshold: options.threshold || this.config.waypoints.threshold,\n        once: options.once || this.config.waypoints.once,\n        callback: options.callback\n      },\n      triggered: false\n    };\n\n    this.state.waypoints.set(id, waypoint);\n\n    if (this.state.observers.has('intersection')) {\n      const observer = this.state.observers.get('intersection');\n      observer.observe(element);\n    }\n  },\n\n  removeWaypoint(id) {\n    const waypoint = this.state.waypoints.get(id);\n    if (waypoint) {\n      if (this.state.observers.has('intersection')) {\n        const observer = this.state.observers.get('intersection');\n        observer.unobserve(waypoint.element);\n      }\n      this.state.waypoints.delete(id);\n    }\n  },\n\n  handleScrollDirection() {\n    const currentScroll = window.pageYOffset;\n    const direction = currentScroll > this.state.lastPosition?.y ? 'down' : 'up';\n\n    if (direction !== this.state.scrollDirection) {\n      this.state.scrollDirection = direction;\n      this.emit('scroll:direction', {direction});\n      document.body.setAttribute('data-scroll-direction', direction);\n    }\n  },\n\n  queueScroll(targetY, options) {\n    if (this.state.scrollQueue.length >= this.config.performance.maxQueue) {\n      this.state.scrollQueue.shift();\n    }\n\n    this.state.scrollQueue.push({targetY, options});\n  },\n\n  async processScrollQueue() {\n    if (this.scrollQueueLock) return;\n\n    try {\n      this.scrollQueueLock = true;\n\n      while (this.state.scrollQueue.length > 0) {\n        const item = this.state.scrollQueue.shift();\n        await this.animateScroll(item.targetY, item.options);\n      }\n\n    } finally {\n      this.scrollQueueLock = false;\n    }\n  },\n\n  getScrollPosition() {\n    return {\n      x: window.pageXOffset,\n      y: window.pageYOffset,\n      direction: this.state.scrollDirection,\n      timestamp: Date.now()\n    };\n  },\n\n  updateScrollPosition() {\n    const position = this.getScrollPosition();\n    this.state.lastPosition = position;\n    this.handleScrollDirection();\n\n    this.state.history.push(position);\n    if (this.state.history.length > 50) {\n      this.state.history.shift();\n    }\n\n    if (this.config.restoration.enabled) {\n      this.state.scrollRestoration.set(\n        window.location.pathname,\n        position\n      );\n    }\n  },\n\n  setupErrorHandling() {\n    window.addEventListener('error', (event) => {\n      if (event.error) {\n        ErrorManager.handle(event.error, {\n          context: 'ScrollManager.setupErrorHandling',\n          type: 'scroll:error'\n        });\n      }\n    });\n\n    window.addEventListener('unhandledrejection', (event) => {\n      if (event.reason) {\n        ErrorManager.handle(event.reason, {\n          context: 'ScrollManager.setupErrorHandling',\n          type: 'scroll:error'\n        });\n      }\n    });\n  },\n\n  initializeAnimationSystem() {\n    this.easingFunctions = {\n      linear: t => t,\n      easeInOutCubic: t => t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\n      easeOutQuart: t => 1 - (--t) * t * t * t,\n      easeInQuad: t => t * t,\n      easeOutBack: t => {\n        const c1 = 1.70158;\n        const c3 = c1 + 1;\n        return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);\n      }\n    };\n  },\n\n  animateScroll(targetY, options = {}) {\n    return new Promise((resolve) => {\n      const startY = window.pageYOffset;\n      const startTime = performance.now();\n      let lastFrame = null;\n      const duration = options.duration || this.config.core.duration;\n      const easingFn = this.easingFunctions[options.easing] ||\n        this.easingFunctions[this.config.core.easing];\n\n      let lastFrameTime = performance.now();\n      let framesToSkip = 0;\n\n      const animate = (currentTime) => {\n        try {\n          if (lastFrame && currentTime - lastFrame < 16) {\n            this.state.rafId = requestAnimationFrame(animate);\n            return;\n          }\n\n          lastFrame = currentTime;\n\n          const delta = currentTime - lastFrameTime;\n          lastFrameTime = currentTime;\n\n          if (delta > this.config.performance.requestAnimationFrame.skipThreshold) {\n            framesToSkip = Math.floor(delta / 16) - 1;\n          }\n\n          if (framesToSkip > 0) {\n            framesToSkip--;\n            this.state.rafId = requestAnimationFrame(animate);\n            return;\n          }\n\n          const elapsed = currentTime - startTime;\n          const progress = Math.min(elapsed / duration, 1);\n\n          if (progress < 1) {\n            const eased = easingFn(progress);\n            const currentY = startY + (targetY - startY) * eased;\n\n            window.scrollTo(0, currentY);\n\n            this.state.rafId = requestAnimationFrame(animate);\n          } else {\n            window.scrollTo(0, targetY);\n            this.state.rafId = null;\n\n            this.emit('scroll:animationComplete', {\n              startY,\n              targetY,\n              duration: elapsed\n            });\n\n            resolve();\n          }\n\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'ScrollManager.animateScroll',\n            type: 'scroll:error'\n          });\n          window.scrollTo(0, targetY);\n          this.state.rafId = null;\n          resolve();\n        }\n      };\n\n      this.state.rafId = requestAnimationFrame(animate);\n    });\n  },\n\n  easingFunctions: {\n    linear: t => t,\n    easeInOutCubic: t => t < .5 ?\n      4 * t * t * t :\n      (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\n    easeOutQuart: t => 1 - (--t) * t * t * t,\n    easeInQuad: t => t * t,\n    easeOutBack: t => {\n      const c1 = 1.70158;\n      const c3 = c1 + 1;\n      return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);\n    }\n  },\n\n  onVirtualDOMUpdate(callback) {\n    this.virtualDOMHooks.push(callback);\n  },\n\n  notifyVirtualDOM() {\n    this.virtualDOMHooks.forEach(hook => {\n      requestIdleCallback(() => hook());\n    });\n  },\n\n  throttle(func, limit) {\n    let inThrottle;\n    return (...args) => {\n      if (!inThrottle) {\n        func.apply(this, args);\n        inThrottle = true;\n        setTimeout(() => inThrottle = false, limit);\n      }\n    };\n  },\n\n  debounce(func, wait) {\n    let timeout;\n    return (...args) => {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => func.apply(this, args), wait);\n    };\n  },\n\n  setupScrollTracking() {\n    const handleScroll = this.throttle(() => {\n      if (this.state.isScrolling) return;\n\n      const position = this.getScrollPosition();\n      this.updateScrollState(position);\n      this.handleScrollDirection();\n      this.emit('scroll:progress', position);\n    }, this.config.performance.throttle);\n\n    const handleScrollEnd = this.debounce(() => {\n      if (!this.state.isScrolling) {\n        const position = this.getScrollPosition();\n        this.state.lastPosition = position;\n        this.emit('scroll:end', position);\n\n        this.processScrollQueue();\n      }\n    }, this.config.performance.debounce);\n\n    window.addEventListener('scroll', handleScroll, {\n      passive: this.config.performance.passive\n    });\n\n    window.addEventListener('scroll', handleScrollEnd, {\n      passive: this.config.performance.passive\n    });\n  },\n\n  updateScrollState(position) {\n    this.state.lastPosition = position;\n    this.state.history.push(position);\n\n    if (this.state.history.length > 50) {\n      this.state.history.shift();\n    }\n  },\n\n  setupWaypoints() {\n    const waypoints = document.querySelectorAll(this.config.selectors.waypoints);\n    waypoints.forEach(element => {\n      const id = element.dataset.scrollWaypoint;\n      const offset = parseInt(element.dataset.scrollOffset) || this.config.waypoints.offset;\n      const callback = element.dataset.scrollCallback && window[element.dataset.scrollCallback];\n\n      this.addWaypoint(id || Utils.generateUUID(), element, {\n        offset,\n        callback,\n        threshold: this.config.waypoints.threshold,\n        once: this.config.waypoints.once\n      });\n    });\n\n    if (this.state.observers.has('intersection')) {\n      const observer = this.state.observers.get('intersection');\n      waypoints.forEach(element => {\n        observer.observe(element);\n      });\n    }\n  },\n\n  addWaypoint(id, element, options = {}) {\n    const waypoint = {\n      element,\n      options: {\n        offset: options.offset || this.config.waypoints.offset,\n        threshold: options.threshold || this.config.waypoints.threshold,\n        once: options.once || this.config.waypoints.once,\n        callback: options.callback\n      },\n      triggered: false\n    };\n\n    this.state.waypoints.set(id, waypoint);\n\n    // Observe the element if IntersectionObserver is available\n    if (this.state.observers.has('intersection')) {\n      const observer = this.state.observers.get('intersection');\n      observer.observe(element);\n    }\n  },\n\n  initializeMobileSupport() {\n    if (!this.config.mobile.enabled) return;\n\n    const container = document.querySelector(this.config.selectors.container);\n    if (!container) return;\n\n    container.style.touchAction = this.config.mobile.touchAction;\n\n    container.addEventListener('touchstart', (e) => {\n      this.state.touchStartY = e.touches[0].clientY;\n      this.state.touchStartX = e.touches[0].clientX;\n    }, {passive: true});\n\n    container.addEventListener('touchmove', (e) => {\n      if (!this.state.touchStartY) return;\n\n      const touchY = e.touches[0].clientY;\n      const touchX = e.touches[0].clientX;\n      const diffY = this.state.touchStartY - touchY;\n      const diffX = this.state.touchStartX - touchX;\n\n      const scrollTop = window.pageYOffset;\n      const scrollHeight = document.documentElement.scrollHeight;\n      const clientHeight = document.documentElement.clientHeight;\n\n      if ((scrollTop <= 0 && diffY < 0) ||\n        (scrollTop + clientHeight >= scrollHeight && diffY > 0)) {\n        e.preventDefault();\n      }\n\n      this.emit('touch:move', {\n        diffY,\n        diffX,\n        originalEvent: e\n      });\n\n    }, {passive: false});\n\n    container.addEventListener('touchend', () => {\n      this.state.touchStartY = null;\n      this.state.touchStartX = null;\n    }, {passive: true});\n\n    if (this.config.mobile.momentumScroll) {\n      container.style.WebkitOverflowScrolling = 'touch';\n    }\n\n    if (!this.config.mobile.pullToRefresh) {\n      document.body.style.overscrollBehavior = 'none';\n    }\n  },\n\n  initializeAccessibility() {\n    if (!this.config.accessibility.enabled) return;\n\n    if (this.config.accessibility.announceChanges) {\n      this.announcer = document.createElement('div');\n      this.announcer.setAttribute('aria-live', 'polite');\n      this.announcer.className = 'sr-only';\n      this.announcer.style.cssText = `\n      position: absolute;\n      width: 1px;\n      height: 1px;\n      padding: 0;\n      margin: -1px;\n      overflow: hidden;\n      clip: rect(0, 0, 0, 0);\n      white-space: nowrap;\n      border: 0;\n    `;\n      document.body.appendChild(this.announcer);\n    }\n\n    if (this.config.accessibility.smoothFocus) {\n      document.addEventListener('focus', (e) => {\n        const target = e.target;\n        if (target.matches(this.config.accessibility.focusableSelectors)) {\n          const rect = target.getBoundingClientRect();\n          const isInView = (\n            rect.top >= 0 &&\n            rect.left >= 0 &&\n            rect.bottom <= window.innerHeight &&\n            rect.right <= window.innerWidth\n          );\n\n          if (!isInView) {\n            this.scrollTo(target, {\n              offset: this.config.core.offset,\n              duration: this.config.core.duration\n            });\n          }\n        }\n      }, true);\n    }\n\n    if (this.config.accessibility.ariaLabels) {\n      document.querySelectorAll(this.config.selectors.waypoints).forEach(el => {\n        if (!el.getAttribute('aria-label')) {\n          el.setAttribute('aria-label', 'Scroll waypoint');\n        }\n      });\n    }\n\n    this.on('scroll:complete', (data) => {\n      if (this.announcer && data.element) {\n        const label = data.element.getAttribute('aria-label') ||\n          data.element.innerText ||\n          'Scrolled content';\n        this.announcer.textContent = `Scrolled to ${label}`;\n      }\n    });\n  },\n\n  on(event, handler) {\n    if (!this.state.events.has(event)) {\n      this.state.events.set(event, new Set());\n    }\n    this.state.events.get(event).add(handler);\n\n    const eventManager = Now.getManager('event');\n    if (eventManager?.on) {\n      eventManager.on(event, handler);\n    }\n\n    return this;\n  },\n\n  off(event, handler) {\n    const handlers = this.state.events.get(event);\n    if (handlers) {\n      handlers.delete(handler);\n    }\n\n    const eventManager = Now.getManager('event');\n    if (eventManager?.off) {\n      eventManager.off(event, handler);\n    }\n\n    return this;\n  },\n\n  emit(eventName, data) {\n    const handlers = this.state.events.get(eventName);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (error) {\n          ErrorManager.handle(`Error in scroll event handler for ${eventName}`, {\n            context: 'ScrollManager.emit',\n            data: {error}\n          });\n        }\n      });\n    }\n\n    EventManager.emit(eventName, {\n      ...data,\n      source: 'ScrollManager'\n    });\n  },\n\n  initScrollRestoration() {\n    if (!this.config.restoration.enabled) return;\n\n    const stored = localStorage.getItem(this.config.restoration.key);\n    if (stored) {\n      try {\n        const positions = JSON.parse(stored);\n        Object.entries(positions).forEach(([key, value]) => {\n          if (Date.now() - value.timestamp < this.config.restoration.ttl) {\n            this.state.scrollRestoration.set(key, value);\n          }\n        });\n      } catch (error) {\n        ErrorManager.handle('Failed to restore scroll positions', {\n          context: 'ScrollManager.initScrollRestoration',\n          data: {error}\n        });\n      }\n    }\n\n    window.addEventListener('beforeunload', () => {\n      const positions = {};\n      this.state.scrollRestoration.forEach((value, key) => {\n        positions[key] = value;\n      });\n      localStorage.setItem(this.config.restoration.key, JSON.stringify(positions));\n    });\n\n    window.addEventListener('popstate', () => {\n      const position = this.state.scrollRestoration.get(window.location.pathname);\n      if (position) {\n        window.scrollTo(0, position.y);\n      }\n    });\n  },\n\n  initializeScrollFeatures() {\n    const {scroll} = this.config;\n\n    if (scroll.section.highlight) {\n      this.initSectionHighlight();\n    }\n\n    if (scroll.nav.updateHash) {\n      this.initScrollNav();\n    }\n\n    if (scroll.infinite.enabled) {\n      this.initInfiniteScroll(scroll.infinite.loadMore);\n    }\n\n    if (scroll.parallax.enabled) {\n      this.initParallax();\n    }\n  },\n\n  initSectionHighlight() {\n    const sections = document.querySelectorAll(this.config.selectors.sections);\n\n    const observer = new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          const id = entry.target.id;\n          this.state.activeSection = id;\n          this.emit('section:active', {id});\n\n          if (this.config.scroll.nav.updateHash && id) {\n            history.replaceState(null, null, `#${id}`);\n          }\n\n          document.querySelectorAll(this.config.selectors.nav).forEach(nav => {\n            nav.querySelectorAll('a').forEach(link => {\n              link.classList.toggle(\n                this.config.scroll.nav.highlightClass,\n                link.getAttribute('href') === `#${id}`\n              );\n            });\n          });\n        }\n      });\n    }, {\n      threshold: this.config.scroll.section.threshold\n    });\n\n    sections.forEach(section => observer.observe(section));\n  },\n\n  initParallax() {\n    const elements = document.querySelectorAll(this.config.selectors.parallax);\n\n    const updateParallax = () => {\n      const scrolled = window.scrollY;\n      elements.forEach(el => {\n        const speed = el.dataset.parallaxSpeed || this.config.scroll.parallax.speed;\n        const yPos = -(scrolled * speed);\n        el.style.transform = `translate3d(0, ${yPos}px, 0)`;\n      });\n    };\n\n    window.addEventListener('scroll', updateParallax, {passive: true});\n  },\n\n  initInfiniteScroll(callback) {\n    if (!callback) return;\n\n    const handleInfinite = this.throttle(() => {\n      if (this.state.isLoading) return;\n\n      const scrollHeight = document.documentElement.scrollHeight;\n      const scrollTop = window.scrollY;\n      const clientHeight = window.innerHeight;\n\n      if (scrollHeight - (scrollTop + clientHeight) < this.config.scroll.infinite.threshold) {\n        this.state.isLoading = true;\n\n        Promise.resolve(callback())\n          .finally(() => {\n            this.state.isLoading = false;\n          });\n      }\n    }, 100);\n\n    window.addEventListener('scroll', handleInfinite, {passive: true});\n  },\n\n  handleRouteChange(data) {\n    if (!data || !data.path) return;\n\n    if (data.path.includes('#')) {\n      const [, hash] = data.path.split('#');\n      if (hash) {\n        setTimeout(() => {\n          const element = document.getElementById(hash);\n          if (element) {\n            this.scrollTo(element, {\n              offset: this.config.core.offset,\n              duration: this.config.core.duration\n            });\n          }\n        }, 100);\n        return;\n      }\n    }\n\n    const contentEl = document.querySelector(this.config.selectors.content);\n    if (contentEl) {\n      this.scrollTo(contentEl, {\n        offset: this.config.core.offset,\n        duration: this.config.core.duration\n      });\n    } else {\n      window.scrollTo({\n        top: 0,\n        behavior: this.config.animation.enabled ? 'smooth' : 'auto'\n      });\n    }\n\n    this.state.activeSection = null;\n  },\n\n  handleScrollProgress(position) {\n    if (!this.config.scroll.progress.enabled) return;\n\n    const docHeight = document.documentElement.scrollHeight - window.innerHeight;\n    const progress = (position.y / docHeight) * 100;\n\n    const progressBar = document.querySelector(this.config.selectors.progress);\n    if (progressBar) {\n      progressBar.style.width = `${progress}%`;\n    }\n\n    this.emit('scroll:progress', {\n      position,\n      progress,\n      total: docHeight\n    });\n  },\n\n  handleResize(entries) {\n    entries.forEach(entry => {\n      this.updateScrollPosition();\n\n      const position = this.getScrollPosition();\n      this.handleScrollProgress(position);\n    });\n\n    this.emit('scroll:resize', {\n      entries,\n      timestamp: Date.now()\n    });\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('scroll', ScrollManager);\n}\n\nwindow.ScrollManager = ScrollManager;\n","const DialogManager = {\n  config: {\n    animation: true,\n    duration: 200,\n    draggable: true,\n    modal: true,\n    closeOnEscape: true,\n    closeOnBackdrop: true,\n    preventScroll: true,\n    baseZIndex: 1000,\n    focusTrap: true,\n    keyboard: true,\n    templates: {\n      alert: `\n        <div class=\"dialog-header\">\n          <h2 class=\"dialog-title\"></h2>\n          <button class=\"dialog-close\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"dialog-body\"></div>\n        <div class=\"dialog-footer\"></div>\n      `,\n      confirm: `\n        <div class=\"dialog-header\">\n          <h2 class=\"dialog-title\"></h2>\n          <button class=\"dialog-close\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"dialog-body\"></div>\n        <div class=\"dialog-footer\"></div>\n      `,\n      prompt: `\n        <div class=\"dialog-header\">\n          <h2 class=\"dialog-title\"></h2>\n          <button class=\"dialog-close\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"dialog-body\">\n          <input type=\"text\" class=\"dialog-input\" />\n        </div>\n        <div class=\"dialog-footer\"></div>\n      `\n    }\n  },\n\n  state: {\n    dialogs: new Map(),\n    activeDialogs: [],\n    templates: new Map(),\n    nextId: 1,\n    previousFocus: null,\n    initialized: false,\n    errorHandlers: new Set()\n  },\n\n  async init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n    this.backdropManager = Now.getManager('backdrop');\n\n    if (this.config.keyboard) {\n      this.setupKeyboardEvents();\n    }\n\n    if (options.templates) {\n      Object.entries(options.templates).forEach(([name, template]) => {\n        this.state.templates.set(name, template);\n      });\n    }\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  alert(message, title = null, options = {}) {\n    title = title || Now.translate('Alert');\n    return new Promise(resolve => {\n      const dialog = this.createDialog({\n        template: 'alert',\n        title,\n        message,\n        buttons: {\n          ok: {\n            text: Now.translate('OK'),\n            class: 'btn-primary',\n            callback: () => resolve(true)\n          }\n        },\n        ...options\n      });\n\n      this.show(dialog);\n    });\n  },\n\n  confirm(message, title = null, options = {}) {\n    title = title || Now.translate('Confirm');\n    return new Promise(resolve => {\n      const dialog = this.createDialog({\n        template: 'confirm',\n        title,\n        message,\n        buttons: {\n          cancel: {\n            text: Now.translate('Cancel'),\n            class: 'text',\n            callback: () => resolve(false)\n          },\n          confirm: {\n            text: Now.translate('Confirm'),\n            class: 'btn-primary',\n            callback: () => resolve(true)\n          }\n        },\n        ...options\n      });\n\n      this.show(dialog);\n    });\n  },\n\n  prompt(message, defaultValue = '', title = null, options = {}) {\n    title = title || Now.translate('Prompt');\n    return new Promise(resolve => {\n      const dialog = this.createDialog({\n        template: 'prompt',\n        title,\n        message,\n        defaultValue,\n        buttons: {\n          cancel: {\n            text: Now.translate('Cancel'),\n            class: 'text',\n            callback: () => resolve(null)\n          },\n          ok: {\n            text: Now.translate('OK'),\n            class: 'btn-primary',\n            callback: (dialog) => {\n              const input = dialog.querySelector('.dialog-input');\n              resolve(input?.value ?? null);\n            }\n          }\n        },\n        ...options\n      });\n\n      this.show(dialog);\n\n      setTimeout(() => {\n        const input = dialog.querySelector('.dialog-input');\n        if (input) {\n          input.value = defaultValue;\n          input.select();\n        }\n      }, this.config.duration);\n    });\n  },\n\n  custom(options) {\n    const dialog = this.createDialog({\n      template: options.template || 'alert',\n      ...options\n    });\n\n    if (options.onShow) {\n      dialog.addEventListener('dialog:shown', options.onShow);\n    }\n\n    if (options.onClose) {\n      dialog.addEventListener('dialog:closed', options.onClose);\n    }\n\n    this.show(dialog);\n    return dialog;\n  },\n\n  createDialog(options) {\n    try {\n      const id = this.state.nextId++;\n      const dialog = document.createElement('div');\n\n      dialog.className = `dialog ${options.customClass || ''}`;\n      dialog.setAttribute('role', 'dialog');\n      dialog.setAttribute('aria-modal', 'true');\n      dialog.id = `dialog-${id}`;\n\n      const template = this.state.templates.get(options.template) ||\n        this.config.templates[options.template] ||\n        this.config.templates.alert;\n\n      dialog.innerHTML = template;\n\n      if (options.title) {\n        const titleEl = dialog.querySelector('.dialog-title');\n        if (titleEl) {\n          titleEl.textContent = options.title;\n          dialog.setAttribute('aria-labelledby', titleEl.id = `dialog-title-${id}`);\n        }\n      }\n\n      if (options.message) {\n        const bodyEl = dialog.querySelector('.dialog-body');\n        if (bodyEl) {\n          if (typeof options.message === 'string') {\n            bodyEl.innerHTML = options.message;\n          } else if (options.message instanceof HTMLElement) {\n            bodyEl.appendChild(options.message);\n          }\n        }\n      }\n\n      // Close button click\n      const closeBtns = dialog.querySelectorAll('.dialog-close');\n      closeBtns.forEach(btn => {\n        btn.addEventListener('click', () => this.close(dialog));\n      });\n\n      this.setupButtons(dialog, options.buttons);\n\n      if (this.config.draggable && options.draggable !== false) {\n        this.setupDraggable(dialog);\n      }\n\n      if (this.config.focusTrap) {\n        this.setupFocusTrap(dialog);\n      }\n\n      return dialog;\n\n    } catch (error) {\n      this.handleError('Create Dialog', error, 'create');\n      throw error;\n    }\n  },\n\n  setupFocusTrap(dialog) {\n    const focusableElements = dialog.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    if (focusableElements.length === 0) return;\n\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    dialog.addEventListener('keydown', (e) => {\n      if (e.key !== 'Tab') return;\n\n      if (e.shiftKey) {\n        if (document.activeElement === firstFocusable) {\n          e.preventDefault();\n          lastFocusable.focus();\n        }\n      } else {\n        if (document.activeElement === lastFocusable) {\n          e.preventDefault();\n          firstFocusable.focus();\n        }\n      }\n    });\n  },\n\n  setupDraggable(dialog) {\n    const header = dialog.querySelector('.dialog-header');\n    if (!header) return;\n\n    header.style.cursor = 'move';\n    let isDragging = false;\n    let startX = 0;\n    let startY = 0;\n    let startLeft = 0;\n    let startTop = 0;\n\n    const startDrag = (e) => {\n      if (e.target.closest('button')) return;\n\n      const event = e.type === 'mousedown' ? e : e.touches[0];\n      isDragging = true;\n\n      startX = event.clientX;\n      startY = event.clientY;\n      startLeft = parseInt(dialog.style.left) || 0;\n      startTop = parseInt(dialog.style.top) || 0;\n\n      dialog.classList.add('dragging');\n    };\n\n    const doDrag = (e) => {\n      if (!isDragging) return;\n      e.preventDefault();\n\n      const event = e.type === 'mousemove' ? e : e.touches[0];\n\n      const deltaX = event.clientX - startX;\n      const deltaY = event.clientY - startY;\n\n      const newLeft = startLeft + deltaX;\n      const newTop = startTop + deltaY;\n\n      const maxX = window.innerWidth - dialog.offsetWidth;\n      const maxY = window.innerHeight - dialog.offsetHeight;\n\n      dialog.style.left = Math.min(Math.max(0, newLeft), maxX) + 'px';\n      dialog.style.top = Math.min(Math.max(0, newTop), maxY) + 'px';\n    };\n\n    const stopDrag = () => {\n      if (!isDragging) return;\n      isDragging = false;\n      dialog.classList.remove('dragging');\n    };\n\n    header.addEventListener('mousedown', startDrag);\n    document.addEventListener('mousemove', doDrag);\n    document.addEventListener('mouseup', stopDrag);\n\n    header.addEventListener('touchstart', startDrag, {passive: false});\n    document.addEventListener('touchmove', doDrag, {passive: false});\n    document.addEventListener('touchend', stopDrag);\n    document.addEventListener('touchcancel', stopDrag);\n  },\n\n  setupButtons(dialog, buttons = {}) {\n    const footer = dialog.querySelector('.dialog-footer');\n    if (!footer) return;\n\n    footer.innerHTML = '';\n\n    Object.entries(buttons).forEach(([key, config]) => {\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.className = `btn ${config.class || 'text'}`;\n      button.textContent = config.text;\n\n      if (config.callback) {\n        button.onclick = (e) => {\n          e.preventDefault();\n          config.callback(dialog);\n          this.close(dialog);\n        };\n      }\n\n      if (config.attrs) {\n        Object.entries(config.attrs).forEach(([attr, value]) => {\n          button.setAttribute(attr, value);\n        });\n      }\n\n      footer.appendChild(button);\n    });\n  },\n\n  show(dialog) {\n    if (!dialog || this.state.dialogs.has(dialog.id)) return dialog;\n\n    this.state.previousFocus = document.activeElement;\n\n    const width = dialog.offsetWidth || 320;\n    const height = dialog.offsetHeight || 200;\n\n    const left = Math.max(0, (window.innerWidth - width) / 2);\n    const top = Math.max(0, (window.innerHeight - height) / 2);\n\n    dialog.style.left = left + 'px';\n    dialog.style.top = top + 'px';\n\n    const backdropId = this.backdropManager?.show(dialog, () => {\n      if (this.config.closeOnBackdrop) {\n        this.close(dialog);\n      }\n    });\n\n    const dialogData = {\n      element: dialog,\n      backdropId,\n      options: {\n        preventScroll: this.config.preventScroll\n      }\n    };\n\n    this.state.dialogs.set(dialog.id, dialogData);\n    this.state.activeDialogs.push(dialog.id);\n\n    const zIndex = this.config.baseZIndex + (this.state.activeDialogs.length * 2);\n    dialog.style.zIndex = zIndex;\n\n    if (this.config.preventScroll) {\n      document.body.style.overflow = 'hidden';\n    }\n\n    document.body.appendChild(dialog);\n\n    requestAnimationFrame(() => {\n      dialog.classList.add('show');\n\n      const primaryButton = dialog.querySelector('.dialog-button-primary');\n      const firstFocusable = dialog.querySelector(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n\n      if (primaryButton) {\n        primaryButton.focus();\n      } else if (firstFocusable) {\n        firstFocusable.focus();\n      }\n\n      dialog.dispatchEvent(new CustomEvent('dialog:shown', {\n        detail: {dialog}\n      }));\n    });\n\n    return dialog;\n  },\n\n  bringToFront(dialog) {\n    try {\n      const maxZ = Math.max(\n        ...Array.from(this.state.dialogs.values())\n          .map(d => parseInt(d.element.style.zIndex) || 0)\n      );\n\n      const newZ = Math.max(this.config.baseZIndex, maxZ + 2);\n      dialog.style.zIndex = newZ;\n\n      const dialogData = this.state.dialogs.get(dialog.id);\n      if (dialogData?.backdropId) {\n        const backdrop = document.getElementById(dialogData.backdropId);\n        if (backdrop) {\n          backdrop.style.zIndex = newZ - 1;\n        }\n      }\n\n      const index = this.state.activeDialogs.indexOf(dialog.id);\n      if (index > -1) {\n        this.state.activeDialogs.splice(index, 1);\n        this.state.activeDialogs.push(dialog.id);\n      }\n\n    } catch (error) {\n      this.handleError('Bring To Front', error, 'bringToFront');\n    }\n  },\n\n  close(dialog) {\n    if (!dialog) return;\n\n    const dialogData = this.state.dialogs.get(dialog.id);\n    if (!dialogData) return;\n\n    dialog.classList.remove('show');\n    dialog.classList.add('hiding');\n\n    if (dialogData.backdropId) {\n      this.backdropManager?.hide(dialogData.backdropId);\n    }\n\n    setTimeout(() => {\n      dialog.remove();\n\n      this.state.dialogs.delete(dialog.id);\n\n      const index = this.state.activeDialogs.indexOf(dialog.id);\n      if (index > -1) {\n        this.state.activeDialogs.splice(index, 1);\n      }\n\n      if (this.state.activeDialogs.length === 0 && dialogData.options.preventScroll) {\n        document.body.style.overflow = '';\n      }\n\n      if (this.state.previousFocus && document.contains(this.state.previousFocus)) {\n        this.state.previousFocus.focus();\n      }\n\n      dialog.dispatchEvent(new CustomEvent('dialog:closed', {\n        detail: {dialog}\n      }));\n\n    }, this.config.duration);\n  },\n\n  closeAll() {\n    [...this.state.activeDialogs].forEach(id => {\n      const dialog = document.getElementById(id);\n      if (dialog) {\n        this.close(dialog);\n      }\n    });\n  },\n\n  setupKeyboardEvents() {\n    document.addEventListener('keydown', (e) => {\n      if (this.state.activeDialogs.length === 0) return;\n\n      const topDialogId = this.state.activeDialogs[this.state.activeDialogs.length - 1];\n      const topDialog = document.getElementById(topDialogId);\n\n      if (!topDialog) return;\n\n      if (e.key === 'Escape' && this.config.closeOnEscape) {\n        e.preventDefault();\n        this.close(topDialog);\n      }\n    });\n  },\n\n  translate(key, params = {}) {\n    const i18n = Now.getManager('i18n');\n    return i18n ? i18n.translate(key, params) : key;\n  },\n\n  destroy() {\n    this.closeAll();\n\n    if (this.config.keyboard) {\n      document.removeEventListener('keydown', this.handleKeydown);\n    }\n\n    this.state = {\n      dialogs: new Map(),\n      activeDialogs: [],\n      templates: new Map(),\n      nextId: 1,\n      previousFocus: null,\n      initialized: false,\n      errorHandlers: new Set()\n    };\n\n    this.config = null;\n  },\n\n  cleanupDialog(dialog) {\n    try {\n      const header = dialog.querySelector('.dialog-header');\n      if (header) {\n        header.removeEventListener('mousedown', header._startDrag);\n        header.removeEventListener('touchstart', header._startDrag);\n      }\n\n      dialog.removeEventListener('keydown', dialog._keyHandler);\n\n      if (dialog._dragHandlers) {\n        Object.entries(dialog._dragHandlers).forEach(([event, handler]) => {\n          document.removeEventListener(event, handler);\n        });\n      }\n\n      dialog._dragHandlers = null;\n      dialog._keyHandler = null;\n      dialog._startDrag = null;\n\n      dialog.removeAttribute('aria-labelledby');\n      dialog.removeAttribute('aria-modal');\n      dialog.removeAttribute('role');\n\n      dialog.className = 'dialog';\n\n      dialog.style = '';\n\n    } catch (error) {\n      this.handleError('Cleanup Dialog', error, 'cleanup');\n    }\n  },\n\n  handleError(message, error, type) {\n    ErrorManager.handle(message, {\n      context: `DialogManager.${type}`,\n      type: 'error:dialog',\n      data: {\n        error: {\n          name: error.name,\n          message: error.message,\n          stack: error.stack\n        }\n      },\n      notify: true\n    });\n\n    try {\n      this.closeAll();\n    } catch (cleanupError) {\n      console.error('Dialog cleanup failed:', cleanupError);\n    }\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('dialog', DialogManager);\n}\n\nwindow.DialogManager = DialogManager;\n","const TemplateManager = {\n  config: {\n    debug: false,\n    cache: true,\n    cacheDuration: 5 * 60 * 1000,\n    security: {\n      allowedOrigins: [],\n      allowedExtensions: ['.html', '.htm'],\n      maxContentSize: 2 * 1024 * 1024,\n      sanitize: true,\n      validateMarkup: true,\n      allowedTags: [\n        'html', 'head', 'body', 'title', 'meta', 'link', 'style', 'base',\n        'header', 'nav', 'main', 'section', 'article', 'aside', 'footer',\n        'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'br', 'hr', 'pre',\n        'blockquote', 'ol', 'ul', 'li', 'dl', 'dt', 'dd', 'a', 'em',\n        'strong', 'small', 's', 'cite', 'code', 'sub', 'sup', 'span',\n        'mark', 'b', 'i', 'u', 'var', 'time', 'img', 'figure',\n        'figcaption', 'audio', 'video', 'source', 'track', 'iframe',\n        'embed', 'object', 'param', 'picture',\n        'template', 'canvas', 'svg', 'math', 'table', 'caption',\n        'thead', 'tbody', 'tfoot', 'tr', 'th', 'td', 'colgroup',\n        'col', 'summary', 'form', 'input', 'textarea', 'button',\n        'select', 'option', 'label', 'fieldset', 'legend', 'datalist',\n        'output', 'div', 'details', 'dialog', 'meter', 'progress',\n        'ruby', 'rt', 'rp', 'abbr', 'kbd', 'samp', 'font', 'center',\n        'big', 'strike', 'marquee'\n      ],\n\n      allowedAttributes: {\n        'all': [\n          'id', 'class', 'title', 'lang', 'dir', 'hidden', 'tabindex', 'translate',\n          'draggable', 'aria-*', 'role', 'data-*', 'accesskey', 'contenteditable',\n          'contextmenu'\n        ],\n        'img': [\n          'src', 'alt', 'width', 'height', 'loading', 'srcset', 'sizes',\n          'decoding', 'referrerpolicy', 'crossorigin'\n        ],\n        'a': [\n          'href', 'target', 'rel', 'download', 'hreflang', 'type'\n        ],\n        'input': [\n          'type', 'value', 'placeholder', 'required', 'checked', 'disabled',\n          'readonly', 'maxlength', 'minlength', 'pattern', 'size', 'step', 'multiple',\n          'min', 'max', 'list', 'inputmode', 'autocomplete', 'autofocus', 'name'\n        ],\n        'select': ['value', 'placeholder', 'multiple', 'required', 'size', 'autofocus', 'name'],\n        'option': ['value', 'selected', 'disabled', 'label'],\n        'textarea': [\n          'placeholder', 'required', 'rows', 'cols', 'maxlength', 'minlength', 'readonly', 'autofocus', 'name'\n        ],\n        'button': [\n          'type', 'disabled', 'name', 'value', 'autofocus', 'form'\n        ],\n        'form': [\n          'action', 'method', 'enctype', 'autocomplete', 'novalidate', 'target', 'name', 'accept-charset'\n        ],\n        'label': ['for'],\n        'time': ['datetime'],\n        'iframe': [\n          'src', 'width', 'height', 'allow', 'loading', 'sandbox', 'referrerpolicy', 'name'\n        ],\n        'meta': ['name', 'content', 'http-equiv', 'charset']\n      }\n    },\n\n    events: {\n      cleanupInterval: 60000\n    },\n\n    cleanup: {\n      interval: 60 * 1000,\n      maxCacheAge: 30 * 60 * 1000,\n      maxHandlerAge: 5 * 60 * 1000,\n      batchSize: 100\n    }\n  },\n\n  state: {\n    cache: new Map(),\n    initialized: false,\n    serverPaths: new Set(),\n    handlers: new Map(),\n    cleanupInterval: null,\n    lastCleanup: Date.now(),\n    itemTimestamps: new Map(),\n    performanceObserver: null,\n    activeScripts: new Map()\n  },\n\n  async init(options = {}) {\n    if (this.state.initialized) return this;\n\n    if (this.config.security.allowedOrigins.length === 0) {\n      this.config.security.allowedOrigins.push(window.location.origin);\n    }\n\n    this.config = Now.mergeConfig(this.config, options);\n\n    if (options.serverPaths) {\n      this.state.serverPaths = new Set(options.serverPaths);\n    }\n\n    this.setupPerformanceMonitoring();\n\n    this.state.initialized = true;\n\n    this.state.cleanupInterval = setInterval(() => {\n      this.cleanupHandlers();\n      this.cleanupCache();\n    }, this.config.events.cleanupInterval);\n\n    window.Now.handleEvent = (handlerId, element, event) => {\n      const handler = this.state.handlers.get(handlerId);\n      if (handler) {\n        handler.call(event);\n      } else {\n        ErrorManager.handle(`Handler with ID ${handlerId} not found`, {\n          context: 'TemplateManager.window.Now.handleEvent',\n          data: {handlerId, element, event}\n        });\n      }\n    };\n\n    this.startCleanupInterval();\n\n    // Cleanup data-scripts before route navigation\n    EventManager.on('route:before', () => {\n      this.cleanupScripts();\n    }, {priority: -100}); // Run early to cleanup before navigation\n\n    return this;\n  },\n\n  async loadFromServer(path) {\n    if (!this.state.initialized) {\n      throw new Error('TemplateManager is not initialized')\n    }\n\n    // Prefer using Now.resolvePath to build canonical template URLs when available\n    try {\n      if (window.Now && typeof window.Now.resolvePath === 'function' && !path.trim().startsWith('<') && !/^(https?:)?\\/\\//i.test(path)) {\n        path = window.Now.resolvePath(path, 'templates');\n      } else if (Now.config?.paths?.templates && !path.trim().startsWith('<') && !path.startsWith(Now.config.paths.templates)) {\n        path = Now.config.paths.templates + path;\n      }\n    } catch (e) {\n      if (Now.config?.paths?.templates && !path.trim().startsWith('<') && !path.startsWith(Now.config.paths.templates)) {\n        path = Now.config.paths.templates + path;\n      }\n    }\n\n    const startTime = performance.now();\n\n    if (!this.isValidPath(path)) {\n      throw new Error(`Invalid template path format: ${path}`);\n    }\n\n    const cacheKey = `template:${path}`;\n    if (this.config.cache) {\n      const cached = this.state.cache.get(cacheKey);\n      if (cached && cached.expires > Date.now()) {\n        return cached.content;\n      }\n    }\n\n    const url = new URL(path, window.location.origin);\n\n    await this.validateRequest(url);\n\n    // Use HttpClient only - no fallback\n    if (!window.http || typeof window.http.get !== 'function') {\n      throw new Error('HttpClient (window.http) is required but not available');\n    }\n\n    const response = await window.http.get(url.toString(), {\n      throwOnError: false,\n      headers: {\n        'Accept': 'text/html'\n      }\n    });\n\n    if (!response.success) {\n      throw new Error(`Failed to fetch template: ${path}`);\n    }\n\n    const contentType = response.headers['content-type'];\n    if (!contentType?.includes('text/html')) {\n      throw new Error('Invalid content type: Expected HTML');\n    }\n\n    const contentLength = response.headers['content-length'];\n    if (contentLength && parseInt(contentLength) > this.config.security.maxContentSize) {\n      throw new Error('Template size exceeds limit');\n    }\n\n    const content = typeof response.data === 'string' ? response.data : await response.data.text();\n\n    const processedContent = await this.processContent(content, path);\n\n    if (this.config.cache) {\n      this.state.cache.set(cacheKey, {\n        content: processedContent,\n        expires: Date.now() + this.config.cacheDuration\n      });\n      this.state.itemTimestamps.set(cacheKey, Date.now());\n    }\n\n    const endTime = performance.now();\n    this.recordPerformance('template-load', {\n      path,\n      duration: endTime - startTime,\n      size: content.length\n    });\n\n    return processedContent;\n  },\n\n  async validateRequest(url) {\n    if (!this.config.security.allowedOrigins.includes(url.origin)) {\n      throw new Error('Invalid origin');\n    }\n\n    if (!url.pathname.toLowerCase().endsWith('.html')) {\n      throw new Error('Invalid file type');\n    }\n\n    return true;\n  },\n\n  async processContent(content, path) {\n    try {\n      const container = document.createElement('div');\n      container.innerHTML = content.trim();\n\n      const componentManager = Now.getManager('component');\n      const context = componentManager?.getContextForPath(path);\n\n      if (context) {\n        this.processDataDirectives(container, context);\n        this.processInterpolation(container, context);\n      }\n\n      if (this.config.security.sanitize) {\n        this.sanitizeElement(container);\n      }\n\n      if (this.config.security.validateMarkup) {\n        await this.validateMarkup(container);\n      }\n\n      return container.innerHTML;\n\n    } catch (error) {\n      throw ErrorManager.handle(error, {\n        context: 'TemplateManager.processContent',\n        data: {content, path}\n      });\n    }\n  },\n\n  sanitizeElement(element) {\n    try {\n      // Accept both HTMLElement and raw HTML string; normalize to element for traversal\n      let root = element;\n      if (typeof element === 'string') {\n        const container = document.createElement('div');\n        container.innerHTML = element;\n        root = container;\n      }\n\n      if (window.DOMPurify) {\n        DOMPurify.sanitize(root, {\n          ALLOWED_TAGS: this.config.security.allowedTags,\n          ALLOWED_ATTR: Object.values(this.config.security.allowedAttributes).flat(),\n          IN_PLACE: true\n        });\n      } else {\n        // Collect elements to remove and attributes to clean BEFORE modifying DOM\n        // This prevents TreeWalker issues when removing nodes during traversal\n        const elementsToRemove = [];\n        const attributesToRemove = [];\n\n        const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, null, false);\n        let el = walker.currentNode;\n        while (el) {\n          const tagName = el.tagName.toLowerCase();\n\n          if (!this.config.security.allowedTags.includes(tagName)) {\n            elementsToRemove.push(el);\n          } else if (el.attributes) {\n            Array.from(el.attributes).forEach(attr => {\n              const attrName = attr.name.toLowerCase();\n\n              const isGlobalAllowed = this.config.security.allowedAttributes.all\n                .some(pattern => {\n                  if (pattern.endsWith('*')) {\n                    return attrName.startsWith(pattern.slice(0, -1));\n                  }\n                  return pattern === attrName;\n                });\n\n              const isTagAllowed = this.config.security.allowedAttributes[tagName]?.includes(attrName);\n\n              const isUrlAttr = ['href', 'src', 'action', 'formaction', 'poster'].includes(attrName);\n              const isStyleAttr = attrName === 'style';\n\n              // Remove if not allowed by config\n              if (!isGlobalAllowed && !isTagAllowed) {\n                attributesToRemove.push({el, attrName});\n                return;\n              }\n\n              // Value-level sanitization for URL attributes\n              if (isUrlAttr) {\n                const safe = this.sanitizeUrlAttribute(attr.value);\n                if (!safe) {\n                  attributesToRemove.push({el, attrName});\n                  return;\n                }\n                if (safe !== attr.value) {\n                  el.setAttribute(attrName, safe);\n                }\n              }\n\n              // Inline style sanitization (manual path only)\n              if (isStyleAttr) {\n                const safeStyle = this.sanitizeInlineStyle(attr.value);\n                if (safeStyle === null) {\n                  attributesToRemove.push({el, attrName});\n                  return;\n                }\n                el.setAttribute('style', safeStyle);\n              }\n            });\n          }\n          el = walker.nextNode();\n        }\n\n        // Now safely remove elements after traversal is complete\n        elementsToRemove.forEach(el => {\n          if (el.parentNode) {\n            el.parentNode.removeChild(el);\n          }\n        });\n\n        // Remove disallowed attributes\n        attributesToRemove.forEach(({el, attrName}) => {\n          if (el.isConnected) {\n            el.removeAttribute(attrName);\n          }\n        });\n      }\n\n      // Return sanitized HTML when caller passed a string\n      if (typeof element === 'string') {\n        return root.innerHTML;\n      }\n    } catch (error) {\n      throw ErrorManager.handle(error, {\n        context: 'TemplateManager.sanitizeElement',\n        data: {element}\n      });\n    }\n  },\n\n  sanitizeUrlAttribute(value) {\n    if (typeof value !== 'string') return null;\n\n    const trimmed = value.trim();\n    const lower = trimmed.toLowerCase();\n\n    const blockedProtocols = ['javascript:', 'data:', 'vbscript:', 'file:', 'about:'];\n    if (blockedProtocols.some(proto => lower.startsWith(proto))) {\n      ErrorManager.handle('Blocked dangerous protocol in attribute URL', {\n        context: 'TemplateManager.sanitizeUrlAttribute',\n        data: {value: trimmed},\n        logLevel: 'warn'\n      });\n      return null;\n    }\n\n    // Allow http/https absolute URLs\n    if (lower.startsWith('http://') || lower.startsWith('https://')) {\n      try {\n        const urlObj = new URL(trimmed, window.location.origin);\n        if (urlObj.protocol === 'http:' || urlObj.protocol === 'https:') {\n          return urlObj.toString();\n        }\n      } catch (e) {\n        return null;\n      }\n      return null;\n    }\n\n    // Allow relative URLs without traversal\n    if (!lower.includes(':')) {\n      if (trimmed.includes('../') || trimmed.includes('..\\\\')) {\n        return null;\n      }\n      return trimmed;\n    }\n\n    return null;\n  },\n\n  sanitizeInlineStyle(styleText) {\n    if (typeof styleText !== 'string' || !styleText.trim()) return null;\n\n    const styles = styleText.split(';').reduce((acc, style) => {\n      // Split only on first colon to preserve URLs (e.g., http://)\n      const colonIndex = style.indexOf(':');\n      if (colonIndex === -1) return acc;\n      const prop = style.substring(0, colonIndex).trim();\n      const val = style.substring(colonIndex + 1).trim();\n      if (prop && val) {\n        const camelProp = prop.replace(/-([a-z])/g, m => m[1].toUpperCase());\n        acc[camelProp] = val;\n      }\n      return acc;\n    }, {});\n\n    const safe = this.sanitizeStyles(styles);\n    const safeEntries = Object.entries(safe)\n      .filter(([, v]) => v !== undefined && v !== null && v !== '');\n\n    if (safeEntries.length === 0) return '';\n\n    return safeEntries.map(([k, v]) => `${k.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${v}`).join('; ');\n  },\n\n  async validateMarkup(content) {\n    return new Promise((resolve, reject) => {\n      try {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(content, 'text/html');\n\n        const parseError = doc.querySelector('parsererror');\n        if (parseError) {\n          reject(new Error('HTML parsing error: ' + parseError.textContent));\n          return;\n        }\n\n        resolve(true);\n\n      } catch (error) {\n        ErrorManager.handle(error, {\n          context: 'TemplateManager.validateMarkup',\n          data: {content}\n        });\n        reject(error);\n      }\n    });\n  },\n\n  isValidPath(path) {\n    if (typeof path !== 'string' || !path) return false;\n\n    if (!path.startsWith('/')) return false;\n\n    const pathLower = path.toLowerCase();\n    if (!this.config.security.allowedExtensions.some(ext => pathLower.endsWith(ext))) {\n      return false;\n    }\n\n    if (pathLower.includes('../') || pathLower.includes('./')) {\n      return false;\n    }\n\n    if (this.state.serverPaths.size > 0) {\n      return this.state.serverPaths.has(this.normalizePath(path));\n    }\n\n    return true;\n  },\n\n  isValidUrl(url) {\n    try {\n      const parsed = new URL(url, window.location.origin);\n      return ['http:', 'https:'].includes(parsed.protocol);\n    } catch {\n      return false;\n    }\n  },\n\n  normalizePath(path) {\n    return path.replace(/^\\/+|\\/+$/g, '');\n  },\n\n  setupPerformanceMonitoring() {\n    if (!window.PerformanceObserver) return;\n\n    this.state.performanceObserver = new PerformanceObserver((list) => {\n      list.getEntries().forEach(entry => {\n        if (entry.entryType === 'measure' && entry.name.startsWith('template-')) {\n          this.recordPerformance(entry.name, {\n            duration: entry.duration,\n            startTime: entry.startTime,\n            detail: entry.detail\n          });\n        }\n      });\n    });\n\n    this.state.performanceObserver.observe({\n      entryTypes: ['measure']\n    });\n\n    performance.getEntriesByType('measure').forEach(entry => {\n      if (entry.name.startsWith('template-')) {\n        this.recordPerformance(entry.name, {\n          duration: entry.duration,\n          startTime: entry.startTime,\n          detail: entry.detail\n        });\n      }\n    });\n  },\n\n  recordPerformance(name, data) {\n    const event = Now.getManager('event');\n    if (event) {\n      event.emit('template:performance', {\n        name,\n        ...data,\n        timestamp: Date.now()\n      });\n    }\n  },\n\n  recordError(error, path) {\n    const event = Now.getManager('event');\n    if (event) {\n      event.emit('template:error', {\n        error,\n        path,\n        timestamp: Date.now()\n      });\n    }\n  },\n\n  clearCache() {\n    this.state.cache.clear();\n  },\n\n  /**\n   * Process data-script directive\n   * Calls a global function after template processing is complete\n   * @param {HTMLElement} element - Element with data-script attribute\n   * @param {Object} context - Template context with state/data\n   */\n  processDataScript(element, context) {\n    const scriptFn = element.dataset.script;\n    if (!scriptFn) return;\n\n    if (typeof window[scriptFn] !== 'function') {\n      console.warn(`TemplateManager: Function \"${scriptFn}\" not found in global scope`);\n      return;\n    }\n\n    // Store for cleanup\n    this.state.activeScripts.set(element, {fn: scriptFn});\n\n    // Call the function with element and context data\n    try {\n      const data = context.state?.data || context.data || {};\n      const result = window[scriptFn](element, data);\n\n      // If function returns a cleanup function, store it\n      if (typeof result === 'function') {\n        this.state.activeScripts.get(element).cleanupFn = result;\n      }\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataScript',\n        data: {scriptFn, element}\n      });\n    }\n  },\n\n  /**\n   * Cleanup all active scripts before page navigation\n   * Calls cleanup functions if provided by the script\n   */\n  cleanupScripts() {\n    for (const [element, scriptInfo] of this.state.activeScripts) {\n      // Call cleanup function if exists\n      if (typeof scriptInfo.cleanupFn === 'function') {\n        try {\n          scriptInfo.cleanupFn();\n        } catch (e) {\n          console.warn('TemplateManager: Script cleanup error for', scriptInfo.fn, e);\n        }\n      }\n    }\n    this.state.activeScripts.clear();\n  },\n\n  processTemplate(element, context) {\n    if (!element || !context) return;\n\n    // Check if element has ApiComponent with existing data - preserve it for SPA navigation\n    if (element._apiComponent && element._apiComponent.data && !context.state?.data) {\n      context = {\n        ...context,\n        state: {\n          ...context.state,\n          data: element._apiComponent.data\n        },\n        data: element._apiComponent.data\n      };\n    }\n\n    this.config.reactive = context.reactive;\n    this.config.debug = context.debug;\n\n    try {\n      if (this.config.security.validateMarkup) {\n        this.validateMarkup(element.innerHTML);\n      }\n\n      if (this.config.security.sanitize) {\n        this.sanitizeElement(element);\n      }\n\n      this.processDataDirectives(element, context);\n      this.processInterpolation(element, context);\n\n      // After processing template directives, scan the element subtree so element/form managers can enhance\n      // Skip scan if element is not connected to DOM (e.g., in DocumentFragment or temporary container)\n      // This prevents MutationObserver from triggering premature cleanup when nodes are moved\n      const shouldScan = context.skipScan !== true && element.isConnected;\n\n      if (shouldScan) {\n        try {\n          const elementManager = Now.getManager('element');\n          const formManager = Now.getManager('form');\n\n          if (elementManager && typeof elementManager.scan === 'function') {\n            elementManager.scan(element);\n          }\n\n          if (formManager && typeof formManager.scan === 'function') {\n            formManager.scan(element);\n          }\n        } catch (err) {\n          ErrorManager.handle('TemplateManager.postProcessScan failed', {\n            context: 'TemplateManager.processTemplate',\n            data: {error: err}\n          });\n        }\n      }\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processTemplate',\n        data: {element, context}\n      });\n      return this.renderError(error);\n    }\n  },\n\n  processTemplateString(template, context, container) {\n    try {\n      if (!container) {\n        container = document.createElement('div');\n      }\n\n      container.innerHTML = template;\n\n      this.processDataDirectives(container, context);\n      this.processInterpolation(container, context);\n\n      // After creating DOM from template string, run element/form scans for the new nodes\n      try {\n        const elementManager = Now.getManager('element');\n        const formManager = Now.getManager('form');\n\n        if (elementManager && typeof elementManager.scan === 'function') {\n          elementManager.scan(container);\n        }\n\n        if (formManager && typeof formManager.scan === 'function') {\n          formManager.scan(container);\n        }\n      } catch (err) {\n        ErrorManager.handle('TemplateManager.processTemplateString.postScan', {\n          context: 'TemplateManager.processTemplateString',\n          data: {error: err}\n        });\n      }\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processTemplateString',\n        data: {template, context, container}\n      });\n      container.innerHTML = this.renderError(error);\n    }\n  },\n\n  processInterpolation(element, context) {\n    const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);\n    let node = walker.currentNode;\n    while (node) {\n      if (node.textContent) {\n        const matches = node.textContent.match(/\\{\\{(.+?)\\}\\}/g);\n        if (matches) {\n          matches.forEach(match => {\n            const expr = match.slice(2, -2).trim();\n            const value = ExpressionEvaluator.evaluate(expr, {...context.state, ...context.methods}, context);\n            node.textContent = node.textContent.replace(match, value ?? '');\n          });\n        }\n      }\n      node = walker.nextNode();\n    }\n  },\n\n  hasOperators(str) {\n    return /[\\+\\-\\*\\/\\(\\)\\[\\]\\{\\}\\!\\?\\:\\<\\>\\&\\|\\=\\,]/.test(str);\n  },\n\n  renderError(error) {\n    return `\n        <div class=\"error-boundary\">\n          <p>Template Error: ${error.message}</p>\n          <button class=\"button close-modal\">Close</button>\n        </div>\n      `;\n  },\n\n  processDataDirectives(element, context) {\n    if (!context || !context.state) {\n      ErrorManager.handle('Invalid context for data directives processing', {\n        context: 'TemplateManager.processDataDirectives',\n        data: {element, context}\n      });\n      return;\n    }\n\n    if (context.reactive && !context._updateQueue) {\n      context._updateQueue = new Set();\n    }\n\n    if (context.parentId) {\n      this.cleanupComponentHandlers(context.parentId);\n    }\n\n    const walker = document.createTreeWalker(element, NodeFilter.SHOW_ELEMENT, null, false);\n    let el = walker.currentNode;\n\n    // Collect data-for elements to process after other directives\n    const dataForElements = [];\n\n    while (el) {\n      if (el.attributes && this.config.security.allowedTags.includes(el.tagName.toLowerCase())) {\n        Array.from(el.attributes).forEach(attr => {\n          if (!attr.name.startsWith('data-')) return;\n\n          const directive = attr.name.substring(5);\n          const value = attr.value;\n\n          // Collect data-for elements for later processing\n          if (directive === 'for') {\n            dataForElements.push({el, value});\n            return;\n          }\n\n          // Skip directives inside template tags (they will be processed by data-for)\n          if (el.closest && el.closest('template')) {\n            return;\n          }\n\n          switch (directive) {\n            case 'text':\n              this.processDataText(el, value, context);\n              break;\n            case 'html':\n              this.processDataHtml(el, value, context);\n              break;\n            case 'if':\n              this.processDataIf(el, value, context);\n              break;\n            case 'class':\n              this.processDataClass(el, value, context);\n              break;\n            case 'attr':\n              this.processDataAttr(el, value, context);\n              break;\n            case 'style':\n              this.processDataStyle(el, value, context);\n              break;\n            case 'on':\n              this.processDataOn(el, value, context);\n              break;\n            case 'container':\n              this.processDataContainer(el, value, context);\n              break;\n            case 'model':\n              this.processDataModel(el, value, context);\n              break;\n            case 'checked':\n              this.processDataChecked(el, value, context);\n              break;\n            // Animation directives\n            case 'show':\n            case 'enter':\n            case 'leave':\n            case 'transition':\n              // Process all animation directives together\n              if (typeof this.processDataAnimation === 'function') {\n                this.processDataAnimation(el, context);\n              }\n              break;\n          }\n        });\n      }\n      el = walker.nextNode();\n    }\n\n    // Process data-for elements AFTER other directives\n    // This ensures template content is not pre-processed with wrong context\n    dataForElements.forEach(({el, value}) => {\n      this.processDataFor(el, value, context);\n    });\n\n    if (context.id && element.dataset?.parentContext) {\n      element.dataset.parentContext = context.id;\n    }\n  },\n\n  processDataText(el, expression, context) {\n    if (!el || !expression || !context) return;\n\n    try {\n      if (!el._textBinding) {\n        el._textBinding = {\n          expression,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          formatters: [],\n          lastValue: null\n        };\n\n        const parts = expression.split('|').map(p => p.trim());\n        if (parts.length > 1) {\n          el._textBinding.expression = parts[0];\n          el._textBinding.formatters = parts.slice(1);\n        }\n      } else {\n        // Only update binding if new context has data, otherwise preserve existing binding\n        // This prevents SPA navigation from clearing data that ApiComponent loaded\n        const existingHasData = el._textBinding.originalState?.data;\n        const newHasData = context.state?.data;\n\n        if (newHasData || !existingHasData) {\n          el._textBinding.originalState = this.deepClone(context.state);\n          el._textBinding.originalContext = {...context};\n        }\n      }\n\n      const updateText = () => {\n        if (!el) return;\n\n        try {\n          const currentText = el.textContent?.trim();\n\n          // Use originalState from binding (captured at creation time with correct item context)\n          const state = el._textBinding.originalState || context.state;\n          const ctx = el._textBinding.originalContext || context;\n\n          let value = ExpressionEvaluator.evaluate(el._textBinding.expression, {...state, ...ctx.computed}, ctx);\n\n          if (el._textBinding.formatters.length > 0) {\n            value = Utils.string.applyFormatters(value, el._textBinding.formatters, ctx);\n          }\n\n          const newText = this.valueToString(value);\n\n          if (newText === currentText) {\n            return;\n          }\n\n          el.textContent = newText;\n          el._textBinding.lastValue = newText;\n\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataText',\n            data: {el, expression, context}\n          });\n          el.textContent = '';\n        }\n      };\n\n      updateText();\n\n      this.setupReactiveUpdate(el, context, 'Text', updateText);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataText',\n        data: {el, expression, context}\n      });\n      el.textContent = '';\n    }\n  },\n\n  processDataHtml(el, value, context) {\n    if (!el || !value || !context) return;\n\n    try {\n      if (!el._htmlBinding) {\n        el._htmlBinding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          lastHtml: null\n        };\n      } else {\n        // Only update binding if new context has data, otherwise preserve existing binding\n        const existingHasData = el._htmlBinding.originalState?.data;\n        const newHasData = context.state?.data;\n\n        if (newHasData || !existingHasData) {\n          el._htmlBinding.originalState = this.deepClone(context.state);\n          el._htmlBinding.originalContext = {...context};\n        }\n      }\n      const updateDataHtml = () => {\n        const getHtmlContent = () => {\n          const state = el._htmlBinding.originalState || context.state;\n          const ctx = el._htmlBinding.originalContext || context;\n          let content = ExpressionEvaluator.evaluate(el._htmlBinding.value, {...state, ...ctx.computed}, ctx);\n\n          if (content === undefined && el._htmlBinding) {\n            content = ExpressionEvaluator.evaluate(el._htmlBinding.value, {...el._htmlBinding.originalState, ...el._htmlBinding.originalContext.computed}, context);\n          }\n\n          return content;\n        };\n\n        const updateHtml = (content) => {\n          if (content === null || content === undefined) {\n            el.innerHTML = '';\n            return;\n          }\n\n          content = String(content);\n\n          if (content === el._htmlBinding.lastHtml) return;\n\n          if (this.config.security.sanitize) {\n            const sanitized = this.sanitizeElement(content);\n            if (typeof sanitized === 'string') {\n              content = sanitized;\n            }\n          }\n\n          el.innerHTML = content;\n          el._htmlBinding.lastHtml = content;\n\n          this.processDataDirectives(el, context);\n          this.processInterpolation(el, context);\n        };\n\n        updateHtml(getHtmlContent());\n      };\n\n      updateDataHtml();\n\n      this.setupReactiveUpdate(el, context, 'Html', updateDataHtml);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataHtml',\n        data: {el, value, context}\n      });\n      el.innerHTML = '';\n    }\n  },\n\n  processDataIf(el, expression, context) {\n    if (!el || !expression || !context) return;\n\n    try {\n      if (!el._ifBinding) {\n        el._ifBinding = {\n          expression,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          parent: el.parentNode,\n          nextSibling: el.nextSibling,\n          comment: document.createComment(`if: ${expression}`),\n          condition: true,\n          isAnimating: false,\n          listeners: new Set(),\n          cleanup: null\n        };\n\n        el._ifBinding.originalStyles = {\n          display: window.getComputedStyle(el).display,\n          animationName: window.getComputedStyle(el).animationName\n        };\n\n        if (el.classList.contains('animated')) {\n          el._ifBinding.animated = true;\n        }\n      } else {\n        // Only update binding if new context has data, otherwise preserve existing binding\n        const existingHasData = el._ifBinding.originalState?.data;\n        const newHasData = context.state?.data;\n\n        if (newHasData || !existingHasData) {\n          el._ifBinding.originalState = this.deepClone(context.state);\n          el._ifBinding.originalContext = {...context};\n        }\n      }\n\n      const binding = el._ifBinding;\n\n      const evaluateCondition = () => {\n        const state = binding.originalState || context.state;\n        const ctx = binding.originalContext || context;\n        let result = ExpressionEvaluator.evaluate(binding.expression, {...state, ...ctx.computed}, ctx);\n        return !!result;\n      };\n\n      const cleanupElement = (element) => {\n        if (element._eventBinding) {\n          element._eventBinding.handlers.forEach(handlerId => {\n            EventSystemManager.removeHandler(handlerId);\n          });\n        }\n\n        ['text', 'html', 'class', 'attr', 'model'].forEach(type => {\n          this.cleanupReactiveUpdate(element, type);\n        });\n\n        const componentManager = Now.getManager('component');\n        if (componentManager) {\n          const componentId = element.dataset?.componentId;\n          if (componentId) {\n            componentManager.destroyComponent(componentId);\n          }\n        }\n\n        Array.from(element.children).forEach(child => {\n          cleanupElement(child);\n        });\n\n        Object.keys(element).forEach(key => {\n          if (key.startsWith('_')) {\n            delete element[key];\n          }\n        });\n      };\n\n      const handleAnimation = (element, showing) => {\n        return new Promise(resolve => {\n          if (!binding.animated) {\n            resolve();\n            return;\n          }\n\n          binding.isAnimating = true;\n\n          const animationClasses = showing ?\n            ['fade-in', 'animate-in'] :\n            ['fade-out', 'animate-out'];\n\n          element.classList.add(...animationClasses);\n\n          const cleanup = () => {\n            element.classList.remove(...animationClasses);\n            element.removeEventListener('animationend', onAnimationEnd);\n            binding.isAnimating = false;\n            resolve();\n          };\n\n          const onAnimationEnd = (e) => {\n            if (e.target === element) {\n              cleanup();\n            }\n          };\n\n          element.addEventListener('animationend', onAnimationEnd);\n\n          setTimeout(cleanup, 1000);\n        });\n      };\n\n      const updateVisibility = async () => {\n        const shouldShow = evaluateCondition();\n\n        if (shouldShow === binding.condition && !binding.isAnimating) {\n          return;\n        }\n\n        try {\n          if (shouldShow) {\n            if (!el.parentNode) {\n              if (!binding.parent) {\n                binding.parent = document.body;\n              }\n\n              if (binding.comment && binding.nextSibling) {\n                binding.parent.insertBefore(binding.comment, binding.nextSibling);\n              } else {\n                binding.parent.appendChild(binding.comment);\n              }\n\n              if (binding.nextSibling) {\n                binding.parent.insertBefore(el, binding.comment);\n              } else {\n                binding.parent.appendChild(el);\n              }\n\n              await handleAnimation(el, true);\n\n              el.style.display = binding.originalStyles.display;\n\n              this.processDataDirectives(el, context);\n              this.processInterpolation(el, context);\n\n              const componentManager = Now.getManager('component');\n              if (componentManager) {\n                componentManager.initializeExistingElements();\n              }\n\n              // Scan newly inserted node subtree for element/form enhancements\n              try {\n                const elementManager = Now.getManager('element');\n                const formManager = Now.getManager('form');\n\n                if (elementManager && typeof elementManager.scan === 'function') {\n                  elementManager.scan(el);\n                }\n\n                if (formManager && typeof formManager.scan === 'function') {\n                  formManager.scan(el);\n                }\n              } catch (err) {\n                ErrorManager.handle('processDataIf.postInsertScan failed', {\n                  context: 'TemplateManager.processDataIf',\n                  data: {error: err}\n                });\n              }\n\n              if (binding.comment && binding.comment.parentNode) {\n                binding.comment.parentNode.removeChild(binding.comment);\n              }\n            }\n          } else {\n            if (el.parentNode) {\n              await handleAnimation(el, false);\n\n              cleanupElement(el);\n\n              binding.parent = el.parentNode;\n              binding.nextSibling = el.nextSibling;\n\n              if (binding.parent) {\n                if (binding.comment) {\n                  try {\n                    binding.parent.insertBefore(binding.comment, el.nextSibling);\n                  } catch (err) {\n                    binding.parent.appendChild(binding.comment);\n                  }\n                }\n                el.remove();\n              }\n            }\n          }\n\n          binding.condition = shouldShow;\n          EventManager.emit('if:updated', {\n            element: el,\n            condition: shouldShow,\n            expression: expression\n          });\n\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataIf',\n            type: 'error:template',\n            data: {expression, el}\n          });\n        }\n      };\n\n      updateVisibility();\n\n      this.setupReactiveUpdate(el, context, 'If', updateVisibility);\n\n      binding.cleanup = () => {\n        cleanupElement(el);\n        this.cleanupReactiveUpdate(el, 'If');\n        binding.comment.remove();\n        binding.listeners.clear();\n        try {\n          delete el._ifBinding;\n        } catch (e) {\n          el._ifBinding = null;\n        }\n      };\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataIf',\n        type: 'error:template',\n        data: {expression, el}\n      });\n    }\n  },\n\n  processDataClass(el, value, context) {\n    if (!el || !value || !context) return;\n\n    try {\n      if (!el._classBinding) {\n        el._classBinding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context}\n        };\n      } else {\n        // Only update binding if new context has data, otherwise preserve existing binding\n        const existingHasData = el._classBinding.originalState?.data;\n        const newHasData = context.state?.data;\n\n        if (newHasData || !existingHasData) {\n          el._classBinding.originalState = this.deepClone(context.state);\n          el._classBinding.originalContext = {...context};\n        }\n      }\n\n      // Detect mode based on value format:\n      // 1. Ternary mode: \"condition ? 'classA' : 'classB'\" - switch between two classes\n      // 2. Binding mode: \"className:expression\" - toggle class based on condition\n      // 3. Expression mode: \"data.icon\" or \"data.icon + ' extra'\" - add class from expression\n\n      const hasTernaryClassSwitch = /[\\s]+\\?[\\s]*['\"][^'\"]+['\"][\\s]*:[\\s]*['\"][^'\"]+['\"]/.test(value);\n      const hasBindingColon = value.includes(':') && !hasTernaryClassSwitch;\n\n      // Mode 1: Ternary class switch - \"condition ? 'classTrue' : 'classFalse'\"\n      if (hasTernaryClassSwitch) {\n        const ternary = /(.+?)[\\s]+\\?[\\s]*['\"]([^'\"]+)['\"][\\s]*:[\\s]*['\"]([^'\"]+)['\"]/.exec(value);\n        if (ternary) {\n          const updateClassTernary = () => {\n            try {\n              const state = el._classBinding.originalState || context.state;\n              const ctx = el._classBinding.originalContext || context;\n              let shouldApply = ExpressionEvaluator.evaluate(ternary[1].trim(), {...state, ...ctx.computed}, ctx);\n\n              if (shouldApply) {\n                el.classList.add(ternary[2]);\n                el.classList.remove(ternary[3]);\n              } else {\n                el.classList.remove(ternary[2]);\n                el.classList.add(ternary[3]);\n              }\n\n            } catch (error) {\n              ErrorManager.handle(`Error evaluating class ternary \"${value}\"`, {\n                context: 'TemplateManager.processDataClass',\n                data: {el, value, context}\n              });\n            }\n          };\n\n          updateClassTernary();\n          this.setupReactiveUpdate(el, context, 'Class', updateClassTernary);\n          return;\n        }\n      }\n\n      // Mode 2: Binding mode - \"className:expression, className2:expression2\"\n      if (hasBindingColon) {\n        const bindings = value.split(',').map(binding => binding.trim());\n\n        bindings.forEach(binding => {\n          try {\n            const updateClass = () => {\n              const colonIndex = binding.indexOf(':');\n              if (colonIndex === -1) return;\n\n              const className = binding.substring(0, colonIndex).trim();\n              const expression = binding.substring(colonIndex + 1).trim();\n\n              if (!className || !expression) {\n                ErrorManager.handle(`Invalid data-class binding: '${binding}'. Expected format \"className:expression\"`, {\n                  context: 'TemplateManager.processDataClass',\n                  data: {el, value, context},\n                  logLevel: 'warn'\n                });\n                return;\n              }\n\n              const state = el._classBinding.originalState || context.state;\n              const ctx = el._classBinding.originalContext || context;\n              let shouldApply = ExpressionEvaluator.evaluate(expression, {...state, ...ctx.computed}, ctx);\n\n              if (shouldApply) {\n                el.classList.add(className);\n              } else {\n                el.classList.remove(className);\n              }\n            };\n\n            updateClass();\n            this.setupReactiveUpdate(el, context, 'Class', updateClass);\n\n          } catch (error) {\n            ErrorManager.handle(error, {\n              context: 'TemplateManager.processDataClass',\n              data: {el, value, context, binding}\n            });\n          }\n        });\n        return;\n      }\n\n      // Mode 3: Expression mode - \"data.icon\" or \"data.icon + ' extra-class'\"\n      // Evaluates expression and adds resulting class(es) to element\n      const updateClassExpression = () => {\n        try {\n          const state = el._classBinding.originalState || context.state;\n          const ctx = el._classBinding.originalContext || context;\n          let classValue = ExpressionEvaluator.evaluate(value, {...state, ...ctx.computed}, ctx);\n\n          // Remove previously added classes from this expression\n          if (el._classBinding.addedClasses) {\n            el._classBinding.addedClasses.forEach(cls => {\n              if (cls) el.classList.remove(cls);\n            });\n          }\n\n          // Add new classes if value exists\n          if (classValue) {\n            const classes = String(classValue).split(/\\s+/).filter(cls => cls);\n            classes.forEach(cls => el.classList.add(cls));\n            el._classBinding.addedClasses = classes;\n          } else {\n            el._classBinding.addedClasses = [];\n          }\n\n        } catch (error) {\n          ErrorManager.handle(`Error evaluating class expression \"${value}\"`, {\n            context: 'TemplateManager.processDataClass',\n            data: {el, value, context}\n          });\n        }\n      };\n\n      updateClassExpression();\n      this.setupReactiveUpdate(el, context, 'Class', updateClassExpression);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataClass',\n        data: {el, value, context},\n      });\n    }\n  },\n\n  processDataAttr(el, value, context) {\n    if (!el || !value || !context) return;\n\n    try {\n      if (!el._Binding) {\n        el._Binding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n        };\n      } else {\n        // Only update binding if new context has data, otherwise preserve existing binding\n        const existingHasData = el._Binding.originalState?.data;\n        const newHasData = context.state?.data;\n\n        if (newHasData || !existingHasData) {\n          el._Binding.originalState = this.deepClone(context.state);\n          el._Binding.originalContext = {...context};\n        }\n      }\n\n      const bindings = value.split(',').map(binding => binding.trim());\n      bindings.forEach(binding => {\n        try {\n          const updateAttr = () => {\n            const [attrName, expression] = binding.split(':').map(s => s.trim());\n\n            if (!attrName || !expression) {\n              ErrorManager.handle(`Invalid attribute binding: ${binding}`, {\n                context: 'TemplateManager.processDataAttr',\n                data: {el, value, context},\n                logLevel: 'warn'\n              });\n              return;\n            }\n\n            if (!/^[a-zA-Z0-9\\-_]+$/.test(attrName)) {\n              ErrorManager.handle(`Invalid attribute name: ${attrName}`, {\n                context: 'TemplateManager.processDataAttr',\n                data: {el, value, context},\n                logLevel: 'warn'\n              });\n              return;\n            }\n\n            // Use originalState from binding (captured at creation time with correct item context)\n            const state = el._Binding.originalState || context.state;\n            const ctx = el._Binding.originalContext || context;\n\n            let attrValue = ExpressionEvaluator.evaluate(expression, {...state, ...ctx.computed}, ctx);\n\n            // Check if element has ElementFactory instance with property handlers\n            const elementManager = Now.getManager('element');\n            const instance = elementManager?.getInstanceByElement(el);\n\n            if (instance && instance.constructor.propertyHandlers && instance.constructor.propertyHandlers[attrName]) {\n              // Use ElementFactory property handler\n              const handler = instance.constructor.propertyHandlers[attrName];\n              if (handler.set) {\n                handler.set.call(instance.constructor, instance, attrValue);\n              } else {\n                console.error(`Property handler for '${attrName}' has no setter`);\n              }\n            } else {\n              // Fallback to standard attribute setting\n              const booleanAttrs = [\n                'disabled', 'checked', 'readonly', 'required', 'autofocus', 'multiple',\n                'novalidate', 'formnovalidate', 'selected', 'hidden', 'open', 'controls',\n                'loop', 'muted', 'playsinline', 'reversed', 'scoped', 'async', 'defer'\n              ];\n              const isBooleanAttr = booleanAttrs.includes(attrName.toLowerCase());\n\n              // Handle 'value' attribute specially for form elements\n              if (attrName === 'value' && (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA')) {\n                // Skip file inputs - browser security prohibits setting value\n                // Use data-files attribute instead for existing files\n                if (el.type === 'file') {\n                  ErrorManager.handle('Cannot set value on file input. Use data-files attribute for existing files.', {\n                    context: 'TemplateManager.processDataAttr',\n                    data: {el, attrName, expression},\n                    logLevel: 'warn'\n                  });\n                  return;\n                }\n                if (el.tagName === 'SELECT') {\n                  // For select, set value after options are ready\n                  if (attrValue != null) {\n                    el.value = String(attrValue);\n                  }\n                } else {\n                  el.value = attrValue ?? '';\n                }\n              } else if (isBooleanAttr && attrValue) {\n                el.setAttribute(attrName, attrName);\n              } else if (!isBooleanAttr && attrValue != null) {\n                el.setAttribute(attrName, attrValue);\n              } else {\n                el.removeAttribute(attrName);\n              }\n            }\n          };\n\n          updateAttr();\n\n          this.setupReactiveUpdate(el, context, 'Attr', updateAttr);\n\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataAttr',\n            data: {el, value, context, binding}\n          });\n        }\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataAttr',\n        data: {el, value, context}\n      });\n    }\n  },\n\n  processDataStyle(el, value, context) {\n    if (!el || !value || !context) return;\n    try {\n      if (!el._styleBinding) {\n        el._styleBinding = {\n          value,\n          originalState: this.cloneState(context.state),\n          originalContext: {...context},\n          lastStyles: null\n        };\n      } else {\n        // Update binding with new context\n        el._styleBinding.originalState = this.cloneState(context.state);\n        el._styleBinding.originalContext = {...context};\n      }\n\n      const updateStyles = () => {\n        try {\n          let styles = {};\n\n          if (value.startsWith('{') && value.endsWith('}')) {\n            const styleObj = ExpressionEvaluator.evaluate(value, {...context.state, ...context.computed}, context);\n            if (typeof styleObj === 'object') {\n              styles = styleObj;\n            }\n          } else {\n            const styleStr = value.replace(/\\{\\{(.+?)\\}\\}/g, (match, expr) => {\n              const val = ExpressionEvaluator.evaluate(expr, {...context.state, ...context.computed}, context);\n              return val != null ? val : '';\n            });\n\n            styles = styleStr.split(';').reduce((acc, style) => {\n              // Split only on first colon to preserve URLs (e.g., http://)\n              const colonIndex = style.indexOf(':');\n              if (colonIndex === -1) return acc;\n              const prop = style.substring(0, colonIndex).trim();\n              const val = style.substring(colonIndex + 1).trim();\n              if (prop && val) {\n                const camelProp = prop.replace(/-([a-z])/g, m => m[1].toUpperCase());\n                acc[camelProp] = val;\n              }\n              return acc;\n            }, {});\n          }\n\n          if (JSON.stringify(styles) === el._styleBinding.lastStyles) {\n            return;\n          }\n\n          const safeStyles = this.sanitizeStyles(styles);\n\n          Object.assign(el.style, safeStyles);\n\n          el._styleBinding.lastStyles = JSON.stringify(styles);\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataStyle',\n            data: {el, value, context, binding}\n          });\n        }\n      };\n\n      updateStyles();\n\n      if (context.reactive && context._updateQueue) {\n        context._updateQueue.add(updateStyles);\n      }\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataStyle',\n        data: {el, value, context}\n      });\n    }\n  },\n\n  sanitizeStyles(styles) {\n    const allowedProperties = [\n      'display', 'position', 'top', 'right', 'bottom', 'left', 'float', 'clear',\n      'visibility', 'opacity', 'zIndex', 'overflow', 'clip',\n      'width', 'height', 'margin', 'padding', 'border',\n      'borderWidth', 'borderStyle', 'borderColor', 'borderRadius',\n      'boxShadow', 'boxSizing',\n      'textOverflow', 'whiteSpace',\n      'maxWidth', 'maxHeight', 'minWidth', 'minHeight',\n      'color', 'background', 'backgroundColor', 'backgroundImage',\n      'fontSize', 'fontFamily', 'fontWeight', 'textAlign', 'lineHeight',\n      'letterSpacing', 'textTransform', 'textDecoration', 'textIndent',\n      'flex', 'flexDirection', 'flexWrap', 'flexGrow', 'flexShrink', 'flexBasis',\n      'justifyContent', 'alignItems', 'alignContent', 'gap',\n      'gridTemplateColumns', 'gridTemplateRows', 'gridColumn', 'gridRow',\n      'transform', 'transformOrigin', 'perspective',\n      'transition', 'animation',\n      'cursor', 'pointerEvents'\n    ];\n\n    const safeStyles = {};\n    for (const [key, value] of Object.entries(styles)) {\n      if (allowedProperties.includes(key)) {\n        if (typeof value === 'string' && value.includes('url(')) {\n          const urlValue = this.sanitizeUrlValue(value);\n          if (urlValue) {\n            safeStyles[key] = urlValue;\n          }\n        } else {\n          safeStyles[key] = value;\n        }\n      }\n    }\n\n    return safeStyles;\n  },\n\n  /**\n   * Sanitize URL values in CSS to prevent XSS attacks\n   * Supports: http://, https://, relative paths, and data:image/* (including base64)\n   * Blocks: javascript:, data:text/html, and other dangerous protocols\n   */\n  sanitizeUrlValue(value) {\n    if (!value || typeof value !== 'string') return null;\n\n    // Extract URL from url() function\n    const urlMatch = /url\\(['\"]?([^'\"]*)['\"]?\\)/.exec(value);\n    if (!urlMatch || !urlMatch[1]) return null;\n\n    const url = urlMatch[1].trim();\n    if (!url) return null;\n\n    // Check for dangerous protocols\n    const dangerousProtocols = ['javascript:', 'data:text/', 'vbscript:', 'file:', 'about:'];\n    const lowerUrl = url.toLowerCase();\n\n    for (const protocol of dangerousProtocols) {\n      if (lowerUrl.startsWith(protocol)) {\n        ErrorManager.handle(`Blocked dangerous protocol in URL: ${protocol}`, {\n          context: 'TemplateManager.sanitizeUrlValue',\n          data: {url},\n          logLevel: 'warn'\n        });\n        return null;\n      }\n    }\n\n    // Allow data:image/* URLs (including base64)\n    if (lowerUrl.startsWith('data:')) {\n      // Validate that it's an image mime type\n      const imageMimeTypes = ['data:image/png', 'data:image/jpeg', 'data:image/jpg',\n        'data:image/gif', 'data:image/svg+xml', 'data:image/webp',\n        'data:image/bmp', 'data:image/ico', 'data:image/x-icon'];\n\n      const isValidImage = imageMimeTypes.some(mime => lowerUrl.startsWith(mime));\n\n      if (!isValidImage) {\n        ErrorManager.handle('Blocked non-image data URL', {\n          context: 'TemplateManager.sanitizeUrlValue',\n          data: {url: url.substring(0, 50) + '...'},\n          logLevel: 'warn'\n        });\n        return null;\n      }\n\n      // Validate base64 encoding if present\n      if (lowerUrl.includes(';base64,')) {\n        const base64Part = url.split(';base64,')[1];\n        if (base64Part) {\n          // Basic validation: check if it looks like valid base64\n          if (!/^[A-Za-z0-9+/]+=*$/.test(base64Part.substring(0, Math.min(100, base64Part.length)))) {\n            ErrorManager.handle('Invalid base64 encoding in data URL', {\n              context: 'TemplateManager.sanitizeUrlValue',\n              data: {url: url.substring(0, 50) + '...'},\n              logLevel: 'warn'\n            });\n            return null;\n          }\n        }\n      }\n\n      return `url(${url})`;\n    }\n\n    // Allow http:// and https:// URLs\n    if (lowerUrl.startsWith('http://') || lowerUrl.startsWith('https://')) {\n      try {\n        const urlObj = new URL(url);\n        // Additional validation: ensure it's really http/https\n        if (urlObj.protocol !== 'http:' && urlObj.protocol !== 'https:') {\n          return null;\n        }\n        return `url(${url})`;\n      } catch (e) {\n        ErrorManager.handle('Invalid absolute URL', {\n          context: 'TemplateManager.sanitizeUrlValue',\n          data: {url},\n          logLevel: 'warn'\n        });\n        return null;\n      }\n    }\n\n    // Allow relative URLs (no protocol)\n    if (!lowerUrl.includes(':')) {\n      // Block path traversal attempts\n      if (url.includes('../') || url.includes('..\\\\')) {\n        ErrorManager.handle('Blocked path traversal in URL', {\n          context: 'TemplateManager.sanitizeUrlValue',\n          data: {url},\n          logLevel: 'warn'\n        });\n        return null;\n      }\n\n      // Basic validation: should look like a valid path\n      if (!/^[a-zA-Z0-9\\/_\\-\\.]+(\\?[a-zA-Z0-9=&_\\-]*)?$/.test(url)) {\n        ErrorManager.handle('Invalid relative URL format', {\n          context: 'TemplateManager.sanitizeUrlValue',\n          data: {url},\n          logLevel: 'warn'\n        });\n        return null;\n      }\n\n      return `url(${url})`;\n    }\n\n    // Block everything else\n    ErrorManager.handle('Blocked unrecognized URL format', {\n      context: 'TemplateManager.sanitizeUrlValue',\n      data: {url},\n      logLevel: 'warn'\n    });\n    return null;\n  },\n\n  processDataFor(el, value, context) {\n    if (!el || !value || !context) return;\n\n    const matches = value.match(/(\\w+)\\s+(?:in|of)\\s+(.+)/);\n    if (!matches) {\n      ErrorManager.handle(`Invalid data-for expression: ${value}`, {\n        context: 'TemplateManager.processDataFor',\n        data: {el, value, context},\n        logLevel: 'warn'\n      });\n      return;\n    }\n\n    try {\n      const [_, itemName, arrayExpr] = matches;\n\n      if (!el._forBinding) {\n        el._forBinding = {\n          value,\n          itemName,\n          arrayExpr,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          lastHash: null\n        };\n      } else {\n        // Update binding with new context when re-processing\n        el._forBinding.originalState = this.deepClone(context.state);\n        el._forBinding.originalContext = {...context};\n      }\n\n      const updateList = () => {\n        try {\n          let array = ExpressionEvaluator.evaluate(arrayExpr, {...context.state, ...context.computed}, context);\n\n          if (!array && el._forBinding.originalState) {\n            array = ExpressionEvaluator.evaluate(arrayExpr, {...el._forBinding.originalState, ...el._forBinding.originalContext.computed}, context);\n          }\n\n          if (!Array.isArray(array)) return;\n\n          const currentHash = JSON.stringify(array);\n          if (el._forBinding.lastHash === currentHash) {\n            return;\n          }\n\n          const templateElement = el.querySelector('template');\n          if (!templateElement) {\n            ErrorManager.handle('No template found in data-for element', {\n              context: 'TemplateManager.processDataFor',\n              data: {el, value, context},\n              logLevel: 'warn'\n            });\n            return;\n          }\n\n          Array.from(el.childNodes).forEach(child => {\n            if (child !== templateElement) {\n              el.removeChild(child);\n            }\n          });\n\n          array.forEach((item, index) => {\n            const childContext = {\n              ...context,\n              state: {\n                ...context.state,\n                [itemName]: item,\n                index\n              },\n              computed: context.computed,\n              methods: context.methods,\n              reactive: context.reactive,\n              _updateQueue: context._updateQueue\n            };\n\n            const clone = templateElement.content.cloneNode(true);\n\n            this.processDataDirectives(clone, childContext);\n            this.processInterpolation(clone, childContext);\n\n            el.appendChild(clone);\n          });\n\n          el._forBinding.lastHash = currentHash;\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataFor',\n            type: 'error:template',\n            data: {el, value}\n          });\n        }\n      };\n\n      updateList();\n\n      this.setupReactiveUpdate(el, context, 'For', updateList);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataFor',\n        type: 'error:template',\n        data: {el, value}\n      });\n    }\n  },\n\n  processDataOn(el, value, context) {\n    if (!el || !value || !context) return;\n\n    const modifiers = {\n      prevent: (e) => {e.preventDefault(); return true;},\n      stop: (e) => {e.stopPropagation(); return true;},\n      once: () => true,\n      capture: () => true,\n      self: (e, el) => e.target === el,\n      trusted: (e) => e.isTrusted,\n      enter: (e) => e.key === 'Enter',\n      tab: (e) => e.key === 'Tab',\n      esc: (e) => e.key === 'Escape',\n      space: (e) => e.key === ' ',\n      left: (e) => e.button === 0,\n      right: (e) => e.button === 2,\n      middle: (e) => e.button === 1,\n      ctrl: (e) => e.ctrlKey,\n      alt: (e) => e.altKey,\n      shift: (e) => e.shiftKey,\n      meta: (e) => e.metaKey\n    };\n\n    try {\n      if (!el._eventBinding) {\n        el._eventBinding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          handlers: new Map(),\n          lastTriggered: {}\n        };\n      } else {\n        // Update binding with new context when re-processing\n        el._eventBinding.originalState = this.deepClone(context.state);\n        el._eventBinding.originalContext = {...context};\n      }\n\n      const bindings = value.split(',').map(b => b.trim());\n\n      bindings.forEach(binding => {\n        const [eventInfo, handlerExpr] = binding.split(':').map(s => s.trim());\n        if (!eventInfo || !handlerExpr) {\n          ErrorManager.handle(`Invalid event binding: ${binding}`, {\n            context: 'TemplateManager.processDataOn',\n            data: {el, value, context},\n            logLevel: 'warn'\n          });\n          return;\n        }\n\n        const [eventType, ...modifierList] = eventInfo.split('.');\n\n        if (el.tagName === 'BUTTON' && eventType === 'click') {\n          if (!modifierList.includes('stop')) {\n            modifierList.push('stop');\n          }\n        }\n\n        const oldHandler = el._eventBinding.handlers.get(eventType);\n        if (oldHandler) {\n          EventSystemManager.removeHandler(oldHandler);\n        }\n\n        const methodMatch = handlerExpr.match(/(\\w+)(?:\\((.*?)\\))?/);\n        if (!methodMatch) {\n          ErrorManager.handle(`Invalid method expression: ${handlerExpr}`, {\n            context: 'TemplateManager.processDataOn',\n            data: {el, value, context},\n            logLevel: 'warn'\n          });\n          return;\n        }\n\n        const [_, methodName, argsStr] = methodMatch;\n\n        // Try to find method in component first, then fallback to global scope\n        let method = context.methods?.[methodName];\n        let isGlobalFunction = false;\n\n        if (typeof method !== 'function') {\n          // Fallback to global function\n          if (typeof window[methodName] === 'function') {\n            method = window[methodName];\n            isGlobalFunction = true;\n          } else {\n            ErrorManager.handle(`Method \"${methodName}\" not found in component or global scope`, {\n              context: 'TemplateManager.processDataOn',\n              data: {el, value, context},\n              logLevel: 'warn'\n            });\n            return;\n          }\n        }\n\n        const parseArgument = (arg) => {\n          arg = arg?.trim();\n          if (!arg) return null;\n\n          if (arg.startsWith(\"'\") || arg.startsWith('\"')) {\n            return arg.slice(1, -1);\n          }\n\n          return () => {\n            let value = ExpressionEvaluator.evaluate(arg, {...context.state, ...context.computed, $event: null}, context);\n\n            if (value === undefined && el._eventBinding.originalState) {\n              value = ExpressionEvaluator.evaluate(arg, {...el._eventBinding.originalState, ...el._eventBinding.originalContext.computed}, context);\n            }\n\n            return value;\n          };\n        };\n\n        const args = argsStr ? argsStr.split(',').map(parseArgument).filter(Boolean) : [];\n\n        const handler = (event) => {\n          try {\n            const now = Date.now();\n            const lastTrigger = el._eventBinding.lastTriggered[eventType] || 0;\n            const minInterval = 100;\n\n            if (now - lastTrigger < minInterval) {\n              return;\n            }\n\n            if (!el.contains(event.target) && el !== event.target) {\n              return;\n            }\n\n            const modifiersPassed = modifierList.every(modifier => {\n              const modifierFn = modifiers[modifier];\n              return modifierFn ? modifierFn(event, el) : true;\n            });\n\n            if (!modifiersPassed) return;\n\n            el._eventBinding.lastTriggered[eventType] = now;\n\n            const evaluatedArgs = args.map(arg =>\n              typeof arg === 'function' ? arg() : arg\n            );\n\n            method.apply(isGlobalFunction ? null : context, [...evaluatedArgs, event]);\n\n            if (modifierList.includes('once')) {\n              EventSystemManager.removeHandler(handlerId);\n            }\n\n          } catch (error) {\n            ErrorManager.handle(error, {\n              context: 'TemplateManager.processDataOn',\n              type: 'template:error',\n              data: {methodName, el, value, context}\n            });\n          }\n        };\n\n        const handlerId = EventSystemManager.addHandler(\n          el,\n          eventType,\n          handler,\n          {\n            componentId: context.id,\n            capture: modifierList.includes('capture'),\n            passive: eventType === 'scroll' || eventType === 'touchmove'\n          }\n        );\n\n        el._eventBinding.handlers.set(eventType, handlerId);\n\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataOn',\n        type: 'template:error',\n        data: {el, value, context}\n      });\n    }\n  },\n\n  processDataContainer(el, value, context) {\n    if (!el || !value || !context) return;\n\n    try {\n      if (!el._containerBinding) {\n        el._containerBinding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          currentPath: null\n        };\n      } else {\n        // Update binding with new context when re-processing\n        el._containerBinding.originalState = this.deepClone(context.state);\n        el._containerBinding.originalContext = {...context};\n      }\n      const updateContainer = () => {\n        const loadComponent = async (componentRef) => {\n          try {\n            if (typeof componentRef === 'string') {\n              const template = await this.loadFromServer(componentRef);\n              if (!template) throw new Error(`Failed to load template: ${componentRef}`);\n\n              const childContext = {\n                ...context,\n                parentId: context.id,\n                state: {...context.state},\n                path: componentRef\n              };\n\n              return {template, context: childContext};\n\n            } else if (componentRef && typeof componentRef === 'object') {\n              if (!componentRef.template) {\n                throw new Error('Component definition missing template');\n              }\n\n              const childContext = {\n                ...context,\n                ...componentRef,\n                parentId: context.id,\n                state: {...context.state, ...componentRef.state}\n              };\n\n              return {template: componentRef.template, context: childContext};\n            }\n\n            throw new Error('Invalid component reference');\n\n          } catch (error) {\n            ErrorManager.handle('Component load failed', {\n              context: 'TemplateManager.processDataContainer',\n              data: {el, value, context, error}\n            });\n            return null;\n          }\n        };\n\n        const renderComponent = async (componentRef) => {\n          try {\n            const component = await loadComponent(componentRef);\n            if (!component) return;\n\n            el.innerHTML = '';\n\n            const container = document.createElement('div');\n            container.innerHTML = component.template;\n\n            this.processDataDirectives(container, component.context);\n            this.processInterpolation(container, component.context);\n\n            el.appendChild(container);\n\n            el._containerBinding.currentPath = typeof componentRef === 'string' ?\n              componentRef : null;\n\n          } catch (error) {\n            ErrorManager.handle('Component render failed', {\n              context: 'TemplateManager.processDataContainer',\n              data: {el, value, context, error}\n            });\n            el.innerHTML = this.renderError(error);\n          }\n        };\n\n        const componentRef = ExpressionEvaluator.evaluate(value, {...context.state, ...context.methods}, context);\n        if (!componentRef) return;\n\n        renderComponent(componentRef);\n      };\n\n      updateContainer();\n\n      this.setupReactiveUpdate(el, context, 'Container', updateContainer);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataContainer',\n        data: {el, value, context}\n      });\n      el.innerHTML = this.renderError(error);\n    }\n  },\n\n  processDataModel(el, value, context) {\n    if (!el || !value || !context) return;\n\n    try {\n      if (!el._modelBinding) {\n        el._modelBinding = {\n          value,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          lastValue: null,\n          initialValue: null,\n          isActive: false,\n          selectionStart: null,\n          selectionEnd: null,\n          modifiers: {\n            lazy: false,\n            number: false,\n            trim: false\n          }\n        };\n\n        el.addEventListener('focus', () => {\n          el._modelBinding.isActive = true;\n          el._modelBinding.selectionStart = el.selectionStart;\n          el._modelBinding.selectionEnd = el.selectionEnd;\n        });\n\n        el.addEventListener('blur', () => {\n          el._modelBinding.isActive = false;\n          el._modelBinding.selectionStart = null;\n          el._modelBinding.selectionEnd = null;\n        });\n\n        const parts = value.split('.');\n        parts.slice(1).forEach(mod => {\n          if (mod in el._modelBinding.modifiers) {\n            el._modelBinding.modifiers[mod] = true;\n          }\n        });\n        el._modelBinding.value = parts[0];\n      } else {\n        // Update binding with new context when re-processing\n        el._modelBinding.originalState = this.deepClone(context.state);\n        el._modelBinding.originalContext = {...context};\n      }\n\n      const updateModel = () => {\n        const binding = el._modelBinding;\n\n        const getModelValue = () => {\n          let modelValue = ExpressionEvaluator.evaluate(binding.value, {...context.state, ...context.computed}, context);\n\n          if (modelValue === undefined && el._modelBinding.originalState) {\n            modelValue = ExpressionEvaluator.evaluate(binding.value, {...el._modelBinding.originalState, ...el._modelBinding.originalContext.computed}, context);\n          }\n\n          if (binding.modifiers.number) {\n            modelValue = modelValue === '' ? null : Number(modelValue);\n          }\n\n          if (binding.modifiers.trim && typeof modelValue === 'string') {\n            modelValue = modelValue.trim();\n          }\n\n          return modelValue;\n        };\n\n        const updateModel = (newValue) => {\n          try {\n            const parts = binding.value.split('.');\n            const prop = parts.pop();\n            const target = parts.length ?\n              parts.reduce((obj, key) => obj[key], context.state) :\n              context.state;\n\n            if (!target || typeof prop !== 'string') return;\n\n            if (binding.modifiers.number) {\n              newValue = newValue === '' ? null : Number(newValue);\n            }\n            if (binding.modifiers.trim && typeof newValue === 'string') {\n              newValue = newValue.trim();\n            }\n\n            if (newValue !== binding.lastValue) {\n              binding.lastValue = newValue;\n              target[prop] = newValue;\n            }\n          } catch (error) {\n            ErrorManager.handle(error, {\n              context: 'TemplateManager.processDataModel',\n              data: {el, value, context}\n            });\n          }\n        };\n\n        if (el._modelHandlers) {\n          Object.entries(el._modelHandlers).forEach(([event, handler]) => {\n            el.removeEventListener(event, handler);\n          });\n        }\n\n        el.addEventListener('focus', () => {\n          binding.isActive = true;\n          binding.selectionStart = el.selectionStart;\n          binding.selectionEnd = el.selectionEnd;\n        });\n\n        el.addEventListener('blur', () => {\n          binding.isActive = false;\n          binding.selectionStart = null;\n          binding.selectionEnd = null;\n        });\n\n        el._modelHandlers = {};\n\n        switch (el.type) {\n          case 'checkbox':\n            el._modelHandlers.change = e => updateModel(e.target.checked);\n            break;\n\n          case 'radio':\n            el._modelHandlers.change = e => {\n              if (e.target.checked) {\n                updateModel(e.target.value);\n              }\n            };\n            break;\n\n          case 'file':\n            el._modelHandlers.change = e => updateModel(e.target.files);\n            break;\n\n          case 'select-multiple':\n            el._modelHandlers.change = e => {\n              const selected = Array.from(e.target.selectedOptions)\n                .map(opt => opt.value);\n              updateModel(selected);\n            };\n            break;\n\n          default:\n            const eventType = binding.modifiers.lazy ? 'change' : 'input';\n            el._modelHandlers[eventType] = e => updateModel(e.target.value);\n\n            el._modelHandlers.keydown = e => {\n              if (e.key === 'Enter') {\n                updateModel(e.target.value);\n              }\n            };\n        }\n\n        Object.entries(el._modelHandlers).forEach(([event, handler]) => {\n          el.addEventListener(event, handler);\n        });\n\n        const initialValue = getModelValue();\n        binding.initialValue = initialValue;\n\n        if (el.type === 'checkbox') {\n          el.checked = !!initialValue;\n        } else if (el.type === 'radio') {\n          el.checked = el.value === String(initialValue);\n        } else if (el.type === 'select-multiple' && Array.isArray(initialValue)) {\n          Array.from(el.options).forEach(option => {\n            option.selected = initialValue.includes(option.value);\n          });\n        } else if (el.tagName === 'SELECT') {\n          el.value = initialValue ?? '';\n          if (el.value !== String(initialValue)) {\n            Array.from(el.options).forEach(option => {\n              option.selected = option.value === String(initialValue);\n            });\n          }\n        } else {\n          el.value = initialValue ?? '';\n        }\n      };\n\n      updateModel();\n\n      this.setupReactiveUpdate(el, context, 'Model', updateModel);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataModel',\n        data: {el, value, context}\n      });\n    }\n  },\n\n  processDataChecked(el, expression, context) {\n    if (!el || !expression || !context) return;\n\n    if (!['checkbox', 'radio'].includes(el.type)) {\n      ErrorManager.handle('data-checked only works with checkbox/radio inputs', {\n        context: 'TemplateManager.processDataChecked',\n        data: {el, expression, context},\n        logLevel: 'warn'\n      });\n      return;\n    }\n\n    try {\n      if (!el._checkedBinding) {\n        el._checkedBinding = {\n          expression,\n          originalState: this.deepClone(context.state),\n          originalContext: {...context},\n          lastValue: null\n        };\n      } else {\n        // Update binding with new context when re-processing\n        el._checkedBinding.originalState = this.deepClone(context.state);\n        el._checkedBinding.originalContext = {...context};\n      }\n\n      const updateChecked = () => {\n        if (!el) return;\n\n        try {\n          const currentChecked = el.checked;\n\n          let isChecked = ExpressionEvaluator.evaluate(el._checkedBinding.expression, {...context.state, ...context.computed}, context);\n\n          if (isChecked === undefined && el._checkedBinding) {\n            isChecked = ExpressionEvaluator.evaluate(el._checkedBinding.expression, {...el._checkedBinding.originalState, ...el._checkedBinding.originalContext.computed}, context);\n          }\n\n          if (isChecked === currentChecked) {\n            return;\n          }\n\n          el.checked = !!isChecked;\n          el._checkedBinding.lastValue = !!isChecked;\n\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'TemplateManager.processDataChecked',\n            data: {el, expression, context}\n          });\n          el.checked = false;\n        }\n      };\n\n      updateChecked();\n\n      this.setupReactiveUpdate(el, context, 'Checked', updateChecked);\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.processDataChecked',\n        data: {el, expression, context}\n      });\n      el.checked = false;\n    }\n  },\n\n  deepClone(obj, seen = new WeakMap()) {\n    if (obj === null || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (seen.has(obj)) {\n      return seen.get(obj);\n    }\n\n    const clone = Array.isArray(obj) ? [] : {};\n    seen.set(obj, clone);\n\n    Object.entries(obj).forEach(([key, value]) => {\n      clone[key] = this.deepClone(value, seen);\n    });\n\n    return clone;\n  },\n\n  cloneState(state) {\n    if (!state || typeof state !== 'object') return state;\n    const clone = Array.isArray(state) ? [] : {};\n\n    for (const key in state) {\n      if (Object.prototype.hasOwnProperty.call(state, key)) {\n        const value = state[key];\n        clone[key] = typeof value === 'object' ? this.cloneState(value) : value;\n      }\n    }\n\n    return clone;\n  },\n\n  cleanupElement(element) {\n    if (!element) return;\n\n    try {\n      if (element._eventBinding) {\n        element._eventBinding.handlers.forEach(handlerId => {\n          EventSystemManager.removeHandler(handlerId);\n        });\n        delete element._eventBinding;\n      }\n\n      const bindingTypes = [\n        '_textBinding',\n        '_htmlBinding',\n        '_ifBinding',\n        '_forBinding',\n        '_classBinding',\n        '_attrBinding',\n        '_styleBinding',\n        '_modelBinding',\n        '_containerBinding',\n        '_checkedBinding'\n      ];\n\n      bindingTypes.forEach(type => {\n        if (element[type]) {\n          if (element[type].cleanup) {\n            element[type].cleanup();\n          }\n          delete element[type];\n        }\n      });\n\n      if (element._updateQueue) {\n        element._updateQueue.clear();\n        delete element._updateQueue;\n      }\n\n      const componentId = element.dataset?.componentId;\n      if (componentId) {\n        delete element.dataset.componentId;\n        delete element.dataset.parentContext;\n      }\n\n      Array.from(element.children).forEach(child => {\n        this.cleanupElement(child);\n      });\n\n      Object.keys(element).forEach(key => {\n        if (key.startsWith('_')) {\n          delete element[key];\n        }\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.cleanupElement',\n        data: {element}\n      });\n    }\n  },\n\n  cleanupComponent(componentId) {\n    if (!componentId) return;\n\n    try {\n      this.cleanupComponentHandlers(componentId);\n\n      const cacheKey = `template:${componentId}`;\n      if (this.state.cache.has(cacheKey)) {\n        this.state.cache.delete(cacheKey);\n        this.state.itemTimestamps.delete(cacheKey);\n      }\n\n      const elements = document.querySelectorAll(`[data-component-id=\"${componentId}\"]`);\n      elements.forEach(element => {\n        this.cleanupElement(element);\n      });\n\n      EventManager.emit('template:cleanup', {\n        componentId,\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.cleanupComponent',\n        data: {componentId}\n      });\n    }\n  },\n\n  cleanup() {\n    try {\n      this.state.cache.clear();\n      this.state.itemTimestamps.clear();\n\n      this.cleanupHandlers();\n\n      const root = document.querySelector(Now.config.mainSelector);\n      if (root) {\n        this.cleanupElement(root);\n      }\n\n      this.state.currentComputation = null;\n      this.state.handlers = new Map();\n      this.state.pendingUpdates = new Set();\n\n      EventManager.emit('template:cleanup:all');\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'TemplateManager.cleanup'\n      });\n    }\n  },\n\n  valueToString(value) {\n    if (value === null || value === undefined) {\n      return '';\n    }\n    if (typeof value === 'object') {\n      try {\n        return JSON.stringify(value);\n      } catch {\n        return String(value);\n      }\n    }\n    return String(value);\n  },\n\n  setStateValue(path, value, state) {\n    const parts = path.split('.');\n    const key = parts.pop();\n    const target = parts.reduce((obj, k) => obj[k] = obj[k] || {}, state);\n    target[key] = value;\n  },\n\n  processTemplateContent(element, context) {\n    this.processDataDirectives(element, context);\n    this.processInterpolation(element, context);\n  },\n\n  render(context, container) {\n    if (!context || typeof context !== 'object') {\n      ErrorManager.handle('Invalid context provided to render.', {\n        context: 'TemplateManager.render',\n        data: {context, container}\n      });\n      return;\n    }\n\n    if (!(container instanceof HTMLElement)) {\n      ErrorManager.handle('Container must be a valid DOM element.', {\n        context: 'TemplateManager.render',\n        data: {context, container}\n      });\n      return;\n    }\n\n    container.innerHTML = '';\n\n    const processedTemplate = this.processTemplate(context.template, context);\n\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = processedTemplate;\n\n    while (tempDiv.firstChild) {\n      container.appendChild(tempDiv.firstChild);\n    }\n\n    const eventManager = Now.getManager('event');\n    if (eventManager) {\n      eventManager.emit('template:render', {\n        componentId: context.id,\n        timestamp: Date.now(),\n        container: container\n      });\n    }\n  },\n\n  cleanupCache() {\n    const now = Date.now();\n    for (const [key, entry] of this.state.cache) {\n      if (entry.expires < now) {\n        this.state.cache.delete(key);\n        this.state.itemTimestamps.delete(key);\n      }\n    }\n  },\n\n  registerEventHandler(handlerExpr, context) {\n    const handlerId = `evt_${Utils.generateUUID()}`;\n    const [methodName, argsString] = handlerExpr.split('(');\n    const args = argsString ? argsString.replace(')', '').split(',').map(arg => arg.trim()) : [];\n    this.state.handlers = this.state.handlers || new Map();\n    this.state.handlers.set(handlerId, (event) => {\n      const method = context.methods[methodName.trim()];\n      if (typeof method === 'function') {\n        method.apply(context, args.concat(event));\n      } else {\n        ErrorManager.handle(`Method ${methodName.trim()} not found in the component`, {\n          context: 'TemplateManager.registerEventHandler',\n          data: {methodName, context}\n        });\n      }\n    });\n\n    this.state.itemTimestamps.set(handlerId, Date.now());\n    return handlerId;\n  },\n\n  cleanupHandlers() {\n    const componentManager = Now.getManager('component');\n    if (!componentManager) return;\n\n    const activeIds = new Set(Array.from(componentManager.instances.keys())\n      .map(el => el.dataset.componentId)\n      .filter(Boolean));\n\n    for (const [handlerId] of this.state.handlers) {\n      const [componentId] = handlerId.split('_');\n      if (!activeIds.has(componentId)) {\n        this.state.handlers.delete(handlerId);\n      }\n    }\n  },\n\n  cleanupComponentHandlers(componentId) {\n    if (!componentId) return;\n\n    const selector = `[data-handler-id^=\"${componentId}_\"]`;\n    document.querySelectorAll(selector).forEach(element => {\n      const handlerId = element.dataset.handlerId;\n      const handler = this.state.handlers.get(handlerId);\n      if (handler) {\n        const eventType = handlerId.split('_')[2];\n        element.removeEventListener(eventType, handler, true);\n        this.state.handlers.delete(handlerId);\n        delete element.dataset.handlerId;\n      }\n    });\n  },\n\n  startCleanupInterval() {\n    this.stopCleanupInterval();\n\n    this.state.cleanupInterval = setInterval(() => {\n      this.performCleanup();\n    }, this.config.cleanup.interval);\n\n    window.addEventListener('beforeunload', () => {\n      this.stopCleanupInterval();\n    });\n\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        this.stopCleanupInterval();\n      }\n    });\n  },\n\n  stopCleanupInterval() {\n    if (this.state.cleanupInterval) {\n      clearInterval(this.state.cleanupInterval);\n      this.state.cleanupInterval = null;\n    }\n  },\n\n  onComponentDestroy(component) {\n    if (component.id) {\n      this.cleanupComponentHandlers(component.id);\n\n      const cacheKey = `template:${component.id}`;\n      if (this.state.cache.has(cacheKey)) {\n        this.state.cache.delete(cacheKey);\n        this.state.itemTimestamps.delete(cacheKey);\n      }\n    }\n  },\n\n  performCleanup() {\n    const now = Date.now();\n    const maxBatch = this.config.cleanup.batchSize;\n    let processed = 0;\n\n    EventManager.emit('app:cleanup:start', {timestamp: now});\n\n    for (const [key, entry] of this.state.cache) {\n      if (now - this.state.itemTimestamps.get(key) > this.config.cleanup.maxCacheAge) {\n        this.state.cache.delete(key);\n        this.state.itemTimestamps.delete(key);\n        processed++;\n      }\n      if (processed >= maxBatch) break;\n    }\n\n    processed = 0;\n    for (const [key, value] of this.state.handlers?.entries() || []) {\n      if (now - this.state.itemTimestamps.get(key) > this.config.cleanup.maxHandlerAge) {\n        this.state.handlers.delete(key);\n        this.state.itemTimestamps.delete(key);\n        processed++;\n      }\n      if (processed >= maxBatch) break;\n    }\n\n    this.state.lastCleanup = now;\n\n    EventManager.emit('app:cleanup:end', {timestamp: now});\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('template', TemplateManager);\n}\n\n// Expose globally\nwindow.TemplateManager = TemplateManager;\n","/**\n * Helper functions for managing reactive updates and cleanup\n */\nconst ReactiveHelpers = {\n  /**\n   * Setup reactive update for an element\n   * @param {HTMLElement} el - Target element\n   * @param {Object} context - Component context\n   * @param {string} updateType - Type of update (e.g., 'text', 'html', 'for')\n   * @param {Function} updateFn - Update function to run\n   */\n  setupReactiveUpdate(el, context, updateType, updateFn) {\n    if (!el || !context || !updateType || !updateFn) return;\n    if (typeof updateFn !== 'function') {\n      console.error(`Invalid update function for ${updateType}`);\n      return;\n    }\n\n    // Remove existing update if any\n    this.cleanupReactiveUpdate(el, updateType);\n\n    if (context.reactive && context._updateQueue) {\n      el[`_has${updateType}Update`] = true;\n\n      const wrappedUpdate = async () => {\n        try {\n          await updateFn();\n        } catch (error) {\n          console.error(`Error in reactive update (${updateType}):`, error);\n          EventManager.emit('reactive:error', {\n            type: updateType,\n            element: el,\n            error\n          });\n        }\n      };\n\n      // Store reference to wrapped update for cleanup\n      el[`_${updateType}UpdateFn`] = wrappedUpdate;\n      context._updateQueue.add(wrappedUpdate);\n    }\n  },\n\n  /**\n   * Clean up reactive update for an element\n   * @param {HTMLElement} el - Target element\n   * @param {string} updateType - Type of update to clean\n   */\n  cleanupReactiveUpdate(el, updateType) {\n    if (!el || !updateType) return;\n\n    const updateKey = `_has${updateType}Update`;\n    const updateFnKey = `_${updateType}UpdateFn`;\n\n    if (el[updateKey]) {\n      // Remove from update queue if exists\n      if (el[updateFnKey] && el._context?._updateQueue) {\n        el._context._updateQueue.delete(el[updateFnKey]);\n      }\n      delete el[updateKey];\n      delete el[updateFnKey];\n    }\n  },\n\n  /**\n   * Clean up all reactive updates for an element\n   * @param {HTMLElement} el - Target element\n   */\n  cleanupAllReactiveUpdates(el) {\n    if (!el) return;\n\n    // Find and remove all reactive update flags\n    Object.keys(el).forEach(key => {\n      if (key.startsWith('_has') && key.endsWith('Update')) {\n        delete el[key];\n      }\n    });\n  }\n};\n\n// Add to TemplateManager\nObject.assign(TemplateManager, ReactiveHelpers);\n","const ComponentManager = {\n  config: {\n    reactive: false,\n    templateCache: true,\n    performance: {\n      monitoring: false,\n      batchUpdates: false\n    },\n  },\n\n  components: new Map(),\n  instances: new Map(),\n  templateCache: new Map(),\n\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n    this.setupI18nListeners();\n    return this;\n  },\n\n  /**\n   * Setup i18n listeners for automatic translation updates\n   * All components will automatically re-render when:\n   * - Translations are loaded for the first time\n   * - User changes locale\n   */\n  setupI18nListeners() {\n    // Re-render all components when translations loaded\n    EventManager.on('i18n:loaded', (event) => {\n      if (event.success) {\n        this.updateAllComponents();\n      }\n    });\n\n    // Re-render all components when locale changed\n    EventManager.on('locale:changed', () => {\n      this.updateAllComponents();\n    });\n\n    // Check if I18nManager already initialized and has translations\n    // This handles the case where ComponentManager loads after I18nManager\n    if (window.I18nManager?.state?.initialized) {\n      // Trigger initial component update\n      this.updateAllComponents();\n    }\n  },\n\n  /**\n   * Update all component instances with new translations\n   * This triggers a re-render for each mounted component\n   */\n  updateAllComponents() {\n    this.instances.forEach(instance => {\n      if (instance._mounted && !instance._destroyed && !instance._updating) {\n        try {\n          this.renderInstance(instance);\n        } catch (error) {\n          this.handleError('Error updating component translations', 'updateAllComponents', {\n            componentId: instance.id,\n            error\n          });\n        }\n      }\n    });\n  },\n\n  define(name, definition) {\n    if (!name || typeof name !== 'string') {\n      throw new Error('Component name must be a string');\n    }\n\n    // Check for duplicate component names\n    if (this.components.has(name)) {\n      const existing = this.components.get(name);\n      console.warn(\n        `⚠️ Component name conflict detected!\\n` +\n        `Component \"${name}\" is already registered.\\n` +\n        `This will overwrite the existing component definition.\\n` +\n        `\\n` +\n        `Existing component: ${existing._registeredFrom || 'unknown source'}\\n` +\n        `New component: ${this._getCurrentScriptSource() || 'current script'}\\n` +\n        `\\n` +\n        `To fix this:\\n` +\n        `1. Use a unique component name (e.g., \"${name}2\", \"${name}_custom\")\\n` +\n        `2. Or remove/rename the conflicting component\\n` +\n        `3. Check your component registration in both files`\n      );\n    }\n\n    const config = {\n      reactive: false,\n      renderStrategy: 'auto',\n      template: null,\n      state: {},\n      methods: {},\n      computed: {},\n      watch: {},\n      events: {},\n      ...definition,\n      _registeredFrom: this._getCurrentScriptSource() || 'unknown'\n    };\n\n    const processedDefinition = this.processDefinition(name, config);\n    this.components.set(name, processedDefinition);\n\n    if (document.readyState !== 'loading') {\n      this.initializeExistingElements(name);\n    }\n\n    return processedDefinition;\n  },\n\n  _getCurrentScriptSource() {\n    try {\n      const error = new Error();\n      const stack = error.stack;\n      if (!stack) return null;\n\n      const lines = stack.split('\\n');\n      for (let i = 0; i < lines.length; i++) {\n        const match = lines[i].match(/https?:\\/\\/[^)]+\\.js/);\n        if (match && !match[0].includes('ComponentManager.js')) {\n          return match[0].split('/').pop();\n        }\n      }\n      return null;\n    } catch (e) {\n      return null;\n    }\n  },\n\n  processDefinition(name, definition) {\n    const processed = {\n      name,\n      reactive: definition.reactive || false,\n      template: definition.template || null,\n      state: definition.state || {},\n      methods: definition.methods || {},\n      computed: definition.computed || {},\n      watch: definition.watch || {},\n      validElement: definition.validElement || null,\n      aria: definition.aria || {},\n      events: definition.events || {},\n      beforeCreate: definition.beforeCreate,\n      created: definition.created,\n      beforeMount: definition.beforeMount,\n      mounted: definition.mounted,\n      beforeUpdate: definition.beforeUpdate,\n      updated: definition.updated,\n      beforeDestroy: definition.beforeDestroy,\n      destroyed: definition.destroyed,\n      errorCaptured: definition.errorCaptured,\n      renderStrategy: definition.renderStrategy || 'auto',\n      errorBoundary: definition.errorBoundary || false,\n      setupElement: definition.setupElement || null\n    };\n\n    return processed;\n  },\n\n  initializeExistingElements(componentName = null) {\n    try {\n      const selector = componentName\n        ? `[data-component=\"${componentName}\"]`\n        : '[data-component]';\n\n      document.querySelectorAll(selector).forEach(element => {\n        const name = element.getAttribute('data-component');\n\n        // Skip api components - they are initialized separately below\n        if (name === 'api') {\n          return;\n        }\n\n        const existingInstance = this.instances.get(element);\n        if (existingInstance &&\n          existingInstance.state.initialized &&\n          !existingInstance._destroyed) {\n          // skip initialized components quietly\n          return;\n        }\n\n        if (this.components.has(name)) {\n          const props = this.extractProps(element);\n          this.mount(element, name, props).catch(error => {\n            console.error(`Failed to initialize component ${name}:`, error);\n          });\n        }\n      });\n\n      // Initialize api components separately - they handle their own rendering after data loads\n      if (window.ApiComponent && typeof ApiComponent.initElements === 'function') {\n        ApiComponent.initElements();\n      }\n    } catch (error) {\n      this.handleError('Error initializing existing elements', 'initializeExistingElements', {error});\n    }\n  },\n\n  extractProps(element) {\n    const props = {};\n\n    Array.from(element.attributes).forEach(attr => {\n      let propName = attr.name;\n      let value = attr.value;\n\n      if (propName === 'data-component') return;\n\n      propName = propName.replace(/^data-/, '');\n\n      if (value.startsWith('[') && value.endsWith(']')) {\n        try {\n          value = JSON.parse(value);\n        } catch (error) {\n          this.handleError(`Failed to parse array value for ${propName}:`, 'extractProps', {propName, value, error});\n        }\n        props[propName] = value;\n        return;\n      }\n\n      if (!isNaN(value)) {\n        value = parseFloat(value);\n      }\n\n      if (value === 'true' || value === 'false') {\n        value = value === 'true';\n      }\n\n      props[propName] = value;\n    });\n\n    const template = element.innerHTML.trim();\n    if (template) {\n      props.template = template;\n    }\n\n    return props;\n  },\n\n  initializeComponent(element, definition, props = {}) {\n    try {\n      const instance = {\n        id: Utils.generateUUID(),\n        element,\n        props: {...props},\n        reactive: definition.reactive || false,\n        renderStrategy: definition.renderStrategy || 'auto',\n        template: definition.template || null,\n        state: {...(definition.state || {})},\n        methods: {},\n        computed: definition.computed || {},\n        watch: definition.watch || {},\n        events: definition.events || {},\n        _definition: definition,\n        _mounted: false,\n        _updating: false,\n        _destroyed: false,\n        render: function() {\n          ComponentManager.renderInstance(this);\n        },\n        refs: new Proxy({}, {\n          get: (target, key) => {\n            return instance.element.querySelector(`[data-ref=\"${key}\"]`);\n          }\n        })\n      };\n\n      if (definition.methods) {\n        Object.entries(definition.methods).forEach(([name, method]) => {\n          instance.methods[name] = method.bind(instance);\n        });\n      }\n\n      if (this.config.performance.monitoring) {\n        this.setupPerformanceMonitoring(instance);\n      }\n\n      return instance;\n    } catch (error) {\n      throw ErrorManager.handle(error, {\n        context: 'ComponentManager.initializeComponent',\n        data: {element, definition, props}\n      });\n    }\n  },\n\n  parseEventSelector(selector) {\n    const parts = selector.trim().split(/\\s+/);\n    const eventName = parts[0];\n    const targetSelector = parts.slice(1).join(' ') || null;\n\n    return [eventName, targetSelector];\n  },\n\n  setupEvents(context, events) {\n    const eventSystem = Now.getManager('eventsystem');\n    const eventManager = Now.getManager('event');\n\n    if (!context._events) {\n      context._events = new Map();\n    }\n\n    Object.entries(events).forEach(([selector, handler]) => {\n      const [eventName, targetSelector] = this.parseEventSelector(selector);\n      const isDOMEvent = eventSystem?.supportedEvents.includes(eventName);\n\n      if (isDOMEvent && eventSystem) {\n        const wrappedHandler = (event) => {\n          const target = targetSelector ?\n            event.target.closest(targetSelector) :\n            context.element;\n\n          if (target && context.element.contains(target)) {\n            event.delegateTarget = target;\n            const result = handler.call(context, event);\n            return result;\n          }\n        };\n\n        context.element.addEventListener(eventName, wrappedHandler, {\n          capture: false,\n          passive: false\n        });\n\n        context._events.set(eventName, {\n          originalHandler: handler,\n          wrappedHandler: wrappedHandler,\n          selector: targetSelector\n        });\n      } else if (!isDOMEvent && eventManager) {\n        const boundHandler = handler.bind(context);\n        context._events.set(selector, {\n          originalHandler: handler,\n          wrappedHandler: boundHandler,\n          system: 'eventmanager'\n        });\n        eventManager.on(selector, boundHandler);\n      }\n    });\n  },\n\n  cleanupEvents(context) {\n    try {\n      if (!context._events || !(context._events instanceof Map)) {\n        context._events = new Map();\n        return;\n      }\n\n      context._events.forEach((eventConfig, eventName) => {\n        if (eventConfig.wrappedHandler) {\n          context.element.removeEventListener(eventName, eventConfig.wrappedHandler);\n        }\n      });\n\n      context._events.clear();\n\n    } catch (error) {\n      this.handleError('Error cleaning up events', 'cleanupEvents', {error});\n    }\n  },\n\n  async mount(element, name, props = {}) {\n    if (!element || !name) {\n      this.handleError('Invalid mount parameters', 'mount', {element, name, props});\n      return;\n    }\n\n    const definition = this.components.get(name);\n    if (!definition) {\n      this.handleError(`Component ${name} not found`, 'mount', {element, name, props});\n      return;\n    }\n\n    try {\n      const instance = this.initializeComponent(element, definition, props);\n      this.instances.set(element, instance);\n\n      if (instance._definition.beforeCreate) {\n        await instance._definition.beforeCreate.call(instance);\n      }\n\n      instance.element = this.processTemplate(element, definition, instance);\n\n      if (instance._definition.created) {\n        await instance._definition.created.call(instance);\n      }\n\n      if (instance._definition.beforeMount) {\n        await instance._definition.beforeMount.call(instance);\n      }\n\n      await this.renderInstance(instance);\n\n      instance._mounted = true;\n\n      if (instance._definition.mounted) {\n        await instance._definition.mounted.call(instance);\n      }\n\n      if (instance._definition.events) {\n        this.setupEvents(instance, instance._definition.events);\n      }\n\n      if (instance.reactive) {\n        instance.state = ReactiveManager.createComponentState(instance);\n        ReactiveManager.bindComponentEvents(instance);\n      }\n\n      return instance;\n\n    } catch (error) {\n      throw this.handleError(error, 'mount');\n    }\n  },\n\n  processTemplate(element, definition, context) {\n    try {\n      if (this.isValidComponentElement(element, definition)) {\n        return this.setupExistingElement(element, definition, context.state);\n      }\n\n      const template = this.getTemplate(element, definition);\n      if (!template) {\n        return element;\n      }\n\n      const container = document.createElement('div');\n      container.innerHTML = template.trim();\n\n      // Check if template contains api components - if so, skip processTemplateString\n      // because ApiComponent will handle its own rendering after data loads\n      const hasApiComponent = container.querySelector('[data-component=\"api\"]');\n      if (!hasApiComponent) {\n        TemplateManager.processTemplateString(template, context, container);\n      }\n\n      let newElement = container.firstElementChild;\n      if (!newElement) {\n        throw new Error('Template must contain a root element');\n      }\n\n      Array.from(element.attributes).forEach(attr => {\n        if (!newElement.hasAttribute(attr.name)) {\n          newElement.setAttribute(attr.name, attr.value);\n        }\n      });\n\n      const childComponents = newElement.querySelectorAll('[data-component]');\n      childComponents.forEach(async (child) => {\n        const componentName = child.getAttribute('data-component');\n        if (this.has(componentName)) {\n          await this.mount(child, componentName);\n        }\n      });\n\n      // lifecycle-first cleanup: destroy any element/form instances inside the old element\n      try {\n        const elementManager = Now.getManager('element');\n        const formManager = Now.getManager('form');\n\n        if (elementManager && typeof elementManager.destroyByElement === 'function') {\n          elementManager.destroyByElement(element);\n        }\n\n        if (formManager && typeof formManager.destroyFormByElement === 'function') {\n          formManager.destroyFormByElement(element);\n        }\n      } catch (err) {\n        this.handleError('Error during pre-replace cleanup', 'processTemplate', {error: err});\n      }\n\n      if (element.parentNode) {\n        element.parentNode.replaceChild(newElement, element);\n      }\n\n      context.element = newElement;\n\n      // After insertion, scan the new subtree to initialize elements/forms that require enhancement\n      try {\n        const elementManager = Now.getManager('element');\n        const formManager = Now.getManager('form');\n\n        if (elementManager && typeof elementManager.scan === 'function') {\n          elementManager.scan(newElement);\n        }\n\n        if (formManager && typeof formManager.scan === 'function') {\n          formManager.scan(newElement);\n        }\n      } catch (err) {\n        this.handleError('Error during post-replace scan', 'processTemplate', {error: err});\n      }\n\n      return newElement;\n\n    } catch (error) {\n      this.handleError(error, 'processTemplate', {element, definition, context});\n      return element;\n    }\n  },\n\n  isValidComponentElement(element, definition) {\n    return definition.validElement ?\n      definition.validElement(element) : false;\n  },\n\n  setupExistingElement(element, definition, state) {\n    this.setupElementAttributes(element, definition);\n\n    if (definition.setupElement) {\n      definition.setupElement(element, state);\n    }\n\n    return element;\n  },\n\n  getTemplate(element, definition) {\n    if (definition.template) {\n      return definition.template;\n    }\n\n    const inlineTemplate = element.getAttribute('data-template');\n    if (inlineTemplate) {\n      return inlineTemplate;\n    }\n\n    const templateId = element.getAttribute('data-template-id');\n    if (templateId) {\n      const templateEl = document.getElementById(templateId);\n      return templateEl?.innerHTML || null;\n    }\n\n    return null;\n  },\n\n  createDefaultElement(element, definition, state) {\n    return definition.createDefaultElement ?\n      definition.createDefaultElement(element, state) : element;\n  },\n\n  processTemplateString(template, state) {\n    if (this.config.templateCache) {\n      let processor = this.templateCache.get(template);\n      if (!processor) {\n        processor = TemplateManager.processTemplateString(template, state);\n        this.templateCache.set(template, processor);\n      }\n      return processor;\n    }\n\n    return TemplateManager.processTemplateString(template, state);\n  },\n\n  setupElementAttributes(element, definition) {\n    element.classList.add(`component-${definition.name}`);\n\n    if (definition.aria) {\n      Object.entries(definition.aria).forEach(([key, value]) => {\n        element.setAttribute(`aria-${key}`, value);\n      });\n    }\n  },\n\n  handleError(message, type, data = {}) {\n    return ErrorManager.handle(message, {\n      context: `ComponentManager.${type}`,\n      type: 'error:component',\n      data\n    });\n  },\n\n  createVNode(instance) {\n    try {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(instance._definition.template, 'text/html');\n      const templateElement = doc.body.firstChild;\n\n      return this.elementToVNode(templateElement, instance.state);\n    } catch (error) {\n      this.handleError('Failed to create virtual node', 'createVNode', {error});\n      return null;\n    }\n  },\n\n  elementToVNode(element, state) {\n    if (!element) return null;\n\n    const vnode = {\n      tag: element.tagName.toLowerCase(),\n      props: this.getElementProps(element),\n      children: [],\n      text: null\n    };\n\n    if (element.childNodes.length === 0 ||\n      (element.childNodes.length === 1 && element.childNodes[0].nodeType === 3)) {\n      vnode.text = this.processTextContent(element.textContent, state);\n      return vnode;\n    }\n\n    Array.from(element.childNodes).forEach(child => {\n      if (child.nodeType === 3) {\n        const text = this.processTextContent(child.textContent, state);\n        if (text.trim()) {\n          vnode.children.push({\n            tag: null,\n            props: null,\n            children: [],\n            text\n          });\n        }\n      } else if (child.nodeType === 1) {\n        vnode.children.push(this.elementToVNode(child, state));\n      }\n    });\n\n    return vnode;\n  },\n\n  getElementProps(element) {\n    const props = {};\n\n    Array.from(element.attributes).forEach(attr => {\n      let name = attr.name;\n      let value = attr.value;\n\n      if (name === 'class') {\n        name = 'className';\n        props[name] = value;\n        return;\n      }\n\n      if (name === 'for') {\n        name = 'htmlFor';\n        props[name] = value;\n        return;\n      }\n\n      if (!value) {\n        props[name] = name;\n        return;\n      }\n\n      props[name] = value;\n    });\n\n    return props;\n  },\n\n  processTextContent(text, state) {\n    return text.replace(/\\{\\{([^}]+)\\}\\}/g, (match, key) => {\n      key = key.trim();\n      const value = key.split('.').reduce((obj, k) => obj?.[k], state);\n      return value !== undefined ? value : match;\n    });\n  },\n\n  patch(element, oldVNode, newVNode) {\n    if (!oldVNode) {\n      element.innerHTML = '';\n      element.appendChild(this.createRealNode(newVNode));\n      return;\n    }\n\n    if (!newVNode) {\n      element.parentNode.removeChild(element);\n      return;\n    }\n\n    if (this.shouldReplace(oldVNode, newVNode)) {\n      const newElement = this.createRealNode(newVNode);\n      element.parentNode.replaceChild(newElement, element);\n      return;\n    }\n\n    this.updateProps(element, oldVNode.props, newVNode.props);\n\n    const oldChildren = oldVNode.children || [];\n    const newChildren = newVNode.children || [];\n    const max = Math.max(oldChildren.length, newChildren.length);\n\n    for (let i = 0; i < max; i++) {\n      this.patch(\n        element.childNodes[i],\n        oldChildren[i],\n        newChildren[i]\n      );\n    }\n  },\n\n  shouldReplace(oldVNode, newVNode) {\n    return oldVNode.tag !== newVNode.tag ||\n      oldVNode.text !== newVNode.text;\n  },\n\n  updateProps(element, oldProps = {}, newProps = {}) {\n    Object.keys(oldProps).forEach(key => {\n      if (!(key in newProps)) {\n        element.removeAttribute(key);\n      }\n    });\n\n    Object.entries(newProps).forEach(([key, value]) => {\n      if (oldProps[key] === value) return;\n\n      if (key === 'className') {\n        element.className = value;\n        return;\n      }\n\n      if (key.startsWith('on')) {\n        element[key] = value;\n        return;\n      }\n\n      if (value === false || value === null || value === undefined) {\n        element.removeAttribute(key);\n      } else {\n        element.setAttribute(key, value);\n      }\n    });\n  },\n\n  createRealNode(vnode) {\n    if (!vnode) return null;\n\n    if (vnode.text !== null) {\n      return document.createTextNode(vnode.text);\n    }\n\n    const element = document.createElement(vnode.tag);\n\n    if (vnode.props) {\n      Object.entries(vnode.props).forEach(([key, value]) => {\n        if (key === 'className') {\n          element.className = value;\n          return;\n        }\n\n        if (key.startsWith('on')) {\n          element[key] = value;\n          return;\n        }\n\n        if (value === false || value === null || value === undefined) {\n          element.removeAttribute(key);\n        } else {\n          element.setAttribute(key, value);\n        }\n      });\n    }\n\n    if (vnode.children) {\n      vnode.children.forEach(child => {\n        const childNode = this.createRealNode(child);\n        if (childNode) {\n          element.appendChild(childNode);\n        }\n      });\n    }\n\n    return element;\n  },\n\n  getContextForPath(path) {\n    for (const instance of this.instances.values()) {\n      if (instance.path === path || instance.templatePath === path) {\n        return instance;\n      }\n    }\n    return null;\n  },\n\n  async renderInstance(instance) {\n    if (instance._updating || instance._destroyed) return;\n\n    try {\n      instance._updating = true;\n\n      if (instance._definition.beforeUpdate) {\n        await instance._definition.beforeUpdate.call(instance);\n      }\n\n      TemplateManager.processTemplate(instance.element, instance);\n\n      if (instance._definition.updated) {\n        await instance._definition.updated.call(instance);\n      }\n\n    } catch (error) {\n      this.handleError('Component render error', 'renderInstance', {error});\n    } finally {\n      instance._updating = false;\n    }\n  },\n\n  async destroy(element) {\n    const instance = this.instances.get(element);\n    if (!instance || instance._destroyed) return;\n\n    try {\n      instance._destroying = true;\n\n      if (instance._definition.beforeDestroy) {\n        await instance._definition.beforeDestroy.call(instance);\n      }\n\n      if (!instance._events) {\n        instance._events = new Map();\n      }\n\n      this.cleanupEvents(instance);\n\n      this.instances.delete(element);\n\n      instance._destroyed = true;\n      instance._destroying = false;\n\n      if (instance._definition.destroyed && !instance._destroyedCalled) {\n        instance._destroyedCalled = true;\n        await instance._definition.destroyed.call(instance);\n      }\n\n      const templateManager = Now.getManager('template');\n      if (templateManager) {\n        templateManager.onComponentDestroy(instance);\n      }\n\n    } catch (error) {\n      this.handleError('Component destroy error', 'destroy', {error});\n\n      instance._destroyed = true;\n      instance._destroying = false;\n      this.instances.delete(element);\n\n    } finally {\n      instance._events?.clear();\n      instance._updateQueue?.clear();\n      instance.element = null;\n    }\n  },\n\n  /**\n   * Cleanup components in a container element\n   */\n  async cleanup(container) {\n    if (!container) return;\n\n    try {\n      const componentElements = container.querySelectorAll('[data-component]');\n\n      for (const element of componentElements) {\n        const instance = this.instances.get(element);\n        if (instance && instance.state.initialized) {\n          await this.destroy(element);\n        }\n      }\n\n      for (const [element, instance] of this.instances.entries()) {\n        if (container.contains(element) && instance.state.initialized) {\n          await this.destroy(element);\n        }\n      }\n\n    } catch (error) {\n      this.handleError('Container cleanup error', 'cleanup', {error, container});\n    }\n  },\n\n  has(name) {\n    return this.components.has(name);\n  },\n\n  get(name) {\n    return this.components.get(name) || null;\n  },\n\n  isComponentInitialized(element) {\n    const instance = this.instances.get(element);\n    return instance &&\n      instance.state.initialized &&\n      !instance._destroyed;\n  }\n  ,\n  getInitializedComponents(container = document) {\n    const elements = container.querySelectorAll('[data-component]');\n    const initialized = [];\n\n    elements.forEach(element => {\n      if (this.isComponentInitialized(element)) {\n        const instance = this.instances.get(element);\n        initialized.push({\n          element,\n          name: instance._definition.name,\n          id: instance.id\n        });\n      }\n    });\n\n    return initialized;\n  },\n\n  getComponentStatus(element) {\n    const instance = this.instances.get(element);\n    if (!instance) {\n      return 'not-found';\n    }\n\n    if (instance._destroyed) {\n      return 'destroyed';\n    }\n\n    if (!instance.state.initialized) {\n      return 'not-initialized';\n    }\n\n    if (instance._mounted) {\n      return 'mounted';\n    }\n\n    return 'initializing';\n  },\n\n  forceUpdate(instance) {\n    if (!instance || instance._destroyed) return;\n    instance._vnode = null;\n    return this.renderInstance(instance);\n  },\n\n  clearCache() {\n    this.templateCache.clear();\n  },\n\n  setupPerformanceMonitoring(instance) {\n    const performance = {\n      renders: 0,\n      totalRenderTime: 0,\n      lastRenderTime: 0,\n      averageRenderTime: 0,\n      slowRenderThreshold: 16,\n\n      recordRender(startTime) {\n        const renderTime = performance.now() - startTime;\n        this.renders++;\n        this.totalRenderTime += renderTime;\n        this.lastRenderTime = renderTime;\n        this.averageRenderTime = this.totalRenderTime / this.renders;\n\n        if (renderTime > this.slowRenderThreshold) {\n          console.warn(`Slow render detected for component ${instance.id}:`, {\n            renderTime,\n            averageRenderTime: this.averageRenderTime\n          });\n        }\n      }\n    };\n\n    instance._performance = performance;\n  },\n\n  async handleComponentError(error, instance, phase = 'unknown') {\n    try {\n      if (instance._errorBoundary) {\n        await instance._errorBoundary.handler.call(instance, error);\n        if (instance._errorBoundary.fallback) {\n          instance.element.innerHTML = await this.loadTemplate(\n            instance._errorBoundary.fallback\n          );\n        }\n        return;\n      }\n\n      let parent = instance._parentComponent;\n      while (parent) {\n        if (parent._errorBoundary) {\n          await parent._errorBoundary.handler.call(parent, error);\n          return;\n        }\n        parent = parent._parentComponent;\n      }\n\n      EventManager.emit('component:error', {\n        error,\n        instance,\n        phase\n      });\n\n    } catch (error) {\n      this.handleError('Component error handling error', 'handleComponentError', {error});\n    }\n  },\n\n  scheduleUpdate(instance) {\n    if (instance._updating || instance._destroyed) return;\n\n    instance._updateQueue.add(Date.now());\n\n    if (instance._updateQueue.size > 10) {\n      const updates = Array.from(instance._updateQueue);\n      const timeSpan = updates[updates.length - 1] - updates[0];\n      if (timeSpan < 1000) {\n        console.warn('Rapid updates detected:', {\n          component: instance.id,\n          updates: instance._updateQueue.size,\n          timeSpan\n        });\n      }\n    }\n\n    if (this.config.performance.batchUpdates) {\n      if (!instance._updateScheduled) {\n        instance._updateScheduled = true;\n        requestAnimationFrame(() => {\n          this.processUpdate(instance);\n          instance._updateScheduled = false;\n        });\n      }\n    } else {\n      this.processUpdate(instance);\n    }\n  },\n\n  async processUpdate(instance) {\n    if (instance._updating || instance._destroyed) return;\n\n    try {\n      instance._updating = true;\n      const startTime = performance.now();\n\n      if (instance._definition.beforeUpdate) {\n        await instance._definition.beforeUpdate.call(instance);\n      }\n\n      await this.renderInstance(instance);\n\n      if (instance._performance) {\n        instance._performance.recordRender(startTime);\n      }\n\n      if (instance._definition.updated) {\n        await instance._definition.updated.call(instance);\n      }\n\n    } catch (error) {\n      await this.handleComponentError(error, instance, 'update');\n    } finally {\n      instance._updating = false;\n      instance._updateQueue.clear();\n    }\n  },\n\n  async cleanupComponent(instance) {\n    if (!instance || instance._destroyed) return;\n\n    try {\n      for (const child of instance._childComponents) {\n        await this.cleanupComponent(child);\n      }\n\n      if (instance._parentComponent) {\n        instance._parentComponent._childComponents.delete(instance);\n      }\n\n      instance._events.forEach((handler, event) => {\n        instance.element.removeEventListener(event, handler);\n      });\n      instance._events.clear();\n\n      if (window.ReactiveManager) {\n        ReactiveManager.cleanup(instance.state);\n      }\n\n      instance._vnode = null;\n      instance._errorBoundary = null;\n      instance._childComponents.clear();\n      instance._parentComponent = null;\n      instance._updateQueue.clear();\n      instance.refs = null;\n\n      instance._destroyed = true;\n\n    } catch (error) {\n      this.handleError('Component cleanup error', 'cleanupComponent', error);\n    }\n  },\n\n  waitForElement(selector) {\n    return new Promise(resolve => {\n      if (document.querySelector(selector)) {\n        return resolve(document.querySelector(selector));\n      }\n\n      const observer = new MutationObserver(mutations => {\n        if (document.querySelector(selector)) {\n          observer.disconnect();\n          resolve(document.querySelector(selector));\n        }\n      });\n\n      observer.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n    });\n  },\n\n  deepCompare(obj1, obj2) {\n    if (obj1 === obj2) return true;\n\n    if (typeof obj1 !== \"object\" || typeof obj2 !== \"object\" || obj1 === null || obj2 === null) {\n      return obj1 === obj2;\n    }\n\n    const keys1 = Reflect.ownKeys(obj1);\n    const keys2 = Reflect.ownKeys(obj2);\n\n    if (keys1.length !== keys2.length) return false;\n\n    for (const key of keys1) {\n      if (!keys2.includes(key)) return false;\n\n      const desc1 = Object.getOwnPropertyDescriptor(obj1, key);\n      const desc2 = Object.getOwnPropertyDescriptor(obj2, key);\n\n      if (desc1.get || desc1.set || desc2.get || desc2.set) {\n        if (desc1.get !== desc2.get || desc1.set !== desc2.set) return false;\n      } else if (!ComponentManager.deepCompare(obj1[key], obj2[key])) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n\n  compareObjects(obj1, obj2) {\n    const obj1Keys = Reflect.ownKeys(obj1);\n    const obj2Keys = Reflect.ownKeys(obj2);\n\n    const sameKeys = obj1Keys.filter(key => obj2Keys.includes(key));\n    const diffKeys = [\n      ...obj1Keys.filter(key => !obj2Keys.includes(key)),\n      ...obj2Keys.filter(key => !obj1Keys.includes(key))\n    ];\n\n    const isEqual = ComponentManager.deepCompare(obj1, obj2);\n  },\n\n  _compareObjects(instance) {\n    const thisKeys = Reflect.ownKeys(this);\n    const instanceKeys = Reflect.ownKeys(instance);\n\n    const sameKeys = thisKeys.filter(key => instanceKeys.includes(key));\n    const diffKeys = [\n      ...thisKeys.filter(key => !instanceKeys.includes(key)),\n      ...instanceKeys.filter(key => !thisKeys.includes(key))\n    ];\n\n    return {\n      isEqual: ComponentManager.deepCompare(this, instance),\n      sameKeys,\n      diffKeys\n    };\n  },\n\n  getDebugInfo() {\n    const instances = Array.from(this.instances.entries()).map(([element, instance]) => ({\n      element: element.tagName + (element.id ? `#${element.id}` : ''),\n      component: instance._definition?.name,\n      id: instance.id,\n      initialized: instance.state.initialized,\n      mounted: instance._mounted,\n      destroyed: instance._destroyed,\n      status: this.getComponentStatus(element)\n    }));\n\n    const stateCounts = instances.reduce((acc, inst) => {\n      acc[inst.status] = (acc[inst.status] || 0) + 1;\n      return acc;\n    }, {});\n\n    return {\n      totalInstances: this.instances.size,\n      stateCounts,\n      instances,\n      components: Array.from(this.components.keys())\n    };\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('component', ComponentManager);\n}\n\nwindow.ComponentManager = ComponentManager;\n","const ReactiveManager = {\n  config: {\n    debug: false,\n    batchUpdates: true,\n    cleanupInterval: 60000,\n    computed: {\n      cache: true\n    }\n  },\n\n  state: {\n    currentEffect: null,\n    effects: new Set(),\n    dependencies: new Map(),\n    pendingUpdates: new Set(),\n    updateQueued: false,\n    rawToProxy: new WeakMap(),\n    proxyToRaw: new WeakMap(),\n    cleanedEffects: new WeakSet()\n  },\n\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    this.startCleanup();\n\n    return this;\n  },\n\n  track(target, prop) {\n    if (!this.state.currentEffect) return;\n\n    const id = target.__reactiveId;\n    if (!id) return;\n\n    if (!this.state.dependencies.has(id)) {\n      this.state.dependencies.set(id, new Map());\n    }\n\n    const depsMap = this.state.dependencies.get(id);\n    if (!depsMap.has(prop)) {\n      depsMap.set(prop, new Set());\n    }\n\n    const effects = depsMap.get(prop);\n    effects.add(this.state.currentEffect);\n  },\n\n  trigger(target, prop) {\n    const targetId = target.__reactiveId;\n    if (!targetId) return;\n\n    const depsMap = this.state.dependencies.get(targetId);\n    if (!depsMap) {\n      this.triggerEffects();\n      return;\n    }\n\n    const effects = depsMap.get(prop);\n    if (!effects) {\n      this.triggerEffects();\n      return;\n    }\n\n    this.runEffects(effects);\n  },\n\n  triggerEffects() {\n    this.state.effects.forEach(effect => {\n      if (effect.active) {\n        if (this.config.batchUpdates) {\n          this.state.pendingUpdates.add(effect);\n          this.scheduleUpdate();\n        } else {\n          this.runEffect(effect);\n        }\n      }\n    });\n  },\n\n  runEffects(effects) {\n    effects.forEach(effect => {\n      if (effect.active) {\n        if (this.config.batchUpdates) {\n          this.state.pendingUpdates.add(effect);\n          this.scheduleUpdate();\n        } else {\n          this.runEffect(effect);\n        }\n      }\n    });\n  },\n\n  runEffect(effect) {\n    try {\n      effect();\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ReactiveManager.runEffect',\n        data: {effect}\n      });\n    }\n  },\n\n  scheduleUpdate() {\n    if (!this.state.updateQueued) {\n      this.state.updateQueued = true;\n      queueMicrotask(() => {\n        this.flushUpdates();\n      });\n    }\n  },\n\n  flushUpdates() {\n    if (!this.state.updateQueued) return;\n\n    const effects = Array.from(this.state.pendingUpdates);\n    this.state.pendingUpdates.clear();\n    this.state.updateQueued = false;\n\n    effects.forEach(effect => {\n      if (effect.active) {\n        effect();\n      }\n    });\n  },\n\n  reactive(target) {\n    if (!target || typeof target !== 'object') {\n      return target;\n    }\n\n    if (!target.__reactiveId) {\n      target.__reactiveId = this.generateId();\n    }\n\n    Object.defineProperty(target, '__isReactive', {\n      value: true,\n      enumerable: false,\n      configurable: false\n    });\n\n    if (Array.isArray(target)) {\n      return this.createArrayProxy(target);\n    }\n\n    return new Proxy(target, {\n      get: (obj, prop) => {\n        if (prop === '__reactiveId' || prop === '__isReactive') {\n          return obj[prop];\n        }\n\n        if (this.state.currentEffect) {\n          this.track(obj, prop);\n        }\n\n        return obj[prop];\n      },\n\n      set: (obj, prop, value) => {\n        const oldValue = obj[prop];\n        obj[prop] = value;\n\n        if (oldValue !== value) {\n          this.trigger(obj, prop);\n        }\n\n        return true;\n      }\n    });\n  },\n\n  effect(fn) {\n    const effect = () => {\n      if (!effect.active) return;\n\n      const prevEffect = this.state.currentEffect;\n      this.state.currentEffect = effect;\n\n      try {\n        fn();\n      } finally {\n        this.state.currentEffect = prevEffect;\n      }\n    };\n\n    effect.active = true;\n    effect.isEffect = true;\n\n    effect();\n\n    this.state.effects.add(effect);\n\n    return () => {\n      effect.active = false;\n      this.cleanupEffect(effect);\n      this.state.effects.delete(effect);\n    };\n  },\n\n  isReactive(value) {\n    return Boolean(value && value.__isReactive);\n  },\n\n  computed(getter) {\n    let value;\n    let dirty = true;\n\n    const effect = () => {\n      try {\n        if (dirty) {\n          value = getter();\n          dirty = false;\n        }\n        return value;\n      } catch (error) {\n        throw error;\n      }\n    };\n\n    return {\n      get value() {\n        const prevEffect = ReactiveManager.state.currentEffect;\n        ReactiveManager.state.currentEffect = () => {dirty = true;};\n        const result = effect();\n        ReactiveManager.state.currentEffect = prevEffect;\n        return result;\n      }\n    };\n  },\n\n  watch(arg1, arg2, arg3) {\n    if (typeof arg1 === 'function') {\n      return this.watchEffect(arg1, arg2);\n    }\n\n    return this.watchProp(arg1, arg2, arg3);\n  },\n\n  watchEffect(fn, callback) {\n    let isActive = true;\n    const effect = () => {\n      if (!isActive) return;\n\n      try {\n        const value = fn();\n        if (isActive && typeof callback === 'function') {\n          callback(value);\n        }\n        return value;\n      } catch (error) {\n        throw error;\n      }\n    };\n\n    effect.isEffect = true;\n    effect.active = true;\n\n    const prevEffect = this.state.currentEffect;\n    this.state.currentEffect = effect;\n\n    try {\n      effect();\n    } finally {\n      this.state.currentEffect = prevEffect;\n    }\n\n    this.state.effects.add(effect);\n\n    return () => {\n      isActive = false;\n      effect.active = false;\n      this.state.effects.delete(effect);\n      this.cleanupEffect(effect);\n    };\n  },\n\n  watchProp(target, prop, callback, options = {}) {\n    if (!target.__reactiveId) {\n      target.__reactiveId = this.generateId();\n    }\n\n    const effect = () => {\n      if (!effect.active) return;\n\n      const currentValue = target[prop];\n\n      callback(currentValue);\n    };\n\n    effect.active = true;\n    effect.isEffect = true;\n\n    if (!this.state.dependencies.has(target.__reactiveId)) {\n      this.state.dependencies.set(target.__reactiveId, new Map());\n    }\n\n    const depsMap = this.state.dependencies.get(target.__reactiveId);\n    if (!depsMap.has(prop)) {\n      depsMap.set(prop, new Set());\n    }\n\n    depsMap.get(prop).add(effect);\n\n    effect();\n\n    return () => {\n      effect.active = false;\n      const depsMap = this.state.dependencies.get(target.__reactiveId);\n      if (depsMap && depsMap.has(prop)) {\n        depsMap.get(prop).delete(effect);\n      }\n    };\n  },\n\n  isProxy(obj) {\n    return Boolean(obj && obj.__isReactive);\n  },\n\n  findComponentForTarget(target) {\n    for (const [componentId, state] of this.state.componentStates) {\n      if (this.isStateTarget(target, state)) {\n        return ComponentManager.instances.get(componentId);\n      }\n    }\n    return null;\n  },\n\n  isStateTarget(target, state) {\n    if (target === state) return true;\n\n    for (const value of Object.values(state)) {\n      if (value && typeof value === 'object') {\n        if (value === target || this.isStateTarget(target, value)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  },\n\n  queueEffect(effect) {\n    if (!effect.active) return;\n\n    if (this.config.batchUpdates) {\n      this.state.pendingUpdates.add(effect);\n      this.scheduleUpdate();\n    } else {\n      try {\n        effect();\n      } catch (error) {\n        throw error;\n      }\n    }\n  },\n\n  createComponentState(component) {\n    try {\n      if (!component.reactive) {\n        return component.state;\n      }\n\n      const reactiveState = this.reactive(component.state);\n      this.state.componentStates.set(component.id, reactiveState);\n      return reactiveState;\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ReactiveManager.createComponentState',\n        data: {component}\n      });\n      return component.state;\n    }\n  },\n\n  getStateValue(state, path) {\n    return path.split('.').reduce((obj, key) => obj?.[key], state);\n  },\n\n  watchDeep(target, callback, options = {}) {\n    return this.watch(\n      () => JSON.parse(JSON.stringify(target)),\n      callback,\n      {...options, deep: true}\n    );\n  },\n\n  setStateValue(state, path, value) {\n    const clonedValue = this.deepClone(value);\n    const parts = path.split('.');\n    const lastKey = parts.pop();\n    const target = parts.reduce((obj, key) => obj[key], state);\n    if (target) {\n      target[lastKey] = clonedValue;\n    }\n  },\n\n  bindComponentEvents(component) {\n    if (!component.events) return;\n\n    try {\n      const eventManager = Now.getManager('event');\n      if (!eventManager) {\n        ErrorManager.handle('Event system not available', {\n          context: 'ReactiveManager.bindComponentEvents'\n        });\n        return;\n      }\n\n      Object.entries(component.events).forEach(([eventName, handler]) => {\n        const boundHandler = handler.bind(component);\n        if (!component._eventHandlers) {\n          component._eventHandlers = new Map();\n        }\n        component._eventHandlers.set(eventName, boundHandler);\n        eventManager.on(eventName, boundHandler);\n      });\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ReactiveManager.bindComponentEvents',\n        data: {component}\n      });\n    }\n  },\n\n  unbindComponentEvents(component) {\n    if (!component._eventHandlers) return;\n\n    const eventManager = Now.getManager('event');\n    if (!eventManager) return;\n\n    component._eventHandlers.forEach((handler, eventName) => {\n      eventManager.off(eventName, handler);\n    });\n\n    component._eventHandlers.clear();\n    delete component._eventHandlers;\n  },\n\n  createStateProxy() {\n    return new Proxy(this.state, {\n      set: (target, property, value) => {\n        if (Array.isArray(target) && /^\\d+$/.test(property)) {\n          this.notifyArrayChange(target);\n        }\n\n        target[property] = value;\n        this.notifyChange(property);\n        return true;\n      }\n    });\n  },\n\n  notifyArrayChange(array) {\n    const watchers = this.state.watchers.get(array);\n    if (!watchers) return;\n\n    this.notifyWatchers(array, 'length', array.length);\n\n    watchers.forEach((watcherSet, key) => {\n      if (key !== 'length') {\n        this.notifyWatchers(array, key, array[key]);\n      }\n    });\n  },\n\n  notifyChange(property) {\n    const watchers = this.getWatchers(property);\n    watchers.forEach(watcher => {\n      try {\n        this.state.pendingUpdates.add(() => watcher(this.state[property]));\n        this.scheduleUpdate();\n\n        EventManager.emit('reactive:change', {\n          property,\n          value: this.state[property]\n        });\n      } catch (error) {\n        throw error;\n      }\n    });\n  },\n\n  runWithTracking(fn) {\n    const prevEffect = this.state.currentEffect;\n    this.state.currentEffect = fn;\n\n    try {\n      return fn();\n    } finally {\n      this.state.currentEffect = prevEffect;\n    }\n  },\n\n  startCleanup() {\n    this.state.cleanupTimer = setInterval(() => {\n      this.cleanup();\n    }, this.config.cleanupInterval);\n\n    window.addEventListener('beforeunload', () => {\n      this.cleanup();\n      clearInterval(this.state.cleanupTimer);\n    });\n\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'hidden') {\n        this.cleanup();\n        clearInterval(this.state.cleanupTimer);\n      }\n    });\n  },\n\n  cleanup() {\n    for (const [target, deps] of this.state.dependencies) {\n      for (const [key, watchers] of deps) {\n        const activeWatchers = new Set(\n          Array.from(watchers).filter(watcher => this.isWatcherValid(watcher))\n        );\n\n        if (activeWatchers.size === 0) {\n          deps.delete(key);\n        } else {\n          deps.set(key, activeWatchers);\n        }\n      }\n\n      if (deps.size === 0) {\n        this.state.dependencies.delete(target);\n      }\n    }\n\n    for (const [effect, cached] of this.state.computedCache) {\n      if (!this.isWatcherValid(effect)) {\n        this.state.computedCache.delete(effect);\n      }\n    }\n  },\n\n  isWatcherValid(watcher) {\n    for (const deps of this.state.dependencies.values()) {\n      for (const watchers of deps.values()) {\n        if (watchers.has(watcher)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  },\n\n  cleanupEffect(effect) {\n    if (!effect) return;\n\n    this.state.cleanedEffects.add(effect);\n\n    for (const [targetId, depsMap] of this.state.dependencies) {\n      if (!depsMap) continue;\n\n      for (const [prop, effects] of depsMap) {\n        if (effects.has(effect)) {\n          effects.delete(effect);\n\n          if (effects.size === 0) {\n            depsMap.delete(prop);\n          }\n        }\n      }\n\n      if (depsMap.size === 0) {\n        this.state.dependencies.delete(targetId);\n      }\n    }\n\n    this.state.pendingUpdates.delete(effect);\n  },\n\n  deepClone(value) {\n    if (typeof value !== 'object' || value === null) return value;\n    return JSON.parse(JSON.stringify(value));\n  },\n\n  validateState(state) {\n    if (!state || typeof state !== 'object') {\n      throw new Error('Invalid state object');\n    }\n  },\n\n  createComputation(fn, context) {\n    const computation = {\n      fn,\n      context,\n      dependencies: new Set(),\n      isComputing: false\n    };\n    this.state.effects.add(computation);\n    return computation;\n  },\n\n  runComputation(computation) {\n    if (!computation || computation.isComputing) return;\n\n    if (computation.context?._skipReactive) return;\n\n    computation.isComputing = true;\n    const previousEffect = this.state.currentEffect;\n    this.state.currentEffect = computation;\n\n    try {\n      this.cleanup(computation);\n      computation.fn.call(computation.context);\n    } finally {\n      computation.isComputing = false;\n      this.state.currentEffect = previousEffect;\n    }\n  },\n\n  _bindComponentEvents(instance) {\n    if (!instance || !instance.reactive) return;\n\n    const computation = this.createComputation(() => {\n      if (!instance._skipReactive && typeof instance.render === 'function') {\n        instance.render();\n      }\n    }, instance);\n\n    this.runComputation(computation);\n\n    if (instance.watch) {\n      Object.entries(instance.watch).forEach(([prop, handler]) => {\n        const watchComputation = this.createComputation(() => {\n          if (!instance._skipReactive) {\n            handler.call(instance, instance.state[prop]);\n          }\n        }, instance);\n\n        this.track(prop);\n\n        this.runComputation(watchComputation);\n      });\n    }\n  },\n\n  _addDependency(dep) {\n    if (this.state.currentEffect) {\n      this.state.currentEffect.dependencies.add(dep);\n\n      const key = `${dep.target.id}:${dep.prop}`;\n      if (!this.state.dependencies.has(key)) {\n        this.state.dependencies.set(key, new Set());\n      }\n      this.state.dependencies.get(key).add(this.state.currentEffect);\n    }\n  },\n\n  createComponentState(instance) {\n    const state = {...instance.state};\n\n    return new Proxy(state, {\n      get: (target, prop) => {\n        this.addDependency({\n          target: instance,\n          prop: prop\n        });\n        return target[prop];\n      },\n\n      set: (target, prop, value) => {\n        const oldValue = target[prop];\n        target[prop] = value;\n\n        this.triggerUpdate({\n          target: instance,\n          prop: prop,\n          oldValue,\n          newValue: value\n        });\n\n        return true;\n      }\n    });\n  },\n\n  _triggerUpdate(change) {\n    const key = `${change.target.id}:${change.prop}`;\n    const deps = this.state.dependencies.get(key);\n\n    if (deps) {\n      deps.forEach(computation => {\n        this.runComputation(computation);\n      });\n    }\n  },\n\n  cleanupDependencies(computation) {\n    if (!computation) return;\n    this.cleanup(computation);\n  },\n\n  isIterable(value) {\n    return value != null && typeof value[Symbol.iterator] === 'function';\n  },\n\n  getDependenciesArray(deps) {\n    if (!deps) return [];\n    if (this.isIterable(deps)) return Array.from(deps);\n    if (Array.isArray(deps)) return deps;\n    return [];\n  },\n\n  isValidComputation(computation) {\n    return computation &&\n      typeof computation === 'object' &&\n      typeof computation.fn === 'function' &&\n      computation.dependencies instanceof Set;\n  },\n\n  createComputation(fn, context) {\n    if (typeof fn !== 'function') {\n      throw new Error('Computation must be a function');\n    }\n\n    const computation = {\n      fn,\n      context,\n      dependencies: new Set(),\n      isComputing: false\n    };\n\n    if (this.isValidComputation(computation)) {\n      this.state.effects.add(computation);\n      return computation;\n    }\n\n    throw new Error('Invalid computation created');\n  },\n\n  cleanup(computation) {\n    if (!this.isValidComputation(computation)) return;\n\n    const deps = this.getDependenciesArray(computation.dependencies);\n\n    deps.forEach(dep => {\n      if (!dep || !dep.target || !dep.prop) return;\n\n      const key = `${dep.target.id}:${dep.prop}`;\n      const dependencySet = this.state.dependencies.get(key);\n\n      if (dependencySet instanceof Set) {\n        dependencySet.delete(computation);\n        if (dependencySet.size === 0) {\n          this.state.dependencies.delete(key);\n        }\n      }\n    });\n\n    computation.dependencies.clear();\n  },\n\n  addDependency(dep) {\n    if (this.state.currentEffect?.context?._skipReactive) {\n      return;\n    }\n\n    if (!this.state.currentEffect ||\n      !this.isValidComputation(this.state.currentEffect)) return;\n\n    if (!dep || !dep.target || !dep.prop) return;\n\n    this.state.currentEffect.dependencies.add(dep);\n\n    const key = `${dep.target.id}:${dep.prop}`;\n    if (!this.state.dependencies.has(key)) {\n      this.state.dependencies.set(key, new Set());\n    }\n\n    const deps = this.state.dependencies.get(key);\n    if (deps instanceof Set) {\n      deps.add(this.state.currentEffect);\n    }\n  },\n\n  triggerUpdate(change) {\n    if (!change || !change.target || !change.prop) return;\n\n    if (change.target._skipReactive) return;\n\n    const key = `${change.target.id}:${change.prop}`;\n    const deps = this.state.dependencies.get(key);\n\n    if (deps instanceof Set) {\n      deps.forEach(computation => {\n        if (this.isValidComputation(computation)) {\n          this.runComputation(computation);\n        } else {\n          deps.delete(computation);\n        }\n      });\n    }\n  },\n\n  runComputation(computation) {\n    if (!this.isValidComputation(computation) || computation.isComputing) return;\n\n    computation.isComputing = true;\n    const previousEffect = this.state.currentEffect;\n    this.state.currentEffect = computation;\n\n    try {\n      this.cleanup(computation);\n      computation.fn.call(computation.context);\n    } catch (error) {\n      throw error;\n    } finally {\n      computation.isComputing = false;\n      this.state.currentEffect = previousEffect;\n    }\n  },\n\n  bindComponentEvents(instance) {\n    if (!instance || !instance.reactive) return;\n\n    try {\n      const computation = this.createComputation(() => {\n        if (typeof instance.render === 'function') {\n          instance.render();\n        }\n      }, instance);\n\n      this.runComputation(computation);\n\n      if (instance.watch && typeof instance.watch === 'object') {\n        Object.entries(instance.watch).forEach(([prop, handler]) => {\n          if (typeof handler === 'function') {\n            const watchComputation = this.createComputation(() => {\n              handler.call(instance, instance.state[prop]);\n            }, instance);\n\n            this.track(prop);\n            this.runComputation(watchComputation);\n          }\n        });\n      }\n    } catch (error) {\n      throw error;\n    }\n  },\n\n  _track(fn) {\n    if (typeof fn !== 'function') return null;\n\n    const previousEffect = this.state.currentEffect;\n    const computation = this.createComputation(fn, null);\n\n    try {\n      this.runComputation(computation);\n      return computation;\n    } catch (error) {\n      throw error;\n    } finally {\n      this.state.currentEffect = previousEffect;\n    }\n  },\n\n  _createComponentState(instance) {\n    if (!instance || !instance.state) return {};\n\n    const state = {...instance.state};\n\n    return new Proxy(state, {\n      get: (target, prop) => {\n        if (prop in target) {\n          if (!instance._skipReactive) {\n            this.addDependency({\n              target: instance,\n              prop: prop\n            });\n          }\n        }\n        return target[prop];\n      },\n\n      set: (target, prop, value) => {\n        const oldValue = target[prop];\n        target[prop] = value;\n\n        this.triggerUpdate({\n          target: instance,\n          prop: prop,\n          oldValue,\n          newValue: value\n        });\n\n        return true;\n      }\n    });\n  },\n\n  validateConfig(config) {\n    if (!config || typeof config !== 'object') {\n      throw new Error('Invalid configuration object');\n    }\n  },\n\n  deepClone(value, seen = new WeakMap()) {\n    if (!value || typeof value !== 'object') return value;\n    if (seen.has(value)) return seen.get(value);\n\n    const clone = Array.isArray(value) ? [] : {};\n    seen.set(value, clone);\n\n    Object.entries(value).forEach(([key, val]) => {\n      clone[key] = this.deepClone(val, seen);\n    });\n\n    return clone;\n  },\n\n  createArrayProxy(array) {\n    if (!array.__reactiveId) {\n      array.__reactiveId = this.generateId();\n    }\n\n    const self = this;\n    return new Proxy(array, {\n      get(target, prop) {\n        self.track(target, prop);\n        const value = target[prop];\n\n        if (typeof value === 'function') {\n          return function(...args) {\n            const oldLength = target.length;\n\n            const result = value.apply(target, args);\n\n            if (['push', 'pop', 'shift', 'unshift', 'splice'].includes(prop)) {\n              const newLength = target.length;\n\n              if (oldLength !== newLength) {\n                self.trigger(target, 'length');\n                for (let i = oldLength; i < newLength; i++) {\n                  self.trigger(target, i.toString());\n                }\n              }\n            }\n\n            return result;\n          };\n        }\n        return value;\n      },\n\n      set(target, prop, value) {\n        const oldValue = target[prop];\n        const oldLength = target.length;\n\n        target[prop] = value;\n\n        if (oldValue !== value) {\n          self.trigger(target, prop);\n        }\n\n        const newLength = target.length;\n        if (newLength !== oldLength) {\n          self.trigger(target, 'length');\n        }\n\n        return true;\n      }\n    });\n  },\n\n  enableDebug() {\n    DEBUG.enabled = true;\n  },\n\n  disableDebug() {\n    DEBUG.enabled = false;\n  },\n\n  getDebugInfo() {\n    return {\n      dependencies: Array.from(this.state.dependencies.entries()),\n      computedCache: Array.from(this.state.computedCache.entries()),\n      pendingUpdates: Array.from(this.state.pendingUpdates),\n      componentStates: Array.from(this.state.componentStates.entries())\n    };\n  },\n\n  handleLifecycle(component, event) {\n    if (!component || !event) return;\n\n    switch (event) {\n      case 'mount':\n        this.setupComponentReactivity(component);\n        break;\n\n      case 'unmount':\n        this.cleanupComponentReactivity(component);\n        break;\n\n      case 'update':\n        this.updateComponentReactivity(component);\n        break;\n    }\n  },\n\n  setupComponentReactivity(component) {\n    if (!component.reactive) return;\n\n    component.state = this.reactive(component.state || {});\n\n    if (component.watch) {\n      Object.entries(component.watch).forEach(([prop, handler]) => {\n        this.watch(() => component.state[prop], handler.bind(component));\n      });\n    }\n\n    if (component.computed) {\n      Object.entries(component.computed).forEach(([key, getter]) => {\n        Object.defineProperty(component, key, {\n          get: () => this.computed(getter.bind(component))(),\n          enumerable: true\n        });\n      });\n    }\n  },\n\n  cleanupComponentReactivity(component) {\n    if (!component.id) return;\n\n    this.state.componentStates.delete(component.id);\n\n    const componentDeps = Array.from(this.state.dependencies.values())\n      .filter(deps => this.isComponentDependency(deps, component));\n\n    componentDeps.forEach(deps => {\n      this.cleanupDependencies(deps);\n    });\n  },\n\n  updateComponentReactivity(component) {\n    this.cleanupComponentReactivity(component);\n\n    this.setupComponentReactivity(component);\n  },\n\n  isComponentDependency(deps, component) {\n    return Array.from(deps.values()).some(watchers =>\n      Array.from(watchers).some(watcher =>\n        watcher.component === component\n      )\n    );\n  },\n\n  notifyWatchers(target, key, value, oldValue) {\n    const watchers = this.state.watchers.get(target);\n    if (!watchers) return;\n\n    const keyWatchers = watchers.get(key);\n    if (!keyWatchers) return;\n\n    keyWatchers.forEach(watcher => {\n      try {\n        if (this.config.batchUpdates) {\n          this.state.pendingUpdates.add(() => watcher(value, oldValue));\n          this.scheduleUpdate();\n        } else {\n          watcher(value, oldValue);\n        }\n      } catch (error) {\n        ErrorManager.handle(error, {\n          context: 'ReactiveManager.notifyWatchers',\n          data: {target, key, value, oldValue}\n        });\n      }\n    });\n  },\n\n  batch(fn) {\n    this.state.batchDepth++;\n    try {\n      const result = fn();\n      if (result instanceof Promise) {\n        return result.finally(() => {\n          this.state.batchDepth--;\n          if (this.state.batchDepth === 0) {\n            this.flushUpdates();\n          }\n        });\n      } else {\n        this.state.batchDepth--;\n        if (this.state.batchDepth === 0) {\n          this.flushUpdates();\n        }\n        return result;\n      }\n    } catch (error) {\n      this.state.batchDepth--;\n      if (this.state.batchDepth === 0) {\n        this.flushUpdates();\n      }\n      throw error;\n    }\n  },\n\n  generateId() {\n    return 'reactive_' + Math.random().toString(36).substr(2, 9);\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('reactive', ReactiveManager);\n}\n\n// Expose globally\nwindow.ReactiveManager = ReactiveManager;\n","class ExpressionEvaluator {\n  static operators = {\n    '+': (a, b) => Number(a) + Number(b),\n    '-': (a, b) => Number(a) - Number(b),\n    '*': (a, b) => Number(a) * Number(b),\n    '/': (a, b) => Number(a) / Number(b),\n    '%': (a, b) => Number(a) % Number(b),\n    '===': (a, b) => a === b,\n    '!==': (a, b) => a !== b,\n    '!=': (a, b) => a != b,\n    '>': (a, b) => a > b,\n    '>=': (a, b) => a >= b,\n    '<': (a, b) => a < b,\n    '<=': (a, b) => a <= b,\n    '==': (a, b) => a == b,\n    '&&': (a, b) => a && b,\n    '||': (a, b) => a || b,\n    '!': a => !a,\n\n    '+str': (a, b) => String(a) + String(b)\n  };\n\n  static evaluate(expression, state, context) {\n    try {\n      if (!expression?.trim()) return undefined;\n\n      if (expression === '!true' || expression === '!false') {\n        const value = expression === '!true' ? true : false;\n        return !value;\n      }\n\n      // Handle string literals (single or double quoted)\n      const stringMatch = expression.match(/^(['\"])(.*)(\\1)$/);\n      if (stringMatch) {\n        return stringMatch[2]; // Return string without quotes\n      }\n\n      // Handle ternary expression: condition ? trueValue : falseValue\n      const ternaryMatch = expression.match(/^(.+?)\\s*\\?\\s*(.+?)\\s*:\\s*(.+)$/);\n      if (ternaryMatch) {\n        const [, condition, trueExpr, falseExpr] = ternaryMatch;\n        const conditionResult = this.evaluate(condition.trim(), state, context);\n        // Check for truthy value (handles \"0\", \"\", null, undefined, false as falsy)\n        const isTruthy = conditionResult && conditionResult !== '0' && conditionResult !== 0;\n        return isTruthy\n          ? this.evaluate(trueExpr.trim(), state, context)\n          : this.evaluate(falseExpr.trim(), state, context);\n      }\n\n      if (/^[\\w.]+$/.test(expression)) {\n        const value = this.getPropertyPath(expression, state, context);\n        return value;\n      }\n\n      const tokens = this.tokenize(expression);\n\n      let value;\n      const postfix = this.toPostfix(tokens);\n      if (postfix.length === 2) {\n        const property = this.getPropertyPath(postfix[1], state, context);\n        value = property === undefined ? undefined : state[postfix[0]].call(context, property);\n      } else {\n        value = this.evaluatePostfix(postfix, state, context);\n      }\n      return value;\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ExpressionEvaluator.evaluate',\n        data: {\n          expression,\n          state,\n          context\n        }\n      });\n      return undefined;\n    }\n  }\n\n  static getPropertyPath(path, state, context) {\n    if (typeof path !== 'string') {\n      return path;\n    }\n\n    return path.split('.').reduce((obj, key) => {\n      if (obj === undefined || obj === null) return undefined;\n\n      if (obj.computed && typeof obj.computed[key] === 'function') {\n        return obj.computed[key].call(obj);\n      }\n\n      let value = obj[key];\n      if (value !== undefined) {\n        if (typeof value === 'function') {\n          value = value.call(context);\n        }\n        return value;\n      }\n\n      if (state[key]) {\n        const value = typeof state[key] === 'function' ? state[key].call(context) : state[key];\n        return value;\n      }\n\n      if (obj.state && obj.state.hasOwnProperty(key)) {\n        return obj.state[key];\n      }\n\n      return undefined;\n    }, context || state);\n  }\n\n  static tokenize(expression) {\n    const tokens = [];\n    let current = '';\n\n    const pushToken = () => {\n      if (current) {\n        tokens.push(current);\n        current = '';\n      }\n    };\n\n    for (let i = 0; i < expression.length; i++) {\n      const char = expression[i];\n\n      if (char === '\"' || char === \"'\") {\n        const quote = char;\n        pushToken();\n        current = char;\n        i++;\n        while (i < expression.length && expression[i] !== quote) {\n          current += expression[i];\n          i++;\n        }\n        current += quote;\n        pushToken();\n        continue;\n      }\n\n      if (/[+\\-*/%=!&|<>]/.test(char)) {\n        pushToken();\n        let operator = char;\n\n        let next = expression[i + 1];\n        while (next && /[=&|><]/.test(next)) {\n          operator += next;\n          i++;\n          next = expression[i + 1];\n        }\n\n        tokens.push(operator);\n        continue;\n      }\n\n      if (char === '(' || char === ')') {\n        pushToken();\n        tokens.push(char);\n        continue;\n      }\n\n      if (/\\s/.test(char)) {\n        pushToken();\n        continue;\n      }\n\n      current += char;\n    }\n\n    pushToken();\n    return tokens;\n  }\n\n  static toPostfix(tokens) {\n    const output = [];\n    const operators = [];\n    const precedence = {\n      '!': 4,\n      '*': 3, '/': 3, '%': 3,\n      '+': 2, '-': 2,\n      '>=': 1, '<=': 1, '>': 1, '<': 1,\n      '===': 1, '!==': 1, '==': 1, '!=': 1,\n      '&&': 0, '||': 0\n    };\n\n    tokens.forEach(token => {\n      if (token in this.operators) {\n        while (operators.length > 0 &&\n          operators[operators.length - 1] !== '(' &&\n          precedence[operators[operators.length - 1]] >= precedence[token]) {\n          output.push(operators.pop());\n        }\n        operators.push(token);\n      } else if (token === '(') {\n        operators.push(token);\n      } else if (token === ')') {\n        while (operators.length > 0 && operators[operators.length - 1] !== '(') {\n          output.push(operators.pop());\n        }\n        operators.pop();\n      } else {\n        output.push(token);\n      }\n    });\n\n    while (operators.length > 0) {\n      output.push(operators.pop());\n    }\n\n    return output;\n  }\n\n  static evaluatePostfix(postfix, state, context) {\n    const stack = [];\n\n    postfix.forEach(token => {\n      if (token in this.operators) {\n        const operator = this.operators[token];\n        const arity = token === '!' ? 1 : 2;\n        const args = stack.splice(-arity);\n\n        const values = args.map(arg => {\n          if (/^[\"'].*[\"']$/.test(arg)) {\n            return arg.slice(1, -1);\n          }\n          if (/^-?\\d+(\\.\\d+)?$/.test(arg)) {\n            return Number(arg);\n          }\n          if (arg === 'true') return true;\n          if (arg === 'false') return false;\n          if (arg === 'null') return null;\n          if (arg === 'undefined') return undefined;\n          return this.getPropertyPath(arg, state, context);\n        });\n\n        if (arity === 1) {\n          if (values[0] === undefined) return undefined;\n        } else {\n          if (values[0] === undefined || values[1] === undefined) return undefined;\n        }\n\n        if (token === '+' && (typeof values[0] === 'string' || typeof values[1] === 'string')) {\n          stack.push(String(values[0]) + String(values[1]));\n        } else {\n          stack.push(operator(...values));\n        }\n      } else {\n        stack.push(token);\n      }\n    });\n\n    return stack[0];\n  }\n}\n\nwindow.ExpressionEvaluator = ExpressionEvaluator;\n","const WatchManager = {\n  setupWatchers(instance, state, watchers = {}) {\n    if (!instance || !state || !watchers) {\n      const error = new Error('Missing required parameters: component instance, state object, or watchers');\n      ErrorManager.handle(error, {\n        context: 'WatchManager.setupWatchers',\n        data: {instance, state, watchers}\n      });\n      return;\n    }\n\n    if (!instance._watchers) {\n      instance._watchers = new Map();\n    }\n\n    Object.entries(watchers).forEach(([path, config]) => {\n      try {\n        const watchConfig = typeof config === 'function' ? {\n          handler: config,\n          immediate: false,\n          deep: false\n        } : {\n          immediate: false,\n          deep: false,\n          ...config\n        };\n\n        if (typeof watchConfig.handler !== 'function') {\n          throw new Error(`Invalid watcher handler: expected function for path \"${path}\"`);\n        }\n\n        if (instance._watchers.has(path)) return;\n\n        const initialValue = this.getDeepValue(path, state);\n\n        let finalHandler;\n        if (watchConfig.debounce > 0) {\n          finalHandler = this.debounce(\n            function(newVal, oldVal) {\n              try {\n                watchConfig.handler.call(this, newVal, oldVal);\n              } catch (error) {\n                ErrorManager.handle(error, {\n                  context: 'WatchManager.handler',\n                  source: instance.id,\n                  notify: true,\n                  data: {path}\n                });\n              }\n            },\n            watchConfig.debounce\n          );\n        } else {\n          finalHandler = function(newVal, oldVal) {\n            try {\n              watchConfig.handler.call(this, newVal, oldVal);\n            } catch (error) {\n              ErrorManager.handle(error, {\n                context: 'WatchManager.handler',\n                source: instance.id,\n                notify: true,\n                data: {path}\n              });\n            }\n          };\n        }\n\n        const watcher = {\n          path,\n          handler: finalHandler.bind(instance),\n          lastValue: this.deepClone(initialValue),\n          config: watchConfig,\n          active: true\n        };\n\n        instance._watchers.set(path, watcher);\n\n        if (watchConfig.immediate) {\n          watcher.handler(initialValue, undefined);\n        }\n\n      } catch (error) {\n        const newError = new Error(`Failed to setup watcher for \"${path}\": ${error.message}`);\n        ErrorManager.handle(newError, {\n          context: 'WatchManager.setupWatchers',\n          data: {source: instance.id, state, watchers}\n        });\n      }\n    });\n\n    return true;\n  },\n\n  getDeepValue(path, obj) {\n    return path.split('.').reduce((value, key) => {\n      if (key.includes('[') && key.includes(']')) {\n        const arrayKey = key.split('[')[0];\n        const index = parseInt(key.split('[')[1].split(']')[0]);\n        return value?.[arrayKey]?.[index];\n      }\n      return value?.[key];\n    }, obj);\n  },\n\n  deepClone(obj, seen = new WeakMap()) {\n    if (obj === null || typeof obj !== 'object') {\n      return obj;\n    }\n\n    if (seen.has(obj)) {\n      return seen.get(obj);\n    }\n\n    if (obj instanceof Date) {\n      return new Date(obj);\n    }\n\n    if (Array.isArray(obj)) {\n      const clone = [];\n      seen.set(obj, clone);\n\n      obj.forEach((item, index) => {\n        clone[index] = this.deepClone(item, seen);\n      });\n\n      return clone;\n    }\n\n    const clone = {};\n    seen.set(obj, clone);\n\n    Object.entries(obj).forEach(([key, value]) => {\n      clone[key] = this.deepClone(value, seen);\n    });\n\n    return clone;\n  },\n\n  deepEqual(a, b) {\n    if (a === b) return true;\n\n    if (typeof a !== 'object' || typeof b !== 'object') {\n      return false;\n    }\n\n    if (Array.isArray(a)) {\n      if (!Array.isArray(b) || a.length !== b.length) return false;\n      return a.every((item, index) => this.deepEqual(item, b[index]));\n    }\n\n    const keysA = Object.keys(a);\n    const keysB = Object.keys(b);\n\n    if (keysA.length !== keysB.length) return false;\n\n    return keysA.every(key =>\n      Object.prototype.hasOwnProperty.call(b, key) &&\n      this.deepEqual(a[key], b[key])\n    );\n  },\n\n  triggerWatchers(instance) {\n    if (!instance?._watchers) return;\n\n    instance._watchers.forEach(watcher => {\n      if (!watcher.active) return;\n\n      try {\n        let currentValue;\n        try {\n          currentValue = this.getDeepValue(watcher.path, instance.state);\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'WatchManager.getter',\n            data: {source: instance.id, path: watcher.path},\n            notify: true\n          });\n          watcher.active = false;\n          return;\n        }\n\n        const hasChanged = watcher.config.deep ?\n          !this.deepEqual(currentValue, watcher.lastValue) :\n          currentValue !== watcher.lastValue;\n\n        if (hasChanged) {\n          watcher.handler(\n            this.deepClone(currentValue),\n            this.deepClone(watcher.lastValue)\n          );\n          watcher.lastValue = this.deepClone(currentValue);\n        }\n\n      } catch (error) {\n        ErrorManager.handle(error, {\n          context: 'WatchManager.triggerWatchers',\n          data: {source: instance.id, path: watcher.path},\n          notify: true\n        });\n        watcher.active = false;\n      }\n    });\n  },\n\n  cleanupWatchers(instance) {\n    if (!instance?._watchers) return;\n\n    instance._watchers.forEach(watcher => {\n      if (watcher.handler.cancel) {\n        watcher.handler.cancel();\n      }\n      watcher.active = false;\n    });\n\n    instance._watchers.clear();\n  },\n\n  debounce(func, wait = 100) {\n    let timeoutId = null;\n    const context = this;\n\n    const debouncedFn = function(...args) {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      timeoutId = setTimeout(() => {\n        func.apply(context, args);\n      }, wait);\n    };\n\n    debouncedFn.cancel = function() {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n        timeoutId = null;\n      }\n    };\n\n    return debouncedFn;\n  }\n};\n\nwindow.WatchManager = WatchManager;\n","/**\n * StorageManager\n * A comprehensive class for managing data storage in browser\n * with support for IndexedDB, LocalStorage, SessionStorage, and memory storage\n */\nconst StorageManager = {\n  config: {\n    defaultDB: 'now_app_storage',\n    defaultVersion: 1,\n    maxRetries: 3,\n    retryDelay: 300,\n    autoInit: true,\n    defaultStoreConfig: {\n      keyPath: 'id',\n      autoIncrement: true,\n      indexes: []\n    },\n    storeSizeWarningThreshold: 50 * 1024 * 1024, // 50MB\n    cacheLookups: true,\n    cacheMaxAge: 60 * 1000, // 1 minute\n    defaultAdapter: 'indexeddb',\n    statistics: {\n      enabled: true,\n      trackOperations: true,\n      trackTiming: true\n    },\n    stores: {}\n  },\n\n  state: {\n    initialized: false,\n    databases: new Map(),\n    databaseSchemas: new Map(),\n    cache: new Map(),\n    statistics: {\n      operations: {\n        reads: 0,\n        writes: 0,\n        updates: 0,\n        deletes: 0,\n        queries: 0\n      },\n      timing: {\n        totalTime: 0,\n        operationCount: 0\n      },\n      errors: 0,\n      storeSize: {}\n    },\n    lastError: null\n  },\n\n  /**\n   * Initializes the StorageManager\n   * @param {Object} options - Configuration options\n   * @returns {Promise<StorageManager>} - Returns the StorageManager instance\n   */\n  async init(options = {}) {\n    try {\n      this.config = {...this.config, ...options};\n\n      if (!this.isSupported()) {\n        throw new Error('IndexedDB is not supported in this browser');\n      }\n\n      this.state.initialized = true;\n\n      if (this.config.stores && Object.keys(this.config.stores).length > 0) {\n        const dbConfig = {\n          name: this.config.defaultDB,\n          version: this.config.defaultVersion,\n          stores: this.config.stores\n        };\n        await this.createDatabase(dbConfig);\n      }\n\n      EventManager.emit('storage:ready', {manager: 'StorageManager'});\n\n      return this;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n\n      if (window.ErrorManager) {\n        ErrorManager.handle(error, {\n          context: 'StorageManager.init',\n          type: 'storage:error'\n        });\n      }\n\n      throw error;\n    }\n  },\n\n  /**\n   * Checks if IndexedDB is supported by the browser\n   * @returns {boolean} - True if supported\n   */\n  isSupported() {\n    return !!window.indexedDB;\n  },\n\n  /**\n   * Creates or opens a database\n   * @param {Object} dbConfig - Database configuration\n   * @param {string} dbConfig.name - Database name\n   * @param {number} dbConfig.version - Database version\n   * @param {Object} dbConfig.stores - Object store configurations\n   * @returns {Promise<IDBDatabase>} - Returns the database instance\n   */\n  async createDatabase(dbConfig) {\n    const {name, version, stores} = dbConfig;\n\n    return new Promise((resolve, reject) => {\n      if (this.state.databases.has(name)) {\n        const db = this.state.databases.get(name);\n        const currentVersion = db.version;\n\n        if (version > currentVersion) {\n          db.close();\n          this.state.databases.delete(name);\n        } else {\n          resolve(db);\n          return;\n        }\n      }\n\n      this.state.databaseSchemas.set(name, {stores});\n\n      const request = indexedDB.open(name, version);\n\n      request.onerror = (event) => {\n        const error = new Error(`Failed to open database ${name}: ${event.target.error}`);\n        this.state.lastError = error;\n        this.state.statistics.errors++;\n        reject(error);\n      };\n\n      request.onsuccess = (event) => {\n        const db = event.target.result;\n        this.state.databases.set(name, db);\n\n        db.onerror = (event) => {\n          this.state.statistics.errors++;\n        };\n\n        resolve(db);\n      };\n\n      request.onupgradeneeded = (event) => {\n        const db = event.target.result;\n        const oldVersion = event.oldVersion;\n        const newVersion = event.newVersion;\n\n        for (const [storeName, storeConfig] of Object.entries(stores)) {\n          try {\n            if (!db.objectStoreNames.contains(storeName)) {\n              const config = {...this.config.defaultStoreConfig, ...storeConfig};\n              const store = db.createObjectStore(storeName, {\n                keyPath: config.keyPath,\n                autoIncrement: config.autoIncrement\n              });\n\n              if (config.indexes && Array.isArray(config.indexes)) {\n                config.indexes.forEach(indexConfig => {\n                  const {name, keyPath, options} = indexConfig;\n                  store.createIndex(name, keyPath, options || {unique: false});\n                });\n              }\n            } else if (storeConfig.update) {\n              const store = event.target.transaction.objectStore(storeName);\n              if (storeConfig.indexes && Array.isArray(storeConfig.indexes)) {\n                const existingIndexNames = Array.from(store.indexNames);\n                storeConfig.indexes.forEach(indexConfig => {\n                  const {name, keyPath, options} = indexConfig;\n                  if (!existingIndexNames.includes(name)) {\n                    store.createIndex(name, keyPath, options || {unique: false});\n                  }\n                });\n              }\n            }\n          } catch (error) {\n            console.error(`StorageManager: Failed to create object store '${storeName}':`, error);\n            this.state.statistics.errors++;\n          }\n        }\n      };\n    });\n  },\n\n  /**\n   * Adds data to an object store\n   * @param {string} storeName - Object store name\n   * @param {Object|Array} data - Data to add (single or array)\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<any>} - Returns the added ID or array of IDs\n   */\n  async add(storeName, data, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db || db.readyState === 'closed') {\n          throw new Error(`Database ${dbName} is closed or invalid`);\n        }\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          throw new Error(`Object store ${storeName} does not exist in database ${dbName}`);\n        }\n\n        return new Promise((resolve, reject) => {\n          try {\n            const transaction = db.transaction(storeName, 'readwrite');\n            const store = transaction.objectStore(storeName);\n            let results = [];\n            const isArray = Array.isArray(data);\n\n            transaction.onerror = (event) => {\n              reject(new Error(`Failed to add data to ${storeName}: ${event.target.error}`));\n            };\n\n            transaction.oncomplete = () => {\n              this.invalidateStoreCache(dbName, storeName);\n              if (this.config.statistics.trackOperations) {\n                this.state.statistics.operations.writes += isArray ? data.length : 1;\n              }\n              resolve(isArray ? results : results[0]);\n            };\n\n            if (isArray) {\n              let counter = 0;\n              const addNext = () => {\n                if (counter < data.length) {\n                  try {\n                    const request = store.add(data[counter]);\n                    request.onsuccess = (event) => {\n                      results.push(event.target.result);\n                      counter++;\n                      addNext();\n                    };\n                    request.onerror = (event) => {\n                      transaction.abort();\n                      reject(new Error(`Failed to add item ${counter}: ${event.target.error}`));\n                    };\n                  } catch (innerError) {\n                    transaction.abort();\n                    reject(new Error(`Error in add operation: ${innerError.message}`));\n                  }\n                }\n              };\n              addNext();\n            } else {\n              const request = store.add(data);\n              request.onsuccess = (event) => {\n                results.push(event.target.result);\n              };\n            }\n          } catch (transactionError) {\n            reject(new Error(`Transaction error: ${transactionError.message}`));\n          }\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      await this.updateStoreStats(dbName, storeName);\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Updates data in an object store\n   * @param {string} storeName - Object store name\n   * @param {Object|Array} data - Data to update (single or array)\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<boolean>} - Returns true if successful\n   */\n  async update(storeName, data, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readwrite');\n          const store = transaction.objectStore(storeName);\n          let updates = 0;\n          const isArray = Array.isArray(data);\n          const items = isArray ? data : [data];\n\n          transaction.onerror = (event) => {\n            reject(new Error(`Failed to update data in ${storeName}: ${event.target.error}`));\n          };\n\n          transaction.oncomplete = () => {\n            this.invalidateStoreCache(dbName, storeName);\n            if (this.config.statistics.trackOperations) {\n              this.state.statistics.operations.updates += updates;\n            }\n            resolve(true);\n          };\n\n          let counter = 0;\n          const updateNext = () => {\n            if (counter < items.length) {\n              const item = items[counter];\n              const request = store.put(item);\n              request.onsuccess = () => {\n                updates++;\n                counter++;\n                updateNext();\n              };\n              request.onerror = (event) => {\n                counter++;\n                updateNext();\n              };\n            }\n          };\n          updateNext();\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Retrieves data by ID\n   * @param {string} storeName - Object store name\n   * @param {any} id - ID to retrieve\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<any>} - Returns the data or null if not found\n   */\n  async getById(storeName, id, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    const cacheKey = `${dbName}:${storeName}:${id}`;\n\n    if (this.config.cacheLookups && this.state.cache.has(cacheKey)) {\n      const cached = this.state.cache.get(cacheKey);\n      if (Date.now() - cached.timestamp < this.config.cacheMaxAge) {\n        return cached.data;\n      } else {\n        this.state.cache.delete(cacheKey);\n      }\n    }\n\n    let retryCount = 0;\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          return null;\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readonly');\n          const store = transaction.objectStore(storeName);\n          const request = store.get(id);\n\n          request.onerror = (event) => {\n            reject(new Error(`Failed to retrieve ID ${id} from ${storeName}: ${event.target.error}`));\n          };\n\n          request.onsuccess = (event) => {\n            const result = event.target.result || null;\n            if (this.config.cacheLookups && result) {\n              this.state.cache.set(cacheKey, {\n                data: result,\n                timestamp: Date.now()\n              });\n            }\n            if (this.config.statistics.trackOperations) {\n              this.state.statistics.operations.reads++;\n            }\n            resolve(result);\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Retrieves all data from an object store\n   * @param {string} storeName - Object store name\n   * @param {Object} [options] - Query options\n   * @param {number} [options.limit] - Result limit\n   * @param {number} [options.offset] - Offset to skip\n   * @param {string} [options.index] - Index name to use\n   * @param {string} [options.direction] - Sort direction ('next', 'prev', 'nextunique', 'prevunique')\n   * @param {IDBKeyRange} [options.range] - Key range for filtering\n   * @param {Function} [options.filter] - Filter function\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<Array>} - Returns an array of all data\n   */\n  async getAll(storeName, options = {}, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          return [];\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readonly');\n          const store = transaction.objectStore(storeName);\n          const source = options.index ? store.index(options.index) : store;\n          const direction = options.direction || 'next';\n          const results = [];\n          let counter = 0;\n          let skipped = 0;\n          const offset = options.offset || 0;\n          const limit = options.limit || Infinity;\n\n          if (source.getAll && !options.filter && offset === 0) {\n            const limitParam = limit === Infinity ? undefined : limit;\n            const getAllRequest = source.getAll(options.range, limitParam);\n\n            getAllRequest.onsuccess = (event) => {\n              if (this.config.statistics.trackOperations) {\n                this.state.statistics.operations.reads += event.target.result.length;\n                this.state.statistics.operations.queries++;\n              }\n              resolve(event.target.result);\n            };\n            getAllRequest.onerror = (event) => {\n              reject(new Error(`Failed to retrieve data from ${storeName}: ${event.target.error}`));\n            };\n            return;\n          }\n\n          const request = source.openCursor(options.range, direction);\n\n          request.onerror = (event) => {\n            reject(new Error(`Failed to retrieve data from ${storeName}: ${event.target.error}`));\n          };\n\n          request.onsuccess = (event) => {\n            const cursor = event.target.result;\n\n            if (cursor) {\n              if (skipped < offset) {\n                skipped++;\n                cursor.continue();\n                return;\n              }\n\n              const value = cursor.value;\n              if (!options.filter || options.filter(value)) {\n                results.push(value);\n                counter++;\n              }\n\n              if (counter < limit) {\n                cursor.continue();\n              } else {\n                if (this.config.statistics.trackOperations) {\n                  this.state.statistics.operations.reads += counter;\n                  this.state.statistics.operations.queries++;\n                }\n                resolve(results);\n              }\n            } else {\n              if (this.config.statistics.trackOperations) {\n                this.state.statistics.operations.reads += counter;\n                this.state.statistics.operations.queries++;\n              }\n              resolve(results);\n            }\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Queries data with specified conditions\n   * @param {string} storeName - Object store name\n   * @param {Object} query - Query conditions\n   * @param {string} [query.index] - Index name to use\n   * @param {any} [query.value] - Value to match (for equality)\n   * @param {IDBKeyRange} [query.range] - Key range for filtering\n   * @param {Object} [options] - Query options\n   * @param {number} [options.limit] - Result limit\n   * @param {string} [options.direction] - Sort direction\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<Array>} - Returns an array of matching data\n   */\n  async query(storeName, query, options = {}, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          return [];\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readonly');\n          const store = transaction.objectStore(storeName);\n          let source = store;\n          let range = null;\n\n          if (query.index) {\n            if (!store.indexNames.contains(query.index)) {\n              reject(new Error(`Index ${query.index} does not exist in ${storeName}`));\n              return;\n            }\n            source = store.index(query.index);\n          }\n\n          if (query.range) {\n            range = query.range;\n          } else if (query.value !== undefined) {\n            range = IDBKeyRange.only(query.value);\n          }\n\n          const direction = options.direction || 'next';\n          const results = [];\n          const limit = options.limit || Infinity;\n\n          if (source.getAll && !options.filter && limit === Infinity) {\n            const getAllRequest = source.getAll(range);\n            getAllRequest.onsuccess = (event) => {\n              const items = event.target.result;\n              if (this.config.statistics.trackOperations) {\n                this.state.statistics.operations.reads += items.length;\n                this.state.statistics.operations.queries++;\n              }\n              resolve(items);\n            };\n            getAllRequest.onerror = (event) => {\n              reject(new Error(`Failed to query data in ${storeName}: ${event.target.error}`));\n            };\n            return;\n          }\n\n          let count = 0;\n          const cursorRequest = source.openCursor(range, direction);\n\n          cursorRequest.onerror = (event) => {\n            reject(new Error(`Failed to query data in ${storeName}: ${event.target.error}`));\n          };\n\n          cursorRequest.onsuccess = (event) => {\n            const cursor = event.target.result;\n\n            if (cursor && count < limit) {\n              results.push(cursor.value);\n              count++;\n              cursor.continue();\n            } else {\n              if (this.config.statistics.trackOperations) {\n                this.state.statistics.operations.reads += results.length;\n                this.state.statistics.operations.queries++;\n              }\n              resolve(results);\n            }\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Counts items in an object store based on conditions\n   * @param {string} storeName - Object store name\n   * @param {Object} [query] - Query conditions\n   * @param {string} [query.index] - Index name to use\n   * @param {any} [query.value] - Value to match (for equality)\n   * @param {IDBKeyRange} [query.range] - Key range for counting\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<number>} - Returns the item count\n   */\n  async count(storeName, query = {}, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          return 0;\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readonly');\n          const store = transaction.objectStore(storeName);\n          let source = store;\n          let range = null;\n\n          if (query.index) {\n            if (!store.indexNames.contains(query.index)) {\n              reject(new Error(`Index ${query.index} does not exist in ${storeName}`));\n              return;\n            }\n            source = store.index(query.index);\n          }\n\n          if (query.range) {\n            range = query.range;\n          } else if (query.value !== undefined) {\n            range = IDBKeyRange.only(query.value);\n          }\n\n          const countRequest = source.count(range);\n\n          countRequest.onerror = (event) => {\n            reject(new Error(`Failed to count data in ${storeName}: ${event.target.error}`));\n          };\n\n          countRequest.onsuccess = (event) => {\n            const count = event.target.result;\n            if (this.config.statistics.trackOperations) {\n              this.state.statistics.operations.queries++;\n            }\n            resolve(count);\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Deletes data by ID\n   * @param {string} storeName - Object store name\n   * @param {any} id - ID to delete\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<boolean>} - Returns true if successful\n   */\n  async delete(storeName, id, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readwrite');\n          const store = transaction.objectStore(storeName);\n          const request = store.delete(id);\n\n          request.onerror = (event) => {\n            reject(new Error(`Failed to delete ID ${id} from ${storeName}: ${event.target.error}`));\n          };\n\n          request.onsuccess = () => {\n            this.invalidateItemCache(dbName, storeName, id);\n            if (this.config.statistics.trackOperations) {\n              this.state.statistics.operations.deletes++;\n            }\n            resolve(true);\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      await this.updateStoreStats(dbName, storeName);\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Deletes data based on conditions\n   * @param {string} storeName - Object store name\n   * @param {Object} query - Deletion conditions\n   * @param {string} [query.index] - Index name to use\n   * @param {any} [query.value] - Value to match (for equality)\n   * @param {IDBKeyRange} [query.range] - Key range for deletion\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<number>} - Returns the number of deleted items\n   */\n  async deleteByQuery(storeName, query, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n        const items = await this.query(storeName, query, {}, dbName);\n\n        if (items.length === 0) {\n          return 0;\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readwrite');\n          const store = transaction.objectStore(storeName);\n          let count = 0;\n\n          transaction.onerror = (event) => {\n            reject(new Error(`Failed to delete data in ${storeName}: ${event.target.error}`));\n          };\n\n          transaction.oncomplete = () => {\n            if (this.config.statistics.trackOperations) {\n              this.state.statistics.operations.deletes += count;\n            }\n            this.invalidateStoreCache(dbName, storeName);\n            resolve(count);\n          };\n\n          items.forEach(item => {\n            const keyPath = store.keyPath;\n            const id = item[keyPath];\n            const request = store.delete(id);\n            request.onsuccess = () => {\n              count++;\n            };\n          });\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      await this.updateStoreStats(dbName, storeName);\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Clears all data in an object store\n   * @param {string} storeName - Object store name\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<boolean>} - Returns true if successful\n   */\n  async clear(storeName, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readwrite');\n          const store = transaction.objectStore(storeName);\n          const request = store.clear();\n\n          request.onerror = (event) => {\n            reject(new Error(`Failed to clear data in ${storeName}: ${event.target.error}`));\n          };\n\n          request.onsuccess = () => {\n            this.invalidateStoreCache(dbName, storeName);\n            resolve(true);\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      this.state.statistics.storeSize[`${dbName}.${storeName}`] = 0;\n      EventManager.emit('storage:cleared', {dbName, storeName});\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Checks if an item with the specified ID exists\n   * @param {string} storeName - Object store name\n   * @param {any} id - ID to check\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<boolean>} - Returns true if the item exists\n   */\n  async exists(storeName, id, dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        if (!db.objectStoreNames.contains(storeName)) {\n          return false;\n        }\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readonly');\n          const store = transaction.objectStore(storeName);\n          const request = store.count(id);\n\n          request.onerror = (event) => {\n            reject(new Error(`Failed to check ID ${id} in ${storeName}: ${event.target.error}`));\n          };\n\n          request.onsuccess = (event) => {\n            resolve(event.target.result > 0);\n          };\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Creates a key range for querying\n   * @param {string} type - Range type ('only', 'bound', 'upperBound', 'lowerBound')\n   * @param {any} value - Value for 'only', 'upperBound', or 'lowerBound'\n   * @param {any} [value2] - Second value for 'bound'\n   * @param {boolean} [lowerOpen=false] - Lower bound open/closed (for 'bound')\n   * @param {boolean} [upperOpen=false] - Upper bound open/closed (for 'bound')\n   * @returns {IDBKeyRange} - Returns the key range\n   */\n  createKeyRange(type, value, value2, lowerOpen = false, upperOpen = false) {\n    switch (type.toLowerCase()) {\n      case 'only':\n        return IDBKeyRange.only(value);\n      case 'bound':\n        return IDBKeyRange.bound(value, value2, lowerOpen, upperOpen);\n      case 'upperbound':\n        return IDBKeyRange.upperBound(value, lowerOpen);\n      case 'lowerbound':\n        return IDBKeyRange.lowerBound(value, lowerOpen);\n      default:\n        throw new Error(`Invalid range type: ${type}`);\n    }\n  },\n\n  /**\n   * Opens or creates a database if it doesn't exist\n   * @param {string} dbName - Database name\n   * @returns {Promise<IDBDatabase>} - Returns the database instance\n   * @private\n   */\n  async getDatabase(dbName) {\n    if (this.state.databases.has(dbName)) {\n      const db = this.state.databases.get(dbName);\n      if (db && db.readyState !== 'closed') {\n        return db;\n      } else {\n        this.state.databases.delete(dbName);\n      }\n    }\n\n    if (!this.state.databaseSchemas.has(dbName)) {\n      if (dbName === this.config.defaultDB && this.config.stores) {\n        try {\n          await this.createDatabase({\n            name: dbName,\n            version: this.config.defaultVersion,\n            stores: this.config.stores\n          });\n\n          const db = this.state.databases.get(dbName);\n          if (!db) {\n            throw new Error(`Failed to create database ${dbName}`);\n          }\n          return db;\n        } catch (error) {\n          throw error;\n        }\n      } else {\n        throw new Error(`Database ${dbName} not found and no schema available for creation`);\n      }\n    }\n\n    try {\n      const schema = this.state.databaseSchemas.get(dbName);\n      await this.createDatabase({\n        name: dbName,\n        version: schema.version || 1,\n        stores: schema.stores\n      });\n\n      const db = this.state.databases.get(dbName);\n      if (!db) {\n        throw new Error(`Failed to create database ${dbName} from schema`);\n      }\n      return db;\n    } catch (error) {\n      throw error;\n    }\n  },\n\n  /**\n   * Invalidates cache for an object store\n   * @param {string} dbName - Database name\n   * @param {string} storeName - Object store name\n   * @private\n   */\n  invalidateStoreCache(dbName, storeName) {\n    if (!this.config.cacheLookups) return;\n\n    for (const key of this.state.cache.keys()) {\n      if (key.startsWith(`${dbName}:${storeName}:`)) {\n        this.state.cache.delete(key);\n      }\n    }\n  },\n\n  /**\n   * Invalidates cache for a specific item\n   * @param {string} dbName - Database name\n   * @param {string} storeName - Object store name\n   * @param {any} id - Item ID\n   * @private\n   */\n  invalidateItemCache(dbName, storeName, id) {\n    if (!this.config.cacheLookups) return;\n\n    const cacheKey = `${dbName}:${storeName}:${id}`;\n    this.state.cache.delete(cacheKey);\n  },\n\n  /**\n   * Updates storage size statistics for an object store\n   * @param {string} dbName - Database name\n   * @param {string} storeName - Object store name\n   * @private\n   */\n  async updateStoreStats(dbName, storeName) {\n    if (!this.config.statistics.enabled) return;\n\n    try {\n      const count = await this.count(storeName, {}, dbName);\n      const sampleSize = Math.min(100, count);\n      if (sampleSize <= 0) {\n        this.state.statistics.storeSize[`${dbName}.${storeName}`] = 0;\n        return;\n      }\n\n      const items = await this.getAll(storeName, {limit: sampleSize}, dbName);\n      let totalSize = 0;\n      items.forEach(item => {\n        const json = JSON.stringify(item);\n        totalSize += json.length * 2;\n      });\n\n      const averageSize = totalSize / items.length;\n      const estimatedSize = averageSize * count;\n\n      this.state.statistics.storeSize[`${dbName}.${storeName}`] = estimatedSize;\n    } catch (error) {\n    }\n  },\n\n  /**\n   * Formats file size into a human-readable string\n   * @param {number} bytes - Size in bytes\n   * @returns {string} - Formatted size\n   * @private\n   */\n  formatSize(bytes) {\n    const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    let size = bytes;\n    let unitIndex = 0;\n\n    while (size >= 1024 && unitIndex < units.length - 1) {\n      size /= 1024;\n      unitIndex++;\n    }\n\n    return `${size.toFixed(2)} ${units[unitIndex]}`;\n  },\n\n  /**\n   * Calculates total storage usage\n   * @returns {Promise<Object>} - Storage usage information\n   */\n  async getStorageUsage() {\n    if (!this.config.statistics.enabled) {\n      return {totalSize: 0, stores: {}};\n    }\n\n    let totalSize = 0;\n    const stores = {};\n\n    for (const [key, size] of Object.entries(this.state.statistics.storeSize)) {\n      const [dbName, storeName] = key.split('.');\n      if (!stores[dbName]) {\n        stores[dbName] = {};\n      }\n      stores[dbName][storeName] = {\n        size: size,\n        formatted: this.formatSize(size)\n      };\n      totalSize += size;\n    }\n\n    return {\n      totalSize: totalSize,\n      totalFormatted: this.formatSize(totalSize),\n      stores: stores\n    };\n  },\n\n  /**\n   * Retrieves performance statistics\n   * @returns {Object} - Operation statistics\n   */\n  getStatistics() {\n    if (!this.config.statistics.enabled) {\n      return null;\n    }\n\n    let averageOperationTime = 0;\n    if (this.state.statistics.timing.operationCount > 0) {\n      averageOperationTime = this.state.statistics.timing.totalTime / this.state.statistics.timing.operationCount;\n    }\n\n    const databases = {};\n    for (const [dbName, schema] of this.state.databaseSchemas.entries()) {\n      const storeNames = Object.keys(schema.stores || {});\n      databases[dbName] = {\n        version: this.state.databases.get(dbName)?.version || 0,\n        stores: storeNames\n      };\n    }\n\n    return {\n      operations: this.state.statistics.operations,\n      timing: {\n        totalTime: this.state.statistics.timing.totalTime.toFixed(2) + ' ms',\n        operationCount: this.state.statistics.timing.operationCount,\n        averageTime: averageOperationTime.toFixed(2) + ' ms'\n      },\n      databases: databases,\n      cacheSize: this.state.cache.size,\n      errors: this.state.statistics.errors,\n      lastError: this.state.lastError ? {\n        message: this.state.lastError.message,\n        timestamp: new Date().toISOString()\n      } : null\n    };\n  },\n\n  /**\n   * Deletes a database\n   * @param {string} dbName - Database name to delete\n   * @returns {Promise<boolean>} - Returns true if successful\n   */\n  async deleteDatabase(dbName) {\n    try {\n      if (this.state.databases.has(dbName)) {\n        const db = this.state.databases.get(dbName);\n        db.close();\n        this.state.databases.delete(dbName);\n      }\n\n      for (const key of this.state.cache.keys()) {\n        if (key.startsWith(`${dbName}:`)) {\n          this.state.cache.delete(key);\n        }\n      }\n\n      this.state.databaseSchemas.delete(dbName);\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.deleteDatabase(dbName);\n\n        request.onerror = (event) => {\n          const error = new Error(`Failed to delete database ${dbName}: ${event.target.error}`);\n          this.state.lastError = error;\n          this.state.statistics.errors++;\n          reject(error);\n        };\n\n        request.onsuccess = () => {\n          for (const key in this.state.statistics.storeSize) {\n            if (key.startsWith(`${dbName}.`)) {\n              delete this.state.statistics.storeSize[key];\n            }\n          }\n          EventManager.emit('storage:databaseDeleted', {dbName});\n          resolve(true);\n        };\n      });\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Processes data in batches (add/update multiple items)\n   * @param {string} storeName - Object store name\n   * @param {Array} items - Array of items to process\n   * @param {string} [operation='update'] - Operation type ('add', 'update', 'upsert')\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<Array>} - Returns array of IDs (for 'add') or success count (for 'update', 'upsert')\n   */\n  async batch(storeName, items, operation = 'update', dbName = this.config.defaultDB) {\n    const startTime = this.config.statistics.trackTiming ? performance.now() : 0;\n    let retryCount = 0;\n\n    if (!Array.isArray(items) || items.length === 0) {\n      return [];\n    }\n\n    const executeOperation = async () => {\n      try {\n        const db = await this.getDatabase(dbName);\n\n        return new Promise((resolve, reject) => {\n          const transaction = db.transaction(storeName, 'readwrite');\n          const store = transaction.objectStore(storeName);\n          const results = [];\n          let completed = 0;\n\n          transaction.onerror = (event) => {\n            reject(new Error(`Batch operation failed in ${storeName}: ${event.target.error}`));\n          };\n\n          transaction.oncomplete = () => {\n            this.invalidateStoreCache(dbName, storeName);\n            if (this.config.statistics.trackOperations) {\n              if (operation === 'add') {\n                this.state.statistics.operations.writes += completed;\n              } else {\n                this.state.statistics.operations.updates += completed;\n              }\n            }\n            resolve(operation === 'add' ? results : completed);\n          };\n\n          items.forEach(item => {\n            let request;\n\n            switch (operation) {\n              case 'add':\n                request = store.add(item);\n                request.onsuccess = (event) => {\n                  results.push(event.target.result);\n                  completed++;\n                };\n                break;\n\n              case 'update':\n                request = store.put(item);\n                request.onsuccess = () => {\n                  completed++;\n                };\n                break;\n\n              case 'upsert':\n                const keyPath = store.keyPath;\n                const id = item[keyPath];\n                if (id !== undefined) {\n                  request = store.put(item);\n                  request.onsuccess = () => {\n                    completed++;\n                  };\n                } else {\n                  request = store.add(item);\n                  request.onsuccess = (event) => {\n                    results.push(event.target.result);\n                    completed++;\n                  };\n                }\n                break;\n\n              default:\n                throw new Error(`Invalid operation type: ${operation}`);\n            }\n\n            request.onerror = (event) => {\n              event.stopPropagation();\n            };\n          });\n        });\n      } catch (error) {\n        if (retryCount < this.config.maxRetries) {\n          retryCount++;\n          await new Promise(r => setTimeout(r, this.config.retryDelay));\n          return executeOperation();\n        }\n        throw error;\n      }\n    };\n\n    try {\n      const result = await executeOperation();\n      if (this.config.statistics.trackTiming) {\n        const endTime = performance.now();\n        this.state.statistics.timing.totalTime += (endTime - startTime);\n        this.state.statistics.timing.operationCount++;\n      }\n      await this.updateStoreStats(dbName, storeName);\n      return result;\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Convenience function for creating transactions\n   * @param {string} storeName - Object store name\n   * @param {Function} callback - Function to execute with the transaction\n   * @param {string} [mode='readonly'] - Transaction mode ('readonly' or 'readwrite')\n   * @param {string} [dbName=this.config.defaultDB] - Database name\n   * @returns {Promise<any>} - Returns the callback result\n   */\n  async transaction(storeName, callback, mode = 'readonly', dbName = this.config.defaultDB) {\n    try {\n      const db = await this.getDatabase(dbName);\n\n      return new Promise((resolve, reject) => {\n        const transaction = db.transaction(storeName, mode);\n        const store = transaction.objectStore(storeName);\n\n        transaction.onerror = (event) => {\n          reject(new Error(`Transaction failed in ${storeName}: ${event.target.error}`));\n        };\n\n        transaction.oncomplete = () => {\n          resolve(result);\n        };\n\n        let result;\n        try {\n          result = callback(store, transaction);\n        } catch (error) {\n          transaction.abort();\n          reject(error);\n        }\n      });\n    } catch (error) {\n      this.state.lastError = error;\n      this.state.statistics.errors++;\n      throw error;\n    }\n  },\n\n  /**\n   * Storage adapters for different storage types\n   */\n  adapters: {\n    indexeddb: {\n      async get(key, storeName, dbName) {\n        return StorageManager.getById(storeName, key, dbName || StorageManager.config.defaultDB);\n      },\n      async set(key, value, storeName, dbName) {\n        const db = dbName || StorageManager.config.defaultDB;\n        const data = typeof value === 'object' ? value : {id: key, value};\n        if (await StorageManager.exists(storeName, key, db)) {\n          if (typeof value === 'object' && !value.id) {\n            value.id = key;\n          }\n          return StorageManager.update(storeName, data, db);\n        } else {\n          return StorageManager.add(storeName, data, db);\n        }\n      },\n      async remove(key, storeName, dbName) {\n        return StorageManager.delete(storeName, key, dbName || StorageManager.config.defaultDB);\n      },\n      async clear(storeName, dbName) {\n        return StorageManager.clear(storeName, dbName || StorageManager.config.defaultDB);\n      },\n      async getAll(storeName, dbName) {\n        return StorageManager.getAll(storeName, {}, dbName || StorageManager.config.defaultDB);\n      }\n    },\n\n    localStorage: {\n      get(key) {\n        try {\n          const value = localStorage.getItem(key);\n          return value ? JSON.parse(value) : null;\n        } catch (e) {\n          return localStorage.getItem(key);\n        }\n      },\n      set(key, value) {\n        localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);\n        return true;\n      },\n      remove(key) {\n        localStorage.removeItem(key);\n        return true;\n      },\n      clear() {\n        localStorage.clear();\n        return true;\n      },\n      getAll() {\n        const items = {};\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          items[key] = this.get(key);\n        }\n        return items;\n      }\n    },\n\n    sessionStorage: {\n      get(key) {\n        try {\n          const value = sessionStorage.getItem(key);\n          return value ? JSON.parse(value) : null;\n        } catch (e) {\n          return sessionStorage.getItem(key);\n        }\n      },\n      set(key, value) {\n        sessionStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);\n        return true;\n      },\n      remove(key) {\n        sessionStorage.removeItem(key);\n        return true;\n      },\n      clear() {\n        sessionStorage.clear();\n        return true;\n      },\n      getAll() {\n        const items = {};\n        for (let i = 0; i < sessionStorage.length; i++) {\n          const key = sessionStorage.key(i);\n          items[key] = this.get(key);\n        }\n        return items;\n      }\n    },\n\n    memory: {\n      _data: new Map(),\n      get(key) {\n        return this._data.get(key);\n      },\n      set(key, value) {\n        this._data.set(key, value);\n        return true;\n      },\n      remove(key) {\n        return this._data.delete(key);\n      },\n      clear() {\n        this._data.clear();\n        return true;\n      },\n      getAll() {\n        return Object.fromEntries(this._data.entries());\n      }\n    }\n  },\n\n  /**\n   * Get a specific storage adapter\n   * @param {string} type - Storage type ('indexeddb', 'localStorage', 'sessionStorage', 'memory')\n   * @returns {Object} - The storage adapter\n   */\n  store(type = null) {\n    const adapterType = type || this.config.defaultAdapter;\n    const adapter = this.adapters[adapterType.toLowerCase()];\n    if (!adapter) {\n      throw new Error(`Storage adapter '${adapterType}' not found`);\n    }\n    return adapter;\n  },\n\n  /**\n   * LocalStorage shorthand\n   */\n  local: {\n    get(key) {\n      return StorageManager.adapters.localStorage.get(key);\n    },\n    set(key, value) {\n      return StorageManager.adapters.localStorage.set(key, value);\n    },\n    remove(key) {\n      return StorageManager.adapters.localStorage.remove(key);\n    },\n    clear() {\n      return StorageManager.adapters.localStorage.clear();\n    },\n    getAll() {\n      return StorageManager.adapters.localStorage.getAll();\n    }\n  },\n\n  /**\n   * SessionStorage shorthand\n   */\n  session: {\n    get(key) {\n      return StorageManager.adapters.sessionStorage.get(key);\n    },\n    set(key, value) {\n      return StorageManager.adapters.sessionStorage.set(key, value);\n    },\n    remove(key) {\n      return StorageManager.adapters.sessionStorage.remove(key);\n    },\n    clear() {\n      return StorageManager.adapters.sessionStorage.clear();\n    },\n    getAll() {\n      return StorageManager.adapters.sessionStorage.getAll();\n    }\n  },\n\n  /**\n   * Memory storage shorthand\n   */\n  memory: {\n    get(key) {\n      return StorageManager.adapters.memory.get(key);\n    },\n    set(key, value) {\n      return StorageManager.adapters.memory.set(key, value);\n    },\n    remove(key) {\n      return StorageManager.adapters.memory.remove(key);\n    },\n    clear() {\n      return StorageManager.adapters.memory.clear();\n    },\n    getAll() {\n      return StorageManager.adapters.memory.getAll();\n    }\n  },\n\n  /**\n   * Sync-enabled methods\n   */\n  async addWithSync(storeName, data, syncOptions = {}) {\n    const syncManager = window.Now?.getManager('sync');\n    const result = await this.add(storeName, data);\n\n    if (syncManager && syncOptions.sync !== false) {\n      const itemToSync = {...data};\n      if (!itemToSync.id && typeof result !== 'undefined') {\n        itemToSync.id = result;\n      }\n\n      await syncManager.addPendingOperation({\n        storeName,\n        method: 'add',\n        data: itemToSync,\n        priority: syncOptions.priority || 'medium'\n      });\n    }\n\n    return result;\n  },\n\n  async updateWithSync(storeName, data, syncOptions = {}) {\n    const syncManager = window.Now?.getManager('sync');\n    await this.update(storeName, data);\n\n    if (syncManager && syncOptions.sync !== false) {\n      await syncManager.addPendingOperation({\n        storeName,\n        method: 'update',\n        data,\n        priority: syncOptions.priority || 'medium'\n      });\n    }\n\n    return true;\n  },\n\n  async deleteWithSync(storeName, id, syncOptions = {}) {\n    const syncManager = window.Now?.getManager('sync');\n    const data = await this.getById(storeName, id);\n    await this.delete(storeName, id);\n\n    if (syncManager && syncOptions.sync !== false && data) {\n      await syncManager.addPendingOperation({\n        storeName,\n        method: 'delete',\n        data,\n        priority: syncOptions.priority || 'medium'\n      });\n    }\n\n    return true;\n  },\n\n  /**\n   * Clears all cache\n   */\n  clearCache() {\n    this.state.cache.clear();\n  },\n\n  /**\n   * Closes all database connections\n   */\n  closeAllConnections() {\n    for (const [name, db] of this.state.databases.entries()) {\n      try {\n        db.close();\n      } catch (error) {\n      }\n    }\n    this.state.databases.clear();\n  },\n\n  /**\n   * Resets all state\n   */\n  reset() {\n    this.closeAllConnections();\n    this.clearCache();\n    this.state = {\n      initialized: false,\n      databases: new Map(),\n      databaseSchemas: new Map(),\n      cache: new Map(),\n      statistics: {\n        operations: {\n          reads: 0,\n          writes: 0,\n          updates: 0,\n          deletes: 0,\n          queries: 0\n        },\n        timing: {\n          totalTime: 0,\n          operationCount: 0\n        },\n        errors: 0,\n        storeSize: {}\n      },\n      lastError: null\n    };\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('storage', StorageManager);\n}\n\nwindow.StorageManager = StorageManager;\n","/**\n * SyncManager\n * A manager for synchronizing offline data with a server\n * Provides queue functionality, priorities, and automatic retry\n *\n * Features:\n * - Offline queue management\n * - Priority-based synchronization\n * - Automatic retry with backoff strategies\n * - Integration with ApiService and HttpClient\n * - Network status monitoring\n * - Event-based system\n * - Enable/disable functionality\n */\nconst SyncManager = {\n  config: {\n    enabled: false,\n    autoSync: false,\n    syncInterval: 60000, // 1 minute\n    retryStrategy: 'exponential', // exponential, linear, fixed\n    maxRetries: 5,\n    pendingOperationsStore: 'sync_pending_operations',\n    onSyncComplete: null,\n    onSyncError: null,\n    debounceInterval: 5000, // Debounce multiple sync requests\n    batchSize: 10, // How many operations to process in one batch\n    concurrentRequests: 3, // How many concurrent API requests to make\n    priorityMapping: {\n      high: 0,\n      medium: 1,\n      low: 2\n    },\n    endpoints: {\n      // Default endpoint mapping\n      // If not specified, will try to use storeName as endpoint path\n    },\n    minRetryDelay: 1000, // Minimum delay between retries in ms\n    maxRetryDelay: 30000, // Maximum delay between retries in ms\n    defaultIdField: 'id', // Default field name used for IDs\n    defaultHeaders: {\n      'Content-Type': 'application/json'\n    },\n    tokens: {\n      enabled: false,\n      headerName: 'Authorization',\n      prefix: 'Bearer ',\n      tokenKey: 'auth_token',\n      storage: 'localStorage' // localStorage, sessionStorage\n    }\n  },\n\n  state: {\n    initialized: false,\n    enabled: false,\n    online: navigator.onLine,\n    syncing: false,\n    pendingSync: new Map(),\n    lastSyncTime: null,\n    syncTimerId: null,\n    syncPromise: null,\n    debounceTimer: null,\n    activeRequests: 0,\n    operationsProcessed: 0,\n    syncQueue: [],\n    failedOperations: []\n  },\n\n  /**\n   * Initialize the SyncManager\n   * @param {Object} options - Configuration options\n   * @returns {Promise<SyncManager>} - Returns the SyncManager instance\n   */\n  async init(options = {}) {\n    try {\n      this.config = {...this.config, ...options};\n\n      this.storageManager = window.Now?.getManager('storage');\n\n      if (!this.storageManager) {\n        throw new Error('StorageManager is required but not found');\n      }\n\n      if (!this.storageManager.state.initialized) {\n        try {\n          await this.storageManager.init();\n        } catch (storageError) {\n          console.error('Failed to initialize StorageManager:', storageError);\n          throw new Error(`StorageManager initialization failed: ${storageError.message}`);\n        }\n      }\n\n      try {\n        await this.storageManager.createDatabase({\n          name: this.storageManager.config.defaultDB,\n          version: this.storageManager.config.defaultVersion,\n          stores: {\n            [this.config.pendingOperationsStore]: {\n              keyPath: 'id',\n              autoIncrement: true,\n              indexes: [\n                {name: 'storeName', keyPath: 'storeName'},\n                {name: 'operation', keyPath: 'operation'},\n                {name: 'priority', keyPath: 'priority'},\n                {name: 'status', keyPath: 'status'},\n                {name: 'timestamp', keyPath: 'timestamp'}\n              ]\n            }\n          }\n        });\n      } catch (dbError) {\n        console.error('Failed to create database for SyncManager:', dbError);\n        throw new Error(`Failed to create sync storage: ${dbError.message}`);\n      }\n\n      window.addEventListener('online', this.handleOnline.bind(this));\n      window.addEventListener('offline', this.handleOffline.bind(this));\n\n      if (typeof document.hidden !== 'undefined') {\n        document.addEventListener('visibilitychange', () => {\n          if (!document.hidden && navigator.onLine && this.config.autoSync && this.state.enabled) {\n            this.debouncedSync();\n          }\n        });\n      }\n\n      this.state.initialized = true;\n\n      EventManager.emit('sync:initialized');\n\n      return this;\n    } catch (error) {\n      console.error('SyncManager initialization failed:', error);\n      if (window.ErrorManager) {\n        ErrorManager.handle(error, {\n          context: 'SyncManager.init',\n          type: 'sync:error'\n        });\n      }\n      throw error;\n    }\n  },\n\n  async enable() {\n    if (!this.state.initialized) {\n      await this.init();\n    }\n\n    this.state.enabled = true;\n    this.config.enabled = true;\n\n    if (this.config.autoSync && navigator.onLine) {\n      this.startAutoSync();\n      this.debouncedSync();\n    }\n\n    EventManager.emit('sync:enabled');\n\n    return this;\n  },\n\n  disable() {\n    this.state.enabled = false;\n    this.config.enabled = false;\n\n    this.stopAutoSync();\n\n    if (this.state.debounceTimer) {\n      clearTimeout(this.state.debounceTimer);\n      this.state.debounceTimer = null;\n    }\n\n\n    EventManager.emit('sync:disabled');\n\n    return this;\n  },\n\n  /**\n   * Add a pending operation to be synced later\n   * @param {Object} operation - The operation details\n   * @param {string} operation.storeName - Store name\n   * @param {string} operation.method - HTTP method ('add', 'update', 'delete')\n   * @param {Object} operation.data - Data to send\n   * @param {string} operation.priority - Priority ('high', 'medium', 'low')\n   * @returns {Promise<Object>} - The pending operation\n   */\n  async addPendingOperation(operation) {\n    if (!this.state.initialized) {\n      await this.init();\n    }\n\n    const result = await this._storePendingOperation(operation);\n\n    if (!this.config.enabled || !this.state.enabled) {\n      EventManager.emit('sync:operation:stored', {\n        operation: result,\n        message: 'Stored but sync is disabled'\n      });\n      return result;\n    }\n\n    if (this.config.autoSync && navigator.onLine) {\n      this.debouncedSync();\n    }\n\n    return result;\n  },\n\n  async _storePendingOperation(operation) {\n    const {storeName, data, method, priority = 'medium'} = operation;\n\n    if (!storeName || !data || !method) {\n      throw new Error('Missing required fields for pending operation');\n    }\n\n    const pendingOp = {\n      storeName,\n      operation: method, // 'add', 'update', 'delete'\n      data,\n      priority: this.config.priorityMapping[priority] || 1,\n      timestamp: Date.now(),\n      attempts: 0,\n      status: 'pending',\n      nextRetry: Date.now()\n    };\n\n    const id = await this.storageManager.add(\n      this.config.pendingOperationsStore,\n      pendingOp\n    );\n\n    EventManager.emit('sync:operation:added', {\n      operation: pendingOp,\n      id\n    });\n\n    return {\n      ...pendingOp,\n      id\n    };\n  },\n\n  /**\n   * Debounce multiple sync requests\n   */\n  debouncedSync() {\n    if (!this.config.enabled || !this.state.enabled) {\n      return;\n    }\n\n    clearTimeout(this.state.debounceTimer);\n    this.state.debounceTimer = setTimeout(() => {\n      this.syncAll();\n    }, this.config.debounceInterval);\n  },\n\n  /**\n   * Sync all pending operations\n   * @returns {Promise<Object>} - Sync results\n   */\n  async syncAll() {\n    if (!this.config.enabled || !this.state.enabled) {\n      return Promise.resolve({\n        successful: 0,\n        failed: 0,\n        total: 0,\n        disabled: true,\n        message: 'Sync is disabled'\n      });\n    }\n\n    if (this.state.syncing) {\n      return this.state.syncPromise;\n    }\n\n    if (!navigator.onLine) {\n      return Promise.resolve({\n        successful: 0,\n        failed: 0,\n        total: 0,\n        offline: true\n      });\n    }\n\n    this.state.syncing = true;\n    EventManager.emit('sync:started');\n\n    this.state.syncPromise = new Promise(async (resolve, reject) => {\n      try {\n        const pendingOps = await this.storageManager.getAll(\n          this.config.pendingOperationsStore,\n          {\n            index: 'priority',\n            direction: 'asc'\n          }\n        );\n\n        if (pendingOps.length === 0) {\n          this.state.syncing = false;\n          const result = {\n            successful: 0,\n            failed: 0,\n            total: 0,\n            timestamp: Date.now()\n          };\n          this.state.lastSyncTime = Date.now();\n          EventManager.emit('sync:completed', result);\n          if (typeof this.config.onSyncComplete === 'function') {\n            this.config.onSyncComplete(result);\n          }\n          resolve(result);\n          return;\n        }\n\n        let successful = 0;\n        let failed = 0;\n        this.state.operationsProcessed = 0;\n        this.state.syncQueue = [...pendingOps];\n        this.state.failedOperations = [];\n\n        const workers = Array(this.config.concurrentRequests).fill(null).map(() =>\n          this.processOperationsWorker()\n        );\n\n        await Promise.all(workers);\n\n        successful = this.state.operationsProcessed;\n        failed = this.state.failedOperations.length;\n\n        this.state.lastSyncTime = Date.now();\n\n        const result = {\n          successful,\n          failed,\n          total: pendingOps.length,\n          timestamp: Date.now()\n        };\n\n        EventManager.emit('sync:completed', result);\n\n        if (typeof this.config.onSyncComplete === 'function') {\n          this.config.onSyncComplete(result);\n        }\n\n        resolve(result);\n      } catch (error) {\n        EventManager.emit('sync:error', {error});\n\n        if (typeof this.config.onSyncError === 'function') {\n          this.config.onSyncError(error);\n        }\n\n        if (window.ErrorManager) {\n          ErrorManager.handle(error, {\n            context: 'SyncManager.syncAll',\n            type: 'sync:error'\n          });\n        }\n\n        reject(error);\n      } finally {\n        this.state.syncing = false;\n      }\n    });\n\n    return this.state.syncPromise;\n  },\n\n  /**\n   * Worker function to process operations in parallel\n   * @returns {Promise<void>}\n   * @private\n   */\n  async processOperationsWorker() {\n    while (this.state.syncQueue.length > 0) {\n      const operation = this.state.syncQueue.shift();\n\n      if (operation.nextRetry && operation.nextRetry > Date.now()) {\n        this.state.syncQueue.push(operation);\n        await new Promise(resolve => setTimeout(resolve, 100));\n        continue;\n      }\n\n      try {\n        await this.processOperation(operation);\n        this.state.operationsProcessed++;\n      } catch (error) {\n        this.state.failedOperations.push({\n          operation,\n          error: {\n            message: error.message,\n            status: error.status || 0,\n            timestamp: Date.now()\n          }\n        });\n      }\n    }\n  },\n\n  /**\n   * Process a single operation\n   * @param {Object} operation - The operation to process\n   * @returns {Promise<void>}\n   * @private\n   */\n  async processOperation(operation) {\n    try {\n      const endpoint = this.getEndpoint(operation.storeName);\n      if (!endpoint) {\n        throw new Error(`No endpoint configured for store: ${operation.storeName}`);\n      }\n\n      let apiMethod;\n      switch (operation.operation) {\n        case 'add':\n          apiMethod = 'post';\n          break;\n        case 'update':\n          apiMethod = 'put';\n          break;\n        case 'delete':\n          apiMethod = 'delete';\n          break;\n        default:\n          apiMethod = 'post';\n      }\n\n      this.state.activeRequests++;\n\n      const apiService = window.Now?.getManager('api');\n      const httpClient = window.http;\n\n      const headers = {...this.config.defaultHeaders};\n\n      if (this.config.tokens.enabled) {\n        const storage = this.config.tokens.storage === 'sessionStorage' ?\n          sessionStorage : localStorage;\n        const token = storage.getItem(this.config.tokens.tokenKey);\n        if (token) {\n          headers[this.config.tokens.headerName] = `${this.config.tokens.prefix}${token}`;\n        }\n      }\n\n      let response;\n      if (apiService) {\n        response = await apiService[apiMethod](endpoint, operation.data);\n      } else if (httpClient) {\n        response = await httpClient[apiMethod](endpoint, operation.data, {headers});\n      } else if (window.simpleFetch && typeof window.simpleFetch[apiMethod] === 'function') {\n        if (apiMethod === 'delete') {\n          response = await window.simpleFetch.delete(endpoint, {headers});\n        } else {\n          response = await window.simpleFetch[apiMethod](endpoint, operation.data, {headers});\n        }\n      } else {\n        throw new Error('No HTTP client available');\n      }\n\n      await this.storageManager.delete(this.config.pendingOperationsStore, operation.id);\n\n      this.state.activeRequests--;\n\n      EventManager.emit('sync:operation:success', {\n        operation,\n        response\n      });\n\n      return response;\n    } catch (error) {\n      this.state.activeRequests--;\n      return this.handleSyncError(operation, error);\n    }\n  },\n\n  /**\n   * Handle synchronization errors\n   * @param {Object} operation - The operation that failed\n   * @param {Error} error - The error object\n   * @returns {Promise<void>}\n   * @private\n   */\n  async handleSyncError(operation, error) {\n    operation.attempts += 1;\n    operation.lastError = {\n      message: error.message || 'Unknown error',\n      status: error.status || 0,\n      timestamp: Date.now()\n    };\n\n    if (operation.attempts < this.config.maxRetries) {\n      let delay = this.config.minRetryDelay;\n\n      if (this.config.retryStrategy === 'exponential') {\n        delay = Math.min(\n          Math.pow(2, operation.attempts) * this.config.minRetryDelay,\n          this.config.maxRetryDelay\n        );\n      } else if (this.config.retryStrategy === 'linear') {\n        delay = Math.min(\n          operation.attempts * this.config.minRetryDelay,\n          this.config.maxRetryDelay\n        );\n      }\n\n      operation.nextRetry = Date.now() + delay;\n      operation.status = 'pending';\n\n      await this.storageManager.update(\n        this.config.pendingOperationsStore,\n        operation\n      );\n\n      EventManager.emit('sync:operation:retry', {\n        operation,\n        error: operation.lastError,\n        nextRetry: new Date(operation.nextRetry)\n      });\n    } else {\n      operation.status = 'failed';\n      await this.storageManager.update(\n        this.config.pendingOperationsStore,\n        operation\n      );\n\n      EventManager.emit('sync:operation:failed', {\n        operation,\n        error: operation.lastError\n      });\n    }\n\n    throw error;\n  },\n\n  /**\n   * Handle device coming online\n   */\n  handleOnline() {\n    this.state.online = true;\n\n    EventManager.emit('sync:online');\n\n    if (this.config.autoSync && this.config.enabled && this.state.enabled) {\n      this.debouncedSync();\n      this.startAutoSync();\n    }\n  },\n\n  /**\n   * Handle device going offline\n   */\n  handleOffline() {\n    this.state.online = false;\n\n    EventManager.emit('sync:offline');\n\n    if (this.state.syncTimerId) {\n      clearInterval(this.state.syncTimerId);\n      this.state.syncTimerId = null;\n    }\n  },\n\n  /**\n   * Start automatic synchronization\n   */\n  startAutoSync() {\n    if (this.state.syncTimerId) {\n      clearInterval(this.state.syncTimerId);\n    }\n\n    this.state.syncTimerId = setInterval(() => {\n      if (navigator.onLine && !this.state.syncing && this.config.enabled && this.state.enabled) {\n        this.syncAll();\n      }\n    }, this.config.syncInterval);\n  },\n\n  /**\n   * Stop automatic synchronization\n   */\n  stopAutoSync() {\n    if (this.state.syncTimerId) {\n      clearInterval(this.state.syncTimerId);\n      this.state.syncTimerId = null;\n    }\n  },\n\n  /**\n   * Get endpoint for a store\n   * @param {string} storeName - The store name\n   * @returns {string} The endpoint URL\n   */\n  getEndpoint(storeName) {\n    if (this.config.endpoints[storeName]) {\n      return this.config.endpoints[storeName];\n    }\n    return `api/${storeName}`;\n  },\n\n  /**\n   * Get all failed operations\n   * @returns {Promise<Array>} - Failed operations\n   */\n  async getFailedOperations() {\n    return this.storageManager.query(\n      this.config.pendingOperationsStore,\n      {\n        index: 'status',\n        value: 'failed'\n      }\n    );\n  },\n\n  /**\n   * Get count of pending operations\n   * @returns {Promise<number>} - Count of pending operations\n   */\n  async getPendingCount() {\n    return this.storageManager.count(this.config.pendingOperationsStore);\n  },\n\n  /**\n   * Get all pending operations\n   * @returns {Promise<Array>} - All pending operations\n   */\n  async getPendingOperations() {\n    return this.storageManager.getAll(this.config.pendingOperationsStore);\n  },\n\n  /**\n   * Reset failed operations to pending\n   * @returns {Promise<number>} - Number of operations reset\n   */\n  async resetFailedOperations() {\n    const failed = await this.getFailedOperations();\n\n    for (const op of failed) {\n      op.attempts = 0;\n      op.status = 'pending';\n      op.nextRetry = Date.now();\n      delete op.lastError;\n      await this.storageManager.update(\n        this.config.pendingOperationsStore,\n        op\n      );\n    }\n\n    if (navigator.onLine && failed.length > 0 && this.config.enabled && this.state.enabled) {\n      this.debouncedSync();\n    }\n\n    return failed.length;\n  },\n\n  /**\n   * Clear all pending operations\n   * @returns {Promise<boolean>} - Success status\n   */\n  async clearPendingOperations() {\n    await this.storageManager.clear(this.config.pendingOperationsStore);\n\n    EventManager.emit('sync:cleared');\n\n    return true;\n  },\n\n  /**\n   * Delete a specific pending operation\n   * @param {number} id - Operation ID\n   * @returns {Promise<boolean>} - Success status\n   */\n  async deletePendingOperation(id) {\n    await this.storageManager.delete(this.config.pendingOperationsStore, id);\n\n    EventManager.emit('sync:operation:deleted', {id});\n\n    return true;\n  },\n\n  /**\n   * Manually update an operation\n   * @param {Object} operation - The operation to update\n   * @returns {Promise<boolean>} - Success status\n   */\n  async updateOperation(operation) {\n    await this.storageManager.update(\n      this.config.pendingOperationsStore,\n      operation\n    );\n\n    EventManager.emit('sync:operation:updated', {operation});\n\n    return true;\n  },\n\n  /**\n   * Get sync status\n   * @returns {Object} - Current sync status information\n   */\n  getSyncStatus() {\n    return {\n      enabled: this.config.enabled && this.state.enabled,\n      online: this.state.online,\n      syncing: this.state.syncing,\n      lastSyncTime: this.state.lastSyncTime,\n      activeRequests: this.state.activeRequests,\n      autoSyncEnabled: this.config.autoSync && this.state.syncTimerId !== null\n    };\n  },\n\n  /**\n   * Clean up resources\n   */\n  destroy() {\n    if (this.state.syncTimerId) {\n      clearInterval(this.state.syncTimerId);\n      this.state.syncTimerId = null;\n    }\n\n    if (this.state.debounceTimer) {\n      clearTimeout(this.state.debounceTimer);\n      this.state.debounceTimer = null;\n    }\n\n    window.removeEventListener('online', this.handleOnline);\n    window.removeEventListener('offline', this.handleOffline);\n\n    this.state = {\n      initialized: false,\n      enabled: false,\n      online: navigator.onLine,\n      syncing: false,\n      pendingSync: new Map(),\n      lastSyncTime: null,\n      syncTimerId: null,\n      syncPromise: null,\n      debounceTimer: null,\n      activeRequests: 0,\n      operationsProcessed: 0,\n      syncQueue: [],\n      failedOperations: []\n    };\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('sync', SyncManager);\n}\n\nwindow.SyncManager = SyncManager;\n","/**\n * TokenService - Handles JWT token operations\n *\n * This service manages token parsing, validation and extraction of user information\n */\nclass TokenService {\n  constructor(options = {}) {\n    this.options = {\n      storageMethod: 'cookie', // 'cookie', 'localStorage'\n      cookieName: 'auth_token',\n      refreshCookieName: 'refresh_token',\n      localStorageKey: 'auth',\n      cookieOptions: {\n        path: '/',\n        secure: location.protocol === 'https:',\n        sameSite: 'Lax'\n      },\n      ...options\n    };\n  }\n\n  /**\n   * Parse JWT token to extract payload\n   * @param {string} token - JWT token\n   * @returns {Object|null} Decoded token payload or null if invalid\n   */\n  parseToken(token) {\n    try {\n      if (!token || typeof token !== 'string' || !token.includes('.')) {\n        return null;\n      }\n\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        return null;\n      }\n\n      const payload = parts[1];\n      const decoded = this._base64UrlDecode(payload);\n\n      return JSON.parse(decoded);\n    } catch (e) {\n      console.error('Error parsing token:', e);\n      return null;\n    }\n  }\n\n  /**\n   * Check if token is expired\n   * @param {string} token - JWT token\n   * @returns {boolean} True if expired, false if valid\n   */\n  isTokenExpired(token) {\n    const payload = this.parseToken(token);\n    if (!payload || !payload.exp) {\n      return true;\n    }\n\n    const now = Math.floor(Date.now() / 1000);\n    return now >= payload.exp;\n  }\n\n  /**\n   * Get token expiration timestamp\n   * @param {string} token - JWT token\n   * @returns {number|null} Expiration timestamp in seconds or null\n   */\n  getTokenExpiry(token) {\n    const payload = this.parseToken(token);\n    return payload?.exp || null;\n  }\n\n  /**\n   * Extract user ID from token\n   * @param {string} token - JWT token\n   * @returns {string|number|null} User ID or null\n   */\n  getUserId(token) {\n    const payload = this.parseToken(token);\n    // JWT typically uses 'sub' for subject (user ID)\n    return payload?.sub || payload?.id || null;\n  }\n\n  /**\n   * Extract user roles from token\n   * @param {string} token - JWT token\n   * @returns {Array} Array of roles or empty array\n   */\n  getUserRoles(token) {\n    const payload = this.parseToken(token);\n    return payload?.roles || [];\n  }\n\n  /**\n   * Base64Url decode helper\n   * @private\n   * @param {string} input - Base64Url encoded string\n   * @returns {string} Decoded string\n   */\n  _base64UrlDecode(input) {\n    // Convert base64url to standard base64\n    let base64 = input.replace(/-/g, '+').replace(/_/g, '/');\n\n    // Add padding if needed\n    while (base64.length % 4) {\n      base64 += '=';\n    }\n\n    return decodeURIComponent(Array.prototype.map.call(atob(base64), (c) => {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n  }\n\n  /**\n   * Get token from storage (uses httpOnly cookies by default)\n   * @returns {string|null} Token if found, null otherwise\n   */\n  getToken() {\n    // Note: HttpOnly cookies are not accessible via JS\n    // This method will return null for httpOnly cookies\n    // The server must send the token in a response header for validation\n\n    if (this.options.storageMethod === 'localStorage') {\n      try {\n        const stored = localStorage.getItem(this.options.localStorageKey);\n        if (stored) {\n          const data = JSON.parse(stored);\n          return data.token || null;\n        }\n      } catch (e) {\n        console.error('Error retrieving token from localStorage:', e);\n      }\n    }\n\n    return null; // For httpOnly cookies, this will always return null\n  }\n\n  /**\n   * Store token in the configured storage method\n   * @param {string} token - Token to store\n   * @param {Object} additionalData - Additional data to store with token (user, etc.)\n   * @returns {boolean} True if stored successfully, false otherwise\n   */\n  store(token, additionalData = {}) {\n    try {\n      if (this.options.storageMethod === 'localStorage') {\n        const tokenData = {\n          token: token,\n          timestamp: Date.now(),\n          ...additionalData\n        };\n        localStorage.setItem(this.options.localStorageKey, JSON.stringify(tokenData));\n\n        return true;\n      } else if (this.options.storageMethod === 'cookie') {\n        // Store as cookie (non-httpOnly for JS access)\n        const cookieOptions = {\n          ...(this.options.cookieOptions || {}),\n          ...(additionalData?.cookieOptions || {})\n        };\n        this.setCookie(this.options.cookieName, token, cookieOptions);\n        return true;\n      }\n    } catch (e) {\n      console.error('Error storing token:', e);\n    }\n    return false;\n  }\n\n  /**\n   * Set a cookie\n   * @param {string} name - Cookie name\n   * @param {string} value - Cookie value\n   * @param {Object} options - Cookie options\n   */\n  setCookie(name, value, options = {}) {\n    if (!name || typeof name !== 'string') {\n      return;\n    }\n\n    // Don't encode cookie name or JWT token value (base64url is already safe)\n    let cookieString = `${name}=${value == null ? '' : value}`;\n\n    if (options.path) cookieString += `; Path=${options.path}`;\n    if (options.secure) cookieString += `; Secure`;\n    if (options.sameSite) cookieString += `; SameSite=${options.sameSite}`;\n    if (typeof options.maxAge === 'number') cookieString += `; Max-Age=${options.maxAge}`;\n    if (options.expires instanceof Date) cookieString += `; Expires=${options.expires.toUTCString()}`;\n\n    document.cookie = cookieString;\n  }\n\n  /**\n   * Get a cookie value\n   * @param {string} name - Cookie name\n   * @returns {string|null} Cookie value or null if not found\n   */\n  getCookie(name) {\n    const cookies = document.cookie.split(';');\n    for (let cookie of cookies) {\n      const [cookieName, cookieValue] = cookie.trim().split('=');\n      if (cookieName === name) {\n        // Don't decode since we're not encoding JWT tokens anymore\n        return cookieValue;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Remove token from storage\n   * @returns {boolean} True if removed successfully\n   */\n  remove() {\n    try {\n      if (this.options.storageMethod === 'localStorage') {\n        localStorage.removeItem(this.options.localStorageKey);\n        return true;\n      } else if (this.options.storageMethod === 'cookie') {\n        const clearOptions = {\n          ...(this.options.cookieOptions || {}),\n          maxAge: 0\n        };\n        this.setCookie(this.options.cookieName, '', clearOptions);\n        return true;\n      }\n    } catch (e) {\n      console.error('Error removing token:', e);\n    }\n    return false;\n  }\n\n  /**\n   * Clear all stored authentication data\n   * @returns {boolean} True if cleared successfully\n   */\n  clear() {\n    try {\n      // Clear from localStorage\n      localStorage.removeItem(this.options.localStorageKey);\n      localStorage.removeItem('auth_user');\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n\n      // Clear cookies\n      const clearOptions = {\n        ...(this.options.cookieOptions || {}),\n        maxAge: 0\n      };\n\n      // Only clear cookies if names are defined\n      if (this.options.cookieName) {\n        this.setCookie(this.options.cookieName, '', clearOptions);\n      }\n      if (this.options.refreshCookieName) {\n        this.setCookie(this.options.refreshCookieName, '', clearOptions);\n      }\n\n      return true;\n    } catch (e) {\n      console.error('Error clearing authentication data:', e);\n    }\n    return false;\n  }\n\n  /**\n   * Get stored user data\n   * @returns {Object|null} User data or null if not found\n   */\n  getUser() {\n    try {\n      if (this.options.storageMethod === 'localStorage') {\n        const stored = localStorage.getItem(this.options.localStorageKey);\n        if (stored) {\n          const data = JSON.parse(stored);\n          return data.user || null;\n        }\n      }\n    } catch (e) {\n      console.error('Error retrieving user data:', e);\n    }\n    return null;\n  }\n\n  /**\n   * Check if user is authenticated (has valid token)\n   * @returns {boolean} True if authenticated\n   */\n  isAuthenticated() {\n    const token = this.getToken();\n    if (!token) return false;\n\n    // Check if token is expired\n    if (this.isTokenExpired(token)) {\n      this.remove(); // Clear expired token\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get token alias for backward compatibility\n   * @returns {string|null} Token if found, null otherwise\n   */\n  get() {\n    return this.getToken();\n  }\n}\n\n// Export for module use\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = TokenService;\n}\n\n// Expose globally\nwindow.TokenService = TokenService;\n\n// Create default instance\nwindow.tokenService = new TokenService();\n","/**\n * AuthManager - Central authentication manager\n * Handles login/logout flows, token refresh, user session state, and security integration.\n */\nconst AuthManager = {\n  // --- Configuration ------------------------------------------------------\n  config: {\n    enabled: false,\n    type: 'jwt-httponly',\n    autoInit: true,\n\n    endpoints: {\n      login: 'api/v1/auth/login',\n      logout: 'api/v1/auth/logout',\n      verify: 'api/v1/auth/verify',\n      refresh: 'api/v1/auth/refresh',\n      me: 'api/v1/auth/me',\n      social: 'api/v1/auth/social/{provider}',\n      callback: 'api/v1/auth/callback'\n    },\n\n    security: {\n      csrf: true,\n      csrfIncludeSafeMethods: true,\n      rateLimiting: true,\n      maxLoginAttempts: 5,\n      lockoutTime: 30 * 60 * 1000, // 30 minutes\n      autoRefresh: true,\n      refreshBeforeExpiry: 5 * 60 * 1000, // 5 minutes\n      clearAllCachesOnLogout: true // Clear all caches when logging out.\n    },\n\n    redirects: {\n      afterLogin: '/',\n      afterLogout: '/login',\n      unauthorized: '/login',\n      forbidden: '/403'\n    },\n\n    token: {\n      headerName: 'Authorization',\n      cookieName: 'auth_token',\n      refreshCookieName: 'refresh_token',\n      storageKey: 'auth_user',\n      cookieOptions: {\n        path: '/',\n        secure: (typeof window !== 'undefined') ? window.location.protocol === 'https:' : false,\n        sameSite: 'Strict'\n      },\n      cookieMaxAge: null\n    }\n  },\n\n  // --- Runtime state -----------------------------------------------------\n  state: {\n    initialized: false,\n    authenticated: false,\n    user: null,\n    loading: false,\n    error: null,\n    loginAttempts: 0,\n    lockedUntil: null,\n    refreshTimer: null\n  },\n\n  tokenService: null,\n  rateLimitData: new Map(),\n\n  ensureTokenService(force = false) {\n    if (!this.config?.token) {\n      this.config.token = {\n        cookieName: 'auth_token',\n        refreshCookieName: 'refresh_token'\n      };\n    }\n\n    if (!this.tokenService || force) {\n      const baseCookieOptions = {\n        path: '/',\n        secure: (typeof window !== 'undefined') ? (window.location.protocol === 'https:' && !window.location.hostname.includes('localhost')) : false,\n        sameSite: 'Lax',\n        ...(this.config.token.cookieOptions || {})\n      };\n\n      this.tokenService = new TokenService({\n        storageMethod: 'cookie',\n        cookieName: this.config.token.cookieName,\n        refreshCookieName: this.config.token.refreshCookieName,\n        cookieOptions: baseCookieOptions,\n        debug: true\n      });\n    }\n\n    return this.tokenService;\n  },\n\n  buildTokenCookieOptions(token) {\n    const cookieOptions = {\n      path: '/',\n      secure: (typeof window !== 'undefined') ? (window.location.protocol === 'https:' && !window.location.hostname.includes('localhost')) : false,\n      sameSite: 'Lax',\n      ...(this.config.token.cookieOptions || {})\n    };\n\n    const configuredMaxAge = this.config.token.cookieMaxAge;\n    let maxAge = (typeof configuredMaxAge === 'number' && configuredMaxAge > 0) ? configuredMaxAge : null;\n\n    try {\n      const service = this.ensureTokenService();\n      if (!maxAge && token && typeof service?.getTokenExpiry === 'function') {\n        const expiry = service.getTokenExpiry(token);\n        if (expiry) {\n          const secondsRemaining = expiry - Math.floor(Date.now() / 1000);\n          if (secondsRemaining > 0) {\n            maxAge = secondsRemaining;\n          }\n        }\n      }\n    } catch (err) {\n      console.warn('Failed to derive cookie maxAge from token expiry', err);\n    }\n\n    if (maxAge) {\n      cookieOptions.maxAge = Math.max(1, Math.floor(maxAge));\n    } else if ('maxAge' in cookieOptions && (cookieOptions.maxAge === null || cookieOptions.maxAge === undefined)) {\n      delete cookieOptions.maxAge;\n    }\n\n    return cookieOptions;\n  },\n\n  rehydrateAccessToken() {\n    try {\n      const tokenService = this.ensureTokenService();\n      const cookieName = this.config.token.cookieName;\n\n      let token = null;\n\n      if (tokenService?.getCookie) {\n        token = tokenService.getCookie(cookieName);\n      }\n\n      if (!token) {\n        if (typeof ApiService?.clearAccessToken === 'function') {\n          ApiService.clearAccessToken();\n        }\n        return null;\n      }\n\n      // Check if token is expired\n      if (typeof tokenService?.isTokenExpired === 'function') {\n        if (tokenService.isTokenExpired(token)) {\n          tokenService.remove?.();\n          if (typeof ApiService?.clearAccessToken === 'function') {\n            ApiService.clearAccessToken();\n          }\n          return null;\n        }\n      }\n\n      if (typeof ApiService?.setAccessToken === 'function') {\n        ApiService.setAccessToken(token);\n      }\n\n      return token;\n    } catch (error) {\n      console.error('AuthManager: Failed to rehydrate access token', error);\n      return null;\n    }\n  },\n\n  // --- Token helpers ----------------------------------------------------\n  getAuthStrategy() {\n    const strategy = ApiService?.config?.security?.authStrategy\n      || this.config?.security?.authStrategy\n      || this.config?.type;\n    if (!strategy) {\n      return 'hybrid';\n    }\n    if (['hybrid', 'storage', 'cookie'].includes(strategy)) {\n      return strategy;\n    }\n    // Map legacy type names to strategies\n    if (strategy === 'jwt-httponly') {\n      return 'hybrid';\n    }\n    return 'hybrid';\n  },\n\n  resolveTokenFromData(data) {\n    if (!data || typeof data !== 'object') {\n      return null;\n    }\n\n    // Only support data.token - no fallbacks\n    if (data.data && typeof data.data === 'object' && data.data.token) {\n      return data.data.token;\n    }\n\n    if (data.token) {\n      return data.token;\n    }\n\n    console.warn('AuthManager: No token found in response data');\n    return null;\n  },\n\n  resolveUserFromData(data) {\n    if (!data || typeof data !== 'object') {\n      return null;\n    }\n\n    // Support multiple data structures\n    if (data.data && typeof data.data === 'object') {\n      // Check for data.data.user first\n      if (data.data.user && typeof data.data.user === 'object') {\n        return data.data.user;\n      }\n      // Check if data.data itself contains user fields (id, username, name)\n      if (data.data.id && data.data.username) {\n        return data.data;\n      }\n    }\n\n    if (data.user && typeof data.user === 'object') {\n      return data.user;\n    }\n\n    console.warn('AuthManager: No user found in response data');\n    return null;\n  },\n\n  extractTokenFromHeaders(headers = {}) {\n    if (!headers || typeof headers !== 'object') {\n      return null;\n    }\n\n    const authorization = headers.authorization || headers.Authorization;\n    if (authorization) {\n      const parts = authorization.split(' ');\n      if (parts.length === 2 && /^Bearer$/i.test(parts[0])) {\n        return parts[1].trim();\n      }\n      return authorization.trim();\n    }\n\n    return headers['x-access-token']\n      || headers['X-Access-Token']\n      || headers['access-token']\n      || headers['x-token']\n      || headers['X-Token']\n      || null;\n  },\n\n  /**\n   * Try to read a stored refresh token from TokenService (cookie/localStorage)\n   * Returns the token string or null when not available.\n   */\n  getRefreshToken() {\n    try {\n      const service = this.ensureTokenService();\n      const cookieName = (this.config && this.config.token && this.config.token.refreshCookieName)\n        || (service && service.options && service.options.refreshCookieName)\n        || 'refresh_token';\n\n      if (service && typeof service.getCookie === 'function') {\n        const val = service.getCookie(cookieName);\n        if (val) return val;\n      }\n\n      // fallback: try common localStorage keys\n      if (service && service.options && service.options.storageMethod === 'localStorage') {\n        try {\n          const stored = localStorage.getItem(service.options.localStorageKey || 'auth');\n          if (stored) {\n            const parsed = JSON.parse(stored);\n            if (parsed && parsed.refresh_token) return parsed.refresh_token;\n          }\n        } catch (e) {\n          // ignore\n        }\n      }\n    } catch (e) {\n      console.warn('getRefreshToken failed:', e && e.message ? e.message : e);\n    }\n    return null;\n  },\n\n  buildRefreshRequestOptions() {\n    const includeCreds = (ApiService?.config?.security?.sendCredentials) ? 'include' : 'same-origin';\n    const options = {\n      throwOnError: false,\n      credentials: includeCreds\n    };\n\n    try {\n      const csrfToken = this.getCSRFToken?.();\n      if (csrfToken) {\n        options.headers = {\n          ...(options.headers || {}),\n          'X-CSRF-TOKEN': csrfToken\n        };\n      }\n    } catch (e) {\n      console.warn('Failed to attach CSRF token to refresh request', e);\n    }\n\n    return options;\n  },\n\n  async fetchAccessToken(options = {}) {\n    const {\n      fallbackUser = null,\n      preferRefresh = true,\n      preferVerifyFallback = true\n    } = options;\n\n    const attempts = [];\n    const includeCreds = ApiService?.config?.security?.sendCredentials ? 'include' : 'same-origin';\n\n    if (preferRefresh && this.config.endpoints?.refresh) {\n      attempts.push(async () => {\n        const refreshToken = this.getRefreshToken();\n        const payload = refreshToken ? {refresh_token: refreshToken} : null;\n        const response = await simpleFetch.post(\n          this.config.endpoints.refresh,\n          payload,\n          this.buildRefreshRequestOptions()\n        );\n\n        if (response?.success && response.data?.success) {\n          const tokenFromData = this.resolveTokenFromData(response.data);\n          const tokenFromHeaders = this.extractTokenFromHeaders(response.headers);\n          const token = tokenFromData || tokenFromHeaders;\n          if (token) {\n            const user = this.resolveUserFromData(response.data) || fallbackUser;\n            return {token, user};\n          }\n        }\n\n        return null;\n      });\n    }\n\n    if (preferVerifyFallback && this.config.endpoints?.verify) {\n      attempts.push(async () => {\n        const response = await simpleFetch.get(this.config.endpoints.verify, {\n          throwOnError: false,\n          credentials: includeCreds\n        });\n\n        if (response?.success && response.data?.success) {\n          const tokenFromData = this.resolveTokenFromData(response.data);\n          const tokenFromHeaders = this.extractTokenFromHeaders(response.headers);\n          const token = tokenFromData || tokenFromHeaders;\n          if (token) {\n            const user = this.resolveUserFromData(response.data) || fallbackUser;\n            return {token, user};\n          }\n        }\n\n        return null;\n      });\n    }\n\n    for (const attempt of attempts) {\n      try {\n        const result = await attempt();\n        if (result?.token) {\n          return result;\n        }\n      } catch (error) {\n        console.warn('Token fetch attempt failed:', error);\n      }\n    }\n\n    return null;\n  },\n\n  async ensureAccessToken(tokenCandidate, options = {}) {\n    const {user = null} = options;\n\n    if (!tokenCandidate) {\n      throw new Error('No access token provided - authentication required');\n    }\n\n    // Set in ApiService memory for immediate use\n    if (typeof ApiService?.setAccessToken === 'function') {\n      ApiService.setAccessToken(tokenCandidate)\n    }\n\n    // Store in cookie for persistence across reloads\n    try {\n      const tokenService = this.ensureTokenService();\n      if (tokenService) {\n        const cookieOptions = this.buildTokenCookieOptions(tokenCandidate);\n        const success = tokenService.store(tokenCandidate, {\n          user: user || this.state.user,\n          timestamp: Date.now(),\n          cookieOptions\n        });\n\n        if (!success) {\n          console.warn('AuthManager: Failed to store token in cookie');\n        }\n      }\n    } catch (err) {\n      console.error('AuthManager: TokenService failed to store token', err);\n    }\n\n    return tokenCandidate;\n  },\n\n  // --- Lifecycle ---------------------------------------------------------\n  isInitialized() {\n    return this.state?.initialized === true;\n  },\n\n  async init(options = {}) {\n    const sharedAuthConfig = (window.Now && Now.DEFAULT_CONFIG && Now.DEFAULT_CONFIG.auth) ? Now.DEFAULT_CONFIG.auth : {};\n    const mergedEndpoints = {\n      ...(this.config.endpoints || {}),\n      ...(sharedAuthConfig.endpoints || {}),\n      ...(options.endpoints || {})\n    };\n\n    this.config = {\n      ...this.config,\n      ...sharedAuthConfig,\n      ...options,\n      endpoints: mergedEndpoints\n    };\n\n    if (!this.config.enabled) {\n      this.state.initialized = false;\n      this.state.loading = false;\n      return this;\n    }\n\n    // TokenService stores refresh tokens (cookies). Access tokens stay in memory via ApiService for hybrid flow.\n    this.ensureTokenService(true);\n\n    // Attempt to restore any previously stored access token before running auth checks\n    this.rehydrateAccessToken();\n\n    // Ensure ApiService will send Authorization headers\n    if (window.ApiService && typeof ApiService.config === 'object') {\n      ApiService.config.security = ApiService.config.security || {};\n      ApiService.config.security.bearerAuth = true;\n      ApiService.config.security.authStrategy = 'hybrid';\n    }\n\n    if (window.SecurityManager) {\n      this.setupSecurityIntegration();\n    }\n\n    try {\n      this.state.loading = true;\n      this.state.error = null;\n\n      this.setupHttpInterceptors();\n      this.setupRateLimiting();\n\n      await this.checkAuthStatus();\n\n      if (this.config.security.autoRefresh) {\n        this.setupAutoRefresh();\n      }\n\n      this.state.initialized = true;\n      this.emit('auth:initialized', {\n        authenticated: this.state.authenticated,\n        user: this.state.user\n      });\n\n      return this;\n    } catch (error) {\n      this.state.error = error;\n      this.handleError('Auth initialization failed', error);\n      throw error;\n    } finally {\n      this.state.loading = false;\n    }\n  },\n\n  // --- HTTP integration --------------------------------------------------\n  setupHttpInterceptors() {\n    if (!window.http || !window.http.addRequestInterceptor) {\n      return;\n    }\n\n    http.addRequestInterceptor(async (config) => {\n      if (!this.config.security.csrf) {\n        return config;\n      }\n\n      const method = (config.method || 'GET').toUpperCase();\n      const safeMethods = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];\n      const includeSafe = this.config.security.csrfIncludeSafeMethods !== false;\n      const needsToken = includeSafe || !safeMethods.includes(method);\n\n      if (needsToken) {\n        const csrfToken = this.getCSRFToken();\n        if (csrfToken) {\n          const isHeadersInstance = (typeof Headers !== 'undefined') && (config.headers instanceof Headers);\n          const existingHeaders = isHeadersInstance ? Object.fromEntries(config.headers.entries()) : (config.headers || {});\n          config.headers = {\n            ...existingHeaders,\n            'X-CSRF-Token': csrfToken\n          };\n        }\n      }\n\n      return config;\n    });\n\n    http.addResponseInterceptor(\n      (response) => {\n        const newCsrfToken = response.headers?.['X-CSRF-Token'] || response.headers?.get?.('X-CSRF-Token');\n        if (newCsrfToken) {\n          this.updateCSRFToken(newCsrfToken);\n        }\n        return response;\n      },\n      async (error) => {\n        const originalRequest = error.config;\n\n        if (error.status === 401 && !originalRequest?._retry) {\n          if (originalRequest) {\n            originalRequest._retry = true;\n          }\n\n          if (this.config.security.autoRefresh) {\n            const refreshed = await this.refreshToken();\n            if (refreshed && originalRequest) {\n              return http.request(originalRequest.url, originalRequest);\n            }\n          }\n\n          await this.logout(false);\n          this.redirectTo(this.config.redirects.unauthorized);\n        }\n\n        if (error.status === 403) {\n          this.redirectTo(this.config.redirects.forbidden);\n        }\n\n        throw error;\n      }\n    );\n  },\n\n  setupRateLimiting() {\n    if (!this.config.security.rateLimiting) {\n      return;\n    }\n\n    setInterval(() => {\n      const now = Date.now();\n      for (const [key, data] of this.rateLimitData.entries()) {\n        if (now > data.resetTime) {\n          this.rateLimitData.delete(key);\n        }\n      }\n    }, 60000);\n  },\n\n  checkRateLimit(identifier = 'global') {\n    if (!this.config.security.rateLimiting) {\n      return true;\n    }\n\n    const now = Date.now();\n    const data = this.rateLimitData.get(identifier) || {\n      attempts: 0,\n      resetTime: now + 60000\n    };\n\n    if (data.attempts >= this.config.security.maxLoginAttempts) {\n      const timeLeft = data.resetTime - now;\n      if (timeLeft > 0) {\n        throw new Error(`Too many login attempts. Try again in ${Math.ceil(timeLeft / 1000)} seconds.`);\n      }\n      data.attempts = 0;\n      data.resetTime = now + 60000;\n    }\n\n    return true;\n  },\n\n  recordLoginAttempt(identifier = 'global', success = false) {\n    if (!this.config.security.rateLimiting) {\n      return;\n    }\n\n    const now = Date.now();\n    const data = this.rateLimitData.get(identifier) || {\n      attempts: 0,\n      resetTime: now + 60000\n    };\n\n    if (success) {\n      this.rateLimitData.delete(identifier);\n    } else {\n      data.attempts += 1;\n      data.resetTime = now + 60000;\n      this.rateLimitData.set(identifier, data);\n    }\n  },\n\n  // --- Authentication state ---------------------------------------------\n  async checkAuthStatus() {\n    try {\n      // Always rehydrate token before checking\n      const rehydratedToken = this.rehydrateAccessToken();\n\n      const includeCreds = (window.ApiService && ApiService.config?.security?.sendCredentials)\n        ? 'include'\n        : 'same-origin';\n\n      const response = await simpleFetch.get(this.config.endpoints.verify, {\n        throwOnError: false,\n        credentials: includeCreds\n      });\n\n      if (response?.success && response.data?.success) {\n        const resolvedUser = this.resolveUserFromData(response.data);\n\n        if (!resolvedUser) {\n          throw new Error('No user data in verify response');\n        }\n\n        this.state.authenticated = true;\n        this.state.user = resolvedUser;\n\n        // Store user data\n        if (this.state.user) {\n          try {\n            localStorage.setItem(\n              this.config.token.storageKey,\n              JSON.stringify({\n                ...this.state.user,\n                timestamp: Date.now()\n              })\n            );\n          } catch (e) {\n            console.warn('AuthManager: Failed to persist authenticated user', e);\n          }\n        }\n\n        return {\n          authenticated: true,\n          user: this.state.user,\n          token: rehydratedToken\n        };\n      }\n\n      this.clearAuthData();\n      return {\n        authenticated: false,\n        user: null,\n        error: response?.data?.message || response?.statusText || 'Authentication failed'\n      };\n    } catch (error) {\n      console.error('AuthManager: Auth check failed:', error.message);\n      this.clearAuthData();\n      return {\n        authenticated: false,\n        user: null,\n        error: error.message\n      };\n    }\n  },\n\n  clearAuthData() {\n    this.state.authenticated = false;\n    this.state.user = null;\n    try {\n      localStorage.removeItem(this.config.token.storageKey);\n    } catch (e) {\n      console.warn('Failed to clear cached user state', e);\n    }\n\n    try {\n      localStorage.removeItem('auth_token');\n    } catch (e) {\n      // Ignore storage errors\n    }\n\n    if (typeof ApiService?.clearAccessToken === 'function') {\n      ApiService.clearAccessToken();\n    }\n\n    try {\n      const tokenService = this.ensureTokenService();\n      tokenService?.clear();\n    } catch (e) {\n      console.warn('Failed to clear token service state', e);\n    }\n  },\n\n  /**\n   * Clear all caches across the application\n   * This includes API cache, storage cache, template cache, etc.\n   */\n  async clearAllCaches() {\n    try {\n      // 1. Clear API Service cache\n      if (window.ApiService && typeof ApiService.clearCache === 'function') {\n        ApiService.clearCache();\n      }\n\n      // 2. Clear StorageManager caches\n      if (window.StorageManager) {\n        // Clear localStorage\n        if (typeof StorageManager.local?.clear === 'function') {\n          StorageManager.local.clear();\n        }\n\n        // Clear sessionStorage\n        if (typeof StorageManager.session?.clear === 'function') {\n          StorageManager.session.clear();\n        }\n\n        // Clear memory cache\n        if (typeof StorageManager.memory?.clear === 'function') {\n          StorageManager.memory.clear();\n        }\n\n        // Clear StorageManager internal cache\n        if (typeof StorageManager.clearCache === 'function') {\n          StorageManager.clearCache();\n        }\n      }\n\n      // 3. Clear TemplateManager cache\n      if (window.TemplateManager && typeof TemplateManager.clearCache === 'function') {\n        TemplateManager.clearCache();\n      }\n\n      // 4. Clear ApiComponent cache\n      if (window.ApiComponent && typeof ApiComponent.clearCache === 'function') {\n        ApiComponent.clearCache();\n      }\n\n      // 5. Clear AuthGuard cache\n      if (window.RouterManager?.authGuard && typeof RouterManager.authGuard.clearCache === 'function') {\n        RouterManager.authGuard.clearCache();\n      }\n\n      // 6. Clear ServiceWorker cache\n      if (window.ServiceWorkerManager && typeof ServiceWorkerManager.clearCache === 'function') {\n        await ServiceWorkerManager.clearCache();\n      }\n\n      // 7. Clear browser caches (Cache API)\n      if (window.caches) {\n        const cacheNames = await caches.keys();\n        await Promise.all(cacheNames.map(name => caches.delete(name)));\n      }\n\n      // 8. Clear session storage completely\n      try {\n        sessionStorage.clear();\n      } catch (e) {\n        console.warn('Failed to clear sessionStorage:', e);\n      }\n\n      return true;\n    } catch (error) {\n      console.error('[AuthManager] Error clearing caches:', error);\n      return false;\n    }\n  },\n\n  async handleAuthCheckError(error) {\n    console.warn('Auth check failed:', error.message);\n    this.clearAuthData();\n    return {\n      authenticated: false,\n      user: null,\n      error: error.message\n    };\n  },\n\n  setupSecurityIntegration() {\n    document.addEventListener('jwt:refreshed', (event) => {\n      this.handleJWTRefresh?.(event.detail);\n    });\n\n    document.addEventListener('security:error', (event) => {\n      this.handleSecurityError?.(event.detail);\n    });\n  },\n\n  handleSecurityError(detail) {\n    try {\n      const info = detail || {};\n      const message = info.message || info.error || 'A security error occurred';\n\n      this.handleError('Security error', new Error(message));\n\n      if (info.status === 401 || info.code === 'unauthorized' || info.code === 'csrf_invalid') {\n        this.clearAuthData();\n        const redirectTo = this.config.redirects?.unauthorized || '/login';\n        this.redirectTo(redirectTo);\n      }\n    } catch (err) {\n      console.error('Error handling security event', err);\n    }\n  },\n\n  async authenticate(credentials, options = {}) {\n    try {\n      if (window.SecurityManager) {\n        const rateLimitResult = SecurityManager.checkRateLimit(this.config.endpoints.login);\n        if (!rateLimitResult.allowed) {\n          throw new Error(`Too many login attempts. Try again in ${rateLimitResult.retryAfter} seconds.`);\n        }\n      }\n\n      // Basic validation\n      if (!credentials.email || !credentials.password) {\n        throw new Error('Email and password are required');\n      }\n\n      if (credentials.email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(credentials.email)) {\n        throw new Error('Invalid email format');\n      }\n\n      if (credentials.password && credentials.password.length < 8) {\n        throw new Error('Password must be at least 8 characters');\n      }\n\n      this.checkRateLimit(credentials.email || credentials.username || 'global');\n\n      this.state.loading = true;\n      this.state.error = null;\n\n      const response = await simpleFetch.post(this.config.endpoints.login, credentials, {\n        throwOnError: false,\n        ...(options.fetchOptions || {})\n      });\n\n      if (response.success && response.data?.success) {\n        this.recordLoginAttempt(credentials.email || credentials.username || 'global', true);\n        const headerToken = this.extractTokenFromHeaders(response.headers);\n        const resolvedToken = this.resolveTokenFromData(response.data) || headerToken;\n        if (resolvedToken && !response.data.token) {\n          response.data.token = resolvedToken;\n        }\n        const resolvedUser = this.resolveUserFromData(response.data);\n        if (resolvedUser && !response.data.user) {\n          response.data.user = resolvedUser;\n        }\n        return response.data;\n      }\n\n      this.recordLoginAttempt(credentials.email || credentials.username || 'global', false);\n      const errorMessage = response.data?.message || response.statusText || 'Authentication failed';\n      return {\n        success: false,\n        message: errorMessage,\n        errors: response.data?.errors || {},\n        status: response.status\n      };\n    } catch (error) {\n      this.recordLoginAttempt(credentials.email || credentials.username || 'global', false);\n      return {\n        success: false,\n        message: error.message || 'Authentication failed',\n        error\n      };\n    } finally {\n      this.state.loading = false;\n    }\n  },\n\n  async setAuthenticatedUser(userData, options = {}) {\n    try {\n      const user = this.resolveUserFromData(userData);\n      const token = this.resolveTokenFromData(userData);\n\n      if (!user) {\n        throw new Error('No user data found in authentication response');\n      }\n\n      if (!token) {\n        throw new Error('No access token found in authentication response');\n      }\n\n      this.state.authenticated = true;\n      this.state.user = user;\n      this.state.error = null;\n\n      // Store token in memory and cookie\n      const ensuredToken = await this.ensureAccessToken(token, {user});\n\n      // Store user data for persistence\n      const userDataToStore = {\n        ...user,\n        timestamp: Date.now()\n      };\n\n      try {\n        localStorage.setItem(\n          this.config.token.storageKey,\n          JSON.stringify(userDataToStore)\n        );\n      } catch (e) {\n        console.warn('AuthManager: Failed to persist user profile', e);\n      }\n\n      if (this.config.security.autoRefresh) {\n        this.setupAutoRefresh();\n      }\n\n      this.emit('auth:login', {\n        user: this.state.user,\n        timestamp: Date.now()\n      });\n\n      return {\n        success: true,\n        user: this.state.user,\n        authenticated: true,\n        token: ensuredToken\n      };\n    } catch (error) {\n      console.error('AuthManager: Failed to set authenticated user:', error.message);\n      this.state.error = error;\n      return {\n        success: false,\n        message: error.message,\n        error\n      };\n    }\n  },\n\n  async login(credentials, options = {}) {\n    try {\n      const authResult = await this.authenticate(credentials, options);\n      if (!authResult.success) {\n        return authResult;\n      }\n\n      const setUserResult = await this.setAuthenticatedUser(authResult, {\n        ensureOptions: options.ensureOptions\n      });\n      if (!setUserResult.success) {\n        return setUserResult;\n      }\n\n      if (!options.preventRedirect) {\n        const redirectTo = options.redirectTo || this.getIntendedUrl() || this.config.redirects.afterLogin;\n        this.redirectTo(redirectTo);\n      }\n\n      return {\n        success: true,\n        user: this.state.user,\n        authenticated: true,\n        ...authResult,\n        token: setUserResult.token || authResult.token || null\n      };\n    } catch (error) {\n      this.handleError('Login failed', error);\n      return {\n        success: false,\n        message: error.message || 'Login failed',\n        error\n      };\n    }\n  },\n\n  async logout(callServer = true, options = {}) {\n    try {\n      this.state.loading = true;\n\n      if (this.state.refreshTimer) {\n        clearTimeout(this.state.refreshTimer);\n        this.state.refreshTimer = null;\n      }\n\n      if (callServer) {\n        try {\n          const includeCreds = (ApiService?.config?.security?.sendCredentials) ? 'include' : 'same-origin';\n\n          if (window.ApiService && typeof ApiService.post === 'function') {\n            await ApiService.post(this.config.endpoints.logout, null, {\n              credentials: includeCreds\n            });\n          } else if (window.http && typeof http.post === 'function') {\n            await http.post(this.config.endpoints.logout, null, {\n              credentials: includeCreds\n            });\n          } else if (window.simpleFetch && typeof simpleFetch.post === 'function') {\n            await simpleFetch.post(this.config.endpoints.logout, null, {\n              credentials: includeCreds\n            });\n          } else {\n            throw new Error('No HTTP client available for logout request');\n          }\n        } catch (error) {\n          console.warn('Logout API failed:', error.message);\n        }\n      }\n\n      this.state.authenticated = false;\n      this.state.user = null;\n      this.state.error = null;\n\n      // Clear all caches if enabled (default: true)\n      const shouldClearAllCaches = options.clearAllCaches !== false &&\n        this.config.security.clearAllCachesOnLogout !== false;\n      if (shouldClearAllCaches) {\n        await this.clearAllCaches();\n      }\n\n      this.tokenService?.clear();\n\n      try {\n        localStorage.removeItem(this.config.token.storageKey);\n      } catch (e) {\n        console.warn('Failed to clear cached user data', e);\n      }\n\n      try {\n        localStorage.removeItem('auth_token');\n        if (typeof ApiService?.clearAccessToken === 'function') {\n          ApiService.clearAccessToken();\n        }\n      } catch (e) {\n        console.warn('Failed to clear access token', e);\n      }\n\n      this.emit('auth:logout', {timestamp: Date.now()});\n\n      if (!options.preventRedirect) {\n        const redirectTo = options.redirectTo || this.config.redirects.afterLogout;\n        this.redirectTo(redirectTo);\n      }\n    } catch (error) {\n      this.handleError('Logout failed', error);\n    } finally {\n      this.state.loading = false;\n    }\n  },\n\n  async refreshToken() {\n    try {\n      const refreshToken = this.getRefreshToken();\n      const payload = refreshToken ? {refresh_token: refreshToken} : null;\n      const response = await simpleFetch.post(\n        this.config.endpoints.refresh,\n        payload,\n        this.buildRefreshRequestOptions()\n      );\n\n      if (response?.data?.success) {\n        const tokenFromData = this.resolveTokenFromData(response.data);\n        const tokenFromHeaders = this.extractTokenFromHeaders(response.headers);\n        const ensuredToken = await this.ensureAccessToken(tokenFromData || tokenFromHeaders, {\n          user: response.data.user || this.state.user,\n          allowFallback: false,\n          preferVerifyFallback: false\n        });\n\n        if (response.data.user) {\n          this.state.user = response.data.user;\n        }\n\n        if (this.state.user) {\n          try {\n            localStorage.setItem(\n              this.config.token.storageKey,\n              JSON.stringify({\n                ...this.state.user,\n                timestamp: Date.now()\n              })\n            );\n          } catch (e) {\n            console.warn('Failed to persist refreshed user', e);\n          }\n        }\n\n        this.setupAutoRefresh();\n        this.emit('auth:token_refreshed', {\n          user: this.state.user,\n          token: ensuredToken || tokenFromData || tokenFromHeaders || null,\n          timestamp: Date.now()\n        });\n\n        return true;\n      }\n\n      return false;\n    } catch (error) {\n      console.warn('Token refresh failed:', error.message || error);\n      return false;\n    }\n  },\n\n  setupAutoRefresh() {\n    if (this.state.refreshTimer) {\n      clearTimeout(this.state.refreshTimer);\n    }\n\n    const refreshInterval = this.config.security.refreshBeforeExpiry;\n    this.state.refreshTimer = setTimeout(async () => {\n      if (this.state.authenticated) {\n        await this.refreshToken();\n      }\n    }, refreshInterval);\n  },\n\n  hasPermission(permission) {\n    if (!this.state.authenticated || !this.state.user) {\n      return false;\n    }\n\n    const userPermissions = this.state.user.permissions || [];\n    return userPermissions.includes(permission) || userPermissions.includes('*');\n  },\n\n  hasRole(role) {\n    if (!this.state.authenticated || !this.state.user) {\n      return false;\n    }\n\n    const userRoles = this.state.user.roles || [];\n    return userRoles.includes(role) || userRoles.includes('admin');\n  },\n\n  requireAuth() {\n    if (!this.state.authenticated) {\n      this.saveIntendedUrl();\n      this.redirectTo(this.config.redirects.unauthorized);\n      return false;\n    }\n    return true;\n  },\n\n  requireGuest() {\n    if (this.state.authenticated) {\n      this.redirectTo(this.config.redirects.afterLogin);\n      return false;\n    }\n    return true;\n  },\n\n  saveIntendedUrl(url = null) {\n    const authPages = ['/login', '/register', '/forgot-password'];\n\n    // Normalize path by stripping router base so redirects stay within SPA base\n    const normalizePath = (pathname) => {\n      const routerBase = window.RouterManager?.config?.base || '';\n      let normalized = pathname || '/';\n      if (routerBase && normalized.startsWith(routerBase)) {\n        normalized = normalized.slice(routerBase.length) || '/';\n        if (!normalized.startsWith('/')) normalized = '/' + normalized;\n      }\n      return normalized;\n    };\n\n    if (!authPages.includes(window.location.pathname)) {\n      const normalizedPath = normalizePath(window.location.pathname);\n      const intendedRoute = {\n        path: normalizedPath,\n        query: window.location.search,\n        hash: window.location.hash,\n        timestamp: Date.now()\n      };\n\n      // Use auth_intended_route to match AuthGuard/RedirectManager format\n      sessionStorage.setItem('auth_intended_route', JSON.stringify(intendedRoute));\n\n      // Also keep legacy intended_url for backward compatibility\n      const intendedUrl = url || `${normalizedPath}${window.location.search}`;\n      sessionStorage.setItem('intended_url', intendedUrl);\n    }\n  },\n\n  getIntendedUrl() {\n    const url = sessionStorage.getItem('intended_url');\n    sessionStorage.removeItem('intended_url');\n    return url;\n  },\n\n  redirectTo(url) {\n    if (url === '/login' || url.includes('/login')) {\n      const currentUrl = `${window.location.pathname}${window.location.search}`;\n      const authPages = ['/login', '/register', '/forgot-password'];\n\n      if (!authPages.includes(window.location.pathname)) {\n        const separator = url.includes('?') ? '&' : '?';\n        url = `${url}${separator}redirect=${encodeURIComponent(currentUrl)}`;\n      }\n    }\n\n    if (window.RouterManager?.state?.initialized) {\n      RouterManager.navigate(url);\n    } else {\n      window.location.href = url;\n    }\n  },\n\n  updateCSRFToken(token) {\n    let metaToken = document.querySelector('meta[name=\"csrf-token\"]');\n    if (!metaToken) {\n      metaToken = document.createElement('meta');\n      metaToken.name = 'csrf-token';\n      document.head.appendChild(metaToken);\n    }\n    metaToken.setAttribute('content', token);\n  },\n\n  // Read CSRF token from meta tag or cookie fallback.\n  getCSRFToken() {\n    try {\n      const meta = document.querySelector('meta[name=\"csrf-token\"]');\n      if (meta) {\n        return meta.getAttribute('content');\n      }\n\n      const match = document.cookie.match(/(^|;)\\s*XSRF-TOKEN=([^;]+)/);\n      return match ? decodeURIComponent(match[2]) : null;\n    } catch (e) {\n      console.warn('Failed to resolve CSRF token', e);\n      return null;\n    }\n  },\n\n  emit(eventName, data = {}) {\n    EventManager.emit(eventName, data);\n\n    const event = new CustomEvent(eventName, {\n      detail: data,\n      bubbles: true,\n      cancelable: true\n    });\n\n    document.dispatchEvent(event);\n  },\n\n  handleError(message, error) {\n    this.emit('auth:error', {\n      message,\n      error: error.message,\n      timestamp: Date.now()\n    });\n\n    if (window.NotificationManager) {\n      NotificationManager.error(error.message || message);\n    }\n  },\n\n  getUser() {\n    return this.state.user;\n  },\n\n  isAuthenticated() {\n    return this.state.authenticated;\n  },\n\n  isLoading() {\n    return this.state.loading;\n  },\n\n  getError() {\n    return this.state.error;\n  },\n\n  clearError() {\n    this.state.error = null;\n  },\n\n  cleanup() {\n    if (this.state.refreshTimer) {\n      clearTimeout(this.state.refreshTimer);\n      this.state.refreshTimer = null;\n    }\n\n    this.rateLimitData.clear();\n    this.state.initialized = false;\n  },\n\n  async socialLogin(provider, options = {}) {\n    try {\n      this.state.loading = true;\n      this.state.error = null;\n\n      this.emit('auth:social_login_start', {provider});\n\n      const endpointTemplate = this.config.endpoints.social || 'api/auth/social/{provider}';\n      const endpoint = (options.endpoint || endpointTemplate).replace('{provider}', provider);\n\n      if (options.popup) {\n        return await this.handleSocialPopup(provider, endpoint, options);\n      }\n\n      this.redirectTo(`${endpoint}?redirect=${encodeURIComponent(window.location.href)}`);\n      return {\n        success: true,\n        method: 'redirect'\n      };\n    } catch (error) {\n      this.handleError(`Social login (${provider}) failed`, error);\n      return {\n        success: false,\n        message: error.message || `Social login (${provider}) failed`,\n        error\n      };\n    } finally {\n      this.state.loading = false;\n    }\n  },\n\n  async handleSocialPopup(provider, endpoint, options = {}) {\n    return new Promise((resolve, reject) => {\n      const popup = window.open(\n        endpoint,\n        `social-login-${provider}`,\n        'width=600,height=600,scrollbars=yes,resizable=yes'\n      );\n\n      if (!popup) {\n        reject(new Error('Unable to open social login popup'));\n        return;\n      }\n\n      const checkClosed = setInterval(() => {\n        if (popup.closed) {\n          cleanup();\n          reject(new Error('Social login popup was closed'));\n        }\n      }, 1000);\n\n      const cleanup = () => {\n        clearInterval(checkClosed);\n        window.removeEventListener('message', messageHandler);\n        if (!popup.closed) {\n          popup.close();\n        }\n      };\n\n      function messageHandler(event) {\n        if (event.origin !== window.location.origin) {\n          return;\n        }\n\n        if (event.data?.type === 'social-login-success') {\n          cleanup();\n          AuthManager.setAuthenticatedUser(event.data.userData)\n            .then(resolve)\n            .catch(reject);\n        } else if (event.data?.type === 'social-login-error') {\n          cleanup();\n          reject(new Error(event.data.message || 'Social login failed'));\n        }\n      }\n\n      window.addEventListener('message', messageHandler);\n    });\n  },\n\n  async handleAuthCallback(callbackData) {\n    try {\n      if (callbackData.error) {\n        throw new Error(callbackData.error_description || callbackData.error);\n      }\n\n      if (callbackData.code || callbackData.token) {\n        const response = await simpleFetch.post(this.config.endpoints.callback, callbackData);\n        if (response.success && response.data?.success) {\n          return await this.setAuthenticatedUser(response.data);\n        }\n        throw new Error(response.data?.message || 'Auth callback failed');\n      }\n\n      if (callbackData.user) {\n        return await this.setAuthenticatedUser(callbackData);\n      }\n\n      throw new Error('Invalid callback data');\n    } catch (error) {\n      this.handleError('Auth callback failed', error);\n      return {\n        success: false,\n        message: error.message,\n        error\n      };\n    }\n  },\n\n  async loginWithToken(token, options = {}) {\n    try {\n      this.state.loading = true;\n      this.state.error = null;\n\n      const response = await simpleFetch.get(this.config.endpoints.me, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        },\n        throwOnError: false\n      });\n\n      if (response.success && response.data?.success && response.data.user) {\n        return await this.setAuthenticatedUser({\n          user: response.data.user,\n          token\n        });\n      }\n\n      throw new Error('Invalid or expired token');\n    } catch (error) {\n      this.handleError('Token login failed', error);\n      return {\n        success: false,\n        message: error.message || 'Token login failed',\n        error\n      };\n    } finally {\n      this.state.loading = false;\n    }\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('auth', AuthManager);\n}\n\nwindow.AuthManager = AuthManager;\n\n// Ensure a CSRF meta tag exists so subsequent writes succeed.\nlet metaToken = document.querySelector('meta[name=\"csrf-token\"]');\nif (!metaToken) {\n  metaToken = document.createElement('meta');\n  metaToken.name = 'csrf-token';\n  document.head.appendChild(metaToken);\n}\n","const RouterManager = {\n  MODES: {\n    HISTORY: 'history',\n    HASH: 'hash'\n  },\n\n  DEFAULT_CONFIG: {\n    enabled: false,\n    mode: 'history', // 'hash' or 'history'\n    base: '/',\n    autoDetectBase: true,  // Auto-detect base path\n    fallback: 'index.html',\n\n    auth: {\n      enabled: false,\n      autoGuard: true,\n      defaultRequireAuth: false,\n      publicPaths: ['/login', '/register', '/forgot-password'],\n      guestOnlyPaths: ['/login', '/register'],\n      conventions: {\n        '/auth/*': {public: true},\n        '/admin/*': {roles: ['admin']},\n        '/api/*': {skipRouter: true}\n      },\n      redirects: {\n        unauthorized: '/login',\n        forbidden: '/403',\n        afterLogin: '/',\n        afterLogout: '/login'\n      }\n    },\n\n    notFound: {\n      path: '/404',\n      template: '',\n      title: 'Page Not Found',\n      behavior: 'render',\n      preserveUrl: false,\n      preserveQuery: true,\n      customHandler: null\n    },\n\n    trailingSlash: {\n      mode: 'remove',\n      redirect: false,\n      ignorePaths: ['/'],\n    },\n\n    showLoadingNotification: true,\n    initialLoad: {\n      enabled: true,\n      preserveContent: false,\n      skipIfContent: true,\n      contentSelector: '#main',\n      forceRoute: false,\n    },\n  },\n\n  routes: new Map(),\n  params: new Map(),\n\n  globalGuards: {\n    beforeEach: [],\n    afterEach: []\n  },\n\n  state: {\n    current: null,\n    previous: null,\n    initialized: false,\n    loading: false,\n    error: null,\n    disabled: false\n  },\n\n  beforeEach(guard) {\n    if (typeof guard !== 'function') {\n      throw new Error('Guard must be a function');\n    }\n    this.globalGuards.beforeEach.push(guard);\n    return () => {\n      const index = this.globalGuards.beforeEach.indexOf(guard);\n      if (index > -1) {\n        this.globalGuards.beforeEach.splice(index, 1);\n      }\n    };\n  },\n\n  afterEach(guard) {\n    if (typeof guard !== 'function') {\n      throw new Error('Guard must be a function');\n    }\n    this.globalGuards.afterEach.push(guard);\n    return () => {\n      const index = this.globalGuards.afterEach.indexOf(guard);\n      if (index > -1) {\n        this.globalGuards.afterEach.splice(index, 1);\n      }\n    };\n  },\n\n  async runBeforeEachGuards(to, from) {\n    for (const guard of this.globalGuards.beforeEach) {\n      try {\n        const result = await guard(to, from);\n        if (result === false) {\n          return false;\n        }\n        if (typeof result === 'string') {\n          return result; // Redirect path\n        }\n      } catch (error) {\n        console.error('[ROUTER] Global beforeEach guard error:', error);\n        return false;\n      }\n    }\n    return true;\n  },\n\n  async runAfterEachGuards(to, from) {\n    for (const guard of this.globalGuards.afterEach) {\n      try {\n        await guard(to, from);\n      } catch (error) {\n        console.error('Global afterEach guard error:', error);\n      }\n    }\n  },\n\n  async init(options = {}) {\n    try {\n      if (this.state.initialized && options.force) {\n        EventSystemManager.removeComponentHandlers('router');\n      } else if (this.state.initialized) {\n        return this;\n      }\n\n      this.state = {\n        current: null,\n        previous: null,\n        initialized: false,\n        loading: false,\n        error: null,\n        disabled: false\n      };\n\n      this.routes.clear();\n      this.params.clear();\n\n      // Prefer base path provided by Now.js if available\n      if (options.autoDetectBase !== false) {\n        try {\n          const nowBase = (window.Now && (window.Now.basePath || (window.Now.config && window.Now.config.router && window.Now.config.router.base))) || null;\n          if (nowBase) {\n            options.base = options.base || nowBase;\n          } else {\n            const detectedBase = await this.detectBasePath();\n            options.base = options.base || detectedBase;\n          }\n        } catch (e) {\n          const detectedBase = await this.detectBasePath();\n          options.base = options.base || detectedBase;\n        }\n      }\n\n      // Normalize base if provided\n      if (options.base) {\n        let b = options.base;\n        if (!b.startsWith('/')) b = '/' + b;\n        if (b.length > 1 && b.endsWith('/')) b = b.slice(0, -1);\n        options.base = b;\n      }\n\n      this.config = Now.mergeConfig(this.DEFAULT_CONFIG, options);\n\n      if (!this.config.enabled) {\n        this.state.disabled = true;\n        return this;\n      }\n\n      if (!window.TemplateManager) {\n        throw new Error('TemplateManager is required but not found');\n      }\n\n      if (this.config.auth?.enabled) {\n        await this.initAuthIntegration();\n      }\n\n      if (this.config.initialLoad?.preserveContent) {\n        this.storeInitialContent();\n      }\n\n      if (this.config.notFound?.path) {\n        this.register(this.config.notFound.path, {\n          template: this.config.notFound.template,\n          title: this.config.notFound.title\n        });\n      }\n\n      if (options.routes) {\n        Object.entries(options.routes).forEach(([path, config]) => {\n          this.register(path, config);\n        });\n      }\n\n      if (this.config.auth?.enabled) {\n        this.applyAuthConventions();\n      }\n\n      const currentPath = this.getPath();\n\n      if (this.shouldHandleInitialRoute()) {\n        // For initial load, preserve existing query parameters\n        await this.navigate(currentPath, {}, {replace: true, isInitialLoad: true, preserveQuery: true});\n      } else {\n        const match = this.matchRoute(currentPath);\n\n        if (match) {\n          this.state.current = {\n            path: currentPath,\n            ...match.route,\n            params: match.params || {}\n          };\n\n          if (match.route.title) {\n            document.title = this.translateTitle(match.route.title);\n          }\n\n          const componentManager = Now.getManager('component');\n          if (componentManager) {\n            await componentManager.initializeExistingElements();\n          }\n        } else if (currentPath !== '/' && currentPath !== '') {\n          // If no match but we have a path, try to navigate anyway\n          await this.navigate(currentPath, {}, {replace: true, isInitialLoad: true});\n        }\n      }\n\n      this.setupEventListeners();\n\n      this.state.initialized = true;\n\n      EventManager.emit('router:initialized');\n\n      return this;\n\n    } catch (error) {\n      this.state.error = ErrorManager.handle('Router initialization failed', {\n        context: 'RouterManager.init',\n        type: 'router:error',\n        data: {error}\n      });\n      throw error;\n    }\n  },\n\n  /**\n   * Initialize Auth Integration\n   */\n  async initAuthIntegration() {\n    const authManager = Now.getManager('auth');\n\n    if (!authManager) {\n      console.warn('RouterManager: Auth enabled but AuthManager not found');\n      this.config.auth.enabled = false;\n      return;\n    }\n\n    if (!authManager.state) {\n      console.warn('RouterManager: AuthManager state not available');\n      this.config.auth.enabled = false;\n      return;\n    }\n\n    let attempts = 0;\n    const maxAttempts = 100;\n\n    while ((!authManager.state || !authManager.state.initialized) && attempts < maxAttempts) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n      attempts++;\n    }\n\n    if (!authManager.state || !authManager.state.initialized) {\n      console.error('RouterManager: AuthManager failed to initialize within timeout');\n      console.error('Final AuthManager state:', authManager.state);\n      this.config.auth.enabled = false;\n      return;\n    }\n  },\n\n  /**\n   * Apply Convention-based Route Protection\n   */\n  applyAuthConventions() {\n    if (!this.config.auth?.enabled) return;\n\n    const defaultRequireAuth = this.config.auth.defaultRequireAuth !== false;\n\n    for (const [path, route] of this.routes) {\n      if (route.authProcessed) continue;\n\n      let authRequired = defaultRequireAuth;\n      let isPublic = false;\n      let isGuestOnly = false;\n\n\n      if (this.config.auth.publicPaths?.includes(path)) {\n        authRequired = false;\n        isPublic = true;\n      }\n\n      if (this.config.auth.guestOnlyPaths?.includes(path)) {\n        isGuestOnly = true;\n        authRequired = false;\n      }\n\n      route.requireAuth = route.requireAuth !== undefined ? route.requireAuth : authRequired;\n      route.requireGuest = route.requireGuest !== undefined ? route.requireGuest : isGuestOnly;\n      route.isPublic = isPublic;\n      route.authProcessed = true;\n    }\n  },\n\n  /**\n   * Match Convention Pattern\n   */\n  matchConvention(path, pattern) {\n    const regexPattern = pattern\n      .replace(/\\*/g, '[^/]*')\n      .replace(/\\*\\*/g, '.*')\n      .replace(/\\//g, '\\\\/');\n\n    const regex = new RegExp(`^${regexPattern}$`);\n    return regex.test(path);\n  },\n\n  /**\n   * Enhanced Navigate with Auth Guards\n   */\n  async navigate(path, params = {}, options = {}) {\n    try {\n      if (this.state.loading && !options.force) return false;\n\n      // Parse URL: separate path, query string, and hash\n      let cleanPath = path;\n      let queryString = '';\n      let hashFragment = '';\n\n      // Separate the hash first (if there is #)\n      if (path.includes('#')) {\n        const parts = path.split('#');\n        cleanPath = parts[0];\n        hashFragment = parts[1] || '';\n      }\n\n      // Separate the query string (in case there is ?)\n      if (cleanPath.includes('?')) {\n        const parts = cleanPath.split('?');\n        cleanPath = parts[0];\n        queryString = parts[1] || '';\n      }\n\n      // If preserveQuery is true, merge with current URL query params\n      if (options.preserveQuery && !queryString) {\n        queryString = window.location.search.slice(1); // Remove '?'\n      }\n\n      // Parse query string into object\n      const queryParams = {};\n      if (queryString) {\n        const searchParams = new URLSearchParams(queryString);\n        searchParams.forEach((value, key) => {\n          queryParams[key] = value;\n        });\n      }\n\n      // Merge params (query params + submitted params)\n      const mergedParams = {...queryParams, ...params};\n\n      const normalizedPath = this.handleTrailingSlash(cleanPath);\n\n      // Skip navigation if already on the same path (unless forced)\n      // But handle hash changes - update URL and dispatch hashchange event\n      if (!options.force && !options.isInitialLoad &&\n        this.state.current && this.state.current.path === normalizedPath) {\n        // Check if hash changed\n        const currentHash = window.location.hash.slice(1);\n        if (hashFragment !== currentHash) {\n          // Update URL with new hash (don't append # if empty)\n          const hashPart = hashFragment ? '#' + hashFragment : '';\n          const newUrl = window.location.pathname + window.location.search + hashPart;\n          history.pushState({params: this.state.current.params, hash: hashFragment}, '', newUrl);\n          // Dispatch hashchange event so TabsComponent and other listeners can respond\n          window.dispatchEvent(new HashChangeEvent('hashchange'));\n        }\n        return true;\n      }\n\n      const match = this.matchRoute(normalizedPath);\n      if (!match) {\n        return await this.handleNotFound(normalizedPath, mergedParams);\n      }\n\n      const to = {\n        path: normalizedPath,\n        params: match.params,\n        route: match.route,\n        query: queryParams,\n        hash: hashFragment\n      };\n\n      const from = this.state.current ? {\n        path: this.state.current.path,\n        params: this.state.current.params,\n        route: this.state.current\n      } : null;\n\n      // Run global beforeEach guards\n      const globalGuardResult = await this.runBeforeEachGuards(to, from);\n      if (globalGuardResult === false) return false;\n\n      if (typeof globalGuardResult === 'string') {\n        return this.navigate(globalGuardResult, {}, {replace: true});\n      }\n\n      // Auth check - only if autoGuard is enabled\n      if (this.config.auth?.enabled && this.config.auth?.autoGuard !== false) {\n        const guardResult = await this.checkRouteAuth(cleanPath, params);\n\n        if (!guardResult.allowed) {\n          return this.handleAuthRedirect(guardResult, cleanPath, params);\n        }\n      }\n\n      // Route-level beforeEnter guard\n      if (match.route.beforeEnter && typeof match.route.beforeEnter === 'function') {\n        try {\n          const authManager = Now.getManager('auth');\n          const guardResult = await match.route.beforeEnter(match.params, this.state.current, authManager);\n          if (guardResult === false) {\n            return false;\n          }\n          if (typeof guardResult === 'string') {\n            return this.navigate(guardResult, {}, {replace: true});\n          }\n        } catch (error) {\n          console.error('Route guard error:', error);\n          return false;\n        }\n      }\n\n      // Route-level beforeLeave guard\n      if (this.state.current && this.state.current.beforeLeave &&\n        typeof this.state.current.beforeLeave === 'function') {\n        try {\n          const guardResult = await this.state.current.beforeLeave(match.params, this.state.current);\n          if (guardResult === false) {\n            return false;\n          }\n        } catch (error) {\n          console.error('Route leave guard error:', error);\n          return false;\n        }\n      }\n\n      // Event-based guards\n      const results = await EventManager.emit('route:before', {\n        path: match.route.path,\n        params: match.params,\n      });\n\n      let shouldContinue = true;\n      if (Array.isArray(results)) {\n        shouldContinue = !results.includes(false);\n      }\n      if (!shouldContinue) {\n        this.state.current = null;\n        this.hideLoading();\n        return false;\n      }\n\n      // Continue with navigation...\n      this.params.set(match.route.path, match.params);\n      this.state.previous = this.state.current;\n      this.state.current = {\n        ...match.route,\n        params: match.params,\n        path: normalizedPath,\n        query: mergedParams,\n        hash: hashFragment\n      };\n\n      // Rebuild query string from merged params\n      const finalQueryString = Object.keys(mergedParams).length > 0\n        ? new URLSearchParams(mergedParams).toString()\n        : '';\n\n      // Build the full URL with query parameters\n      let fullUrl = this.resolvePath(cleanPath, match.params, finalQueryString, hashFragment);\n\n      // Update history\n      if (options.replace) {\n        window.history.replaceState({params: match.params}, '', fullUrl);\n      } else {\n        window.history.pushState({params: match.params}, '', fullUrl);\n      }\n\n      this.showLoading();\n\n      let template = this.resolveTemplate(match.route.template, match.params);\n      let content = await this.loadTemplate(template);\n\n      if (!content) {\n        return await this.handleNotFound(normalizedPath, params);\n      }\n\n      const container = document.createElement('div');\n      container.innerHTML = content;\n\n      // Priority: 1. data-title from template, 2. <title> from template, 3. title from route config\n      let title = this.extractText(container, '[data-title]') ||\n        this.extractText(container, 'title');\n      const mainContent = container.querySelector(Now.config.mainSelector) || container;\n\n      // Use route config title as fallback, with translation support for {LNG_...}\n      if (!title && match.route.title) {\n        title = this.translateTitle(match.route.title);\n      }\n\n      if (title) {\n        document.title = title;\n      }\n\n      await this.render(mainContent.innerHTML);\n\n      const shouldScroll = options.scroll !== false;\n      if (shouldScroll) {\n        window.scrollTo(0, 0);\n      }\n\n      const hash = window.location.hash.slice(1);\n      if (hash && shouldScroll) {\n        setTimeout(() => {\n          const element = document.getElementById(hash);\n          if (element && window.ScrollManager) {\n            ScrollManager.scrollTo(element, {\n              offset: ScrollManager.config.core.offset,\n              behavior: 'smooth'\n            });\n          }\n        }, 100);\n      }\n\n      // Run global afterEach guards\n      await this.runAfterEachGuards(to, from);\n\n      await EventManager.emit('route:changed', {\n        path: match.route.path,\n        params: match.params,\n        route: match.route,\n        previous: this.state.previous,\n        isNotFoundPage: normalizedPath === this.config.notFound.path\n      });\n\n      // Execute data-script after all processing is complete\n      setTimeout(() => {\n        this.executePageScripts();\n      }, 0);\n\n      return true;\n\n    } catch (error) {\n      this.state.current = null;\n      this.handleError('Navigation failed', error);\n      return false;\n    } finally {\n      this.hideLoading();\n    }\n  },\n\n  /**\n   * Execute page scripts after navigation\n   * Finds the first element with data-script and calls TemplateManager.processDataScript\n   */\n  executePageScripts() {\n    const mainContent = document.querySelector(Now.config.mainSelector);\n    if (!mainContent) return;\n\n    // Find first data-script in page (only one per page)\n    const scriptElement = mainContent.querySelector('[data-script]');\n    if (scriptElement && window.TemplateManager?.processDataScript) {\n      const context = {\n        state: {\n          data: this.state.current?.params || {},\n          route: this.state.current\n        }\n      };\n      TemplateManager.processDataScript(scriptElement, context);\n    }\n  },\n\n  /**\n   * Check Route Authentication\n   */\n  async checkRouteAuth(path, params) {\n    const authManager = Now.getManager('auth');\n    if (!authManager) {\n      console.warn('AuthManager not found during auth check');\n      return {allowed: true};\n    }\n\n\n    if (!authManager.state) {\n      console.warn('AuthManager state not available during auth check');\n      return {allowed: true};\n    }\n\n    if (!authManager.state.initialized) {\n      console.warn('AuthManager not initialized during auth check');\n      return {allowed: true};\n    }\n\n\n    if (typeof authManager.isAuthenticated !== 'function') {\n      console.warn('AuthManager methods not available');\n      return {allowed: true};\n    }\n\n    const normalizedPath = this.handleTrailingSlash(path);\n    const match = this.matchRoute(normalizedPath);\n\n    if (!match) {\n      return {allowed: true};\n    }\n\n    const route = match.route;\n    const result = {\n      allowed: true,\n      reason: null,\n      redirectTo: null\n    };\n\n    try {\n      const isAuthenticated = authManager.isAuthenticated();\n\n      if (route.requireGuest) {\n        if (isAuthenticated) {\n          result.allowed = false;\n          result.reason = 'already_authenticated';\n          result.redirectTo = this.config.auth?.redirects?.afterLogin || '/';\n          return result;\n        }\n      }\n\n      if (route.requireAuth) {\n        if (!isAuthenticated) {\n          result.allowed = false;\n          result.reason = 'authentication_required';\n          result.redirectTo = this.config.auth?.redirects?.unauthenticated || this.config.auth?.redirects?.unauthorized || '/login';\n\n          if (typeof authManager.saveIntendedUrl === 'function') {\n            authManager.saveIntendedUrl();\n          }\n          return result;\n        }\n      }\n\n      if (route.roles && route.roles.length > 0) {\n        if (typeof authManager.hasRole === 'function') {\n          const hasRequiredRole = route.roles.some(role => authManager.hasRole(role));\n          if (!hasRequiredRole) {\n            result.allowed = false;\n            result.reason = 'insufficient_role';\n            result.redirectTo = this.config.auth?.redirects?.forbidden || '/403';\n            return result;\n          }\n        }\n      }\n\n      return result;\n\n    } catch (error) {\n      console.error('Error in auth check:', error);\n      return {allowed: true};\n    }\n  },\n\n  /**\n   * Handle Auth Redirect\n   */\n  async handleAuthRedirect(guardResult, originalPath, params) {\n    const {reason, redirectTo} = guardResult;\n\n    // Persist intended route before redirecting to login/other auth page\n    if (reason === 'authentication_required') {\n      try {\n        if (window.RedirectManager?.storeIntendedRoute) {\n          await RedirectManager.storeIntendedRoute();\n        } else {\n          const authManager = Now.getManager('auth');\n          if (authManager?.saveIntendedUrl) {\n            authManager.saveIntendedUrl();\n          }\n        }\n      } catch (error) {\n        console.warn('[RouterManager] Failed to store intended route before auth redirect:', error);\n      }\n    }\n\n    await EventManager.emit('route:guard:rejected', {\n      reason,\n      originalPath,\n      redirectTo,\n      timestamp: Date.now()\n    });\n\n    const messages = {\n      authentication_required: 'Please login to access this page',\n      already_authenticated: 'You are already logged in',\n      insufficient_role: 'You do not have permission to access this page',\n      insufficient_permission: 'You do not have permission to access this page'\n    };\n\n    const message = messages[reason] || 'Access denied';\n    NotificationManager.warning(message);\n\n    if (redirectTo) {\n      return this.navigate(redirectTo, {}, {replace: true});\n    }\n\n    return false;\n  },\n\n  createRoutePattern(path, ignoreTrailingSlash = true) {\n    let pattern = path\n      .replace(/:[^\\s/]+/g, '([^/]+)')\n      .replace(/\\//g, '\\\\/');\n\n    if (ignoreTrailingSlash) {\n      pattern = `^${pattern}\\\\/?$`;\n    } else {\n      pattern = `^${pattern}$`;\n    }\n\n    return new RegExp(pattern);\n  },\n\n  matchRoute(path) {\n    const normalizedPath = this.config.trailingSlash.mode === 'preserve'\n      ? path\n      : this.handleTrailingSlash(path);\n\n    for (const [routePath, route] of this.routes) {\n      const pattern = this.createRoutePattern(routePath);\n      const matches = normalizedPath.match(pattern);\n\n      if (matches) {\n        const params = {};\n        route.paramNames.forEach((name, index) => {\n          params[name] = matches[index + 1];\n        });\n        return {route, params};\n      }\n    }\n\n    return null;\n  },\n\n  register(path, config) {\n    if (!path) {\n      throw new Error('Route path is required');\n    }\n\n    const paramNames = this.extractParamNames(path);\n    const pattern = this.createRoutePattern(path);\n\n    if (typeof config === 'string') {\n      config = {template: config};\n    }\n\n    this.routes.set(path, {\n      path,\n      pattern,\n      paramNames,\n      template: config.template || path,\n      title: config.title,\n      ...config\n    });\n\n    if (config.children && typeof config.children === 'object') {\n      Object.entries(config.children).forEach(([childPath, childConfig]) => {\n        const fullChildPath = childPath.startsWith('/')\n          ? childPath\n          : path + (path.endsWith('/') ? '' : '/') + childPath;\n\n        this.register(fullChildPath, childConfig);\n      });\n    }\n  },\n\n  extractParamNames(path) {\n    const paramNames = [];\n    const segments = path.split('/');\n\n    segments.forEach(segment => {\n      if (segment.startsWith(':')) {\n        paramNames.push(segment.substring(1));\n      }\n    });\n\n    return paramNames;\n  },\n\n  handleTrailingSlash(url) {\n    if (url === '/') return url;\n\n    if (this.config.trailingSlash.ignorePaths?.includes(url)) {\n      return url;\n    }\n\n    switch (this.config.trailingSlash.mode) {\n      case 'add':\n        return url.endsWith('/') ? url : `${url}/`;\n      case 'remove':\n        return url.endsWith('/') ? url.slice(0, -1) : url;\n      case 'preserve':\n      default:\n        return url;\n    }\n  },\n\n  /**\n   * Detect base path automatically\n   */\n  async detectBasePath() {\n    // Prefer explicit <base href> in document if present\n    try {\n      const baseEl = document.querySelector('base[href]');\n      if (baseEl) {\n        const href = baseEl.getAttribute('href');\n        if (href) {\n          try {\n            const resolved = new URL(href, window.location.href);\n            let basePath = resolved.pathname || '/';\n            if (!basePath.startsWith('/')) basePath = '/' + basePath;\n            if (basePath.length > 1 && basePath.endsWith('/')) basePath = basePath.slice(0, -1);\n            return basePath;\n          } catch (e) {\n            // ignore and continue with other heuristics\n          }\n        }\n      }\n    } catch (e) {\n      // ignore DOM errors in unusual environments\n    }\n\n    // Fallback detection logic\n    const scriptTags = document.getElementsByTagName('script');\n\n    // Try to detect from script tags\n    for (let script of scriptTags) {\n      const src = script.getAttribute('src');\n      if (src && (src.includes('/Now.js') || src.includes('/Now/'))) {\n        const match = src.match(/^(.*?)\\/Now\\//);\n        if (match) {\n          let basePath = match[1] || '/';\n          // Normalize path\n          if (!basePath.startsWith('/')) {\n            basePath = '/' + basePath;\n          }\n          if (basePath.length > 1 && basePath.endsWith('/')) {\n            basePath = basePath.slice(0, -1);\n          }\n          return basePath;\n        }\n      }\n    }\n\n    return '/';\n  },\n\n  getPath(includeQuery = false) {\n    let path;\n\n    if (this.config.mode === 'hash') {\n      const hashPath = window.location.hash.slice(1);\n      if (hashPath) {\n        path = hashPath.startsWith('/') ? hashPath : '/' + hashPath;\n      } else {\n        // No hash found - check if we have a pathname that should be converted to hash\n        const pathname = window.location.pathname || '/';\n        const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n\n        let pathToConvert = pathname;\n        if (base && pathname.startsWith(base)) {\n          pathToConvert = pathname.slice(base.length) || '/';\n        }\n\n        // If we have a meaningful path and no hash, this might be a direct URL access\n        if (pathToConvert !== '/' && pathToConvert !== '') {\n          path = pathToConvert.startsWith('/') ? pathToConvert : '/' + pathToConvert;\n        } else {\n          path = '/';\n        }\n      }\n    } else {\n      // History mode\n      const pathname = window.location.pathname || '/';\n      const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n\n      let result = pathname;\n      if (base && pathname.startsWith(base)) {\n        result = pathname.slice(base.length) || '/';\n      }\n\n      path = result.startsWith('/') ? result : '/' + result;\n    }\n\n    // Include query parameters if requested\n    if (includeQuery) {\n      const query = this.getQuery();\n      if (query) {\n        path += query;\n      }\n    }\n\n    return path;\n  },\n\n  getQuery() {\n    return window.location.search || '';\n  },\n\n\n  shouldHandleInitialRoute() {\n    const config = this.config.initialLoad;\n\n    if (!config.enabled) {\n      return false;\n    }\n\n    if (config.forceRoute) {\n      return true;\n    }\n\n    // Handle hash mode direct URL conversion\n    if (this.config.mode === 'hash') {\n      const hasHash = window.location.hash;\n      const pathname = window.location.pathname || '/';\n      const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n\n      let pathToCheck = pathname;\n      if (base && pathname.startsWith(base)) {\n        pathToCheck = pathname.slice(base.length) || '/';\n      }\n\n      // If no hash but we have a meaningful pathname, redirect to hash URL\n      if (!hasHash && pathToCheck !== '/' && pathToCheck !== '') {\n        // Ensure we maintain the full URL structure for proper API base path\n        const currentUrl = window.location.href;\n        const baseUrl = currentUrl.split('#')[0];\n        const properBaseUrl = baseUrl.endsWith('/') ? baseUrl : baseUrl + '/';\n        const hashUrl = properBaseUrl + '#' + (pathToCheck.startsWith('/') ? pathToCheck : '/' + pathToCheck);\n        // Preserve query parameters during hash mode redirect\n        const queryString = window.location.search || '';\n        window.location.replace(hashUrl + queryString);\n        return false; // Don't handle initial route, let the redirect happen\n      }\n    }\n\n    // Always handle initial route for direct URL access or page reload\n    const currentPath = this.getPath();\n    if (currentPath !== '/' && currentPath !== '') {\n      return true;\n    }\n\n    if (config.skipIfContent) {\n      const mainContent = document.querySelector(config.contentSelector);\n      if (mainContent && mainContent.children.length > 0) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n\n  storeInitialContent() {\n    const mainContent = document.querySelector(this.config.initialLoad.contentSelector);\n    if (mainContent) {\n      this.state.initialContent = {\n        html: mainContent.innerHTML,\n        path: window.location.pathname\n      };\n    }\n  },\n\n  setupEventListeners() {\n    document.addEventListener('click', (event) => this.handleClick(event));\n\n    window.addEventListener('popstate', (event) => this.handlePopState(event));\n\n    if (this.config.mode === 'hash') {\n      window.addEventListener('hashchange', (event) => this.handleHashChange(event));\n    }\n\n    // Handle page reload and direct URL access\n    window.addEventListener('load', () => {\n      // Special handling for hash mode direct URLs\n      if (this.config.mode === 'hash') {\n        this.ensureHashModeUrl();\n      }\n\n      const currentPath = this.getPath();\n      if (currentPath && currentPath !== '/' && !this.state.current) {\n        // Handle initial route normally\n        this.navigate(currentPath, {}, {replace: true, isInitialLoad: true});\n      }\n    });\n  },\n\n  /**\n   * Ensure URL is in correct hash format for hash mode\n   */\n  ensureHashModeUrl() {\n    const hasHash = window.location.hash;\n    const pathname = window.location.pathname || '/';\n    const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n\n    let pathToCheck = pathname;\n    if (base && pathname.startsWith(base)) {\n      pathToCheck = pathname.slice(base.length) || '/';\n    }\n\n    // If no hash but we have a meaningful pathname, redirect to hash URL\n    if (!hasHash && pathToCheck !== '/' && pathToCheck !== '') {\n      const hashUrl = window.location.origin +\n        (base || '') +\n        '/' + // Always include trailing slash before hash\n        (window.location.search || '') +\n        '#' + (pathToCheck.startsWith('/') ? pathToCheck : '/' + pathToCheck);\n      window.location.replace(hashUrl);\n      return false;\n    } return true;\n  },\n\n  handleClick(event) {\n    const link = event.target.closest('a');\n    if (!link) return;\n\n    // Skip if external link, download, or has target\n    if (link.hasAttribute('download') ||\n      link.hasAttribute('target') ||\n      link.getAttribute('rel') === 'external') return;\n\n    // Priority 1: Use data-route if present\n    let routePath = link.getAttribute('data-route');\n\n    if (routePath) {\n      // Handle relative data-route paths\n      if (routePath.startsWith('../')) {\n        // Convert relative to absolute based on current location\n        routePath = this.extractRouteFromHref(routePath);\n      } else if (!routePath.startsWith('/')) {\n        // Simple relative path, prepend /\n        routePath = '/' + routePath;\n      }\n    } else {\n      // Priority 2: Extract route from href\n      const href = link.getAttribute('href');\n\n      if (!href) return;\n\n      // mailto, tel, hash-only -> let browser handle\n      if (/^(mailto:|tel:|#)/.test(href)) return;\n\n      // If it's an absolute URL (http/https), check origin\n      if (/^https?:\\/\\//i.test(href)) {\n        try {\n          const url = new URL(href, window.location.href);\n          const isSameOrigin = url.origin === window.location.origin;\n\n          if (!isSameOrigin) {\n            // External redirect: if target specified, allow browser to follow target\n            if (link.hasAttribute('target')) {\n              return; // do not intercept\n            }\n            // No target: let browser handle navigation (default behavior)\n            return;\n          }\n\n          // Same-origin absolute URL: convert to route path by removing base\n          routePath = url.pathname + url.search + url.hash;\n          // Remove base if configured\n          const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n          if (base && routePath.startsWith(base)) {\n            routePath = routePath.substring(base.length) || '/';\n          }\n        } catch (e) {\n          // Malformed URL fallback - treat as relative\n          routePath = this.extractRouteFromHref(href);\n        }\n      } else {\n        // Relative href -> convert to route path\n        routePath = this.extractRouteFromHref(href);\n      }\n    }\n\n    // Collect params from data attributes\n    const params = {};\n    const dataset = link.dataset;\n\n    Object.keys(dataset).forEach(key => {\n      if (key.startsWith('param')) {\n        const paramName = key.replace('param', '').toLowerCase();\n        params[paramName] = dataset[key];\n      }\n    });\n\n    event.preventDefault();\n    this.navigate(routePath, params);\n  },\n\n  /**\n   * Extract route path from href attribute\n   * Examples:\n   * \"./docs\" -> \"/docs\"\n   * \"../components\" -> \"/components\"\n   * \"/docs/api\" -> \"/docs/api\"\n   * \"docs/getting-started\" -> \"/docs/getting-started\"\n   */\n  extractRouteFromHref(href) {\n    if (!href) return '/';\n\n    // If already absolute path, use as is\n    if (href.startsWith('/')) {\n      return href;\n    }\n\n    // Handle relative paths by resolving against current location\n    try {\n      const resolvedUrl = new URL(href, window.location.href);\n      let pathname = resolvedUrl.pathname;\n\n      // Remove base path if present\n      const basePath = this.config.base || '/';\n      if (basePath !== '/' && pathname.startsWith(basePath)) {\n        pathname = pathname.substring(basePath.length) || '/';\n      }\n\n      // Include query string and hash\n      return pathname + resolvedUrl.search + resolvedUrl.hash;\n    } catch (error) {\n      // Fallback: simple conversion\n      if (href.startsWith('./')) {\n        return href.substring(1); // \"./docs\" -> \"/docs\"\n      } else if (href.startsWith('../')) {\n        // Simple assumption: \"../components\" -> \"/components\"\n        const parts = href.split('/').filter(part => part !== '..' && part !== '.' && part !== '');\n        return '/' + parts.join('/');\n      } else {\n        // Regular relative: \"docs\" -> \"/docs\"\n        return '/' + href;\n      }\n    }\n  },\n\n  handlePopState(event) {\n    const path = this.getPath(); // Get path without query\n    const params = event.state?.params || {};\n\n    // During popstate, the URL already contains the correct query parameters\n    // Parse them from the current URL\n    const queryString = window.location.search.slice(1); // Remove '?'\n    const queryParams = {};\n    if (queryString) {\n      const searchParams = new URLSearchParams(queryString);\n      searchParams.forEach((value, key) => {\n        queryParams[key] = value;\n      });\n    }\n\n    const hash = window.location.hash.slice(1); // Remove '#'\n\n    // We just need to process the route without modifying the URL\n    this.processRoute(path, params, queryParams, hash);\n  },\n\n  async processRoute(path, params = {}, queryParams = {}, hash = '') {\n    // Internal method to process route without URL manipulation\n    // Used by handlePopState to avoid double URL updates\n    const normalizedPath = this.handleTrailingSlash(path);\n    const match = this.matchRoute(normalizedPath);\n\n    if (!match) {\n      return await this.handleNotFound(normalizedPath, params);\n    }\n\n    try {\n      this.params.set(match.route.path, params);\n      this.state.previous = this.state.current;\n      this.state.current = {\n        ...match.route,\n        params: params,\n        path: normalizedPath,\n        query: queryParams,\n        hash: hash\n      };\n\n      this.showLoading();\n\n      let template = this.resolveTemplate(match.route.template, params);\n      let content = await this.loadTemplate(template);\n\n      if (!content) {\n        return await this.handleNotFound(normalizedPath, params);\n      }\n\n      if (match.route.title) {\n        document.title = this.translateTitle(match.route.title);\n      }\n\n      await this.render(content);\n\n      await EventManager.emit('route:changed', {\n        path: match.route.path,\n        params: params,\n        route: match.route,\n        previous: this.state.previous\n      });\n\n      return true;\n    } catch (error) {\n      console.error('Route processing failed:', error);\n      return false;\n    } finally {\n      this.hideLoading();\n    }\n  },\n\n  handleHashChange(event) {\n    const path = this.getPath();\n    const params = event.state?.params || {};\n    // Process route directly without URL manipulation to preserve query params\n    this.processRoute(path, params);\n  },\n\n  resolvePath(path, params, queryString, hashFragment) {\n    let resolvedPath = path;\n\n    Object.entries(params).forEach(([key, value]) => {\n      const paramPattern = new RegExp(`:${key}(?=/|$)`);\n      resolvedPath = resolvedPath.replace(paramPattern, encodeURIComponent(value));\n    });\n\n    resolvedPath = resolvedPath.replace(/:[^/]+/g, '');\n\n    if (!resolvedPath.startsWith('/')) {\n      resolvedPath = '/' + resolvedPath;\n    }\n\n    if (resolvedPath.length > 1 && resolvedPath.endsWith('/')) {\n      resolvedPath = resolvedPath.slice(0, -1);\n    }\n\n    // Apply base path and mode-specific formatting\n    const base = this.config.base && this.config.base !== '/' ? this.config.base : '';\n\n    if (this.config.mode === 'hash') {\n      // For hash mode, return base + /#path (ensure trailing slash)\n      const basePart = base || '';\n      const separator = basePart && !basePart.endsWith('/') ? '/' : '';\n      resolvedPath = basePart + separator + '#' + resolvedPath;\n    } else {\n      // For history mode, apply base path normally\n      if (base && !resolvedPath.startsWith(base)) {\n        resolvedPath = base + resolvedPath;\n      }\n      if (queryString) {\n        resolvedPath += '?' + queryString;\n      }\n      if (hashFragment) {\n        resolvedPath += '#' + hashFragment;\n      }\n    }\n    return resolvedPath;\n  },\n\n  resolveTemplate(template, params) {\n    if (!template) return '';\n\n    return template.replace(/:([\\w]+)/g, (match, key) => {\n      const value = params[key];\n      return value != null ? value : match;\n    });\n  },\n\n  // Keep template path as logical name - do not apply base path here\n  // Base path will be applied later in TemplateManager.loadFromServer()\n  applyBaseToTemplate(template) {\n    if (!template) return template;\n\n    const t = String(template).trim();\n    // inline template - return as-is\n    if (t.startsWith('<')) return template;\n    // absolute URLs - return as-is\n    if (/^(https?:)?\\/\\//i.test(t)) return template;\n    // root-absolute path - return as-is (explicit absolute path)\n    if (t.startsWith('/')) return t;\n\n    // For relative template names, return as-is to keep them logical\n    // TemplateManager.loadFromServer() will handle base path + templates path resolution\n    return t;\n  },\n\n  async loadTemplate(template) {\n    try {\n      if (!template) return '';\n      const trimmed = String(template).trim();\n      if (trimmed.startsWith('<')) return template;\n\n      const fetchPath = this.applyBaseToTemplate(trimmed);\n      return await TemplateManager.loadFromServer(fetchPath);\n    } catch (error) {\n      throw new Error('Failed to load template');\n    }\n  },\n\n  async render(content) {\n    try {\n      const main = document.querySelector(Now.config.mainSelector);\n      if (!main) {\n        throw new Error(`Main content area not found: ${Now.config.mainSelector} in ${document.location.href}`);\n      }\n\n      const componentManager = Now.getManager('component');\n      const templateManager = Now.getManager('template');\n\n      if (templateManager) {\n        templateManager.cleanup();\n      }\n\n      if (componentManager) {\n        const componentElements = main.querySelectorAll('[data-component]');\n        for (const element of componentElements) {\n          const instance = componentManager.instances.get(element);\n          if (instance) {\n            await componentManager.destroy(element);\n          }\n        }\n      }\n\n      // Destroy element/form instances inside main before replacing content\n      try {\n        const elementManager = Now.getManager('element') || window.ElementManager;\n        const formManager = Now.getManager('form') || window.FormManager;\n\n        if (elementManager) {\n          const els = main.querySelectorAll('[data-element]');\n          els.forEach(el => {\n            try {elementManager.destroyByElement && elementManager.destroyByElement(el);} catch (e) {}\n          });\n        }\n\n        if (formManager) {\n          const forms = main.querySelectorAll('form[data-form]');\n          forms.forEach(f => {\n            try {formManager.destroyFormByElement && formManager.destroyFormByElement(f);} catch (e) {}\n          });\n        }\n      } catch (e) {\n        console.warn('RouterManager: cleanup before render failed', e);\n      }\n\n      main.innerHTML = '';\n      main.innerHTML = content;\n\n      if (componentManager) {\n        await componentManager.initializeExistingElements();\n      }\n\n      // After components initialized, scan for elements/forms to enhance (lifecycle-first)\n      try {\n        const elementManager = Now.getManager('element') || window.ElementManager;\n        const formManager = Now.getManager('form') || window.FormManager;\n\n        if (elementManager && typeof elementManager.scan === 'function') {\n          elementManager.scan(main);\n        }\n\n        if (formManager && typeof formManager.scan === 'function') {\n          formManager.scan(main);\n        }\n      } catch (e) {\n        console.warn('RouterManager: post-render scan failed', e);\n      }\n\n      const i18n = Now.getManager('i18n');\n      if (i18n && i18n.config.enabled) {\n        const currentLocale = i18n.getCurrentLocale();\n        await i18n.setLocale(currentLocale, true);\n      }\n\n      await EventManager.emit('content:rendered', {\n        path: this.getPath(),\n        main\n      });\n    } catch (error) {\n      ErrorManager.handle('Failed to render content', {\n        context: 'RouterManager.render',\n        data: {content}\n      });\n      throw error;\n    }\n  },\n\n  showLoading() {\n    this.state.loading = true;\n    document.body.classList.add('loading');\n  },\n\n  hideLoading() {\n    this.state.loading = false;\n    document.body.classList.remove('loading');\n  },\n\n  extractText(container, tag) {\n    try {\n      const node = container.querySelector(tag);\n      if (!node) return null;\n\n      const cloned = node.cloneNode(true);\n      cloned.querySelectorAll('.icon, .badge, .hidden').forEach(el => {\n        el.remove();\n      });\n\n      const text = cloned.textContent.trim();\n\n      const i18n = Now?.getManager('i18n');\n      if (i18n?.enabled) {\n        return i18n.translate(text) || text;\n      }\n\n      return text;\n    } catch (error) {\n      this.handleError('Text extraction failed', error);\n      return null;\n    }\n  },\n\n  async handleNotFound(path, params = {}) {\n    this.state.current = null;\n    this.hideLoading();\n    this.state.error = new Error('Page not found');\n\n    const config = this.config.notFound;\n    if (config.title) {\n      document.title = this.translateTitle(config.title);\n    }\n\n    await EventManager.emit('route:notFound', {\n      path,\n      params,\n      redirectTo: this.config.notFound.path\n    });\n\n    if (typeof config.customHandler === 'function') {\n      const result = await config.customHandler(path, params);\n      if (result !== undefined) return result;\n    }\n\n    switch (config.behavior) {\n      case 'redirect':\n        if (!config.preserveUrl) {\n          const currentQuery = window.location.search;\n          const targetPath = config.preserveQuery && currentQuery\n            ? `${config.path}${currentQuery}`\n            : config.path;\n\n          return await this.navigate(targetPath, {\n            originalPath: path,\n            ...params\n          }, {replace: true});\n        }\n        break;\n\n      case 'render':\n        try {\n          const content = await this.loadTemplate(config.template);\n          if (content) {\n            await this.render(content);\n            await EventManager.emit('route:changed', {\n              path,\n              params,\n              isError: true\n            });\n            return true;\n          }\n        } catch (error) {\n          await ErrorManager.handle('Failed to render 404 template page', {\n            context: 'RouterManager.handleNotFound',\n            type: 'route:changed',\n            data: {\n              path,\n              params\n            }\n          });\n        }\n        break;\n\n      case 'preserve':\n        NotificationManager.error('Page not found');\n        return false;\n    }\n\n    return this.renderDefault404Page(path);\n  },\n\n  renderDefault404Page(path) {\n    const mainElement = document.querySelector(Now.config.mainSelector);\n    if (!mainElement) return false;\n\n    const errorPageHTML = `\n        <div class=\"error-container\">\n            <div class=\"error-card\">\n              <h1 class=\"error-code-number\">404</h1>\n              <p class=\"error-message\" data-i18n>The page you're looking for doesn't exist.</p>\n\n              <div class=\"error-details\">\n                <div class=\"error-code-heading\">Path:</div>\n                <pre class=\"error-code\">${this.escapeHtml(path)}</pre>\n              </div>\n\n              <div class=\"error-actions\">\n                <button class=\"btn btn-primary\" onclick=\"window.location.reload()\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\"></path>\n                    <path d=\"M3 3v5h5\"></path>\n                  </svg>\n                  Reload Page\n                </button>\n                <button class=\"btn btn-secondary\" onclick=\"window.location.href='/'\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path d=\"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path>\n                    <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n                  </svg>\n                  Go to Homepage\n                </button>\n              </div>\n\n              <div class=\"error-help\">\n                If the problem persists, please contact your system administrator or try clearing your browser cache.\n              </div>\n            </div>\n          </div>\n        `;\n\n    mainElement.innerHTML = errorPageHTML;\n    return false;\n  },\n\n  escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  },\n\n  handleError(message, error) {\n    console.error(`[RouterManager] ${message}:`, error);\n\n    if (window.ErrorManager) {\n      return ErrorManager.handle(error, {\n        context: 'RouterManager',\n        type: 'router:error',\n        data: {message}\n      });\n    }\n\n    return error;\n  },\n\n  getParams() {\n    const path = this.getPath();\n    return this.params.get(path) || {};\n  },\n\n  getParam(name) {\n    const params = this.getParams();\n    return params[name] || null;\n  },\n\n  hasRoute(path) {\n    return this.routes.has(path);\n  },\n\n  getRoute(path) {\n    return this.routes.get(path) || null;\n  },\n\n  getRoutes() {\n    return Array.from(this.routes.entries()).map(([path, config]) => ({\n      path,\n      ...config\n    }));\n  },\n\n  /**\n   * Translate title with {LNG_...} pattern support\n   * @param {string} title - Title string that may contain {LNG_...} patterns\n   * @returns {string} Translated title\n   */\n  translateTitle(title) {\n    if (!title || typeof title !== 'string') return title;\n\n    // Check if title contains {LNG_...} pattern\n    if (/{LNG_[^}]+}/.test(title)) {\n      const i18n = Now.getManager('i18n');\n      if (i18n?.interpolate) {\n        return i18n.interpolate(title, {});\n      }\n    }\n\n    return title;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('router', RouterManager);\n}\n\n// Expose globally\nwindow.RouterManager = RouterManager;\n","/**\n * SecurityConfig - Default security configurations\n * Used to configure security settings for different environments\n */\nconst SecurityConfig = {\n  // Development environment\n  development: {\n    debug: true,\n    csrf: {\n      enabled: true,\n      autoRefresh: true,\n      refreshInterval: 30 * 60 * 1000,\n      validateOnSubmit: true\n    },\n    jwt: {\n      enabled: true,\n      autoRefresh: true,\n      refreshBeforeExpiry: 5 * 60 * 1000\n    },\n    rateLimit: {\n      enabled: false, // Disabled in development\n      globalLimit: 1000,\n      windowMs: 15 * 60 * 1000\n    },\n    validation: {\n      enabled: true,\n      sanitizeInput: true,\n      maxInputLength: 10000\n    },\n    csp: {\n      enabled: false // Disabled in development for easier debugging\n    }\n  },\n\n  // Production environment\n  production: {\n    debug: false,\n    csrf: {\n      enabled: true,\n      autoRefresh: true,\n      refreshInterval: 15 * 60 * 1000, // More frequent in production\n      validateOnSubmit: true,\n      tokenLength: 40\n    },\n    jwt: {\n      enabled: true,\n      autoRefresh: true,\n      refreshBeforeExpiry: 2 * 60 * 1000, // Earlier refresh in production\n      validateSignature: true\n    },\n    rateLimit: {\n      enabled: true,\n      globalLimit: 100,\n      windowMs: 15 * 60 * 1000,\n      perEndpoint: {\n        'api/auth/login': {limit: 5, windowMs: 15 * 60 * 1000},\n        'api/auth/register': {limit: 3, windowMs: 60 * 60 * 1000},\n        'api/password/reset': {limit: 2, windowMs: 60 * 60 * 1000}\n      }\n    },\n    validation: {\n      enabled: true,\n      sanitizeInput: true,\n      validateOutput: true,\n      maxInputLength: 5000 // Stricter in production\n    },\n    csp: {\n      enabled: true,\n      directives: {\n        'default-src': [\"'self'\"],\n        'script-src': [\"'self'\"],\n        'style-src': [\"'self'\", \"'unsafe-inline'\"],\n        'img-src': [\"'self'\", \"data:\", \"https:\"],\n        'connect-src': [\"'self'\"],\n        'frame-src': [\"'none'\"],\n        'object-src': [\"'none'\"]\n      }\n    }\n  },\n\n  // Testing environment\n  testing: {\n    debug: true,\n    csrf: {\n      enabled: false, // Disabled for easier testing\n    },\n    jwt: {\n      enabled: true,\n      autoRefresh: false\n    },\n    rateLimit: {\n      enabled: false, // Disabled for testing\n    },\n    validation: {\n      enabled: true,\n      sanitizeInput: false // Allow raw input for testing\n    },\n    csp: {\n      enabled: false\n    }\n  },\n\n  /**\n   * Get configuration for specific environment\n   */\n  getConfig(environment = 'production') {\n    return this[environment] || this.production;\n  },\n\n  /**\n   * Get merged configuration with overrides\n   */\n  getMergedConfig(environment = 'production', overrides = {}) {\n    const baseConfig = this.getConfig(environment);\n    return this.mergeDeep(baseConfig, overrides);\n  },\n\n  /**\n   * Deep merge utility\n   */\n  mergeDeep(target, source) {\n    const isObject = (obj) => obj && typeof obj === 'object' && !Array.isArray(obj);\n\n    if (!isObject(target) || !isObject(source)) {\n      return source;\n    }\n\n    Object.keys(source).forEach(key => {\n      const targetValue = target[key];\n      const sourceValue = source[key];\n\n      if (Array.isArray(targetValue) && Array.isArray(sourceValue)) {\n        target[key] = targetValue.concat(sourceValue);\n      } else if (isObject(targetValue) && isObject(sourceValue)) {\n        target[key] = this.mergeDeep(Object.assign({}, targetValue), sourceValue);\n      } else {\n        target[key] = sourceValue;\n      }\n    });\n\n    return target;\n  }\n};\n\nwindow.SecurityConfig = SecurityConfig;","/**\n * SecurityManager - Central security management system\n * Manage CSRF, JWT, Rate Limiting, and other security.\n */\nconst SecurityManager = {\n  config: {\n    // CSRF Configuration\n    csrf: {\n      enabled: false,\n      tokenName: '_token',\n      headerName: 'X-CSRF-Token',\n      cookieName: 'XSRF-TOKEN',\n      tokenUrl: 'api/auth/csrf-token',\n      metaName: 'csrf-token',\n      autoRefresh: true,\n      refreshInterval: 30 * 60 * 1000, // 30 minutes\n      validateOnSubmit: true,\n      requireForMethods: ['POST', 'PUT', 'PATCH', 'DELETE'],\n      excludePaths: ['api/public/*', '/auth/verify'],\n      tokenLength: 40\n    },\n\n    // JWT Configuration\n    jwt: {\n      enabled: true,\n      cookieName: 'auth_token',\n      refreshCookieName: 'refresh_token',\n      storageKey: 'auth_user',\n      autoRefresh: true,\n      refreshBeforeExpiry: 5 * 60 * 1000, // 5 minutes\n      refreshEndpoint: 'api/auth/refresh',\n      validateSignature: true,\n      algorithm: 'HS256',\n      issuer: window.location.hostname,\n      audience: window.location.hostname\n    },\n\n    // Rate Limiting Configuration\n    rateLimit: {\n      enabled: true,\n      storage: 'memory', // 'memory', 'localStorage', 'sessionStorage'\n      globalLimit: 100, // requests per window\n      windowMs: 15 * 60 * 1000, // 15 minutes\n      perEndpoint: {\n        'api/auth/login': {limit: 5, windowMs: 15 * 60 * 1000},\n        'api/auth/register': {limit: 3, windowMs: 60 * 60 * 1000},\n        'api/password/reset': {limit: 3, windowMs: 60 * 60 * 1000}\n      },\n      skipSuccessfulRequests: false,\n      skipFailedRequests: false,\n      keyGenerator: null,\n      onLimitReached: null,\n      headers: true,\n      message: 'Too many requests, please try again later'\n    },\n\n    sanitization: {\n      enabled: true,\n      removeScripts: true,\n      removeEvents: true,\n      allowedTags: ['b', 'i', 'u', 'strong', 'em'],\n      maxInputLength: 10000\n    },\n\n    // Content Security Policy\n    csp: {\n      enabled: true,\n      directives: {\n        'default-src': [\"'self'\"],\n        'script-src': [\"'self'\", \"'unsafe-inline'\"],\n        'style-src': [\"'self'\", \"'unsafe-inline'\"],\n        'img-src': [\"'self'\", \"data:\", \"https:\"],\n        'font-src': [\"'self'\"],\n        'connect-src': [\"'self'\"],\n        'frame-src': [\"'none'\"],\n        'object-src': [\"'none'\"]\n      },\n      reportUri: 'api/csp-report'\n    }\n  },\n\n  state: {\n    initialized: false,\n    csrfToken: null,\n    jwtToken: null,\n    rateLimits: new Map(),\n    requestCounts: new Map(),\n    lastTokenRefresh: null,\n    securityHeaders: new Map(),\n    violations: new Set()\n  },\n\n  async init(options = {}) {\n    try {\n      this.config = {...this.config, ...this.mergeDeep(this.config, options)};\n\n      // Initialize CSRF protection\n      if (this.config.csrf.enabled) {\n        await this.initCSRF();\n      }\n\n      // Initialize JWT management\n      if (this.config.jwt.enabled) {\n        await this.initJWT();\n      }\n\n      // Initialize Rate Limiting\n      if (this.config.rateLimit.enabled) {\n        this.initRateLimit();\n      }\n\n      // Initialize CSP\n      if (this.config.csp.enabled) {\n        this.initCSP();\n      }\n\n      // Setup HTTP interceptors\n      this.setupHttpInterceptors();\n\n      this.state.initialized = true;\n\n      this.emit('security:initialized', {\n        csrf: this.config.csrf.enabled,\n        jwt: this.config.jwt.enabled,\n        rateLimit: this.config.rateLimit.enabled\n      });\n\n      return this;\n\n    } catch (error) {\n      this.handleError('Security initialization failed', error);\n      throw error;\n    }\n  },\n\n  // ============ CSRF Management ============\n  async initCSRF() {\n    try {\n      // Get existing token\n      this.state.csrfToken = this.getCSRFToken();\n\n      // Generate new token if needed\n      if (!this.state.csrfToken) {\n        await this.refreshCSRFToken();\n      }\n\n      // Setup auto-refresh\n      if (this.config.csrf.autoRefresh) {\n        this.startCSRFRefresh();\n      }\n\n      // Inject into existing forms\n      this.injectCSRFIntoForms();\n    } catch (error) {\n      this.handleError('CSRF initialization failed', error);\n    }\n  },\n\n  getCSRFToken() {\n    // Priority: Cookie > Meta tag > Input field\n    let token = null;\n\n    // Try cookie first\n    if (this.config.csrf.cookieName) {\n      token = this.getCookie(this.config.csrf.cookieName);\n    }\n\n    // Try meta tag\n    if (!token && this.config.csrf.metaName) {\n      const meta = document.querySelector(`meta[name=\"${this.config.csrf.metaName}\"]`);\n      token = meta?.getAttribute('content');\n    }\n\n    // Try hidden input\n    if (!token) {\n      const input = document.querySelector(`input[name=\"${this.config.csrf.tokenName}\"]`);\n      token = input?.value;\n    }\n\n    return token;\n  },\n\n  async refreshCSRFToken() {\n    try {\n      if (!this.config.csrf.enabled) return null;\n\n      const apiService = window.ApiService || window.Now?.getManager?.('api');\n      const headers = {\n        'X-Requested-With': 'XMLHttpRequest'\n      };\n\n      let response;\n      if (apiService?.get) {\n        response = await apiService.get(this.config.csrf.tokenUrl, {}, {headers});\n      } else if (window.simpleFetch?.get) {\n        response = await simpleFetch.get(this.config.csrf.tokenUrl, {headers});\n      } else {\n        throw new Error('ApiService is not available');\n      }\n\n      if (!response.success) {\n        throw new Error(`Failed to get CSRF token: ${response.status}`);\n      }\n\n      const data = response.data || {};\n      this.state.csrfToken = data.data.csrf_token || null;\n\n      // Update meta tag\n      this.updateCSRFMeta(this.state.csrfToken);\n\n      // Update all forms\n      this.updateCSRFInForms(this.state.csrfToken);\n\n      this.state.lastTokenRefresh = Date.now();\n      this.emit('csrf:refreshed', {token: this.state.csrfToken});\n\n      return this.state.csrfToken;\n\n    } catch (error) {\n      this.handleError('CSRF token refresh failed', error);\n      return null;\n    }\n  },\n\n  updateCSRFMeta(token) {\n    let meta = document.querySelector(`meta[name=\"${this.config.csrf.metaName}\"]`);\n    if (!meta) {\n      meta = document.createElement('meta');\n      meta.name = this.config.csrf.metaName;\n      document.head.appendChild(meta);\n    }\n    meta.setAttribute('content', token);\n  },\n\n  injectCSRFIntoForms() {\n    if (!this.state.csrfToken) return;\n\n    document.querySelectorAll('form').forEach(form => {\n      this.injectCSRFIntoForm(form, this.state.csrfToken);\n    });\n  },\n\n  injectCSRFIntoForm(form, token = null) {\n    if (!this.config.csrf.enabled) return;\n\n    token = token || this.state.csrfToken;\n    if (!token) return;\n\n    // Check if form should be excluded\n    const action = form.getAttribute('action') || '';\n    const method = (form.getAttribute('method') || 'GET').toUpperCase();\n\n    if (!this.config.csrf.requireForMethods.includes(method)) {\n      return;\n    }\n\n    if (this.isPathExcluded(action)) {\n      return;\n    }\n\n    // Check data-csrf attribute\n    const csrfSetting = form.dataset.csrf;\n    if (csrfSetting === 'false' || csrfSetting === 'disabled') {\n      return;\n    }\n\n    // Find or create CSRF input\n    let csrfInput = form.querySelector(`input[name=\"${this.config.csrf.tokenName}\"]`);\n    if (!csrfInput) {\n      csrfInput = document.createElement('input');\n      csrfInput.type = 'hidden';\n      csrfInput.name = this.config.csrf.tokenName;\n      form.appendChild(csrfInput);\n    }\n\n    csrfInput.value = token;\n  },\n\n  updateCSRFInForms(token) {\n    document.querySelectorAll(`input[name=\"${this.config.csrf.tokenName}\"]`).forEach(input => {\n      input.value = token;\n    });\n  },\n\n  startCSRFRefresh() {\n    if (this.csrfRefreshTimer) {\n      clearInterval(this.csrfRefreshTimer);\n    }\n\n    this.csrfRefreshTimer = setInterval(async () => {\n      await this.refreshCSRFToken();\n    }, this.config.csrf.refreshInterval);\n  },\n\n  // ============ JWT Management ============\n  async initJWT() {\n    try {\n      // Get existing token\n      this.state.jwtToken = this.getJWTToken();\n\n      // Validate token if exists\n      if (this.state.jwtToken) {\n        const isValid = this.validateJWTToken(this.state.jwtToken);\n        if (!isValid) {\n          await this.clearJWTToken();\n        }\n      }\n\n      // Setup auto-refresh\n      if (this.config.jwt.autoRefresh && this.state.jwtToken) {\n        this.startJWTRefresh();\n      }\n    } catch (error) {\n      this.handleError('JWT initialization failed', error);\n    }\n  },\n\n  getJWTToken() {\n    // JWT tokens are typically httpOnly cookies, so we can't access them directly\n    // This method would be used for non-httpOnly tokens stored in localStorage\n    return localStorage.getItem(this.config.jwt.storageKey);\n  },\n\n  validateJWTToken(token) {\n    if (!token) return false;\n\n    try {\n      const parts = token.split('.');\n      if (parts.length !== 3) return false;\n\n      const payload = JSON.parse(atob(parts[1]));\n\n      // Check expiration\n      if (payload.exp && Date.now() >= payload.exp * 1000) {\n        return false;\n      }\n\n      // Check issuer\n      if (this.config.jwt.issuer && payload.iss !== this.config.jwt.issuer) {\n        return false;\n      }\n\n      // Check audience\n      if (this.config.jwt.audience && payload.aud !== this.config.jwt.audience) {\n        return false;\n      }\n\n      return true;\n\n    } catch (error) {\n      return false;\n    }\n  },\n\n  async clearJWTToken() {\n    this.state.jwtToken = null;\n    localStorage.removeItem(this.config.jwt.storageKey);\n\n    if (this.jwtRefreshTimer) {\n      clearInterval(this.jwtRefreshTimer);\n    }\n\n    this.emit('jwt:cleared');\n  },\n\n  startJWTRefresh() {\n    if (this.jwtRefreshTimer) {\n      clearInterval(this.jwtRefreshTimer);\n    }\n\n    // Calculate refresh time based on token expiry\n    const token = this.state.jwtToken;\n    if (!token) return;\n\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      const exp = payload.exp;\n      const now = Math.floor(Date.now() / 1000);\n      const timeUntilRefresh = (exp - now) * 1000 - this.config.jwt.refreshBeforeExpiry;\n\n      if (timeUntilRefresh > 0) {\n        this.jwtRefreshTimer = setTimeout(async () => {\n          await this.refreshJWTToken();\n        }, timeUntilRefresh);\n      }\n\n    } catch (error) {\n    }\n  },\n\n  async refreshJWTToken() {\n    try {\n      const refreshUrl = this.config.jwt.refreshEndpoint || 'api/auth/refresh';\n      const apiService = window.ApiService || window.Now?.getManager?.('api');\n      const headers = {\n        'X-Requested-With': 'XMLHttpRequest'\n      };\n\n      let response;\n      if (apiService?.post) {\n        response = await apiService.post(refreshUrl, null, {headers});\n      } else if (window.simpleFetch?.post) {\n        response = await simpleFetch.post(refreshUrl, null, {headers});\n      } else {\n        throw new Error('ApiService is not available');\n      }\n\n      if (response.success) {\n        const data = response.data || {};\n        if (data.token) {\n          this.state.jwtToken = data.token;\n          localStorage.setItem(this.config.jwt.storageKey, data.token);\n          this.startJWTRefresh(); // Setup next refresh\n          this.emit('jwt:refreshed', {token: data.token});\n        }\n      }\n\n    } catch (error) {\n      this.handleError('JWT refresh failed', error);\n    }\n  },\n\n  // ============ Rate Limiting ============\n  initRateLimit() {\n    // Initialize storage\n    this.loadRateLimits();\n\n    // Setup cleanup interval\n    setInterval(() => {\n      this.cleanupExpiredLimits();\n    }, 60000); // Every minute\n  },\n\n  checkRateLimit(endpoint, identifier = null) {\n    if (!this.config.rateLimit.enabled) return {allowed: true};\n\n    identifier = identifier || this.generateRateLimitKey();\n    const now = Date.now();\n\n    // Check endpoint-specific limits\n    const endpointConfig = this.config.rateLimit.perEndpoint[endpoint];\n    if (endpointConfig) {\n      const result = this.checkLimit(endpoint, identifier, endpointConfig, now);\n      if (!result.allowed) return result;\n    }\n\n    // Check global limit\n    const globalResult = this.checkLimit('global', identifier, {\n      limit: this.config.rateLimit.globalLimit,\n      windowMs: this.config.rateLimit.windowMs\n    }, now);\n\n    return globalResult;\n  },\n\n  checkRateLimit(endpoint, identifier = null) {\n    if (!this.config.rateLimit.enabled) return {allowed: true};\n\n    identifier = identifier || this.generateRateLimitKey();\n    const now = Date.now();\n\n    // Check endpoint-specific limits\n    const endpointConfig = this.config.rateLimit.perEndpoint[endpoint];\n    if (endpointConfig) {\n      const result = this.checkLimit(endpoint, identifier, endpointConfig, now);\n      if (!result.allowed) return result;\n    }\n\n    // Check global limit\n    const globalResult = this.checkLimit('global', identifier, {\n      limit: this.config.rateLimit.globalLimit,\n      windowMs: this.config.rateLimit.windowMs\n    }, now);\n\n    return globalResult;\n  },\n\n  checkLimit(type, identifier, config, now) {\n    const key = `${type}:${identifier}`;\n    const window = this.state.rateLimits.get(key) || {\n      count: 0,\n      resetTime: now + config.windowMs\n    };\n\n    if (now > window.resetTime) {\n      window.count = 0;\n      window.resetTime = now + config.windowMs;\n    }\n\n    const allowed = window.count < config.limit;\n    const remaining = Math.max(0, config.limit - window.count - 1);\n    const resetTime = Math.ceil((window.resetTime - now) / 1000);\n\n    if (allowed) {\n      window.count++;\n      this.state.rateLimits.set(key, window);\n      this.saveRateLimits();\n    }\n\n    return {\n      allowed,\n      limit: config.limit,\n      remaining,\n      resetTime,\n      retryAfter: allowed ? 0 : resetTime\n    };\n  },\n\n  generateRateLimitKey() {\n    if (this.config.rateLimit.keyGenerator) {\n      return this.config.rateLimit.keyGenerator();\n    }\n\n    // Default: use IP + User Agent hash\n    const userAgent = navigator.userAgent;\n    const key = `${window.location.hostname}:${btoa(userAgent).slice(0, 10)}`;\n    return key;\n  },\n\n  loadRateLimits() {\n    try {\n      const storage = this.config.rateLimit.storage;\n      let data = null;\n\n      switch (storage) {\n        case 'localStorage':\n          data = localStorage.getItem('rate_limits');\n          break;\n        case 'sessionStorage':\n          data = sessionStorage.getItem('rate_limits');\n          break;\n        case 'memory':\n        default:\n          return; // Already initialized as Map\n      }\n\n      if (data) {\n        const parsed = JSON.parse(data);\n        this.state.rateLimits = new Map(Object.entries(parsed));\n      }\n\n    } catch (error) {\n    }\n  },\n\n  saveRateLimits() {\n    try {\n      const storage = this.config.rateLimit.storage;\n      if (storage === 'memory') return;\n\n      const data = JSON.stringify(Object.fromEntries(this.state.rateLimits));\n\n      switch (storage) {\n        case 'localStorage':\n          localStorage.setItem('rate_limits', data);\n          break;\n        case 'sessionStorage':\n          sessionStorage.setItem('rate_limits', data);\n          break;\n      }\n\n    } catch (error) {\n    }\n  },\n\n  cleanupExpiredLimits() {\n    const now = Date.now();\n    for (const [key, window] of this.state.rateLimits) {\n      if (now > window.resetTime) {\n        this.state.rateLimits.delete(key);\n      }\n    }\n    this.saveRateLimits();\n  },\n\n  // ============ Input Sanitization (no validation) ============\n  sanitizeInput(value) {\n    if (!this.config.sanitization.enabled) return value;\n    if (typeof value !== 'string') return value;\n\n    let sanitized = value;\n\n    // Remove script tags\n    if (this.config.sanitization.removeScripts) {\n      sanitized = sanitized.replace(/<script[^>]*>.*?<\\/script>/gi, '');\n    }\n\n    // Remove javascript: URLs\n    sanitized = sanitized.replace(/javascript:/gi, '');\n\n    // Remove event handlers\n    if (this.config.sanitization.removeEvents) {\n      sanitized = sanitized.replace(/on\\w+\\s*=/gi, '');\n    }\n\n    // Trim to max length\n    if (sanitized.length > this.config.sanitization.maxInputLength) {\n      sanitized = sanitized.substring(0, this.config.sanitization.maxInputLength);\n    }\n\n    return sanitized;\n  },\n\n  // ============ Content Security Policy ============\n  initCSP() {\n    // Add CSP meta tag if not exists\n    if (!document.querySelector('meta[http-equiv=\"Content-Security-Policy\"]')) {\n      this.addCSPMeta();\n    }\n\n    // Setup CSP violation reporting\n    document.addEventListener('securitypolicyviolation', this.handleCSPViolation.bind(this));\n  },\n\n  addCSPMeta() {\n    const meta = document.createElement('meta');\n    meta.setAttribute('http-equiv', 'Content-Security-Policy');\n\n    const directives = [];\n    for (const [key, values] of Object.entries(this.config.csp.directives)) {\n      directives.push(`${key} ${values.join(' ')}`);\n    }\n\n    meta.setAttribute('content', directives.join('; '));\n    document.head.appendChild(meta);\n  },\n\n  handleCSPViolation(event) {\n    const violation = {\n      directive: event.violatedDirective,\n      uri: event.blockedURI,\n      source: event.sourceFile,\n      line: event.lineNumber,\n      timestamp: Date.now()\n    };\n\n    this.state.violations.add(violation);\n    this.emit('csp:violation', violation);\n\n    // Report to server if configured\n    if (this.config.csp.reportUri) {\n      this.reportCSPViolation(violation);\n    }\n  },\n\n  async reportCSPViolation(violation) {\n    try {\n      const apiService = window.ApiService || window.Now?.getManager?.('api');\n      const headers = {\n        'Content-Type': 'application/json'\n      };\n\n      if (apiService?.post) {\n        await apiService.post(this.config.csp.reportUri, violation, {headers});\n      } else if (window.simpleFetch?.post) {\n        await simpleFetch.post(this.config.csp.reportUri, violation, {headers});\n      } else {\n        throw new Error('ApiService is not available');\n      }\n    } catch (error) {\n    }\n  },\n\n  // ============ HTTP Interceptors ============\n  setupHttpInterceptors() {\n    if (!window.http) return;\n\n    // Request interceptor\n    window.http.addRequestInterceptor(async (config) => {\n      // Add CSRF token\n      if (this.config.csrf.enabled && this.shouldAddCSRF(config)) {\n        config.headers = config.headers || {};\n        config.headers[this.config.csrf.headerName] = this.state.csrfToken;\n      }\n\n      // Check rate limits\n      if (this.config.rateLimit.enabled) {\n        const rateLimitResult = this.checkRateLimit(config.url);\n        if (!rateLimitResult.allowed) {\n          throw new Error(this.config.rateLimit.message);\n        }\n      }\n\n      // Sanitize request data (no validation)\n      if (config.body && this.config.sanitization.enabled) {\n        config.body = this.sanitizeRequestData(config.body);\n      }\n\n      return config;\n    });\n\n    // Response interceptor\n    window.http.addResponseInterceptor(\n      (response) => {\n        const newToken = response.headers[this.config.csrf.headerName.toLowerCase()];\n        if (newToken && newToken !== this.state.csrfToken) {\n          this.state.csrfToken = newToken;\n          this.updateCSRFMeta(newToken);\n          this.updateCSRFInForms(newToken);\n        }\n\n        return response;\n      },\n      (error) => {\n        // Handle security-related errors\n        if (error.status === 419) { // CSRF token mismatch\n          this.handleCSRFError();\n        } else if (error.status === 429) { // Rate limit exceeded\n          this.handleRateLimitError(error);\n        }\n\n        throw error;\n      }\n    );\n  },\n\n  shouldAddCSRF(config) {\n    if (!config.method) return false;\n\n    const method = config.method.toUpperCase();\n    if (!this.config.csrf.requireForMethods.includes(method)) {\n      return false;\n    }\n\n    return !this.isPathExcluded(config.url);\n  },\n\n  sanitizeRequestData(data) {\n    if (typeof data === 'string') {\n      try {\n        const parsed = JSON.parse(data);\n        return JSON.stringify(this.sanitizeObject(parsed));\n      } catch {\n        return this.sanitizeInput(data);\n      }\n    }\n\n    if (data instanceof FormData) {\n      const sanitized = new FormData();\n      for (const [key, value] of data) {\n        sanitized.append(key, this.sanitizeInput(value));\n      }\n      return sanitized;\n    }\n\n    return this.sanitizeObject(data);\n  },\n\n  sanitizeObject(obj) {\n    if (typeof obj !== 'object' || obj === null) {\n      return this.sanitizeInput(obj);\n    }\n\n    const sanitized = {};\n    for (const [key, value] of Object.entries(obj)) {\n      if (typeof value === 'object') {\n        sanitized[key] = this.sanitizeObject(value);\n      } else {\n        sanitized[key] = this.sanitizeInput(value);\n      }\n    }\n\n    return sanitized;\n  },\n\n  // ============ Form Interceptors ============\n  setupFormInterceptors() {\n    // Intercept form creation\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === 1) {\n            if (node.tagName === 'FORM') {\n              this.enhanceForm(node);\n            } else {\n              const forms = node.querySelectorAll('form');\n              forms.forEach(form => this.enhanceForm(form));\n            }\n          }\n        });\n      });\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n\n    // Enhance existing forms\n    document.querySelectorAll('form').forEach(form => {\n      this.enhanceForm(form);\n    });\n  },\n\n  enhanceForm(form) {\n    // Skip if already enhanced\n    if (form.dataset.securityEnhanced) return;\n\n    // Read security configuration from data attributes\n    const config = this.extractFormSecurityConfig(form);\n\n    // Apply CSRF protection\n    if (config.csrf.enabled !== false) {\n      this.injectCSRFIntoForm(form);\n    }\n\n    // Apply rate limiting\n    if (config.rateLimit !== false) {\n      this.applyFormRateLimit(form, config);\n    }\n\n    form.dataset.securityEnhanced = 'true';\n  },\n\n  extractFormSecurityConfig(form) {\n    return {\n      csrf: this.getDataBool(form, 'csrf', this.config.csrf.enabled),\n      rateLimit: this.getDataBool(form, 'rateLimit', this.config.rateLimit.enabled),\n      rateLimitEndpoint: form.dataset.rateLimitEndpoint,\n      rateLimitLimit: parseInt(form.dataset.rateLimitLimit) || null,\n      rateLimitWindow: parseInt(form.dataset.rateLimitWindow) || null\n    };\n  },\n\n  applyFormRateLimit(form, config) {\n    const originalSubmit = form.onsubmit;\n\n    form.onsubmit = (event) => {\n      const endpoint = config.rateLimitEndpoint || form.action || window.location.pathname;\n      const rateLimitConfig = {\n        limit: config.rateLimitLimit || this.config.rateLimit.globalLimit,\n        windowMs: config.rateLimitWindow || this.config.rateLimit.windowMs\n      };\n\n      const result = this.checkLimit('form', endpoint, rateLimitConfig, Date.now());\n\n      if (!result.allowed) {\n        event.preventDefault();\n        this.showRateLimitError(form, result);\n        return false;\n      }\n\n      return originalSubmit ? originalSubmit.call(form, event) : true;\n    };\n  },\n\n  // ============ Error Handlers ============\n  async handleCSRFError() {\n    // Skip CSRF error handling if CSRF is disabled\n    if (!this.config.csrf.enabled) {\n      return;\n    }\n\n    // If we have a token, try a single automatic retry before refreshing the token.\n    // This helps when the server marks tokens as pending and only consumes them on success.\n    try {\n      if (this.state.csrfToken) {\n        // Emit an event so callers can retry their last request if they want.\n        // Consumers can listen to 'csrf:retry' to re-send the failed request.\n        this.emit('csrf:retry', {token: this.state.csrfToken});\n\n        // Notify user that the token will be retried automatically\n        this.showNotification(Now.translate('Security token present. Attempting a retry...'), 'info');\n\n        // Give consumers a short window to retry; after that, refresh token as fallback\n        await new Promise(resolve => setTimeout(resolve, 800));\n\n        // If token is unchanged and no consumer retried, refresh as fallback\n        await this.refreshCSRFToken();\n        this.showNotification(Now.translate('Security token updated. Please try again.'), 'warning');\n        return;\n      }\n\n      // No token available -> refresh\n      await this.refreshCSRFToken();\n\n      this.showNotification(Now.translate('Security token updated. Please try again.'), 'warning');\n\n    } catch (error) {\n      this.showNotification(Now.translate('Security error. Please refresh the page.'), 'error');\n    }\n  },\n\n  handleRateLimitError(error) {\n    const retryAfter = error.headers?.['retry-after'] || 60;\n    const message = Now.translate(`Too many requests. Please try again in {retryAfter} seconds.`, {retryAfter: retryAfter});\n    this.showNotification(\n      message,\n      'warning'\n    );\n  },\n\n  showRateLimitError(form, result) {\n    const message = Now.translate('Too many attempts. Please try again in {retryAfter} seconds.', {retryAfter: result.retryAfter});\n\n    const messageContainer = form.querySelector('.form-message, .login-message');\n    if (messageContainer) {\n      messageContainer.textContent = message;\n      messageContainer.classList.add('warning');\n    } else {\n      this.showNotification(message, 'warning');\n    }\n  },\n\n  // ============ Utility Methods ============\n  isPathExcluded(path) {\n    if (!path) return false;\n\n    return this.config.csrf.excludePaths.some(pattern => {\n      if (pattern.endsWith('*')) {\n        return path.startsWith(pattern.slice(0, -1));\n      }\n      return path === pattern;\n    });\n  },\n\n  getDataBool(element, attribute, defaultValue = false) {\n    const value = element.dataset[attribute];\n    if (value === undefined) return defaultValue;\n    return value === 'true' || value === '1';\n  },\n\n  getCookie(name) {\n    const value = `; ${document.cookie}`;\n    const parts = value.split(`; ${name}=`);\n    if (parts.length === 2) {\n      return parts.pop().split(';').shift();\n    }\n    return null;\n  },\n\n  showNotification(message, type = 'info') {\n    if (window.NotificationManager) {\n      window.NotificationManager[type](message);\n    }\n  },\n\n  emit(event, data = {}) {\n    if (window.EventManager) {\n      window.EventManager.emit(event, data);\n    }\n\n    // Also emit as DOM event\n    const customEvent = new CustomEvent(event, {\n      detail: data,\n      bubbles: true,\n      cancelable: true\n    });\n    document.dispatchEvent(customEvent);\n  },\n\n  handleError(message, error) {\n    if (window.ErrorManager) {\n      window.ErrorManager.handle(error, {\n        context: 'SecurityManager',\n        message\n      });\n    }\n\n    this.emit('security:error', {message, error});\n  },\n\n  mergeDeep(target, source) {\n    const isObject = (obj) => obj && typeof obj === 'object' && !Array.isArray(obj);\n\n    if (!isObject(target) || !isObject(source)) {\n      return source;\n    }\n\n    Object.keys(source).forEach(key => {\n      const targetValue = target[key];\n      const sourceValue = source[key];\n\n      if (Array.isArray(targetValue) && Array.isArray(sourceValue)) {\n        target[key] = targetValue.concat(sourceValue);\n      } else if (isObject(targetValue) && isObject(sourceValue)) {\n        target[key] = this.mergeDeep(Object.assign({}, targetValue), sourceValue);\n      } else {\n        target[key] = sourceValue;\n      }\n    });\n\n    return target;\n  },\n\n  // ============ Public API ============\n  getCSRFTokenForForm(form) {\n    return this.state.csrfToken;\n  },\n\n  refreshTokens() {\n    return Promise.all([\n      this.refreshCSRFToken(),\n      this.refreshJWTToken()\n    ]);\n  },\n\n  isRateLimited(endpoint = null) {\n    const result = this.checkRateLimit(endpoint || window.location.pathname);\n    return !result.allowed;\n  },\n\n  getRateLimitStatus(endpoint = null) {\n    return this.checkRateLimit(endpoint || window.location.pathname);\n  },\n\n  addCSRFToRequest(config) {\n    if (this.config.csrf.enabled && this.shouldAddCSRF(config) && this.state.csrfToken) {\n      config.headers = config.headers || {};\n      config.headers[this.config.csrf.headerName] = this.state.csrfToken;\n    }\n    return config;\n  },\n\n  // ============ Cleanup ============\n  destroy() {\n    if (this.csrfRefreshTimer) {\n      clearInterval(this.csrfRefreshTimer);\n    }\n\n    if (this.jwtRefreshTimer) {\n      clearInterval(this.jwtRefreshTimer);\n      clearTimeout(this.jwtRefreshTimer);\n    }\n\n    this.state.initialized = false;\n    this.state.rateLimits.clear();\n    this.state.violations.clear();\n\n    this.emit('security:destroyed');\n  }\n};\n\n// Register with Now.js framework\nif (window.Now?.registerManager) {\n  Now.registerManager('security', SecurityManager);\n}\n\n// Expose globally\nwindow.SecurityManager = SecurityManager;\n","/**\n * ResponseHandler - Centralized API Response Handler\n *\n * Handles API responses with standardized actions that can be controlled by the server.\n * Reduces the need for repetitive JavaScript code by allowing the API to send commands.\n *\n * @example API Response Format:\n * {\n *   \"success\": true,\n *   \"message\": \"Operation completed\",\n *   \"data\": {\n *     \"data\": {...}\n *     \"actions\": [\n *       {\"type\": \"notification\", \"level\": \"success\", \"message\": \"Saved!\"},\n *       {\"type\": \"redirect\", \"url\": \"/dashboard\", \"delay\": 1000},\n *       {\"type\": \"modal\", \"action\": \"close\"}\n *     ],\n *     \"options\": {\n *       \"provinces\": {...},\n *       \"statuses\": {...}\n *     }\n *   }\n * }\n */\n\nconst ResponseHandler = {\n  config: {\n    defaultRedirectDelay: 1000,\n    defaultNotificationDuration: 5000,\n    allowEval: false, // Security: disabled by default\n    autoHandleFormResponses: true\n  },\n\n  state: {\n    initialized: false,\n    actionHandlers: new Map()\n  },\n\n  /**\n   * Initialize ResponseHandler\n   */\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n\n    // Register standard action handlers\n    this.registerStandardHandlers();\n\n    this.state.initialized = true;\n\n    return this;\n  },\n\n  /**\n   * Register all standard action handlers\n   */\n  registerStandardHandlers() {\n    // Notification handler\n    this.registerHandler('notification', (action) => {\n      const level = action.level || 'success'; // success, info, warning, error\n      const message = action.message || '';\n      const duration = action.duration || this.config.defaultNotificationDuration;\n\n      if (window.NotificationManager) {\n        NotificationManager[level](message, {duration});\n      }\n    });\n\n    // Alert handler\n    this.registerHandler('alert', (action) => {\n      const message = action.message || action.text || '';\n      if (message) alert(message);\n    });\n\n    // Confirm handler\n    this.registerHandler('confirm', async (action) => {\n      const message = action.message || action.text || '';\n      const onConfirm = action.onConfirm || action.callback;\n\n      const confirmed = await DialogManager.confirm(Now.translate(message));\n      if (confirmed && onConfirm) {\n        if (typeof onConfirm === 'string') {\n          this.executeCallback(onConfirm);\n        } else if (typeof onConfirm === 'function') {\n          onConfirm();\n        }\n      }\n    });\n\n    // Modal handler with template support\n    this.registerHandler('modal', async (action, context) => {\n      const modalAction = action.action || 'show';\n\n      if (modalAction === 'close' || modalAction === 'hide') {\n        if (window.modal && typeof window.modal.hide === 'function') {\n          window.modal.hide();\n        }\n        return;\n      }\n\n      if (modalAction === 'show' || modalAction === 'open') {\n        await this.handleModalShow(action, context);\n      }\n    });\n\n    // Redirect handler\n    this.registerHandler('redirect', (action, context) => {\n      const url = action.url || action.location || action.to;\n      const delay = action.delay !== undefined ? action.delay : this.config.defaultRedirectDelay;\n      const target = action.target || '_self';\n      const params = action.params || {};\n\n      if (!url) return;\n\n      const performRedirect = () => {\n        if (url === 'reload') {\n          if (context && typeof context.reload === 'function') {\n            context.reload();\n          } else {\n            window.location.reload();\n          }\n        } else if (url === 'refresh') {\n          window.location.reload();\n        } else if (url === 'back') {\n          window.history.back();\n        } else if (target !== '_self') {\n          window.open(url, target);\n        } else if (window.RouterManager?.state?.initialized) {\n          try {\n            RouterManager.navigate(url, params);\n          } catch (e) {\n            window.location.href = url;\n          }\n        } else {\n          window.location.href = url;\n        }\n      };\n\n      if (delay > 0) {\n        setTimeout(performRedirect, delay);\n      } else {\n        performRedirect();\n      }\n    });\n\n    // Update element content\n    this.registerHandler('update', (action) => {\n      const target = action.target || action.selector || action.element;\n      const content = action.content || action.html || action.value || '';\n      const method = action.method || 'html'; // html, text, value, append, prepend\n\n      if (!target) return;\n\n      const elements = typeof target === 'string'\n        ? document.querySelectorAll(target)\n        : [target];\n\n      elements.forEach(el => {\n        if (!el) return;\n\n        switch (method) {\n          case 'html':\n            el.innerHTML = content;\n            break;\n          case 'text':\n            el.textContent = content;\n            break;\n          case 'value':\n            if ('value' in el) el.value = content;\n            break;\n          case 'append':\n            el.insertAdjacentHTML('beforeend', content);\n            break;\n          case 'prepend':\n            el.insertAdjacentHTML('afterbegin', content);\n            break;\n          case 'attr':\n            // Set single attribute on element\n            const attrName = action.attr || action.attribute;\n            if (attrName) {\n              el.setAttribute(attrName, content);\n            }\n            break;\n          case 'attrs':\n            // Set multiple attributes on element\n            const attrs = action.attrs || action.attributes || {};\n            Object.entries(attrs).forEach(([name, value]) => {\n              // Handle special properties\n              if (name === 'checked' || name === 'disabled' || name === 'selected') {\n                el[name] = !!value;\n              } else if (name === 'value') {\n                el.value = value;\n              } else if (name === 'class' || name === 'className') {\n                el.className = value;\n              } else if (name === 'text' || name === 'textContent') {\n                el.textContent = value;\n              } else if (name === 'html' || name === 'innerHTML') {\n                el.innerHTML = value;\n              } else {\n                el.setAttribute(name, value);\n              }\n            });\n            break;\n        }\n\n        // Execute scripts if present\n        if (method === 'html' || method === 'append' || method === 'prepend') {\n          const scripts = el.querySelectorAll('script');\n          scripts.forEach(script => {\n            try {\n              const fn = new Function(script.textContent);\n              fn();\n            } catch (e) {\n              console.error('Error executing script:', e);\n            }\n          });\n        }\n      });\n    });\n\n    // Render template with TemplateManager\n    this.registerHandler('render', async (action, context) => {\n      const target = action.target || action.selector || action.element;\n      const template = action.template || action.templateUrl;\n      const method = action.method || 'html'; // html, append, prepend\n\n      if (!target || !template) {\n        console.warn('ResponseHandler: render action requires target and template');\n        return;\n      }\n\n      if (!window.TemplateManager) {\n        console.error('ResponseHandler: TemplateManager is not available');\n        return;\n      }\n\n      try {\n        // Load template from server\n        const templateContent = await window.TemplateManager.loadFromServer(template);\n\n        // Create container for rendering\n        const container = document.createElement('div');\n        container.innerHTML = templateContent;\n\n        // Prepare data for template\n        // Priority: action.data > context.data > empty object\n        let templateData = {};\n\n        if (action.data) {\n          templateData = action.data;\n        } else if (context.data) {\n          // Pass the full response context to template\n          templateData = context.data;\n        }\n\n        // Create context for template\n        const templateContext = {\n          template: templateContent,\n          state: templateData,\n          reactive: false,\n          debug: this.config.debug || false\n        };\n\n        // Process template with data\n        window.TemplateManager.processTemplate(container, templateContext);\n\n        // Get target element(s)\n        const elements = typeof target === 'string'\n          ? document.querySelectorAll(target)\n          : [target];\n\n        // Update each target element\n        elements.forEach(el => {\n          if (!el) return;\n\n          switch (method) {\n            case 'html':\n              el.innerHTML = container.innerHTML;\n              break;\n            case 'append':\n              el.insertAdjacentHTML('beforeend', container.innerHTML);\n              break;\n            case 'prepend':\n              el.insertAdjacentHTML('afterbegin', container.innerHTML);\n              break;\n          }\n        });\n\n      } catch (error) {\n        console.error('ResponseHandler: Error rendering template', error);\n\n        if (window.ErrorManager) {\n          window.ErrorManager.handle(error, {\n            context: 'ResponseHandler.render',\n            data: {action}\n          });\n        }\n      }\n    });\n\n    // Remove element\n    this.registerHandler('remove', (action) => {\n      const target = action.target || action.selector || action.element;\n      const animate = action.animate !== false;\n\n      if (!target) return;\n\n      const elements = typeof target === 'string'\n        ? document.querySelectorAll(target)\n        : [target];\n\n      elements.forEach(el => {\n        if (!el) return;\n\n        if (animate && window.$G) {\n          $G(el).fadeOut(() => el.remove());\n        } else {\n          el.remove();\n        }\n      });\n    });\n\n    // Add/Remove/Toggle CSS class\n    this.registerHandler('class', (action) => {\n      const target = action.target || action.selector || action.element;\n      const className = action.class || action.className || '';\n      const method = action.method || 'add'; // add, remove, toggle\n\n      if (!target || !className) return;\n\n      const elements = typeof target === 'string'\n        ? document.querySelectorAll(target)\n        : [target];\n\n      elements.forEach(el => {\n        if (!el) return;\n\n        switch (method) {\n          case 'add':\n            el.classList.add(...className.split(' '));\n            break;\n          case 'remove':\n            el.classList.remove(...className.split(' '));\n            break;\n          case 'toggle':\n            className.split(' ').forEach(cls => el.classList.toggle(cls));\n            break;\n        }\n      });\n    });\n\n    // Set element attribute\n    this.registerHandler('attribute', (action) => {\n      const target = action.target || action.selector || action.element;\n      const name = action.name || action.attribute;\n      const value = action.value;\n\n      if (!target || !name) return;\n\n      const elements = typeof target === 'string'\n        ? document.querySelectorAll(target)\n        : [target];\n\n      elements.forEach(el => {\n        if (!el) return;\n\n        if (value === null || value === undefined) {\n          el.removeAttribute(name);\n        } else {\n          el.setAttribute(name, value);\n        }\n      });\n    });\n\n    // Trigger event\n    this.registerHandler('event', (action) => {\n      const eventName = action.event || action.name;\n      const data = action.data || {};\n      const target = action.target || document;\n\n      if (!eventName) return;\n\n      const targetEl = typeof target === 'string'\n        ? document.querySelector(target)\n        : target;\n\n      if (!targetEl) return;\n\n      const event = new CustomEvent(eventName, {\n        detail: data,\n        bubbles: action.bubbles !== false,\n        cancelable: action.cancelable !== false\n      });\n\n      targetEl.dispatchEvent(event);\n    });\n\n    // Execute callback function\n    this.registerHandler('callback', (action) => {\n      const fn = action.function || action.callback || action.fn;\n      const args = action.args || action.arguments || [];\n\n      this.executeCallback(fn, args);\n    });\n\n    // Eval code (disabled by default for security)\n    this.registerHandler('eval', (action) => {\n      if (!this.config.allowEval) {\n        console.warn('ResponseHandler: eval is disabled for security. Set config.allowEval = true to enable.');\n        return;\n      }\n\n      const code = action.code || action.script;\n      if (!code) return;\n\n      try {\n        const fn = new Function(code);\n        fn();\n      } catch (e) {\n        console.error('ResponseHandler: eval error', e);\n      }\n    });\n\n    // Download file\n    this.registerHandler('download', (action) => {\n      const url = action.url || action.href;\n      const filename = action.filename || action.name;\n\n      if (!url) return;\n\n      const a = document.createElement('a');\n      a.href = url;\n      if (filename) a.download = filename;\n      a.target = '_blank';\n      document.body.appendChild(a);\n      a.click();\n      setTimeout(() => document.body.removeChild(a), 100);\n    });\n\n    // Copy to clipboard\n    this.registerHandler('clipboard', async (action) => {\n      const text = action.text || action.content || action.value || '';\n\n      if (!text) {\n        console.warn('[ResponseHandler] No text provided for clipboard action');\n        return;\n      }\n\n      try {\n        // Use Utils.dom.copyToClipboard if available\n        if (window.Utils?.dom?.copyToClipboard) {\n          const success = await Utils.dom.copyToClipboard(text);\n\n          if (success) {\n            if (action.notify !== false && window.NotificationManager) {\n              NotificationManager.success(action.message || 'Copied to clipboard');\n            }\n          } else {\n            throw new Error('Failed to copy to clipboard');\n          }\n        } else {\n          // Fallback to direct Clipboard API\n          if (navigator.clipboard && navigator.clipboard.writeText) {\n            await navigator.clipboard.writeText(text);\n            if (action.notify !== false && window.NotificationManager) {\n              NotificationManager.success(action.message || 'Copied to clipboard');\n            }\n          } else {\n            console.error('[ResponseHandler] No clipboard method available');\n            if (window.NotificationManager) {\n              NotificationManager.error('Clipboard not supported in this browser');\n            }\n          }\n        }\n      } catch (error) {\n        console.error('[ResponseHandler] Failed to copy to clipboard:', error);\n        if (action.notify !== false && window.NotificationManager) {\n          NotificationManager.error(action.errorMessage || 'Failed to copy to clipboard');\n        }\n      }\n    });\n\n    // Scroll to element\n    this.registerHandler('scroll', (action) => {\n      const target = action.target || action.selector || action.element;\n      const behavior = action.behavior || 'smooth';\n      const block = action.block || 'center';\n\n      if (!target) return;\n\n      const element = typeof target === 'string'\n        ? document.querySelector(target)\n        : target;\n\n      if (element && element.scrollIntoView) {\n        element.scrollIntoView({behavior, block});\n      }\n    });\n\n    // Focus element\n    this.registerHandler('focus', (action) => {\n      const target = action.target || action.selector || action.element;\n\n      if (!target) return;\n\n      const element = typeof target === 'string'\n        ? document.querySelector(target)\n        : target;\n\n      if (element && element.focus) {\n        element.focus();\n        if (action.select && element.select) {\n          element.select();\n        }\n      }\n    });\n\n    // Form errors handler - highlight fields and optionally show notification\n    this.registerHandler('formErrors', (action, context) => {\n      const errors = action.errors || {};\n      const form = context.form || null;\n      const showNotification = action.notification !== false;\n      const focusFirst = action.focusFirst !== false;\n\n      if (!window.FormError) {\n        console.warn('ResponseHandler: FormError is not available');\n        return;\n      }\n\n      const errorMessages = [];\n      let firstField = null;\n\n      Object.entries(errors).forEach(([field, messages]) => {\n        const message = Array.isArray(messages) ? messages[0] : messages;\n\n        // Highlight the field\n        FormError.showFieldError(field, message, form);\n\n        // Collect error messages\n        errorMessages.push(message);\n\n        // Track first field for focus\n        if (!firstField) {\n          firstField = document.getElementById(field) || document.querySelector(`[name=\"${field}\"]`);\n        }\n      });\n\n      // Show combined notification if enabled\n      if (showNotification && window.NotificationManager && errorMessages.length > 0) {\n        const level = action.level || 'error';\n        const combinedMessage = errorMessages.length === 1\n          ? errorMessages[0]\n          : errorMessages.map(m => `• ${m}`).join('\\n');\n        NotificationManager[level](combinedMessage);\n      }\n\n      // Focus first error field if enabled\n      if (focusFirst && firstField && firstField.focus) {\n        firstField.focus();\n        if (firstField.select) {\n          firstField.select();\n        }\n      }\n    });\n\n    // Reload/refresh specific component\n    this.registerHandler('reload', async (action, context) => {\n      const target = action.target || action.component;\n      if (context && typeof context.reload === 'function') {\n        await context.reload();\n        return;\n      } else if (!target) {\n        window.location.reload();\n        return;\n      }\n\n      // Emit event for component to reload itself\n      this.executeAction({\n        type: 'event',\n        event: 'component:reload',\n        target: target,\n        data: action.data || {}\n      });\n    });\n  },\n\n  /**\n   * Register a custom action handler\n   */\n  registerHandler(type, handler) {\n    if (typeof handler !== 'function') {\n      console.error('ResponseHandler: handler must be a function');\n      return;\n    }\n\n    this.state.actionHandlers.set(type, handler);\n  },\n\n  /**\n   * Process API response\n   */\n  async process(response, context = {}) {\n    if (!response) return;\n\n    // Ensure context.data is populated if not already present\n    if (!context.data) {\n      context.data = response;\n    }\n\n    if (response.actions) {\n      // Handle actions array\n      if (Array.isArray(response.actions)) {\n        for (const action of response.actions) {\n          await this.executeAction(action, context);\n        }\n      } else if (response.actions.type) {\n        // Single action object\n        await this.executeAction(response.actions, response);\n      }\n    }\n\n    return response;\n  },\n\n  /**\n   * Execute a single action\n   */\n  async executeAction(action, context = {}) {\n    if (!action || !action.type) return;\n\n    const handler = this.state.actionHandlers.get(action.type);\n\n    if (!handler) {\n      console.warn(`ResponseHandler: No handler registered for action type \"${action.type}\"`);\n      return;\n    }\n\n    try {\n      // Check condition if specified\n      if (action.condition !== undefined) {\n        const conditionMet = typeof action.condition === 'function'\n          ? action.condition(context)\n          : action.condition;\n\n        if (!conditionMet) return;\n      }\n\n      await handler(action, context);\n    } catch (error) {\n      console.error(`ResponseHandler: Error executing action \"${action.type}\"`, error);\n\n      if (window.ErrorManager) {\n        ErrorManager.handle(error, {\n          context: 'ResponseHandler.executeAction',\n          data: {action, context}\n        });\n      }\n    }\n  },\n\n  /**\n   * Execute callback function by name or reference\n   */\n  executeCallback(fn, args = []) {\n    if (!fn) return;\n\n    try {\n      if (typeof fn === 'function') {\n        fn(...args);\n      } else if (typeof fn === 'string') {\n        // Try to resolve function from window scope\n        const parts = fn.split('.');\n        let func = window;\n\n        for (const part of parts) {\n          func = func[part];\n          if (!func) break;\n        }\n\n        if (typeof func === 'function') {\n          func(...args);\n        } else {\n          console.warn(`ResponseHandler: Function \"${fn}\" not found`);\n        }\n      }\n    } catch (error) {\n      console.error('ResponseHandler: Error executing callback', error);\n    }\n  },\n\n  /**\n   * Handle modal show with template/HTML support\n   * Priority: API force > API suggest > Frontend default\n   * @private\n   */\n  async handleModalShow(action, context) {\n    try {\n      let modalConfig = {};\n\n      // Priority 1: Check if frontend defined modal config\n      if (context.modalConfig && !action.force) {\n        modalConfig = {...context.modalConfig};\n      }\n\n      // Priority 2: API can suggest or override\n      if (action.template) {\n        if (action.force) {\n          // Force override frontend config\n          modalConfig.template = action.template;\n          modalConfig.title = action.title || modalConfig.title;\n          modalConfig.className = action.className || modalConfig.className;\n        } else if (!modalConfig.template) {\n          // Only use API config if frontend didn't specify\n          modalConfig.template = action.template;\n          modalConfig.title = action.title;\n          modalConfig.className = action.className;\n        }\n      }\n\n      // Priority 3: Direct HTML (highest priority for content)\n      if (action.html) {\n        return await this.showModal(action.html, {\n          title: action.title || modalConfig.title || '',\n          className: action.className || modalConfig.className || '',\n          width: action.width || modalConfig.width,\n          maxWidth: action.maxWidth || modalConfig.maxWidth,\n          buttons: action.button || action.buttons || modalConfig.buttons,\n          onShown: action.onShown || modalConfig.onShown,\n          onHide: action.onHide || modalConfig.onHide\n        });\n      }\n\n      // Load template\n      let content = '';\n      if (modalConfig.template) {\n        content = await this.loadModalTemplate({\n          template: modalConfig.template,\n          templateUrl: action.templateUrl\n        }, context);\n      } else if (action.templateUrl) {\n        content = await this.loadTemplateFromUrl(action.templateUrl);\n      } else if (action.content) {\n        content = action.content;\n      } else {\n        throw new Error('No template, templateUrl, HTML, or content provided for modal');\n      }\n\n      // Extract data and options\n      const modalData = this.extractModalData(action, context);\n      const modalOptions = this.extractModalOptions(action, context);\n\n      // Register state and render\n      if (modalData && Object.keys(modalData).length > 0) {\n        await this.registerModalState(modalData, modalOptions);\n      }\n\n      const renderedContent = await this.renderModalContent(\n        content,\n        modalData,\n        modalOptions\n      );\n\n      // Show modal\n      await this.showModal(renderedContent, {\n        title: modalConfig.title || action.title || '',\n        className: modalConfig.className || action.className || action.class || '',\n        width: modalConfig.width || action.width,\n        maxWidth: modalConfig.maxWidth || action.maxWidth,\n        height: modalConfig.height || action.height,\n        maxHeight: modalConfig.maxHeight || action.maxHeight,\n        closeButton: modalConfig.closeButton !== false && action.closeButton !== false,\n        backdrop: modalConfig.backdrop !== false && action.backdrop !== false,\n        keyboard: modalConfig.keyboard !== false && action.keyboard !== false,\n        buttons: action.button || action.buttons || modalConfig.buttons,\n        data: modalData,\n        options: modalOptions,\n        onShown: action.onShown || modalConfig.onShown,\n        onHide: action.onHide || modalConfig.onHide\n      });\n\n      // Emit event\n      this.emit('modal:shown', {\n        template: modalConfig.template || action.template,\n        data: modalData,\n        options: modalOptions\n      });\n\n    } catch (error) {\n      console.error('ResponseHandler: Error showing modal', error);\n\n      if (window.ErrorManager) {\n        ErrorManager.handle(error, {\n          context: 'ResponseHandler.handleModalShow',\n          data: {action, context}\n        });\n      }\n\n      // Show error modal\n      this.showErrorModal(error.message);\n    }\n  },\n\n  /**\n   * Load template from TemplateManager\n   * @private\n   */\n  async loadModalTemplate(action, context) {\n    const templateName = action.template;\n\n    if (!window.TemplateManager) {\n      throw new Error('TemplateManager is not available');\n    }\n\n    // Load template content\n    const templateContent = await TemplateManager.loadFromServer(templateName);\n\n    return templateContent;\n  },\n\n  /**\n   * Load template from URL\n   * @private\n   */\n  async loadTemplateFromUrl(url) {\n    if (!window.TemplateManager) {\n      throw new Error('TemplateManager is not available');\n    }\n\n    return await TemplateManager.loadFromServer(url);\n  },\n\n  /**\n   * Extract modal data from action and context\n   * @private\n   */\n  extractModalData(action, context) {\n    let data = context.data || action.data || {};\n\n    // Helper to extract value by key path\n    const getValue = (source, keyPath) => {\n      const keys = keyPath.split('.');\n      let value = source;\n      for (const key of keys) {\n        if (value && typeof value === 'object' && key in value) {\n          value = value[key];\n        } else {\n          return undefined;\n        }\n      }\n      return value;\n    };\n\n    // If dataKey is specified, get data from context/response\n    if (action.dataKey) {\n      let extractedValue = undefined;\n\n      // 1. Try context.data\n      if (context.data) {\n        extractedValue = getValue(context.data, action.dataKey);\n      }\n\n      // 2. Try context.instance.state (Fallback as per user request)\n      if (extractedValue === undefined && context.instance && context.instance.state) {\n        extractedValue = getValue(context.instance.state, action.dataKey);\n\n        // Special case: if dataKey is 'data' and we didn't find it in state,\n        // maybe the user means state.data (form data)\n        if (extractedValue === undefined && action.dataKey === 'data' && context.instance.state.data) {\n          extractedValue = context.instance.state.data;\n        }\n      }\n\n      if (extractedValue !== undefined) {\n        data = {...data, ...extractedValue};\n      }\n    } else if (!action.dataKey && context.data && !action.data) {\n      // Auto-extract from context.data if no dataKey and no explicit data\n      data = context.data.data || context.data;\n    }\n\n    return data;\n  },\n\n  /**\n   * Extract modal options (select options, etc.)\n   * @private\n   */\n  extractModalOptions(action, context) {\n    let options = {};\n\n    if (context.options) {\n      // Top-level options\n      options = {...context.options};\n    } else if (action.optionsKey && context) {\n      // Custom optionsKey (Advanced usage)\n      const keys = action.optionsKey.split('.');\n      let value = context;\n\n      for (const key of keys) {\n        if (value && typeof value === 'object' && key in value) {\n          value = value[key];\n        } else {\n          value = null;\n          break;\n        }\n      }\n\n      if (value !== null) {\n        options = {...options, ...value};\n      }\n    }\n\n    return options;\n  },\n\n  /**\n   * Show modal with content\n   * @private\n   */\n  async showModal(content, options = {}) {\n    // Create or reuse modal instance\n    if (!window.modal || !(window.modal instanceof Modal)) {\n      window.modal = new Modal({\n        closeButton: true,\n        animation: true,\n        backdrop: true,\n        keyboard: true,\n        ...options\n      });\n    }\n\n    // Update modal options\n    if (options.title) {\n      window.modal.setTitle(options.title);\n    }\n\n    if (options.className) {\n      window.modal.modal.className = `modal ${options.className}`.trim();\n    }\n\n    // Register state module for modal data\n    if (options.data && Object.keys(options.data).length > 0) {\n      await this.registerModalState(options.data, options.options);\n    }\n\n    // Set content - check if already rendered (Node/Fragment) or needs rendering\n    if (content instanceof Node || content instanceof DocumentFragment) {\n      // Already rendered (from handleModalShow), use directly\n      window.modal.setContent(content);\n    } else if (window.TemplateManager && options.data) {\n      // String template with data - render it\n      const container = await this.renderModalContent(content, options.data, options.options);\n      window.modal.setContent(container);\n    } else {\n      // Plain string without data - use as is\n      window.modal.setContent(content);\n    }\n\n    // Show modal\n    window.modal.show();\n\n    // Call onShown callback\n    if (typeof options.onShown === 'function') {\n      setTimeout(() => options.onShown.call(window.modal), 200);\n    }\n  },\n\n  /**\n   * Register modal state in StateManager\n   * @private\n   */\n  async registerModalState(data, options = {}) {\n    // Store data and options globally for FormManager to access in modal forms\n    if (data && Object.keys(data).length > 0) {\n      window._currentModalData = data;\n    }\n\n    if (options && Object.keys(options).length > 0) {\n      window._currentModalOptions = options;\n    }\n\n    if (!window.StateManager) return;\n\n    const modalState = {\n      state: {\n        formData: data,\n        options: options,\n        loading: false,\n        errors: {}\n      },\n      getters: {\n        formData: (state) => state.formData,\n        options: (state) => state.options,\n        isLoading: (state) => state.loading,\n        hasErrors: (state) => Object.keys(state.errors).length > 0\n      },\n      mutations: {\n        setFormData(state, data) {\n          state.formData = {...state.formData, ...data};\n        },\n        setField(state, {field, value}) {\n          state.formData[field] = value;\n        },\n        setLoading(state, loading) {\n          state.loading = loading;\n        },\n        setError(state, {field, message}) {\n          state.errors[field] = message;\n        },\n        clearErrors(state) {\n          state.errors = {};\n        }\n      },\n      actions: {\n        async updateField({commit}, {field, value}) {\n          commit('setField', {field, value});\n        },\n        async submitForm({state, commit}) {\n          commit('setLoading', true);\n          commit('clearErrors');\n\n          // Form submission will be handled by form component\n          return state.formData;\n        }\n      }\n    };\n\n    // Register or force-update module\n    StateManager.registerModule('modal', modalState, {force: true});\n  },\n\n  /**\n   * Render modal content with TemplateManager\n   * @private\n   */\n  async renderModalContent(template, data, options = {}) {\n    if (!window.TemplateManager) {\n      return template;\n    }\n\n    // Create container for rendering\n    const container = document.createElement('div');\n    container.innerHTML = template;\n\n    // Create context for template\n    const context = {\n      template: template,\n      state: {\n        ...data\n      },\n      reactive: true,\n      debug: this.config.debug || false\n    };\n\n    // Process template with data\n    TemplateManager.processTemplate(container, context);\n\n    // Return DocumentFragment containing the processed nodes (without wrapper div)\n    const fragment = document.createDocumentFragment();\n    while (container.firstChild) {\n      fragment.appendChild(container.firstChild);\n    }\n    return fragment;\n  },\n\n  /**\n   * Show error modal\n   * @private\n   */\n  showErrorModal(message) {\n    const errorHtml = `\n      <div class=\"error-modal\">\n        <div class=\"modal-body icon-warning\">\n          <div>\n            <h3>Error</h3>\n            <p>${message}</p>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button class=\"btn btn-primary\" onclick=\"window.modal?.hide()\">Close</button>\n        </div>\n      </div>\n    `;\n\n    if (window.Modal) {\n      if (!window.modal) {\n        window.modal = new Modal({closeButton: true});\n      }\n      window.modal.setContent(errorHtml);\n      window.modal.show();\n    } else {\n      alert('Error: ' + message);\n    }\n  },\n\n  /**\n   * Emit event\n   */\n  emit(eventName, data) {\n    EventManager.emit(eventName, data);\n  }\n};\n\n// Auto-initialize\nif (typeof window !== 'undefined') {\n  window.ResponseHandler = ResponseHandler;\n\n  // Register with Now framework if available\n  if (window.Now?.registerManager) {\n    Now.registerManager('response', ResponseHandler);\n  }\n\n  // Auto-init on DOM ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      ResponseHandler.init();\n    });\n  } else {\n    ResponseHandler.init();\n  }\n}\n\n// Expose globally\nwindow.ResponseHandler = ResponseHandler;\n","/**\n * A modern, promise-based HTTP client for making API requests with security features.\n *\n * @class HttpClient\n * @description Provides a flexible and extensible way to make HTTP requests with support for\n * interceptors, CSRF protection, response handling, and more.\n *\n * @example\n *\n * const http = new HttpClient({\n *   baseURL: 'https://api.example.com'\n * });\n *\n *\n * const response = await http.get('/users');\n *\n *\n * const createResponse = await http.post('/users', { name: 'John Doe' });\n *\n * @example\n *\n * http.addRequestInterceptor(config => {\n *   config.headers['Authorization'] = `Bearer ${getToken()}`;\n *   return config;\n * });\n *\n * @property {string} baseURL - Base URL for all requests\n * @property {Object} defaultHeaders - Default headers sent with every request\n * @property {number} timeout - Request timeout in milliseconds\n * @property {Function} responseHandler - Custom response handler function\n * @property {Object} interceptors - Request and response interceptors\n * @property {boolean} throwOnError - Whether to throw errors on non-2xx responses\n * @property {string} csrfToken - CSRF token for request protection\n * @property {string} csrfHeaderName - Name of the CSRF header\n * @property {string} csrfCookieName - Name of the CSRF cookie\n * @property {string} csrfTokenSelector - CSS selector for the CSRF meta tag\n * @property {Object} security - Security configuration options\n */\nclass HttpClient {\n  constructor(options = {}) {\n    this.baseURL = options.baseURL || '';\n    this.defaultHeaders = {\n      'X-Requested-With': 'XMLHttpRequest',\n      ...options.headers\n    };\n    this.timeout = options.timeout || 30000;\n    this.responseHandler = options.responseHandler;\n    this.interceptors = {\n      request: [],\n      response: []\n    };\n\n    this.throwOnError = options.throwOnError !== false;\n    this.csrfToken = null;\n\n    this.security = options.security || {\n      csrf: {\n        enabled: false,\n        required: true,\n        tokenName: '_token',\n        headerName: 'X-CSRF-Token'\n      },\n      rateLimit: {\n        enabled: false\n      },\n      validation: {\n        enabled: false\n      }\n    };\n\n    // Use CSRF config from security or use default.\n    this.csrfHeaderName = this.security.csrf.headerName || 'X-CSRF-Token';\n    this.csrfCookieName = options.csrfCookieName || 'XSRF-TOKEN';\n    this.csrfTokenSelector = options.csrfTokenSelector || 'meta[name=\"csrf-token\"]';\n\n    // Always attempt to capture CSRF token so it's ready when needed\n    this.setupCsrfToken();\n\n    this.setupSecurity();\n  }\n\n  /**\n   * Setup CSRF token from meta tag or cookie.\n   * This method checks for a meta tag with the CSRF token or retrieves it from cookies.\n   * If found, it sets the csrfToken property.\n   */\n  setupCsrfToken() {\n    const metaToken = document.querySelector(this.csrfTokenSelector);\n    if (metaToken) {\n      this.csrfToken = metaToken.getAttribute('content');\n      return;\n    }\n\n    const cookies = document.cookie.split(';');\n    for (const cookie of cookies) {\n      const [name, value] = cookie.trim().split('=');\n      if (name === this.csrfCookieName) {\n        this.csrfToken = decodeURIComponent(value);\n        return;\n      }\n    }\n\n    console.warn('CSRF token not found in meta tag or cookie');\n  }\n\n  /**\n   * Setup security features like CSRF, rate limiting, and validation.\n   * This method checks if SecurityManager is available and sets up interceptors accordingly.\n   */\n  setupSecurity() {\n    this.addRequestInterceptor(async (config) => {\n      try {\n        return SecurityManager.addCSRFToRequest(config);\n      } catch (error) {\n        console.warn('CSRF interceptor error:', error);\n        return config;\n      }\n    });\n\n    this.addRequestInterceptor(async (config) => {\n      try {\n        if (this.security.rateLimit.enabled) {\n          const rateLimitResult = SecurityManager.checkRateLimit(config.url);\n          if (!rateLimitResult.allowed) {\n            throw new HttpError('Rate limit exceeded', 429, {\n              retryAfter: rateLimitResult.retryAfter\n            });\n          }\n        }\n        return config;\n      } catch (error) {\n        console.warn('Rate limit interceptor error:', error);\n        return config;\n      }\n    });\n\n    this.addRequestInterceptor(async (config) => {\n      try {\n        if (this.security.validation.enabled && config.body) {\n          config.body = SecurityManager.sanitizeRequestData(config.body);\n        }\n        return config;\n      } catch (error) {\n        console.warn('Validation interceptor error:', error);\n      }\n      return config;\n    });\n  }\n\n  addRequestInterceptor(fn) {\n    this.interceptors.request.push(fn);\n    return () => {\n      const index = this.interceptors.request.indexOf(fn);\n      if (index !== -1) this.interceptors.request.splice(index, 1);\n    };\n  }\n\n  addResponseInterceptor(onFulfilled, onRejected) {\n    this.interceptors.response.push({onFulfilled, onRejected});\n    return () => {\n      const index = this.interceptors.response.findIndex(i =>\n        i.onFulfilled === onFulfilled && i.onRejected === onRejected);\n      if (index !== -1) this.interceptors.response.splice(index, 1);\n    };\n  }\n\n  async runRequestInterceptors(config) {\n    let resultConfig = {...config};\n    for (const interceptor of this.interceptors.request) {\n      resultConfig = await interceptor(resultConfig);\n    }\n    return resultConfig;\n  }\n\n  /**\n   * Run response interceptors after receiving a response.\n   *\n   * @param {Response} response - The fetch response object.\n   * @param {boolean} [isError=false] - Whether this is an error response.\n   * @returns {Promise<Object>} - The processed response object.\n   */\n  async runResponseInterceptors(response, isError = false) {\n    let result = response;\n\n    for (const interceptor of this.interceptors.response) {\n      try {\n        if (isError && interceptor.onRejected) {\n          result = await interceptor.onRejected(result);\n        } else if (!isError && interceptor.onFulfilled) {\n          result = await interceptor.onFulfilled(result);\n        } else if (!isError && !response.success && interceptor.onRejected) {\n          result = await interceptor.onRejected(result);\n        }\n      } catch (error) {\n\n        result = {\n          success: false,\n          status: 500,\n          statusText: 'Interceptor Error',\n          data: null,\n          headers: {},\n          error: error\n        };\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  async request(url, options = {}) {\n    const controller = new AbortController();\n    let timeoutId;\n\n    if (this.timeout) {\n      timeoutId = setTimeout(() => controller.abort(), this.timeout);\n    }\n\n    try {\n      const finalUrl = /^(https?:)?\\/\\//.test(url) ? url : `${this.baseURL}${url}`;\n\n      let config = {\n        method: options.method || 'GET',\n        ...options,\n        headers: {\n          ...this.defaultHeaders,\n          'Accept-Language': (typeof Now !== 'undefined' && Now.getLocale) ? Now.getLocale() : (navigator.language || 'en'),\n          ...options.headers\n        },\n        signal: controller.signal,\n        credentials: options.credentials || 'same-origin'\n      };\n\n      config = await this.runRequestInterceptors(config);\n      config = this.ensureCsrf(config);\n      config.body = this.processRequestBody(config);\n      config = this.normalizeRequestOptions(config);\n\n      const response = await fetch(finalUrl, config);\n      clearTimeout(timeoutId);\n\n      // Update CSRF token from response headers (before custom handler may process)\n      const newCsrfToken = response.headers.get(this.csrfHeaderName);\n      if (newCsrfToken) {\n        this.csrfToken = newCsrfToken;\n      }\n\n      let result;\n      if (this.responseHandler) {\n        result = await this.responseHandler(response);\n      } else {\n        result = await this.handleResponse(response);\n      }\n\n      return await this.runResponseInterceptors(result);\n\n    } catch (error) {\n      clearTimeout(timeoutId);\n\n      const errorResponse = {\n        success: false,\n        status: error.name === 'AbortError' ? 408 : (error.status || 500),\n        statusText: error.name === 'AbortError' ? 'Request timeout' : (error.message || 'Unknown error'),\n        data: null,\n        headers: {},\n        error: error,\n        url: url\n      };\n\n      try {\n        const processedError = await this.runResponseInterceptors(errorResponse, true);\n        return processedError;\n      } catch (interceptorError) {\n        return errorResponse;\n      }\n    }\n  }\n\n  processRequestBody(config) {\n    const {body, headers} = config;\n    if (!body) return null;\n\n    if (body instanceof FormData || body instanceof URLSearchParams ||\n      body instanceof Blob || body instanceof ArrayBuffer) {\n      delete headers['Content-Type'];\n      return body;\n    }\n\n    if (typeof body === 'object') {\n      if (!headers['Content-Type']) {\n        headers['Content-Type'] = 'application/json';\n      }\n      if (headers['Content-Type']?.includes('application/json')) {\n        return JSON.stringify(body);\n      }\n    }\n\n    return body;\n  }\n\n  normalizeRequestOptions(options) {\n    const result = {...options};\n\n    // Remove JSON content-type for requests without body to avoid cache/CDN issues\n    if (!result.body && result.headers?.['Content-Type'] === 'application/json') {\n      delete result.headers['Content-Type'];\n    }\n\n    if (result.cache === true) {\n      result.cache = 'default';\n    } else if (result.cache === false) {\n      result.cache = 'no-store';\n    }\n\n    return result;\n  }\n\n  ensureCsrf(config) {\n    const method = (config.method || 'GET').toUpperCase();\n    if (!this.csrfToken && this.security.csrf.required && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(method)) {\n      throw new HttpError('Missing CSRF token', 400);\n    }\n\n    if (this.csrfToken) {\n      config.headers = config.headers || {};\n      config.headers[this.csrfHeaderName] = this.csrfToken;\n\n      if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(method)) {\n        const body = config.body;\n        if (typeof body === 'object' && body !== null && !(body instanceof FormData) && !body._token) {\n          body[this.security.csrf.tokenName || '_token'] = this.csrfToken;\n          config.body = body;\n        } else if (body instanceof FormData && !body.has(this.security.csrf.tokenName || '_token')) {\n          body.append(this.security.csrf.tokenName || '_token', this.csrfToken);\n          config.body = body;\n        }\n      }\n    }\n\n    return config;\n  }\n\n  async handleResponse(response) {\n    const newCsrfToken = response.headers.get(this.csrfHeaderName);\n    if (newCsrfToken) {\n      this.csrfToken = newCsrfToken;\n    }\n\n    const contentType = response.headers.get('content-type');\n    const isJSON = contentType?.includes('application/json');\n    const isText = contentType?.includes('text/');\n    const isBlob = contentType?.includes('application/octet-stream');\n\n    let data;\n    try {\n      if (isJSON) {\n        data = await response.json();\n      } else if (isBlob) {\n        data = await response.blob();\n      } else if (isText) {\n        data = await response.text();\n      } else {\n        data = response;\n      }\n    } catch (parseError) {\n      data = await response.text();\n    }\n\n    const result = {\n      success: response.ok,  // HTTP success mapped to success\n      status: response.status,\n      statusText: response.statusText,\n      data: data,\n      headers: this.getHeadersObject(response),\n      url: response.url\n    };\n\n    return result;\n  }\n\n  getHeadersObject(response) {\n    const headers = {};\n    response.headers.forEach((value, key) => {\n      headers[key] = value;\n    });\n    return headers;\n  }\n\n  createHttpError(response) {\n    return new HttpError(\n      response.statusText || 'HTTP Error',\n      response.status,\n      response\n    );\n  }\n\n  createErrorResponse(error) {\n    const isTimeout = error.name === 'AbortError';\n    const status = isTimeout ? 408 : error.status || 500;\n    const message = isTimeout ? 'Request timeout' : error.message || 'Unknown error';\n\n    return new HttpError(message, status, error.response);\n  }\n\n  async get(url, options = {}) {\n    const response = await this.request(url, {...options, method: 'GET'});\n\n    if (options.throwOnError !== false && this.throwOnError && !response.success) {\n      throw new HttpError(response.statusText || 'HTTP Error', response.status, response);\n    }\n\n    return response;\n  }\n\n  async post(url, data, options = {}) {\n    const response = await this.request(url, {...options, method: 'POST', body: data});\n\n    if (options.throwOnError !== false && this.throwOnError && !response.success) {\n      throw new HttpError(response.statusText || 'HTTP Error', response.status, response);\n    }\n\n    return response;\n  }\n\n  async put(url, data, options = {}) {\n    const response = await this.request(url, {...options, method: 'PUT', body: data});\n\n    if (options.throwOnError !== false && this.throwOnError && !response.success) {\n      throw new HttpError(response.statusText || 'HTTP Error', response.status, response);\n    }\n\n    return response;\n  }\n\n  async delete(url, options = {}) {\n    const response = await this.request(url, {...options, method: 'DELETE'});\n\n    if (options.throwOnError !== false && this.throwOnError && !response.success) {\n      throw new HttpError(response.statusText || 'HTTP Error', response.status, response);\n    }\n\n    return response;\n  }\n\n  patch(url, data, options = {}) {\n    return this.request(url, {...options, method: 'PATCH', body: data});\n  }\n\n  head(url, options = {}) {\n    return this.request(url, {...options, method: 'HEAD'});\n  }\n\n  options(url, options = {}) {\n    return this.request(url, {...options, method: 'OPTIONS'});\n  }\n\n  upload(url, files, options = {}) {\n    const formData = new FormData();\n\n    if (Array.isArray(files)) {\n      files.forEach((file, i) => formData.append(`file${i}`, file));\n    } else {\n      formData.append('file', files);\n    }\n\n    if (options.data) {\n      Object.entries(options.data).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n    }\n\n    return this.request(url, {\n      ...options,\n      method: 'POST',\n      body: formData\n    });\n  }\n\n  async getSafe(url, options = {}) {\n    return this.request(url, {...options, method: 'GET'});\n  }\n\n  async postSafe(url, data, options = {}) {\n    return this.request(url, {...options, method: 'POST', body: data});\n  }\n\n  async putSafe(url, data, options = {}) {\n    return this.request(url, {...options, method: 'PUT', body: data});\n  }\n\n  async deleteSafe(url, options = {}) {\n    return this.request(url, {...options, method: 'DELETE'});\n  }\n\n  setBaseURL(url) {\n    this.baseURL = url;\n  }\n\n  setDefaultHeader(name, value) {\n    this.defaultHeaders[name] = value;\n  }\n\n  setDefaultHeaders(headers) {\n    this.defaultHeaders = {\n      ...this.defaultHeaders,\n      ...headers\n    };\n  }\n\n  setTimeout(timeout) {\n    this.timeout = timeout;\n  }\n\n  setCsrfToken(token) {\n    this.csrfToken = token;\n  }\n}\n\nclass HttpError extends Error {\n  constructor(message, status, response = null) {\n    super(message);\n    this.name = 'HttpError';\n    this.status = status;\n    this.response = response;\n    this.timestamp = Date.now();\n  }\n}\n\nconst http = new HttpClient({\n  throwOnError: false,\n  responseHandler: async (response) => {\n    const contentType = response.headers.get('content-type');\n    let data;\n\n    try {\n      if (contentType?.includes('application/json')) {\n        data = await response.json();\n      } else if (contentType?.includes('text/')) {\n        data = await response.text();\n      } else if (contentType?.includes('application/octet-stream')) {\n        data = await response.blob();\n      } else {\n        data = await response.text();\n      }\n    } catch (e) {\n      data = null;\n    }\n\n    return {\n      success: response.ok,\n      status: response.status,\n      statusText: response.statusText,\n      data,\n      headers: Object.fromEntries(response.headers.entries()),\n      url: response.url,\n      timestamp: Date.now(),\n      requestId: response.headers.get('X-Request-ID')\n    };\n  }\n});\n\nconst httpThrow = new HttpClient({\n  throwOnError: true,\n  responseHandler: async (response) => {\n    const contentType = response.headers.get('content-type');\n    let data;\n\n    if (contentType?.includes('application/json')) {\n      data = await response.json();\n    } else if (contentType?.includes('text/')) {\n      data = await response.text();\n    } else if (contentType?.includes('application/octet-stream')) {\n      data = await response.blob();\n    } else {\n      data = await response.text();\n    }\n\n    const result = {\n      status: response.status,\n      data,\n      message: data?.message || response.statusText,\n      meta: data?.meta,\n      timestamp: Date.now(),\n      headers: Object.fromEntries(response.headers.entries()),\n      requestId: response.headers.get('X-Request-ID')\n    };\n\n    if (!response.ok) {\n      throw new HttpError(\n        result.message || 'Server Error',\n        result.status,\n        result\n      );\n    }\n\n    return result;\n  }\n});\n\n/**\n * SimpleFetch - A lightweight fetch wrapper for easy HTTP requests\n * Zero dependencies, auto-parsing, and convenient methods\n *\n * @example\n * // Get JSON data directly\n * const users = await simpleFetch.json('/api/users');\n *\n * // Post data easily\n * const result = await simpleFetch.post('/api/users', {name: 'John'});\n *\n * // Get full response object\n * const response = await simpleFetch('/api/users');\n * console.log(response.data, response.success, response.status);\n */\nconst simpleFetch = {\n  // Configuration\n  config: {\n    baseURL: '',\n    defaultHeaders: {\n      'X-Requested-With': 'XMLHttpRequest'\n    },\n    timeout: 15000\n  },\n\n  /**\n   * Core fetch method with auto-parsing and consistent response format\n   */\n  async fetch(url, options = {}) {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.config.timeout);\n\n    try {\n      // Build final URL\n      const finalUrl = /^(https?:)?\\/\\//.test(url) ? url : `${this.config.baseURL}${url}`;\n\n      // Prepare request config\n      const config = {\n        method: 'GET',\n        headers: {\n          ...this.config.defaultHeaders,\n          'Accept-Language': (typeof Now !== 'undefined' && Now.getLocale) ? Now.getLocale() : (navigator.language || 'en')\n        },\n        credentials: 'same-origin',\n        signal: controller.signal,\n        ...options\n      };\n\n      // Merge headers\n      if (options.headers) {\n        config.headers = {...config.headers, ...options.headers};\n      }\n\n      // CSRF support (share logic with HttpClient defaults)\n      const csrfToken = getCsrfToken(this.config.csrfCookieName || 'XSRF-TOKEN', this.config.csrfSelector || 'meta[name=\"csrf-token\"]');\n      if (csrfToken) {\n        config.headers[this.config.csrfHeaderName || 'X-CSRF-Token'] = csrfToken;\n        if (['POST', 'PUT', 'PATCH', 'DELETE'].includes((config.method || 'GET').toUpperCase())) {\n          if (config.body instanceof FormData) {\n            if (!config.body.has('_token')) config.body.append('_token', csrfToken);\n          } else if (config.body && typeof config.body === 'object') {\n            if (!config.body._token) config.body._token = csrfToken;\n          }\n        }\n      }\n\n      // Attach Authorization header from localStorage token if present\n      try {\n        const token = localStorage.getItem('auth_token');\n        if (token) {\n          config.headers['Authorization'] = `Bearer ${token}`;\n        }\n      } catch (e) {}\n\n      // Handle body\n      if (config.body && typeof config.body === 'object' && !(config.body instanceof FormData)) {\n        config.headers['Content-Type'] = config.headers['Content-Type'] || 'application/json';\n        if (config.headers['Content-Type'].includes('application/json')) {\n          config.body = JSON.stringify(config.body);\n        }\n      }\n\n      if (config.headers && (config.headers['Content-Type'] === undefined || config.headers['Content-Type'] === null)) {\n        delete config.headers['Content-Type'];\n      }\n\n      if (!config.body && config.headers) {\n        delete config.headers['Content-Type'];\n      }\n\n      if (config.body instanceof FormData && config.headers) {\n        delete config.headers['Content-Type'];\n      }\n\n      // Make request\n      const response = await fetch(finalUrl, config);\n      clearTimeout(timeoutId);\n\n      // Auto-parse response\n      const contentType = response.headers.get('content-type') || '';\n      let data;\n\n      try {\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else if (contentType.includes('text/')) {\n          data = await response.text();\n        } else if (contentType.includes('application/octet-stream') || contentType.includes('application/pdf')) {\n          data = await response.blob();\n        } else {\n          // Try JSON first, fallback to text\n          const text = await response.text();\n          try {\n            data = JSON.parse(text);\n          } catch {\n            data = text;\n          }\n        }\n      } catch (parseError) {\n        data = null;\n      }\n\n      return {\n        success: response.ok,\n        status: response.status,\n        statusText: response.statusText,\n        data,\n        headers: Object.fromEntries(response.headers.entries()),\n        url: response.url\n      };\n\n    } catch (error) {\n      clearTimeout(timeoutId);\n\n      return {\n        success: false,\n        status: error.name === 'AbortError' ? 408 : 0,\n        statusText: error.name === 'AbortError' ? 'Request Timeout' : error.message,\n        data: null,\n        headers: {},\n        url: url,\n        error: error\n      };\n    }\n  },\n\n  /**\n   * GET request - returns full response object\n   */\n  async get(url, options = {}) {\n    return this.fetch(url, {...options, method: 'GET'});\n  },\n\n  /**\n   * POST request - returns full response object\n   */\n  async post(url, data = null, options = {}) {\n    return this.fetch(url, {\n      ...options,\n      method: 'POST',\n      body: data\n    });\n  },\n\n  /**\n   * PUT request - returns full response object\n   */\n  async put(url, data = null, options = {}) {\n    return this.fetch(url, {\n      ...options,\n      method: 'PUT',\n      body: data\n    });\n  },\n\n  /**\n   * DELETE request - returns full response object\n   */\n  async delete(url, options = {}) {\n    return this.fetch(url, {...options, method: 'DELETE'});\n  },\n\n  /**\n   * PATCH request - returns full response object\n   */\n  async patch(url, data = null, options = {}) {\n    return this.fetch(url, {\n      ...options,\n      method: 'PATCH',\n      body: data\n    });\n  },\n\n  // ========== CONVENIENCE METHODS (return data directly) ==========\n\n  /**\n   * GET request - returns parsed JSON data directly\n   * @param {string} url - Request URL\n   * @param {object} options - Fetch options\n   * @returns {Promise<any>} Parsed data or null on error\n   */\n  async json(url, options = {}) {\n    const response = await this.get(url, options);\n    return response.success ? response.data : null;\n  },\n\n  /**\n   * GET request - returns text data directly\n   * @param {string} url - Request URL\n   * @param {object} options - Fetch options\n   * @returns {Promise<string>} Text data or null on error\n   */\n  async text(url, options = {}) {\n    const response = await this.get(url, options);\n    return response.success ? response.data : null;\n  },\n\n  /**\n   * POST JSON data - returns data directly\n   * @param {string} url - Request URL\n   * @param {object} data - Data to send\n   * @param {object} options - Fetch options\n   * @returns {Promise<any>} Response data or null on error\n   */\n  async postJson(url, data, options = {}) {\n    const response = await this.post(url, data, options);\n    return response.success ? response.data : null;\n  },\n\n  /**\n   * Upload files using FormData\n   * @param {string} url - Upload URL\n   * @param {File|File[]|FormData} files - Files to upload\n   * @param {object} data - Additional form data\n   * @param {object} options - Fetch options\n   * @returns {Promise<object>} Response object\n   */\n  async upload(url, files, data = {}, options = {}) {\n    let formData;\n\n    if (files instanceof FormData) {\n      formData = files;\n    } else {\n      formData = new FormData();\n\n      if (Array.isArray(files)) {\n        files.forEach((file, index) => {\n          formData.append(`file${index}`, file);\n        });\n      } else if (files) {\n        formData.append('file', files);\n      }\n    }\n\n    // Add additional data\n    Object.entries(data).forEach(([key, value]) => {\n      formData.append(key, value);\n    });\n\n    // Remove content-type header to let browser set it with boundary\n    const headers = {...options.headers};\n    delete headers['Content-Type'];\n\n    return this.post(url, formData, {...options, headers});\n  },\n\n  // ========== CONFIGURATION METHODS ==========\n\n  /**\n   * Set base URL for all requests\n   * @param {string} url - Base URL\n   */\n  setBaseURL(url) {\n    this.config.baseURL = url.endsWith('/') ? url.slice(0, -1) : url;\n    return this;\n  },\n\n  /**\n   * Set default headers\n   * @param {object} headers - Headers object\n   */\n  setHeaders(headers) {\n    this.config.defaultHeaders = {...this.config.defaultHeaders, ...headers};\n    return this;\n  },\n\n  /**\n   * Set single header\n   * @param {string} name - Header name\n   * @param {string} value - Header value\n   */\n  setHeader(name, value) {\n    this.config.defaultHeaders[name] = value;\n    return this;\n  },\n\n  /**\n   * Set request timeout\n   * @param {number} timeout - Timeout in milliseconds\n   */\n  setTimeout(timeout) {\n    this.config.timeout = timeout;\n    return this;\n  },\n\n  /**\n   * Remove a default header\n   * @param {string} name - Header name to remove\n   */\n  removeHeader(name) {\n    delete this.config.defaultHeaders[name];\n    return this;\n  },\n\n  /**\n   * Reset configuration to defaults\n   */\n  resetConfig() {\n    this.config = {\n      baseURL: '',\n      defaultHeaders: {\n        'Content-Type': 'application/json',\n        'X-Requested-With': 'XMLHttpRequest'\n      },\n      timeout: 15000\n    };\n    return this;\n  }\n};\n\nwindow.HttpClient = HttpClient;\nwindow.http = http;\nwindow.httpThrow = httpThrow;\nwindow.simpleFetch = simpleFetch;\n\nfunction getCsrfToken(cookieName = 'XSRF-TOKEN', selector = 'meta[name=\"csrf-token\"]') {\n  const metaToken = document.querySelector(selector);\n  if (metaToken) return metaToken.getAttribute('content');\n\n  const cookies = document.cookie.split(';');\n  for (const cookie of cookies) {\n    const [name, value] = cookie.trim().split('=');\n    if (name === cookieName) return decodeURIComponent(value);\n  }\n  return null;\n}\n","/**\n * High-level HTTP service for the Now.js framework that handles authentication,\n * caching, retries, tracking, and request deduplication.\n * @namespace ApiService\n */\nconst ApiService = {\n  /**\n   * In-memory cache store keyed by request signature.\n   * @type {Map<string, {data: *, timestamp: number, expiresAt: number}>}\n   */\n  cache: new Map(),\n\n  /**\n   * Track pending requests to support deduplication.\n   * @type {Map<string, Promise>}\n   */\n  pendingRequests: new Map(),\n\n  /**\n   * Abort controllers keyed by cache signature for request cancellation.\n   * @type {Map<string, AbortController>}\n   */\n  abortControllers: new Map(),\n\n  /**\n   * In-memory short-lived access token for the hybrid authentication flow.\n   * @type {string|null}\n   */\n  _accessToken: null,\n\n  /**\n   * Default configuration used by the service. It can be overridden via {@link ApiService.init}.\n   * @type {Object}\n   */\n  config: {\n    baseURL: '',\n    debug: false,\n    retryCount: 3,\n    retryDelay: 1000,\n    deduplicate: true,\n\n    // Security settings\n    security: {\n      csrfProtection: true,\n      csrfHeaderName: 'X-CSRF-Token',\n      csrfCookieName: 'XSRF-TOKEN',\n      csrfTokenSelector: 'meta[name=\"csrf-token\"]',\n      csrfIncludeSafeMethods: true,\n\n      bearerAuth: false,\n      bearerTokenKey: 'auth_token',\n      bearerPrefix: 'Bearer ',\n\n      basicAuth: false,\n      basicUsername: '',\n      basicPassword: '',\n\n      oauth: false,\n      oauthTokenKey: 'oauth_token',\n\n      contentSecurityPolicy: true,\n      allowedOrigins: [],\n\n      jwtRefresh: false,\n      jwtRefreshEndpoint: (window.Now && Now.DEFAULT_CONFIG && Now.DEFAULT_CONFIG.auth && Now.DEFAULT_CONFIG.auth.endpoints && Now.DEFAULT_CONFIG.auth.endpoints.refresh) ? Now.DEFAULT_CONFIG.auth.endpoints.refresh : 'api/auth/refresh',\n      jwtExpireKey: 'exp',\n      jwtRefreshBeforeExpirySec: 300, // 5 minutes\n      // Authentication strategy for the client\n      // 'hybrid' = HttpOnly refresh cookie (server) + access token stored in memory (client)\n      // 'cookie' = server authenticates via cookie (no Authorization header from client)\n      // 'storage' = legacy localStorage token (not recommended)\n      authStrategy: 'hybrid',\n      // Whether to send credentials (cookies) with requests (used for refresh/logout)\n      sendCredentials: true\n    },\n\n    // Connection settings\n    connection: {\n      timeout: 30000,\n      retryOnNetworkError: true,\n      maxNetworkRetries: 3,\n      backoffFactor: 1.5, // Multiply the time with this number on each retry\n      retryStatusCodes: [408, 429, 500, 502, 503, 504],\n      exponentialBackoff: true\n    },\n\n    // Cache settings\n    cache: {\n      enabled: true,\n      storageType: 'memory', // 'memory', 'session', 'local'\n      maxSize: 100, // Maximum number of cache entries\n      expiry: {\n        default: 60000, // Default TTL (1 minute)\n        get: 60000,     // TTL for GET requests (1 minute)\n        post: 0,        // Do not cache POST responses\n        put: 0,         // Do not cache PUT responses\n        delete: 0       // Do not cache DELETE responses\n      },\n      keyGeneratorFn: null,\n      responsePredicate: null // Function to decide whether to cache this response\n    },\n\n    // Tracking settings\n    tracking: {\n      enabled: false,\n      errorTracking: true,\n      performanceTracking: false,\n      analyticsCallback: null,\n      excludePaths: []\n    },\n\n    // Logging settings\n    logging: {\n      enabled: false,\n      logLevel: 'error', // 'debug', 'info', 'warn', 'error'\n      includeRequest: true,\n      includeResponse: true,\n      logToConsole: true,\n      customLogger: null\n    }\n  },\n\n  /**\n   * Initialize the service with runtime options and set up authentication, caching, and interceptors.\n   * @param {Object} [options] Partial configuration to merge with the defaults.\n   * @returns {Promise<ApiService>} The initialized service instance for chaining.\n   */\n  async init(options = {}) {\n    // Merge default and user-defined values\n    this.config = this._mergeDeep(this.config, options);\n\n    // Set BaseURL for HttpClient\n    if (this.config.baseURL) {\n      http.setBaseURL(this.config.baseURL);\n    }\n\n    // Set CSRF protection\n    if (this.config.security.csrfProtection) {\n      this.setupCsrfProtection();\n    }\n\n    // Set Bearer Authentication\n    if (this.config.security.bearerAuth) {\n      this.setupBearerAuth();\n    }\n\n    // Set Basic Authentication\n    if (this.config.security.basicAuth) {\n      this.setupBasicAuth();\n    }\n\n    // Set JWT auto refresh\n    if (this.config.security.jwtRefresh) {\n      this.setupJwtRefresh();\n    }\n\n    // Set interceptors\n    this.setupInterceptors();\n\n    // Set up cache if using localStorage or sessionStorage\n    if (this.config.cache.enabled) {\n      this.setupCache();\n    }\n\n    // Set up tracking\n    if (this.config.tracking.enabled) {\n      this.setupTracking();\n    }\n\n    return this;\n  },\n\n  /**\n   * Configure CSRF protection by injecting the CSRF token into mutating requests.\n   * @private\n   */\n  setupCsrfProtection() {\n    // Register request interceptor\n    http.addRequestInterceptor(config => {\n      const method = (config.method || 'GET').toUpperCase();\n\n      if (!this._shouldAttachCsrf(method)) {\n        return config;\n      }\n\n      const existingHeaders = config.headers || {};\n      config.headers = this._applyCsrfHeader({...existingHeaders}, method);\n\n      return config;\n    });\n  },\n\n  _shouldAttachCsrf(method = 'GET') {\n    if (!this.config.security.csrfProtection) {\n      return false;\n    }\n\n    const safeMethods = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];\n    const normalizedMethod = (method || 'GET').toUpperCase();\n\n    if (this.config.security.csrfIncludeSafeMethods) {\n      return true;\n    }\n\n    return !safeMethods.includes(normalizedMethod);\n  },\n\n  _resolveCsrfToken() {\n    try {\n      if (typeof window !== 'undefined') {\n        if (window.AuthManager?.getCSRFToken) {\n          const token = window.AuthManager.getCSRFToken();\n          if (token) {\n            return token;\n          }\n        }\n\n        if (window.SecurityManager?.getCSRFToken) {\n          const token = window.SecurityManager.getCSRFToken();\n          if (token) {\n            return token;\n          }\n        }\n      }\n\n      if (typeof document === 'undefined') {\n        return null;\n      }\n\n      const selector = this.config.security.csrfTokenSelector || 'meta[name=\"csrf-token\"]';\n      const metaTag = document.querySelector(selector);\n      if (metaTag) {\n        const metaValue = metaTag.getAttribute('content');\n        if (metaValue) {\n          return metaValue;\n        }\n      }\n\n      if (typeof document.cookie === 'string') {\n        const cookieName = this.config.security.csrfCookieName || 'XSRF-TOKEN';\n        const cookies = document.cookie.split(';');\n        for (const cookie of cookies) {\n          const [name, value] = cookie.trim().split('=');\n          if (name === cookieName) {\n            return decodeURIComponent(value || '');\n          }\n        }\n      }\n\n      const csrfInput = document.querySelector('input[name=\"_token\"], input[name=\"csrf_token\"]');\n      if (csrfInput && csrfInput.value) {\n        return csrfInput.value;\n      }\n\n      return null;\n    } catch (error) {\n      this.log('warn', 'Failed to resolve CSRF token', error);\n      return null;\n    }\n  },\n\n  _applyCsrfHeader(headers = {}, method = 'GET') {\n    if (!this._shouldAttachCsrf(method)) {\n      return headers;\n    }\n\n    const headerName = this.config.security.csrfHeaderName || 'X-CSRF-Token';\n\n    if (headers && headers[headerName]) {\n      return headers;\n    }\n\n    const csrfToken = this._resolveCsrfToken();\n    if (!csrfToken) {\n      return headers;\n    }\n\n    return {\n      ...headers,\n      [headerName]: csrfToken\n    };\n  },\n\n  /**\n   * Attach bearer tokens to outgoing requests when bearer authentication is enabled.\n   * @private\n   */\n  setupBearerAuth() {\n    const {bearerTokenKey, bearerPrefix, authStrategy} = this.config.security;\n\n    // Register request interceptor\n    http.addRequestInterceptor(config => {\n      let token = null;\n\n      // Determine token source based on strategy\n      if (authStrategy === 'storage') {\n        token = localStorage.getItem(bearerTokenKey);\n      } else if (authStrategy === 'hybrid') {\n        token = this._accessToken;\n      } else {\n        // cookie strategy: do not set Authorization header\n        token = null;\n      }\n\n      // Inject Authorization header when a token is present\n      if (token) {\n        config.headers = config.headers || {};\n        config.headers['Authorization'] = `${bearerPrefix}${token}`;\n      }\n\n      return config;\n    });\n  },\n\n  /**\n   * Persist an in-memory access token used by the hybrid authentication strategy.\n   * @param {string|null} token Short-lived access token issued by the backend.\n   */\n  setAccessToken(token) {\n    this._accessToken = token;\n  },\n\n  /**\n   * Remove the in-memory access token.\n   */\n  clearAccessToken() {\n    this._accessToken = null;\n  },\n\n  /**\n   * Configure HTTP basic authentication headers for each request when enabled.\n   * @private\n   */\n  setupBasicAuth() {\n    const {basicUsername, basicPassword} = this.config.security;\n\n    // Register request interceptor\n    http.addRequestInterceptor(config => {\n      // Encode \"username:password\" as Base64 per HTTP basic auth specification\n      const credentials = btoa(`${basicUsername}:${basicPassword}`);\n      config.headers['Authorization'] = `Basic ${credentials}`;\n      return config;\n    });\n  },\n\n  /**\n   * Schedule automatic JWT refreshes based on token expiry metadata.\n   * @private\n   */\n  setupJwtRefresh() {\n    const {jwtRefreshEndpoint, jwtExpireKey, jwtRefreshBeforeExpirySec, bearerTokenKey, authStrategy, sendCredentials} = this.config.security;\n\n    // Periodically verify whether the access token needs to be refreshed\n    const checkAndRefreshToken = async () => {\n      try {\n        let token = null;\n\n        if (authStrategy === 'storage') {\n          token = localStorage.getItem(bearerTokenKey);\n        } else if (authStrategy === 'hybrid') {\n          token = this._accessToken;\n        }\n\n        if (!token) {\n          // When no access token is available, attempt a refresh for non-storage strategies\n          if (authStrategy !== 'storage') {\n            // Continue to refresh flow\n          } else {\n            return;\n          }\n        }\n\n        // Parse the expiry timestamp from the JWT if possible\n        let timeLeft = Infinity;\n        if (token) {\n          const parts = token.split('.');\n          const payloadBase64 = parts[1];\n          if (payloadBase64) {\n            const payload = JSON.parse(atob(payloadBase64));\n            const expTimestamp = payload && payload[jwtExpireKey];\n            if (expTimestamp) {\n              const expireDate = new Date(expTimestamp * 1000);\n              const now = new Date();\n              timeLeft = (expireDate - now) / 1000;\n            }\n          }\n        }\n\n        // Refresh the token when the remaining lifetime is below the threshold\n        if (timeLeft <= jwtRefreshBeforeExpirySec) {\n          const response = await simpleFetch.post(jwtRefreshEndpoint, null, {credentials: sendCredentials ? 'include' : 'same-origin'});\n\n          if (response && response.data && response.data.token) {\n            if (authStrategy === 'storage') {\n              localStorage.setItem(bearerTokenKey, response.data.token);\n            } else if (authStrategy === 'hybrid') {\n              this.setAccessToken(response.data.token);\n            }\n          }\n        }\n      } catch (error) {\n        // Log refresh failures without interrupting the application flow\n        if (this.config.logging.enabled) {\n          this.log('error', 'JWT refresh error', error);\n        }\n      }\n    };\n\n    // Check and refresh token every 1 minute\n    setInterval(checkAndRefreshToken, 60000);\n\n    // Check and refresh immediately after initialization\n    checkAndRefreshToken();\n  },\n\n  /**\n   * Register response and request interceptors for tracking, retries, and error handling.\n   * @private\n   */\n  setupInterceptors() {\n    // Interceptor for performance tracking\n    if (this.config.tracking.performanceTracking) {\n      http.addRequestInterceptor(config => {\n        config.__startTime = performance.now();\n        return config;\n      });\n\n      http.addResponseInterceptor(\n        response => {\n          const startTime = response.__startTime;\n          if (startTime) {\n            const duration = performance.now() - startTime;\n            delete response.__startTime;\n\n            // Record performance metrics via the analytics callback\n            if (typeof this.config.tracking.analyticsCallback === 'function') {\n              this.config.tracking.analyticsCallback({\n                type: 'performance',\n                url: response.config?.url,\n                method: response.config?.method,\n                duration,\n                status: response.status\n              });\n            }\n          }\n          return response;\n        },\n        error => {\n          // Capture performance metrics for failed responses as well\n          const startTime = error.config?.__startTime;\n          if (startTime) {\n            const duration = performance.now() - startTime;\n\n            if (typeof this.config.tracking.analyticsCallback === 'function') {\n              this.config.tracking.analyticsCallback({\n                type: 'error',\n                url: error.config?.url,\n                method: error.config?.method,\n                duration,\n                status: error.status,\n                message: error.message\n              });\n            }\n          }\n          throw error;\n        }\n      );\n    }\n\n    // Interceptor for error management\n    http.addResponseInterceptor(\n      response => response,\n      error => {\n        // Re-issue the request for retry-eligible status codes\n        const shouldRetry = this.shouldRetryRequest(error);\n\n        if (shouldRetry) {\n          return this.retryRequest(error);\n        }\n\n        // Save error\n        if (this.config.logging.enabled && this.config.logging.errorTracking) {\n          this.log('error', 'API request failed', {\n            url: error.config?.url,\n            method: error.config?.method,\n            status: error.status,\n            message: error.message\n          });\n        }\n\n        throw error;\n      }\n    );\n  },\n\n  /**\n   * Initialize cache storage based on the configured persistence layer.\n   * @private\n   */\n  setupCache() {\n    const {storageType} = this.config.cache;\n\n    // If using localStorage or sessionStorage\n    if (storageType === 'local' || storageType === 'session') {\n      try {\n        const storage = storageType === 'local' ? localStorage : sessionStorage;\n        const cacheData = storage.getItem('api_cache');\n\n        if (cacheData) {\n          this.cache = new Map(JSON.parse(cacheData));\n\n          // Remove expired entries before hydrating the cache\n          this.clearExpiredCache();\n        }\n\n        // Persist cache data to storage when the page unloads\n        window.addEventListener('beforeunload', () => {\n          this.persistCache();\n        });\n      } catch (error) {\n        // Handle storage access issues gracefully\n        this.log('error', 'Failed to setup cache storage', error);\n      }\n    }\n  },\n\n  /**\n   * Initialize analytics tracking callbacks when enabled.\n   * @private\n   */\n  setupTracking() {\n    // Setting up the tracking system\n    if (typeof this.config.tracking.analyticsCallback !== 'function') {\n      // Set the starting callback.\n      this.config.tracking.analyticsCallback = (data) => {\n        if (this.config.logging.enabled) {\n          this.log('info', 'Analytics event', data);\n        }\n      };\n    }\n  },\n\n  /**\n   * Persist the in-memory cache to the configured storage backend.\n   * @private\n   */\n  persistCache() {\n    try {\n      const {storageType, maxSize} = this.config.cache;\n\n      if (storageType === 'local' || storageType === 'session') {\n        const storage = storageType === 'local' ? localStorage : sessionStorage;\n\n        // Clean up expired entries before persisting\n        this.clearExpiredCache();\n\n        // Enforce the maximum cache size by removing the oldest entries\n        if (this.cache.size > maxSize) {\n          const cacheEntries = Array.from(this.cache.entries())\n            .sort((a, b) => a[1].timestamp - b[1].timestamp);\n\n          // Continue trimming until the cache size fits within the limit\n          while (cacheEntries.length > maxSize) {\n            const [key] = cacheEntries.shift();\n            this.cache.delete(key);\n          }\n        }\n\n        // Persist the cache snapshot to storage\n        storage.setItem('api_cache', JSON.stringify(Array.from(this.cache.entries())));\n      }\n    } catch (error) {\n      this.log('error', 'Failed to persist cache', error);\n    }\n  },\n\n  /**\n   * Remove cache entries that have exceeded their expiry timestamp.\n   * @private\n   */\n  clearExpiredCache() {\n    const now = Date.now();\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (now > entry.expiresAt) {\n        this.cache.delete(key);\n      }\n    }\n  },\n\n  /**\n   * Build a cache key that uniquely identifies a request.\n   * @param {string} url Target URL.\n   * @param {Object} [params] Query parameters used by the request.\n   * @param {string} [method='GET'] HTTP method of the request.\n   * @returns {string} Cache key representing the request.\n   */\n  createCacheKey(url, params = {}, method = 'GET') {\n    // If there is a Key function, use that function.\n    if (typeof this.config.cache.keyGeneratorFn === 'function') {\n      return this.config.cache.keyGeneratorFn(url, params, method);\n    }\n\n    // Create a normal key\n    let queryString = '';\n\n    if (params instanceof URLSearchParams) {\n      queryString = params.toString();\n    } else if (typeof params === 'string') {\n      queryString = params;\n    } else if (params && typeof params === 'object') {\n      queryString = JSON.stringify(params);\n    }\n\n    return `${method}:${url}:${queryString}`;\n  },\n\n  /**\n   * Convert ApiService cache options to HTTPClient compatible format\n   * @private\n   * @param {Object} options - Original options containing cache config\n   * @returns {Object} - Options with normalized cache value\n   */\n  _normalizeOptionsForHttpClient(options) {\n    if (!options || typeof options !== 'object') {\n      return options;\n    }\n\n    const normalizedOptions = {...options};\n\n    // Handle ApiService cache object format\n    if (options.cache && typeof options.cache === 'object') {\n      // Convert complex cache object to simple HTTPClient format\n      if (options.cache.enabled === false) {\n        normalizedOptions.cache = 'no-store';\n      } else if (options.cache.enabled === true) {\n        // Use 'default' for standard caching or 'force-cache' for aggressive caching\n        normalizedOptions.cache = options.cache.storageType === 'memory' ? 'default' : 'force-cache';\n      } else if (options.cache.storageType === 'no-store' || options.cache.storageType === 'no-cache') {\n        normalizedOptions.cache = options.cache.storageType;\n      } else {\n        // Remove cache from options to prevent conflicts with unknown formats\n        delete normalizedOptions.cache;\n      }\n    }\n\n    return normalizedOptions;\n  },\n\n  /**\n   * Build a URL string that includes the provided query parameters.\n   * @param {string} url Base URL to augment.\n   * @param {(Object|URLSearchParams|string)} [params={}] Parameters to append.\n   * @returns {string} URL with serialized query parameters.\n   */\n  buildUrlWithParams(url, params = {}) {\n    const hasParams = (input) => {\n      if (!input) return false;\n      if (Array.isArray(input)) {\n        return input.some(item => hasParams(item));\n      }\n      if (input instanceof URLSearchParams) {\n        return Array.from(input.keys()).length > 0;\n      }\n      if (typeof input === 'string') {\n        return input.length > 0;\n      }\n      return Object.keys(input).length > 0;\n    };\n\n    if (!hasParams(params)) {\n      return url;\n    }\n\n    const [urlWithoutHash, hashFragment = ''] = String(url).split('#');\n    const [pathOnly, existingQuery = ''] = urlWithoutHash.split('?');\n    const searchParams = new URLSearchParams(existingQuery);\n\n    const appendValue = (key, value) => {\n      if (value === undefined || value === null) {\n        return;\n      }\n\n      if (Array.isArray(value)) {\n        value.forEach((item) => appendValue(key, item));\n        return;\n      }\n\n      if (value instanceof Date) {\n        searchParams.append(key, value.toISOString());\n        return;\n      }\n\n      const isBlob = typeof Blob !== 'undefined' && value instanceof Blob;\n      const isFile = typeof File !== 'undefined' && value instanceof File;\n\n      if (typeof value === 'object' && !isBlob && !isFile) {\n        searchParams.append(key, JSON.stringify(value));\n        return;\n      }\n\n      searchParams.append(key, value);\n    };\n\n    const processParams = (input) => {\n      if (!input) return;\n\n      if (Array.isArray(input)) {\n        input.forEach(item => processParams(item));\n        return;\n      }\n\n      if (input instanceof URLSearchParams) {\n        for (const [key, value] of input.entries()) {\n          searchParams.append(key, value);\n        }\n        return;\n      }\n\n      if (typeof input === 'string') {\n        new URLSearchParams(input).forEach((value, key) => {\n          searchParams.append(key, value);\n        });\n        return;\n      }\n\n      Object.entries(input).forEach(([key, value]) => {\n        appendValue(key, value);\n      });\n    };\n\n    processParams(params);\n\n    const queryString = searchParams.toString();\n    const hashSuffix = hashFragment ? `#${hashFragment}` : '';\n\n    if (queryString) {\n      return `${pathOnly}?${queryString}${hashSuffix}`;\n    }\n\n    return `${pathOnly}${hashSuffix}`;\n  },\n\n  /**\n   * Determine whether the failed request should be retried.\n   * @param {Error|Object} error Error object returned by the HTTP client.\n   * @returns {boolean} True when the request qualifies for a retry attempt.\n   */\n  shouldRetryRequest(error) {\n    const {retryOnNetworkError, retryStatusCodes} = this.config.connection;\n\n    // In the event of network errors\n    if (retryOnNetworkError && (error.message.includes('network') || error.status === 0)) {\n      return true;\n    }\n\n    // In the event of errors from status codes\n    if (retryStatusCodes.includes(error.status)) {\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Retry a failed request with the configured delay and backoff strategy.\n   * @param {Error|Object} error Error describing the failed request.\n   * @returns {Promise<*>} Promise resolving with the retried response.\n   */\n  async retryRequest(error) {\n    const {maxNetworkRetries, backoffFactor, exponentialBackoff} = this.config.connection;\n    const originalRequest = error.config;\n\n    // Check how many times it has been retried\n    originalRequest.retryCount = originalRequest.retryCount || 0;\n\n    // If it has retried more than the allowed number\n    if (originalRequest.retryCount >= maxNetworkRetries) {\n      return Promise.reject(error);\n    }\n\n    // Increase the retry count\n    originalRequest.retryCount++;\n\n    // Calculate the delay before retrying\n    let delayMs = this.config.retryDelay;\n\n    if (exponentialBackoff) {\n      // Use exponential backoff\n      delayMs = delayMs * Math.pow(backoffFactor, originalRequest.retryCount - 1);\n    }\n\n    // Wait for the specified time\n    await new Promise(resolve => setTimeout(resolve, delayMs));\n\n    // Try the request again - Keep using http.request for retry mechanism\n    return http.request(originalRequest.url, originalRequest);\n  },\n\n  /**\n   * Execute a GET request with built-in caching, deduplication, and retry handling.\n   * @param {string} url Target endpoint.\n   * @param {Object} [params] Query parameters to include.\n   * @param {Object} [options] Overrides for caching or fetch behavior.\n   * @returns {Promise<*>} Response payload from the server.\n   */\n  async get(url, params = {}, options = {}) {\n    // Combine default and provided values\n    const opts = {\n      ...this.config,\n      ...options\n    };\n\n    const hasParamValues = (input) => {\n      if (!input) return false;\n      if (Array.isArray(input)) {\n        return input.some(item => hasParamValues(item));\n      }\n      if (input instanceof URLSearchParams) {\n        return Array.from(input.keys()).length > 0;\n      }\n      if (typeof input === 'string') {\n        return input.length > 0;\n      }\n      return Object.keys(input).length > 0;\n    };\n\n    let combinedParams = params;\n\n    if (options?.params) {\n      combinedParams = hasParamValues(params) ? [params, options.params] : options.params;\n    }\n\n    const requestUrl = this.buildUrlWithParams(url, combinedParams);\n    const normalizeForCache = (input) => {\n      if (!input) return input;\n\n      if (input instanceof URLSearchParams) {\n        return input.toString();\n      }\n\n      if (Array.isArray(input)) {\n        return input.map(item => normalizeForCache(item));\n      }\n\n      if (input instanceof Date) {\n        return input.toISOString();\n      }\n\n      const isBlobForCache = typeof Blob !== 'undefined' && input instanceof Blob;\n      const isFileForCache = typeof File !== 'undefined' && input instanceof File;\n\n      if (isBlobForCache || isFileForCache) {\n        return '[binary]';\n      }\n\n      if (typeof input === 'object') {\n        const normalized = {};\n        Object.entries(input).forEach(([key, value]) => {\n          normalized[key] = normalizeForCache(value);\n        });\n        return normalized;\n      }\n\n      return input;\n    };\n\n    const cacheKey = this.createCacheKey(url, normalizeForCache(combinedParams), 'GET');\n\n    // Check cache (if enabled)\n    if (opts.cache.enabled && opts.cache.expiry.get > 0) {\n      const cached = this.cache.get(cacheKey);\n      if (cached && (Date.now() < cached.expiresAt)) {\n        if (this.config.logging.enabled && this.config.logging.logLevel === 'debug') {\n          this.log('debug', 'Cache hit', {url: requestUrl, params: combinedParams, cacheKey});\n        }\n        return {...cached.data, fromCache: true};\n      }\n    }\n\n    // Check for ongoing requests (to prevent duplicate requests)\n    if (opts.deduplicate && this.pendingRequests.has(cacheKey)) {\n      return this.pendingRequests.get(cacheKey);\n    }\n\n    // Create AbortController for request cancellation\n    const controller = new AbortController();\n    this.abortControllers.set(cacheKey, controller);\n\n    // Create promise for request\n    const requestPromise = (async () => {\n      try {\n        if (this.config.logging.enabled && this.config.logging.logLevel === 'debug') {\n          this.log('debug', 'API request', {url: requestUrl, params: combinedParams, method: 'GET'});\n        }\n\n        // Normalize cache options for HTTPClient compatibility\n        const normalizedOptions = this._normalizeOptionsForHttpClient({...options});\n\n        // Adjust options (if http has normalizeRequestOptions helper)\n        const adjustedOptions = http && http.normalizeRequestOptions ?\n          http.normalizeRequestOptions(normalizedOptions) : normalizedOptions;\n\n        const {params: _ignoredParams, signal: externalSignal, ...sanitizedOptions} = adjustedOptions;\n\n        const fetchOptions = {\n          ...sanitizedOptions,\n          headers: {...(sanitizedOptions.headers || {})}\n        };\n\n        if (!('credentials' in fetchOptions)) {\n          fetchOptions.credentials = this.config.security.sendCredentials ? 'include' : 'same-origin';\n        }\n\n        fetchOptions.signal = controller.signal;\n\n        if (externalSignal) {\n          if (externalSignal.aborted) {\n            controller.abort(externalSignal.reason);\n          } else {\n            externalSignal.addEventListener('abort', () => controller.abort(externalSignal.reason), {once: true});\n          }\n        }\n\n        let response;\n\n        if (http && typeof http.get === 'function') {\n          response = await http.get(requestUrl, fetchOptions);\n        } else if (simpleFetch && typeof simpleFetch.get === 'function') {\n          const simpleFetchOptions = {\n            ...fetchOptions,\n            headers: this._applyCsrfHeader({...fetchOptions.headers}, 'GET')\n          };\n\n          response = await simpleFetch.get(requestUrl, simpleFetchOptions);\n        } else {\n          throw new Error('No HTTP client available for GET requests');\n        }\n\n        // Cache the response\n        if (opts.cache.enabled && opts.cache.expiry.get > 0) {\n          const shouldCache = typeof opts.cache.responsePredicate === 'function'\n            ? opts.cache.responsePredicate(response)\n            : true;\n\n          if (shouldCache) {\n            this.cache.set(cacheKey, {\n              data: response,\n              timestamp: Date.now(),\n              expiresAt: Date.now() + opts.cache.expiry.get\n            });\n          }\n        }\n\n        return response;\n      } catch (error) {\n        throw error;\n      } finally {\n        // Remove from ongoing requests\n        this.pendingRequests.delete(cacheKey);\n        this.abortControllers.delete(cacheKey);\n      }\n    })();\n\n    // Store the ongoing request\n    this.pendingRequests.set(cacheKey, requestPromise);\n\n    return requestPromise;\n  },\n  /**\n   * Execute a POST request and invalidate caches bound to the target URL.\n   * @param {string} url Target endpoint.\n   * @param {*} data Payload to send with the request.\n   * @param {Object} [options] Additional fetch options.\n   * @returns {Promise<*>} Response payload from the server.\n   */\n  async post(url, data, options = {}) {\n    return this._sendNonGetRequest('POST', url, data, options);\n  },\n\n  /**\n   * Execute a PUT request and invalidate caches bound to the target URL.\n   * @param {string} url Target endpoint.\n   * @param {*} data Payload to send with the request.\n   * @param {Object} [options] Additional fetch options.\n   * @returns {Promise<*>} Response payload from the server.\n   */\n  async put(url, data, options = {}) {\n    return this._sendNonGetRequest('PUT', url, data, options);\n  },\n\n  /**\n   * Execute a DELETE request and invalidate caches bound to the target URL.\n   * @param {string} url Target endpoint.\n   * @param {Object} [options] Additional fetch options.\n   * @returns {Promise<*>} Response payload from the server.\n   */\n  async delete(url, options = {}) {\n    return this._sendNonGetRequest('DELETE', url, null, options);\n  },\n\n  /**\n   * Execute a non-GET request (POST, PUT, PATCH, DELETE) while applying shared defaults.\n   * @private\n   * @param {string} method HTTP verb to execute.\n   * @param {string} url Target endpoint URL.\n   * @param {*} data Payload to send with the request (ignored for DELETE).\n   * @param {Object} [options] Additional request options.\n   * @returns {Promise<*>} The response returned by the underlying fetch implementation.\n   */\n  async _sendNonGetRequest(method, url, data, options = {}) {\n    if (this.config.logging.enabled && this.config.logging.logLevel === 'debug') {\n      const logPayload = {url, method};\n      if (typeof data !== 'undefined' && data !== null) {\n        logPayload.data = data;\n      }\n      this.log('debug', 'API request', logPayload);\n    }\n\n    // Normalize cache options for HTTPClient compatibility\n    const normalizedOptions = this._normalizeOptionsForHttpClient({...options});\n\n    const adjustedOptions = http && http.normalizeRequestOptions ?\n      http.normalizeRequestOptions(normalizedOptions) : normalizedOptions;\n\n    const {params: optionParams, ...sanitizedOptions} = adjustedOptions;\n    const requestUrl = this.buildUrlWithParams(url, optionParams);\n\n    if (!('credentials' in sanitizedOptions)) {\n      sanitizedOptions.credentials = this.config.security.sendCredentials ? 'include' : 'same-origin';\n    }\n\n    const methodName = method.toLowerCase();\n    let response;\n\n    if (http && typeof http[methodName] === 'function') {\n      if (['post', 'put', 'patch'].includes(methodName)) {\n        response = await http[methodName](requestUrl, data, sanitizedOptions);\n      } else {\n        response = await http[methodName](requestUrl, sanitizedOptions);\n      }\n    } else if (simpleFetch && typeof simpleFetch[methodName] === 'function') {\n      const fallbackOptions = {\n        ...sanitizedOptions,\n        headers: this._applyCsrfHeader({...((sanitizedOptions && sanitizedOptions.headers) || {})}, method)\n      };\n\n      const fetchArgs = [requestUrl];\n      if (['post', 'put', 'patch'].includes(methodName)) {\n        fetchArgs.push(data);\n      }\n      fetchArgs.push(fallbackOptions);\n      response = await simpleFetch[methodName](...fetchArgs);\n    } else {\n      throw new Error(`Unsupported HTTP method: ${method}`);\n    }\n\n    this.invalidateCacheByUrl(url);\n    if (requestUrl !== url) {\n      this.invalidateCacheByUrl(requestUrl);\n    }\n\n    return response;\n  },\n\n  /**\n   * Abort an in-flight request identified by its URL and parameters.\n   * @param {string} url Target endpoint.\n   * @param {Object} [params] Parameters used when the request was initiated.\n   * @returns {boolean} True when a matching request was found and aborted.\n   */\n  abort(url, params = {}) {\n    const cacheKey = this.createCacheKey(url, params);\n    const controller = this.abortControllers.get(cacheKey);\n\n    if (controller) {\n      controller.abort();\n      this.abortControllers.delete(cacheKey);\n      this.pendingRequests.delete(cacheKey);\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Remove all cache entries from memory and storage.\n   */\n  clearCache() {\n    this.cache.clear();\n    this.persistCache();\n  },\n\n  /**\n   * Remove a specific cache entry identified by URL and parameters.\n   * @param {string} url Target endpoint.\n   * @param {Object} [params] Parameters associated with the cached response.\n   * @returns {boolean} True if the cache entry existed and was removed.\n   */\n  invalidateCache(url, params = {}) {\n    const cacheKey = this.createCacheKey(url, params);\n    const deleted = this.cache.delete(cacheKey);\n    this.persistCache();\n    return deleted;\n  },\n\n  /**\n   * Remove all cache entries whose key includes the provided URL.\n   * @param {string} url URL substring to match against cache keys.\n   * @returns {number} Number of cache entries removed.\n   */\n  invalidateCacheByUrl(url) {\n    let count = 0;\n\n    for (const key of this.cache.keys()) {\n      if (key.includes(url)) {\n        this.cache.delete(key);\n        count++;\n      }\n    }\n\n    this.persistCache();\n    return count;\n  },\n\n  /**\n   * Await multiple request promises in parallel.\n   * @param {Array<Promise>} requests Collection of request promises.\n   * @returns {Promise<Array<*>>} Aggregated responses.\n   */\n  async all(requests) {\n    return Promise.all(requests);\n  },\n\n  /**\n   * Poll an endpoint at a fixed interval until stopped or the condition is met.\n   * @param {string} url Target endpoint.\n   * @param {Object} [params] Query parameters to include with each request.\n   * @param {number} [interval=5000] Delay between polls in milliseconds.\n   * @param {Function} callback Handler receiving (response, error, attemptCount).\n   * @param {Object} [options] Polling configuration including maxPolls and condition.\n   * @returns {Function} Cleanup function to cancel the polling.\n   */\n  poll(url, params = {}, interval = 5000, callback, options = {}) {\n    const opts = {\n      maxPolls: Infinity,\n      condition: null, // Function to determine when to stop polling\n      ...options\n    };\n\n    let count = 0;\n    let timerId = null;\n\n    const execute = async () => {\n      try {\n        count++;\n        const response = await this.get(url, params, {cache: {enabled: false}});\n\n        // Call the callback\n        callback(response, null, count);\n\n        // Check the stop condition\n        const shouldStop = typeof opts.condition === 'function' ? opts.condition(response) : false;\n\n        if (shouldStop || count >= opts.maxPolls) {\n          return;\n        }\n\n        // Set timeout for next execution\n        timerId = setTimeout(execute, interval);\n      } catch (error) {\n        callback(null, error, count);\n\n        // Retry if not exceeded max polls\n        if (count < opts.maxPolls) {\n          timerId = setTimeout(execute, interval);\n        }\n      }\n    };\n\n    // Start execution\n    execute();\n\n    // Return function to cancel polling\n    return () => {\n      if (timerId) {\n        clearTimeout(timerId);\n        timerId = null;\n      }\n    };\n  },\n\n  /**\n   * Execute a list of GET requests sequentially and optionally post-process each response.\n   * @param {Array<Object>} requests Items containing url, params, and options.\n   * @param {Function} [processor] Optional transformer invoked per response.\n   * @returns {Promise<Array<*>>} Array of transformed results or raw responses/errors.\n   */\n  async sequence(requests, processor) {\n    const results = [];\n\n    for (const request of requests) {\n      try {\n        const {url, params, options} = request;\n        const response = await this.get(url, params, options);\n\n        // Process the response if a processor function is provided\n        if (typeof processor === 'function') {\n          const result = await processor(response);\n          results.push(result);\n        } else {\n          results.push(response);\n        }\n      } catch (error) {\n        results.push({error});\n      }\n    }\n\n    return results;\n  },\n\n  /**\n   * Fetch paginated data across multiple pages until exhausted or stopped.\n   * @param {string} url Target endpoint.\n   * @param {Object} [params] Base parameters shared across pages.\n   * @param {Object} [options] Pagination behavior overrides.\n   * @returns {Promise<{data: Array<*>, pages: number, total: number}>} Aggregated pagination result.\n   */\n  async paginate(url, params = {}, options = {}) {\n    const opts = {\n      pageParam: 'page',\n      // Use 'pageSize' as the standard parameter name across the project\n      // so clients and components send the same key for page size/limit.\n      limitParam: 'pageSize',\n      startPage: 1,\n      // default page size\n      limit: 20,\n      maxPages: Infinity,\n      dataPath: 'data',\n      totalPath: 'meta.total',\n      stopCondition: null,\n      ...options\n    };\n\n    const allData = [];\n    let currentPage = opts.startPage;\n    let hasMore = true;\n    let total = null;\n\n    while (hasMore && currentPage <= opts.maxPages) {\n      // Create params for the current page\n      const pageParams = {\n        ...params,\n        [opts.pageParam]: currentPage,\n        [opts.limitParam]: opts.limit\n      };\n\n      // Fetch data\n      const response = await this.get(url, pageParams);\n\n      // Extract data based on the specified path and normalize to array\n      const rawPageData = this.getValueByPath(response, opts.dataPath);\n      let pageData = [];\n      if (Array.isArray(rawPageData)) {\n        pageData = rawPageData;\n      } else if (rawPageData && typeof rawPageData === 'object' && Array.isArray(rawPageData.data)) {\n        // Support responses like { data: [...] }\n        pageData = rawPageData.data;\n      } else {\n        // If the path yields a single object or scalar, wrap into array when appropriate\n        if (rawPageData !== null && typeof rawPageData !== 'undefined') {\n          // If it's an object that's not an array, we avoid spreading it; skip or wrap\n          // Prefer wrapping primitives/objects into an array containing the item\n          pageData = Array.isArray(rawPageData) ? rawPageData : [rawPageData];\n        } else {\n          pageData = [];\n        }\n      }\n\n      // Get total if available\n      if (total === null) {\n        total = this.getValueByPath(response, opts.totalPath);\n      }\n\n      // Add data to the allData array\n      if (Array.isArray(pageData)) {\n        allData.push(...pageData);\n      } else if (pageData !== null && typeof pageData !== 'undefined') {\n        allData.push(pageData);\n      }\n\n      // Check the stop condition\n      if (typeof opts.stopCondition === 'function') {\n        const shouldStop = opts.stopCondition(pageData, response, currentPage);\n        if (shouldStop) break;\n      }\n\n      // Check if there is a next page\n      hasMore = pageData.length === opts.limit;\n\n      // If total is known, check if all data has been fetched\n      if (total !== null) {\n        hasMore = allData.length < total;\n      }\n\n      currentPage++;\n    }\n\n    return {\n      data: allData,\n      pages: currentPage - 1,\n      total: total || allData.length\n    };\n  },\n\n  /**\n   * Safely read a nested property from an object using dot notation.\n   * @param {Object} obj Source object.\n   * @param {string} path Dot-notated path.\n   * @returns {*} The resolved value or undefined when missing.\n   */\n  getValueByPath(obj, path) {\n    if (!obj || !path) return undefined;\n\n    return path.split('.').reduce((o, p) => o?.[p], obj);\n  },\n\n  /**\n   * Deep merge two configuration objects without mutating the originals.\n   * @private\n   * @param {Object} target Base object.\n   * @param {Object} source Overrides to merge.\n   * @returns {Object} New object containing merged keys.\n   */\n  _mergeDeep(target, source) {\n    const isObject = obj => obj && typeof obj === 'object' && !Array.isArray(obj);\n\n    if (!source) return target;\n\n    const output = {...target};\n\n    if (isObject(target) && isObject(source)) {\n      Object.keys(source).forEach(key => {\n        if (isObject(source[key])) {\n          if (!(key in target)) {\n            output[key] = source[key];\n          } else {\n            output[key] = this._mergeDeep(target[key], source[key]);\n          }\n        } else {\n          output[key] = source[key];\n        }\n      });\n    }\n\n    return output;\n  },\n\n  /**\n   * Emit a log entry using the configured logger when logging is enabled.\n   * @param {'debug'|'info'|'warn'|'error'} level Log level for the message.\n   * @param {string} message Short descriptive message.\n   * @param {Object} [data={}] Supplementary context to include with the log entry.\n   */\n  log(level, message, data = {}) {\n    if (!this.config.logging.enabled) return;\n\n    const logLevels = {\n      debug: 0,\n      info: 1,\n      warn: 2,\n      error: 3\n    };\n\n    // Check the log level\n    if (logLevels[level] < logLevels[this.config.logging.logLevel]) {\n      return;\n    }\n\n    // Log data\n    const logData = {\n      timestamp: new Date().toISOString(),\n      level,\n      message,\n      ...data\n    };\n\n    // If a custom logger is provided, use it\n    if (typeof this.config.logging.customLogger === 'function') {\n      this.config.logging.customLogger(logData);\n      return;\n    }\n\n    // If log to console\n    if (this.config.logging.logToConsole) {\n      switch (level) {\n        case 'debug':\n          console.debug(`[API] ${message}`, data);\n          break;\n        case 'info':\n          console.info(`[API] ${message}`, data);\n          break;\n        case 'warn':\n          console.warn(`[API] ${message}`, data);\n          break;\n        case 'error':\n          console.error(`[API] ${message}`, data);\n          break;\n      }\n    }\n  }\n};\n\n// Register with Now framework\nif (window.Now?.registerManager) {\n  Now.registerManager('api', ApiService);\n}\n\n// Expose globally\nwindow.ApiService = ApiService;\n","/**\n * ApiComponent - Component for declarative API data loading and rendering\n * Provides HTML-based configuration for API calls with automatic rendering via TemplateManager\n *\n * Security: Uses window.http exclusively (no fallbacks) for consistent CSRF/interceptor protection\n *\n * @example\n * <div data-component=\"api\" data-endpoint=\"/api/users\" data-method=\"GET\">\n *   <template>\n *     <ul><li data-for=\"user of data\">{user.name}</li></ul>\n *   </template>\n * </div>\n */\nconst ApiComponent = {\n  config: {\n    // HTTP configuration\n    method: 'GET',        // HTTP method (GET, POST, PUT, DELETE)\n    baseURL: '',          // Base URL for API endpoints\n    autoload: true,       // Auto-load data when instance is created\n    timeout: 30000,       // Request timeout (ms)\n    cache: false,         // Enable response caching\n    cacheTime: 60000,     // Cache duration (ms)\n    retry: 3,             // Number of retry attempts on failure\n\n    // Event handlers\n    onSuccess: null,      // Callback on successful load\n    onError: null,        // Callback on error\n    onEmpty: null        // Callback when no data returned\n  },\n\n  state: {\n    instances: new Map(),  // Store all active instances\n    initialized: false,\n    cache: new Map()       // API response cache\n  },\n\n  /**\n   * Create a new ApiComponent instance\n   * @param {HTMLElement|string} element - DOM element or selector\n   * @param {Object} options - Configuration options\n   * @returns {Object|null} Instance object or null on error\n   */\n  create(element, options = {}) {\n    // Verify HttpClient is available (fail-fast)\n    if (!window.http || typeof window.http.get !== 'function') {\n      const errorMsg = 'HttpClient (window.http) is required for ApiComponent';\n      console.error('[ApiComponent]', errorMsg);\n      const translatedMsg = window.Now?.translate ? Now.translate(errorMsg) : errorMsg;\n      alert(translatedMsg);\n      return null;\n    }\n\n    // Find element if selector string provided\n    if (typeof element === 'string') {\n      element = document.querySelector(element);\n    }\n\n    if (!element) {\n      console.error('[ApiComponent] Element not found');\n      return null;\n    }\n\n    // Check if instance already exists\n    const existingInstance = this.getInstance(element);\n    if (existingInstance) {\n      return existingInstance;\n    }\n\n    // Create new instance\n    const instance = {\n      id: 'api_' + Math.random().toString(36).substring(2, 11),\n      element,\n      options: {...this.config, ...this.extractOptionsFromElement(element), ...options},\n      data: null,\n      loading: false,\n      error: null,\n      timestamp: null,\n      page: 1,\n      totalPages: 1,\n      pageSize: 10,\n      totalItems: 0,\n      polling: false,\n      timer: null,\n      abortController: null\n    };\n\n    // Initialize instance\n    this.setup(instance);\n\n    // Store instance\n    this.state.instances.set(instance.id, instance);\n    element.dataset.apiComponentId = instance.id;\n\n    // Store reference on element for easy access from HTML\n    element.apiInstance = instance;\n\n    return instance;\n  },\n\n  /**\n   * Setup and initialize an instance\n   * @param {Object} instance - Instance object\n   */\n  setup(instance) {\n    try {\n      // Add api-component class without changing existing structure\n      instance.element.classList.add('api-component');\n\n      // Store template if present\n      const templateEl = instance.element.querySelector('template');\n      if (templateEl) {\n        instance.templateContent = templateEl.innerHTML;\n      } else if (instance.options.template) {\n        // External template by ID\n        const externalTemplate = document.getElementById(instance.options.template);\n        if (externalTemplate && externalTemplate.tagName === 'TEMPLATE') {\n          instance.templateContent = externalTemplate.innerHTML;\n        }\n      }\n\n      // Bind events\n      this.bindEvents(instance);\n\n      // Auto-load data if enabled\n      if (instance.options.autoload) {\n        this.loadData(instance);\n      }\n\n      // Start polling if configured\n      if (instance.options.polling && instance.options.pollingInterval) {\n        this.startPolling(instance);\n      }\n\n      // Dispatch init event\n      this.dispatchEvent(instance, 'init', {\n        instance\n      });\n\n    } catch (error) {\n      console.error('[ApiComponent] Setup error:', error);\n      instance.error = error.message;\n      this.renderError(instance);\n    }\n  },\n\n  /**\n   * Bind event handlers to instance\n   * @param {Object} instance - Instance object\n   */\n  bindEvents(instance) {\n    // Bind refresh events if configured\n    if (instance.options.refreshEvent) {\n      const events = instance.options.refreshEvent.split(',').map(e => e.trim());\n\n      events.forEach(eventName => {\n        if (!eventName) return;\n\n        const handler = () => this.refresh(instance);\n\n        // Store handlers for cleanup\n        if (!instance.eventHandlers) {\n          instance.eventHandlers = new Map();\n        }\n\n        instance.eventHandlers.set(eventName, handler);\n\n        // Register event\n        if (window.EventManager) {\n          EventManager.on(eventName, handler);\n        } else {\n          document.addEventListener(eventName, handler);\n        }\n      });\n    }\n\n    // Add methods to instance for HTML access\n    instance.refresh = () => {\n      this.refresh(instance);\n    };\n\n    instance.loadMore = () => {\n      this.loadMore(instance);\n    };\n  },\n\n  /**\n   * Load data from API\n   * @param {Object} instance - Instance object\n   * @param {boolean} append - Append to existing data (for pagination)\n   */\n  async loadData(instance, append = false) {\n    try {\n      // Cancel previous request if exists\n      if (instance.abortController) {\n        instance.abortController.abort();\n      }\n\n      // Create new AbortController\n      instance.abortController = new AbortController();\n\n      // Show loading state\n      instance.loading = true;\n      instance.error = null;\n      this.renderLoading(instance);\n\n      // Validate endpoint\n      if (!instance.options.endpoint) {\n        throw new Error('API endpoint is required');\n      }\n\n      // Check cache if enabled\n      const cacheKey = this.createCacheKey(instance);\n      if (instance.options.cache && !append) {\n        const cached = this.state.cache.get(cacheKey);\n        if (cached && (Date.now() < cached.expires)) {\n          instance.data = cached.data;\n          instance.loading = false;\n          this.renderContent(instance);\n\n          // Dispatch loaded event\n          this.dispatchEvent(instance, 'loaded', {\n            data: instance.data,\n            fromCache: true\n          });\n\n          return;\n        }\n      }\n\n      // Prepare URL\n      let url = instance.options.endpoint;\n      if (instance.options.baseURL && !url.startsWith('http://') && !url.startsWith('https://')) {\n        url = instance.options.baseURL + url;\n      }\n\n      // Prepare parameters\n      const params = {...instance.options.params};\n\n      // Add URL params if enabled\n      if (instance.options.urlParams) {\n        const urlParamsData = this.collectUrlParams(instance);\n\n        // Check required params\n        if (instance.options.urlParamsRequired) {\n          const fields = instance.options.urlParamsFields?.split(',').map(f => f.trim()) || [];\n          const missing = fields.filter(f => !urlParamsData[f]);\n\n          if (missing.length > 0 || (fields.length > 0 && Object.keys(urlParamsData).length === 0)) {\n            const errorMsg = window.Now?.translate\n              ? Now.translate('Missing required URL parameters')\n              : 'Missing required URL parameters';\n            instance.error = errorMsg;\n            instance.loading = false;\n            this.renderError(instance);\n            this.dispatchEvent(instance, 'error', {error: errorMsg, missingParams: missing});\n            return;\n          }\n        }\n\n        Object.assign(params, urlParamsData);\n      }\n\n      // Add pagination params\n      if (instance.options.pagination !== false) {\n        if (instance.options.pageParam) {\n          params[instance.options.pageParam] = instance.page;\n        }\n        if (instance.options.limitParam) {\n          params[instance.options.limitParam] = instance.options.pageSize || instance.pageSize || 10;\n        }\n      }\n\n      // Prepare options\n      const reqOptions = {\n        throwOnError: false,\n        headers: instance.options.headers || {}\n      };\n\n      // Call API using HttpClient ONLY - no fallbacks\n      if (!window.http || typeof window.http.request !== 'function') {\n        throw new Error('HttpClient (window.http) is required but not available');\n      }\n\n      const method = instance.options.method.toUpperCase();\n      let response;\n\n      // Execute request based on method\n      switch (method) {\n        case 'POST':\n          response = await window.http.post(url, instance.options.data || params, reqOptions);\n          break;\n        case 'PUT':\n          response = await window.http.put(url, instance.options.data || params, reqOptions);\n          break;\n        case 'DELETE':\n          response = await window.http.delete(url, reqOptions);\n          break;\n        default: // GET\n          // Add params to URL for GET\n          if (Object.keys(params).length > 0) {\n            const queryParams = new URLSearchParams(params).toString();\n            url = `${url}${url.includes('?') ? '&' : '?'}${queryParams}`;\n          }\n          response = await window.http.get(url, reqOptions);\n      }\n\n      if (!response.success) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      // Update data from response\n      this.updateDataFromResponse(instance, response, append);\n\n      // Store in cache if enabled\n      if (instance.options.cache && instance.data) {\n        this.state.cache.set(cacheKey, {\n          data: instance.data,\n          expires: Date.now() + (instance.options.cacheTime || this.config.cacheTime)\n        });\n      }\n\n      // Clear error\n      instance.error = null;\n\n      // Dispatch loaded event\n      this.dispatchEvent(instance, 'loaded', {\n        data: instance.data,\n        response\n      });\n\n      // Render content\n      this.renderContent(instance);\n\n      // Call success callback if provided\n      if (typeof instance.options.onSuccess === 'function') {\n        instance.options.onSuccess.call(instance, instance.data, response);\n      }\n\n    } catch (error) {\n      // Handle errors\n      instance.error = error.message;\n      console.error('[ApiComponent] Load error:', error);\n\n      // Dispatch error event\n      this.dispatchEvent(instance, 'error', {\n        error: instance.error,\n        message: error.message\n      });\n\n      // Render error\n      this.renderError(instance);\n\n      // Call error callback if provided\n      if (typeof instance.options.onError === 'function') {\n        instance.options.onError.call(instance, error);\n      }\n\n    } finally {\n      // Update state\n      instance.loading = false;\n      instance.abortController = null;\n    }\n  },\n\n  /**\n   * Create cache key for request\n   * @param {Object} instance - Instance object\n   * @returns {string} Cache key\n   */\n  createCacheKey(instance) {\n    const {endpoint, method, params, data} = instance.options;\n    const paramString = params ? JSON.stringify(params) : '';\n    const dataString = data ? JSON.stringify(data) : '';\n\n    return `${method}:${endpoint}:${paramString}:${dataString}`;\n  },\n\n  /**\n   * Collect URL query parameters\n   * Supports both regular query string and hash-based SPA routing\n   * @param {Object} instance - Instance object\n   * @returns {Object} URL parameters object\n   */\n  collectUrlParams(instance) {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    // Also check hash fragment for SPA hash-mode routing\n    // e.g., /#/activate?id=abc becomes location.hash = \"#/activate?id=abc\"\n    const hashPart = window.location.hash;\n    const hashQueryIndex = hashPart.indexOf('?');\n    if (hashQueryIndex !== -1) {\n      const hashParams = new URLSearchParams(hashPart.substring(hashQueryIndex));\n      // Merge hash params into urlParams (hash params take precedence)\n      for (const [key, value] of hashParams.entries()) {\n        urlParams.set(key, value);\n      }\n    }\n\n    // Filter by specified fields if configured\n    const fields = instance.options.urlParamsFields;\n    if (fields) {\n      const allowedFields = fields.split(',').map(f => f.trim());\n      const filtered = {};\n      allowedFields.forEach(field => {\n        if (urlParams.has(field)) {\n          filtered[field] = urlParams.get(field);\n        }\n      });\n      return filtered;\n    }\n\n    return Object.fromEntries(urlParams.entries());\n  },\n\n  /**\n   * Update instance data from API response\n   * @param {Object} instance - Instance object\n   * @param {Object} response - HTTP response\n   * @param {boolean} append - Append mode flag\n   */\n  updateDataFromResponse(instance, response, append = false) {\n    // Extract data from response using configured path\n    const dataPath = instance.options.dataPath || 'data';\n    let responseData;\n\n    // response.data is the HTTP response body (e.g., {success: true, data: {...}})\n    const responseBody = response.data;\n\n    // Get data by path from response body\n    if (dataPath === 'data') {\n      // Default path: extract responseBody.data if it exists (standard API response format)\n      // Otherwise use the whole response body\n      responseData = responseBody?.data ?? responseBody;\n    } else {\n      // Custom dataPath: extract from response body using path\n      responseData = this.getValueByPath(responseBody, dataPath);\n    }\n\n    // Handle empty data\n    if (!responseData) {\n      instance.data = [];\n\n      // Dispatch empty event\n      this.dispatchEvent(instance, 'empty');\n\n      // Call empty callback if provided\n      if (typeof instance.options.onEmpty === 'function') {\n        instance.options.onEmpty.call(instance);\n      }\n\n      return;\n    }\n\n    // Append or replace data\n    if (append && Array.isArray(responseData) && Array.isArray(instance.data)) {\n      instance.data = [...instance.data, ...responseData];\n    } else {\n      instance.data = responseData;\n    }\n\n    // Update pagination info\n    if (instance.options.pagination !== false) {\n      const metaPath = instance.options.metaPath || 'meta';\n      const meta = this.getValueByPath(response, metaPath) || {};\n\n      instance.totalItems = meta.total || 0;\n      instance.totalPages = meta.last_page || Math.ceil(instance.totalItems / instance.pageSize) || 1;\n    }\n\n    // Record timestamp\n    instance.timestamp = Date.now();\n  },\n\n  /**\n   * Get value from object by dot-notation path\n   * @param {Object} obj - Source object\n   * @param {string} path - Dot-notation path (e.g., 'data.users')\n   * @returns {*} Value at path\n   */\n  getValueByPath(obj, path) {\n    return path.split('.').reduce((o, p) => o?.[p], obj);\n  },\n\n  /**\n   * Render loading state\n   * @param {Object} instance - Instance object\n   */\n  renderLoading(instance) {\n    const element = instance.element;\n\n    // Clear other state classes\n    element.classList.remove('api-error', 'api-empty', 'api-content');\n\n    // Add loading class\n    element.classList.add('api-loading');\n  },\n\n  /**\n   * Render error state\n   * @param {Object} instance - Instance object\n   */\n  renderError(instance) {\n    const element = instance.element;\n\n    // Clear other state classes\n    element.classList.remove('api-loading', 'api-empty', 'api-content');\n\n    // Add error class\n    element.classList.add('api-error');\n\n    // Log error\n    console.error('[ApiComponent] Error:', instance.error);\n  },\n\n  /**\n   * Render content with data\n   * @param {Object} instance - Instance object\n   */\n  renderContent(instance) {\n    const element = instance.element;\n\n    // Clear state classes\n    element.classList.remove('api-loading', 'api-error', 'api-empty');\n\n    // Handle empty data\n    if (!instance.data || (Array.isArray(instance.data) && instance.data.length === 0)) {\n      element.classList.add('api-empty');\n      return;\n    }\n\n    // Add content class\n    element.classList.add('api-content');\n\n    // Create context for template processing\n    const context = {\n      ...instance,\n      data: instance.data,\n      state: {data: instance.data},\n      ...this.options\n    };\n\n    if (window.TemplateManager && typeof TemplateManager.processTemplate === 'function') {\n      TemplateManager.processTemplate(element, context);\n    }\n\n    // Dispatch content-rendered event\n    this.dispatchEvent(instance, 'content-rendered', {\n      data: instance.data\n    });\n  },\n\n  /**\n   * Apply simple template with {key} placeholders\n   * @param {string} template - Template string\n   * @param {Object} data - Data object\n   * @returns {string} Processed template\n   */\n  applySimpleTemplate(template, data) {\n    return template.replace(/\\{([^}]+)\\}/g, (match, path) => {\n      return this.getValueByPath(data, path.trim()) ?? '';\n    });\n  },\n\n  /**\n   * Refresh instance data (reset to page 1)\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   */\n  refresh(instance) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Reset pagination\n    instance.page = 1;\n\n    // Reload data\n    this.loadData(instance);\n  },\n\n  /**\n   * Load next page (pagination)\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   */\n  loadMore(instance) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Skip if already loading\n    if (instance.loading) return;\n\n    // Skip if no more pages\n    if (instance.page >= instance.totalPages) return;\n\n    // Increment page\n    instance.page++;\n\n    // Load data in append mode\n    this.loadData(instance, true);\n  },\n\n  /**\n   * Start polling for automatic data refresh\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   */\n  startPolling(instance) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Skip if already polling\n    if (instance.polling) return;\n\n    // Enable polling\n    instance.polling = true;\n\n    // Set interval\n    const interval = parseInt(instance.options.pollingInterval) || 30000;\n    instance.timer = setInterval(() => {\n      // Load data if not currently loading\n      if (!instance.loading) {\n        this.loadData(instance);\n      }\n    }, interval);\n\n    // Dispatch polling:start event\n    this.dispatchEvent(instance, 'polling:start');\n  },\n\n  /**\n   * Stop polling\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   */\n  stopPolling(instance) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Skip if not polling\n    if (!instance.polling) return;\n\n    // Clear timer\n    if (instance.timer) {\n      clearInterval(instance.timer);\n      instance.timer = null;\n    }\n\n    // Disable polling\n    instance.polling = false;\n\n    // Dispatch polling:stop event\n    this.dispatchEvent(instance, 'polling:stop');\n  },\n\n  /**\n   * Submit data (POST request)\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   * @param {Object} data - Data to submit\n   */\n  async submit(instance, data) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Set method to POST\n    instance.options.method = 'POST';\n\n    // Set data\n    if (data) {\n      instance.options.data = data;\n    }\n\n    // Load data\n    return this.loadData(instance);\n  },\n\n  /**\n   * Format date value\n   * @param {string|Date} value - Date value\n   * @param {string} format - Format string (Y-m-d H:i:s)\n   * @returns {string} Formatted date\n   */\n  formatDate(value, format) {\n    if (!value) return '';\n\n    try {\n      const date = new Date(value);\n\n      // Validate date\n      if (isNaN(date.getTime())) {\n        return value;\n      }\n\n      // Replace format tokens\n      return format\n        .replace('Y', date.getFullYear())\n        .replace('m', String(date.getMonth() + 1).padStart(2, '0'))\n        .replace('d', String(date.getDate()).padStart(2, '0'))\n        .replace('H', String(date.getHours()).padStart(2, '0'))\n        .replace('i', String(date.getMinutes()).padStart(2, '0'))\n        .replace('s', String(date.getSeconds()).padStart(2, '0'));\n    } catch (e) {\n      return value;\n    }\n  },\n\n  /**\n   * Format number value\n   * @param {number} value - Number value\n   * @param {number} decimals - Decimal places\n   * @returns {string} Formatted number\n   */\n  formatNumber(value, decimals) {\n    if (value === null || value === undefined) return '';\n\n    const num = parseFloat(value);\n    if (isNaN(num)) return value;\n\n    return num.toLocaleString(undefined, {\n      minimumFractionDigits: parseInt(decimals),\n      maximumFractionDigits: parseInt(decimals)\n    });\n  },\n\n  /**\n   * Format currency value\n   * @param {number} value - Number value\n   * @param {string} currency - Currency symbol\n   * @param {number} decimals - Decimal places\n   * @returns {string} Formatted currency\n   */\n  formatCurrency(value, currency, decimals) {\n    if (value === null || value === undefined) return '';\n\n    const num = parseFloat(value);\n    if (isNaN(num)) return value;\n\n    return currency + ' ' + this.formatNumber(num, decimals);\n  },\n\n  /**\n   * Clear all cached responses\n   */\n  clearCache() {\n    this.state.cache.clear();\n  },\n\n  /**\n   * Dispatch custom event\n   * @param {Object} instance - Instance object\n   * @param {string} eventName - Event name (without 'api:' prefix)\n   * @param {Object} detail - Event detail data\n   */\n  dispatchEvent(instance, eventName, detail = {}) {\n    if (!instance.element) return;\n\n    const event = new CustomEvent(`api:${eventName}`, {\n      bubbles: true,\n      cancelable: true,\n      detail: {\n        instance,\n        element: instance.element,\n        ...detail\n      }\n    });\n\n    // Dispatch on element if it's still in the document (for bubbling)\n    // Otherwise dispatch on document directly (for SPA navigation scenarios)\n    if (document.contains(instance.element)) {\n      instance.element.dispatchEvent(event);\n    } else {\n      // Element is disconnected from DOM, dispatch on document directly\n      document.dispatchEvent(event);\n    }\n\n    EventManager.emit(`api:${eventName}`, {\n      instance,\n      ...detail\n    });\n  },\n\n  /**\n   * Extract options from element data attributes\n   * @param {HTMLElement} element - DOM element\n   * @returns {Object} Options object\n   */\n  extractOptionsFromElement(element) {\n    const options = {};\n    const dataset = element.dataset;\n\n    // Try data-props first (JSON format)\n    if (dataset.props) {\n      try {\n        const props = JSON.parse(dataset.props);\n        Object.assign(options, props);\n      } catch (e) {\n        console.warn('[ApiComponent] Invalid JSON in data-props:', e);\n      }\n    }\n\n    // Read from individual data-* attributes\n    if (!options.endpoint && dataset.endpoint) options.endpoint = dataset.endpoint;\n    if (!options.method && dataset.method) options.method = dataset.method.toUpperCase();\n    if (!options.baseURL && dataset.baseUrl) options.baseURL = dataset.baseUrl;\n    if (options.autoload === undefined && dataset.autoload !== undefined)\n      options.autoload = dataset.autoload !== 'false';\n    if (options.cache === undefined && dataset.cache !== undefined)\n      options.cache = dataset.cache === 'true';\n    if (!options.cacheTime && dataset.cacheTime)\n      options.cacheTime = parseInt(dataset.cacheTime);\n    if (!options.timeout && dataset.timeout)\n      options.timeout = parseInt(dataset.timeout);\n    if (!options.retry && dataset.retry)\n      options.retry = parseInt(dataset.retry);\n    if (!options.template && dataset.template)\n      options.template = dataset.template;\n    if (!options.refreshEvent && dataset.refreshEvent)\n      options.refreshEvent = dataset.refreshEvent;\n\n    // Pagination options\n    if (!options.pagination && dataset.pagination)\n      options.pagination = dataset.pagination !== 'false';\n    if (!options.pageParam && dataset.pageParam)\n      options.pageParam = dataset.pageParam;\n    if (!options.limitParam && dataset.limitParam)\n      options.limitParam = dataset.limitParam;\n    if (!options.pageSize && dataset.pageSize)\n      options.pageSize = parseInt(dataset.pageSize);\n\n    // Parse JSON strings\n    if (!options.params && dataset.params) {\n      try {\n        options.params = JSON.parse(dataset.params);\n      } catch (e) {\n        console.warn('[ApiComponent] Invalid JSON in data-params');\n      }\n    }\n\n    if (!options.data && dataset.data) {\n      try {\n        options.data = JSON.parse(dataset.data);\n      } catch (e) {\n        console.warn('[ApiComponent] Invalid JSON in data-data');\n      }\n    }\n\n    if (!options.headers && dataset.headers) {\n      try {\n        options.headers = JSON.parse(dataset.headers);\n      } catch (e) {\n        console.warn('[ApiComponent] Invalid JSON in data-headers');\n      }\n    }\n\n    // Path options\n    if (!options.dataPath && dataset.dataPath) options.dataPath = dataset.dataPath;\n    if (!options.metaPath && dataset.metaPath) options.metaPath = dataset.metaPath;\n\n    // URL parameter options\n    if (options.urlParams === undefined && dataset.urlParams !== undefined)\n      options.urlParams = dataset.urlParams === 'true';\n    if (!options.urlParamsFields && dataset.urlParamsFields)\n      options.urlParamsFields = dataset.urlParamsFields;\n    if (options.urlParamsRequired === undefined && dataset.urlParamsRequired !== undefined)\n      options.urlParamsRequired = dataset.urlParamsRequired === 'true';\n\n    return options;\n  },\n\n  /**\n   * Get instance from element\n   * @param {HTMLElement|string} element - Element or selector\n   * @returns {Object|null} Instance or null\n   */\n  getInstance(element) {\n    if (typeof element === 'string') {\n      element = document.querySelector(element);\n    }\n\n    if (!element) return null;\n\n    // Check for stored reference\n    if (element.apiInstance) {\n      return element.apiInstance;\n    }\n\n    // Check by ID\n    const id = element.dataset.apiComponentId;\n    if (id && this.state.instances.has(id)) {\n      return this.state.instances.get(id);\n    }\n\n    // Search all instances\n    for (const instance of this.state.instances.values()) {\n      if (instance.element === element) {\n        return instance;\n      }\n    }\n\n    return null;\n  },\n\n  /**\n   * Destroy instance and cleanup\n   * @param {Object|string|HTMLElement} instance - Instance, ID, or element\n   * @returns {boolean} Success flag\n   */\n  destroy(instance) {\n    // Resolve instance\n    if (typeof instance === 'string') {\n      instance = this.state.instances.get(instance);\n    } else if (instance instanceof HTMLElement) {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return false;\n\n    // Stop polling if active\n    if (instance.polling) {\n      clearInterval(instance.timer);\n    }\n\n    // Cancel active request\n    if (instance.abortController) {\n      instance.abortController.abort();\n    }\n\n    // Remove event handlers\n    if (instance.eventHandlers) {\n      instance.eventHandlers.forEach((handler, eventName) => {\n        if (window.EventManager) {\n          EventManager.off(eventName, handler);\n        } else {\n          document.removeEventListener(eventName, handler);\n        }\n      });\n    }\n\n    // Clear data\n    instance.data = null;\n    instance.loading = false;\n    instance.error = null;\n\n    // Clean DOM\n    if (instance.element) {\n      delete instance.element.apiInstance;\n      delete instance.element.dataset.apiComponentId;\n\n      // Remove api-component class\n      instance.element.classList.remove('api-component');\n    }\n\n    // Dispatch destroy event\n    this.dispatchEvent(instance, 'destroy');\n\n    // Remove from Map\n    if (instance.id) {\n      this.state.instances.delete(instance.id);\n    }\n\n    return true;\n  },\n\n  /**\n   * Initialize ApiComponent\n   * @param {Object} options - Configuration options\n   * @returns {Object} ApiComponent instance\n   */\n  async init(options = {}) {\n    // Update config\n    this.config = {...this.config, ...options};\n\n    // Find and initialize elements with data-component=\"api\"\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this.initElements());\n    } else {\n      this.initElements();\n    }\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  /**\n   * Initialize all elements with data-component=\"api\"\n   */\n  initElements() {\n    document.querySelectorAll('[data-component=\"api\"]').forEach(element => {\n      this.create(element);\n    });\n  }\n};\n\n/**\n * Register Component with ComponentManager\n */\nif (window.ComponentManager) {\n  const apiComponentDefinition = {\n    template: null,\n\n    validElement(element) {\n      return element.classList.contains('api-component') ||\n        element.dataset.component === 'api' ||\n        element.dataset.endpoint;\n    },\n\n    setupElement(element, state) {\n      const options = ApiComponent.extractOptionsFromElement(element);\n      const apiComponent = ApiComponent.create(element, options);\n\n      element._apiComponent = apiComponent;\n      return element;\n    },\n\n    beforeDestroy() {\n      if (this.element && this.element._apiComponent) {\n        ApiComponent.destroy(this.element._apiComponent);\n        delete this.element._apiComponent;\n      }\n    }\n  };\n\n  ComponentManager.define('api', apiComponentDefinition);\n}\n\n/**\n * Register ApiComponent with Now.js framework\n */\nif (window.Now?.registerManager) {\n  Now.registerManager('api', ApiComponent);\n}\n\n// Auto-initialize\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => ApiComponent.init());\n} else {\n  ApiComponent.init();\n}\n\n// Expose globally\nwindow.ApiComponent = ApiComponent;\n","const ElementManager = {\n  state: {\n    elements: new Map(),\n    instances: new Map(),\n    elementIndex: new WeakMap(),\n    containerMap: new WeakMap(), // Track elements by container\n    initialized: false,\n    privateStates: new WeakMap()\n  },\n\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = Object.assign({}, this.config, options);\n\n    if (window.ElementFactory && ElementFactory._privateState) {\n      this.state.privateStates = ElementFactory._privateState;\n    }\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  registerElement(type, implementation) {\n    if (!type || typeof type !== 'string') {\n      throw new Error('Element type must be a string');\n    }\n\n    if (!implementation) {\n      throw new Error('Element implementation must be an object');\n    }\n\n    implementation.manager = this;\n    if (typeof implementation.init === 'function') {\n      implementation.init(this);\n    }\n    this.state.elements.set(type, implementation);\n\n    return this;\n  },\n\n  unRegisterElement(type) {\n    this.state.elements.delete(type);\n    return this;\n  },\n\n  create(type, config = {}) {\n    if (!this.state.initialized) {\n      throw ErrorManager.handle('ElementManager must be initialized first', {\n        context: 'ElementManager.create',\n      });\n    }\n\n    try {\n      const elementClass = this.state.elements.get(type);\n      config.elementType = type;\n\n      let instance;\n      if (elementClass) {\n        instance = elementClass.create(config);\n      } else if (window.ElementFactory) {\n        instance = ElementFactory.create(config);\n      } else {\n        throw new Error(`No implementation found for element type: ${type}`);\n      }\n\n      if (instance && instance.element && instance.element.id) {\n        this.state.instances.set(instance.element.id, instance);\n      }\n\n      instance.wasCreated = true;\n      return instance;\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ElementManager.create',\n        data: {type, config}\n      });\n      return null;\n    }\n  },\n\n  enhance(element, config = {}) {\n    try {\n      if (!element || !(element instanceof HTMLElement)) {\n        throw new Error('Invalid element');\n      }\n\n      // Already enhanced: prefer element identity (WeakMap) over id-based lookup\n      try {\n        const byElement = this.state.elementIndex.get(element);\n        if (byElement) {\n          // instance already associated with this DOM node\n          return byElement;\n        }\n      } catch (e) {\n        // ignore weakmap errors\n      }\n\n      // Fallback: if element has an id, check id-based registry\n      if (element.id) {\n        const existingInstance = this.getInstance(element.id);\n        if (existingInstance) {\n          // If the instance's element is different or no longer connected, treat it as stale and destroy it\n          const instEl = existingInstance.element;\n          const isSameNode = instEl === element;\n          const isConnected = instEl && instEl.isConnected;\n\n          if (!isSameNode || !isConnected) {\n            // stale instance — destroy to allow re-enhancement\n            try {\n              this.destroy(element.id);\n            } catch (err) {\n              // best effort\n              console.warn('Failed to destroy stale element instance for id', element.id, err);\n            }\n          } else {\n            // same element node: already enhanced\n            return existingInstance;\n          }\n        }\n      }\n\n      // Opt-in: require data-element for auto-enhance when in auto mode\n      // For select elements, use tagName since element.type returns \"select-one\" or \"select-multiple\"\n      const tagName = element.tagName.toLowerCase();\n      let type = element.getAttribute('data-element') || element.getAttribute('type') || element.type || tagName;\n\n      // Special handling for select elements - they report type as \"select-one\" or \"select-multiple\"\n      // but are registered as \"select\" or handle multiple via MultiSelectElementFactory\n      if (tagName === 'select' && !this.state.elements.has(type)) {\n        type = 'select';\n      }\n\n      config.elementType = type;\n\n      const elementClass = this.state.elements.get(type);\n\n      if (!elementClass) {\n        if (window.ElementFactory) {\n          const instance = ElementFactory.enhance(element, config);\n          if (instance) {\n            instance.wasCreated = false;  // Mark as enhanced, not created\n            // index by element weak map\n            try {this.state.elementIndex.set(element, instance);} catch (e) {}\n            if (element.id) this.state.instances.set(element.id, instance);\n          }\n          return instance;\n        } else {\n          ErrorManager.handle(`No implementation found for ${type}`, {\n            context: 'ElementManager.enhance',\n            data: {element, config}\n          });\n          return null;\n        }\n      }\n\n      const instance = elementClass.enhance(element, config);\n\n      if (instance) {\n        // index by element weak map\n        try {this.state.elementIndex.set(element, instance);} catch (e) {}\n        if (element.id) this.state.instances.set(element.id, instance);\n      }\n\n      instance.wasCreated = false;\n      return instance;\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ElementManager.enhance',\n        data: {element, config}\n      });\n      return null;\n    }\n  },\n\n  getInstance(id) {\n    return this.state.instances.get(id);\n  },\n\n  getInstanceByElement(element) {\n    if (!element) return null;\n    const inst = this.state.elementIndex.get(element);\n    if (inst) return inst;\n    return element?.id ? this.state.instances.get(element.id) : null;\n  },\n\n  removeInstance(id) {\n    const instance = this.state.instances.get(id);\n    if (!instance) return false;\n\n    if (window.ElementFactory && ElementFactory._privateState) {\n      ElementFactory._privateState.delete(instance.element);\n    }\n\n    try {this.state.elementIndex.delete(instance.element);} catch (e) {}\n    return this.state.instances.delete(id);\n  },\n\n  hasElement(type) {\n    return this.state.elements.has(type);\n  },\n\n  // Determine whether element should be enhanced (opt-in via data-element or registered type)\n  shouldEnhance(element) {\n    if (!element) return false;\n\n    // Check for explicit data-element attribute\n    if (element.dataset && element.dataset.element) return true;\n\n    // Check if element type is registered\n    // Use getAttribute('type') to capture custom types like \"currency\" that browsers normalize to \"text\"\n    const type = element.getAttribute('type') || element.type || element.tagName.toLowerCase();\n    if (this.state.elements.has(type)) return true;\n\n    return false;\n  },\n\n  // Scan container for elements with data-element and enhance them\n  scan(container = document) {\n    if (!container || !container.querySelectorAll) return [];\n\n    // Query for data-element AND standard form elements that might match registered types\n    const selector = '[data-element], input, select, textarea';\n    const found = Array.from(container.querySelectorAll(selector));\n\n    // Track elements by container\n    const elementIds = [];\n\n    found.forEach(el => {\n      if (!this.state.elementIndex.has(el)) {\n        const instance = this.enhance(el);\n        if (instance && instance.element && instance.element.id) {\n          elementIds.push(instance.element.id);\n        }\n      }\n    });\n\n    // Store container -> elementIds mapping\n    if (elementIds.length > 0 && container !== document) {\n      try {\n        const existing = this.state.containerMap.get(container) || [];\n        this.state.containerMap.set(container, [...existing, ...elementIds]);\n      } catch (e) {\n        // WeakMap error, ignore\n      }\n    }\n\n    return found;\n  },\n\n  // Destroy all elements in a specific container\n  destroyContainer(container) {\n    if (!container) return false;\n\n    try {\n      const elementIds = this.state.containerMap.get(container);\n      if (elementIds && Array.isArray(elementIds)) {\n        elementIds.forEach(id => {\n          try {\n            this.destroy(id);\n          } catch (err) {\n            // Element might already be destroyed, ignore\n          }\n        });\n\n        // Clear container mapping\n        this.state.containerMap.delete(container);\n        return true;\n      }\n    } catch (e) {\n      // WeakMap error or other issues\n    }\n\n    return false;\n  },\n\n  // Destroy element by element reference\n  destroyByElement(el) {\n    if (!el) return false;\n    const inst = this.getInstanceByElement(el);\n    if (!inst) return false;\n    const id = inst.element?.id;\n    if (id) return this.destroy(id);\n    // if no id, try to find corresponding id in instances map\n    for (const [key, value] of this.state.instances.entries()) {\n      if (value === inst) return this.destroy(key);\n    }\n    return false;\n  },\n\n  destroy(id) {\n    const instance = this.state.instances.get(id);\n    if (!instance) return false;\n\n    try {\n      const {element} = instance;\n\n      // Call instance.destroy but don't let it abort manager-level cleanup\n      if (typeof instance.destroy === 'function') {\n        try {\n          instance.destroy();\n        } catch (err) {\n          console.warn('Instance destroy threw an error, continuing manager cleanup', err);\n        }\n      }\n\n      // Remove any event handlers attached to the element (manager-level)\n      try {\n        EventSystemManager.removeElementHandlers(element);\n      } catch (err) {\n        // swallow to continue cleanup\n        console.warn('Failed to remove element handlers during destroy', err);\n      }\n\n      if (window.ElementFactory && ElementFactory._privateState) {\n        ElementFactory._privateState.delete(instance.element);\n      }\n\n      ['comment', 'label', 'container', 'wrapper'].forEach(prop => {\n        if (element[prop]) {\n          if (instance.wasCreated === false) {\n            delete element[prop];\n          } else if (element[prop].parentNode) {\n            element[prop].parentNode.removeChild(element[prop]);\n          }\n        }\n      });\n      if (instance.wasCreated === true) {\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        }\n      }\n\n      try {this.state.elementIndex.delete(instance.element);} catch (e) {}\n      this.state.instances.delete(id);\n      return true;\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'ElementManager.destroy',\n        data: {id}\n      });\n      return false;\n    }\n  },\n\n  cleanup() {\n    Array.from(this.state.instances.keys()).forEach(id => {\n      this.destroy(id);\n    });\n\n    this.state.elements.clear();\n    this.state.instances.clear();\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('element', ElementManager);\n}\n\n// Expose globally\nwindow.ElementManager = ElementManager;\n","const Autocomplete = {\n  config: {\n    minLength: 2,\n    delay: 300,\n    limit: 10,\n    listClass: 'autocomplete-list',\n    activeClass: 'active',\n    loadingClass: 'loading'\n  },\n\n  create(element, options = {}) {\n    if (!element) return null;\n\n    const instance = {\n      element,\n      options: {...this.config, ...options},\n      state: {\n        loading: false,\n        value: element.value\n      }\n    };\n\n    // Check existing datalist\n    const listId = element.getAttribute('list');\n    if (listId) {\n      instance.datalist = document.getElementById(listId);\n      return instance;\n    }\n\n    // Create suggestion list\n    const list = document.createElement('ul');\n    list.className = instance.options.listClass;\n    list.style.display = 'none';\n    element.parentNode.appendChild(list);\n    instance.list = list;\n\n    // Bind events\n    instance.handlers = this.bindEvents(instance);\n\n    return instance;\n  },\n\n  bindEvents(instance) {\n    const {element, list, options} = instance;\n    const handlers = {};\n\n    // Input handling with debounce\n    handlers.input = Utils.function.debounce(async (e) => {\n      const value = e.target.value;\n      if (value.length < options.minLength) {\n        this.hideSuggestions(instance);\n        return;\n      }\n\n      // If has datalist, filter it\n      if (instance.datalist) {\n        const filtered = this.filterDatalist(instance, value);\n        this.showSuggestions(instance, filtered);\n        return;\n      }\n\n      // If has URL, fetch from server\n      if (options.url) {\n        await this.fetchSuggestions(instance, value);\n      }\n    }, options.delay);\n\n    // Keyboard navigation\n    handlers.keydown = (e) => {\n      if (list.style.display === 'none') return;\n\n      const items = list.querySelectorAll('li');\n      const current = list.querySelector(`.${options.activeClass}`);\n      let next;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          next = !current ? items[0] : (current.nextElementSibling || items[0]);\n          break;\n\n        case 'ArrowUp':\n          e.preventDefault();\n          next = !current ? items[items.length - 1] : (current.previousElementSibling || items[items.length - 1]);\n          break;\n\n        case 'Enter':\n          e.preventDefault();\n          if (current) {\n            this.selectItem(instance, current);\n          }\n          return;\n\n        case 'Escape':\n          this.hideSuggestions(instance);\n          return;\n      }\n\n      if (next) {\n        current?.classList.remove(options.activeClass);\n        next.classList.add(options.activeClass);\n        next.scrollIntoView({block: 'nearest'});\n      }\n    };\n\n    // Hide on blur\n    handlers.blur = () => {\n      setTimeout(() => {\n        this.hideSuggestions(instance);\n      }, 200);\n    };\n\n    EventSystemManager.addHandler(element, 'input', handlers.input);\n    EventSystemManager.addHandler(element, 'keydown', handlers.keydown);\n    EventSystemManager.addHandler(element, 'blur', handlers.blur);\n\n    return handlers;\n  },\n\n  async fetchSuggestions(instance, value) {\n    const {element, options} = instance;\n\n    if (instance.state.loading) return;\n    instance.state.loading = true;\n    element.classList.add(options.loadingClass);\n\n    try {\n      const response = await simpleFetch.get(options.url, {\n        params: {\n          q: value,\n          limit: options.limit\n        }\n      });\n\n      this.showSuggestions(instance, response.data);\n    } catch (error) {\n      console.error('Autocomplete fetch error:', error);\n      this.hideSuggestions(instance);\n    } finally {\n      instance.state.loading = false;\n      element.classList.remove(options.loadingClass);\n    }\n  },\n\n  filterDatalist(instance, value) {\n    const options = Array.from(instance.datalist.options);\n    return options\n      .filter(opt => opt.value.toLowerCase().includes(value.toLowerCase()))\n      .slice(0, instance.options.limit)\n      .map(opt => ({\n        value: opt.value,\n        label: opt.label || opt.value\n      }));\n  },\n\n  showSuggestions(instance, items) {\n    const {list, options} = instance;\n    list.innerHTML = '';\n\n    if (!Array.isArray(items) || items.length === 0) {\n      this.hideSuggestions(instance);\n      return;\n    }\n\n    items.forEach(item => {\n      const li = document.createElement('li');\n      li.dataset.value = typeof item === 'object' ? item.value : item;\n      li.textContent = typeof item === 'object' ? (item.label || item.value) : item;\n\n      li.addEventListener('click', () => {\n        this.selectItem(instance, li);\n      });\n\n      li.addEventListener('mouseenter', () => {\n        list.querySelector(`.${options.activeClass}`)?.classList.remove(options.activeClass);\n        li.classList.add(options.activeClass);\n      });\n\n      list.appendChild(li);\n    });\n\n    list.style.display = 'block';\n  },\n\n  hideSuggestions(instance) {\n    if (instance.list) {\n      instance.list.style.display = 'none';\n      instance.list.innerHTML = '';\n    }\n  },\n\n  selectItem(instance, item) {\n    const {element} = instance;\n    element.value = item.dataset.value;\n    this.hideSuggestions(instance);\n    element.focus();\n    element.dispatchEvent(new Event('change', {bubbles: true}));\n  },\n\n  destroy(instance) {\n    if (!instance) return;\n\n    const {element, handlers, list} = instance;\n\n    // Remove event handlers\n    if (handlers) {\n      Object.entries(handlers).forEach(([event, handler]) => {\n        EventSystemManager.removeHandler(handler);\n      });\n    }\n\n    // Remove suggestion list\n    if (list && list.parentNode) {\n      list.parentNode.removeChild(list);\n    }\n  }\n};\n\n// Register as plugin\nElementManager.plugins = ElementManager.plugins || {};\nElementManager.plugins.autocomplete = Autocomplete;","class FormError {\n  static config = {\n    errorClass: 'invalid',\n    errorMessageClass: 'error',\n    autoFocus: true,\n    autoScroll: true,\n    scrollOffset: 100,\n    debug: false,\n    showErrorsInline: true,\n    showErrorsInNotification: false,\n    autoClearErrors: true,\n    autoClearErrorsDelay: 5000,\n    defaultErrorContainer: 'form-message',\n    defaultSuccessContainer: 'form-message'\n  };\n\n  static state = {\n    errors: new Map(),\n    lastFocusedElement: null,\n    originalMessages: new Map(),\n    originalGeneralMessages: new Map(),\n  };\n\n  static configure(options = {}) {\n    this.config = {\n      ...this.config,\n      ...options\n    };\n  }\n\n  static getFormConfig(form) {\n    const formInstance = FormManager.getInstanceByElement(form);\n    if (formInstance) {\n      return {\n        ...this.config,\n        ...formInstance.config\n      };\n    }\n    return this.config;\n  }\n\n  static showSuccess(message, form = null, options = {}) {\n    let config = this.config;\n    let container = null;\n\n    if (form instanceof HTMLElement) {\n      config = this.getFormConfig(form);\n\n      if (config.successContainer) {\n        container = document.getElementById(config.successContainer);\n      } else {\n        container = form.querySelector('[data-success-container], .form-message, .success-message, .login-message');\n      }\n    } else if (typeof form === 'string') {\n      container = document.getElementById(form);\n    }\n\n    if (!container) {\n      container = document.getElementById(config.defaultSuccessContainer);\n    }\n\n    if (!container) return;\n\n    const containerId = container.id || Utils.generateUUID();\n    container.id = containerId;\n    if (!this.state.originalGeneralMessages.get(containerId)) {\n      // Store original content\n      this.state.originalGeneralMessages.set(containerId, {\n        html: container.innerHTML || '',\n        className: container.className || ''\n      });\n    }\n\n    container.textContent = Now.translate(message);\n    container.classList.add('success');\n\n    if (config.autoClearErrors && config.autoClearErrorsDelay > 0) {\n      setTimeout(() => {\n        // restore (clear) using container id\n        this.clearGeneralError(containerId);\n      }, config.autoClearErrorsDelay);\n    }\n\n    EventManager.emit('form:generalSuccess', {message, containerId, config});\n  }\n\n  static showGeneralError(message, form = null, options = {}) {\n    let config = this.config;\n    let container = null;\n\n    if (form instanceof HTMLElement) {\n      config = this.getFormConfig(form);\n\n      if (config.errorContainer) {\n        container = document.getElementById(config.errorContainer);\n      } else {\n        container = form.querySelector('[data-error-container], .form-message, .error-message, .login-message');\n      }\n    } else if (typeof form === 'string') {\n      container = document.getElementById(form);\n    }\n\n    if (!container) {\n      container = document.getElementById(config.defaultErrorContainer);\n    }\n\n    if (!container) return;\n\n    const containerId = container.id || Utils.generateUUID();\n    container.id = containerId;\n    if (!this.state.originalGeneralMessages.get(containerId)) {\n      // Store original content\n      this.state.originalGeneralMessages.set(containerId, {\n        html: container.innerHTML || '',\n        className: container.className || ''\n      });\n    }\n\n    const errorClass = config.errorMessageClass || 'error';\n    container.classList.add(errorClass);\n    container.textContent = Now.translate(message);\n\n    if (config.autoClearErrors && config.autoClearErrorsDelay > 0) {\n      setTimeout(() => {\n        // restore (clear) using container id\n        this.clearGeneralError(containerId);\n      }, config.autoClearErrorsDelay);\n    }\n\n    EventManager.emit('form:generalError', {message, containerId, config});\n  }\n\n  static showFieldError(field, message, form = null, options = {}) {\n    const element = document.getElementById(field) || document.querySelector(`[name=\"${field}\"]`);\n    if (!element) return;\n\n    let config = this.config;\n    if (form instanceof HTMLElement) {\n      config = this.getFormConfig(form);\n    }\n\n    const messages = Array.isArray(message) ? message : [message];\n    if (messages.length === 0) return;\n\n    // Determine result element ID - check data-result attribute first, fallback to result_{field}\n    const resultId = element.dataset.result || `result_${field}`;\n\n    if (!this.state.errors.has(field)) {\n      const comment = document.getElementById(resultId);\n      if (comment && !this.state.originalMessages.has(field)) {\n        // Store original message info\n        const hasI18n = comment.hasAttribute('data-i18n');\n        const i18nValue = comment.dataset?.i18n;\n        let i18nKey = null;\n\n        if (hasI18n) {\n          // If data-i18n has value, use it; otherwise textContent is the key\n          i18nKey = i18nValue && i18nValue.trim() !== '' ? i18nValue : comment.textContent;\n        }\n\n        this.state.originalMessages.set(field, {\n          text: comment.textContent,\n          i18nKey: i18nKey,\n          hasI18nAttr: hasI18n\n        });\n      }\n    }\n\n    this.state.errors.set(field, {\n      element,\n      messages\n    });\n\n    const errorClass = config.errorClass || 'invalid';\n\n    // Add error class to element\n    element.classList.add(errorClass);\n\n    // Add error class to element.container (from ElementFactory)\n    element.container?.classList.add(errorClass);\n\n    // Add error class to element.wrapper (from ElementFactory)\n    if (element.wrapper && element.wrapper !== element.container) {\n      element.wrapper.classList.add(errorClass);\n    }\n\n    // Also check for form-control parent (fallback for non-enhanced elements)\n    try {\n      let formControlParent = null;\n      if (element.parentElement && element.parentElement.classList && element.parentElement.classList.contains('form-control')) {\n        formControlParent = element.parentElement;\n      } else if (element.closest) {\n        formControlParent = element.closest('.form-control');\n      }\n\n      if (formControlParent && formControlParent !== element.container && formControlParent !== element.wrapper) {\n        formControlParent.classList.add(errorClass);\n      }\n    } catch (e) {}\n\n    // Show error message in result element if it exists\n    const comment = document.getElementById(resultId);\n    if (comment) {\n      comment.textContent = Now.translate(messages[0]);\n      comment.classList.add(config.errorMessageClass || 'error');\n      element.setAttribute('aria-errormessage', comment.id);\n    }\n\n    element.setAttribute('aria-invalid', 'true');\n\n    EventManager.emit('form:error', {field, messages, element, config});\n  }\n\n  static clearFieldError(field) {\n    const element = typeof field === 'string'\n      ? document.getElementById(field) || document.querySelector(`[name=\"${field}\"]`)\n      : field;\n\n    if (!element) return;\n\n    const elementId = element.id || element.name;\n    const errorClass = this.config.errorClass;\n\n    // Remove error class from element\n    element.classList.remove(errorClass);\n\n    // Remove error class from element.container (from ElementFactory)\n    element.container?.classList.remove(errorClass);\n\n    // Remove error class from element.wrapper (from ElementFactory)\n    if (element.wrapper && element.wrapper !== element.container) {\n      element.wrapper.classList?.remove(errorClass);\n    }\n\n    // Also check for form-control parent (fallback for non-enhanced elements)\n    try {\n      let formControlParent = null;\n      if (element.parentElement && element.parentElement.classList && element.parentElement.classList.contains('form-control')) {\n        formControlParent = element.parentElement;\n      } else if (element.closest) {\n        formControlParent = element.closest('.form-control');\n      }\n\n      if (formControlParent && formControlParent !== element.container && formControlParent !== element.wrapper) {\n        formControlParent.classList.remove(errorClass);\n      }\n    } catch (e) {}\n\n    // Determine result element ID - check data-result attribute first, fallback to result_{elementId}\n    const resultId = element.dataset?.result || `result_${elementId}`;\n    const comment = document.getElementById(resultId);\n    if (comment) {\n      comment.classList.remove(this.config.errorMessageClass);\n\n      // Only restore original message if this field actually had an error\n      // Don't clear text if there was no error to clear (prevents data loss)\n      if (this.state.errors.has(elementId) && this.state.originalMessages.has(elementId)) {\n        const original = this.state.originalMessages.get(elementId);\n        // Restore both i18n attribute and translated text\n        if (original.hasI18nAttr && original.i18nKey) {\n          // If original had data-i18n with explicit value, restore it\n          if (original.i18nKey !== original.text) {\n            comment.dataset.i18n = original.i18nKey;\n          } else {\n            // data-i18n was boolean (empty), set empty string\n            comment.dataset.i18n = '';\n          }\n          comment.textContent = Now.translate(original.i18nKey);\n        } else if (original.hasI18nAttr) {\n          // Had data-i18n but no key (shouldn't happen but handle it)\n          comment.dataset.i18n = '';\n          comment.textContent = original.text || '';\n        } else {\n          // No data-i18n originally\n          delete comment.dataset.i18n;\n          comment.textContent = original.text || '';\n        }\n        this.state.originalMessages.delete(elementId);\n      }\n    }\n\n    element.removeAttribute('aria-invalid');\n    element.removeAttribute('aria-errormessage');\n\n    // Clean up state if error was tracked\n    if (this.state.errors.has(elementId)) {\n      this.state.errors.delete(elementId);\n    }\n    if (this.state.lastFocusedElement === element) {\n      this.state.lastFocusedElement = null;\n    }\n\n    EventManager.emit('form:clearError', {field: elementId, element});\n  }\n\n  /**\n   * Clear general error message\n   * @param {string|HTMLElement} containerOrForm - Container ID, container element, or form element\n   */\n  static clearGeneralError(containerOrForm = null) {\n    let container = null;\n    let config = this.config;\n\n    if (typeof containerOrForm === 'string') {\n      container = document.getElementById(containerOrForm);\n    } else if (containerOrForm instanceof HTMLElement) {\n      if (containerOrForm.tagName === 'FORM') {\n        config = this.getFormConfig(containerOrForm);\n\n        if (config.errorContainer) {\n          container = document.getElementById(config.errorContainer);\n        }\n      } else {\n        container = document.getElementById(containerOrForm.id);\n      }\n    } else {\n      container = document.getElementById(config.defaultErrorContainer);\n    }\n\n    if (!container) {\n      const containers = document.querySelectorAll('[data-error-container], .form-message, .error-message, .login-message');\n      if (containers.length > 0) {\n        container = containers[0];\n      }\n    }\n\n    if (!container) return false;\n\n    const containerId = container.id || Utils.generateUUID();\n    container.id = containerId;\n    const original = this.state.originalGeneralMessages.get(containerId);\n    if (original) {\n      // Restore original content\n      container.innerHTML = original.html || '';\n      container.className = original.className || '';\n    } else {\n      // Store original content\n      this.state.originalGeneralMessages.set(containerId, {\n        html: container.innerHTML || '',\n        className: container.className || ''\n      });\n    }\n\n    container.classList.remove('show', 'visible', 'active');\n\n    EventManager.emit('form:clearGeneralError', {containerId, config});\n\n    return true;\n  }\n\n  /**\n   * Clear success message (similar to clearGeneralError)\n   * @param {string|HTMLElement} containerOrForm - Container ID, container element, or form element\n   */\n  static clearSuccess(containerOrForm = null) {\n    let container = null;\n    let config = this.config;\n\n    if (typeof containerOrForm === 'string') {\n      container = document.getElementById(containerOrForm);\n    } else if (containerOrForm instanceof HTMLElement) {\n      if (containerOrForm.tagName === 'FORM') {\n        config = this.getFormConfig(containerOrForm);\n\n        if (config.successContainer) {\n          container = document.getElementById(config.successContainer);\n        }\n      } else {\n        container = document.getElementById(containerOrForm.id);\n      }\n    } else {\n      container = document.getElementById(config.defaultSuccessContainer);\n    }\n\n    if (!container) {\n      const containers = document.querySelectorAll('[data-success-container], .form-message, .success-message, .login-message');\n      if (containers.length > 0) {\n        container = containers[0];\n      }\n    }\n\n    if (!container) return false;\n\n    const containerId = container.id || Utils.generateUUID();\n    container.id = containerId;\n    const original = this.state.originalGeneralMessages.get(containerId);\n    if (original) {\n      // Restore original content\n      container.innerHTML = original.html || '';\n      container.className = original.className || '';\n    } else {\n      // Store original content\n      this.state.originalGeneralMessages.set(containerId, {\n        html: container.innerHTML || '',\n        className: container.className || ''\n      });\n    }\n\n    container.classList.remove('show', 'visible', 'active');\n\n    EventManager.emit('form:clearSuccess', {containerId, config});\n\n    return true;\n  }\n\n  /**\n   * Clear all messages (errors, success, and field errors)\n   * @param {HTMLElement} form - Form element (optional)\n   */\n  static clearAll(form = null) {\n    this.state.errors.forEach((error, field) => {\n      this.clearFieldError(field);\n    });\n    this.state.lastFocusedElement = null;\n\n    if (form instanceof HTMLElement) {\n      this.clearGeneralError(form);\n      this.clearSuccess(form);\n    } else {\n      this.clearGeneralError();\n      this.clearSuccess();\n\n      const allContainers = document.querySelectorAll('[data-error-container], [data-success-container], .form-message, .error-message, .success-message, .login-message');\n      allContainers.forEach(container => {\n        container.classList.remove('show', 'visible', 'active');\n      });\n    }\n\n    EventManager.emit('form:clearAllErrors', {form});\n  }\n\n  /**\n   * Clear all messages for a specific form\n   * @param {HTMLElement|string} form - Form element or form ID\n   */\n  static clearFormMessages(form) {\n    let formElement = form;\n\n    if (typeof form === 'string') {\n      formElement = document.getElementById(form) || document.querySelector(`[data-form=\"${form}\"]`);\n    }\n\n    if (!formElement || formElement.tagName !== 'FORM') {\n      console.warn('FormError.clearFormMessages: Invalid form element');\n      return false;\n    }\n\n    const fields = formElement.querySelectorAll('[name], [id]');\n    fields.forEach(field => {\n      const fieldName = field.name || field.id;\n      if (fieldName && this.state.errors.has(fieldName)) {\n        this.clearFieldError(fieldName);\n      }\n    });\n\n    this.clearGeneralError(formElement);\n    this.clearSuccess(formElement);\n\n    return true;\n  }\n\n  static showErrors(errors, options = {}) {\n    this.clearAll();\n\n    Object.entries(errors).forEach(([field, message], index) => {\n      this.showFieldError(field, message, {\n        focus: index === 0,\n        scroll: index === 0,\n        ...options\n      });\n    });\n\n    EventManager.emit('form:errors', {errors});\n  }\n\n  static scrollToElement(element) {\n    const rect = element.getBoundingClientRect();\n    const windowHeight = window.innerHeight || document.documentElement.clientHeight;\n\n    const visibleThreshold = rect.height * 0.3;\n    const isPartiallyVisible =\n      (rect.top + visibleThreshold >= 0 && rect.top < windowHeight) ||\n      (rect.bottom > 0 && rect.bottom - visibleThreshold <= windowHeight);\n\n    if (!isPartiallyVisible) {\n      element.scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest'\n      });\n    }\n  }\n\n  static hasErrors() {\n    return this.state.errors.size > 0;\n  }\n\n  static getErrors() {\n    return Array.from(this.state.errors.entries()).map(([field, error]) => ({\n      field,\n      ...error\n    }));\n  }\n\n  /**\n   * Return number of current field errors\n   */\n  static getErrorsCount() {\n    return this.state.errors.size;\n  }\n\n  static reset() {\n    this.clearAll();\n    this.state = {\n      errors: new Map(),\n      lastFocusedElement: null,\n      originalMessages: new Map(),\n      originalGeneralMessages: new Map()\n    };\n  }\n}\n\nwindow.FormError = FormError;\n","const FormManager = {\n  config: {\n    ajaxSubmit: true,\n    autoValidate: true,\n    resetAfterSubmit: false,\n    autoEnhance: true,\n    autoInitialize: true,\n    autoGenerateFormId: true,\n    submitButtonSelector: '[type=\"submit\"]',\n    resetButtonSelector: '[type=\"reset\"]',\n    fieldSelector: 'input, select, textarea, [data-element]',\n    preventDoubleSubmit: true,\n    doubleSubmitTimeout: 2000,\n    showLoadingOnSubmit: true,\n    autoClearErrors: true,\n    autoClearErrorsDelay: 5000,\n    validateOnInput: true,\n    validateOnBlur: true,\n    validateOnlyDirty: true,\n    validatorRegistry: new Map(),\n    formatterRegistry: new Map(),\n    loadingClass: 'submitting',\n    validClass: 'valid',\n    invalidClass: 'invalid',\n    dirtyClass: 'modified',\n    successMessage: 'Form submitted successfully',\n    errorMessage: 'There was an error submitting the form',\n    actionAttribute: 'data-action',\n    methodAttribute: 'data-method',\n    redirectAttribute: 'data-redirect',\n    showErrorsInline: true,\n    showErrorsInNotification: true,\n    uploadProgressTemplate: `\n      <div class=\"upload-progress\" style=\"display:none\">\n        <div class=\"progress\">\n          <div class=\"progress-bar\" role=\"progressbar\" style=\"width:0%\"></div>\n        </div>\n        <div class=\"progress-text\"></div>\n      </div>\n    `\n  },\n\n  // observer config defaults (can be overridden by options.observerConfig)\n  observerConfig: {\n    observerDelay: 40,\n    observeRoot: null,\n    autoStartObserver: true\n  },\n\n  state: {\n    forms: new Map(),\n    // element -> instance mapping (weak reference to avoid leaks)\n    elementIndex: new WeakMap(),\n    initialized: false,\n    activeSubmit: null,\n    validators: new Map()\n  },\n\n  async init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n    if (options.observerConfig) this.observerConfig = {...this.observerConfig, ...options.observerConfig};\n\n    if (window.SecurityManager && window.SecurityManager.state.initialized) {\n      this.setupSecurityIntegration();\n    }\n\n    if (this.observerConfig.autoStartObserver) this.setupFormObserver();\n\n    if (this.config.autoInitialize) {\n      document.querySelectorAll('form[data-form]').forEach(form => {\n        if (this.shouldEnhance(form)) this.initForm(form);\n      });\n    }\n\n    this.registerStandardValidators();\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  registerStandardValidators() {\n    this.registerValidator('required', (value, element) => {\n      if (element.type === 'checkbox' || element.type === 'radio') {\n        return element.checked;\n      }\n      return value !== null && value !== undefined && value.toString().trim() !== '';\n    }, 'Please fill in');\n\n    this.registerValidator('email', (value) => {\n      return !value || /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value);\n    }, 'Please enter a valid email address');\n\n    this.registerValidator('url', (value) => {\n      return !value || /^(https?|ftp):\\/\\/[^\\s\\/$.?#].[^\\s]*$/.test(value);\n    }, 'Please enter a valid URL');\n\n    this.registerValidator('number', (value) => {\n      return !value || /^-?\\d*\\.?\\d+$/.test(value);\n    }, 'Please enter a valid number');\n\n    this.registerValidator('integer', (value) => {\n      return !value || /^-?\\d+$/.test(value);\n    }, 'Please enter a whole number');\n\n    this.registerValidator('min', (value, element, param) => {\n      return !value || parseFloat(value) >= parseFloat(param);\n    }, 'Value must be at least {min}');\n\n    this.registerValidator('max', (value, element, param) => {\n      return !value || parseFloat(value) <= parseFloat(param);\n    }, 'Value must be no more than {max}');\n\n    this.registerValidator('minlength', (value, element, param) => {\n      return !value || value.length >= parseInt(param);\n    }, 'Please enter at least {minlength} characters');\n\n    this.registerValidator('maxlength', (value, element, param) => {\n      const maxLength = parseInt(param);\n      return !value || isNaN(maxLength) || maxLength <= 0 || value.length <= maxLength;\n    }, 'Please enter no more than {maxlength} characters');\n\n    this.registerValidator('pattern', (value, element, param) => {\n      return !value || new RegExp(param).test(value);\n    }, 'Please match the requested format');\n\n    this.registerValidator('match', (value, element, param) => {\n      const target = document.getElementById(param) ||\n        document.getElementsByName(param)[0] ||\n        element.form.querySelector(`[name=\"${param}\"]`);\n      return !value || !target || value === target.value;\n    }, 'Fields do not match');\n  },\n\n  registerValidator(name, fn, defaultMessage) {\n    this.state.validators.set(name, {\n      validate: fn,\n      message: defaultMessage\n    });\n  },\n\n  registerFormatter(name, fn) {\n    this.config.formatterRegistry.set(name, fn);\n  },\n\n  async initForm(form) {\n    if (!form) return null;\n\n    // Require explicit opt-in: form must have data-form attribute\n    if (!form.dataset || !form.dataset.form) return null;\n\n    const formId = form.dataset.form;\n\n    // Defensive: avoid double-initialization. Prefer element identity (WeakMap) lookup\n    // to handle cases where templates are re-rendered and new DOM nodes replace\n    // old ones. If an instance exists for this exact element, return it.\n    try {\n      const existingByElement = this.state.elementIndex.get(form);\n      if (existingByElement) {\n        return existingByElement;\n      }\n\n      // If there's an instance registered by id, ensure it's not stale. If the\n      // mapped instance targets a different element or the element is no longer\n      // connected, destroy it so we can re-init cleanly.\n      const existingById = this.state.forms.get(formId);\n      if (existingById) {\n        // Check if existing element is still connected to DOM\n        if (existingById.element && !existingById.element.isConnected) {\n          // Old element disconnected - destroy stale instance\n          try {\n            this.destroyForm(existingById);\n          } catch (e) {\n            // swallow; we'll continue to init\n          }\n        } else if (existingById.element === form) {\n          // Same element, already initialized\n          return existingById;\n        } else if (existingById.element && existingById.element.isConnected) {\n          // Different element but old one still connected - this is unusual\n          // Could be duplicate IDs in DOM (invalid) - destroy old instance\n          try {\n            this.destroyForm(existingById);\n          } catch (e) {\n            // swallow; we'll continue to init\n          }\n        }\n      }\n    } catch (e) {\n      // Non-fatal - continue to init\n    }\n\n    try {\n      const instance = {\n        id: formId,\n        element: form,\n        elements: new Map(),\n        state: {\n          modified: false,\n          valid: true,\n          submitting: false,\n          data: {},\n          originalData: {},\n          errors: {},\n          submitCount: 0,\n          lastSubmitTime: 0\n        },\n        resetTimeout: null\n      };\n\n      // Register in maps immediately to prevent double-initialization race condition\n      this.state.forms.set(formId, instance);\n      try {this.state.elementIndex.set(form, instance);} catch (e) {}\n\n      const formConfig = this.extractFormConfig(form);\n      instance.config = {...this.config, ...formConfig};\n\n      if (form.dataset.autoFillIntendedUrl === 'true') {\n        this.autoFillIntendedUrl(form);\n      }\n\n      // Restore persisted values for fields marked with data-persist\n      try {\n        this.restorePersistedValues && this.restorePersistedValues(instance);\n      } catch (e) {}\n\n      if (form.querySelector('input[type=\"file\"]')) {\n        form.enctype = 'multipart/form-data';\n      }\n\n      try {\n        this.populateSelectsFromModalOptions(instance);\n      } catch (e) {\n        console.warn('FormManager: Failed to populate select options from modal:', e);\n      }\n\n      // Load form options BEFORE initFormElements so select elements have options\n      try {\n        await this.loadFormOptionsIfNeeded(instance);\n      } catch (e) {\n        console.warn('FormManager: Failed to load form options:', e);\n      }\n\n      // Load form data if data-load-api is specified\n      // Errors (403, 401) are handled inside loadFormDataIfNeeded with redirects\n      await this.loadFormDataIfNeeded(instance);\n\n\n      // Initialize form elements AFTER options are loaded\n      this.initFormElements(instance);\n\n      // Initialize cascading selects if CascadingSelectManager is available\n      if (window.CascadingSelectManager?.initInContainer) {\n        CascadingSelectManager.initInContainer(form);\n      }\n\n      // Restore remembered username/email for login forms (localStorage only)\n      try {\n        this.restoreRememberedCredentials && this.restoreRememberedCredentials(instance);\n      } catch (e) {}\n\n      // Populate fields from URL query parameters (data-url-param attribute)\n      try {\n        this.populateFromUrlParams(instance);\n      } catch (e) {\n        console.warn('FormManager: Failed to populate from URL params:', e);\n      }\n\n      this.setupFormEvents(instance);\n\n      instance.state.originalData = this.getFormData(instance, true);\n\n      EventManager.emit('form:init', {formId, instance});\n\n      return instance;\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'FormManager.initForm',\n        type: 'error:form',\n        data: {formId}\n      });\n      return null;\n    }\n  },\n\n  /**\n   * Load form data from API if data-load-api is specified\n   * Supports URL query parameters if data-load-query-params=\"true\"\n   * @param {Object} instance - Form instance\n   * @async\n   */\n  async loadFormDataIfNeeded(instance) {\n    const {element} = instance;\n    const loadApi = element.dataset.loadApi;\n\n    if (!loadApi) return;\n\n    try {\n      let url = loadApi;\n      let params = {};\n\n      // Extract query params from URL if data-load-query-params=\"true\"\n      if (element.dataset.loadQueryParams === 'true') {\n        const urlParams = new URLSearchParams(window.location.search);\n        const paramObj = Object.fromEntries(urlParams);\n\n        if (Object.keys(paramObj).length > 0) {\n          params = paramObj;\n        }\n      }\n\n      // Make API request\n      let response;\n      if (window.ApiService?.get) {\n        response = await window.ApiService.get(url, params);\n      } else if (window.simpleFetch?.get) {\n        const queryStr = new URLSearchParams(params).toString();\n        const fullUrl = queryStr ? `${url}?${queryStr}` : url;\n        response = await window.simpleFetch.get(fullUrl);\n      } else {\n        console.warn('FormManager: ApiService or simpleFetch not available');\n        return;\n      }\n\n      // Handle 403 Forbidden - redirect to 403 page\n      if (response.status === 403) {\n        console.warn('FormManager: Access forbidden (403) for form data API');\n\n        // Use RouterManager if available (SPA mode)\n        if (window.RouterManager?.navigate) {\n          window.RouterManager.navigate('/403');\n          return;\n        }\n\n        // Fallback to LocationManager\n        if (window.LocationManager?.redirect) {\n          window.LocationManager.redirect('/403');\n          return;\n        }\n\n        // Last resort: direct navigation\n        window.location.href = '/403';\n        return;\n      }\n\n      // Handle 401 Unauthorized - let AuthErrorHandler handle it\n      if (response.status === 401) {\n        console.warn('FormManager: Unauthorized (401) for form data API');\n\n        const error = new Error(response.statusText || 'Unauthorized');\n        error.status = 401;\n        error.response = response;\n\n        await AuthErrorHandler.handleError(error, {\n          currentPath: window.location.pathname\n        });\n        return;\n      }\n\n\n      // Extract options from standard format\n      const data = response.data.data || response.data;\n      instance.state.formOptions = data.options || null;\n\n      // Check if API returned actions (e.g., redirect, notification)\n      // This handles cases where data is not found or other error conditions\n      if (data && data.actions && Array.isArray(data.actions)) {\n        try {\n          await ResponseHandler.process(data, {\n            formId: instance.id,\n            form: element,\n            instance: instance,\n            source: 'form-load-api'\n          });\n          // If actions were processed, stop further processing\n          return response;\n        } catch (error) {\n          console.error('FormManager: Error processing load-api response actions', error);\n        }\n      }\n\n      // Populate select options if available before setting form data\n      if (instance.state.formOptions) {\n        SelectElementFactory.populateFromOptionsInContainer(element, instance.state.formOptions);\n        MultiSelectElementFactory.populateFromOptionsInContainer(element, instance.state.formOptions);\n        TagsElementFactory.populateFromOptionsInContainer(element, instance.state.formOptions);\n      }\n\n      // Handle tags inputs with data-attr bindings BEFORE setFormData\n      // This is needed because tags inputs need special handling for array values\n      if (instance.state.formOptions && data) {\n        const tagsInputs = element.querySelectorAll('input[type=\"text\"][data-element=\"tags\"][data-attr]');\n\n        tagsInputs.forEach(input => {\n          const attrValue = input.getAttribute('data-attr');\n          const match = attrValue?.match(/value:([\\w-]+)/);\n\n          if (match && match[1]) {\n            const fieldName = match[1];\n            const value = data[fieldName];\n\n            if (value !== undefined && value !== null && Array.isArray(value)) {\n              const optionsKey = input.getAttribute('data-options-key');\n              const options = instance.state.formOptions[optionsKey];\n\n              // Get the ElementManager instance\n              const tagsInstance = window.ElementManager?.getInstanceByElement(input);\n\n              if (tagsInstance && typeof tagsInstance.setValue === 'function' && options && Array.isArray(options)) {\n                // Map value IDs to their display text from options\n                const tags = value.map(val => {\n                  const option = options.find(opt =>\n                    (typeof opt === 'object' ? opt.value : opt) == val\n                  );\n                  if (option) {\n                    return typeof option === 'object'\n                      ? {key: option.value, value: option.text}\n                      : {key: option, value: option};\n                  }\n                  return {key: val, value: val};\n                });\n\n                tagsInstance.setValue(tags);\n              }\n            }\n          }\n        });\n      }\n\n      // Populate form fields with loaded data\n      if (response.data) {\n        this.setFormData(instance, data);\n      }\n\n      // Populate text input options if available after setting form data\n      if (instance.state.formOptions) {\n        TextElementFactory.populateFromOptionsInContainer(element, instance.state.formOptions);\n      }\n\n      return response;\n    } catch (error) {\n      // Handle 403 Forbidden - redirect to 403 page\n      if (error.status === 403 || error.response?.status === 403) {\n        console.warn('FormManager: Access forbidden (403) for form data API');\n\n        // Use RouterManager if available (SPA mode)\n        if (window.RouterManager?.navigate) {\n          window.RouterManager.navigate('/403');\n          return;\n        }\n\n        // Fallback to LocationManager\n        if (window.LocationManager?.redirect) {\n          window.LocationManager.redirect('/403');\n          return;\n        }\n\n        // Last resort: direct navigation\n        window.location.href = '/403';\n        return;\n      }\n\n      // Handle 401 Unauthorized - let AuthErrorHandler handle it\n      if (response.status === 401) {\n        console.warn('FormManager: Unauthorized (401) for form data API');\n\n        const error = new Error(response.statusText || 'Unauthorized');\n        error.status = 401;\n        error.response = response;\n\n        await AuthErrorHandler.handleError(error, {\n          currentPath: window.location.pathname\n        });\n        return;\n      }\n\n      console.error('FormManager: Error loading form data:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Load form options from API if data-load-options-api is specified\n   * Stores options in instance for later use\n   * Standard format: {data: {data: {...}, options: {...}}}\n   * @param {Object} instance - Form instance\n   * @async\n   */\n  async loadFormOptionsIfNeeded(instance) {\n    const {element} = instance;\n    const loadOptionsApi = element.dataset.loadOptionsApi;\n\n    if (!loadOptionsApi) return;\n\n    try {\n      // Wait for SecurityManager to be ready (CSRF token available)\n      if (window.SecurityManager) {\n        const maxWaitTime = 5000; // 5 seconds max\n        const startTime = Date.now();\n\n        while (!window.SecurityManager.state?.csrfToken && (Date.now() - startTime < maxWaitTime)) {\n          // If SecurityManager is initializing, wait for it\n          if (window.SecurityManager.state?.initialized === false) {\n            await new Promise(resolve => setTimeout(resolve, 50));\n          } else {\n            // SecurityManager initialized but no token - try to refresh\n            if (typeof window.SecurityManager.refreshCSRFToken === 'function') {\n              try {\n                await window.SecurityManager.refreshCSRFToken();\n              } catch (e) {\n                console.warn('FormManager: Failed to refresh CSRF token', e);\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      let response;\n      if (window.ApiService?.get) {\n        response = await window.ApiService.get(loadOptionsApi);\n      } else if (window.simpleFetch?.get) {\n        response = await window.simpleFetch.get(loadOptionsApi);\n      } else {\n        return;\n      }\n\n      // Extract options from standard format: response.data.data.options\n      const responseData = response.data || response;\n      const optionsData = responseData?.data?.options || null;\n\n      if (!optionsData) {\n        console.warn('FormManager: Invalid options format. Expected {data: {data: {...}, options: {...}}}');\n        return;\n      }\n\n      // Store options in instance for use by options or datalist\n      instance.state.formOptions = optionsData;\n\n      // Populate options data into elements\n      this.setFormOptions(element, instance.state.formOptions);\n      return response;\n    } catch (error) {\n      console.error('FormManager: Error loading form options:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Populate select elements with data-options-key from stored modal options\n   * This is called after modal template is initialized with form data\n   * @param {Object} instance - Form instance\n   */\n  populateSelectsFromModalOptions(instance) {\n    const {element} = instance;\n\n    // Get stored modal options from window scope (set by ResponseHandler)\n    const storedOptions = window._currentModalOptions || element.dataset.modalOptions;\n    const storedData = window._currentModalData || {};\n\n    if (!storedOptions) return;\n\n    const optionsData = typeof storedOptions === 'string' ? JSON.parse(storedOptions) : storedOptions;\n    if (optionsData && typeof optionsData === 'object') {\n      // Populate options data into elements\n      this.setFormOptions(element, optionsData);\n\n      // Set selected values from data if available\n      if (storedData && typeof storedData === 'object') {\n        // Find all select elements with data-options-key and data-attr\n        const selects = element.querySelectorAll('select[data-options-key][data-attr]');\n        selects.forEach(select => {\n          const attrValue = select.getAttribute('data-attr');\n          // Parse data-attr=\"value:provinceID\" to get field name\n          const match = attrValue?.match(/value:([\\w-]+)/);\n          if (match && match[1]) {\n            const fieldName = match[1];\n            let value = storedData[fieldName];\n\n            if (value !== undefined && value !== null) {\n              // Handle select multiple differently\n              if (select.multiple) {\n                // Convert to array if not already\n                const values = Array.isArray(value) ? value : [value];\n                // Convert to strings for comparison\n                const valueStrings = values.map(v => String(v));\n\n                // Set selected property on matching options\n                Array.from(select.options).forEach(option => {\n                  option.selected = valueStrings.includes(option.value);\n                });\n              } else {\n                // Single select - use value property\n                select.value = value;\n              }\n            }\n          }\n        });\n\n        // Also handle text inputs with data-options-key (autocomplete)\n        const textInputs = element.querySelectorAll('input[type=\"text\"][data-options-key][data-attr]');\n        textInputs.forEach(input => {\n          const attrValue = input.getAttribute('data-attr');\n          const match = attrValue?.match(/value:([\\w-]+)/);\n          if (match && match[1]) {\n            const fieldName = match[1];\n            const value = storedData[fieldName];\n            if (value !== undefined && value !== null) {\n              // Check if this is a tags input\n              const isTagsInput = input.getAttribute('data-element') === 'tags';\n\n              if (isTagsInput) {\n                // For tags input, handle array values\n                if (Array.isArray(value)) {\n                  const optionsKey = input.getAttribute('data-options-key');\n                  const options = optionsData[optionsKey];\n\n                  // Get the ElementManager instance\n                  const instance = window.ElementManager?.getInstanceByElement(input);\n\n                  if (instance && typeof instance.setValue === 'function' && options && Array.isArray(options)) {\n                    // Map value IDs to their display text from options\n                    const tags = value.map(val => {\n                      const option = options.find(opt =>\n                        (typeof opt === 'object' ? opt.value : opt) == val\n                      );\n                      if (option) {\n                        return typeof option === 'object'\n                          ? {key: option.value, value: option.text}\n                          : {key: option, value: option};\n                      }\n                      return {key: val, value: val};\n                    });\n\n                    instance.setValue(tags);\n                  }\n                }\n              } else {\n                // For text input with autocomplete, set the visible text\n                // The hidden input will be set by TextElementFactory if needed\n                const optionsKey = input.getAttribute('data-options-key');\n                const options = optionsData[optionsKey];\n                if (options && Array.isArray(options)) {\n                  const selectedOption = options.find(opt =>\n                    (typeof opt === 'object' ? opt.value : opt) == value\n                  );\n                  if (selectedOption) {\n                    input.value = typeof selectedOption === 'object' ? selectedOption.text : selectedOption;\n\n                    // Set hidden input if exists\n                    const hiddenInput = element.querySelector(`input[type=\"hidden\"][name=\"${input.name}\"]`);\n                    if (hiddenInput) {\n                      hiddenInput.value = value;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        });\n      }\n    }\n  },\n\n  /**\n   * Populate options data into elements\n   *\n   * @param {*} element\n   * @param {*} optionsData\n   */\n  setFormOptions(element, optionsData) {\n    SelectElementFactory.populateFromOptionsInContainer(element, optionsData);\n    MultiSelectElementFactory.populateFromOptionsInContainer(element, optionsData);\n    TextElementFactory.populateFromOptionsInContainer(element, optionsData);\n  },\n\n  /**\n   * Populate form fields from URL query parameters\n   * Uses setFormData() which handles data-attr=\"value:paramName\" bindings\n   * Same pattern as loading data from API\n   *\n   * @param {Object} instance - Form instance\n   * @example\n   * <input type=\"hidden\" name=\"token\" data-attr=\"value:token\">\n   * <input type=\"hidden\" name=\"uid\" data-attr=\"value:uid\">\n   *\n   * URL: /reset-password?token=abc123&uid=1\n   * Result: setFormData receives {token: 'abc123', uid: '1'}\n   *         Fields with data-attr=\"value:token\" get populated automatically\n   */\n  populateFromUrlParams(instance) {\n    const {element} = instance;\n\n    // Check if form wants URL params (data-load-url-params=\"true\")\n    if (element.dataset.loadUrlParams !== 'true') return;\n\n    // Get URL search params from multiple sources (support SPA routing)\n    const urlParams = new URLSearchParams(window.location.search);\n\n    // Also check hash fragment for SPA hash-mode routing\n    // e.g., /#/reset-password?token=abc becomes location.hash = \"#/reset-password?token=abc\"\n    const hashPart = window.location.hash;\n    const hashQueryIndex = hashPart.indexOf('?');\n    if (hashQueryIndex !== -1) {\n      const hashParams = new URLSearchParams(hashPart.substring(hashQueryIndex));\n      // Merge hash params into urlParams (hash params take precedence)\n      for (const [key, value] of hashParams.entries()) {\n        urlParams.set(key, value);\n      }\n    }\n\n    // Build data object from all URL params\n    const data = Object.fromEntries(urlParams.entries());\n\n    if (Object.keys(data).length === 0) {\n      // No URL params found\n      if (element.dataset.urlParamsRequired === 'true') {\n        const errorMessage = Now.translate('Invalid or missing URL parameters');\n        if (window.NotificationManager) {\n          NotificationManager.error(errorMessage);\n        }\n        // Disable form submission\n        const submitBtn = element.querySelector('[type=\"submit\"]');\n        if (submitBtn) {\n          submitBtn.disabled = true;\n        }\n      }\n      return;\n    }\n\n    // Use setFormData to populate fields (handles data-attr bindings automatically)\n    this.setFormData(instance, data);\n    console.debug(`FormManager: Populated form from URL params:`, Object.keys(data));\n\n    // Check for required params that are missing\n    const requiredParams = element.dataset.urlParamsRequiredFields;\n    if (requiredParams) {\n      const required = requiredParams.split(',').map(p => p.trim());\n      const missing = required.filter(p => !data[p]);\n\n      if (missing.length > 0) {\n        this.emitEvent('form:urlParamsMissing', {\n          formId: instance.id,\n          missingParams: missing\n        });\n\n        if (element.dataset.urlParamsRequired === 'true') {\n          const errorMessage = Now.translate('Invalid or missing URL parameters');\n          if (window.NotificationManager) {\n            NotificationManager.error(errorMessage);\n          }\n          const submitBtn = element.querySelector('[type=\"submit\"]');\n          if (submitBtn) {\n            submitBtn.disabled = true;\n          }\n        }\n      }\n    }\n  },\n\n  /**\n   * Sets up the form observer to automatically initialize forms\n   */\n  setupSecurityIntegration() {\n    document.addEventListener('security:error', (event) => {\n      this.handleSecurityError(event.detail);\n    });\n\n    document.addEventListener('csrf:refreshed', (event) => {\n      this.updateFormsWithNewCSRF(event.detail.token);\n    });\n  },\n\n  /**\n   * Handle security errors emitted by SecurityManager\n   * @param {Object} detail\n   */\n  handleSecurityError(detail) {\n    try {\n      const info = detail || {};\n      const message = info.message || info.error || 'A security error occurred';\n\n      // Prefer centralized AuthManager.handleError when available\n      const authManager = window.Now?.getManager ? Now.getManager('auth') : window.AuthManager;\n      if (authManager && typeof authManager.handleError === 'function') {\n        try {\n          authManager.handleError('Security error', new Error(message), {detail: info});\n        } catch (e) {\n          // swallow errors from centralized handler to avoid cascading failures\n          console.warn('FormManager: AuthManager.handleError threw an error', e);\n        }\n      } else if (window.ErrorManager && typeof ErrorManager.handle === 'function') {\n        // Fallback to ErrorManager for logging if AuthManager isn't available\n        try {\n          ErrorManager.handle(new Error(message), {context: 'FormManager.handleSecurityError', data: info});\n        } catch (e) {\n          console.warn('FormManager: ErrorManager.handle threw an error', e);\n        }\n      } else {\n        // Last-resort: show a user notification or console warning\n        if (window.NotificationManager) {\n          NotificationManager.error(message);\n        } else {\n          console.warn('FormManager security error:', message, info);\n        }\n      }\n\n      // If this looks like an authentication/CSRF issue, clear form-related state\n      if (info.status === 401 || info.code === 'unauthorized' || info.code === 'csrf_invalid') {\n        // Clear any client-side tokens to avoid further failures\n        try {localStorage.removeItem('auth_token');} catch (e) {}\n        try {localStorage.removeItem(this.config.token?.storageKey || 'auth_user');} catch (e) {}\n\n        // Optionally redirect to login if AuthManager is available\n        if (authManager && typeof authManager.redirectTo === 'function') {\n          authManager.redirectTo(authManager.config?.redirects?.unauthorized || '/login');\n        }\n      }\n    } catch (err) {\n      // If our new delegation fails, ensure we still surface something useful\n      try {\n        console.error('Error in FormManager.handleSecurityError', err);\n      } catch (ee) {\n        // swallow\n      }\n    }\n  },\n\n  /**\n   * Handles security errors by showing a notification or redirecting\n   * @param {Object} error - The security error object\n   * @return {void}\n   */\n  handleRateLimitError(instance, rateLimitResult) {\n    const message = Now.translate(`Too many requests. Please try again in {retryAfter} seconds.`, {retryAfter: rateLimitResult.retryAfter});\n\n    FormError.showGeneralError(message, instance.element);\n\n    this.emitEvent('form:rateLimit', {\n      formId: instance.id,\n      rateLimitResult\n    });\n  },\n\n  /**\n   * Updates all forms with the new CSRF token\n   * @param {string} token - The new CSRF token to set\n   * @return {void}\n   */\n  updateFormsWithNewCSRF(token) {\n    this.state.forms.forEach((instance) => {\n      const csrfInput = instance.element.querySelector('input[name=\"_token\"]');\n      if (csrfInput) {\n        csrfInput.value = token;\n      }\n    });\n  },\n\n  /**\n   * Handles security errors by showing a notification or redirecting\n   * @param {Object} error - The security error object\n   * @return {void}\n   */\n  extractFormConfig(form) {\n    const config = {};\n    const dataAttrs = form.dataset;\n\n    if (dataAttrs.csrf !== undefined) {\n      config.csrf = dataAttrs.csrf === 'true';\n    }\n    if (dataAttrs.rateLimit !== undefined) {\n      config.rateLimit = dataAttrs.rateLimit === 'true';\n    }\n    if (dataAttrs.validation !== undefined) {\n      config.validation = dataAttrs.validation === 'true';\n    }\n\n    if (dataAttrs.rateLimitEndpoint) {\n      config.rateLimitEndpoint = dataAttrs.rateLimitEndpoint;\n    }\n    if (dataAttrs.rateLimitLimit) {\n      config.rateLimitLimit = parseInt(dataAttrs.rateLimitLimit);\n    }\n    if (dataAttrs.rateLimitWindow) {\n      config.rateLimitWindow = parseInt(dataAttrs.rateLimitWindow) * 1000;\n    }\n\n    if (dataAttrs.csrfToken) {\n      config.csrfToken = dataAttrs.csrfToken;\n    }\n    if (dataAttrs.csrfHeader) {\n      config.csrfHeader = dataAttrs.csrfHeader;\n    }\n\n    if (dataAttrs.validateOnSubmit !== undefined) {\n      config.validateOnSubmit = dataAttrs.validateOnSubmit === 'true';\n    }\n    if (dataAttrs.sanitizeInput !== undefined) {\n      config.sanitizeInput = dataAttrs.sanitizeInput === 'true';\n    }\n\n    ['ajaxSubmit', 'autoValidate', 'resetAfterSubmit', 'preventDoubleSubmit', 'showLoadingOnSubmit', 'showErrorsInline', 'showErrorsInNotification'].forEach(attr => {\n      if (dataAttrs[attr] !== undefined) {\n        config[attr] = dataAttrs[attr] === 'true';\n      }\n    });\n\n    // Support data-validate as an alias for data-auto-validate\n    if (dataAttrs.validate !== undefined) {\n      config.autoValidate = dataAttrs.validate === 'true';\n    }\n\n    if (dataAttrs.errorContainer) {\n      config.errorContainer = dataAttrs.errorContainer;\n    }\n\n    if (dataAttrs.showErrorsInline !== undefined) {\n      config.showErrorsInline = dataAttrs.showErrorsInline === 'true';\n    }\n\n    if (dataAttrs.showErrorsInNotification !== undefined) {\n      config.showErrorsInNotification = dataAttrs.showErrorsInNotification === 'true';\n    }\n\n    if (dataAttrs.errorClass) {\n      config.errorClass = dataAttrs.errorClass;\n    }\n\n    if (dataAttrs.errorMessageClass) {\n      config.errorMessageClass = dataAttrs.errorMessageClass;\n    }\n\n    if (dataAttrs.autoClearErrors !== undefined) {\n      config.autoClearErrors = dataAttrs.autoClearErrors === 'true';\n    }\n\n    if (dataAttrs.autoClearErrorsDelay) {\n      config.autoClearErrorsDelay = parseInt(dataAttrs.autoClearErrorsDelay);\n    }\n\n    if (dataAttrs.autoFocusError !== undefined) {\n      config.autoFocusError = dataAttrs.autoFocusError === 'true';\n    }\n\n    if (dataAttrs.autoScrollToError !== undefined) {\n      config.autoScrollToError = dataAttrs.autoScrollToError === 'true';\n    }\n\n    if (dataAttrs.successContainer) {\n      config.successContainer = dataAttrs.successContainer;\n    }\n\n    if (dataAttrs.showSuccessInline !== undefined) {\n      config.showSuccessInline = dataAttrs.showSuccessInline === 'true';\n    }\n\n    if (dataAttrs.showSuccessInNotification !== undefined) {\n      config.showSuccessInNotification = dataAttrs.showSuccessInNotification === 'true';\n    }\n\n    // Extract success-specific data attributes\n    if (dataAttrs.successRedirect) {\n      config.successRedirect = dataAttrs.successRedirect;\n    }\n\n    if (dataAttrs.successMessage) {\n      config.successMessage = dataAttrs.successMessage;\n    }\n\n    if (dataAttrs.loadingText) {\n      config.loadingText = dataAttrs.loadingText;\n    }\n\n    return config;\n  },\n\n  initFormElements(instance) {\n    const {element, elements} = instance;\n\n    const fields = element.querySelectorAll(this.config.fieldSelector);\n\n    fields.forEach(field => {\n      if (!field.name && !field.id) {\n        console.warn('FormManager: Field without name or id found:', field);\n        return;\n      }\n\n      const fieldName = field.name || field.id;\n      const fieldType = this.getFieldType(field);\n\n      if (fieldType === 'radio') {\n        if (!elements.has(fieldName)) {\n          elements.set(fieldName, []);\n        }\n        elements.get(fieldName).push(field);\n\n        if (field.checked) {\n          instance.state.data[fieldName] = field.value;\n        }\n        return;\n      }\n\n      if (fieldType === 'checkbox' && !fieldName.endsWith('[]')) {\n        elements.set(fieldName, field);\n        instance.state.data[fieldName] = field.checked;\n        return;\n      }\n\n      if (fieldType === 'checkbox' && fieldName.endsWith('[]')) {\n        const baseName = fieldName.slice(0, -2);\n        if (!elements.has(baseName)) {\n          elements.set(baseName, []);\n          instance.state.data[baseName] = [];\n        }\n        elements.get(baseName).push(field);\n        if (field.checked) {\n          instance.state.data[baseName].push(field.value);\n        }\n        return;\n      }\n\n      elements.set(fieldName, field);\n\n      if (fieldType === 'file') {\n        instance.state.data[fieldName] = null;\n      } else if (fieldType === 'select-multiple' || field.tagName.toLowerCase() === 'select') {\n        // Handle select-multiple with name[] format\n        const baseName = fieldName.endsWith('[]') ? fieldName.slice(0, -2) : fieldName;\n\n        // Store with base name for easier lookup\n        if (baseName !== fieldName) {\n          elements.set(baseName, field);\n        }\n\n        // For select elements, only store value if there's an explicitly selected option\n        // or if the select has a value attribute set\n        if (field.multiple) {\n          // For multiple selects, check if any options have selected attribute\n          const selectedOptions = field.querySelectorAll('option[selected]');\n          if (selectedOptions.length > 0) {\n            instance.state.data[baseName] = Array.from(selectedOptions).map(opt => opt.value);\n          } else if (field.selectedOptions.length > 0) {\n            // Fallback to selectedOptions property\n            instance.state.data[baseName] = Array.from(field.selectedOptions).map(opt => opt.value);\n          } else {\n            instance.state.data[baseName] = [];\n          }\n        } else {\n          // For single selects\n          const selectedOption = field.querySelector('option[selected]');\n          if (selectedOption) {\n            instance.state.data[baseName] = selectedOption.value;\n          } else if (field.value && field.options.length > 0) {\n            // If no explicit selected attribute but has value, use it\n            instance.state.data[baseName] = field.value;\n          } else {\n            instance.state.data[baseName] = '';\n          }\n        }\n      } else {\n        instance.state.data[fieldName] = field.value;\n      }\n\n      if (instance.config.autoEnhance && window.ElementManager) {\n        window.ElementManager.enhance(field);\n      }\n    });\n\n    return elements;\n  },\n\n  /**\n   * Determines the type of a form field element\n   * @param {HTMLElement} field - The form field element to check\n   * @returns {string} The field type - either from data-element attribute, input type, or lowercase tag name\n   */\n  getFieldType(field) {\n    if (field.dataset.element) {\n      return field.dataset.element;\n    }\n\n    if (field.tagName.toLowerCase() === 'input') {\n      return field.type || 'text';\n    }\n\n    return field.tagName.toLowerCase();\n  },\n\n  /**\n   * Sets up event listeners for form submission and field changes\n   * @param {Object} instance - The form instance to set up events for\n   * @returns {void}\n   */\n  setupFormEvents(instance) {\n    const {element} = instance;\n\n    element.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      // Clear any previous errors before processing new submission\n      FormError.clearFormMessages(element);\n      instance.state.errors = {};\n\n      // Check for confirmation dialog\n      const confirmMessage = element.getAttribute('data-confirm');\n      if (confirmMessage) {\n        const confirmed = await DialogManager.confirm(Now.translate(confirmMessage));\n        if (!confirmed) return;\n      }\n\n      if (window.SecurityManager) {\n        if (instance.config.rateLimit !== false) {\n          const endpoint = instance.config.rateLimitEndpoint ||\n            element.action ||\n            window.location.pathname;\n\n          const rateLimitResult = SecurityManager.checkRateLimit(endpoint);\n          if (!rateLimitResult.allowed) {\n            this.handleRateLimitError(instance, rateLimitResult);\n            return false;\n          }\n        }\n      }\n\n      if (instance.config.preventDoubleSubmit) {\n        const now = Date.now();\n        if (instance.state.submitting ||\n          (now - instance.state.lastSubmitTime < instance.config.doubleSubmitTimeout)) {\n          console.warn('FormManager: Double submit prevented');\n          return false;\n        }\n        instance.state.lastSubmitTime = now;\n      }\n\n      try {\n        instance.state.submitting = true;\n        instance.state.submitCount++;\n\n        if (instance.config.showLoadingOnSubmit) {\n          element.classList.add(instance.config.loadingClass);\n        }\n\n        const submitButton = element.querySelector(instance.config.submitButtonSelector);\n        if (submitButton) {\n          submitButton.disabled = true;\n          this.state.activeSubmit = submitButton;\n\n          if (submitButton.textContent.trim()) {\n            submitButton._originalText = submitButton.textContent;\n            submitButton.textContent = instance.config.loadingText || 'Operating';\n          }\n        }\n\n        this.emitEvent('form:submitting', {\n          formId: instance.id,\n          form: instance\n        });\n\n        if (instance.config.autoValidate) {\n          const isValid = await this.validateForm(instance);\n          if (!isValid) {\n            this.handleInvalidSubmit(instance);\n            return false;\n          }\n        }\n\n        const data = this.getFormData(instance);\n\n        // Check if CSRF token is present\n        if (instance.config.csrf !== false && data.jsonData && !data.jsonData._token) {\n          // Check if we're in development mode (suppress warnings for localhost/dev)\n          const isDevelopment = window.location.hostname === 'localhost' ||\n            window.location.hostname === '127.0.0.1' ||\n            window.location.hostname.includes('dev') ||\n            window.location.hostname.includes('local');\n\n          if (!isDevelopment) {\n            console.warn('CSRF token is missing from form data');\n          }\n\n          // Try to get CSRF token from meta tag or cookie\n          const csrfToken = document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content') ||\n            document.cookie.split(';').find(c => c.trim().startsWith('XSRF-TOKEN='))?.split('=')[1];\n\n          if (csrfToken) {\n            data.jsonData._token = csrfToken;\n            if (data.formData) {\n              data.formData.append('_token', csrfToken);\n            }\n          } else if (!isDevelopment) {\n            console.warn('No CSRF token found in meta tag or cookies');\n          }\n        }\n\n        if (!data.jsonData || Object.keys(data.jsonData).length === 0) {\n          throw new Error('No form data to submit');\n        }\n\n        let response;\n        if (instance.config.ajaxSubmit) {\n          response = await this.submitAjax(instance, data);\n        } else {\n          element.submit();\n          response = {success: true};\n        }\n\n        // Enhanced success checking - NORMALIZED\n        // After normalization, response structure is always:\n        // { success: true/false, message: \"...\", data: {...}, status: 201 }\n        const isSuccess = response && response.success === true;\n\n        if (isSuccess) {\n          this.handleSuccessfulSubmit(instance, response);\n          // After successful submit, save any persisted fields (triggered on submit)\n          try {\n            this.savePersistedValues && this.savePersistedValues(instance);\n          } catch (e) {}\n        } else {\n          this.handleFailedSubmit(instance, response);\n        }\n\n        return response;\n\n      } catch (error) {\n        this.handleSubmitError(instance, error);\n        return false;\n      } finally {\n        const submitButton = element.querySelector(instance.config.submitButtonSelector);\n        if (submitButton) {\n          submitButton.disabled = false;\n\n          if (submitButton._originalText) {\n            submitButton.textContent = submitButton._originalText;\n            delete submitButton._originalText;\n          }\n        }\n\n        element.classList.remove(instance.config.loadingClass);\n\n        clearTimeout(instance.resetTimeout);\n        instance.resetTimeout = setTimeout(() => {\n          instance.state.submitting = false;\n          this.state.activeSubmit = null;\n        }, 100);\n      }\n    });\n\n    element.addEventListener('reset', (e) => {\n      this.resetForm(instance);\n    });\n\n    element.addEventListener('change', async (e) => {\n      const field = e.target;\n      const name = field.name;\n\n      if (!name) return;\n\n      switch (field.type) {\n        case 'checkbox':\n          if (name.endsWith('[]')) {\n            const baseName = name.slice(0, -2);\n            instance.state.data[baseName] = this.getCheckboxGroupValues(element, name);\n          } else {\n            instance.state.data[name] = field.checked;\n          }\n          break;\n\n        case 'radio':\n          if (field.checked) {\n            instance.state.data[name] = field.value;\n          }\n          break;\n\n        case 'file':\n          instance.state.data[name] = field.files.length > 0 ? true : null;\n          break;\n\n        default:\n          instance.state.data[name] = field.value;\n      }\n\n      instance.state.modified = true;\n\n      field.classList.add(instance.config.dirtyClass);\n\n      this.emitEvent('form:field:change', {\n        formId: instance.id,\n        field: field,\n        name: name,\n        value: instance.state.data[name]\n      });\n\n      // Handle cascade if this field has data-cascade-source\n      if (field.dataset.cascadeSource) {\n        await this.handleCascade(instance, field);\n      }\n    });\n\n    if (instance.config.validateOnInput) {\n      element.addEventListener('input', Utils.function.debounce((e) => {\n        const field = e.target;\n        if (field.name) {\n          this.validateField(instance, field);\n        }\n      }, 300));\n    }\n\n    if (instance.config.validateOnBlur) {\n      element.addEventListener('blur', (e) => {\n        const field = e.target;\n        if (field.name) {\n          this.validateField(instance, field);\n        }\n      }, true);\n    }\n  },\n\n  async validateField(instance, field, forceValidate = false) {\n    const fieldName = field.name;\n    if (!fieldName) return true;\n\n    // Skip validation for unmodified fields unless forced (e.g., on form submit)\n    if (!forceValidate && instance.config.validateOnlyDirty &&\n      !field.classList.contains(instance.config.dirtyClass)) {\n      return true;\n    }\n\n    FormError.clearFieldError(fieldName);\n    delete instance.state.errors[fieldName];\n\n    // Prefer element identity lookup to avoid stale id-only matches when DOM nodes are recreated\n    let elementInstance = null;\n    try {\n      const em = window.ElementManager;\n      if (em && typeof em.getInstanceByElement === 'function') {\n        elementInstance = em.getInstanceByElement(field) || null;\n      }\n      // fallback to id-based lookup if no instance found by element\n      if (!elementInstance && field.id && em && typeof em.getInstance === 'function') {\n        elementInstance = em.getInstance(field.id) || null;\n        // if id-mapped instance is stale (element different or disconnected), ignore it\n        if (elementInstance && elementInstance.element && elementInstance.element !== field) {\n          if (!elementInstance.element.isConnected) {\n            try {em.destroy(field.id);} catch (e) {}\n            elementInstance = null;\n          }\n        }\n      }\n    } catch (e) {\n      elementInstance = null;\n    }\n    if (elementInstance && typeof elementInstance.validate === 'function') {\n      try {\n        elementInstance.validate(field.value, true);\n        return elementInstance.isValid();\n      } catch (error) {\n        FormError.showFieldError(fieldName, error.message || 'Validation error', instance.element);\n        instance.state.errors[fieldName] = error.message || 'Validation error';\n        return false;\n      }\n    }\n\n    const value = this.getFieldValue(field);\n\n    if (field.required && (value === null || value === undefined || value === '')) {\n      const message = Now.translate(field.dataset.errorRequired || 'Please fill in');\n      FormError.showFieldError(fieldName, message, instance.element);\n      instance.state.errors[fieldName] = message;\n      return false;\n    }\n\n    if (value === null || value === '' || value === undefined) {\n      return true;\n    }\n\n    if (field.pattern) {\n      const pattern = new RegExp(field.pattern);\n      if (!pattern.test(value)) {\n        const message = Now.translate(field.dataset.errorPattern || 'Please enter a valid format');\n        FormError.showFieldError(fieldName, message, instance.element);\n        instance.state.errors[fieldName] = message;\n        return false;\n      }\n    }\n\n    if (field.type === 'number' || field.type === 'range') {\n      const numValue = parseFloat(value);\n\n      if (!isNaN(numValue)) {\n        if (field.min !== undefined && field.min !== '' && numValue < parseFloat(field.min)) {\n          const message = Now.translate(field.dataset.errorMin || 'Value must be at least {min}', {min: field.min});\n          FormError.showFieldError(fieldName, message, instance.element);\n          instance.state.errors[fieldName] = message;\n          return false;\n        }\n\n        if (field.max !== undefined && field.max !== '' && numValue > parseFloat(field.max)) {\n          const message = Now.translate(field.dataset.errorMax || 'Value must be no more than {max}', {max: field.max});\n          FormError.showFieldError(fieldName, message, instance.element);\n          instance.state.errors[fieldName] = message;\n          return false;\n        }\n      }\n    }\n\n    if (typeof value === 'string') {\n      if (field.minLength && value.length < parseInt(field.minLength)) {\n        const message = Now.translate(field.dataset.errorMinlength || 'Please enter at least {minlength} characters', {minlength: field.minLength});\n        FormError.showFieldError(fieldName, message, instance.element);\n        instance.state.errors[fieldName] = message;\n        return false;\n      }\n\n      if (field.maxLength && field.maxLength > 0 && value.length > parseInt(field.maxLength)) {\n        const message = Now.translate(field.dataset.errorMaxlength || 'Please enter no more than {maxlength} characters', {maxlength: field.maxLength});\n        FormError.showFieldError(fieldName, message, instance.element);\n        instance.state.errors[fieldName] = message;\n        return false;\n      }\n    }\n\n    for (const [name, validator] of this.state.validators) {\n      if (field.dataset[`validate${name.charAt(0).toUpperCase() + name.slice(1)}`] !== undefined) {\n        const param = field.dataset[`validate${name.charAt(0).toUpperCase() + name.slice(1)}`] || '';\n\n        if (!validator.validate(value, field, param)) {\n          let message = field.dataset[`error${name.charAt(0).toUpperCase() + name.slice(1)}`] ||\n            validator.message;\n\n          // Only replace parameter if it's valid (not empty and not NaN for numeric validators)\n          if (param && param.trim() !== '') {\n            if (name === 'maxlength' || name === 'minlength') {\n              const numParam = parseInt(param);\n              if (!isNaN(numParam) && numParam > 0) {\n                message = message.replace('{0}', param);\n              }\n            } else {\n              message = message.replace('{0}', param);\n            }\n          }\n\n          FormError.showFieldError(fieldName, message, instance.element);\n          instance.state.errors[fieldName] = message;\n          return false;\n        }\n      }\n    }\n\n    if (field.dataset.validateFn && window[field.dataset.validateFn]) {\n      const validationFn = window[field.dataset.validateFn];\n      try {\n        const result = await validationFn(value, field, instance);\n        if (result !== true) {\n          const message = typeof result === 'string' ? result : 'Validation failed';\n          FormError.showFieldError(fieldName, message, instance.element);\n          instance.state.errors[fieldName] = message;\n          return false;\n        }\n      } catch (error) {\n        FormError.showFieldError(fieldName, error.message || 'Validation error', instance.element);\n        instance.state.errors[fieldName] = error.message || 'Validation error';\n        return false;\n      }\n    }\n\n    field.classList.add(instance.config.validClass);\n    field.classList.remove(instance.config.invalidClass);\n    return true;\n  },\n\n  async validateForm(instance) {\n    FormError.clearAll();\n    instance.state.errors = {};\n\n    let isValid = true;\n    const invalidFields = [];\n\n    const promises = [];\n\n    // Force validate all fields on form submit (bypass validateOnlyDirty)\n    for (const [name, field] of instance.elements) {\n      if (Array.isArray(field)) {\n        if (field.length > 0) {\n          promises.push(this.validateField(instance, field[0], true).then(\n            valid => {\n              if (!valid) {\n                isValid = false;\n                invalidFields.push(field[0]);\n              }\n            }\n          ));\n        }\n      } else {\n        promises.push(this.validateField(instance, field, true).then(\n          valid => {\n            if (!valid) {\n              isValid = false;\n              invalidFields.push(field);\n            }\n          }\n        ));\n      }\n    }\n\n    await Promise.all(promises);\n\n    instance.state.valid = isValid;\n\n    if (!isValid && invalidFields.length > 0) {\n      invalidFields[0].focus();\n\n      invalidFields[0].scrollIntoView({\n        behavior: 'smooth',\n        block: 'center'\n      });\n    }\n\n    this.emitEvent('form:validate', {\n      formId: instance.id,\n      isValid,\n      errors: instance.state.errors,\n      invalidFields\n    });\n\n    return isValid;\n  },\n\n  getFieldValue(field) {\n    switch (field.type) {\n      case 'checkbox':\n        if (field.name.endsWith('[]')) {\n          return this.getCheckboxGroupValues(field.form, field.name);\n        }\n        return field.checked;\n\n      case 'radio':\n        const checkedRadio = field.form.querySelector(`input[name=\"${field.name}\"]:checked`);\n        return checkedRadio ? checkedRadio.value : null;\n\n      case 'select-multiple':\n        return Array.from(field.selectedOptions).map(opt => opt.value);\n\n      case 'file':\n        return field.files.length > 0 ? field.files : null;\n\n      default:\n        return field.value;\n    }\n  },\n\n  getCheckboxGroupValues(form, name) {\n    const checkboxes = form.querySelectorAll(`input[name=\"${name}\"]:checked`);\n    return Array.from(checkboxes).map(cb => cb.value);\n  },\n\n  getFormData(instance, loading = false) {\n    const {element} = instance;\n    const formData = new FormData();\n    const jsonData = {};\n\n    // Read directly from native form.elements like a real form submit would.\n    // This ensures AJAX submit matches native submit behavior exactly and\n    // automatically handles dynamically created inputs without registration.\n    const processedNames = new Set();\n\n    try {\n      const nativeElements = element.elements; // HTMLFormControlsCollection\n      if (nativeElements && nativeElements.length) {\n        for (const nativeEl of Array.from(nativeElements)) {\n          const name = nativeEl.name;\n          if (!name) continue; // Skip unnamed controls\n\n          // Skip if we already processed this name (for radio/checkbox groups)\n          if (processedNames.has(name)) continue;\n\n          // Handle different input types\n          if (nativeEl.type === 'radio') {\n            // For radio groups, only include the checked one\n            const checked = element.querySelector(`input[name=\"${name}\"]:checked`);\n            if (checked) {\n              formData.append(name, checked.value || '');\n              jsonData[name] = checked.value || '';\n            }\n            processedNames.add(name);\n            continue;\n          }\n\n          if (nativeEl.type === 'checkbox') {\n            // Handle checkbox groups (name[])\n            if (name.endsWith('[]')) {\n              const baseName = name.slice(0, -2);\n              if (!processedNames.has(baseName)) {\n                const checked = element.querySelectorAll(`input[name=\"${name}\"]:checked`);\n                const vals = Array.from(checked).map(cb => cb.value || '');\n                vals.forEach(v => formData.append(name, v));\n                jsonData[baseName] = vals;\n                processedNames.add(baseName);\n              }\n            } else {\n              // Single checkbox\n              const val = nativeEl.checked ? '1' : '0';\n              formData.append(name, val);\n              jsonData[name] = nativeEl.checked;\n              processedNames.add(name);\n            }\n            continue;\n          }\n\n          if (nativeEl.type === 'file') {\n            // Handle file inputs\n            if (nativeEl.multiple && nativeEl.files.length > 0) {\n              Array.from(nativeEl.files).forEach(file => formData.append(`${name}[]`, file));\n              jsonData[name] = Array.from(nativeEl.files).map(f => f.name);\n            } else if (nativeEl.files.length > 0) {\n              formData.append(name, nativeEl.files[0]);\n              jsonData[name] = nativeEl.files[0].name;\n            }\n            processedNames.add(name);\n            continue;\n          }\n\n          if (nativeEl.tagName.toLowerCase() === 'select' && nativeEl.multiple) {\n            // Handle multi-select\n            const values = Array.from(nativeEl.selectedOptions).map(opt => opt.value);\n            values.forEach(v => formData.append(`${name}[]`, v));\n            jsonData[name] = values;\n            processedNames.add(name);\n            continue;\n          }\n\n          // Handle other array inputs (e.g. hidden inputs with name=\"skills[]\")\n          if (name.endsWith('[]')) {\n            if (!processedNames.has(name)) {\n              const inputs = element.querySelectorAll(`[name=\"${name}\"]`);\n              const values = Array.from(inputs).map(input => input.value);\n\n              values.forEach(v => formData.append(name, v));\n\n              // For JSON, use the base name without [] to be consistent with checkboxes\n              const baseName = name.slice(0, -2);\n              jsonData[baseName] = values;\n\n              processedNames.add(name);\n            }\n            continue;\n          }\n\n          // Default: text, hidden, textarea, select (single), etc.\n          const value = nativeEl.value || '';\n          formData.append(name, value);\n          jsonData[name] = value;\n          processedNames.add(name);\n        }\n      }\n    } catch (e) {\n      console.warn('FormManager: Error reading form.elements', e);\n    }\n\n    if (!loading && instance.config.csrf !== false) {\n      // Check for existing CSRF token in the form\n      const existingCsrfInput = element.querySelector('input[name=\"_token\"]');\n      let csrfToken = existingCsrfInput ? existingCsrfInput.value : null;\n\n      // If not found in form, try meta tag\n      if (!csrfToken) {\n        csrfToken = document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content');\n      }\n\n      // If still not found, try cookies\n      if (!csrfToken) {\n        const cookies = document.cookie.split(';');\n        for (const cookie of cookies) {\n          const [name, value] = cookie.trim().split('=');\n          if (name === 'XSRF-TOKEN') {\n            csrfToken = decodeURIComponent(value);\n            break;\n          }\n        }\n      }\n\n      if (csrfToken) {\n        // Only add if not already present in form data\n        if (!jsonData._token) {\n          formData.append('_token', csrfToken);\n          jsonData._token = csrfToken;\n        }\n      } else {\n        // Try to fetch a new CSRF token\n        if (window.simpleFetch) {\n          setTimeout(() => {\n            const csrfEndpoint = window.SecurityManager?.config?.csrf?.tokenUrl ||\n              window.Now?.config?.security?.csrf?.tokenUrl ||\n              'api/auth/csrf-token';\n            simpleFetch.get(csrfEndpoint)\n              .then(response => {\n                if (response.data && response.data.token) {\n                  // Update meta tag\n                  let metaToken = document.querySelector('meta[name=\"csrf-token\"]');\n                  if (!metaToken) {\n                    metaToken = document.createElement('meta');\n                    metaToken.name = 'csrf-token';\n                    document.head.appendChild(metaToken);\n                  }\n                  metaToken.setAttribute('content', response.data.token);\n                }\n              })\n              .catch(error => {\n                console.error('Failed to fetch CSRF token:', error);\n              });\n          }, 0);\n        }\n      }\n    }\n\n    instance.state.data = jsonData;\n    return {formData, jsonData};\n  },\n\n  /**\n   * Get a plain values object for a form.\n   * Identifier can be a formId (string), an HTMLFormElement, or an instance object.\n   * Returns null if the form/instance cannot be found.\n   */\n  getValues(identifier) {\n    let instance = null;\n    if (!identifier) return null;\n\n    if (typeof identifier === 'string') {\n      instance = this.getInstance(identifier);\n      if (!instance) {\n        // try to resolve by DOM id or data-form attr\n        const el = document.getElementById(identifier) || document.querySelector(`form[data-form=\"${identifier}\"]`);\n        if (el) instance = this.getInstanceByElement(el);\n      }\n    } else if (identifier instanceof HTMLFormElement) {\n      instance = this.getInstanceByElement(identifier);\n    } else if (identifier && identifier.element) {\n      instance = identifier;\n    }\n\n    if (!instance) return null;\n\n    // Ensure we have fresh values by rebuilding form data\n    try {\n      const {jsonData} = this.getFormData(instance);\n      return jsonData;\n    } catch (e) {\n      // Fallback to stored state data\n      return instance.state && instance.state.data ? instance.state.data : null;\n    }\n  },\n\n  /**\n   * Set form field values from a data object\n   * @param {Object} instance - Form instance\n   * @param {Object} data - Object with field values {fieldName: value}\n   */\n  setFormData(instance, data) {\n    if (!instance || !data) return;\n\n    const {element, elements} = instance;\n\n    for (const [fieldName, value] of Object.entries(data.data || data)) {\n      // Find the form field(s) by name\n      const field = elements.get(fieldName);\n\n      if (!field) {\n        // Try to find by name in DOM if not in elements map\n        const domField = element.querySelector(`[name=\"${fieldName}\"], [name=\"${fieldName}[]\"]`);\n        if (domField) {\n          this.setFieldValue(domField, value);\n        }\n        continue;\n      }\n\n      // Handle array of fields (radio buttons, checkbox groups)\n      if (Array.isArray(field)) {\n        field.forEach(f => {\n          if (f.type === 'radio') {\n            f.checked = (f.value === value || f.value === String(value));\n          } else if (f.type === 'checkbox') {\n            if (Array.isArray(value)) {\n              f.checked = value.includes(f.value);\n            } else {\n              f.checked = (f.value === value || f.value === String(value));\n            }\n          }\n        });\n      } else {\n        this.setFieldValue(field, value);\n      }\n\n      // Update instance state\n      instance.state.data[fieldName] = value;\n    }\n\n    // Handle fields with data-attr bindings (e.g., data-attr=\"value:provinceID\")\n    // These fields may have different name attributes than the data field names\n    const dataAttrFields = element.querySelectorAll('[data-attr]');\n    dataAttrFields.forEach(field => {\n      const attrValue = field.getAttribute('data-attr');\n      const match = attrValue?.match(/value:([\\w-]+)/);\n      if (match && match[1]) {\n        const dataFieldName = match[1];\n        const value = (data.data || data)[dataFieldName];\n\n        if (value !== undefined && value !== null) {\n          // Check if this is a tags input\n          if (field.getAttribute('data-element') === 'tags' && Array.isArray(value)) {\n            // Get the ElementManager instance\n            const tagsInstance = window.ElementManager?.getInstanceByElement(field);\n\n            if (tagsInstance && typeof tagsInstance.setValue === 'function') {\n              // Get options for mapping IDs to text\n              const optionsKey = field.getAttribute('data-options-key');\n              const options = instance.state.formOptions?.[optionsKey];\n\n              if (options && Array.isArray(options)) {\n                // Map value IDs to their display text from options\n                const tags = value.map(val => {\n                  const option = options.find(opt =>\n                    (typeof opt === 'object' ? opt.value : opt) == val\n                  );\n                  if (option) {\n                    return typeof option === 'object'\n                      ? {key: option.value, value: option.text}\n                      : {key: option, value: option};\n                  }\n                  return {key: val, value: val};\n                });\n\n                tagsInstance.setValue(tags);\n              } else {\n                // No options available, just use the values as-is\n                const tags = value.map(val => ({key: val, value: val}));\n                tagsInstance.setValue(tags);\n              }\n            }\n          } else if (field.type === 'file' && (Array.isArray(value) || typeof value === 'object')) {\n            // Handle file inputs with data-attr bindings\n            this.setFieldValue(field, value);\n          } else if (field.type === 'text' && field.getAttribute('data-options-key')) {\n            // Handle text inputs with autocomplete (similar to tags)\n            const optionsKey = field.getAttribute('data-options-key');\n            const options = instance.state.formOptions?.[optionsKey];\n\n            if (options && Array.isArray(options)) {\n              // Find the option that matches the value (ID)\n              const selectedOption = options.find(opt =>\n                (typeof opt === 'object' ? opt.value : opt) == value\n              );\n\n              if (selectedOption) {\n                // Set the display text in the visible input\n                field.value = typeof selectedOption === 'object'\n                  ? selectedOption.text\n                  : selectedOption;\n\n                // Set the ID in the hidden input (if exists)\n                const hiddenName = field.name.replace('_text', '');\n                const hiddenInput = element.querySelector(`input[type=\"hidden\"][name=\"${hiddenName}\"]`);\n                if (hiddenInput) {\n                  hiddenInput.value = value;\n                }\n\n                // Update ElementManager instance state\n                const textInstance = window.ElementManager?.getInstanceByElement(field);\n                if (textInstance) {\n                  textInstance.selectedValue = value;\n                }\n              } else {\n                // No matching option, set raw value\n                this.setFieldValue(field, value);\n              }\n            } else {\n              // No options available, set raw value\n              this.setFieldValue(field, value);\n            }\n          } else if (!elements.get(field.name)) {\n            // For other fields with data-attr, set value if not already set by name\n            this.setFieldValue(field, value);\n          }\n        }\n      }\n    });\n\n    // Handle file inputs with data-files attribute referencing a field name\n    // e.g., data-files=\"avatar\" should get its value from data.avatar\n    const fileInputsWithDataFiles = element.querySelectorAll('input[type=\"file\"][data-files]');\n    fileInputsWithDataFiles.forEach(field => {\n      const dataFilesAttr = field.getAttribute('data-files');\n      if (!dataFilesAttr) return;\n\n      // Check if it's a field name reference (not JSON)\n      try {\n        JSON.parse(dataFilesAttr);\n\n        return;\n      } catch (e) {\n        // Not JSON - it's a field name reference\n        const fieldData = data.data || data;\n        // Handle double-nested data structure (e.g., data.data.data.avatar)\n        let value = fieldData[dataFilesAttr];\n        if (value === undefined && fieldData.data) {\n          value = fieldData.data[dataFilesAttr];\n        }\n\n        if (value && (Array.isArray(value) || typeof value === 'object')) {\n          this.setFieldValue(field, value);\n        }\n      }\n    });\n\n    // Handle tables with data-attr=\"data:fieldName\" bindings\n    // This allows nested array data to be bound to editable tables\n    const tablesWithDataAttr = element.querySelectorAll('table[data-table][data-attr]');\n    tablesWithDataAttr.forEach(table => {\n      const attrValue = table.getAttribute('data-attr');\n      const match = attrValue?.match(/data:(\\w+)/);\n      if (match && match[1]) {\n        const dataFieldName = match[1];\n        const fieldData = data.data || data;\n        const tableData = fieldData[dataFieldName];\n\n        if (tableData && window.TableManager) {\n          const tableId = table.getAttribute('data-table');\n          // Use setTimeout to ensure TableManager is initialized\n          setTimeout(() => {\n            // Support both nested structure {columns: [], data: []} and simple array\n            if (tableData.columns && tableData.data) {\n              // Nested structure with columns metadata\n              TableManager.setData(tableId, tableData);\n            } else if (Array.isArray(tableData)) {\n              // Simple array (backward compatible)\n              TableManager.setData(tableId, tableData);\n            }\n          }, 0);\n        }\n      }\n    });\n\n    // Use TemplateManager to process data-text, data-attr, data-if, etc. bindings\n    // This provides full expression support, i18n integration, and reactive updates\n    if (window.TemplateManager) {\n      const fieldData = data.data || data;\n      const context = {\n        state: fieldData,\n        data: fieldData,\n        computed: {}\n      };\n      TemplateManager.processDataDirectives(element, context);\n    }\n\n    // Trigger change event to update any dependent elements\n    this.emitEvent('form:data:set', {\n      formId: instance.id,\n      data\n    });\n  },\n\n  /**\n   * Set value for a single field element\n   * @param {HTMLElement} field - Form field element\n   * @param {*} value - Value to set\n   * @param {Boolean} silent - If true, don't dispatch change event\n   */\n  setFieldValue(field, value, silent = false) {\n    if (!field) return;\n\n    switch (field.type) {\n      case 'checkbox':\n        field.checked = Boolean(value);\n        break;\n\n      case 'radio':\n        field.checked = (field.value === value || field.value === String(value));\n        break;\n\n      case 'select-multiple':\n        if (Array.isArray(value)) {\n          // Convert values to strings for comparison (handles number/string mismatch)\n          const valueStrings = value.map(v => String(v));\n\n          Array.from(field.options).forEach(opt => {\n            opt.selected = valueStrings.includes(opt.value);\n          });\n        }\n        break;\n\n      case 'file':\n        // Cannot programmatically set file input value for security reasons\n        // But we can update data-files attribute to show existing files\n        if (value && (Array.isArray(value) || typeof value === 'object')) {\n          const files = Array.isArray(value) ? value : [value];\n          field.setAttribute('data-files', JSON.stringify(files));\n\n          // Reinitialize FileElementFactory to show existing files\n          if (window.ElementManager && window.FileElementFactory) {\n            const instance = ElementManager.getInstanceByElement(field);\n            if (instance) {\n              // Update config with new existing files\n              instance.config.existingFiles = files;\n\n              // Clear and show existing files\n              if (instance.previewContainer) {\n                // Remove old existing files previews\n                const oldPreviews = instance.previewContainer.querySelectorAll('.preview-item[data-existing=\"true\"]');\n                oldPreviews.forEach(preview => preview.remove());\n\n                // Show new existing files\n                FileElementFactory.showExistingFiles(instance, files);\n              }\n            }\n          }\n        }\n        break;\n\n      default:\n        // For select-one, convert value to string to match option values\n        // This handles cases where API sends numbers but options have string values\n        if (field.tagName === 'SELECT' && !field.multiple) {\n          field.value = value !== null && value !== undefined ? String(value) : '';\n        } else {\n          field.value = value ?? '';\n        }\n\n        // Trigger ElementManager update if available\n        if (window.ElementManager) {\n          const instance = ElementManager.getInstanceByElement(field);\n\n          if (instance && typeof instance.setValue === 'function') {\n            instance.setValue(value);\n          }\n        }\n        break;\n    }\n\n    // Dispatch change event (unless silent mode)\n    if (!silent) {\n      field.dispatchEvent(new Event('change', {bubbles: true}));\n    }\n  },\n\n  async submitAjax(instance, data) {\n    const {element, config} = instance;\n    const hasFiles = Array.from(element.elements).some(el => el.type === 'file' && el.files?.length > 0);\n    try {\n      const method = element.getAttribute('data-method') ||\n        element.method ||\n        config.method ||\n        'POST';\n\n      const url = element.getAttribute('data-action') ||\n        element.action ||\n        config.action ||\n        window.location.href;\n\n      let response;\n\n      if (hasFiles) {\n        response = await this.submitWithProgress(instance, url, data.formData);\n      } else {\n        const methodLower = method.toLowerCase();\n\n        const buildHeaders = () => {\n          if (instance.config.csrf === false) {\n            return {'X-Skip-CSRF': 'true'};\n          }\n          return undefined;\n        };\n\n        // Use HttpClient (window.http) as primary client with CSRF protection\n        const requestOptions = {\n          throwOnError: false\n        };\n\n        const headers = buildHeaders();\n        if (headers) {\n          requestOptions.headers = headers;\n        }\n\n        response = await window.http[methodLower](url, data.jsonData, requestOptions);\n      }\n\n      // Check for success using response.success (unified standard)\n      // Both HttpClient and XHR now return response.success\n      if (response.success) {\n        const apiResponse = response.data || {};\n\n        return {\n          success: true,  // Normalized success flag\n          message: Now.translate(apiResponse.message || config.successMessage),\n          data: apiResponse.data || apiResponse,  // Extract data field from API response\n          status: response.status,\n          code: apiResponse.code\n        };\n      } else {\n        return {\n          success: false,\n          message: Now.translate(response.data?.message || response.statusText || config.errorMessage),\n          errors: response.data?.errors || {},\n          status: response.status,\n          data: response.data\n        };\n      }\n\n    } catch (error) {\n      return {\n        success: false,\n        message: Now.translate(error.message || config.errorMessage),\n        error: error\n      };\n    }\n  },\n\n  submitWithProgress(instance, url, formData) {\n    return new Promise((resolve, reject) => {\n      const {element, config} = instance;\n\n      const xhr = new XMLHttpRequest();\n\n      const progressContainer = this.createProgressElement(element);\n      progressContainer.style.display = 'block';\n\n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          this.updateProgress(progressContainer, e.loaded, e.total);\n        }\n      });\n\n      xhr.addEventListener('load', () => {\n        progressContainer.style.display = 'none';\n\n        if (xhr.status >= 200 && xhr.status < 300) {\n          try {\n            // XHR gets full API response: { success: true, message: \"...\", code: 201, data: {...} }\n            const apiResponse = JSON.parse(xhr.responseText);\n\n            resolve({\n              success: apiResponse.success !== false,  // Use API's success flag\n              message: apiResponse.message,\n              data: apiResponse.data || apiResponse,  // Extract data field from API response\n              status: xhr.status,\n              code: apiResponse.code\n            });\n          } catch (e) {\n            resolve({\n              success: true,\n              message: Now.translate(config.successMessage),\n              rawResponse: xhr.responseText,\n              status: xhr.status\n            });\n          }\n        } else {\n          let result = {\n            ok: false,\n            success: false,\n            message: Now.translate(config.errorMessage),\n            statusCode: xhr.status,\n            statusText: xhr.statusText\n          };\n\n          try {\n            const errorData = JSON.parse(xhr.responseText);\n            result = {\n              ...result,\n              ...errorData\n            };\n          } catch (e) {\n          }\n\n          resolve(result);\n        }\n      });\n\n      xhr.addEventListener('error', () => {\n        progressContainer.style.display = 'none';\n        resolve({\n          success: false,\n          message: 'Network error occurred',\n          statusCode: 0,\n          statusText: 'Network Error'\n        });\n      });\n\n      xhr.addEventListener('abort', () => {\n        progressContainer.style.display = 'none';\n        resolve({\n          success: false,\n          message: 'Request was aborted',\n          statusCode: 0,\n          statusText: 'Aborted'\n        });\n      });\n\n      xhr.open('POST', url);\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n\n      const csrfToken = document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content');\n      if (csrfToken) {\n        xhr.setRequestHeader('X-CSRF-Token', csrfToken);\n      }\n\n      xhr.send(formData);\n    });\n  },\n\n  createProgressElement(form) {\n    let progress = form.querySelector('.upload-progress');\n\n    if (!progress) {\n      const template = document.createElement('div');\n      template.innerHTML = this.config.uploadProgressTemplate.trim();\n      progress = template.firstChild;\n      form.appendChild(progress);\n    }\n\n    return progress;\n  },\n\n  updateProgress(container, loaded, total) {\n    const percent = Math.round((loaded / total) * 100);\n\n    const bar = container.querySelector('.progress-bar');\n    if (bar) {\n      bar.style.width = percent + '%';\n      bar.setAttribute('aria-valuenow', percent);\n    }\n\n    const text = container.querySelector('.progress-text');\n    if (text) {\n      const loadedSize = this.formatFileSize(loaded);\n      const totalSize = this.formatFileSize(total);\n      text.textContent = `${percent}% (${loadedSize} / ${totalSize})`;\n    }\n\n    this.emitEvent('form:upload-progress', {\n      loaded,\n      total,\n      percent\n    });\n  },\n\n  formatFileSize(bytes) {\n    const units = ['B', 'KB', 'MB', 'GB'];\n    let size = bytes;\n    let unit = 0;\n\n    while (size >= 1024 && unit < units.length - 1) {\n      size /= 1024;\n      unit++;\n    }\n\n    return `${Math.round(size * 10) / 10} ${units[unit]}`;\n  },\n\n  autoFillIntendedUrl(form) {\n    const urlParams = new URLSearchParams(window.location.search);\n    // prefer explicit `redirect` or `return_to` in query\n    const redirectParam = urlParams.get('redirect') || urlParams.get('return_to') || null;\n\n    // prefer sessionStorage key set by RedirectManager (auth_intended_route)\n    let sessionIntended = null;\n    const normalizePath = (pathname) => {\n      const routerBase = window.RouterManager?.config?.base || '';\n      let normalized = pathname || '/';\n      if (routerBase && normalized.startsWith(routerBase)) {\n        normalized = normalized.slice(routerBase.length) || '/';\n        if (!normalized.startsWith('/')) normalized = '/' + normalized;\n      }\n      return normalized;\n    };\n\n    try {\n      const stored = sessionStorage.getItem('auth_intended_route');\n\n      if (stored) {\n        const parsed = JSON.parse(stored);\n\n        if (parsed && parsed.path) {\n          const normalizedPath = normalizePath(parsed.path);\n          sessionIntended = normalizedPath + (parsed.query || '') + (parsed.hash || '');\n        }\n      }\n    } catch (e) {\n      sessionIntended = null;\n    }\n\n    let intendedUrl = null;\n\n    if (redirectParam && this.isValidRedirectUrl(redirectParam)) {\n      intendedUrl = redirectParam;\n    } else if (sessionIntended) {\n      const isValid = this.isValidRedirectUrl(sessionIntended);\n\n      if (isValid) {\n        intendedUrl = sessionIntended;\n      }\n    }\n\n    // Find or create hidden input for intended_url\n    let intendedInput = form.querySelector('input[name=\"intended_url\"]');\n\n    if (!intendedInput) {\n      try {\n        intendedInput = document.createElement('input');\n        intendedInput.type = 'hidden';\n        intendedInput.name = 'intended_url';\n        form.appendChild(intendedInput);\n      } catch (e) {\n        return;\n      }\n    }\n\n    // Set the value (empty string if no intended URL)\n    if (intendedUrl) {\n      intendedInput.value = intendedUrl;\n      form.dataset.redirectAfterLogin = intendedUrl;\n    } else {\n      intendedInput.value = '';\n    }\n  },\n\n  /**\n   * Restore remembered username/email into the login form if present in localStorage.\n   * This only restores the username/email and never stores passwords.\n   */\n  restoreRememberedCredentials(instance) {\n    try {\n      if (!instance || !instance.element) return;\n      const form = instance.element;\n\n      // Only restore for login forms\n      const formType = form.dataset && form.dataset.form ? form.dataset.form : null;\n      if (formType !== 'login') return;\n\n      const stored = localStorage.getItem('remember_username');\n      if (!stored) return;\n\n      const usernameInput = form.querySelector('input[name=\"username\"]') || form.querySelector('input[type=\"email\"]') || form.querySelector('input[type=\"text\"]');\n      const rememberCheckbox = form.querySelector('input[name=\"remember\"], input#remember');\n\n      if (usernameInput) {\n        usernameInput.value = stored;\n        try {instance.state.data[usernameInput.name || 'username'] = stored;} catch (e) {}\n      }\n\n      if (rememberCheckbox) {\n        rememberCheckbox.checked = true;\n      }\n    } catch (e) {}\n  },\n\n  /**\n   * Restore persisted values for fields with data-persist attribute.\n   * Supports localStorage (default) and cookie via data-persist=\"cookie\".\n   */\n  restorePersistedValues(instance) {\n    try {\n      if (!instance || !instance.element) return;\n      const form = instance.element;\n\n      const items = form.querySelectorAll('[data-persist]');\n      if (!items || items.length === 0) return;\n\n      items.forEach(el => {\n        try {\n          const persistAttr = el.dataset.persist;\n          if (!persistAttr || persistAttr === 'false') return;\n\n          const storage = (persistAttr === 'cookie') ? 'cookie' : 'local';\n          const key = el.dataset.persistKey || (`nowjs_persist:${form.dataset.form || window.location.pathname}:${el.name || el.id}`);\n\n          // skip passwords unless explicitly allowed\n          if ((el.type === 'password' || el.dataset.element === 'password') && el.dataset.persistAllowPassword !== 'true') return;\n\n          let value = null;\n          if (storage === 'cookie') {\n            value = this._getCookie(key);\n          } else {\n            const raw = localStorage.getItem(key);\n            if (raw) {\n              try {\n                const parsed = JSON.parse(raw);\n                if (!parsed || !parsed.value) return;\n                if (parsed.expires && Date.now() > parsed.expires) {\n                  localStorage.removeItem(key);\n                  return;\n                }\n                value = parsed.value;\n              } catch (e) {\n                value = raw;\n              }\n            }\n          }\n\n          if (value === null || value === undefined) return;\n          // Apply the value depending on field type\n          if (el.type === 'checkbox') {\n            el.checked = value === '1' || value === true || value === 'true';\n          } else if (el.type === 'radio') {\n            const radios = form.querySelectorAll(`input[name=\"${el.name}\"]`);\n            radios.forEach(r => {r.checked = (r.value === value);});\n          } else if (el.tagName.toLowerCase() === 'select') {\n            try {el.value = value;} catch (e) {}\n          } else {\n            el.value = value;\n          }\n\n          try {instance.state.data[el.name || el.id] = (el.type === 'checkbox' ? el.checked : el.value);} catch (e) {}\n        } catch (e) {}\n      });\n    } catch (e) {}\n  },\n\n  /**\n   * Save persisted values for fields with data-persist attribute. Called on successful submit.\n   */\n  savePersistedValues(instance) {\n    try {\n      if (!instance || !instance.element) return;\n      const form = instance.element;\n      const items = form.querySelectorAll('[data-persist]');\n      if (!items || items.length === 0) return;\n\n      items.forEach(el => {\n        try {\n          const persistAttr = el.dataset.persist;\n          if (!persistAttr || persistAttr === 'false') return;\n          const persistOn = el.dataset.persistOn || 'submit';\n          if (persistOn !== 'submit') return; // currently only support submit-triggered saves\n\n          const storage = (persistAttr === 'cookie') ? 'cookie' : 'local';\n          const key = el.dataset.persistKey || (`nowjs_persist:${form.dataset.form || window.location.pathname}:${el.name || el.id}`);\n          const ttlDays = parseInt(el.dataset.persistTtlDays || el.dataset.persistTtl || '0');\n\n          // skip passwords unless explicitly allowed\n          if ((el.type === 'password' || el.dataset.element === 'password') && el.dataset.persistAllowPassword !== 'true') return;\n\n          let value = null;\n          if (el.type === 'checkbox') {\n            value = el.checked ? '1' : '0';\n          } else if (el.type === 'radio') {\n            if (el.checked) value = el.value;\n            else return; // don't save if not the checked radio\n          } else if (el.tagName.toLowerCase() === 'select') {\n            value = el.value;\n          } else {\n            value = el.value;\n          }\n\n          if (storage === 'cookie') {\n            const days = isNaN(ttlDays) ? 0 : ttlDays;\n            this._setCookie(key, value, days);\n          } else {\n            const obj = {value: value};\n            if (!isNaN(ttlDays) && ttlDays > 0) {\n              obj.expires = Date.now() + ttlDays * 24 * 60 * 60 * 1000;\n            }\n            try {localStorage.setItem(key, JSON.stringify(obj));} catch (e) {localStorage.setItem(key, value);}\n          }\n        } catch (e) {}\n      });\n    } catch (e) {}\n  },\n\n  // cookie helpers\n  _setCookie(name, value, days) {\n    try {\n      if (!name || typeof name !== 'string') return;\n\n      let expires = '';\n      if (days && days > 0) {\n        const date = new Date();\n        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n        expires = '; expires=' + date.toUTCString();\n      }\n      document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value == null ? '' : value) + expires + '; path=/';\n    } catch (e) {}\n  },\n\n  _getCookie(name) {\n    try {\n      const cookies = document.cookie ? document.cookie.split(';') : [];\n      for (const c of cookies) {\n        const [k, ...rest] = c.trim().split('=');\n        if (decodeURIComponent(k) === name) return decodeURIComponent(rest.join('='));\n      }\n      return null;\n    } catch (e) {return null;}\n  },\n\n  performRedirect(url) {\n    // Try using RouterManager first if available and properly initialized\n    if (window.RouterManager?.state?.initialized && typeof window.RouterManager.navigate === 'function') {\n      try {\n        RouterManager.navigate(url);\n        return;\n      } catch (error) {\n        console.warn('RouterManager.navigate failed, falling back to window.location.href:', error);\n      }\n    }\n\n    // Fallback to direct browser navigation\n    window.location.href = url;\n  },\n\n  async handleSuccessfulSubmit(instance, response) {\n    const {element, config} = instance;\n\n    FormError.clearAll();\n\n    if (config.resetAfterSubmit) {\n      this.resetForm(instance);\n    }\n\n    const data = response.data.data || response.data;\n\n    // Handle login form authentication OR register form with auto-login\n    if (data && data.user && data.token &&\n      (element.dataset.form === 'login' || element.dataset.form === 'register')) {\n      const authManager = Now.getManager('auth');\n\n      if (authManager && typeof authManager.setAuthenticatedUser === 'function') {\n        // Use proper AuthManager method instead of direct state manipulation\n        // Pass the standardized API response structure to setAuthenticatedUser\n        try {\n          const setUserResult = await authManager.setAuthenticatedUser(data, {\n            preventRedirect: true // FormManager will handle redirect\n          });\n\n          if (!(setUserResult && setUserResult.success)) {\n            console.warn('Failed to set authenticated user:', setUserResult?.message || 'Unknown error');\n          }\n        } catch (error) {\n          console.error('Error setting authenticated user:', error);\n        }\n      } else {\n        console.warn('AuthManager not available or setAuthenticatedUser method not found');\n      }\n      // Persist \"remember me\" username locally if requested on login forms\n      try {\n        const formEl = element;\n        const formType = formEl.dataset && formEl.dataset.form ? formEl.dataset.form : null;\n        if (formType === 'login') {\n          const rememberCheckbox = formEl.querySelector('input[name=\"remember\"], input#remember');\n          const usernameInput = formEl.querySelector('input[name=\"username\"]') || formEl.querySelector('input[type=\"email\"]') || formEl.querySelector('input[type=\"text\"]');\n\n          if (rememberCheckbox && rememberCheckbox.checked && usernameInput && usernameInput.value) {\n            try {localStorage.setItem('remember_username', usernameInput.value);} catch (e) {}\n          } else {\n            try {localStorage.removeItem('remember_username');} catch (e) {}\n          }\n        }\n      } catch (e) {}\n    }\n\n    // For login forms, override redirect URL with intended URL if available\n    if (element.dataset.form === 'login' && data && data.actions) {\n      let intendedUrl = element.querySelector('input[name=\"intended_url\"]')?.value\n        || element.dataset.redirectAfterLogin\n        || sessionStorage.getItem('intended_url');\n\n      // Also check auth_intended_route from sessionStorage\n      if (!intendedUrl) {\n        try {\n          const stored = sessionStorage.getItem('auth_intended_route');\n          if (stored) {\n            const route = JSON.parse(stored);\n            if (route && route.path) {\n              intendedUrl = route.path + (route.query || '') + (route.hash || '');\n            }\n          }\n        } catch (e) {\n          // ignore JSON parse errors\n        }\n      }\n\n      if (intendedUrl && this.isValidRedirectUrl(intendedUrl)) {\n        // Find and override redirect action\n        const redirectAction = data.actions.find(a => a.type === 'redirect');\n        if (redirectAction) {\n          redirectAction.url = intendedUrl;\n          sessionStorage.removeItem('intended_url');\n          sessionStorage.removeItem('auth_intended_route');\n        }\n      }\n    }\n\n    // Process API response actions using ResponseHandler\n    try {\n      await ResponseHandler.process(data, {\n        formId: instance.id,\n        form: element,\n        instance: instance\n      });\n    } catch (error) {\n      console.error('FormManager: Error processing response actions', error);\n    }\n\n    // Show success message (if not handled by ResponseHandler actions)\n    if (response.message && !(data && data.actions)) {\n      if (config.showSuccessInline !== false) {\n        FormError.showSuccess(response.message, element);\n      }\n      if (config.showSuccessInNotification !== false && window.NotificationManager) {\n        NotificationManager.success(response.message);\n      }\n    }\n\n    // Handle redirect (if not handled by ResponseHandler actions)\n    if (!(data && data.actions && data.actions.some(a => a.type === 'redirect'))) {\n      const redirectUrl = this.determineRedirectUrl(element, response, config);\n\n      if (redirectUrl) {\n        // Emit redirect start event\n        this.emitEvent('redirect:start', {\n          formId: instance.id,\n          url: redirectUrl,\n          delay: 1000\n        });\n\n        setTimeout(() => {\n          this.performRedirect(redirectUrl);\n        }, 1000);\n      }\n    }\n\n    this.emitEvent('form:submitted', {\n      formId: instance.id,\n      response: response\n    });\n  },\n\n  determineRedirectUrl(element, response, config) {\n    // Check for intended URL first (for login forms or when explicitly requested)\n    const isLoginForm = element.dataset.form === 'login';\n    const shouldUseIntendedUrl = isLoginForm || element.dataset.useIntendedUrl === 'true';\n\n    if (shouldUseIntendedUrl) {\n      // Check hidden input, dataset, or sessionStorage\n      let intendedUrl = element.querySelector('input[name=\"intended_url\"]')?.value\n        || element.dataset.redirectAfterLogin\n        || sessionStorage.getItem('intended_url');\n\n      // Also check auth_intended_route from sessionStorage\n      if (!intendedUrl) {\n        try {\n          const stored = sessionStorage.getItem('auth_intended_route');\n          if (stored) {\n            const route = JSON.parse(stored);\n            if (route && route.path) {\n              intendedUrl = route.path + (route.query || '') + (route.hash || '');\n            }\n          }\n        } catch (e) {\n          // ignore JSON parse errors\n        }\n      }\n\n      if (intendedUrl && this.isValidRedirectUrl(intendedUrl)) {\n        sessionStorage.removeItem('intended_url');\n        sessionStorage.removeItem('auth_intended_route');\n        return intendedUrl;\n      }\n    }\n\n    // Check response for redirect URL\n    if (response.data?.redirectUrl || response.data?.redirect?.url) {\n      const url = response.data.redirectUrl || response.data.redirect.url;\n      return url;\n    }\n\n    // Check for role-based redirect\n    if (response.data?.user?.role) {\n      const role = response.data.user.role;\n      const roleRedirect = element.dataset[`redirect${role.charAt(0).toUpperCase() + role.slice(1)}`];\n      if (roleRedirect) {\n        return roleRedirect;\n      }\n    }\n\n    // Check for success-specific redirect first\n    if (element.dataset.successRedirect) {\n      return element.dataset.successRedirect;\n    }\n\n    // Fall back to general redirect\n    if (element.dataset.redirect) {\n      return element.dataset.redirect;\n    }\n\n    // Use config redirect (from extracted form config)\n    if (config.successRedirect) {\n      return config.successRedirect;\n    }\n\n    // Default redirect\n    if (config.redirect) {\n      return config.redirect;\n    }\n\n    return null;\n  },\n\n  isValidRedirectUrl(url) {\n    if (!url || typeof url !== 'string') return false;\n\n    try {\n\n      if (url.startsWith('/') && !url.startsWith('//')) {\n        return true;\n      }\n\n      const urlObj = new URL(url);\n      return urlObj.origin === window.location.origin;\n    } catch {\n      return false;\n    }\n  },\n\n  async handleFailedSubmit(instance, response) {\n    const {element, config} = instance;\n\n    // Process API response actions using ResponseHandler\n    try {\n      await ResponseHandler.process(response, {\n        formId: instance.id,\n        form: element,\n        instance: instance\n      });\n    } catch (error) {\n      console.error('FormManager: Error processing response actions', error);\n    }\n\n    // Show error message (if not handled by ResponseHandler actions)\n    if (response.message && !response.actions) {\n      if (config.showErrorsInline !== false) {\n        FormError.showGeneralError(response.message, element);\n      }\n\n      if (config.showErrorsInNotification !== false && window.NotificationManager) {\n        NotificationManager.error(response.message);\n      }\n    }\n\n    // Show field errors (if not handled by ResponseHandler actions)\n    if (response.errors && !response.actions) {\n      const errorMessages = [];\n\n      Object.entries(response.errors).forEach(([field, messages]) => {\n        const message = Array.isArray(messages) ? messages[0] : messages;\n\n        // Always highlight the field\n        FormError.showFieldError(field, message, element);\n        instance.state.errors[field] = message;\n\n        // Collect error messages for notification\n        errorMessages.push(message);\n      });\n\n      // Show all field errors in notification (combined)\n      if (config.showErrorsInNotification !== false && window.NotificationManager && errorMessages.length > 0) {\n        const combinedMessage = errorMessages.length === 1\n          ? errorMessages[0]\n          : errorMessages.map(m => `• ${m}`).join('\\n');\n        NotificationManager.error(combinedMessage);\n      }\n    }\n\n    this.emitEvent('form:error', {\n      formId: instance.id,\n      response: response,\n      errors: response.errors\n    });\n  },\n\n  handleInvalidSubmit(instance) {\n    if (window.NotificationManager) {\n      // Show the first field's error message for better user experience\n      const firstError = Object.values(instance.state.errors)[0];\n      const message = firstError || Now.translate('Please correct the errors in the form before submitting');\n      NotificationManager.error(message);\n    }\n\n    this.emitEvent('form:validation:failed', {\n      formId: instance.id,\n      errors: instance.state.errors\n    });\n  },\n\n  handleSubmitError(instance, error) {\n    if (window.NotificationManager) {\n      NotificationManager.error(error.message || 'An unexpected error occurred');\n    }\n\n    ErrorManager.handle(error, {\n      context: 'FormManager.submitForm',\n      type: 'error:form',\n      data: {\n        formId: instance.id\n      }\n    });\n\n    this.emitEvent('form:error', {\n      formId: instance.id,\n      error: error\n    });\n  },\n\n  resetForm(instance) {\n    const {element, elements} = instance;\n\n    element.reset();\n\n    FormError.clearAll();\n\n    instance.state.errors = {};\n    instance.state.valid = true;\n\n    instance.state.data = {...instance.state.originalData};\n\n    elements.forEach((field, name) => {\n      if (Array.isArray(field)) {\n        field.forEach(el => {\n          el.classList.remove(instance.config.dirtyClass);\n          el.classList.remove(instance.config.validClass);\n          el.classList.remove(instance.config.invalidClass);\n        });\n      } else {\n        field.classList.remove(instance.config.dirtyClass);\n        field.classList.remove(instance.config.validClass);\n        field.classList.remove(instance.config.invalidClass);\n      }\n    });\n\n    this.emitEvent('form:reset', {\n      formId: instance.id\n    });\n  },\n\n  /**\n   * Handle cascade when a field with data-cascade-source changes\n   * @param {Object} instance - Form instance\n   * @param {HTMLElement} sourceField - The field that triggered the cascade\n   */\n  async handleCascade(instance, sourceField) {\n    const {element} = instance;\n    const cascadeApi = element.dataset.cascadeApi;\n\n    if (!cascadeApi) {\n      console.warn('FormManager: data-cascade-api not found on form');\n      return;\n    }\n\n    // Prevent cascade loop - check if we're already processing a cascade\n    if (instance.state.cascading) return;\n\n    try {\n      // Mark as cascading to prevent loops\n      instance.state.cascading = true;\n\n      // Show loading state on source field\n      sourceField.classList.add('loading');\n\n      // Collect all fields with data-cascade-source\n      const cascadeFields = Array.from(element.querySelectorAll('[data-cascade-source]'));\n\n      // Build FormData with all cascade field values\n      const formData = new FormData();\n      cascadeFields.forEach(field => {\n        const fieldName = field.name || field.id;\n        const fieldValue = this.getFieldValue(field);\n        if (fieldValue !== null && fieldValue !== undefined && fieldValue !== '') {\n          formData.append(fieldName, fieldValue);\n        }\n      });\n\n      // Add source parameter (which field triggered the change)\n      const sourceName = sourceField.dataset.cascadeSource;\n      formData.append('source', sourceName);\n\n      // Call cascade API using framework's HTTP client (includes CSRF token)\n      let response;\n      if (window.ApiService && typeof window.ApiService.post === 'function') {\n        response = await window.ApiService.post(cascadeApi, formData);\n      } else if (window.simpleFetch && typeof window.simpleFetch.post === 'function') {\n        response = await window.simpleFetch.post(cascadeApi, formData);\n      } else {\n        throw new Error('FormManager: No HTTP client available (ApiService or simpleFetch required)');\n      }\n\n      // Process response\n      if (response && response.data) {\n        this.processCascadeResponse(instance, response.data, sourceField);\n      }\n\n    } catch (error) {\n      console.error('FormManager: Error handling cascade:', error);\n    } finally {\n      sourceField.classList.remove('loading');\n      // Release cascade lock\n      instance.state.cascading = false;\n    }\n  },\n\n  /**\n   * Process cascade API response\n   * Format: {data: {...}, options: {...}}\n   * @param {Object} instance - Form instance\n   * @param {Object} responseData - Response data from cascade API\n   * @param {HTMLElement} sourceField - The field that triggered the cascade (optional)\n   */\n  processCascadeResponse(instance, responseData, sourceField = null) {\n    const {element} = instance;\n\n    // Handle nested structure from API wrapper (e.g., {data: {data: {...}, options: {...}}})\n    let actualData = responseData;\n    if (responseData.data && responseData.data.data && responseData.data.options) {\n      actualData = responseData.data;\n    }\n\n    // Process data fields (auto-fill)\n    if (actualData.data) {\n      Object.keys(actualData.data).forEach(fieldName => {\n        const fieldValue = actualData.data[fieldName];\n\n        // Find field by name or data-attr\n        let field = element.querySelector(`[name=\"${fieldName}\"]`);\n\n        if (!field) {\n          field = element.querySelector(`[data-attr*=\"${fieldName}\"]`);\n        }\n\n        if (field) {\n          // Use silent mode to prevent triggering cascade loop\n          this.setFieldValue(field, fieldValue, true);\n        } else {\n          console.warn(`FormManager: Field \"${fieldName}\" not found in form`);\n        }\n      });\n    }\n\n    // Process options (populate selects)\n    if (actualData.options) {\n      Object.keys(actualData.options).forEach(optionsKey => {\n        const optionsArray = actualData.options[optionsKey];\n\n        // Find all fields with matching data-options-key\n        const targetFields = element.querySelectorAll(`[data-options-key=\"${optionsKey}\"]`);\n\n        targetFields.forEach(field => {\n          if (field.tagName === 'SELECT') {\n            // Use appropriate factory based on select type\n            if (field.multiple) {\n              // For multiple selects, use MultiSelectElementFactory only\n              MultiSelectElementFactory.updateOptions(field, optionsArray);\n            } else {\n              // For single selects, use SelectElementFactory only\n              SelectElementFactory.updateOptions(field, optionsArray);\n            }\n          } else if (field.tagName === 'INPUT' && field.dataset.autocomplete) {\n            // For autocomplete inputs, update via TextElementFactory if available\n            const elementInstance = window.ElementManager?.getInstance(field);\n            if (elementInstance && typeof elementInstance.updateOptions === 'function') {\n              elementInstance.updateOptions(optionsArray);\n            } else {\n              // Store options in dataset for later use\n              try {\n                field.dataset.cachedOptions = JSON.stringify(optionsArray);\n              } catch (e) {\n                console.warn('FormManager: Failed to cache options for autocomplete', e);\n              }\n            }\n          }\n        });\n      });\n    }\n  },\n\n  /**\n   * Fallback method to update select options manually\n   * @param {HTMLSelectElement} select - Select element\n   * @param {Array} options - Array of options\n   */\n  updateSelectOptions(select, options) {\n    // Store current value\n    const currentValue = select.value;\n    const hasPlaceholder = select.querySelector('option[value=\"\"]');\n\n    // Clear options except placeholder\n    if (hasPlaceholder) {\n      const placeholderHTML = hasPlaceholder.outerHTML;\n      select.innerHTML = placeholderHTML;\n    } else {\n      select.innerHTML = '';\n    }\n\n    // Add new options\n    if (Array.isArray(options)) {\n      options.forEach(opt => {\n        const option = document.createElement('option');\n\n        if (typeof opt === 'object') {\n          option.value = opt.value || opt.id || '';\n          option.textContent = opt.text || opt.label || opt.name || option.value;\n        } else {\n          option.value = opt;\n          option.textContent = opt;\n        }\n\n        select.appendChild(option);\n      });\n    }\n\n    // Restore value if still exists\n    if (currentValue) {\n      select.value = currentValue;\n    }\n  },\n\n  // Cleanly destroy a form instance: remove from maps and perform any cleanup\n  destroyForm(instance) {\n    try {\n      if (!instance) return;\n\n      // Cleanup all form elements first\n      if (instance.elements && window.ElementManager) {\n        instance.elements.forEach((field, fieldName) => {\n          if (Array.isArray(field)) {\n            // Radio/checkbox groups\n            field.forEach(f => {\n              if (f.id) {\n                try {\n                  window.ElementManager.destroy(f.id);\n                } catch (err) {\n                  // Element might not be enhanced, ignore\n                }\n              }\n            });\n          } else {\n            // Single field\n            if (field.id) {\n              try {\n                window.ElementManager.destroy(field.id);\n              } catch (err) {\n                // Element might not be enhanced, ignore\n              }\n            }\n          }\n        });\n      }\n\n      // remove from elementIndex (WeakMap) and forms map\n      try {this.state.elementIndex.delete(instance.element);} catch (e) {}\n      try {this.state.forms.delete(instance.id);} catch (e) {}\n\n      this.emitEvent('form:destroy', {formId: instance.id});\n    } catch (e) {\n      console.warn('FormManager.destroyForm error', e);\n    }\n  },\n\n  // Determine whether an element should be enhanced by FormManager\n  shouldEnhance(element) {\n    if (!element) return false;\n    // Opt-in only: must have data-form or data-element\n    if (element.dataset && (element.dataset.form || element.dataset.element)) return true;\n    return false;\n  },\n\n  // Destroy forms in a specific container\n  destroyContainer(container) {\n    if (!container) return;\n\n    const forms = container.querySelectorAll('form');\n    forms.forEach(form => {\n      const instance = this.state.elementIndex.get(form);\n      if (instance) {\n        this.destroyForm(instance);\n      }\n    });\n  },\n\n  // Scan a container for forms (opt-in via data-form) and init them\n  scan(container = document) {\n    if (!container || !container.querySelectorAll) return [];\n    const found = Array.from(container.querySelectorAll('form[data-form]'));\n    found.forEach(f => {\n      if (!this.state.elementIndex.has(f)) this.initForm(f);\n    });\n    return found;\n  },\n\n  // Destroy form by element reference (convenience wrapper)\n  destroyFormByElement(el) {\n    if (!el) return;\n    const inst = this.state.elementIndex.get(el);\n    if (inst) return this.destroyForm(inst);\n    const id = el.dataset && el.dataset.form;\n    if (id && this.state.forms.has(id)) this.destroyForm(this.state.forms.get(id));\n  },\n\n  // Start/stop observer control (wrappers around setup/stop functions)\n  startObserver(root) {\n    if (root) this.observerConfig.observeRoot = root;\n    this.setupFormObserver();\n  },\n\n  stopObserver() {\n    this._stopFormObserver && this._stopFormObserver();\n  },\n\n  // Setup a scoped, batched MutationObserver to auto-init/destroy forms when necessary.\n  // This observer is selective: it only processes added/removed nodes that match\n  // form[data-form] or contain such descendants. It batches processing to reduce CPU.\n  setupFormObserver() {\n    // If already created, do nothing\n    if (this._formObserver) return;\n\n    this._addedQueue = new Set();\n    this._removedQueue = new Set();\n    this._processTimeout = null;\n\n    const processQueues = () => {\n      // process removals first to avoid double-init on re-render\n      if (this._removedQueue.size) {\n        const removed = Array.from(this._removedQueue);\n        this._removedQueue.clear();\n        removed.forEach(node => {\n          try {\n            // direct lookup via WeakMap\n            const inst = this.state.elementIndex.get(node);\n            if (inst) {\n              // if the instance element is no longer connected, destroy\n              if (!inst.element.isConnected) this.destroyForm(inst);\n            } else if (node.dataset && node.dataset.form) {\n              const maybe = this.state.forms.get(node.dataset.form);\n              if (maybe && !maybe.element.isConnected) this.destroyForm(maybe);\n            }\n          } catch (e) {\n            console.warn('FormManager.process removed error', e);\n          }\n        });\n      }\n\n      if (this._addedQueue.size) {\n        const added = Array.from(this._addedQueue);\n        this._addedQueue.clear();\n        added.forEach(node => {\n          try {\n            if (!node || node.nodeType !== 1) return;\n            // Skip if node is not connected to DOM yet\n            if (!node.isConnected) return;\n\n            // if node itself is a form\n            if (node.matches && node.matches('form[data-form]')) {\n              // avoid double init\n              if (!this.state.elementIndex.has(node)) this.initForm(node);\n            } else if (node.querySelector) {\n              const found = node.querySelectorAll('form[data-form]');\n              found.forEach(f => {\n                // Skip if form is not connected\n                if (f.isConnected && !this.state.elementIndex.has(f)) this.initForm(f);\n              });\n            }\n          } catch (e) {\n            console.warn('FormManager.process added error', e);\n          }\n        });\n      }\n\n      // auto-stop observer if nothing to manage\n      if (this.state.forms.size === 0) {\n        this._stopFormObserver();\n      }\n    };\n\n    const observer = new MutationObserver((mutations) => {\n      for (const m of mutations) {\n        if (m.removedNodes && m.removedNodes.length) {\n          for (const n of m.removedNodes) {\n            if (!n || n.nodeType !== 1) continue;\n            if (n.matches && n.matches('form[data-form]')) this._removedQueue.add(n);\n            else if (n.querySelector) {\n              const hit = n.querySelector('form[data-form]');\n              if (hit) this._removedQueue.add(hit);\n            }\n          }\n        }\n\n        if (m.addedNodes && m.addedNodes.length) {\n          for (const n of m.addedNodes) {\n            if (!n || n.nodeType !== 1) continue;\n            if (n.matches && n.matches('form[data-form]')) this._addedQueue.add(n);\n            else if (n.querySelector) {\n              const hit = n.querySelector('form[data-form]');\n              if (hit) this._addedQueue.add(hit);\n            }\n          }\n        }\n      }\n\n      if (this._processTimeout) return;\n      const delay = this.observerConfig?.observerDelay || 40;\n      this._processTimeout = setTimeout(() => {\n        this._processTimeout = null;\n        processQueues();\n      }, delay);\n    });\n\n    // choose root - prefer a managed mount point if available, else fallback to body\n    const root = this.observerConfig?.observeRoot || document.body;\n    observer.observe(root, {childList: true, subtree: true});\n\n    this._formObserver = observer;\n  },\n\n  _stopFormObserver() {\n    try {\n      if (!this._formObserver) return;\n      this._formObserver.disconnect();\n      this._formObserver = null;\n      this._addedQueue && this._addedQueue.clear();\n      this._removedQueue && this._removedQueue.clear();\n      if (this._processTimeout) {\n        clearTimeout(this._processTimeout);\n        this._processTimeout = null;\n      }\n    } catch (e) {\n      console.warn('FormManager._stopFormObserver error', e);\n    }\n  },\n\n  getInstance(id) {\n    return this.state.forms.get(id);\n  },\n\n  getInstanceByElement(form) {\n    for (const [id, instance] of this.state.forms.entries()) {\n      if (instance.element === form) {\n        return instance;\n      }\n    }\n\n    if (form.dataset && form.dataset.form) {\n      return this.state.forms.get(form.dataset.form);\n    }\n\n    return null;\n  },\n\n  emitEvent(eventName, data) {\n    EventManager.emit(eventName, data);\n  },\n\n  destroy(formId) {\n    const instance = this.state.forms.get(formId);\n    if (!instance) return;\n\n    instance.element.removeEventListener('submit', instance.handlers?.submit);\n    instance.element.removeEventListener('reset', instance.handlers?.reset);\n    instance.element.removeEventListener('change', instance.handlers?.change);\n    instance.element.removeEventListener('input', instance.handlers?.input);\n    instance.element.removeEventListener('blur', instance.handlers?.blur, true);\n\n    clearTimeout(instance.resetTimeout);\n\n    this.state.forms.delete(formId);\n\n    this.emitEvent('form:destroy', {formId});\n  },\n\n  reset() {\n    this.state.forms.forEach((instance, id) => {\n      this.resetForm(instance);\n    });\n  },\n\n  cleanup() {\n    for (const [id] of this.state.forms) {\n      this.destroy(id);\n    }\n\n    this.state.forms.clear();\n    this.state.validators.clear();\n    this.state.initialized = false;\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('form', FormManager);\n}\n\nwindow.FormManager = FormManager;\n","class ElementFactory {\n  static config = {\n    validationMessages: {\n      min: 'Value must be at least {min}',\n      max: 'Value must be no more than {max}',\n      step: 'Value must be a multiple of {step}',\n      decimal: 'Only one decimal separator is allowed',\n      negative: 'Negative values are not allowed',\n      match: 'Fields do not match',\n      fileSize: 'File size exceeds the maximum allowed',\n      fileType: 'File type is not supported',\n      date: 'Please enter a valid date',\n      time: 'Please enter a valid time',\n      datetime: 'Please enter a valid date and time',\n      phone: 'Please enter a valid phone number',\n      postcode: 'Please enter a valid postal code',\n      generic: 'Invalid value'\n    }\n  };\n\n  static coreProperties = [\n    'id', 'name', 'disabled', 'readOnly', 'checked',\n    'className', 'classList', 'style', 'minLength', 'maxLength',\n    'title', 'type', 'inputMode', 'pattern', 'defaultValue'\n  ];\n\n  static extendedProperties = [\n    'validation', 'formatter'\n  ];\n\n  static _privateState = new WeakMap();\n\n  static propertyHandlers = {\n    value: {\n      get(element) {\n        return element.value;\n      },\n      set(instance, newValue) {\n        instance.element.value = newValue;\n      }\n    },\n    required: {\n      get(element) {\n        return element.hasAttribute('required');\n      },\n      set(instance, newValue) {\n        const {element} = instance;\n        if (newValue) {\n          element.setAttribute('required', '');\n          element.setAttribute('aria-required', 'true');\n        } else {\n          element.removeAttribute('required');\n          element.setAttribute('aria-required', 'false');\n        }\n      }\n    },\n    placeholder: {\n      get(element) {\n        return 'placeholder' in element ? element.placeholder : element.getAttribute('placeholder') || '';\n      },\n      set(instance, newValue) {\n        const {element} = instance;\n        if (typeof newValue === 'string' && newValue.trim()) {\n          element.dataset.i18n = newValue;\n          if ('placeholder' in element) {\n            element.placeholder = Now.translate(newValue);\n          } else {\n            element.setAttribute('placeholder', Now.translate(newValue));\n          }\n        } else {\n          delete element.dataset.i18n;\n          if ('placeholder' in element) {\n            element.placeholder = '';\n          } else {\n            element.removeAttribute('placeholder');\n          }\n        }\n      }\n    }\n  };\n\n  static extractConfig(element, config = {}, def) {\n    const dataset = element.dataset;\n    const result = {};\n\n    const parseBool = (key) => {\n      return def[key] !== undefined ? def[key] :\n        dataset[key] !== undefined ? dataset[key] === 'true' :\n          key in element ? element[key] : undefined;\n    };\n\n    const parseString = (key) => {\n      return def[key] !== undefined ? def[key] :\n        dataset[key] !== undefined ? dataset[key] :\n          key in element ? element[key] : undefined;\n    };\n\n    result.required = parseBool('required');\n    result.disabled = parseBool('disabled');\n    result.readOnly = parseBool('readOnly');\n    result.placeholder = parseString('placeholder');\n    result.value = parseString('value');\n    result.pattern = parseString('pattern');\n\n    result.minLength = this.parseNumeric('minLength', element, def, dataset);\n    result.maxLength = this.parseNumeric('maxLength', element, def, dataset);\n\n    if (typeof this.extractCustomConfig === 'function') {\n      Object.assign(result, this.extractCustomConfig(element, def, dataset));\n    }\n\n    Object.entries(config).forEach(([key, value]) => {\n      if (!(key in result)) {\n        result[key] = value;\n      }\n    });\n\n    Object.entries(def).forEach(([key, value]) => {\n      if (!(key in result)) {\n        result[key] = value;\n      }\n    });\n\n    Object.entries(dataset).forEach(([key, value]) => {\n      if (!(key in result)) {\n        result[key] = value;\n      }\n    });\n\n    return result;\n  }\n\n  static create(def) {\n    if (['button', 'submit', 'reset'].includes(def.elementType)) {\n      def.tagName = 'button';\n      def.type = def.elementType;\n    }\n    def.tagName = def.tagName || 'input';\n    const element = document.createElement(def.tagName);\n    if (def.tagName === 'input') {\n      element.type = def.type || 'text';\n    }\n    def.id = def.id && typeof def.id === 'string' ? def.id : `${def.elementType || def.tagName}-${Utils.generateUUID()}`;\n    element.id = def.id;\n\n    // Set value before creating wrapper and instance\n    if (def.value !== undefined && def.value !== null) {\n      element.value = def.value;\n      element.setAttribute('value', def.value);\n    }\n\n    this.createWrapper(element, def);\n\n    const config = Utils.object.deepClone(Object.assign({}, this.config, def));\n\n    return this.createInstance(element, config);\n  }\n\n  static enhance(element, def = {}) {\n    if (!element || !(element instanceof HTMLElement)) {\n      throw new Error('Invalid element: Must be an HTMLElement');\n    }\n\n    element.id = element.id || `${def.type || element.type}-${Utils.generateUUID()}`;\n\n    const config = Utils.object.deepClone(this.extractConfig(element, this.config, def));\n\n    this.parseExistingWrapper(element);\n\n    const instance = this.createInstance(element, config);\n\n    // Skip value initialization for select[multiple] - handled by MultiSelectElementFactory\n    const isMultipleSelect = element.tagName === 'SELECT' && element.multiple;\n\n    if (element.value && !isMultipleSelect) {\n      instance.state.formatting = true;\n      element.value = instance.initValue(element.value);\n      instance.state.formatting = false;\n    }\n\n    return instance;\n  }\n\n  static createInstance(element, config = {}) {\n    if (!this._privateState.has(element)) {\n      this._privateState.set(element, {\n        validating: false,\n        valid: true,\n        modified: false,\n        error: null,\n        originalValue: config.defaultValue || ('value' in element ? element.value : element.getAttribute('value')) || '',\n        originalConfig: Utils.object.deepClone(config),\n        formatting: false,\n        recursionGuard: {}\n      });\n    }\n\n    if (config.required) element.setAttribute('required', '');\n    if (config.placeholder && !!config.placeholder.trim()) {\n      element.placeholder = Now.translate(config.placeholder);\n    }\n\n    const instance = {\n      element,\n      config: Utils.object.deepClone(config),\n      wrapper: element.wrapper,\n      label: element.label,\n      container: element.container,\n      comment: element.comment,\n\n      isValid() {\n        const state = ElementFactory._privateState.get(this.element);\n        return state ? state.valid : true;\n      },\n\n      isModified() {\n        const state = ElementFactory._privateState.get(this.element);\n        return state ? state.modified : false;\n      },\n\n      getError() {\n        const state = ElementFactory._privateState.get(this.element);\n        return state ? state.error : null;\n      },\n\n      focus() {\n        this.element.focus();\n        return this;\n      },\n\n      blur() {\n        this.element.blur();\n        return this;\n      },\n\n      reset() {\n        const state = ElementFactory._privateState.get(this.element);\n        if (state) {\n          state.formatting = true;\n\n          Object.assign(this.config, state.originalConfig);\n          this.element.value = this.initValue(state.originalValue);\n\n          state.valid = true;\n          state.modified = false;\n          state.error = null;\n          state.validating = false;\n          state.formatting = false;\n\n          if (typeof FormError !== 'undefined') {\n            FormError.clearFieldError(this.element.id);\n          }\n        }\n        return this;\n      },\n\n      cleanup() {\n        if (typeof EventSystemManager !== 'undefined') {\n          EventSystemManager.removeElementHandlers(this.element);\n        }\n        if (typeof FormError !== 'undefined') {\n          FormError.clearFieldError(this.element.id);\n        }\n        return this;\n      },\n\n      initValue(value) {\n        const {validatedValue} = instance.validateValue(value, true);\n        return validatedValue;\n      },\n\n      validate(value, valueChange) {\n        const state = ElementFactory._privateState.get(this.element);\n        if (!state) return value;\n\n        if (state.validating || typeof value === 'undefined') {\n          value = 'value' in this.element ? this.element.value : this.element.getAttribute('value') || '';\n        }\n\n        state.validating = true;\n        state.modified = true;\n\n        try {\n          const {validatedValue, error} = this.validateValue(value, valueChange);\n\n          if (error) {\n            state.valid = false;\n            state.error = error;\n            FormError.showFieldError(this.element.id, error);\n          } else {\n            state.valid = true;\n            state.error = null;\n            FormError.clearFieldError(this.element.id);\n          }\n\n          return validatedValue;\n        } catch (err) {\n          console.error('Validation error:', err);\n          state.valid = false;\n          return value;\n        } finally {\n          state.validating = false;\n        }\n      },\n\n      validateValue(value, valueChange) {\n        const element = this.element;\n        let error = null;\n        const checkValue = typeof value === 'number' ? String(value) : String(value).trim();\n\n        if (element.hasAttribute('required') && checkValue === '') {\n          error = Now.translate('Please fill in');\n          return {validatedValue: value, error};\n        }\n\n        if (typeof this.customValidateValue === 'function') {\n          const result = this.customValidateValue.call(this, value, valueChange);\n          if (result.error) {\n            return result;\n          }\n          value = typeof result.validatedValue === 'number' ? String(result.validatedValue) : result.validatedValue;\n        }\n\n        if (checkValue.length > 0) {\n          if (valueChange && typeof this.config.formatter === 'function') {\n            const result = this.config.formatter(value);\n            if (result && typeof result === 'object' && 'formatted' in result) {\n              if (result.error) {\n                return {validatedValue: result.formatted, error: result.error};\n              } else {\n                value = result.formatted;\n              }\n            } else {\n              value = result;\n            }\n          }\n\n          // Ensure value is not null after formatting\n          if (value === null || value === undefined) {\n            value = '';\n          }\n\n          const minLength = element.minLength;\n          if (minLength > -1 && value.length < minLength) {\n            error = Now.translate('Must be at least {minLength} characters', {minLength});\n            return {validatedValue: value, error};\n          }\n\n          const maxLength = element.maxLength;\n          if (maxLength > 0 && value.length > maxLength) {\n            error = Now.translate('Must be no more than {maxLength} characters', {maxLength});\n            return {validatedValue: value, error};\n          }\n\n          const pattern = element.getAttribute('pattern');\n          if (pattern && !new RegExp(pattern).test(value)) {\n            error = Now.translate('Please match the requested format');\n            return {validatedValue: value, error};\n          }\n\n          if (typeof this.validateSpecific === 'function') {\n            error = this.validateSpecific.call(this, value);\n            if (error) {\n              return {validatedValue: value, error};\n            }\n          }\n\n          if (typeof this.customValidate === 'function') {\n            error = this.customValidate(value);\n            if (error) {\n              return {validatedValue: value, error};\n            }\n          }\n        }\n\n        return {validatedValue: value, error: null};\n      }\n    };\n\n    Object.defineProperty(instance, 'state', {\n      get() {\n        const element = this.element;\n        return {\n          get validating() {\n            const state = ElementFactory._privateState.get(element);\n            return state ? state.validating : false;\n          },\n          set validating(value) {\n            const state = ElementFactory._privateState.get(element);\n            if (state) state.validating = value;\n          },\n\n          get valid() {\n            const state = ElementFactory._privateState.get(element);\n            return state ? state.valid : true;\n          },\n          set valid(value) {\n            const state = ElementFactory._privateState.get(element);\n            if (state) state.valid = value;\n          },\n\n          get modified() {\n            const state = ElementFactory._privateState.get(element);\n            return state ? state.modified : false;\n          },\n          set modified(value) {\n            const state = ElementFactory._privateState.get(element);\n            if (state) state.modified = value;\n          },\n\n          get error() {\n            const state = ElementFactory._privateState.get(element);\n            return state ? state.error : null;\n          },\n          set error(value) {\n            const state = ElementFactory._privateState.get(element);\n            if (state) state.error = value;\n          },\n\n          get formatting() {\n            const state = ElementFactory._privateState.get(element);\n            return state ? state.formatting : false;\n          },\n          set formatting(value) {\n            const state = ElementFactory._privateState.get(element);\n            if (state) state.formatting = value;\n          }\n        };\n      }\n    });\n\n    let rules = [];\n    if (element.dataset.validate) {\n      rules = this.parseValidationRules(element.dataset.validate);\n    } else if (config.validation) {\n      rules = Array.isArray(config.validation) ? config.validation : [config.validation];\n    }\n\n    instance.validationRules = rules;\n\n    if (!instance.validateSpecific) {\n      instance.validateSpecific = function(value) {\n        const validators = {\n          ...(window.validators || {}),\n          ...(this.validators || {})\n        };\n        for (const rule of this.validationRules || []) {\n          const ruleName = typeof rule === 'string' ? rule : rule.name;\n          if (['minLength', 'maxLength', 'pattern', 'required'].includes(ruleName)) {\n            continue;\n          }\n          if (validators[ruleName]) {\n            if (!validators[ruleName](value)) {\n              return Now.translate(config.validationMessages?.[ruleName] || 'Invalid value');\n            }\n          }\n        }\n        return null;\n      };\n    }\n\n    if (typeof this.setupElement === 'function') {\n      this.setupElement(instance);\n    }\n    this.setupProperties(instance);\n\n    Object.keys(config).forEach(prop => {\n      if (!['classList'].includes(prop) && config[prop] !== undefined && !Utils.object.isObject(config[prop])) {\n        if (this.extendedProperties.includes(prop)) {\n          instance[prop] = config[prop];\n        }\n        if (prop in instance || this.coreProperties.includes(prop)) {\n          if (prop in element && element[prop] !== config[prop] && config[prop] !== null && config[prop] !== undefined) {\n            try {\n              if (prop === 'defaultValue' && instance.validate) {\n                element[prop] = instance.initValue(config[prop]);\n              } else if (!['type'].includes(prop)) {\n                element[prop] = config[prop];\n              }\n            } catch (e) {\n              console.warn(`Could not set property ${prop} on element`, element, e);\n            }\n          }\n        }\n      }\n    });\n    Object.keys(config).forEach(prop => {\n      if (!(prop in instance) && !(prop in element)) {\n        Object.defineProperty(instance, prop, {\n          get() {\n            return config[prop];\n          },\n          set(newValue) {\n            config[prop] = newValue;\n          }\n        });\n      }\n    });\n\n    // If this is a <button> element, apply `text` or `value` to its visible label\n    try {\n      const tag = element.tagName && element.tagName.toLowerCase();\n      if (tag === 'button') {\n        if (typeof config.text !== 'undefined') {\n          element.textContent = Now.translate(config.text);\n        } else if (typeof config.value !== 'undefined') {\n          element.textContent = Now.translate(config.value);\n        }\n      }\n    } catch (e) {\n      // non-fatal\n    }\n\n    this.setupEventListeners(instance);\n\n    instance.constructor = this;\n\n    return instance;\n  }\n\n  static setupProperties(instance) {\n    const {element} = instance;\n\n    const getDescriptorOrFallback = (element) => {\n      let descriptor;\n\n      if (element instanceof HTMLInputElement) {\n        descriptor = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');\n      } else if (element instanceof HTMLTextAreaElement) {\n        descriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n      } else if (element instanceof HTMLSelectElement) {\n        descriptor = Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype, 'value');\n      }\n\n      return descriptor || {\n        get: function() {\n          if (this instanceof HTMLSelectElement) {\n            const selectedOption = this.options[this.selectedIndex];\n            return selectedOption ? selectedOption.value : '';\n          }\n          return this.getAttribute('value') || '';\n        },\n        set: function(val) {\n          if (this instanceof HTMLSelectElement) {\n            for (let i = 0; i < this.options.length; i++) {\n              if (this.options[i].value === val) {\n                this.selectedIndex = i;\n                return;\n              }\n            }\n          }\n          this.setAttribute('value', val);\n        }\n      };\n    };\n\n    const originalDescriptor = getDescriptorOrFallback(element);\n\n    Object.defineProperty(element, 'value', {\n      get() {\n        return originalDescriptor.get.call(element);\n      },\n      set(newValue) {\n        const state = ElementFactory._privateState.get(element);\n        if (state && !state.formatting) {\n          state.formatting = true;\n          const result = instance.validate(newValue, true);\n          originalDescriptor.set.call(element, result);\n          state.formatting = false;\n        } else {\n          originalDescriptor.set.call(element, newValue);\n        }\n      },\n      enumerable: true,\n      configurable: true\n    });\n\n    const mergedHandlers = {...ElementFactory.propertyHandlers};\n\n    if (this.propertyHandlers) {\n      Object.assign(mergedHandlers, this.propertyHandlers);\n    }\n\n    Object.entries(mergedHandlers).forEach(([prop, handlers]) => {\n      Object.defineProperty(instance, prop, {\n        get() {\n          return handlers.get.call(instance.constructor, element);\n        },\n        set(newValue) {\n          const state = ElementFactory._privateState.get(element);\n          if (!state || !state.modified || instance[prop] !== newValue) {\n            handlers.set.call(instance.constructor, instance, newValue);\n          }\n        },\n        enumerable: true\n      });\n    });\n\n    this.coreProperties.forEach(prop => {\n      if (!(prop in mergedHandlers)) {\n        Object.defineProperty(instance, prop, {\n          get() {\n            return prop in element ? element[prop] : element.getAttribute(prop) || undefined;\n          },\n          set(value) {\n            if (prop in element) {\n              element[prop] = value;\n            } else {\n              element.setAttribute(prop, value);\n            }\n          },\n          enumerable: true\n        });\n      }\n    });\n\n    Object.defineProperty(instance, 'setAttribute', {\n      value: function(name, value) {\n        const state = ElementFactory._privateState.get(this.element);\n        if (!state || !state.recursionGuard?.[name]) {\n          state.recursionGuard = state.recursionGuard || {};\n          state.recursionGuard[name] = true;\n          try {\n            if (name in mergedHandlers) {\n              this[name] = value;\n            } else {\n              this.element.setAttribute(name, value);\n            }\n          } finally {\n            state.recursionGuard[name] = false;\n          }\n        }\n      },\n      writable: true,\n      configurable: true\n    });\n\n    Object.defineProperty(instance, 'getAttribute', {\n      value: function(name) {\n        if (name in mergedHandlers) {\n          return this[name];\n        }\n        return this.element.getAttribute(name);\n      },\n      writable: true,\n      configurable: true\n    });\n\n    Object.defineProperty(instance, 'ariaLabel', {\n      get() {\n        return this.element.getAttribute('aria-label');\n      },\n      set(newValue) {\n        this.element.setAttribute('aria-label', Now.translate(newValue));\n      }\n    });\n  }\n\n  static setupEventListeners(instance) {\n    const {element} = instance;\n    const debouncedValidate = Utils.function.debounce(() => instance.validate(undefined, false), 300);\n\n    EventSystemManager.addHandler(element, 'input', () => {\n      instance.state.modified = true;\n      debouncedValidate();\n    });\n\n    EventSystemManager.addHandler(element, 'change', () => {\n      const validatedValue = instance.validate(element.value, true);\n      if ('value' in element && validatedValue !== element.value) {\n        element.value = validatedValue;\n      }\n    });\n\n    EventSystemManager.addHandler(element, 'blur', () => {\n      const validatedValue = instance.validate(element.value, true);\n      if ('value' in element && validatedValue !== element.value) {\n        element.value = validatedValue;\n      }\n    });\n  }\n\n  static parseValidationRules(rules) {\n    if (!rules) return {rules: []};\n    const ruleList = Array.isArray(rules) ? rules : rules.split(',').map(r => r.trim());\n    return {\n      rules: ruleList.map(rule => {\n        if (typeof rule === 'string' && rule.includes(':')) {\n          const [name, param] = rule.split(':');\n          return {name, param};\n        }\n        return {name: rule};\n      }),\n      validating: false\n    };\n  }\n\n  static parseExistingWrapper(element) {\n    let current = element;\n    let level = 0;\n    const maxLevel = 2;\n\n    while (current && level < maxLevel) {\n      const parent = current.parentElement;\n      if (!parent) break;\n\n      if (parent.tagName === 'LABEL') {\n        element.wrapper = parent;\n        element.label = parent;\n        element.container = parent;\n        break;\n      }\n\n      if (parent.classList.contains('form-control')) {\n        element.container = parent;\n        const grandParent = parent.parentElement;\n        if (grandParent) {\n          const label = grandParent.querySelector(`label[for=\"${element.id}\"]`);\n          if (label) {\n            element.wrapper = grandParent;\n            element.label = label;\n          }\n        }\n        break;\n      }\n\n      current = parent;\n      level++;\n    }\n\n    element.comment = document.getElementById(`result_${element.id}`);\n  }\n\n  static createWrapper(element, def) {\n    if (!def.wrapper) return;\n\n    const wrapper = document.createElement(def.wrapper);\n    if (def.wrapper === 'label') {\n      wrapper.className = 'form-control';\n      if (def.icon) wrapper.classList.add(def.icon);\n      if (def.label) {\n        wrapper.textContent = Now.translate(def.label);\n        wrapper.dataset.i18n = def.label;\n      }\n      if (element.id) wrapper.htmlFor = element.id;\n      wrapper.appendChild(element);\n      element.label = wrapper;\n      element.container = wrapper;\n    } else {\n      const label = document.createElement('label');\n      if (def.label) {\n        label.textContent = Now.translate(def.label);\n        label.dataset.i18n = def.label;\n      }\n      if (element.id) label.htmlFor = element.id;\n      wrapper.appendChild(label);\n      const container = document.createElement('span');\n      container.className = 'form-control';\n      if (def.icon) container.classList.add(def.icon);\n      container.appendChild(element);\n      wrapper.appendChild(container);\n      element.label = label;\n      element.container = container;\n    }\n\n    if (def.comment && element.id) {\n      const commentId = `result_${element.id}`;\n      element.setAttribute('aria-describedby', commentId);\n      const comment = document.createElement('div');\n      comment.className = 'comment';\n      comment.id = commentId;\n      comment.textContent = def.comment;\n      if (def.wrapper === 'label') {\n        if (wrapper.parentNode) {\n          wrapper.parentNode.insertBefore(comment, wrapper.nextSibling);\n        } else {\n          const originalAppend = wrapper.appendChild;\n          wrapper.appendChild = function(child) {\n            let counter = 100;\n            const timer = window.setInterval(function() {\n              if (counter <= 0) {\n                window.clearInterval(timer);\n              }\n              if (wrapper.parentNode) {\n                wrapper.parentNode.insertBefore(comment, wrapper.nextSibling);\n                wrapper.appendChild = originalAppend;\n                window.clearInterval(timer);\n              }\n              counter--;\n            }, 500);\n          };\n        }\n      }\n      wrapper.appendChild(comment);\n      element.comment = comment;\n    }\n\n    if (def.wrapperClass) wrapper.classList.add(def.wrapperClass);\n    element.wrapper = wrapper;\n  }\n\n  static parseNumeric(key, element, def, dataset) {\n    if (key in element) {\n      let value;\n      if (def && def[key] !== undefined) {\n        value = parseFloat(def[key]);\n      } else if (dataset[key] !== undefined) {\n        value = parseFloat(dataset[key]);\n      } else if (element[key]) {\n        value = element[key];\n      }\n      return isNaN(value) ? undefined : value;\n    }\n    return undefined;\n  }\n}\n\nwindow.ElementFactory = ElementFactory;\n","/**\n * DropdownPanel - Singleton panel for displaying dropdowns\n *\n * This panel is attached directly to document.body to avoid z-index\n * and overflow issues with modals and other containers.\n * Only one instance exists and can be shared between multiple components\n * like Calendar and ColorPicker.\n */\n\nclass DropdownPanel {\n  static instance = null;\n  static currentOwner = null;\n\n  constructor() {\n    if (DropdownPanel.instance) {\n      return DropdownPanel.instance;\n    }\n\n    this.panel = null;\n    this.contentContainer = null;\n    this.isVisible = false;\n    this.currentTarget = null;\n    this.closeCallback = null;\n\n    this._createPanel();\n    this._setupEventListeners();\n\n    DropdownPanel.instance = this;\n  }\n\n  _createPanel() {\n    // Create panel element\n    this.panel = document.createElement('div');\n    this.panel.className = 'dropdown-panel';\n\n    // Create content container\n    this.contentContainer = document.createElement('div');\n    this.contentContainer.className = 'dropdown-panel-content';\n    this.panel.appendChild(this.contentContainer);\n\n    // Append to body\n    document.body.appendChild(this.panel);\n  }\n\n  _setupEventListeners() {\n    // Close on outside click\n    document.addEventListener('click', (e) => {\n      if (!this.isVisible) return;\n\n      // Check if click is outside panel and outside target element\n      if (!this.panel.contains(e.target) &&\n        (!this.currentTarget || !this.currentTarget.contains(e.target))) {\n        this.hide();\n      }\n    });\n\n    // Close on Escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && this.isVisible) {\n        this.hide();\n      }\n    });\n\n    // Reposition on scroll\n    window.addEventListener('scroll', () => {\n      if (this.isVisible && this.currentTarget) {\n        this._updatePosition();\n      }\n    }, true);\n\n    // Reposition on resize\n    window.addEventListener('resize', () => {\n      if (this.isVisible && this.currentTarget) {\n        this._updatePosition();\n      }\n    });\n  }\n\n  /**\n   * Show the dropdown panel with content\n   * @param {HTMLElement} targetElement - The element to position relative to\n   * @param {HTMLElement|string} content - The content to display (element or HTML string)\n   * @param {Object} options - Configuration options\n   * @param {Function} options.onClose - Callback when panel closes\n   * @param {string} options.align - Alignment (left|right|center) default: left\n   * @param {number} options.offsetY - Vertical offset from target, default: 5\n   * @param {number} options.offsetX - Horizontal offset, default: 0\n   */\n  show(targetElement, content, options = {}) {\n    if (!targetElement) {\n      console.error('DropdownPanel: targetElement is required');\n      return;\n    }\n\n    // Close previous if any\n    if (this.isVisible) {\n      this.hide();\n    }\n\n    this.currentTarget = targetElement;\n    this.closeCallback = options.onClose || null;\n    this.options = {\n      align: options.align || 'left',\n      offsetY: options.offsetY !== undefined ? options.offsetY : 5,\n      offsetX: options.offsetX || 0\n    };\n\n    // Set content\n    this.contentContainer.innerHTML = '';\n    if (typeof content === 'string') {\n      this.contentContainer.innerHTML = content;\n    } else if (content instanceof HTMLElement) {\n      this.contentContainer.appendChild(content);\n    } else {\n      console.error('DropdownPanel: Invalid content type');\n      return;\n    }\n\n    // Show panel\n    this.panel.style.display = 'block';\n    this.isVisible = true;\n\n    // Position panel\n    this._updatePosition();\n\n    // Dispatch event\n    this.panel.dispatchEvent(new CustomEvent('dropdown:show', {\n      detail: {target: targetElement}\n    }));\n  }\n\n  /**\n   * Update panel position relative to target element\n   */\n  _updatePosition() {\n    if (!this.currentTarget) return;\n\n    const targetRect = this.currentTarget.getBoundingClientRect();\n    const panelRect = this.panel.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    let left = 0;\n    let top = targetRect.bottom + this.options.offsetY;\n\n    // Calculate horizontal position based on alignment\n    switch (this.options.align) {\n      case 'right':\n        left = targetRect.right - panelRect.width + this.options.offsetX;\n        break;\n      case 'center':\n        left = targetRect.left + (targetRect.width - panelRect.width) / 2 + this.options.offsetX;\n        break;\n      case 'left':\n      default:\n        left = targetRect.left + this.options.offsetX;\n        break;\n    }\n\n    // Adjust if panel goes off-screen horizontally\n    if (left + panelRect.width > viewportWidth) {\n      left = viewportWidth - panelRect.width - 10;\n    }\n    if (left < 10) {\n      left = 10;\n    }\n\n    // Adjust if panel goes off-screen vertically\n    if (top + panelRect.height > viewportHeight) {\n      // Show above target instead\n      top = targetRect.top - panelRect.height - this.options.offsetY;\n\n      // If still doesn't fit, show at top of viewport\n      if (top < 10) {\n        top = 10;\n        // Limit height to fit viewport\n        this.panel.style.maxHeight = (viewportHeight - 20) + 'px';\n      }\n    }\n\n    // Apply position\n    this.panel.style.left = left + 'px';\n    this.panel.style.top = top + 'px';\n  }\n\n  /**\n   * Hide the dropdown panel\n   */\n  hide() {\n    if (!this.isVisible) return;\n\n    this.panel.style.display = 'none';\n    this.isVisible = false;\n\n    // Clear content\n    this.contentContainer.innerHTML = '';\n\n    // Call close callback\n    if (this.closeCallback) {\n      this.closeCallback();\n      this.closeCallback = null;\n    }\n\n    const oldTarget = this.currentTarget;\n    this.currentTarget = null;\n\n    // Dispatch event\n    this.panel.dispatchEvent(new CustomEvent('dropdown:hide', {\n      detail: {target: oldTarget}\n    }));\n  }\n\n  /**\n   * Check if panel is currently visible\n   */\n  isOpen() {\n    return this.isVisible;\n  }\n\n  /**\n   * Get the singleton instance\n   */\n  static getInstance() {\n    if (!DropdownPanel.instance) {\n      new DropdownPanel();\n    }\n    return DropdownPanel.instance;\n  }\n\n  /**\n   * Set content of the panel (when already visible)\n   */\n  setContent(content) {\n    this.contentContainer.innerHTML = '';\n    if (typeof content === 'string') {\n      this.contentContainer.innerHTML = content;\n    } else if (content instanceof HTMLElement) {\n      this.contentContainer.appendChild(content);\n    }\n\n    // Update position after content change\n    if (this.isVisible) {\n      this._updatePosition();\n    }\n  }\n\n  /**\n   * Get the content container element\n   */\n  getContentContainer() {\n    return this.contentContainer;\n  }\n\n  /**\n   * Destroy the singleton instance (for cleanup)\n   */\n  static destroy() {\n    if (DropdownPanel.instance) {\n      if (DropdownPanel.instance.panel) {\n        DropdownPanel.instance.panel.remove();\n      }\n      DropdownPanel.instance = null;\n    }\n  }\n}\n\n// Auto-initialize when DOM is ready\nif (typeof window !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      DropdownPanel.getInstance();\n    });\n  } else {\n    DropdownPanel.getInstance();\n  }\n}\n\n// Expose globally\nwindow.DropdownPanel = DropdownPanel;","/**\n * TextElementFactory - class to manage text inputs with autocomplete and hidden input support\n */\nclass TextElementFactory extends ElementFactory {\n  static config = {\n    type: 'text',\n    autocomplete: {\n      enabled: false,\n      source: null,\n      minLength: 2,\n      maxResults: 10,\n      delay: 300,\n      level: null,\n      dependent: null,\n      callback: null\n    },\n    validationMessages: {\n      email: 'Please enter a valid email address',\n      url: 'Please enter a valid URL',\n      number: 'Please enter a valid number',\n      integer: 'Please enter a whole number',\n      alpha: 'Only letters are allowed',\n      alphanumeric: 'Only letters and numbers are allowed',\n      usernameOrEmail: 'Please enter a valid username or email'\n    },\n    formatter: null\n  };\n\n  static validators = {\n    email: value => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value),\n    url: value => /^(https?|ftp):\\/\\/[^\\s\\/$.?#].[^\\s]*$|^www\\.[^\\s\\/$.?#].[^\\s]*$|^[^\\s\\/$.?#].[^\\s]*\\.[a-z]{2,}(\\/[^\\s]*)?$/.test(value),\n    number: value => /^-?\\d*\\.?\\d+$/.test(value),\n    integer: value => /^-?\\d+$/.test(value),\n    alpha: value => /^[a-zA-Z]+$/.test(value),\n    alphanumeric: value => /^[a-zA-Z0-9]+$/.test(value),\n    usernameOrEmail: value => {\n      const usernamePattern = /^[a-zA-Z0-9_]+$/;\n      const emailPattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      return usernamePattern.test(value) || emailPattern.test(value);\n    }\n  };\n\n  static extractCustomConfig(element, def, dataset) {\n    return {\n      autocomplete: {\n        enabled: dataset.autocomplete !== undefined ? dataset.autocomplete === 'true' : def.autocomplete?.enabled,\n        source: dataset.source || def.autocomplete?.source,\n        minLength: this.parseNumeric('minLength', element, def.autocomplete, dataset) || def.autocomplete?.minLength,\n        maxResults: this.parseNumeric('maxResults', element, def.autocomplete, dataset) || def.autocomplete?.maxResults,\n        delay: this.parseNumeric('delay', element, def.autocomplete, dataset) || def.autocomplete?.delay,\n        level: dataset.hierarchy || dataset.level || def.autocomplete?.level,\n        dependent: dataset.dependent || def.autocomplete?.dependent,\n        callback: dataset.callback ? window[dataset.callback] : def.autocomplete?.callback\n      },\n      formatter: dataset.formatter ? window[dataset.formatter] : def.formatter,\n      // Hierarchical search configuration\n      searchApi: dataset.searchApi || null,\n      searchField: dataset.searchField || null\n    };\n  }\n\n  static setupElement(instance) {\n    const {config, element} = instance;\n    const acConfig = config.autocomplete;\n\n    // Check for pending options (stored before element was enhanced)\n    if (element.dataset.pendingOptions) {\n      try {\n        const pendingOptions = JSON.parse(element.dataset.pendingOptions);\n        acConfig.source = pendingOptions;\n        delete element.dataset.pendingOptions;\n      } catch (e) {\n        console.error('Failed to parse pending options:', e);\n      }\n    }\n\n    // Read information from <Datalist> (if any)\n    const dataFromDatalist = this.readFromDatalist(element);\n    if (dataFromDatalist) {\n      acConfig.source = dataFromDatalist;\n    }\n\n    // Auto-enable autocomplete if source is available\n    if (acConfig.source) acConfig.enabled = true;\n\n    // Auto-enable autocomplete for hierarchical inputs\n    if (element.hasAttribute('data-hierarchy')) acConfig.enabled = true;\n\n    // Auto-enable autocomplete for inputs with options-key (options loaded later)\n    if (element.hasAttribute('data-options-key')) acConfig.enabled = true;\n\n    // Save the original name and create a hidden input only when necessary\n    const originalName = element.getAttribute('name') || '';\n    const shouldCreateHidden = !!originalName && (acConfig.enabled || !!acConfig.source || !!dataFromDatalist || element.hasAttribute('data-hierarchy') || element.hasAttribute('data-options-key'));\n    if (shouldCreateHidden) {\n      instance.hiddenInput = document.createElement('input');\n      instance.hiddenInput.type = 'hidden';\n      instance.hiddenInput.setAttribute('name', originalName);\n      element.parentNode.insertBefore(instance.hiddenInput, element.nextSibling);\n      element.setAttribute('name', `${originalName}_text`);\n      // If this input is inside a form that is managed by FormManager, register\n      // the hidden input so FormManager will include it in form data collection.\n      try {\n        const formEl = element.form || element.closest && element.closest('form');\n        if (formEl && window.FormManager && typeof FormManager.getInstanceByElement === 'function') {\n          const formInstance = FormManager.getInstanceByElement(formEl);\n          if (formInstance) {\n            // Use the original name as the key so getFormData will append the hidden value\n            try {\n              formInstance.elements.set(originalName, instance.hiddenInput);\n              formInstance.state.data[originalName] = instance.hiddenInput.value || '';\n            } catch (e) {\n              // best-effort: ignore if we cannot set\n            }\n          }\n        }\n      } catch (e) {}\n    }\n\n    // Initialize from existing value (if any)\n    const initialValue = element.value;\n    if (initialValue && acConfig.source) {\n      this.setInitialValue(instance, initialValue);\n    }\n\n    // Default stubs for autocomplete methods (will be overwritten by setupAutocomplete)\n    instance.hide = () => {};\n    instance.highlightItem = () => {};\n    instance.populate = () => {};\n    instance.selectItem = () => {};\n    instance.escapeRegExp = (str) => str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\n    // Initialize autocomplete if configured\n    if (acConfig.enabled) {\n      this.setupAutocomplete(instance);\n    }\n\n    // Validation\n    instance.validateSpecific = function(value) {\n      const validators = {\n        ...TextElementFactory.validators,\n        ...(window.validators || {}),\n        ...(this.validators || {})\n      };\n      for (const rule of this.validationRules || []) {\n        const ruleName = typeof rule === 'string' ? rule : rule.name;\n        if (['minLength', 'maxLength', 'pattern', 'required'].includes(ruleName)) {\n          console.warn(`\"${ruleName}\" should be set as a DOM property`);\n          continue;\n        }\n        if (validators[ruleName] && !validators[ruleName](value)) {\n          return config.validationMessages?.[ruleName] || 'Invalid value';\n        }\n      }\n      return null;\n    };\n\n    // Formatter\n    if (config.formatter) {\n      EventSystemManager.addHandler(element, 'change', () => {\n        element.value = config.formatter(element.value);\n      });\n    }\n\n    // Register with HierarchicalTextFactory when applicable\n    if (element.hasAttribute('data-hierarchy')) {\n      HierarchicalTextFactory.register(instance);\n    }\n\n    this.setupEventListeners(instance);\n\n    // Provide a destroy hook to clean up DOM nodes created by this factory\n    const originalDestroy = instance.destroy;\n    instance.destroy = function() {\n      try {\n        // Hide dropdown panel if open\n        if (this.dropdownPanel?.isOpen() && this.dropdownPanel.currentTarget === element) {\n          this.dropdownPanel.hide();\n        }\n        // Clean up dropdown element (no need to remove from DOM, it's in DropdownPanel)\n        if (this.dropdown) {\n          this.dropdown = null;\n        }\n        if (this.hiddenInput && this.hiddenInput.parentNode) {\n          const hiddenName = this.hiddenInput.getAttribute('name');\n          if (hiddenName && element.getAttribute('name') === `${hiddenName}_text`) {\n            element.setAttribute('name', hiddenName);\n          }\n          // Try to unregister hidden input from FormManager if present\n          try {\n            const formEl = element.form || element.closest && element.closest('form');\n            if (formEl && window.FormManager && typeof FormManager.getInstanceByElement === 'function') {\n              const formInstance = FormManager.getInstanceByElement(formEl);\n              if (formInstance && formInstance.elements && formInstance.elements.has(hiddenName)) {\n                try {formInstance.elements.delete(hiddenName);} catch (e) {}\n              }\n            }\n          } catch (e) {}\n\n          this.hiddenInput.parentNode.removeChild(this.hiddenInput);\n          this.hiddenInput = null;\n        }\n        // If HierarchicalTextFactory registered this instance, try to unregister\n        try {if (window.HierarchicalTextFactory && typeof HierarchicalTextFactory.unregister === 'function') HierarchicalTextFactory.unregister(this);} catch (e) {}\n      } catch (err) {\n        console.warn('Error during TextElementFactory.destroy', err);\n      }\n\n      if (typeof originalDestroy === 'function') {\n        try {originalDestroy.call(this);} catch (e) {console.warn('Original destroy threw', e);}\n      }\n\n      return this;\n    };\n\n    return instance;\n  }\n\n  static readFromDatalist(element) {\n    const listId = element.getAttribute('list');\n    if (!listId) return null;\n\n    const datalist = document.getElementById(listId);\n    if (!datalist) return null;\n\n    const options = Array.from(datalist.querySelectorAll('option'));\n    // Preserve DOM order by returning an array of entries: [{value: key, text: value}, ...]\n    const data = [];\n    options.forEach(option => {\n      const text = option.label || option.textContent;\n      const key = option.value || text;\n      data.push({value: key, text});\n    });\n\n    element.removeAttribute('list');\n    datalist.remove();\n    return data.length > 0 ? data : null;\n  }\n\n  static setInitialValue(instance, initialValue) {\n    const {config, element, hiddenInput} = instance;\n    const acConfig = config.autocomplete;\n\n    if (acConfig.source) {\n      // Normalize source to standard format\n      const normalized = this.normalizeSource(acConfig.source);\n      if (!normalized) return;\n\n      // Find matching entry by value or text\n      for (const item of normalized) {\n        if (item.value === initialValue || item.text === initialValue) {\n          element.value = item.text;\n          hiddenInput.value = item.value;\n          instance.selectedValue = item.value;\n          return;\n        }\n      }\n    }\n\n    // If not found in list, hidden will be empty (not selected)\n    hiddenInput.value = '';\n  }\n\n  static setupAutocomplete(instance) {\n    const {element, config, hiddenInput} = instance;\n    const acConfig = config.autocomplete;\n\n    instance.selectedValue = null;\n\n    // Use DropdownPanel instead of creating dropdown element\n    instance.dropdownPanel = DropdownPanel.getInstance();\n    instance.dropdown = document.createElement('ul');\n    instance.dropdown.className = 'autocomplete-list';\n\n    instance.list = [];\n    instance.listIndex = 0;\n\n    instance.populate = (data) => {\n      if (document.activeElement !== element && !instance._isActive) return;\n\n      instance.dropdown.innerHTML = '';\n      instance.list = [];\n      const search = element.value.trim();\n      const filter = new RegExp(`(${instance.escapeRegExp(search)})`, 'gi');\n      let count = 0;\n\n      // Normalize data to standard format\n      const normalized = TextElementFactory.normalizeSource(data);\n      if (!normalized) return;\n\n      // Filter and create list items\n      for (const item of normalized) {\n        if (count >= acConfig.maxResults) break;\n\n        // Apply search filter\n        if (!search || filter.test(item.text)) {\n          const li = instance.createListItem(item.value, item.text, search);\n          instance.list.push(li);\n          instance.dropdown.appendChild(li);\n          count++;\n        }\n      }\n\n      instance.highlightItem(0);\n      if (instance.list.length) instance.show();\n      else instance.hide();\n    };\n\n    // Show dropdown using DropdownPanel\n    instance.show = () => {\n      instance.dropdownPanel.show(element, instance.dropdown, {\n        align: 'left',\n        offsetY: 2,\n        onClose: () => {\n          // Cleanup when panel closes\n        }\n      });\n    };\n\n    // Hide dropdown\n    instance.hide = () => {\n      if (instance.dropdownPanel.isOpen() &&\n        instance.dropdownPanel.currentTarget === element) {\n        instance.dropdownPanel.hide();\n      }\n    };\n\n    instance.escapeRegExp = (str) => str.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n\n    // Create list item with safe DOM construction (no innerHTML XSS risk)\n    instance.createListItem = (key, value, search) => {\n      const li = document.createElement('li');\n      li.dataset.key = key;\n\n      if (typeof acConfig.callback === 'function') {\n        // If callback provided, accept a few return types safely:\n        // - DOM Node -> append directly\n        // - string -> if it contains HTML tags, set innerHTML, otherwise set textContent\n        // - array -> append each item (string or Node)\n        try {\n          const result = acConfig.callback({key, value, search, level: acConfig.level});\n\n          const appendStringSafely = (str) => {\n            const wrapper = document.createElement('div');\n            // If the string appears to contain HTML tags, allow innerHTML; otherwise use textContent\n            if (/<[a-z][\\s\\S]*>/i.test(str)) wrapper.innerHTML = str;\n            else wrapper.textContent = str;\n            li.appendChild(wrapper);\n          };\n\n          if (result instanceof Node) {\n            li.appendChild(result);\n          } else if (Array.isArray(result)) {\n            result.forEach(item => {\n              if (item instanceof Node) li.appendChild(item);\n              else appendStringSafely(String(item));\n            });\n          } else if (typeof result === 'string') {\n            appendStringSafely(result);\n          } else if (result != null) {\n            // Fallback: stringify other types\n            appendStringSafely(String(result));\n          }\n        } catch (cbErr) {\n          console.warn('Autocomplete callback error:', cbErr);\n          // Fallback to default rendering when callback fails\n          const spanFallback = document.createElement('span');\n          spanFallback.textContent = value;\n          li.appendChild(spanFallback);\n        }\n      } else {\n        // Safe rendering: create text nodes and <em> for highlights\n        const span = document.createElement('span');\n\n        if (!search) {\n          // No search term: simple text node\n          span.textContent = value;\n        } else {\n          // Highlight matches safely using DOM nodes\n          // Use a non-capturing regex for splitting (remove capturing group)\n          const splitRegex = new RegExp(instance.escapeRegExp(search), 'gi');\n          const parts = value.split(splitRegex);\n          const matches = value.match(splitRegex) || [];\n\n          parts.forEach((part, index) => {\n            if (part) {\n              span.appendChild(document.createTextNode(part));\n            }\n            if (index < matches.length) {\n              const em = document.createElement('em');\n              em.textContent = matches[index];\n              span.appendChild(em);\n            }\n          });\n        }\n\n        li.appendChild(span);\n      }\n\n      li.addEventListener('mousedown', () => instance.selectItem(key, value));\n      li.addEventListener('mousemove', () => instance.highlightItem(instance.list.indexOf(li)));\n      return li;\n    };\n\n    // Highlight item\n    instance.highlightItem = (index) => {\n      instance.listIndex = Math.max(0, Math.min(instance.list.length - 1, index));\n      instance.list.forEach((item, i) => item.classList.toggle('active', i === instance.listIndex));\n      instance.scrollToItem();\n    };\n\n    // Scroll to item\n    instance.scrollToItem = () => {\n      const item = instance.list[instance.listIndex];\n      if (item) {\n        const dropdownRect = instance.dropdown.getBoundingClientRect();\n        const itemRect = item.getBoundingClientRect();\n        if (itemRect.top < dropdownRect.top) {\n          instance.dropdown.scrollTop = item.offsetTop;\n        } else if (itemRect.bottom > dropdownRect.bottom) {\n          instance.dropdown.scrollTop = item.offsetTop - dropdownRect.height + itemRect.height;\n        }\n      }\n    };\n\n    // Select item\n    instance.selectItem = (key, value) => {\n      // Check if this is a hierarchical selection\n      const selectedLi = instance.list.find(li => li.dataset.key === key);\n      if (selectedLi && selectedLi.dataset.hierarchicalData) {\n        // Use hierarchical selection\n        TextElementFactory.selectHierarchicalItem(instance, key, value);\n        return;\n      }\n\n      // Check if this is a reverse search selection from HierarchicalTextFactory\n      if (instance.manager && typeof instance.manager.isReverseSearchSelection === 'function' && instance.manager.isReverseSearchSelection(instance)) {\n        instance.manager.handleReverseSelection(instance, key, value);\n        instance.hide();\n        // Dispatch change on visible input for UI listeners\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n        try {\n          instance.hiddenInput && instance.hiddenInput.dispatchEvent(new Event('change', {bubbles: true}));\n        } catch (err) {}\n        // Call onChange callback if provided\n        try {\n          if (config && typeof config.onChange === 'function') {\n            config.onChange(element, value);\n          }\n        } catch (err) {\n          console.warn('Error in onChange handler (selectItem):', err);\n        }\n        return;\n      }\n\n      // Normal selection\n      element.value = value;\n      hiddenInput.value = key;\n      instance.selectedValue = key;\n      instance.hide();\n      // Dispatch change on visible input for UI listeners\n      element.dispatchEvent(new Event('change', {bubbles: true}));\n      // Also dispatch change on hidden input so FormManager detects the actual\n      // submitted field name (the hidden input holds the real value/key)\n      try {\n        instance.hiddenInput && instance.hiddenInput.dispatchEvent(new Event('change', {bubbles: true}));\n      } catch (err) {}\n      if (instance.manager) instance.manager.onSelectionChange(instance);\n      // Call onChange callback if provided\n      try {\n        if (config && typeof config.onChange === 'function') {\n          config.onChange(element, value);\n        }\n      } catch (err) {\n        console.warn('Error in onChange handler (selectItem):', err);\n      }\n    };\n  }\n\n  static loadFromAjax(instance, url, query = '') {\n    // Use HttpClient only - no fallback\n    if (!window.http || typeof window.http.get !== 'function') {\n      console.error('[TextElementFactory] HttpClient (window.http) is required but not available');\n      alert('System error: HttpClient not loaded. Please refresh the page.');\n      return;\n    }\n\n    // Build URL with query parameter\n    let requestUrl = url;\n    if (query) {\n      const separator = url.includes('?') ? '&' : '?';\n      requestUrl = `${url}${separator}q=${encodeURIComponent(query)}`;\n    }\n\n    window.http.get(requestUrl, {throwOnError: false})\n      .then(resp => {\n        if (resp && resp.success) {\n          instance.populate(resp.data);\n        } else {\n          console.error('[TextElementFactory] Failed to load data:', requestUrl, resp);\n        }\n      })\n      .catch(err => {\n        console.error('[TextElementFactory] Ajax error:', err);\n      });\n  }\n\n  /**\n   * Hierarchical search using API endpoint\n   * Searches across all related hierarchical data and displays in format: \"province => amphur => district\"\n   */\n  static searchHierarchical(instance, query) {\n    const {config, element} = instance;\n\n    if (!config.searchApi || !config.searchField) {\n      console.warn('[TextElementFactory] searchApi or searchField not configured');\n      return;\n    }\n\n    if (!window.http || typeof window.http.post !== 'function') {\n      console.error('[TextElementFactory] HttpClient (window.http) is required but not available');\n      return;\n    }\n\n    // Call search API with query and field\n    const formData = new FormData();\n    formData.append('query', query);\n    formData.append('field', config.searchField);\n\n    window.http.post(config.searchApi, formData, {throwOnError: false})\n      .then(resp => {\n        if (resp && resp.success && resp.data) {\n          // Handle nested API response structure: {success, message, code, data: {results: [...]}}\n          const results = resp.data.data?.results || resp.data.results;\n\n          if (results && results.length > 0) {\n            // Store hierarchical data for later use\n            instance._hierarchicalData = results;\n\n            // Populate dropdown with formatted results\n            TextElementFactory.populateHierarchical(instance, results);\n          } else {\n            instance.hide();\n          }\n        } else {\n          instance.hide();\n        }\n      })\n      .catch(err => {\n        console.error('[TextElementFactory] Hierarchical search error:', err);\n        instance.hide();\n      });\n  }\n\n  /**\n   * Populate dropdown with hierarchical search results\n   */\n  static populateHierarchical(instance, data) {\n    const {element, config} = instance;\n    const acConfig = config.autocomplete;\n\n    if (document.activeElement !== element && !instance._isActive) return;\n\n    instance.dropdown.innerHTML = '';\n    instance.list = [];\n\n    // Create list items without filtering (already filtered by API)\n    data.forEach((item, index) => {\n      if (index >= acConfig.maxResults) return;\n\n      // Use province value as the key (first field in hierarchy)\n      const key = item.data?.province?.value || index;\n      const li = instance.createListItem(key, item.text, ''); // No search highlight (already formatted)\n      li.dataset.hierarchicalData = JSON.stringify(item); // Store full item data\n      instance.list.push(li);\n      instance.dropdown.appendChild(li);\n    });\n\n    instance.highlightItem(0);\n    if (instance.list.length) instance.show();\n    else instance.hide();\n  }\n\n  /**\n   * Override selectItem for hierarchical selection\n   * Populates all related fields (province, amphur, district, zipcode) at once\n   */\n  static selectHierarchicalItem(instance, value, text) {\n    const {element, config, hiddenInput} = instance;\n\n    // Find the hierarchical data from the selected item\n    const selectedItem = instance.list.find(li => li.dataset.key === value);\n    if (!selectedItem || !selectedItem.dataset.hierarchicalData) {\n      console.warn('[TextElementFactory] No hierarchical data found for selection');\n      return;\n    }\n\n    try {\n      const item = JSON.parse(selectedItem.dataset.hierarchicalData);\n      const data = item.data; // Extract nested data object\n\n      // Extract field name from element name (remove \"_text\" suffix if present)\n      const fieldName = element.getAttribute('name').replace('_text', '');\n\n      // Set current field value and text from {value, text} structure\n      if (data[fieldName]) {\n        element.value = data[fieldName].text || text;\n        hiddenInput.value = data[fieldName].value || value;\n        instance.selectedValue = data[fieldName].value || value;\n      }\n\n      // Find form and populate all related fields\n      const form = element.closest('form');\n      if (form) {\n        // Find all other hierarchical search inputs in the same form\n        const relatedInputs = form.querySelectorAll('input[data-search-api][data-autocomplete=\"true\"]');\n\n        relatedInputs.forEach(input => {\n          if (input === element) return; // Skip current field\n\n          const relatedFieldName = input.getAttribute('name').replace('_text', '');\n          const relatedData = data[relatedFieldName];\n\n          if (relatedData && relatedData.value && relatedData.text) {\n            // Set visible text\n            input.value = relatedData.text;\n\n            // Set hidden value if exists\n            const relatedHiddenName = input.getAttribute('name').includes('_text')\n              ? relatedFieldName\n              : relatedFieldName;\n            const relatedHidden = form.querySelector(`input[type=\"hidden\"][name=\"${relatedHiddenName}\"]`);\n            if (relatedHidden) {\n              relatedHidden.value = relatedData.value;\n            }\n          }\n        });\n\n        // Populate zipcode (readonly field)\n        if (data.zipcode) {\n          const zipcodeInput = form.querySelector('input[name=\"zipcode\"]');\n          if (zipcodeInput) {\n            zipcodeInput.value = data.zipcode.value || data.zipcode.text;\n          }\n        }\n      }\n\n      instance.hide();\n\n      // Dispatch change event\n      element.dispatchEvent(new Event('change', {bubbles: true}));\n      hiddenInput && hiddenInput.dispatchEvent(new Event('change', {bubbles: true}));\n\n    } catch (err) {\n      console.error('[TextElementFactory] Error parsing hierarchical data:', err);\n    }\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config, hiddenInput} = instance;\n    const acConfig = config.autocomplete;\n\n    super.setupEventListeners(instance);\n\n    // Prevent duplicate event registration\n    if (instance._autocompleteListenersSetup) return;\n    instance._autocompleteListenersSetup = true;\n\n    const debounce = Utils.function.debounce((value) => {\n      if (!acConfig.enabled) return;\n      if (value.length < acConfig.minLength) {\n        instance.hide();\n        return;\n      }\n\n      // Check if this is a hierarchical search field\n      if (config.searchApi && config.searchField) {\n        // Use hierarchical search API\n        TextElementFactory.searchHierarchical(instance, value);\n      } else if (instance.manager) {\n        // Use HierarchicalTextFactory manager\n        instance.manager.search(instance, value);\n      } else if (typeof acConfig.source === 'string' && (acConfig.source.startsWith('http') || acConfig.source.startsWith('/') || acConfig.source.startsWith('api/'))) {\n        // URL source - load from API with query parameter\n        TextElementFactory.loadFromAjax(instance, acConfig.source, value);\n      } else {\n        // Normal populate from static source (array/object/global variable)\n        instance.populate(acConfig.source);\n      }\n    }, acConfig.delay);\n\n    EventSystemManager.addHandler(element, 'input', (e) => {\n      const value = e.target.value.trim();\n\n      // When user types (not selected from list), set hidden input to text value\n      // This allows fallback to text if no selection is made\n      if (hiddenInput) {\n        hiddenInput.value = value;\n      }\n      instance.selectedValue = null;\n\n      debounce(value);\n\n      // If autocomplete is not enabled, call onChange to notify listeners\n      try {\n        if (!acConfig.enabled && config && typeof config.onChange === 'function') {\n          config.onChange(element, value);\n        }\n      } catch (err) {\n        console.warn('Error in onChange handler (input):', err);\n      }\n    });\n\n    // Focus event - show dropdown when input gets focus (if autocomplete enabled)\n    EventSystemManager.addHandler(element, 'focus', () => {\n      // Mark this instance as active\n      instance._isActive = true;\n\n      // Only populate if autocomplete is enabled\n      if (!acConfig.enabled) return;\n\n      // For hierarchical inputs, use HierarchicalTextFactory manager\n      if (instance.manager && typeof instance.manager.search === 'function') {\n        instance.manager.search(instance, element.value.trim());\n        return;\n      }\n\n      if (acConfig.source) {\n        if (typeof acConfig.source === 'string' && window[acConfig.source]) {\n          // Global variable reference\n          instance.populate(window[acConfig.source]);\n        } else if (typeof acConfig.source === 'string' && (acConfig.source.startsWith('http') || acConfig.source.startsWith('/') || acConfig.source.startsWith('api/'))) {\n          // URL (absolute, root-relative, or relative path starting with 'api/')\n          // Only load on focus if there's already a value to search for\n          const currentValue = element.value.trim();\n          if (currentValue.length >= acConfig.minLength) {\n            this.loadFromAjax(instance, acConfig.source, currentValue);\n          }\n          // Otherwise wait for user to type (handled by input event)\n        } else {\n          // Populate from existing array/object\n          instance.populate(acConfig.source);\n        }\n      }\n    });\n\n    // Keydown event - navigate dropdown list\n    EventSystemManager.addHandler(element, 'keydown', (e) => {\n      if (!instance.dropdownPanel?.isOpen() ||\n        instance.dropdownPanel.currentTarget !== element) return;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          instance.highlightItem(instance.listIndex + 1);\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n        case 'ArrowUp':\n          instance.highlightItem(instance.listIndex - 1);\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n        case 'Enter':\n          const item = instance.list[instance.listIndex];\n          if (item) {\n            // Get text from item (remove HTML tags)\n            const text = item.textContent || item.innerText;\n            const key = item.dataset.key;\n            instance.selectItem(key, text);\n          }\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n        case 'Escape':\n          if (typeof instance.hide === 'function') {\n            instance.hide();\n          }\n          e.preventDefault();\n          e.stopPropagation();\n          break;\n      }\n    });\n\n    // Blur event - hide dropdown with delay to allow click events\n    EventSystemManager.addHandler(element, 'blur', (e) => {\n      // Mark as not active\n      instance._isActive = false;\n\n      setTimeout(() => {\n        // Only hide if not clicking inside DropdownPanel and still not active\n        const panel = instance.dropdownPanel?.panel;\n        if (!instance._isActive && (!panel || !panel.contains(document.activeElement))) {\n          if (typeof instance.hide === 'function') {\n            instance.hide();\n          }\n        }\n      }, 200);\n    });\n  }\n\n  static updateOptions(element, options) {\n    // Get element instance from ElementManager\n    const instance = ElementManager?.getInstanceByElement(element);\n\n    if (!instance || !instance.config) {\n      // Element not yet enhanced - store options in dataset for later use\n      element.dataset.pendingOptions = JSON.stringify(options);\n      return;\n    }\n\n    const acConfig = instance.config.autocomplete;\n\n    // Set options as autocomplete source directly (no datalist needed!)\n    acConfig.source = options;\n\n    // Auto-enable autocomplete if not already enabled\n    if (!acConfig.enabled) {\n      acConfig.enabled = true;\n      // Need to setup autocomplete UI\n      this.setupAutocomplete(instance);\n    }\n  }\n\n  static populateFromOptions(element, optionsData, optionsKey) {\n    if (!element || !optionsData || !optionsKey) return;\n\n    let options = optionsData[optionsKey];\n    if (!options) return;\n\n    // Validate options format (must be Array of {value: string, text: string})\n    if (!Array.isArray(options)) {\n      console.warn('[TextElementFactory] Options must be an Array. Expected format: [{value: \"1\", text: \"Option 1\"}, ...]');\n      return;\n    }\n\n    // Validate array items have correct format\n    const hasInvalidItems = options.some(opt =>\n      typeof opt !== 'object' || !('value' in opt) || !('text' in opt)\n    );\n\n    if (hasInvalidItems) {\n      console.warn('[TextElementFactory] Invalid option format. Each item must have {value: string, text: string}');\n      return;\n    }\n\n    // Save current value before updating options\n    const currentValue = element.value;\n\n    // Update element's options using existing updateOptions method\n    this.updateOptions(element, options);\n\n    // Restore value after populating options (important for modal forms)\n    if (currentValue) {\n      // Find the option that matches the current value (could be ID/key or display text)\n      // Check both value and text fields to handle cases where setFormData already converted ID to text\n      // Use loose equality (==) to handle type coercion (e.g., 10 == \"10\")\n      const matchedOption = options.find(opt =>\n        opt.value == currentValue || opt.text == currentValue ||\n        String(opt.value) === String(currentValue) || String(opt.text) === String(currentValue)\n      );\n\n      if (matchedOption) {\n        // Set the display text in the visible input\n        element.value = matchedOption.text;\n\n        // Also update hidden input with the ID value (not currentValue!)\n        const instance = ElementManager?.getInstanceByElement(element);\n        if (instance?.hiddenInput) {\n          instance.hiddenInput.value = matchedOption.value;\n          instance.selectedValue = matchedOption.value;\n        }\n      } else {\n        // If no match found, keep the original value\n        element.value = currentValue;\n      }\n    }\n  }\n\n  static populateFromOptionsInContainer(container, optionsData) {\n    if (!container || !optionsData) return;\n\n    const inputsWithOptionsKey = container.querySelectorAll('input[data-options-key]');\n\n    inputsWithOptionsKey.forEach(input => {\n      const optionsKey = input.dataset.optionsKey;\n      this.populateFromOptions(input, optionsData, optionsKey);\n    });\n  }\n\n  /**\n   * After form data is loaded (values set from server), convert any inputs\n   * that have an ID value into display text by looking up the source.\n   * This is needed because options may have been set before form data was\n   * applied, or vice-versa.\n   * @param {HTMLElement} container - form or container element\n   */\n  static applyInitialValuesInContainer(container) {\n    if (!container) return;\n    const inputsWithOptionsKey = container.querySelectorAll('input[data-options-key], select[data-options-key]');\n    inputsWithOptionsKey.forEach(input => {\n      const instance = ElementManager?.getInstanceByElement(input);\n      if (instance && instance.config && instance.config.autocomplete && instance.config.autocomplete.source) {\n        const val = input.value;\n        if (val) {\n          this.setInitialValue(instance, val);\n        }\n      }\n    });\n  }\n\n  /**\n   * Normalize source data into standard format: Array<{value: string, text: string}>\n   * Accepts: Array (objects or primitives), Map, plain Object, or null\n   * Returns: Array<{value: string, text: string}> or null\n   */\n  static normalizeSource(source) {\n    if (!source) return null;\n\n    // If source is a string, attempt to resolve it to actual data.\n    // Acceptable string forms:\n    // - A global variable name (e.g. 'PROVINCES') -> resolve window[NAME]\n    // - A JSON string -> parse it\n    // - A URL (starts with http, /, or api/) -> leave for AJAX loader (return null)\n    if (typeof source === 'string') {\n      // URL -> nothing to normalize here (will be loaded via AJAX elsewhere)\n      if (/^(https?:\\/\\/|\\/|api\\/)/i.test(source)) return null;\n\n      // Try resolving a global variable reference\n      try {\n        if (typeof window !== 'undefined' && window[source]) {\n          source = window[source];\n        } else {\n          // Try parsing as JSON string\n          try {\n            const parsed = JSON.parse(source);\n            source = parsed;\n          } catch (e) {\n            // leave as-is (will fall through to final invalid warning)\n          }\n        }\n      } catch (e) {\n        // ignore and proceed to validation below\n      }\n    }\n\n    // Array format (most common)\n    if (Array.isArray(source)) {\n      return source.map(item => {\n        // Support arrays of [key, text]\n        if (Array.isArray(item) && item.length >= 2) {\n          return {value: String(item[0]), text: String(item[1])};\n        }\n\n        // Object format: {value, text} or {id, name} etc.\n        if (item && typeof item === 'object') {\n          const value = item.value !== undefined ? item.value : (item.id ?? item.key ?? item.name ?? '');\n          const text = item.text ?? item.label ?? item.name ?? value;\n          return {value: String(value), text: String(text)};\n        }\n\n        // Primitive: use same value for both\n        const str = String(item);\n        return {value: str, text: str};\n      });\n    }\n\n    // Map format\n    if (source instanceof Map) {\n      const result = [];\n      for (const [k, v] of source.entries()) {\n        const value = String(k);\n        const text = (v && typeof v === 'object')\n          ? String(v.text || v.label || v.name || k)\n          : String(v);\n        result.push({value, text});\n      }\n      return result;\n    }\n\n    // Plain object format {key: value, ...}\n    // But first check if it's an API response format {success, data}\n    if (typeof source === 'object' && source !== null) {\n      // Check for API response format: {success: true, data: [...]}\n      if (source.success !== undefined && Array.isArray(source.data)) {\n        // Recursively normalize the data array\n        return TextElementFactory.normalizeSource(source.data);\n      }\n\n      // Regular object format {key: value, ...}\n      return Object.entries(source).map(([k, v]) => {\n        const value = String(k);\n        const text = (v && typeof v === 'object')\n          ? String(v.text || v.label || v.name || k)\n          : String(v);\n        return {value, text};\n      });\n    }\n\n    console.warn('[TextElementFactory] Invalid source format. Expected Array, Map, or Object.');\n    return null;\n  }\n}\n\n/**\n * TextElementFactory Export\n */\nwindow.TextElementFactory = TextElementFactory;\n\n/**\n * HierarchicalTextFactory\n * Manages hierarchical/cascading inputs grouped by form\n */\nclass HierarchicalTextFactory extends ElementFactory {\n  static groups = new Map(); // form -> { instances: [], dataCache: null }\n  static dataCache = null;   // Shared data cache (same source)\n\n  static getGroup(instance) {\n    const form = instance.element.closest('form') || document.body;\n    if (!this.groups.has(form)) {\n      this.groups.set(form, {instances: [], dataCache: null});\n    }\n    return this.groups.get(form);\n  }\n\n  static register(instance) {\n    instance.manager = this;\n    const group = this.getGroup(instance);\n    group.instances.push(instance);\n\n    // Load data if this is the first instance with a source\n    const source = instance.config.autocomplete.source;\n    if (source && !this.dataCache) {\n      this.loadData(source);\n    } else if (this.dataCache) {\n      // Data already loaded, share it\n      group.dataCache = this.dataCache;\n    }\n  }\n\n  static loadData(source) {\n    // Check if source is a global variable\n    if (typeof source === 'string' && window[source]) {\n      this.dataCache = window[source];\n      this.syncDataToGroups();\n      return;\n    }\n\n    // Check if source is a URL (http/https or relative path like .json)\n    const isUrl = typeof source === 'string' && (\n      source.startsWith('http') ||\n      source.startsWith('/') ||\n      source.endsWith('.json') ||\n      source.includes('/')\n    );\n\n    if (isUrl) {\n      // Use HttpClient if available\n      if (window.http && typeof window.http.get === 'function') {\n        window.http.get(source, {throwOnError: false})\n          .then(resp => {\n            if (resp && resp.success) {\n              this.dataCache = resp.data;\n              this.syncDataToGroups();\n            } else if (resp && !resp.success && resp.data) {\n              // Sometimes response is direct data\n              this.dataCache = resp.data;\n              this.syncDataToGroups();\n            } else {\n              console.error('[HierarchicalTextFactory] Failed to load hierarchical data:', source, resp);\n            }\n          })\n          .catch(err => {\n            console.error('[HierarchicalTextFactory] Error loading hierarchical data:', err);\n          });\n      } else {\n        // Fallback to fetch API\n        fetch(source)\n          .then(response => {\n            if (!response.ok) throw new Error(`HTTP ${response.status}`);\n            return response.json();\n          })\n          .then(data => {\n            this.dataCache = data;\n            this.syncDataToGroups();\n          })\n          .catch(err => {\n            console.error('[HierarchicalTextFactory] Error loading hierarchical data:', err);\n          });\n      }\n    }\n  }\n\n  static syncDataToGroups() {\n    // Share data cache to all groups\n    this.groups.forEach(group => {\n      group.dataCache = this.dataCache;\n    });\n  }\n\n  static getInstancesInGroup(instance) {\n    const group = this.getGroup(instance);\n    return group.instances;\n  }\n\n  static getLevelInGroup(instance) {\n    const instances = this.getInstancesInGroup(instance);\n    return instances.findIndex(inst => inst === instance);\n  }\n\n  static getInstanceByLevelInGroup(instance, level) {\n    const instances = this.getInstancesInGroup(instance);\n    return instances[level];\n  }\n\n  static onSelectionChange(changedInstance) {\n    const instances = this.getInstancesInGroup(changedInstance);\n    const level = instances.findIndex(inst => inst === changedInstance);\n    if (level === -1) return;\n\n    // Clear all instances after this level\n    for (let i = level + 1; i < instances.length; i++) {\n      instances[i].element.value = '';\n      instances[i].selectedValue = null;\n      if (instances[i].hiddenInput) {\n        instances[i].hiddenInput.value = '';\n      }\n    }\n  }\n\n  /**\n   * Generic search for any level\n   * Supports any number of hierarchical levels (2, 3, 4, etc.)\n   */\n  static search(instance, query) {\n    const instances = this.getInstancesInGroup(instance);\n    const level = instances.findIndex(inst => inst === instance);\n    const totalLevels = instances.length;\n    if (!this.dataCache) return;\n\n    if (level === 0) {\n      // First level - show all top-level items\n      instance.populate(this.dataCache);\n    } else {\n      // Get data based on parent selections\n      let data = this.dataCache;\n      let allParentsSelected = true;\n\n      for (let i = 0; i < level; i++) {\n        const parentValue = instances[i]?.selectedValue;\n        if (parentValue && data && data[parentValue]) {\n          data = data[parentValue];\n        } else {\n          allParentsSelected = false;\n          break;\n        }\n      }\n\n      if (allParentsSelected && data) {\n        instance.populate(data);\n      } else if (query && query.length >= 1) {\n        // Reverse search when parent levels not selected\n        this.reverseSearch(instance, query, level, totalLevels);\n      } else {\n        instance.populate({});\n      }\n    }\n  }\n\n  /**\n   * Generic reverse search for any level\n   * @param {Object} instance - The input instance\n   * @param {string} query - Search query\n   * @param {number} targetLevel - The level to search at (1, 2, 3, etc.)\n   * @param {number} totalLevels - Total number of levels in hierarchy\n   */\n  static reverseSearch(instance, query, targetLevel, totalLevels) {\n    if (!query || !this.dataCache) return;\n\n    const filter = new RegExp(instance.escapeRegExp(query), 'gi');\n    const results = [];\n\n    // Recursive function to traverse data at any depth\n    const traverse = (data, path = [], depth = 0) => {\n      if (depth === targetLevel) {\n        // At target level - search keys or leaf values\n        for (let key in data) {\n          const value = data[key];\n          // Check if this is the last level (leaf nodes have non-object values)\n          const isLeaf = typeof value !== 'object' || value === null;\n\n          if (isLeaf) {\n            // Leaf level - search in values\n            if (filter.test(value)) {\n              results.push({\n                path: [...path],\n                key: key,\n                value: value,\n                isLeaf: true\n              });\n            }\n          } else {\n            // Non-leaf level - search in keys\n            if (filter.test(key)) {\n              results.push({\n                path: [...path],\n                key: key,\n                value: key,\n                isLeaf: false,\n                children: value\n              });\n            }\n          }\n        }\n      } else if (depth < targetLevel && typeof data === 'object' && data !== null) {\n        // Continue traversing\n        for (let key in data) {\n          traverse(data[key], [...path, key], depth + 1);\n        }\n      }\n    };\n\n    traverse(this.dataCache);\n\n    // Build flattened results for dropdown\n    const flatResults = {};\n    results.forEach(item => {\n      // Build display text: \"value (parent1, parent2, ...)\"\n      const parents = item.path.slice().reverse().join(', ');\n      const displayValue = item.isLeaf ? item.value : item.key;\n\n      // Build unique key\n      let uniqueKey;\n      if (item.isLeaf) {\n        uniqueKey = item.key;\n      } else {\n        // For non-leaf, use path separator\n        uniqueKey = [...item.path, item.key].join('||');\n      }\n\n      flatResults[uniqueKey] = parents ? `${displayValue} (${parents})` : displayValue;\n    });\n\n    // Store pending data for auto-fill on selection\n    instance._pendingReverseData = results;\n    instance._pendingReverseLevel = targetLevel;\n    instance._pendingReverseTotalLevels = totalLevels;\n\n    instance.populate(flatResults);\n  }\n\n  /**\n   * Handle selection from reverse search results\n   * Auto-fill parent levels based on selection\n   */\n  static handleReverseSelection(instance, key, value) {\n    const instances = this.getInstancesInGroup(instance);\n    const results = instance._pendingReverseData;\n    const level = instance._pendingReverseLevel;\n\n    if (!results || !Array.isArray(results)) return;\n\n    // Find the matching result\n    let matchedResult = null;\n    for (const item of results) {\n      let itemKey;\n      if (item.isLeaf) {\n        itemKey = item.key;\n      } else {\n        itemKey = [...item.path, item.key].join('||');\n      }\n\n      if (itemKey === key) {\n        matchedResult = item;\n        break;\n      }\n    }\n\n    if (!matchedResult) return;\n\n    // Auto-fill parent levels from path\n    matchedResult.path.forEach((pathValue, i) => {\n      if (instances[i]) {\n        instances[i].element.value = pathValue;\n        instances[i].selectedValue = pathValue;\n        if (instances[i].hiddenInput) {\n          instances[i].hiddenInput.value = pathValue;\n        }\n      }\n    });\n\n    // Set current field value\n    if (matchedResult.isLeaf) {\n      instance.element.value = matchedResult.value;\n      instance.selectedValue = matchedResult.key;\n      if (instance.hiddenInput) {\n        instance.hiddenInput.value = matchedResult.key;\n      }\n    } else {\n      instance.element.value = matchedResult.key;\n      instance.selectedValue = matchedResult.key;\n      if (instance.hiddenInput) {\n        instance.hiddenInput.value = matchedResult.key;\n      }\n    }\n\n    // Clear all child levels after current level\n    const currentLevel = instances.findIndex(inst => inst === instance);\n    for (let i = currentLevel + 1; i < instances.length; i++) {\n      if (instances[i]) {\n        instances[i].element.value = '';\n        instances[i].selectedValue = null;\n        if (instances[i].hiddenInput) {\n          instances[i].hiddenInput.value = '';\n        }\n      }\n    }\n\n    // Clear pending data\n    instance._pendingReverseData = null;\n    instance._pendingReverseLevel = null;\n    instance._pendingReverseTotalLevels = null;\n  }\n\n  /**\n   * Check if selection is from reverse search\n   */\n  static isReverseSearchSelection(instance) {\n    return instance._pendingReverseData != null;\n  }\n}\n\nclass EmailElementFactory extends TextElementFactory {\n  static config = {\n    ...TextElementFactory.config,\n    type: 'text',\n    inputMode: 'email',\n    validation: ['email'],\n    formatter: (value) => {\n      return value.toLowerCase();\n    }\n  };\n}\n\nclass UrlElementFactory extends TextElementFactory {\n  static config = {\n    ...TextElementFactory.config,\n    type: 'text',\n    inputMode: 'url',\n    validation: ['url']\n  };\n}\n\nclass UsernameElementFactory extends TextElementFactory {\n  static config = {\n    ...TextElementFactory.config,\n    type: 'text',\n    inputMode: 'text',\n    validation: ['usernameOrEmail'],\n    formatter: (value) => {\n      return value.toLowerCase();\n    }\n  };\n}\n\nElementManager.registerElement('text', TextElementFactory);\nElementManager.registerElement('email', EmailElementFactory);\nElementManager.registerElement('url', UrlElementFactory);\nElementManager.registerElement('username', UsernameElementFactory);\n","class MaskElementFactory extends ElementFactory {\n  static config = {\n    maskOnInit: true,\n    maskOnChange: true,\n    maskOnBlur: true,\n    unmaskOnSubmit: false,\n    placeholderChar: '_',\n    allowPartial: false,\n    masks: {\n      tel: {\n        mask: '99-9999-9999',\n        placeholder: '__-____-____',\n        inputMode: 'tel',\n        validator: '^[0-9]{2}\\\\-[0-9]{4}\\\\-[0-9]{3,4}$'\n      },\n      date: {\n        mask: '99/99/9999',\n        format: 'xx/xx/xxxx',\n        placeholder: '__/__/____',\n        inputMode: 'numeric'\n      },\n      time: {\n        mask: '99:99',\n        format: 'xx:xx',\n        placeholder: '__:__',\n        inputMode: 'numeric'\n      },\n      datetime: {\n        mask: '99/99/9999 99:99',\n        format: 'xx/xx/xxxx xx:xx',\n        placeholder: '__/__/____ __:__',\n        inputMode: 'numeric'\n      },\n      creditcard: {\n        mask: '9999-9999-9999-9999',\n        format: 'xxxx-xxxx-xxxx-xxxx',\n        placeholder: '____-____-____-____',\n        inputMode: 'numeric'\n      },\n      ip: {\n        mask: '999.999.999.999',\n        format: 'xxx.xxx.xxx.xxx',\n        placeholder: '___.___.___.___',\n        inputMode: 'numeric',\n        allowPartial: true,\n        validator: '^[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}\\\\.[0-9]{1,3}$'\n      },\n      idcard: {\n        mask: '9-9999-99999-99-9',\n        format: 'x-xxxx-xxxxx-xx-x',\n        placeholder: '_-____-_____-__-_',\n        inputMode: 'numeric'\n      },\n      zipcode: {\n        mask: '99999',\n        format: 'xxxxx',\n        placeholder: '_____',\n        inputMode: 'numeric',\n        allowPartial: true\n      },\n      currency: {\n        mask: '#,###.##',\n        inputMode: 'decimal',\n        allowPartial: true\n      }\n    },\n    inputPatterns: {\n      '9': /[0-9]/,\n      'a': /[a-zA-Z]/,\n      'A': /[a-zA-Z]/,\n      '*': /[a-zA-Z0-9]/,\n      '#': /[0-9.,\\-]/,\n      'X': /./\n    }\n  };\n\n  static setupElement(instance) {\n    const {element} = instance;\n\n    this.setupMask(instance);\n\n    if (!instance.mask) return instance;\n\n    if (instance.mask.inputMode) {\n      element.inputMode = instance.mask.inputMode;\n    }\n\n    if (!element.placeholder && instance.mask.placeholder) {\n      element.placeholder = instance.mask.placeholder;\n    }\n\n    return instance;\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config} = instance;\n\n    const handlers = {\n      input: (e) => {\n        const cursorPosition = element.selectionStart;\n        const value = element.value;\n\n        if (instance.mask && config.maskOnChange) {\n          // Check if we have a preserved cursor position from Backspace FIRST\n          const privateState = this._privateState.get(element);\n          const hasPreservedCursor = privateState && privateState.preserveCursorPos !== undefined;\n\n          // Get previous value for cursor tracking\n          const previousValue = privateState?.previousValue || '';\n          const previousCursor = privateState?.previousCursor || 0;\n\n          const result = this.formatValue(value, instance.mask, previousValue, cursorPosition);\n\n          if (result.formatted !== value) {\n            element.value = result.formatted;\n          }\n\n          // Store current value and cursor for next time\n          if (!privateState) {\n            this._privateState.set(element, {previousValue: result.formatted, previousCursor: cursorPosition});\n          } else {\n            privateState.previousValue = result.formatted;\n            privateState.previousCursor = cursorPosition;\n            this._privateState.set(element, privateState);\n          }\n\n          // Handle cursor positioning\n          if (hasPreservedCursor) {\n            // Preserved cursor has absolute priority\n            const finalCursorPos = privateState.preserveCursorPos;\n            // Clear the preserved position after using it\n            delete privateState.preserveCursorPos;\n            this._privateState.set(element, privateState);\n\n            // Set cursor immediately, no setTimeout needed\n            element.setSelectionRange(finalCursorPos, finalCursorPos);\n          } else if (result.formatted !== value && result.newCursorPos !== undefined) {\n            // Normal formatting cursor position\n            setTimeout(() => {\n              element.setSelectionRange(result.newCursorPos, result.newCursorPos);\n            }, 0);\n\n            // Auto-separator filling logic\n            if (instance.mask.groupSizes && instance.mask.separators) {\n              let totalChars = 0;\n\n              for (let i = 0; i < instance.mask.groupSizes.length - 1; i++) {\n                totalChars += instance.mask.groupSizes[i];\n\n                if (cursorPosition === totalChars) {\n                  const allFilledChars = element.value.substring(0, cursorPosition).replace(/[^0-9a-zA-Z]/g, '').length;\n                  const expectedFilledChars = instance.mask.groupSizes.slice(0, i + 1).reduce((a, b) => a + b, 0);\n\n                  if (allFilledChars === expectedFilledChars) {\n                    setTimeout(() => {\n                      element.setSelectionRange(cursorPosition + 1, cursorPosition + 1);\n                    }, 0);\n                    break;\n                  }\n                }\n              }\n            }\n          }\n\n          const currentPrivateState = this._privateState.get(element);\n          if (currentPrivateState) {\n            currentPrivateState.modified = true;\n          }\n\n          instance.validate(result.formatted, false);\n        }\n      },\n      change: (e) => {\n        const validatedValue = instance.validate(element.value, true);\n        if (validatedValue !== element.value) {\n          element.value = validatedValue;\n        }\n      },\n      focus: (e) => {\n        if (instance.mask) {\n          setTimeout(() => {\n            if (!element.value) {\n              element.setSelectionRange(0, 0);\n              return;\n            }\n\n            if (instance.mask.placeholder) {\n              const placeholderChar = config.placeholderChar;\n              const pos = element.value.indexOf(placeholderChar);\n              if (pos > -1) {\n                element.setSelectionRange(pos, pos);\n                return;\n              }\n            }\n\n            if (instance.mask.groupSizes && instance.mask.groupSizes.length) {\n              element.setSelectionRange(0, instance.mask.groupSizes[0]);\n            }\n          }, 10);\n        }\n\n        FormError.clearFieldError(element.id);\n      },\n      blur: (e) => {\n        if (instance.mask && config.maskOnBlur) {\n          const result = this.formatValue(element.value, instance.mask);\n          if (result.formatted !== element.value) {\n            element.value = result.formatted;\n          }\n\n          instance.validate(result.formatted, true);\n        }\n      },\n      keydown: (e) => {\n        if (!instance.mask) return;\n\n        // Handle Backspace key\n        if (e.key === 'Backspace') {\n          const curPos = element.selectionStart;\n          const selEnd = element.selectionEnd;\n          const value = element.value;\n          const {separators} = instance.mask;\n\n          // If there's a selection, let default behavior handle it\n          if (curPos !== selEnd) {\n            return;\n          }\n\n          // If cursor is at the beginning, nothing to delete\n          if (curPos === 0) {\n            return;\n          }\n\n          // Check if the character before cursor is a separator\n          const charBeforeCursor = value[curPos - 1];\n          const isSeparator = separators && separators.some(sep => sep === charBeforeCursor);\n\n          if (isSeparator && curPos >= 2) {\n            // Delete both the separator and the character before it\n            e.preventDefault();\n            const targetCursorPos = curPos - 2;\n            const newValue = value.substring(0, targetCursorPos) + value.substring(curPos);\n            element.value = newValue;\n\n            // Store cursor position before triggering input event\n            const privateState = this._privateState.get(element) || {};\n            privateState.preserveCursorPos = targetCursorPos;\n            this._privateState.set(element, privateState);\n\n            // Trigger input event to update validation and formatting\n            element.dispatchEvent(new Event('input', {bubbles: true}));\n            return;\n          } else {\n            // For non-separator characters, preserve cursor position after formatting\n            e.preventDefault();\n            const targetCursorPos = curPos - 1;\n            const newValue = value.substring(0, targetCursorPos) + value.substring(curPos);\n            element.value = newValue;\n\n            // Store cursor position before triggering input event\n            const privateState = this._privateState.get(element) || {};\n            privateState.preserveCursorPos = targetCursorPos;\n            this._privateState.set(element, privateState);\n\n            // Trigger input event to update validation and formatting\n            element.dispatchEvent(new Event('input', {bubbles: true}));\n            return;\n          }\n        }\n\n        // Handle Delete key (forward delete)\n        if (e.key === 'Delete') {\n          const curPos = element.selectionStart;\n          const selEnd = element.selectionEnd;\n          const value = element.value;\n          const {separators} = instance.mask;\n\n          // If there's a selection, let default behavior handle it\n          if (curPos !== selEnd) {\n            return;\n          }\n\n          // If cursor is at the end, nothing to delete\n          if (curPos >= value.length) {\n            return;\n          }\n\n          // Check if the character after cursor is a separator\n          const charAfterCursor = value[curPos];\n          const isSeparator = separators && separators.some(sep => sep === charAfterCursor);\n\n          if (isSeparator && curPos + 1 < value.length) {\n            // Delete both the separator and the character after it\n            e.preventDefault();\n            const newValue = value.substring(0, curPos) + value.substring(curPos + 2);\n            element.value = newValue;\n\n            // Store cursor position before triggering input event\n            const privateState = this._privateState.get(element) || {};\n            privateState.preserveCursorPos = curPos;\n            this._privateState.set(element, privateState);\n\n            // Trigger input event to update validation and formatting\n            element.dispatchEvent(new Event('input', {bubbles: true}));\n            return;\n          } else {\n            // For non-separator characters, preserve cursor position after formatting\n            e.preventDefault();\n            const newValue = value.substring(0, curPos) + value.substring(curPos + 1);\n            element.value = newValue;\n\n            // Store cursor position before triggering input event\n            const privateState = this._privateState.get(element) || {};\n            privateState.preserveCursorPos = curPos;\n            this._privateState.set(element, privateState);\n\n            // Trigger input event to update validation and formatting\n            element.dispatchEvent(new Event('input', {bubbles: true}));\n            return;\n          }\n        }\n\n\n        if (e.key.length !== 1 || e.ctrlKey || e.altKey || e.metaKey ||\n          ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Escape', 'Enter'].includes(e.key)) {\n          return;\n        }\n\n        const curPos = element.selectionStart;\n        const value = element.value;\n        const {mask, separators} = instance.mask;\n\n        // Find the mask position by counting non-separator characters\n        let maskPos = 0;\n        let charCount = 0;\n\n        for (let i = 0; i < curPos && maskPos < mask.length; i++) {\n          const isSep = separators && separators.some(sep => value[i] === sep);\n          if (!isSep) {\n            charCount++;\n          }\n        }\n\n        // Find the corresponding position in mask\n        let maskCharPos = 0;\n        let nonSepCount = 0;\n        while (maskCharPos < mask.length && nonSepCount < charCount) {\n          const maskChar = mask[maskCharPos];\n          const pattern = this.config.inputPatterns[maskChar];\n          if (pattern) {\n            nonSepCount++;\n          }\n          maskCharPos++;\n        }\n\n        // Get the current mask character we're trying to fill\n        while (maskCharPos < mask.length) {\n          const maskChar = mask[maskCharPos];\n          const pattern = this.config.inputPatterns[maskChar];\n          if (pattern) {\n            // Check if the key matches this pattern\n            if (!pattern.test(e.key)) {\n              e.preventDefault();\n            }\n            return;\n          }\n          maskCharPos++;\n        }\n      },\n\n    };\n\n    EventSystemManager.addHandler(element, 'input', handlers.input);\n    EventSystemManager.addHandler(element, 'change', handlers.change);\n    EventSystemManager.addHandler(element, 'focus', handlers.focus);\n    EventSystemManager.addHandler(element, 'blur', handlers.blur);\n    EventSystemManager.addHandler(element, 'keydown', handlers.keydown);\n  }\n\n  static setupMask(instance) {\n    const {element, config} = instance;\n    let maskConfig = null;\n\n    if (config.mask && typeof config.mask === 'object') {\n      maskConfig = {...config.mask};\n    } else if (config.format && this.config.masks[config.format]) {\n      maskConfig = {...this.config.masks[config.format]};\n    } else if (config.pattern) {\n      maskConfig = {\n        mask: config.pattern,\n        placeholder: config.placeholder || config.pattern.replace(/[9A*#X]/g, this.config.placeholderChar),\n        inputMode: config.inputMode || 'text',\n      };\n    }\n\n    if (!maskConfig || !maskConfig.mask) return;\n\n    const structure = this.calculateMaskStructure(maskConfig.mask);\n    maskConfig.separators = structure.separators;\n    maskConfig.groups = structure.groups;\n    maskConfig.groupSizes = structure.groupSizes;\n\n    maskConfig.allowPartial = maskConfig.allowPartial ?? this.config.allowPartial;\n    maskConfig.format = config.format;\n\n    if (config.placeholder) {\n      maskConfig.placeholder = config.placeholder;\n    }\n    instance.mask = maskConfig;\n\n    config.formatter = (value) => {\n      const {formatted, newCursorPos} = this.formatValue(value, maskConfig);\n      element.setSelectionRange(newCursorPos, newCursorPos);\n      return formatted;\n    };\n\n    instance.validateSpecific = function(value) {\n      if (maskConfig.validator) {\n        const pattern = new RegExp(maskConfig.validator);\n        if (!pattern.test(value)) {\n          return Now.translate('Invalid value');\n        }\n      }\n      return null;\n    };\n  }\n\n  static calculateMaskStructure(maskPattern) {\n    const inputCharacters = Object.keys(this.config.inputPatterns);\n    let groups = [];\n    let currentGroup = '';\n    let separators = [];\n\n    for (let i = 0; i < maskPattern.length; i++) {\n      const char = maskPattern[i];\n      if (inputCharacters.includes(char)) {\n        currentGroup += char;\n      } else {\n        groups.push(currentGroup);\n        currentGroup = '';\n        if (i < maskPattern.length) {\n          separators.push(char);\n        }\n      }\n    }\n    if (currentGroup) {\n      groups.push(currentGroup);\n    }\n\n    const groupSizes = groups.map(group => group.length);\n\n    return {\n      separators,\n      groups,\n      groupSizes\n    };\n  }\n\n  static formatValue(value, maskConfig, previousValue = '', inputCursorPos = 0) {\n    const {mask, allowPartial, separators, groupSizes} = maskConfig;\n\n    if (!value || value.trim() === '') {\n      return {formatted: '', newCursorPos: 0};\n    }\n\n    // First, extract only the valid characters (remove separators)\n    let cleanValue = '';\n    let charsBeforeCursor = 0;\n\n    for (let i = 0; i < value.length; i++) {\n      const char = value[i];\n      const isSep = separators && separators.some(sep => sep === char);\n      if (!isSep) {\n        cleanValue += char;\n        // Count how many actual characters are before the cursor position\n        if (i < inputCursorPos) {\n          charsBeforeCursor++;\n        }\n      }\n    }\n\n    // Now format the clean value according to the mask\n    let formatted = '';\n    let markPosition = 0;\n    let cleanPos = 0;\n    let newCursorPos = 0;\n\n    let maskChar = mask[markPosition];\n    while (maskChar && cleanPos < cleanValue.length) {\n      const char = cleanValue[cleanPos];\n      const pattern = this.config.inputPatterns[maskChar];\n\n      if (pattern) {\n        // This is a character position in the mask\n        if (char && pattern.test(char)) {\n          formatted += char;\n          cleanPos++;\n\n          // If we've processed all characters that were before cursor, set cursor here\n          if (cleanPos === charsBeforeCursor) {\n            newCursorPos = formatted.length;\n          }\n        } else {\n          // Character doesn't match pattern, skip it\n          cleanPos++;\n          continue;\n        }\n      } else {\n        // This is a separator in the mask\n        formatted += maskChar;\n\n        // If we just passed the cursor position, update it to after separator\n        if (cleanPos === charsBeforeCursor && newCursorPos < formatted.length) {\n          newCursorPos = formatted.length;\n        }\n      }\n\n      markPosition++;\n      maskChar = mask[markPosition];\n    }\n\n    // If cursor wasn't set (e.g., at the end), put it at the end\n    if (newCursorPos === 0 || charsBeforeCursor >= cleanValue.length) {\n      newCursorPos = formatted.length;\n    }\n\n    return {formatted, newCursorPos};\n  }\n}\n\nclass TelElementFactory extends MaskElementFactory {\n  static config = {\n    ...MaskElementFactory.config,\n    type: 'text',\n    format: 'tel',\n    inputMode: 'tel'\n  };\n}\n\nElementManager.registerElement('mask', MaskElementFactory);\nElementManager.registerElement('tel', TelElementFactory);","class NumberElementFactory extends ElementFactory {\n  static config = {\n    type: 'text',\n    inputMode: 'decimal',\n    step: 1,\n    min: null,\n    max: null,\n    precision: 0,                // Number of decimal places\n    padToPrecision: false,       // Pad with zeros to match precision\n    useGrouping: false,          // Use thousand separators\n    groupingSeparator: ',',      // Thousand separator character\n    decimalSeparator: '.',       // Decimal point character\n    allowNegative: false,        // Allow negative values\n    roundValues: false,          // Round to precision\n    showSymbol: false,           // Show currency/unit symbol\n    symbol: '',                  // Symbol to display (e.g., '$')\n    symbolPosition: 'before',    // Symbol position ('before' or 'after')\n    negativeWithParentheses: false, // Use parentheses for negative values\n    validationMessages: {\n      required: 'Please fill in this field',\n      min: 'Value must be at least {min}',\n      max: 'Value must be no more than {max}',\n      step: 'Value must be a multiple of {step}',\n      number: 'Please enter a valid number',\n      decimal: 'Only one decimal separator is allowed',\n      negative: 'Negative sign must be at the start'\n    }\n  };\n\n  static propertyHandlers = {\n    min: {\n      get(element) {\n        const min = element.getAttribute('min');\n        return min !== null ? parseFloat(min) : null;\n      },\n      set(instance, newValue) {\n        if (newValue === null || newValue === undefined) {\n          instance.element.removeAttribute('min');\n        } else {\n          instance.element.setAttribute('min', newValue);\n        }\n      }\n    },\n    max: {\n      get(element) {\n        const max = element.getAttribute('max');\n        return max !== null ? parseFloat(max) : null;\n      },\n      set(instance, newValue) {\n        if (newValue === null || newValue === undefined) {\n          instance.element.removeAttribute('max');\n        } else {\n          instance.element.setAttribute('max', newValue);\n        }\n      }\n    },\n    step: {\n      get(element) {\n        const step = element.getAttribute('step');\n        return step !== null ? parseFloat(step) : 1;\n      },\n      set(instance, newValue) {\n        instance.element.setAttribute('step', newValue);\n      }\n    },\n    precision: {\n      get(element) {\n        const precision = element.getAttribute('precision');\n        return precision !== null ? parseFloat(precision) : 0;\n      },\n      set(instance, newValue) {\n        const oldValue = this.precision;\n        if (oldValue !== newValue) {\n          instance.element.setAttribute('precision', newValue);\n          instance.applyFormatting(instance);\n        }\n      }\n    }\n  };\n\n  static extractCustomConfig(element, def, dataset) {\n    // Use this.config as fallback instead of def (which may be empty from enhance())\n    const baseConfig = {...this.config, ...def};\n    return {\n      min: this.parseNumeric('min', element, def, dataset),\n      max: this.parseNumeric('max', element, def, dataset),\n      step: this.parseNumeric('step', element, def, dataset),\n      precision: dataset.precision !== undefined ? parseInt(dataset.precision) : baseConfig.precision,\n      decimalSeparator: dataset.decimalSeparator || baseConfig.decimalSeparator || '.',\n      groupingSeparator: dataset.groupingSeparator || baseConfig.groupingSeparator || ',',\n      useGrouping: dataset.useGrouping !== undefined ? dataset.useGrouping === 'true' : baseConfig.useGrouping,\n      allowNegative: dataset.allowNegative !== undefined ? dataset.allowNegative === 'true' : baseConfig.allowNegative,\n      roundValues: dataset.roundValues !== undefined ? dataset.roundValues === 'true' : baseConfig.roundValues,\n      padToPrecision: dataset.padToPrecision !== undefined ? dataset.padToPrecision === 'true' : baseConfig.padToPrecision\n    };\n  }\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    // Change type to text to allow formatting (thousand separators, etc.)\n    // Browser's native number input doesn't support formatted values\n    // Use getAttribute('type') because browser normalizes unknown types to 'text'\n    const originalType = element.getAttribute('type');\n    if (originalType === 'number' || originalType === 'currency') {\n      element.type = 'text';\n      element.setAttribute('inputmode', config.inputMode || 'decimal');\n    }\n\n    instance.initValue = (value) => {\n      return NumberElementFactory.formatNumber(value, config);\n    };\n\n    instance.parseNumber = function(value) {\n      return NumberElementFactory.parseNumber(value, config);\n    };\n\n    instance.formatNumber = function(value) {\n      return NumberElementFactory.formatNumber(value, config);\n    };\n\n    // Add setValue for FormManager compatibility\n    instance.setValue = (value) => {\n      if (value === undefined || value === null || value === '') {\n        element.value = '';\n        return;\n      }\n      const formatted = NumberElementFactory.formatNumber(value, config);\n      element.value = formatted;\n    };\n\n    instance.validateValue = (value, valueChange) => {\n      const {formatted, error} = this.formatValue(value, element, config);\n      return {validatedValue: formatted, error};\n    };\n\n    config.formatter = (value) => {\n      return this.formatValue(value, element, config);\n    };\n\n    return instance;\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config} = instance;\n\n    const debouncedValidate = Utils.function.debounce(() => instance.validate(undefined, false), 300);\n\n    const handlers = {\n      input: () => {\n        instance.state.modified = true;\n        debouncedValidate();\n      },\n\n      change: () => {\n        this.applyFormatting(instance);\n      },\n\n      blur: () => {\n        this.applyFormatting(instance);\n      },\n\n      focus: () => {\n        FormError.clearFieldError(element.id);\n\n        const state = ElementFactory._privateState.get(element);\n        if (state) {\n          state.formatting = true;\n\n          const parsedValue = instance.parseNumber(element.value);\n          if (!isNaN(parsedValue)) {\n            element.value = parsedValue.toString().replace('.', config.decimalSeparator);\n          }\n\n          state.formatting = false;\n        }\n      },\n\n      keydown: (e) => {\n        if (this.handleSpecialKeys(e, instance)) {\n          return;\n        }\n\n        if (!this.isAllowedKey(e, config)) {\n          e.preventDefault();\n          return false;\n        }\n      },\n\n      paste: (e) => {\n        if (!this.handlePaste(e, instance)) {\n          e.preventDefault();\n          return false;\n        }\n      }\n    };\n\n    Object.entries(handlers).forEach(([event, handler]) => {\n      EventSystemManager.addHandler(element, event, handler);\n    });\n\n    return handlers;\n  }\n\n  static applyFormatting(instance) {\n    const {element, config} = instance;\n    const value = element.value;\n\n    if (value === '') return;\n\n    const parsedValue = instance.parseNumber(value);\n    if (isNaN(parsedValue)) return;\n\n    const formatted = this.formatNumber(parsedValue, config);\n    element.value = formatted;\n  }\n\n  static handleSpecialKeys(e, instance) {\n    const {element, config} = instance;\n\n    if ([\n      'Tab', 'Enter', 'Escape', 'ArrowLeft', 'ArrowRight', 'Home', 'End',\n      'Delete', 'Backspace'\n    ].includes(e.key)) {\n      return true;\n    }\n\n    if (e.ctrlKey && ['a', 'c', 'v', 'x', 'z'].includes(e.key.toLowerCase())) {\n      return true;\n    }\n\n    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\n      e.preventDefault();\n\n      const currentValue = instance.parseNumber(element.value) || 0;\n      const step = parseFloat(config.step) || 1;\n\n      let newValue;\n      if (e.key === 'ArrowUp') {\n        newValue = Utils.number.round(currentValue + step, config.precision);\n      } else {\n        newValue = Utils.number.round(currentValue - step, config.precision);\n      }\n\n      if (config.min !== null && newValue < config.min) {\n        newValue = config.min;\n      }\n      if (config.max !== null && newValue > config.max) {\n        newValue = config.max;\n      }\n\n      const state = ElementFactory._privateState.get(element);\n      if (state) {\n        state.formatting = true;\n        element.value = String(newValue).replace('.', config.decimalSeparator);\n        state.formatting = false;\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  static isAllowedKey(e, config) {\n    const key = e.key;\n\n    if (/^\\d$/.test(key)) {\n      return true;\n    }\n\n    if (key === config.decimalSeparator &&\n      e.target.value.indexOf(config.decimalSeparator) === -1 &&\n      config.precision !== 0) {\n      return true;\n    }\n\n    if (key === '-' && config.allowNegative && e.target.selectionStart === 0 &&\n      e.target.value.indexOf('-') === -1) {\n      return true;\n    }\n\n    return false;\n  }\n\n  static handlePaste(e, instance) {\n    const {element, config} = instance;\n\n    const clipboardData = e.clipboardData || window.clipboardData;\n    const pastedText = clipboardData.getData('text');\n\n    const currentValue = element.value;\n    const selectionStart = element.selectionStart;\n    const selectionEnd = element.selectionEnd;\n\n    const newValue = currentValue.substring(0, selectionStart) +\n      pastedText +\n      currentValue.substring(selectionEnd);\n\n    const decimalSeparatorCount = (newValue.match(new RegExp(`\\\\${config.decimalSeparator}`, 'g')) || []).length;\n    if (decimalSeparatorCount > 1 || (config.precision === 0 && decimalSeparatorCount > 0)) {\n      return false;\n    }\n\n    if (config.allowNegative) {\n      const minusCount = (newValue.match(/-/g) || []).length;\n      if (minusCount > 1 || (minusCount === 1 && newValue.indexOf('-') !== 0)) {\n        return false;\n      }\n    } else if (newValue.includes('-')) {\n      return false;\n    }\n\n    const validPattern = config.allowNegative ?\n      new RegExp(`^-?\\\\d*\\\\${config.decimalSeparator}?\\\\d*$`) :\n      new RegExp(`^\\\\d*\\\\${config.decimalSeparator}?\\\\d*$`);\n\n    if (!validPattern.test(newValue)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  static formatNumber(value, config) {\n    if (value === '' || value === null || value === undefined) {\n      return '';\n    }\n\n    let number = typeof value === 'number' ? value : this.parseNumber(value, config);\n    if (isNaN(number)) {\n      return typeof value === 'string' ? value : '';\n    }\n\n    const isNegative = number < 0;\n    number = Math.abs(number);\n\n    // Only round if roundValues is explicitly true\n    if (config.roundValues === true && config.precision >= 0) {\n      number = Utils.number.round(number, config.precision);\n    }\n\n    // Use toFixed only when roundValues is true, otherwise preserve full number\n    let numStr = (config.roundValues === true && config.precision >= 0)\n      ? number.toFixed(config.precision)\n      : number.toString();\n    let [intPart, decPart = ''] = numStr.split('.');\n\n    if (config.roundValues !== true && config.precision > 0 && decPart) {\n      decPart = decPart.substring(0, config.precision);\n    } else if (config.precision === 0) {\n      decPart = '';\n    }\n\n    if (config.padToPrecision && config.precision > 0) {\n      decPart = (decPart || '').padEnd(config.precision, '0');\n    }\n\n    let formattedIntPart = intPart;\n    if (config.useGrouping) {\n      const separator = config.groupingSeparator || ',';\n      let grouped = '';\n      for (let i = 0; i < formattedIntPart.length; i++) {\n        if (i > 0 && (formattedIntPart.length - i) % 3 === 0) {\n          grouped += separator;\n        }\n        grouped += formattedIntPart[i];\n      }\n      formattedIntPart = grouped;\n    }\n\n    let formatted = formattedIntPart;\n    if ((decPart || config.padToPrecision) && config.precision > 0) {\n      const decSeparator = config.decimalSeparator || '.';\n      formatted += decSeparator + decPart;\n    }\n    if (config.showSymbol && config.symbol) {\n      formatted = config.symbolPosition === 'before' ? `${config.symbol}${formatted}` : `${formatted}${config.symbol}`;\n    }\n\n    if (isNegative) {\n      formatted = config.negativeWithParentheses ? `(${formatted})` : `-${formatted}`;\n    }\n\n    return formatted;\n  }\n\n  static formatValue(value, element, config) {\n    let error = null;\n\n    if (value === '' || value === null || value === undefined) {\n      if (element.hasAttribute('required')) {\n        error = Now.translate('Please fill in');\n      }\n      return {formatted: '', error};\n    }\n\n    let number = this.parseNumber(value, config);\n    if (isNaN(number)) {\n      return {formatted: value, error: Now.translate('Please enter a valid number')};\n    }\n\n    if (!config.allowNegative && number < 0) {\n      error = Now.translate('Unable to have negative values');\n      number = Math.abs(number);\n    }\n\n    const min = parseFloat(element.min);\n    const max = parseFloat(element.max);\n\n    if (min !== null && number < min) {\n      error = Now.translate('Value must be at least {min}', {min});\n      number = min;\n    }\n    if (max !== null && number > max) {\n      error = Now.translate('Value must be no more than {max}', {max});\n      number = max;\n    }\n\n\n    const formatted = this.formatNumber(number, config);\n    return {formatted, error};\n  }\n\n  static parseNumber(value, config) {\n    if (typeof value === 'number') {\n      return isNaN(value) ? NaN : value;\n    }\n    if (value === '' || value === null || value === undefined) return NaN;\n\n    let strValue = String(value);\n    strValue = strValue.replace(config.decimalSeparator, '.')\n      .replace(/[^0-9\\.\\-\\(\\)]+/g, '');\n\n    if (strValue.startsWith('(') && strValue.endsWith(')')) {\n      strValue = '-' + strValue.substring(1, strValue.length - 1);\n    }\n\n    return Number(strValue);\n  }\n}\n\nclass CurrencyElementFactory extends NumberElementFactory {\n  static config = {\n    ...NumberElementFactory.config,\n    precision: 2,                // 2 decimal places for currency\n    padToPrecision: true,        // Always show 2 decimal places\n    roundValues: true,           // Round to 2 decimal places\n    showSymbol: false,           // Don't show currency symbol by default\n    symbol: '',                  // No default currency symbol\n    symbolPosition: 'before',    // Symbol before number\n    allowNegative: true,         // Allow negative values\n    useGrouping: true,           // Use thousand separators\n    groupingSeparator: ',',      // Thousand separator\n    decimalSeparator: '.',       // Decimal separator\n    negativeWithParentheses: false, // Don't use parentheses for negative\n    inputMode: 'decimal'         // Use decimal keyboard on mobile\n  };\n}\n\nElementManager.registerElement('number', NumberElementFactory);\nElementManager.registerElement('currency', CurrencyElementFactory);\n","class SelectElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    multiple: false,\n    size: 1,\n    typeToFilter: true,\n    searchMethod: 'prefix',     //'Prefix' or 'Contains'\n    searchResetDelay: 1000,     //When resetting the search term (MS)\n    showSearchStatus: false,    //Show search status\n    useOptGroups: false,        //Do you use OPTGRUP?\n    allowPlaceholderSelection: false, //Is it allowed to select Placeholder?\n    optimizeRendering: true,    //Improve the performance of many options\n    ariaLabelledBy: null,       //ID of Element that will be used as Aria-labelledby\n    emptyMessage: 'No options available', // Message when there is no option\n    customTemplate: null,       // Functions for determining the display form, options\n    validationMessages: {\n      required: 'Please select an option'\n    }\n  };\n\n  static propertyHandlers = {\n    value: {\n      get(element) {\n        return element.multiple\n          ? Array.from(element.selectedOptions).map(o => o.value)\n          : element.value;\n      },\n      set(instance, newValue) {\n        const {element} = instance;\n        if (newValue == null || newValue === '') {\n          element.selectedIndex = element.querySelector('option[value=\"\"]') ? 0 : -1;\n        } else if (element.multiple && Array.isArray(newValue)) {\n          Array.from(element.options).forEach(opt => {\n            opt.selected = newValue.includes(opt.value);\n          });\n        } else {\n          element.value = String(newValue);\n        }\n        // Sync custom dropdown if exists\n        instance.constructor.syncCustomDropdown?.(instance);\n      }\n    },\n\n    options: {\n      get(element) {\n        return Array.from(element.options).map(opt => ({\n          value: opt.value,\n          text: opt.textContent,\n          selected: opt.selected,\n          disabled: opt.disabled\n        }));\n      },\n      set(instance, newValue) {\n        this.updateOptions(instance.element, newValue, instance.config.useOptGroups);\n      }\n    },\n\n    selectedOption: {\n      get(element) {\n        if (element.multiple) {\n          return Array.from(element.selectedOptions).map(opt => ({\n            value: opt.value,\n            text: opt.textContent,\n            index: opt.index\n          }));\n        }\n        const option = element.options[element.selectedIndex];\n        return option ? {value: option.value, text: option.textContent, index: element.selectedIndex} : null;\n      },\n      set(instance, newValue) {\n        if (!newValue) return;\n\n        const {element} = instance;\n        if (Array.isArray(newValue) && element.multiple) {\n          // Reset all selections\n          Array.from(element.options).forEach(opt => opt.selected = false);\n\n          // Set new selections\n          newValue.forEach(item => {\n            const value = typeof item === 'object' ? item.value : item;\n            const option = Array.from(element.options).find(opt => opt.value === value);\n            if (option) option.selected = true;\n          });\n        } else {\n          const value = typeof newValue === 'object' ? newValue.value : newValue;\n          element.value = value;\n        }\n\n        // Trigger change event\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n      }\n    }\n  };\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    // Set basic values ​​for select element;\n    if (config.multiple) element.multiple = true;\n    if (config.size > 1) element.size = config.size;\n\n    // Add accessibility attributes\n    if (!element.hasAttribute('aria-label') && !element.hasAttribute('aria-labelledby')) {\n      if (config.ariaLabelledBy) {\n        element.setAttribute('aria-labelledby', config.ariaLabelledBy);\n      } else if (config.label) {\n        element.setAttribute('aria-label', Now.translate(config.label));\n        element.dataset.ariaI18n = config.label;\n      }\n    }\n\n    // Add empty option with placeholder (if placeholder is set)\n    if (config.placeholder && (!config.multiple || config.allowPlaceholderSelection)) {\n      const placeholder = document.createElement('option');\n      placeholder.value = '';\n      placeholder.textContent = Now.translate(config.placeholder);\n      placeholder.dataset.i18n = config.placeholder;\n\n      if (!config.allowPlaceholderSelection) {\n        placeholder.disabled = true;\n      }\n\n      placeholder.selected = true;\n      element.appendChild(placeholder);\n    }\n\n    // Add options from provided data\n    if (config.options) {\n      this.updateOptions(element, config.options, config.useOptGroups);\n    }\n\n    // Load options from URL if specified\n    if (config.url) {\n      this.loadOptions(instance, config.url, config.params);\n    }\n\n    // Add type-to-filter capability\n    if (config.typeToFilter) {\n      this.setupTypeToFilter(instance);\n    }\n\n    // Add method for updating options\n    instance.updateOptions = function(options) {\n      SelectElementFactory.updateOptions(element, options, config.useOptGroups);\n    };\n\n    // Add method for loading options from URL\n    instance.loadOptions = function(url, params) {\n      return SelectElementFactory.loadOptions(instance, url, params);\n    };\n\n    // Add method for clearing options\n    instance.clearOptions = function() {\n      SelectElementFactory.clearOptions(element, config.placeholder);\n    };\n\n    // Add method for selecting option by value\n    instance.selectByValue = function(value) {\n      element.value = value;\n      element.dispatchEvent(new Event('change', {bubbles: true}));\n    };\n\n    // Add method for selecting option by index\n    instance.selectByIndex = function(index) {\n      if (index >= 0 && index < element.options.length) {\n        element.selectedIndex = index;\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n      }\n    };\n\n    // Wire up change -> config.onChange so factories and manual listeners behave consistently\n    try {\n      this.setupChangeHandler(instance);\n    } catch (e) {\n      // ignore\n    }\n\n    // Add method for validating\n    instance.validateSpecific = function(value) {\n      if (this.element.required && (!value || value === '')) {\n        return Now.translate(this.config.validationMessages?.required || 'This field is required');\n      }\n      return null;\n    };\n\n    // Add method for updating specific options\n    instance.updateOptionAt = function(index, properties) {\n      if (index >= 0 && index < element.options.length) {\n        const option = element.options[index];\n        if (properties.text) {\n          option.textContent = properties.text;\n        }\n        if (typeof properties.disabled !== 'undefined') {\n          option.disabled = properties.disabled;\n        }\n        if (typeof properties.selected !== 'undefined') {\n          option.selected = properties.selected;\n        }\n        if (properties.value) {\n          option.value = properties.value;\n        }\n      }\n    };\n\n    return instance;\n  }\n\n  static setupTypeToFilter(instance) {\n    const {element, config} = instance;\n\n    let searchTerm = '';\n    let searchTimeout;\n    let searchStatusElement = null;\n\n    // If showing search status is enabled, create a DOM element to display it\n    if (config.showSearchStatus) {\n      searchStatusElement = document.createElement('div');\n      searchStatusElement.className = 'select-search-status';\n      searchStatusElement.style.display = 'none';\n      searchStatusElement.setAttribute('aria-live', 'polite');\n      searchStatusElement.setAttribute('role', 'status');\n\n      // Insert after select element\n      if (element.parentNode) {\n        element.parentNode.insertBefore(searchStatusElement, element.nextSibling);\n      }\n\n      instance.searchStatusElement = searchStatusElement;\n    }\n\n    const handleSearch = (e) => {\n      // Ignore special keys like Arrow, Enter, Tab\n      if (e.key.length === 1 || e.key === 'Backspace') {\n        if (e.key === 'Backspace') {\n          // Remove last character\n          searchTerm = searchTerm.slice(0, -1);\n        } else {\n          // Add typed character\n          searchTerm += e.key.toLowerCase();\n        }\n\n        // Reset search timeout\n        clearTimeout(searchTimeout);\n\n        // Find options matching searchTerm\n        const options = Array.from(element.options).filter(opt =>\n          !opt.disabled &&\n          opt.parentElement.tagName !== 'OPTGROUP' ||\n          !opt.parentElement.disabled\n        );\n\n        if (options.length === 0) return;\n\n        // Choose search method: prefix, contains, or fuzzy\n        const searchMethod = config.searchMethod || 'prefix';\n\n        const matchingOption = options.find(opt => {\n          const text = opt.text.toLowerCase();\n          if (searchMethod === 'prefix') {\n            return text.startsWith(searchTerm);\n          } else if (searchMethod === 'contains') {\n            return text.includes(searchTerm);\n          } else if (searchMethod === 'fuzzy') {\n            // Fuzzy matching algorithm: find characters appearing in order\n            let j = 0;\n            for (let i = 0; i < text.length && j < searchTerm.length; i++) {\n              if (text[i] === searchTerm[j]) j++;\n            }\n            return j === searchTerm.length;\n          }\n          return text.startsWith(searchTerm); // default\n        });\n\n        if (matchingOption) {\n          // Select the option matching the search\n          element.value = matchingOption.value;\n\n          // Scroll the option into view (for multiple or size > 1 select)\n          if (element.size > 1 || element.multiple) {\n            const index = Array.from(element.options).indexOf(matchingOption);\n            if (matchingOption.scrollIntoView) {\n              matchingOption.scrollIntoView({block: 'nearest'});\n            }\n          }\n\n          // Dispatch change event\n          element.dispatchEvent(new Event('change', {bubbles: true}));\n\n          // Show search status (if enabled)\n          if (config.showSearchStatus && searchStatusElement) {\n            searchStatusElement.textContent = `${Now.translate('Searching')}: ${searchTerm}`;\n            searchStatusElement.style.display = 'block';\n          }\n        }\n\n        // Clear searchTerm after a period of no key presses\n        searchTimeout = setTimeout(() => {\n          searchTerm = '';\n\n          if (config.showSearchStatus && searchStatusElement) {\n            searchStatusElement.style.display = 'none';\n          }\n        }, config.searchResetDelay);\n      }\n    };\n\n    // Register event handler appropriately\n    EventSystemManager.addHandler(element, 'keydown', handleSearch);\n\n    // Store reference to handler for later removal\n    instance._typeToFilterHandler = handleSearch;\n  }\n\n  static async loadOptions(instance, url, params = {}) {\n    const {element, config} = instance;\n\n    try {\n      // Add loading class and disable element during loading\n      element.disabled = true;\n      if (instance.wrapper) {\n        instance.wrapper.classList.add('loading');\n      }\n\n      // Show loading message\n      if (element.parentNode && config.loadingMessage) {\n        const loadingOption = document.createElement('option');\n        loadingOption.disabled = true;\n        loadingOption.selected = true;\n        loadingOption.textContent = Now.translate(config.loadingMessage || 'Loading...');\n\n        // Save original options\n        const originalHTML = element.innerHTML;\n        element.innerHTML = '';\n        element.appendChild(loadingOption);\n\n        // Restore original options on error\n        instance._originalOptions = originalHTML;\n      }\n\n      // Specify desired response type and send parameters\n      const requestConfig = {\n        params,\n        headers: {\n          'Accept': 'application/json'\n        }\n      };\n\n      const apiService = window.ApiService || window.Now?.getManager?.('api');\n      let response;\n      if (apiService?.get) {\n        response = await apiService.get(url, params, {headers: requestConfig.headers});\n      } else if (typeof simpleFetch !== 'undefined' && simpleFetch.get) {\n        const queryParams = new URLSearchParams(params).toString();\n        const fullUrl = queryParams ? `${url}?${queryParams}` : url;\n        response = await simpleFetch.get(fullUrl, {headers: requestConfig.headers});\n      } else if (typeof http !== 'undefined' && http.get) {\n        response = await http.get(url, requestConfig);\n      } else {\n        throw new Error('ApiService is not available');\n      }\n\n      // Update options from received data\n      if (response.data) {\n        this.updateOptions(element, response.data, config.useOptGroups);\n      }\n\n      // Set initial value (if any)\n      const initialValue = element.dataset.value;\n      if (initialValue) {\n        element.value = initialValue;\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n      }\n\n      return response.data;\n    } catch (error) {\n      // Show error message\n      if (typeof ErrorManager !== 'undefined') {\n        ErrorManager.handle(error, {\n          context: 'SelectElementFactory.loadOptions',\n          type: 'error:select',\n          data: {\n            elementId: element.id,\n            url,\n            params\n          },\n          notify: true\n        });\n      } else if (window.NotificationManager) {\n        NotificationManager.error('Failed to load options');\n      }\n\n      // Restore original options\n      if (instance._originalOptions) {\n        element.innerHTML = instance._originalOptions;\n        delete instance._originalOptions;\n      }\n\n      return null;\n    } finally {\n      // Enable element and remove loading class\n      element.disabled = false;\n      if (instance.wrapper) {\n        instance.wrapper.classList.remove('loading');\n      }\n    }\n  }\n\n  static updateOptions(element, options, useOptGroups = false) {\n    // Store current value\n    const currentValue = element.value;\n    const hasPlaceholder = element.querySelector('option[value=\"\"][disabled]');\n    const isMultiple = element.multiple;\n\n    // Store placeholder option\n    const placeholderHTML = hasPlaceholder ? element.querySelector('option[value=\"\"][disabled]').outerHTML : '';\n\n    // Clear existing options\n    element.innerHTML = placeholderHTML;\n\n    // Handle case with no data\n    if (!options || (Array.isArray(options) && options.length === 0) ||\n      (typeof options === 'object' && Object.keys(options).length === 0)) {\n      const emptyOption = document.createElement('option');\n      emptyOption.disabled = true;\n      emptyOption.textContent = Now.translate('No options available');\n\n      if (!placeholderHTML) {\n        element.appendChild(emptyOption);\n      }\n\n      return;\n    }\n\n    // Accept Array, Map or plain Object for options.\n    // Prefer array form to preserve ordering. If a plain object is provided,\n    // convert it into an ordered array. Ensure that an empty-string key ('')\n    // (commonly used for \"All\"/placeholder) appears first to avoid JS\n    // integer-like key ordering quirks.\n    const normalizeToArray = (opts) => {\n      // If already an array, return as-is\n      if (Array.isArray(opts)) return opts;\n\n      // If Map, convert preserving insertion order\n      if (opts instanceof Map) {\n        const arr = [];\n        for (const [k, v] of opts.entries()) {\n          if (typeof v === 'object') {\n            arr.push({value: k, text: v.text || v.label || v});\n          } else {\n            arr.push({value: k, text: v});\n          }\n        }\n        return arr;\n      }\n\n      // Plain object: build array, placing '' key first if present,\n      // then non-integer-like keys in insertion order, then integer-like keys sorted numerically.\n      if (typeof opts === 'object' && opts !== null) {\n        const entries = Object.entries(opts || {});\n        const emptyEntry = entries.find(([k]) => k === '');\n        const nonInt = [];\n        const ints = [];\n\n        entries.forEach(([k, v]) => {\n          if (k === '') return; // handled separately\n          if (/^\\d+$/.test(k)) {\n            ints.push([k, v]);\n          } else {\n            nonInt.push([k, v]);\n          }\n        });\n\n        // sort integer-like keys numerically to keep a stable order\n        ints.sort((a, b) => parseInt(a[0], 10) - parseInt(b[0], 10));\n\n        const arr = [];\n        if (emptyEntry) arr.push({value: '', text: emptyEntry[1]});\n\n        nonInt.forEach(([k, v]) => arr.push({value: k, text: v}));\n        ints.forEach(([k, v]) => arr.push({value: k, text: v}));\n\n        return arr;\n      }\n\n      return [];\n    };\n\n    const normalizedOptions = normalizeToArray(options);\n\n    if (normalizedOptions.length === 0) {\n      // no options -> show empty message / placeholder preserved earlier\n      const emptyOption = document.createElement('option');\n      emptyOption.disabled = true;\n      emptyOption.textContent = Now.translate('No options available');\n\n      if (!placeholderHTML) {\n        element.appendChild(emptyOption);\n      }\n      return;\n    }\n\n    // If normalizedOptions looks like groups (objects with .options), reuse createOptGroups\n    if (useOptGroups && this.hasOptGroups(normalizedOptions)) {\n      this.createOptGroups(element, normalizedOptions);\n    } else {\n      normalizedOptions.forEach(opt => this.createOption(element, opt));\n    }\n\n    // Restore original value (if any)\n    if (currentValue && !isMultiple) {\n      // Check if the option still exists - use loose equality to handle type coercion\n      const optionExists = Array.from(element.options).some(opt =>\n        opt.value == currentValue || String(opt.value) === String(currentValue)\n      );\n      if (optionExists) {\n        element.value = currentValue;\n      }\n    } else if (isMultiple && Array.isArray(currentValue)) {\n      // Handle multiple select case\n      const values = Array.isArray(currentValue) ? currentValue : [currentValue];\n      values.forEach(value => {\n        // Use loose equality to handle type coercion\n        const option = Array.from(element.options).find(opt =>\n          opt.value == value || String(opt.value) === String(value)\n        );\n        if (option) {\n          option.selected = true;\n        }\n      });\n    }\n\n    // Emit event to notify that options have changed\n    element.dispatchEvent(new CustomEvent('optionschanged', {\n      bubbles: true,\n      detail: {options}\n    }));\n  }\n\n  static clearOptions(element, keepPlaceholder = true) {\n    if (keepPlaceholder) {\n      const placeholder = element.querySelector('option[value=\"\"][disabled]');\n      element.innerHTML = placeholder ? placeholder.outerHTML : '';\n    } else {\n      element.innerHTML = '';\n    }\n\n    // Emit event\n    element.dispatchEvent(new CustomEvent('optionschanged', {\n      bubbles: true,\n      detail: {options: []}\n    }));\n  }\n\n  static hasOptGroups(options) {\n    return options.some(opt => typeof opt === 'object' && opt.options);\n  }\n\n  static createOptGroups(element, groups) {\n    let fragment;\n\n    // Use DocumentFragment for performance with many options\n    if (groups.length > 50) {\n      fragment = document.createDocumentFragment();\n    }\n\n    // Create optgroups and options\n    groups.forEach(group => {\n      if (typeof group === 'object' && group.options) {\n        // Create optgroup\n        const optgroup = document.createElement('optgroup');\n        optgroup.label = Now.translate(group.label);\n        if (group.disabled) optgroup.disabled = true;\n\n        // Create options in optgroup\n        if (Array.isArray(group.options)) {\n          group.options.forEach(opt => {\n            this.createOption(optgroup, opt);\n          });\n        }\n\n        if (fragment) {\n          fragment.appendChild(optgroup);\n        } else {\n          element.appendChild(optgroup);\n        }\n      } else {\n        // Handle case where it's not an optgroup, create regular option\n        if (fragment) {\n          this.createOption(fragment, group);\n        } else {\n          this.createOption(element, group);\n        }\n      }\n    });\n\n    // Append fragment to element (if any)\n    if (fragment) {\n      element.appendChild(fragment);\n    }\n  }\n\n  static createOption(parent, opt) {\n    const option = document.createElement('option');\n\n    if (typeof opt === 'object') {\n      option.value = opt.value !== undefined ? opt.value : '';\n      option.textContent = Now.translate(opt.text || opt.label || opt.value || '');\n\n      if (opt.text || opt.label) option.dataset.i18n = opt.text || opt.label;\n      if (opt.disabled) option.disabled = true;\n      if (opt.selected) option.selected = true;\n      if (opt.data) {\n        Object.entries(opt.data).forEach(([key, value]) => {\n          option.dataset[key] = value;\n        });\n      }\n      if (opt.className) option.className = opt.className;\n    } else {\n      option.value = opt;\n      option.textContent = Now.translate(opt);\n      option.dataset.i18n = opt;\n    }\n\n    parent.appendChild(option);\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config} = instance;\n\n    // Get parent's event handlers\n    const parentHandlers = super.setupEventListeners(instance);\n\n    // Add event handler for locale change (to update placeholder and options with i18n)\n    const updateTranslations = () => {\n      Array.from(element.options).forEach(option => {\n        if (option.dataset.i18n) {\n          option.textContent = Now.translate(option.dataset.i18n);\n        }\n      });\n\n      // Update aria-label\n      if (element.dataset.ariaI18n) {\n        element.setAttribute('aria-label', Now.translate(element.dataset.ariaI18n));\n      }\n    };\n\n    // Register event handler\n    if (window.EventManager) {\n      EventManager.on('locale:changed', updateTranslations);\n    }\n\n    // Store handler for cleanup\n    instance._localeChangeHandler = updateTranslations;\n\n    return parentHandlers;\n  }\n\n  // Ensure onChange config is invoked when the select value changes\n  static setupChangeHandler(instance) {\n    const {element, config} = instance;\n    try {\n      EventSystemManager.addHandler(element, 'change', (e) => {\n        try {\n          if (config && typeof config.onChange === 'function') {\n            const value = element.multiple ? Array.from(element.selectedOptions).map(o => o.value) : element.value;\n            config.onChange(element, value);\n          }\n        } catch (err) {\n          console.warn('SelectElementFactory onChange handler error', err);\n        }\n      });\n    } catch (err) {\n      // non-fatal\n    }\n  }\n\n  static customValidateValue(value, valueChange) {\n    const element = this.element;\n\n    // If it is a multiple select\n    if (element.multiple) {\n      const selectedOptions = Array.from(element.selectedOptions);\n      if (element.required && selectedOptions.length === 0) {\n        return {\n          validatedValue: value,\n          error: Now.translate(this.config.validationMessages.required)\n        };\n      }\n    } else if (element.required && (!value || value === '')) {\n      return {\n        validatedValue: value,\n        error: Now.translate(this.config.validationMessages.required)\n      };\n    }\n\n    return {\n      validatedValue: value,\n      error: null\n    };\n  }\n\n  static create(def) {\n    def.tagName = 'select';\n    return super.create(def);\n  }\n\n  static cleanup(instance) {\n    if (!instance) return;\n\n    const {element} = instance;\n\n    if (instance._typeToFilterHandler) {\n      EventSystemManager.removeHandler(element, 'keydown', instance._typeToFilterHandler);\n    }\n\n    if (instance._localeChangeHandler && window.EventManager) {\n      EventManager.off('locale:changed', instance._localeChangeHandler);\n    }\n\n    if (instance.searchStatusElement && instance.searchStatusElement.parentNode) {\n      instance.searchStatusElement.parentNode.removeChild(instance.searchStatusElement);\n    }\n\n    super.cleanup?.(instance);\n  }\n\n  /**\n   * Populate select element from provided options object\n   * Used when options are provided by modal response or parent context\n   * @param {HTMLSelectElement} element - Select element\n   * @param {Object} optionsData - Options data object (e.g., {provinces: [...], genders: [...]})\n   * @param {String} optionsKey - Key to extract from optionsData (e.g., 'provinces')\n   * @static\n   */\n  static populateFromOptions(element, optionsData, optionsKey) {\n    if (!element || !optionsData || !optionsKey) return;\n\n    let options = optionsData[optionsKey];\n    if (!options) return;\n\n    // Validate options format (must be Array)\n    if (!Array.isArray(options)) {\n      console.warn('Please update your API to return options in format: [{value: \"1\", text: \"Option 1\"}, ...]');\n      return;\n    }\n\n    // Validate array items have correct format\n    const hasInvalidItems = options.some(opt =>\n      typeof opt !== 'object' || !('value' in opt) || !('text' in opt)\n    );\n\n    if (hasInvalidItems) return;\n\n    // Save current value before updating options\n    const currentValue = element.value;\n\n    // Update element's options using existing updateOptions method\n    this.updateOptions(element, options, element.dataset.useOptGroups === 'true');\n\n    // Restore value after populating options\n    if (currentValue) {\n      // Use loose equality (==) to handle type coercion (e.g., 10 == \"10\")\n      // or convert to string for strict comparison to avoid type mismatch issues\n      const optionExists = Array.from(element.options).some(opt =>\n        opt.value == currentValue || String(opt.value) === String(currentValue)\n      );\n      if (optionExists) {\n        element.value = currentValue;\n      }\n    }\n  }\n\n  /**\n   * Populate all select elements with data-options-key attribute from provided options object\n   * @param {HTMLElement} container - Container element (form, modal, etc.)\n   * @param {Object} optionsData - Options data object\n   * @static\n   */\n  static populateFromOptionsInContainer(container, optionsData) {\n    if (!container || !optionsData) return;\n\n    // Select only single selects (not multiple)\n    const selectsWithOptionsKey = container.querySelectorAll('select[data-options-key]:not([multiple])');\n\n    selectsWithOptionsKey.forEach(select => {\n      const optionsKey = select.dataset.optionsKey;\n      this.populateFromOptions(select, optionsData, optionsKey);\n    });\n  }\n}\n\n// Register element with ElementManager\nElementManager.registerElement('select', SelectElementFactory);\n\n// Expose globally\nwindow.SelectElementFactory = SelectElementFactory;\n","const CascadingSelectManager = {\n  config: {\n    loadingClass: 'loading',\n    ajaxDelay: 300,\n    defaultOption: true,\n    defaultOptionText: 'Please select...',\n    autoLoad: true,\n    autoDisable: true,\n    placeholders: {},\n    debug: false\n  },\n\n  state: {\n    instances: new Map(),\n    requests: new Map(),\n    initialized: false\n  },\n\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n\n    // Initialize any existing cascading selects with data-cascade attribute\n    document.querySelectorAll('[data-cascade]').forEach(select => {\n      this.create(select);\n    });\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  /**\n   * Initialize cascading selects within a form container\n   * Called by FormManager after form initialization\n   * @param {HTMLElement} container - Form element or container\n   */\n  initInContainer(container) {\n    if (!container) return;\n\n    // Method 1: Find selects with data-cascade-group and group them\n    const groups = new Map();\n    container.querySelectorAll('select[data-cascade-group]').forEach(select => {\n      const groupName = select.dataset.cascadeGroup;\n      if (!groups.has(groupName)) {\n        groups.set(groupName, []);\n      }\n      groups.get(groupName).push(select);\n    });\n\n    // Create cascade instances for each group\n    groups.forEach((selects, groupName) => {\n      // Sort by data-cascade-order if present, otherwise by DOM order\n      selects.sort((a, b) => {\n        const orderA = parseInt(a.dataset.cascadeOrder || '0');\n        const orderB = parseInt(b.dataset.cascadeOrder || '0');\n        return orderA - orderB;\n      });\n\n      // Extract options from first select with URL\n      const firstWithUrl = selects.find(s => s.dataset.cascadeUrl || s.dataset.cascadeAction);\n      if (firstWithUrl) {\n        const dataOptions = this.extractDataOptions(firstWithUrl);\n        this.create(selects, dataOptions);\n      }\n    });\n\n    // Method 2: Find selects with data-cascade-parent (linked cascade)\n    // Build cascade chains from parent-child relationships\n    const chainedSelects = container.querySelectorAll('select[data-cascade-parent]');\n    if (chainedSelects.length > 0) {\n      // Find all roots (selects that are parents but have no parent themselves)\n      const childNames = new Set();\n      const parentNames = new Set();\n\n      chainedSelects.forEach(select => {\n        const parentName = select.dataset.cascadeParent;\n        childNames.add(select.name || select.id);\n        parentNames.add(parentName);\n      });\n\n      // Root parents are those in parentNames but not in childNames\n      const rootParentNames = [...parentNames].filter(name => !childNames.has(name));\n\n      // For each root, build the cascade chain\n      rootParentNames.forEach(rootName => {\n        const chain = [];\n        const rootSelect = container.querySelector(`select[name=\"${rootName}\"], select#${rootName}`);\n        if (!rootSelect) return;\n\n        chain.push(rootSelect);\n\n        // Build chain by following parent-child relationships\n        let currentName = rootName;\n        let safetyCounter = 0;\n        while (safetyCounter++ < 10) { // Prevent infinite loops\n          const child = container.querySelector(`select[data-cascade-parent=\"${currentName}\"]`);\n          if (!child) break;\n          chain.push(child);\n          currentName = child.name || child.id;\n        }\n\n        // Get URL from first child with data-cascade-url\n        const firstWithUrl = chain.find(s => s.dataset.cascadeUrl || s.dataset.cascadeAction);\n        if (firstWithUrl && chain.length > 1) {\n          const dataOptions = this.extractDataOptions(firstWithUrl);\n          this.create(chain, dataOptions);\n        }\n      });\n    }\n  },\n\n  create(selects, options = {}) {\n    // Allow array of selects, single select element, or string selector\n    let selectElements = [];\n\n    if (Array.isArray(selects)) {\n      // Array of IDs or elements\n      selectElements = selects.map(item =>\n        typeof item === 'string' ? document.getElementById(item) : item\n      ).filter(el => el);\n    } else if (typeof selects === 'string') {\n      // Single ID or selector\n      if (selects.includes(',')) {\n        // Comma-separated list of IDs\n        selectElements = selects.split(',')\n          .map(id => document.getElementById(id.trim()))\n          .filter(el => el);\n      } else if (selects.startsWith('#')) {\n        // Single ID selector\n        const element = document.getElementById(selects.substring(1));\n        if (element) selectElements.push(element);\n      } else {\n        // Query selector for multiple elements\n        selectElements = Array.from(document.querySelectorAll(selects));\n      }\n    } else if (selects instanceof HTMLElement) {\n      // Single element\n      selectElements.push(selects);\n    }\n\n    if (selectElements.length === 0) {\n      if (this.config.debug) {\n        console.warn('CascadingSelectManager: No select elements found');\n      }\n      return null;\n    }\n\n    // Extract data attributes from first select\n    const dataOptions = this.extractDataOptions(selectElements[0]);\n\n    // Combine configs: default < data attributes < options parameter\n    const config = {...this.config, ...dataOptions, ...options};\n\n    // Ensure we have an action URL\n    if (!config.action && !config.url) {\n      if (this.config.debug) {\n        console.warn('CascadingSelectManager: No action URL specified');\n      }\n      return null;\n    }\n\n    // Create group ID for this set of selects\n    const groupId = config.groupId || `cascade_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\n\n    // Create cascade instance\n    const instance = {\n      id: groupId,\n      elements: selectElements,\n      config: config,\n      state: {\n        loading: false,\n        initialized: false,\n        values: {}\n      }\n    };\n\n    // Store instance\n    this.state.instances.set(groupId, instance);\n\n    // Setup each select element\n    selectElements.forEach((select, index) => {\n      // Store original options for the first select\n      if (index === 0) {\n        this.storeOriginalOptions(select);\n      }\n\n      // Set element properties\n      select.dataset.cascadeGroup = groupId;\n      select.dataset.cascadeIndex = index;\n\n      // Store reference on the element\n      select.cascadeInstance = instance;\n\n      // Clear all options except the first select\n      if (index > 0 && config.autoLoad) {\n        this.clearOptions(select, config);\n\n        // Disable non-first selects initially\n        if (config.autoDisable) {\n          select.disabled = true;\n        }\n      }\n\n      // Setup event handlers\n      this.setupSelectEvents(select, instance);\n    });\n\n    // Mark instance as initialized\n    instance.state.initialized = true;\n\n    // Auto-trigger the first select if it has a value\n    const firstSelect = selectElements[0];\n    if (config.autoLoad && firstSelect.value) {\n      this.loadOptions(firstSelect);\n    }\n\n    return instance;\n  },\n\n  extractDataOptions(select) {\n    const options = {};\n    const dataset = select.dataset;\n\n    if (dataset.cascadeAction) {\n      options.action = dataset.cascadeAction;\n    } else if (dataset.cascadeUrl) {\n      options.url = dataset.cascadeUrl;\n    }\n\n    if (dataset.cascadeParam) {\n      options.paramName = dataset.cascadeParam;\n    }\n\n    if (dataset.cascadeMethod) {\n      options.method = dataset.cascadeMethod.toUpperCase();\n    }\n\n    if (dataset.cascadeDefault !== undefined) {\n      options.defaultOption = dataset.cascadeDefault === 'true';\n    }\n\n    if (dataset.cascadeDefaultText) {\n      options.defaultOptionText = dataset.cascadeDefaultText;\n    }\n\n    if (dataset.cascadeAutoLoad !== undefined) {\n      options.autoLoad = dataset.cascadeAutoLoad === 'true';\n    }\n\n    if (dataset.cascadeDisable !== undefined) {\n      options.autoDisable = dataset.cascadeDisable === 'true';\n    }\n\n    if (dataset.cascadeCallback) {\n      if (typeof window[dataset.cascadeCallback] === 'function') {\n        options.onchange = window[dataset.cascadeCallback];\n      }\n    }\n\n    return options;\n  },\n\n  storeOriginalOptions(select) {\n    select._originalOptions = Array.from(select.options).map(option => {\n      return {\n        value: option.value,\n        text: option.textContent,\n        selected: option.selected,\n        disabled: option.disabled\n      };\n    });\n  },\n\n  setupSelectEvents(select, instance) {\n    // Clean up any existing event handlers\n    if (select._changeHandler) {\n      select.removeEventListener('change', select._changeHandler);\n    }\n\n    // Create change event handler\n    const changeHandler = (event) => {\n      const index = parseInt(select.dataset.cascadeIndex);\n\n      // Save current value\n      instance.state.values[index] = select.value;\n\n      // Only load options for the next select if this is not the last one\n      if (index < instance.elements.length - 1) {\n        this.loadOptions(select);\n      }\n\n      // Call onchange callback if defined\n      if (typeof instance.config.onchange === 'function') {\n        instance.config.onchange.call(select, instance);\n      }\n\n      // Emit change event\n      this.emitEvent('cascade:change', {\n        instance,\n        element: select,\n        index: index,\n        value: select.value\n      });\n    };\n\n    // Save reference to handler for cleanup\n    select._changeHandler = changeHandler;\n\n    // Add event listener\n    select.addEventListener('change', changeHandler);\n  },\n\n  clearOptions(select, config) {\n    // Remove all options except the default option if enabled\n    while (select.options.length > (config.defaultOption ? 1 : 0)) {\n      select.remove(config.defaultOption ? 1 : 0);\n    }\n\n    // Add or update default option\n    if (config.defaultOption) {\n      if (select.options.length === 0) {\n        const defaultOption = document.createElement('option');\n        defaultOption.value = '';\n        defaultOption.textContent = config.defaultOptionText;\n        defaultOption.disabled = true;\n        defaultOption.selected = true;\n        select.appendChild(defaultOption);\n      } else {\n        select.options[0].textContent = config.placeholders[select.id] ||\n          select.dataset.placeholder ||\n          config.defaultOptionText;\n      }\n    }\n\n    // Reset value\n    select.value = '';\n  },\n\n  async loadOptions(select) {\n    const index = parseInt(select.dataset.cascadeIndex);\n    const instance = select.cascadeInstance;\n    const {config} = instance;\n\n    // Get next select in the cascade\n    const nextIndex = index + 1;\n    if (nextIndex >= instance.elements.length) {\n      return; // No more selects to populate\n    }\n\n    const nextSelect = instance.elements[nextIndex];\n\n    // Don't proceed if next select doesn't exist\n    if (!nextSelect) return;\n\n    // Clear subsequent selects\n    for (let i = nextIndex; i < instance.elements.length; i++) {\n      const subsequentSelect = instance.elements[i];\n      this.clearOptions(subsequentSelect, config);\n\n      // Disable subsequent selects\n      if (config.autoDisable) {\n        subsequentSelect.disabled = true;\n      }\n\n      // Reset saved values\n      instance.state.values[i] = '';\n\n      // Emit clear event\n      this.emitEvent('cascade:clear', {\n        instance,\n        element: subsequentSelect,\n        index: i\n      });\n    }\n\n    // If the select has no value, don't fetch options\n    if (!select.value) return;\n\n    // Mark as loading\n    instance.state.loading = true;\n    nextSelect.classList.add(config.loadingClass);\n\n    // Cancel any pending request for this select\n    if (this.state.requests.has(nextSelect)) {\n      const previousRequest = this.state.requests.get(nextSelect);\n      if (previousRequest.abort) {\n        previousRequest.abort();\n      }\n    }\n\n    try {\n      // Build request data\n      const formData = new FormData();\n\n      // Add current values from all previous selects\n      for (let i = 0; i <= index; i++) {\n        const paramName = instance.elements[i].name ||\n          instance.elements[i].id ||\n          `select${i}`;\n\n        formData.append(paramName, instance.elements[i].value);\n      }\n\n      // Add target parameter - which select we're loading for\n      const targetParamName = nextSelect.name || nextSelect.id || `select${nextIndex}`;\n      formData.append('target', targetParamName);\n\n      // Add custom parameters if any\n      if (config.params) {\n        Object.entries(config.params).forEach(([key, value]) => {\n          formData.append(key, value);\n        });\n      }\n\n      // Prepare request options\n      const url = config.action || config.url;\n      const method = config.method || 'POST';\n\n      // Create fetch options\n      const fetchOptions = {\n        method,\n        headers: {\n          'X-Requested-With': 'XMLHttpRequest'\n        }\n      };\n\n      // Add body based on method\n      if (method === 'GET') {\n        // For GET, convert FormData to query string\n        const params = new URLSearchParams();\n        for (const [key, value] of formData.entries()) {\n          params.append(key, value);\n        }\n\n        // Append query string to URL\n        const fullUrl = `${url}${url.includes('?') ? '&' : '?'}${params.toString()}`;\n\n        // Make the request\n        const response = await fetch(fullUrl, {\n          method: 'GET',\n          headers: fetchOptions.headers\n        });\n\n        // Store request for potential abort\n        this.state.requests.set(nextSelect, response);\n\n        await this.processResponse(response, nextSelect, instance);\n      } else {\n        // For POST, use FormData as body\n        fetchOptions.body = formData;\n\n        // Make the request\n        const controller = new AbortController();\n        fetchOptions.signal = controller.signal;\n\n        // Store controller for potential abort\n        this.state.requests.set(nextSelect, controller);\n\n        const response = await fetch(url, fetchOptions);\n        await this.processResponse(response, nextSelect, instance);\n      }\n    } catch (error) {\n      // Ignore aborted requests\n      if (error.name !== 'AbortError') {\n        console.error('Error loading options:', error);\n\n        // Emit error event\n        this.emitEvent('cascade:error', {\n          instance,\n          element: nextSelect,\n          error\n        });\n      }\n    } finally {\n      // Remove loading state\n      instance.state.loading = false;\n      nextSelect.classList.remove(config.loadingClass);\n      this.state.requests.delete(nextSelect);\n    }\n  },\n\n  async processResponse(response, select, instance) {\n    if (!response.ok) {\n      throw new Error(`HTTP error ${response.status}`);\n    }\n\n    let data;\n    const contentType = response.headers.get('Content-Type');\n\n    if (contentType && contentType.includes('application/json')) {\n      data = await response.json();\n    } else {\n      // Try to parse as JSON anyway\n      try {\n        const text = await response.text();\n        data = JSON.parse(text);\n      } catch (e) {\n        throw new Error('Invalid response format, expected JSON');\n      }\n    }\n\n    // Handle different response formats\n    let options = [];\n\n    if (Array.isArray(data)) {\n      // Simple array of options\n      options = data;\n    } else if (typeof data === 'object') {\n      // Check if data contains options for multiple selects\n      const selectId = select.id || select.name;\n\n      if (data[selectId]) {\n        // Data contains options specifically for this select\n        options = data[selectId];\n      } else if (data.options) {\n        // Data has an options property\n        options = data.options;\n      } else {\n        // Assume data itself is a key-value object of options\n        options = data;\n      }\n\n      // Also update other selects if data provides options for them\n      if (typeof data === 'object' && !Array.isArray(data)) {\n        for (const [key, value] of Object.entries(data)) {\n          // Skip if this is not an array or object (likely to be options)\n          if (!value || typeof value !== 'object') continue;\n\n          // Find the select by ID or name\n          const targetSelect = instance.elements.find(el =>\n            el.id === key || el.name === key\n          );\n\n          // Update the select if found\n          if (targetSelect && targetSelect !== select) {\n            this.updateSelectOptions(targetSelect, value, instance);\n          }\n        }\n      }\n    }\n\n    // Update options in the select\n    this.updateSelectOptions(select, options, instance);\n\n    // Enable the select\n    if (instance.config.autoDisable) {\n      select.disabled = false;\n    }\n\n    // Emit load event\n    this.emitEvent('cascade:loaded', {\n      instance,\n      element: select,\n      options\n    });\n\n    return options;\n  },\n\n  updateSelectOptions(select, options, instance) {\n    const {config} = instance;\n\n    // Clear existing options\n    this.clearOptions(select, config);\n\n    // Convert options to consistent format\n    let optionsArray = [];\n\n    if (Array.isArray(options)) {\n      // Array format: [{value: '1', text: 'Option 1'}, ...]\n      // Or simple array: ['Option 1', 'Option 2', ...]\n      optionsArray = options.map(option => {\n        if (typeof option === 'object') {\n          return {\n            value: option.value !== undefined ? option.value : option.id,\n            text: option.text !== undefined ? option.text : option.name,\n            selected: option.selected || false,\n            disabled: option.disabled || false\n          };\n        } else {\n          return {\n            value: option,\n            text: option,\n            selected: false,\n            disabled: false\n          };\n        }\n      });\n    } else if (typeof options === 'object') {\n      // Object format: {'1': 'Option 1', '2': 'Option 2', ...}\n      optionsArray = Object.entries(options).map(([value, text]) => {\n        return {\n          value: value,\n          text: text,\n          selected: false,\n          disabled: false\n        };\n      });\n    }\n\n    // Add options to select\n    optionsArray.forEach(opt => {\n      const option = document.createElement('option');\n      option.value = opt.value;\n      option.textContent = opt.text;\n      option.selected = opt.selected;\n      option.disabled = opt.disabled;\n      select.appendChild(option);\n    });\n\n    // If there's a stored value for this select, try to restore it\n    const index = parseInt(select.dataset.cascadeIndex);\n    if (instance.state.values[index]) {\n      const storedValue = instance.state.values[index];\n\n      // Check if the stored value exists in the new options\n      const optionExists = Array.from(select.options).some(option =>\n        option.value === storedValue\n      );\n\n      if (optionExists) {\n        select.value = storedValue;\n\n        // Trigger change to load next level\n        const event = new Event('change', {bubbles: true});\n        select.dispatchEvent(event);\n      }\n    }\n\n    // If we have a default selection specified\n    if (config.defaultSelection && config.defaultSelection[index]) {\n      const defaultValue = config.defaultSelection[index];\n\n      // Check if the default value exists in the options\n      const optionExists = Array.from(select.options).some(option =>\n        option.value === defaultValue\n      );\n\n      if (optionExists) {\n        select.value = defaultValue;\n\n        // Trigger change to load next level\n        const event = new Event('change', {bubbles: true});\n        select.dispatchEvent(event);\n      }\n    }\n  },\n\n  emitEvent(eventName, data) {\n    EventManager.emit(eventName, data);\n  },\n\n  getInstance(id) {\n    return this.state.instances.get(id) || null;\n  },\n\n  getInstanceForElement(element) {\n    if (typeof element === 'string') {\n      element = document.getElementById(element);\n    }\n\n    if (!element) return null;\n\n    return element.cascadeInstance || null;\n  },\n\n  reset(instance) {\n    if (typeof instance === 'string') {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Reset all selects to initial state\n    instance.elements.forEach((select, index) => {\n      // First select gets original options\n      if (index === 0 && select._originalOptions) {\n        // Clear current options\n        select.innerHTML = '';\n\n        // Restore original options\n        select._originalOptions.forEach(opt => {\n          const option = document.createElement('option');\n          option.value = opt.value;\n          option.textContent = opt.text;\n          option.selected = opt.selected;\n          option.disabled = opt.disabled;\n          select.appendChild(option);\n        });\n      } else {\n        // Other selects just get cleared\n        this.clearOptions(select, instance.config);\n\n        // Disable subsequent selects\n        if (instance.config.autoDisable) {\n          select.disabled = true;\n        }\n      }\n\n      // Reset saved values\n      instance.state.values[index] = '';\n    });\n\n    // Emit reset event\n    this.emitEvent('cascade:reset', {\n      instance\n    });\n  },\n\n  destroy(instance) {\n    if (typeof instance === 'string') {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    // Cancel any pending requests\n    instance.elements.forEach(select => {\n      // Remove event listener\n      if (select._changeHandler) {\n        select.removeEventListener('change', select._changeHandler);\n      }\n\n      // Cancel request if pending\n      if (this.state.requests.has(select)) {\n        const request = this.state.requests.get(select);\n        if (request.abort) {\n          request.abort();\n        }\n        this.state.requests.delete(select);\n      }\n\n      // Remove instance reference\n      delete select.cascadeInstance;\n\n      // Remove data attributes\n      delete select.dataset.cascadeGroup;\n      delete select.dataset.cascadeIndex;\n    });\n\n    // Remove from instances map\n    this.state.instances.delete(instance.id);\n\n    // Emit destroy event\n    this.emitEvent('cascade:destroy', {\n      instanceId: instance.id\n    });\n  }\n};\n\n// Register with Now framework if available\nif (window.Now?.registerManager) {\n  Now.registerManager('cascadingSelect', CascadingSelectManager);\n}\n\nwindow.CascadingSelectManager = CascadingSelectManager;","class TextareaElementFactory extends ElementFactory {\n  static create(def) {\n    // Always render as a real <textarea>, not <input type=\"textarea\">\n    const cfg = Object.assign({}, def, {tagName: 'textarea', type: 'textarea'});\n    return super.create(cfg);\n  }\n\n  static config = {\n    autoResize: true,            // Activate automatic adjustment\n    minRows: 2,                  // Minimum number of rows\n    maxRows: 10,                 // Number of rows\n    charCount: false,             // Show the number of characters\n    charCountClass: 'char-count', // Class for letters\n    charCountFormat: '{used}/{max} characters', // Display format\n    wordCount: false,            // Show the number of words (closed by default)\n    wordCountClass: 'word-count', // Class for words\n    wordCountFormat: '{used}/{max} words', // Display format\n    enableTabIndent: false,       // Allow to use Tab for Indent.\n    tabToSpaces: 4,              // Number of gaps instead of Tab\n    debounceDelay: 300,          // Delay Debound (MS)\n    enterBehavior: 'newline',    // The behavior of Enter ('Newline', 'Prevent', 'Callback')\n    enterCallback: null         // Callback when pressing Enter (if using callback)\n  };\n\n  static propertyHandlers = {\n    rows: {\n      get(element) {\n        return element.rows || null;\n      },\n      set(instance, newValue) {\n        if (typeof newValue === 'number' && newValue > 0) {\n          instance.element.rows = newValue;\n        }\n      }\n    },\n    cols: {\n      get(element) {\n        return element.cols || null;\n      },\n      set(instance, newValue) {\n        if (typeof newValue === 'number' && newValue > 0) {\n          instance.element.cols = newValue;\n        }\n      }\n    }\n  };\n\n  static extractCustomConfig(element, def, dataset) {\n    return {\n      autoResize: dataset.autoResize !== undefined ? dataset.autoResize === 'true' : def.autoResize,\n      minRows: this.parseNumeric('minRows', element, def, dataset) || def.minRows,\n      maxRows: this.parseNumeric('maxRows', element, def, dataset) || def.maxRows,\n      charCount: dataset.charCount !== undefined ? dataset.charCount === 'true' : def.charCount,\n      wordCount: dataset.wordCount !== undefined ? dataset.wordCount === 'true' : def.wordCount,\n      enableTabIndent: dataset.enableTabIndent !== undefined ? dataset.enableTabIndent === 'true' : def.enableTabIndent,\n      tabToSpaces: this.parseNumeric('tabToSpaces', element, def, dataset) || def.tabToSpaces,\n      enterBehavior: dataset.enterBehavior || def.enterBehavior\n    };\n  }\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    config.minRows = Math.max(1, typeof config.minRows === 'number' ? config.minRows : this.config.minRows);\n    config.maxRows = Math.max(config.minRows, typeof config.maxRows === 'number' ? config.maxRows : this.config.maxRows);\n    config.debounceDelay = Math.max(0, typeof config.debounceDelay === 'number' ? config.debounceDelay : this.config.debounceDelay);\n    config.tabToSpaces = Math.max(0, typeof config.tabToSpaces === 'number' ? config.tabToSpaces : this.config.tabToSpaces);\n    if (!['newline', 'prevent', 'callback'].includes(config.enterBehavior)) {\n      config.enterBehavior = this.config.enterBehavior;\n    }\n    if (config.enterBehavior === 'callback' && typeof config.enterCallback !== 'function') {\n      console.warn('enterCallback must be a function when enterBehavior is \"callback\". Falling back to \"newline\".');\n      config.enterBehavior = 'newline';\n    }\n\n    element.setAttribute('aria-multiline', 'true');\n\n    instance.countWords = function(text) {\n      return text.trim() ? text.trim().split(/\\s+/).length : 0;\n    };\n\n    instance.validateSpecific = function(value) {\n      if (this.config.minWords) {\n        const wordCount = this.countWords(value);\n        if (wordCount < this.config.minWords) {\n          return Now.translate('Must be at least {min} words', {min: this.config.minWords});\n        }\n      }\n      if (this.config.maxWords) {\n        const wordCount = this.countWords(value);\n        if (wordCount > this.config.maxWords) {\n          return Now.translate('Must be no more than {max} words', {max: this.config.maxWords});\n        }\n      }\n      return null;\n    };\n\n    if (config.autoResize) {\n      this.setupAutoResize(instance);\n    }\n    if (config.charCount || config.wordCount) {\n      this.setupCounter(instance);\n    }\n\n    const originalCleanup = instance.cleanup;\n    instance.cleanup = function() {\n      if (this.debounceTimer) clearTimeout(this.debounceTimer);\n      return originalCleanup.call(this);\n    };\n  }\n\n  static setupAutoResize(instance) {\n    const {element, config} = instance;\n    element._originalResize = element.style.resize || 'both';\n    element._originalOverflow = element.style.overflowY || 'auto';\n\n    element.style.resize = 'none';\n    element.style.overflowY = 'hidden';\n\n    setTimeout(() => this.adjustHeight(element, config), 0);\n  }\n\n  static adjustHeight(element, config) {\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    element.style.height = 'auto';\n\n    const style = window.getComputedStyle(element);\n    const lineHeight = parseFloat(style.lineHeight) || parseFloat(style.fontSize) * 1.2 || 16;\n    const paddingTop = parseFloat(style.paddingTop) || 0;\n    const paddingBottom = parseFloat(style.paddingBottom) || 0;\n    const padding = paddingTop + paddingBottom;\n\n    const minHeight = (config.minRows * lineHeight) + padding;\n    const maxHeight = config.maxRows ? (config.maxRows * lineHeight) + padding : Infinity;\n\n    const newHeight = Math.min(Math.max(element.scrollHeight, minHeight), maxHeight);\n    element.style.height = `${newHeight}px`;\n\n    window.scrollTo(0, scrollTop);\n    element.style.overflowY = element.scrollHeight > newHeight ? 'auto' : 'hidden';\n  }\n\n  static setupCounter(instance) {\n    const {element, config, wrapper} = instance;\n\n    const counterWrapper = document.createElement('div');\n    counterWrapper.className = 'textarea-counter';\n    counterWrapper.style.textAlign = 'right';\n    counterWrapper.style.fontSize = 'smaller';\n    counterWrapper.style.color = 'var(--color-text-muted, #666)';\n    counterWrapper.setAttribute('aria-live', 'polite');\n\n    if (config.charCount) {\n      const charCounter = document.createElement('span');\n      charCounter.className = config.charCountClass;\n      counterWrapper.appendChild(charCounter);\n      element.charCounter = charCounter;\n    }\n\n    if (config.wordCount) {\n      if (config.charCount) counterWrapper.appendChild(document.createTextNode(' | '));\n      const wordCounter = document.createElement('span');\n      wordCounter.className = config.wordCountClass;\n      counterWrapper.appendChild(wordCounter);\n      element.wordCounter = wordCounter;\n    }\n\n    if (wrapper) {\n      wrapper.appendChild(counterWrapper);\n    } else {\n      const div = document.createElement('div');\n      div.appendChild(element.cloneNode(true));\n      element.parentNode?.replaceChild(div, element);\n      instance.element = div.querySelector('textarea');\n      div.appendChild(counterWrapper);\n      instance.wrapper = div;\n    }\n\n    this.updateCounters(instance);\n  }\n\n  static updateCounters(instance) {\n    const {element, config} = instance;\n    const value = element.value;\n\n    if (element.charCounter) {\n      const used = value.length;\n      const max = element.maxLength > 0 ? element.maxLength : Now.translate('unlimited');\n      element.charCounter.textContent = Now.translate(config.charCountFormat, {used, max});\n    }\n\n    if (element.wordCounter) {\n      const used = instance.countWords(value);\n      const max = config.maxWords > 0 ? config.maxWords : Now.translate('unlimited');\n      element.wordCounter.textContent = Now.translate(config.wordCountFormat, {used, max});\n    }\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config} = instance;\n\n    let debounceTimer;\n    const debouncedUpdate = Utils.function.debounce((e) => {\n      if (config.autoResize) this.adjustHeight(element, config);\n      if (config.charCount || config.wordCount) this.updateCounters(instance);\n    }, config.debounceDelay);\n\n    const handlers = {\n      input: (e) => {\n        instance.state.modified = true;\n        instance.debounceTimer = debounceTimer;\n        debouncedUpdate(e);\n      },\n      keydown: (e) => {\n        if (e.key === 'Enter') {\n          if (e.shiftKey) {\n            const start = element.selectionStart;\n            const end = element.selectionEnd;\n            element.value = element.value.substring(0, start) + '\\n' + element.value.substring(end);\n            element.selectionStart = element.selectionEnd = start + 1;\n            e.preventDefault();\n          } else if (!e.ctrlKey && !e.altKey) {\n            if (config.enterBehavior === 'prevent') {\n              e.preventDefault();\n            } else if (config.enterBehavior === 'callback' && config.enterCallback) {\n              e.preventDefault();\n              config.enterCallback(e, element.value);\n            }\n          }\n        }\n\n        if (config.enableTabIndent && e.key === 'Tab' && !e.shiftKey && !e.ctrlKey && !e.altKey) {\n          e.preventDefault();\n          const start = element.selectionStart;\n          const end = element.selectionEnd;\n          const indent = config.tabToSpaces > 0 ? ' '.repeat(config.tabToSpaces) : '\\t';\n          element.value = element.value.substring(0, start) + indent + element.value.substring(end);\n          element.selectionStart = element.selectionEnd = start + indent.length;\n        }\n      }\n    };\n\n    EventSystemManager.addHandler(element, 'input', handlers.input);\n    EventSystemManager.addHandler(element, 'keydown', handlers.keydown);\n  }\n\n  static cleanup(instance) {\n    if (!instance) return;\n    try {\n      const {element} = instance;\n      if (instance.debounceTimer) {\n        clearTimeout(instance.debounceTimer);\n        instance.debounceTimer = null;\n      }\n      // restore original styles\n      if (element._originalResize !== undefined) {\n        element.style.resize = element._originalResize;\n        delete element._originalResize;\n      }\n      if (element._originalOverflow !== undefined) {\n        element.style.overflowY = element._originalOverflow;\n        delete element._originalOverflow;\n      }\n\n      // remove counters\n      try {\n        if (element.charCounter && element.charCounter.parentNode) element.charCounter.parentNode.removeChild(element.charCounter);\n      } catch (e) {}\n      try {\n        if (element.wordCounter && element.wordCounter.parentNode) element.wordCounter.parentNode.removeChild(element.wordCounter);\n      } catch (e) {}\n    } catch (err) {\n      console.warn('TextareaElementFactory.cleanup error', err);\n    }\n\n    if (typeof super.cleanup === 'function') super.cleanup(instance);\n  }\n}\n\nElementManager.registerElement('textarea', TextareaElementFactory);","class FileElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    debug: false,\n    maxFileSize: 10 * 1024 * 1024,\n    allowedMimeTypes: [\n      'image/*',\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'text/plain',\n      'application/zip',\n      'application/x-zip-compressed'\n    ],\n    previewContainer: null,\n    placeholder: null,\n    onChange: null,\n    onError: null\n  };\n\n  static extractCustomConfig(element, def, dataset) {\n    return {\n      multiple: element.multiple === true || def.preview === true,\n      preview: dataset.preview === 'true' || def.preview === true,\n      previewContainer: dataset.previewContainer || def.previewContainer || this.config.previewContainer,\n      downloadEnabled: dataset.allowDownload === 'true' || def.downloadEnabled === true,\n      fileReference: dataset.fileReference || def.fileReference || 'id',\n      maxFileSize: parseInt(dataset.maxFileSize) || def.maxFileSize || this.config.maxFileSize,\n      dragDrop: dataset.dragDrop === 'true' || def.dragDrop === true || false,\n      actionUrl: dataset.actionUrl || def.actionUrl,\n      sortable: dataset.sortable === 'true' || def.sortable === true || false,\n      allowRemoveExisting: dataset.allowRemoveExisting === 'true' || def.allowRemoveExisting === true || false,\n      placeholder: dataset.placeholder || element.placeholder || def.placeholder || this.config.placeholder,\n      existingFiles: this.parseExistingFiles(element) || def.existingFiles || []\n    };\n  }\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    const privateState = ElementFactory._privateState.get(element);\n    if (!privateState.files) {\n      privateState.files = new Map();\n    }\n\n    if (config.multiple) {\n      element.multiple = true;\n    }\n\n    if (config.accept) {\n      element.accept = config.accept;\n    }\n\n    let dropZone = null;\n    if (config.dragDrop) {\n      dropZone = this.initDragDrop(instance);\n    } else {\n      dropZone = element.parentElement?.parentElement;\n      this.initPlaceholder(instance);\n    }\n    instance.dropZone = dropZone;\n\n    let previewContainer;\n    if (config.preview) {\n      if (config.previewContainer) {\n        previewContainer = document.querySelector(config.previewContainer);\n      }\n      if (!previewContainer && dropZone) {\n        previewContainer = document.createElement('div');\n        previewContainer.className = 'file-preview';\n        dropZone.appendChild(previewContainer);\n      }\n      instance.previewContainer = previewContainer;\n\n      if (previewContainer) {\n        previewContainer.innerHTML = '';\n      }\n    }\n\n    if (config.sortable && instance.previewContainer) {\n      this.initSortable(instance.previewContainer, config);\n    }\n\n    if (config.existingFiles && config.existingFiles.length > 0) {\n      this.showExistingFiles(instance, config.existingFiles);\n    }\n\n    instance.clearFiles = function() {\n      return FileElementFactory.clearFiles(this);\n    };\n\n    instance.upload = function(options) {\n      return FileElementFactory.upload(this, options);\n    };\n\n    instance.validateFiles = function() {\n      return FileElementFactory.validateFormField(this);\n    };\n\n    return instance;\n  }\n\n  static setupEventListeners(instance) {\n    const {element, config} = instance;\n\n    const parentHandlers = super.setupEventListeners(instance);\n\n    const changeHandler = (event) => {\n      const files = Array.from(element.files);\n      this.processFiles(instance, files);\n    };\n\n    let dragHandlers = {};\n    if (instance.dropZone && config.dragDrop) {\n      dragHandlers = {\n        dragEnter: (event) => {\n          event.preventDefault();\n          instance.dropZone.classList.add('drag-over');\n        },\n\n        dragLeave: (event) => {\n          event.preventDefault();\n          instance.dropZone.classList.remove('drag-over');\n        },\n\n        dragOver: (event) => {\n          event.preventDefault();\n        },\n\n        drop: (event) => {\n          event.preventDefault();\n          instance.dropZone.classList.remove('drag-over');\n          this.handleFileDrop(event.originalEvent, element);\n        }\n      };\n\n      EventSystemManager.addHandler(instance.dropZone, 'dragenter', dragHandlers.dragEnter);\n      EventSystemManager.addHandler(instance.dropZone, 'dragleave', dragHandlers.dragLeave);\n      EventSystemManager.addHandler(instance.dropZone, 'dragover', dragHandlers.dragOver);\n      EventSystemManager.addHandler(instance.dropZone, 'drop', dragHandlers.drop);\n    }\n\n    EventSystemManager.addHandler(element, 'change', changeHandler);\n\n    return {\n      ...parentHandlers,\n      change: changeHandler,\n      ...dragHandlers\n    };\n  }\n\n  static initDragDrop(instance) {\n    const {element, config} = instance;\n\n    let dropZone = element.parentElement;\n    if (dropZone && dropZone.classList.contains('form-control')) {\n      dropZone.classList.add('file-drop-zone');\n    } else {\n      dropZone = document.createElement('div');\n      dropZone.className = 'file-drop-zone';\n      element.parentNode.insertBefore(dropZone, element);\n      dropZone.appendChild(element);\n    }\n\n    const dropContent = document.createElement('div');\n    dropContent.className = 'file-drop-content';\n\n    const dropMessage = document.createElement('div');\n    dropMessage.className = 'file-drop-message';\n    dropMessage.textContent = Now.translate(config.placeholder || 'Drag files here or click to browse');\n\n    dropContent.appendChild(dropMessage);\n    dropZone.appendChild(dropContent);\n\n    return dropZone;\n  }\n\n  static initPlaceholder(instance) {\n    const {element, config} = instance;\n    let placeholderElement = element.parentElement?.querySelector('.placeholder');\n    if (!placeholderElement) {\n      placeholderElement = document.createElement('div');\n      placeholderElement.className = 'file-display placeholder';\n      element.parentElement.appendChild(placeholderElement);\n    }\n\n    placeholderElement.textContent = Now.translate(config.placeholder || 'Choose file');\n    instance.placeholderElement = placeholderElement;\n\n    this.updatePlaceholderVisibility(instance);\n\n    return placeholderElement;\n  }\n\n  static updatePlaceholderVisibility(instance) {\n    const {element, placeholderElement, config} = instance;\n    if (!placeholderElement) return;\n\n    const privateState = ElementFactory._privateState.get(element);\n    const filesArray = Array.from(privateState.files?.values() || []);\n\n    if (filesArray.length === 0) {\n      // Show initial placeholder\n      placeholderElement.textContent = Now.translate(config.placeholder || 'Choose file');\n      placeholderElement.classList.add('placeholder');\n    } else if (filesArray.length === 1) {\n      // Show single file name\n      placeholderElement.textContent = filesArray[0].name;\n      placeholderElement.classList.remove('placeholder');\n    } else {\n      // Show files count\n      placeholderElement.textContent = Now.translate('{count} files selected', {count: filesArray.length});\n      placeholderElement.classList.remove('placeholder');\n    }\n  }\n\n  static parseExistingFiles(element, contextData = null) {\n    try {\n      const filesData = element.dataset.files;\n      if (!filesData) return null;\n\n      // Try to parse as JSON first (original format)\n      try {\n        const files = JSON.parse(filesData);\n        const result = Array.isArray(files) ? files : [files];\n        return result;\n      } catch (jsonError) {\n        // Not JSON - treat as field name reference\n        // If context data is provided, try to resolve the field\n        if (contextData) {\n          const fieldData = this.resolveFieldData(contextData, filesData);\n          if (fieldData) {\n            return Array.isArray(fieldData) ? fieldData : [fieldData];\n          }\n        }\n\n        // Return field reference indicator for later resolution\n        return {fieldRef: filesData};\n      }\n    } catch (error) {\n      console.warn('Invalid files data attribute:', error);\n      return null;\n    }\n  }\n\n  static resolveFieldData(data, fieldName) {\n    if (!data || !fieldName) return null;\n\n    // Handle nested data structure (e.g., data.data.avatar)\n    const searchTargets = [data];\n    if (data.data) {\n      searchTargets.unshift(data.data);\n      if (data.data.data) {\n        searchTargets.unshift(data.data.data);\n      }\n    }\n\n    for (const target of searchTargets) {\n      if (target && typeof target === 'object' && fieldName in target) {\n        return target[fieldName];\n      }\n    }\n\n    return null;\n  }\n\n  static setExistingFilesFromContext(instance, contextData) {\n    const {element, config} = instance;\n    const filesData = element.dataset.files;\n\n    if (!filesData) return;\n\n    // Check if we have a pending field reference\n    if (config.existingFiles && config.existingFiles.fieldRef) {\n      const fieldData = this.resolveFieldData(contextData, config.existingFiles.fieldRef);\n      if (fieldData) {\n        const files = Array.isArray(fieldData) ? fieldData : [fieldData];\n        config.existingFiles = files;\n        this.showExistingFiles(instance, files);\n      } else {\n        config.existingFiles = [];\n      }\n    }\n  }\n\n  static handleFileDrop(event, element) {\n    const files = Array.from(event.dataTransfer.files);\n    const dt = new DataTransfer();\n    files.forEach(file => dt.items.add(file));\n    element.files = dt.files;\n    element.dispatchEvent(new Event('change'));\n  }\n\n  static async processFiles(instance, files) {\n    const {element, config} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n    if (!config.multiple) {\n      privateState.files.clear();\n    }\n    const newFiles = new Map(privateState.files || new Map());\n    const errors = [];\n\n    FormError.clearFieldError(element.id);\n\n    for (const file of files) {\n      try {\n        await this.validateFile(file, config);\n        newFiles.set(file.name, file);\n      } catch (error) {\n        errors.push(`${file.name}: ${error.message || error}`);\n      }\n    }\n\n    if (errors.length === 0) {\n      privateState.files = newFiles;\n      this.showPreviews(instance);\n      this.updatePlaceholderVisibility(instance);\n\n      if (typeof config.onChange === 'function') {\n        config.onChange(Array.from(newFiles.values()), element);\n      }\n\n      EventManager.emit('file:change', {\n        elementId: element.id,\n        files: newFiles\n      });\n    } else {\n      FormError.showFieldError(element.id, errors.join('<br>'));\n\n      element.value = '';\n      privateState.files = new Map();\n      this.showPreviews(instance);\n      this.updatePlaceholderVisibility(instance);\n    }\n  }\n\n  static async validateFile(file, config) {\n    if (file.size > config.maxFileSize) {\n      const message = Now.translate('File size cannot exceed {maxsize}', {maxsize: this.formatFileSize(config.maxFileSize)});\n      throw new Error(message);\n    }\n\n    if (config.accept) {\n      const accepts = config.accept.split(',').map(x => x.trim());\n      const valid = this.isValidFileType(file, accepts);\n\n      if (!valid) {\n        throw new Error(Now.translate('File type not allowed'));\n      }\n    } else if (config.allowedMimeTypes && config.allowedMimeTypes.length > 0) {\n      const valid = this.isValidFileType(file, config.allowedMimeTypes);\n\n      if (!valid) {\n        throw new Error(Now.translate('File type not allowed'));\n      }\n    }\n\n    return true;\n  }\n\n  static isValidFileType(file, acceptedTypes) {\n    return acceptedTypes.some(type => {\n      if (type.startsWith('.')) {\n        return file.name.toLowerCase().endsWith(type.toLowerCase());\n      }\n      if (type.includes('/*')) {\n        const mainType = type.split('/')[0];\n        return file.type.startsWith(mainType + '/');\n      }\n      return file.type === type;\n    });\n  }\n\n  static showPreviews(instance) {\n    const {previewContainer, element} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n\n    if (!previewContainer) return;\n\n    const existingPreviews = [...previewContainer.querySelectorAll('.preview-item[data-existing=\"true\"]')];\n\n    previewContainer.innerHTML = '';\n\n    existingPreviews.forEach(preview => {\n      previewContainer.appendChild(preview);\n    });\n\n    if (!privateState.files || !(privateState.files instanceof Map)) {\n      console.warn('privateState.files is not a valid Map:', privateState.files);\n      return;\n    }\n\n    privateState.files.forEach(file => {\n      const preview = document.createElement('div');\n      preview.className = 'preview-item';\n      preview.dataset.fileName = file.name;\n\n      const icon = document.createElement('span');\n      icon.className = 'image-preview';\n\n      if (file.type.startsWith('image/')) {\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          icon.style.backgroundImage = `url(${e.target.result})`;\n        };\n        reader.readAsDataURL(file);\n      } else {\n        icon.classList.add(this.getFileIcon(file.name.toLowerCase()));\n      }\n      preview.appendChild(icon);\n\n      const info = document.createElement('div');\n      info.className = 'file-info';\n      info.textContent = `${file.name} (${this.formatFileSize(file.size)})`;\n      preview.appendChild(info);\n\n      const remove = document.createElement('button');\n      remove.type = 'button';\n      remove.className = 'icon-delete';\n      remove.title = Now.translate('Delete file');\n      remove.onclick = () => this.removeFile(instance, file);\n      preview.appendChild(remove);\n\n      previewContainer.appendChild(preview);\n    });\n  }\n\n  static showExistingFiles(instance, files) {\n    const {previewContainer, config} = instance;\n    if (!previewContainer) return;\n\n    files.forEach(file => {\n      const preview = document.createElement('div');\n      preview.className = 'preview-item';\n      preview.dataset.existing = \"true\";\n\n      const referenceKey = config.fileReference || 'id';\n      const referenceValue = file[referenceKey];\n      if (referenceValue) {\n        preview.dataset[this.camelCase(referenceKey)] = referenceValue;\n      }\n\n      if (config.sortable) {\n        const dragHandle = document.createElement('span');\n        dragHandle.className = 'drag-handle';\n        dragHandle.title = Now.translate('Drag to reorder');\n        preview.appendChild(dragHandle);\n      }\n\n      let imageContainer;\n      const match = file.url?.toLowerCase().match(/([^\\/]{1,})\\.([a-z]{3,})$/i);\n      if (!match) return;\n\n      if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(match[2])) {\n        imageContainer = document.createElement('div');\n        imageContainer.style.backgroundImage = `url(${file.url})`;\n        imageContainer.onclick = () => {\n          this.getImageModal().show([file.url]);\n        };\n      } else {\n        imageContainer = document.createElement('a');\n        imageContainer.className = this.getFileIcon(match[2]);\n        imageContainer.href = file.url;\n        imageContainer.download = match[0];\n      }\n      imageContainer.classList.add('image-preview');\n      preview.appendChild(imageContainer);\n\n      if (config.allowRemoveExisting && config.actionUrl) {\n        const remove = document.createElement('button');\n        remove.type = 'button';\n        remove.className = 'icon-delete';\n        remove.title = Now.translate('Delete file');\n        remove.onclick = (e) => {\n          e.stopPropagation();\n          this.deleteFile(file, preview, config);\n        };\n        preview.appendChild(remove);\n      }\n\n      const info = document.createElement('div');\n      info.className = 'file-info';\n      const fileInfo = file.name || match[0];\n      if (file.size) {\n        info.textContent = `${fileInfo} (${this.formatFileSize(file.size)})`;\n      } else {\n        info.textContent = fileInfo;\n      }\n      preview.appendChild(info);\n      previewContainer.appendChild(preview);\n    });\n  }\n\n  static removeFile(instance, file) {\n    const {element, config} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n\n    privateState.files.delete(file.name);\n    this.showPreviews(instance);\n    this.updatePlaceholderVisibility(instance);\n\n    if (privateState.files.size === 0) {\n      element.value = '';\n    }\n\n    if (config.onChange) {\n      config.onChange(element, Array.from(privateState.files.values()));\n    }\n  }\n\n  static clearFiles(instance) {\n    const {element, previewContainer} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n\n    element.value = '';\n    privateState.files.clear();\n\n    if (previewContainer) {\n      const existingPreviews = previewContainer.querySelectorAll('.preview-item[data-existing=\"true\"]');\n      if (existingPreviews.length === 0) {\n        previewContainer.innerHTML = '';\n      } else {\n        Array.from(previewContainer.querySelectorAll('.preview-item:not([data-existing=\"true\"])')).forEach(el => el.remove());\n      }\n    }\n\n    this.updatePlaceholderVisibility(instance);\n  }\n\n  static initSortable(container, config) {\n    if (typeof Sortable === 'undefined') {\n      console.warn('Sortable.js is required for drag & drop sorting');\n      return;\n    }\n\n    new Sortable(container, {\n      animation: 150,\n      handle: '.drag-handle',\n      draggable: '.preview-item',\n      ghostClass: 'sortable-ghost',\n      chosenClass: 'sortable-chosen',\n      dragClass: 'sortable-drag',\n      onStart: (evt) => {\n        container.classList.add('sorting');\n      },\n      onEnd: async (evt) => {\n        container.classList.remove('sorting');\n\n        if (!config.actionUrl) return;\n\n        const referenceKey = config.fileReference || 'id';\n        const items = Array.from(container.querySelectorAll('.preview-item[data-existing=\"true\"]'));\n        const order = items.map(item => {\n          const referenceValue = item.dataset[this.camelCase(referenceKey)];\n          return {\n            [referenceKey]: referenceValue,\n            position: items.indexOf(item)\n          };\n        }).filter(item => item[referenceKey]);\n\n        if (order.length === 0) return;\n\n        try {\n          const payload = {\n            action: 'sort',\n            order: order\n          };\n\n          const apiService = window.ApiService || window.Now?.getManager?.('api');\n          let result;\n          if (apiService?.post) {\n            result = await apiService.post(config.actionUrl, payload);\n          } else {\n            result = await simpleFetch.post(config.actionUrl, payload);\n          }\n\n          if (result.status === 200) {\n            if (window.NotificationManager) {\n              NotificationManager.success('Saved successfully');\n            }\n          }\n        } catch (error) {\n          ErrorManager.handle(error, {\n            context: 'FileElementFactory.initSortable',\n            type: 'error:file',\n            data: {container, config},\n            notify: true\n          });\n          this.revertOrder(container, evt.oldIndex, evt.newIndex);\n        }\n      }\n    });\n  }\n\n  static revertOrder(container, oldIndex, newIndex) {\n    const items = Array.from(container.querySelectorAll('.preview-item[data-existing=\"true\"]'));\n    const item = items[newIndex];\n\n    if (oldIndex < newIndex) {\n      container.insertBefore(item, items[oldIndex]);\n    } else {\n      const target = items[oldIndex + 1];\n      container.insertBefore(item, target);\n    }\n  }\n\n  static async deleteFile(file, preview, config) {\n    try {\n      const confirmed = await DialogManager.confirm(\n        Now.translate('Are you sure you want to delete this item?'),\n        Now.translate('Confirm Delete')\n      );\n      if (!confirmed) return;\n\n      const referenceValue = file[config.fileReference];\n      if (!referenceValue) {\n        throw new Error(`Missing reference value: ${config.fileReference}`);\n      }\n\n      const payload = {\n        action: 'delete',\n        [config.fileReference]: referenceValue\n      };\n\n      const apiService = window.ApiService || window.Now?.getManager?.('api');\n      let result;\n      if (apiService?.post) {\n        result = await apiService.post(config.actionUrl, payload);\n      } else {\n        result = await simpleFetch.post(config.actionUrl, payload);\n      }\n\n      // Check for success (status 2xx or success flag)\n      const isSuccess = (result.success !== false) &&\n        (result.status >= 200 && result.status < 300);\n\n      if (isSuccess) {\n        // 1. First, remove the preview element\n        preview.remove();\n\n        // 2. Trigger onRemoveExisting callback if defined\n        if (typeof config.onRemoveExisting === 'function') {\n          config.onRemoveExisting(file);\n        }\n\n        // 3. Check if response has actions for ResponseHandler (e.g., redirect, notification)\n        const responseData = result.data?.data || result.data || result;\n        if (responseData.actions && Array.isArray(responseData.actions)) {\n          await ResponseHandler.process(responseData);\n        } else {\n          // 4. No actions from server - show default notification\n          if (window.NotificationManager) {\n            NotificationManager.success(result.message || 'Item deleted successfully');\n          }\n        }\n      } else {\n        // Handle error response\n        if (window.NotificationManager) {\n          NotificationManager.error(result.message || 'Failed to delete item');\n        }\n      }\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'FileElementFactory.deleteFile',\n        type: 'error:file',\n        data: {file, preview, config},\n        notify: true\n      });\n    }\n  }\n\n  static validateFormField(instance) {\n    const {element} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n\n    if (element.required && (!privateState.files || privateState.files.size === 0)) {\n      const message = Now.translate('File is required');\n      FormError.showFieldError(element.id, message);\n      return false;\n    }\n\n    return true;\n  }\n\n  static async upload(instance, options = {}) {\n    const {element, config} = instance;\n    const privateState = ElementFactory._privateState.get(element);\n\n    if (privateState.files.size === 0 && element.files.length === 0) {\n      return {success: false, message: Now.translate('No files selected')};\n    }\n\n    try {\n      const formData = new FormData();\n\n      if (privateState.files.size > 0) {\n        Array.from(privateState.files.values()).forEach((file, index) => {\n          formData.append(`file${index}`, file);\n        });\n      } else {\n        Array.from(element.files).forEach((file, index) => {\n          formData.append(`file${index}`, file);\n        });\n      }\n\n      if (options.data) {\n        Object.entries(options.data).forEach(([key, value]) => {\n          formData.append(key, value);\n        });\n      }\n\n      const url = options.url || config.actionUrl;\n      if (!url) {\n        throw new Error('Upload URL not specified');\n      }\n\n      const progressContainer = this.createProgressElement(element);\n      progressContainer.style.display = 'block';\n\n      const xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          const percent = Math.round((e.loaded / e.total) * 100);\n          this.updateProgressBar(progressContainer, percent);\n        }\n      });\n\n      return new Promise((resolve, reject) => {\n        xhr.onload = () => {\n          progressContainer.style.display = 'none';\n          if (xhr.status >= 200 && xhr.status < 300) {\n            try {\n              const result = JSON.parse(xhr.responseText);\n              resolve(result);\n            } catch (e) {\n              resolve({success: true, message: 'Upload completed'});\n            }\n          } else {\n            reject(new Error('Upload failed'));\n          }\n        };\n\n        xhr.onerror = () => {\n          progressContainer.style.display = 'none';\n          reject(new Error('Network error'));\n        };\n\n        xhr.open('POST', url);\n        xhr.send(formData);\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'FileElementFactory.upload',\n        type: 'error:file',\n        data: {instance, options},\n        notify: true\n      });\n      return {success: false, message: error.message || 'Upload failed'};\n    }\n  }\n\n  static createProgressElement(element) {\n    let progressContainer = element.parentElement.querySelector('.upload-progress');\n    if (!progressContainer) {\n      progressContainer = document.createElement('div');\n      progressContainer.className = 'upload-progress';\n      progressContainer.innerHTML = `\n        <div class=\"progress\">\n          <div class=\"progress-bar\" style=\"width:0%\"></div>\n        </div>\n        <div class=\"progress-text\">0%</div>\n      `;\n      element.parentElement.appendChild(progressContainer);\n    }\n    return progressContainer;\n  }\n\n  static updateProgressBar(container, percent) {\n    const bar = container.querySelector('.progress-bar');\n    const text = container.querySelector('.progress-text');\n    if (bar) bar.style.width = percent + '%';\n    if (text) text.textContent = percent + '%';\n  }\n\n  static camelCase(str) {\n    return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase());\n  }\n\n  static getFileIcon(file) {\n    const ext = file.split('.').pop();\n    const icons = {\n      pdf: 'icon-pdf',\n      doc: 'icon-word',\n      docx: 'icon-word',\n      xls: 'icon-excel',\n      xlsx: 'icon-excel',\n      zip: 'icon-zip',\n      rar: 'icon-zip'\n    };\n    return icons[ext] || 'icon-file';\n  }\n\n  static formatFileSize(bytes) {\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    if (bytes === 0) return '0 Bytes';\n    const i = parseInt(Math.log(bytes) / Math.log(1024));\n    return `${Math.round(bytes / Math.pow(1024, i), 2)} ${sizes[i]}`;\n  }\n\n  static getImageModal() {\n    if (!this._imageModal) {\n      this._imageModal = new MediaViewer({\n        thumbnails: {\n          enabled: true,\n        }\n      });\n    }\n    return this._imageModal;\n  }\n\n  static cleanup(instance) {\n    const {element, dropZone} = instance;\n\n    EventSystemManager.removeElementHandlers(element);\n\n    if (dropZone) {\n      EventSystemManager.removeElementHandlers(dropZone);\n    }\n\n    return super.cleanup(instance);\n  }\n}\n\nElementManager.registerElement('file', FileElementFactory);\n\n// Expose globally\nwindow.FileElementFactory = FileElementFactory;\n","class SearchElementFactory extends TextElementFactory {\n  static config = {\n    ...TextElementFactory.config,\n    type: 'search',\n    inputMode: 'search',\n    searchDelay: 300,\n    minLength: 2,\n    maxLength: 100,\n    placeholder: 'Search',\n    wrapperClass: 'search',\n    inputClass: 'search-input',\n    clearClass: 'search-clear',\n    loadingClass: 'search-loading',\n    resultsClass: 'search-results',\n    activeClass: 'active',\n    maxResults: 10,\n    highlightMatches: true,\n    formIntegration: true, // Increase the combination with Formmanager.\n    keyboard: {\n      selectKeys: ['Enter', ' '],\n      closeKeys: ['Escape'],\n      navigateUpKeys: ['ArrowUp'],\n      navigateDownKeys: ['ArrowDown']\n    }\n  };\n\n  static setupElement(instance) {\n    // Basic settings from Textelementfactory\n    super.setupElement(instance);\n    const {element, config} = instance;\n\n    // Specify the type and specific qualifications of Search Input.\n    element.type = 'search';\n    element.inputMode = 'search';\n\n    // Add search button\n    this.setupClearButton(instance);\n\n    // Add the search box (if specified onsearch)\n    if (typeof config.onSearch === 'function') {\n      this.setupResultsContainer(instance);\n    } else if (window.Autocomplete && config.useAutocomplete) {\n      // Use AutoComplete from the main system if there is\n      instance.autocomplete = Autocomplete.create(element, {\n        minLength: config.minLength,\n        delay: config.searchDelay,\n        limit: config.maxResults\n      });\n    }\n\n    // Register with Formmanager if you want\n    if (config.formIntegration) {\n      this.registerWithFormManager(instance);\n    }\n\n    // Add methon for creating results.\n    instance.createSuggestionList = function(items) {\n      return SearchElementFactory.showResults(instance, items);\n    };\n\n    return instance;\n  }\n\n  // Provide cleanup for instances created by this factory\n  static cleanup(instance) {\n    if (!instance) return;\n    try {\n      const {element} = instance;\n      if (element.clearButton && element.clearButton.parentNode) {\n        element.clearButton.parentNode.removeChild(element.clearButton);\n        element.clearButton = null;\n      }\n      if (element.resultsContainer && element.resultsContainer.parentNode) {\n        element.resultsContainer.parentNode.removeChild(element.resultsContainer);\n        element.resultsContainer = null;\n      }\n\n      // If registered with FormManager, attempt to unregister validator\n      try {\n        const formManager = Now.getManager && Now.getManager('form');\n        const form = element.closest ? element.closest('form[data-form]') : null;\n        if (form && formManager && typeof formManager.unregisterValidator === 'function') {\n          formManager.unregisterValidator(element.id);\n        }\n      } catch (e) {}\n    } catch (err) {\n      console.warn('SearchElementFactory.cleanup error', err);\n    }\n\n    // Call parent cleanup\n    if (typeof super.cleanup === 'function') super.cleanup(instance);\n  }\n\n  static registerWithFormManager(instance) {\n    const formManager = Now.getManager('form');\n    if (!formManager) return;\n\n    const form = instance.element.closest('form[data-form]');\n    if (!form) return;\n\n    const formId = form.dataset.form;\n    const formInstance = formManager.getInstance(formId);\n    if (formInstance) {\n      // Register how to check the accuracy specifically for Search.\n      formManager.registerValidator(instance.element.id, (value) => {\n        return instance.validate(value, true);\n      });\n    }\n  }\n\n  static async handleSearch(instance, value) {\n    // Increase error management\n    const {element, config} = instance;\n\n    // Show or hide the washing button\n    if (element.clearButton) {\n      element.clearButton.style.display = value ? 'block' : 'none';\n    }\n\n    // If there is no value or length less than the minimum To hide results\n    if (!value || value.length < config.minLength) {\n      if (element.resultsContainer) {\n        element.resultsContainer.style.display = 'none';\n        element.setAttribute('aria-expanded', 'false');\n      }\n      if (config.onChange) config.onChange(element, '');\n      return;\n    }\n\n    try {\n      // Show the status to load\n      this.setLoadingState(instance, true);\n\n      // If there is an onsearch function, use\n      if (config.onSearch) {\n        const results = await config.onSearch(value);\n        this.showResults(instance, results, value);\n      }\n\n      // Call the onhange function if there is\n      if (config.onChange) config.onChange(element, value);\n\n      // Send searches to Eventmanager.\n      EventManager.emit('search:performed', {\n        elementId: element.id,\n        query: value\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'SearchElementFactory.handleSearch',\n        type: 'error:search'\n      });\n\n      // Show mistakes under the search box.\n      if (typeof FormError !== 'undefined') {\n        FormError.showFieldError(element.id, error.message || 'Search error occurred');\n      }\n    } finally {\n      // Hide the status is loading.\n      this.setLoadingState(instance, false);\n    }\n  }\n\n  // Create a Clear button and tie an event.\n  static setupClearButton(instance) {\n    const {element, config} = instance;\n    try {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = config.clearClass || 'search-clear';\n      btn.setAttribute('aria-label', Now.translate('Clear'));\n      btn.style.display = 'none';\n\n      const target = element.wrapper || element.parentNode || document.body;\n      if (target) target.appendChild(btn);\n\n      btn.addEventListener('click', (e) => {\n        e.preventDefault();\n        element.value = '';\n        element.dispatchEvent(new Event('input', {bubbles: true}));\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n        element.focus();\n        if (typeof config.onChange === 'function') config.onChange(element, '');\n      });\n\n      element.clearButton = btn;\n    } catch (error) {\n      // non-fatal\n      console.warn('SearchElementFactory: failed to create clear button', error);\n    }\n  }\n\n  // Create Container for showing search results.\n  static setupResultsContainer(instance) {\n    const {element, config} = instance;\n    try {\n      const container = document.createElement('div');\n      container.className = config.resultsClass || 'search-results';\n      container.style.display = 'none';\n      container.setAttribute('role', 'listbox');\n      container.setAttribute('aria-hidden', 'true');\n\n      const target = element.wrapper || element.parentNode || document.body;\n      if (target) target.appendChild(container);\n\n      element.resultsContainer = container;\n      element.setAttribute('aria-haspopup', 'listbox');\n      element.setAttribute('aria-expanded', 'false');\n    } catch (error) {\n      console.warn('SearchElementFactory: failed to create results container', error);\n    }\n  }\n\n  // Show results\n  static showResults(instance, items = [], query = '') {\n    const {element, config} = instance;\n    const container = element.resultsContainer;\n    if (!container) return;\n\n    container.innerHTML = '';\n    if (!items || items.length === 0) {\n      container.style.display = 'none';\n      element.setAttribute('aria-expanded', 'false');\n      container.setAttribute('aria-hidden', 'true');\n      return;\n    }\n\n    const list = document.createElement('ul');\n    list.className = 'search-results-list';\n\n    const safeQuery = query ? String(query).replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') : '';\n    const re = safeQuery ? new RegExp(`(${safeQuery})`, 'ig') : null;\n\n    items.slice(0, config.maxResults || 10).forEach(item => {\n      const li = document.createElement('li');\n      li.className = 'search-result-item';\n      li.setAttribute('role', 'option');\n\n      let text = typeof item === 'object' ? (item.text || item.label || item.value || String(item)) : String(item);\n      if (config.highlightMatches && re) {\n        text = text.replace(re, '<em>$1</em>');\n      }\n\n      li.innerHTML = `<span class=\"result-text\">${text}</span>`;\n      li.addEventListener('click', () => {\n        element.value = typeof item === 'object' ? (item.value || item.text || item.label || '') : item;\n        if (instance.hiddenInput) instance.hiddenInput.value = typeof item === 'object' ? (item.key || item.value || '') : element.value;\n        element.dispatchEvent(new Event('change', {bubbles: true}));\n        container.style.display = 'none';\n        element.setAttribute('aria-expanded', 'false');\n      });\n\n      list.appendChild(li);\n    });\n\n    container.appendChild(list);\n    container.style.display = 'block';\n    container.setAttribute('aria-hidden', 'false');\n    element.setAttribute('aria-expanded', 'true');\n  }\n\n  static setLoadingState(instance, isLoading) {\n    const {element, config} = instance;\n    const wrapper = element.wrapper || element.parentNode;\n    if (wrapper) {\n      if (isLoading) wrapper.classList.add(config.loadingClass || 'search-loading');\n      else wrapper.classList.remove(config.loadingClass || 'search-loading');\n    }\n  }\n}\n\n// Register with Elementmanager\nElementManager.registerElement('search', SearchElementFactory);","/**\n * Custom Date Picker Component - No Native Input Dependencies\n * Creates a complete calendar UI with dropdown functionality\n */\n\n// Helper functions\nfunction _pad(n) {\n  return n < 10 ? '0' + n : String(n);\n}\n\nfunction _toDateISO(d) {\n  return d.getFullYear() + '-' + _pad(d.getMonth() + 1) + '-' + _pad(d.getDate());\n}\n\nfunction _toTimeHM(d) {\n  return _pad(d.getHours()) + ':' + _pad(d.getMinutes());\n}\n\nfunction _toLocalDateTime(d) {\n  return _toDateISO(d) + 'T' + _toTimeHM(d);\n}\n\n/**\n * Get current locale from I18nManager or browser\n */\nfunction _getCurrentLocale() {\n  // Try I18nManager first (primary source)\n  const i18n = window.Now?.getManager?.('i18n') || window.I18nManager;\n  if (i18n?.getCurrentLocale) {\n    return i18n.getCurrentLocale();\n  }\n\n  // Try LanguageManager (legacy)\n  if (window.LanguageManager?.getCurrentLanguage) {\n    return window.LanguageManager.getCurrentLanguage();\n  }\n\n  // Fallback to browser language\n  const browserLang = navigator.language || navigator.userLanguage || 'en';\n  return browserLang.split('-')[0];\n}\n\n/**\n * Get localized day names (narrow form)\n * Uses Utils.date.getDayNamesNarrow for consistency\n */\nfunction _getDayNames(locale = null) {\n  const loc = locale || _getCurrentLocale();\n  // Use Utils.date if available, fallback to inline\n  if (window.Utils?.date?.getDayNamesNarrow) {\n    return Utils.date.getDayNamesNarrow(loc);\n  }\n  // Fallback\n  const baseLocale = loc.split('-')[0];\n  if (baseLocale === 'th') {\n    return ['อ', 'จ', 'อ', 'พ', 'พ', 'ศ', 'ส'];\n  }\n  return ['S', 'M', 'T', 'W', 'T', 'F', 'S'];\n}\n\n/**\n * Get localized month names (full form)\n * Uses Utils.date.getMonthNames for consistency\n */\nfunction _getMonthNames(locale = null) {\n  const loc = locale || _getCurrentLocale();\n  // Use Utils.date if available, fallback to inline\n  if (window.Utils?.date?.getMonthNames) {\n    return Utils.date.getMonthNames(loc);\n  }\n  // Fallback\n  const baseLocale = loc.split('-')[0];\n  if (baseLocale === 'th') {\n    return [\n      'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน',\n      'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'\n    ];\n  }\n  return [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December'\n  ];\n}\n\n/**\n * Get localized month names (short form)\n * Uses Utils.date.getMonthNamesShort for consistency\n */\nfunction _getMonthNamesShort(locale = null) {\n  const loc = locale || _getCurrentLocale();\n  // Use Utils.date if available, fallback to inline\n  if (window.Utils?.date?.getMonthNamesShort) {\n    return Utils.date.getMonthNamesShort(loc);\n  }\n  // Fallback\n  const baseLocale = loc.split('-')[0];\n  if (baseLocale === 'th') {\n    return [\n      'ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.',\n      'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'\n    ];\n  }\n  return [\n    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n  ];\n}\n\n/**\n * Custom Date Picker - Complete calendar implementation without native inputs\n */\nclass EmbeddedDateTime {\n  constructor(originalElement) {\n    this._original = originalElement;\n    if (!this._original) {\n      throw new Error('EmbeddedDateTime: Original element is required');\n    }\n\n    this.type = (this._original.getAttribute('type') || 'date').toLowerCase();\n    this.name = this._original.getAttribute('name') || '';\n    this.id = this._original.id || ('gdatetime-' + Math.random().toString(36).slice(2, 8));\n\n    // Get current locale\n    this.locale = _getCurrentLocale();\n\n    // Format options (using standard tokens)\n    // data-format: output format for database (always use 'th-CE' for CE year in database)\n    // data-display-format: display format (auto locale-based BE/CE)\n    //\n    // Standard tokens: YYYY, MM, DD, MMMM, MMM, etc.\n    // Locale determines BE/CE: 'th' = BE, 'th-CE' = CE, 'en' = CE\n    //\n    // Examples:\n    //   data-format=\"YYYY-MM-DD\" with locale=\"th-CE\" → \"2000-05-15\" (CE for database)\n    //   data-display-format=\"D MMMM YYYY\" with locale=\"th\" → \"15 พฤษภาคม 2543\" (BE for display)\n    //   data-display-format=\"D MMMM YYYY\" with locale=\"en\" → \"15 May 2000\" (CE for display)\n    this.outputFormat = this._original.getAttribute('data-format') || 'YYYY-MM-DD';\n    this.displayFormat = this._original.getAttribute('data-display-format') || 'D MMM YYYY';\n\n    // Output always uses CE for database compatibility (force 'th-CE' or 'en')\n    this.outputLocale = this.locale.startsWith('th') ? 'th-CE' : 'en';\n    // Display uses current locale (BE for Thai, CE for others)\n    this.displayLocale = this.locale;\n\n    // Initialize state\n    this.selectedDate = null;\n    this.selectedTime = null; // For datetime-local and time types\n    this.currentMonth = new Date().getMonth();\n    this.currentYear = new Date().getFullYear();\n    this.currentView = 'day'; // 'year', 'month', or 'day'\n    this.isOpen = false;\n\n    // Get constraints\n    this.min = this._original.getAttribute('min') || null;\n    this.max = this._original.getAttribute('max') || null;\n    this.required = this._original.hasAttribute('required');\n    this.disabled = this._original.hasAttribute('disabled');\n    this.readonly = this._original.hasAttribute('readonly');\n\n    this._initializeElements();\n    this._setupEventListeners();\n    this._replaceOriginalElement();\n\n    // Set initial value if exists\n    const initialValue = this._original.value || this._original.getAttribute('value');\n    if (initialValue) {\n      this.setValue(initialValue);\n    }\n  }\n\n  _initializeElements() {\n    // Create main wrapper\n    const existingFormControl = this._original.closest('.form-control');\n    if (existingFormControl) {\n      this.wrapper = existingFormControl;\n    } else {\n      this.wrapper = document.createElement('div');\n    }\n    this.wrapper.classList.add('custom-datepicker');\n    this.wrapper.id = this.id + '_wrapper';\n\n    // Create display button\n    this.displayButton = document.createElement('button');\n    this.displayButton.type = 'button';\n    this.displayButton.className = 'dropdown-button';\n    this.wrapper.appendChild(this.displayButton);\n\n    // Create selected items display\n    const display = document.createElement('span');\n    display.className = 'dropdown-display';\n    display.textContent = Now.translate(this._original.placeholder || 'Choose a date');\n    this.displayButton.appendChild(display);\n\n    // Create dropdown arrow\n    const arrow = document.createElement('span');\n    arrow.className = 'dropdown-arrow';\n    this.displayButton.appendChild(arrow);\n\n    // hiddenInput will be assigned in _replaceOriginalElement() as the original element\n    this.hiddenInput = null;\n\n    // Create calendar dropdown (will be moved to DropdownPanel)\n    this.dropdown = document.createElement('div');\n    this.dropdown.className = 'datepicker-dropdown';\n\n    // Get DropdownPanel singleton\n    this.dropdownPanel = DropdownPanel.getInstance();\n\n    this._createCalendarStructure();\n  }\n\n  _createCalendarStructure() {\n    // Calendar header\n    this.calendarHeader = document.createElement('div');\n    this.calendarHeader.className = 'calendar-header';\n\n    // Previous button\n    this.prevButton = document.createElement('button');\n    this.prevButton.type = 'button';\n    this.prevButton.className = 'calendar-nav prev';\n    this.prevButton.innerHTML = '‹';\n    this.calendarHeader.appendChild(this.prevButton);\n\n    // Month/Year display container\n    const displayContainer = document.createElement('div');\n    displayContainer.className = 'month-year-container';\n\n    // Month display (clickable)\n    this.monthDisplay = document.createElement('button');\n    this.monthDisplay.type = 'button';\n    this.monthDisplay.className = 'month-display';\n    displayContainer.appendChild(this.monthDisplay);\n\n    // Year display (clickable)\n    this.yearDisplay = document.createElement('button');\n    this.yearDisplay.type = 'button';\n    this.yearDisplay.className = 'year-display';\n    displayContainer.appendChild(this.yearDisplay);\n\n    this.calendarHeader.appendChild(displayContainer);\n\n    // Next button\n    this.nextButton = document.createElement('button');\n    this.nextButton.type = 'button';\n    this.nextButton.className = 'calendar-nav next';\n    this.nextButton.innerHTML = '›';\n    this.calendarHeader.appendChild(this.nextButton);\n\n    this.dropdown.appendChild(this.calendarHeader);\n\n    // Days of week header (only for day view)\n    this.daysHeader = document.createElement('div');\n    this.daysHeader.className = 'days-header';\n    _getDayNames(this.locale).forEach(day => {\n      const dayElement = document.createElement('div');\n      dayElement.className = 'day-name';\n      dayElement.textContent = day;\n      this.daysHeader.appendChild(dayElement);\n    });\n    this.dropdown.appendChild(this.daysHeader);\n\n    // Calendar grid (multi-purpose: days/months/years)\n    this.calendarGrid = document.createElement('div');\n    this.calendarGrid.className = 'calendar-grid';\n    this.dropdown.appendChild(this.calendarGrid);\n\n    // Time picker section (for datetime-local and time types)\n    if (this.type === 'datetime-local') {\n      this._createTimePicker();\n    }\n  }\n\n  _createTimePicker() {\n    const timePickerSection = document.createElement('div');\n    timePickerSection.className = 'time-picker-section';\n\n    const timeInputs = document.createElement('div');\n    timeInputs.className = 'time-inputs';\n\n    // Hours\n    const hoursGroup = document.createElement('div');\n    hoursGroup.className = 'time-group';\n\n    const hoursInput = document.createElement('input');\n    hoursInput.type = 'number';\n    hoursInput.className = 'time-input hours';\n    hoursInput.min = '0';\n    hoursInput.max = '23';\n    hoursInput.value = '00';\n    hoursInput.placeholder = 'HH';\n    this.hoursInput = hoursInput;\n\n    hoursGroup.appendChild(hoursInput);\n    timeInputs.appendChild(hoursGroup);\n\n    // Separator\n    const separator1 = document.createElement('span');\n    separator1.className = 'time-separator';\n    separator1.textContent = ':';\n    timeInputs.appendChild(separator1);\n\n    // Minutes\n    const minutesGroup = document.createElement('div');\n    minutesGroup.className = 'time-group';\n\n    const minutesInput = document.createElement('input');\n    minutesInput.type = 'number';\n    minutesInput.className = 'time-input minutes';\n    minutesInput.min = '0';\n    minutesInput.max = '59';\n    minutesInput.value = '00';\n    minutesInput.placeholder = 'MM';\n    this.minutesInput = minutesInput;\n\n    minutesGroup.appendChild(minutesInput);\n    timeInputs.appendChild(minutesGroup);\n\n    // Seconds (optional - can be enabled via data-show-seconds)\n    const showSeconds = this._original.getAttribute('data-show-seconds') === 'true';\n    if (showSeconds) {\n      const separator2 = document.createElement('span');\n      separator2.className = 'time-separator';\n      separator2.textContent = ':';\n      timeInputs.appendChild(separator2);\n\n      const secondsGroup = document.createElement('div');\n      secondsGroup.className = 'time-group';\n\n      const secondsInput = document.createElement('input');\n      secondsInput.type = 'number';\n      secondsInput.className = 'time-input seconds';\n      secondsInput.min = '0';\n      secondsInput.max = '59';\n      secondsInput.value = '00';\n      secondsInput.placeholder = 'SS';\n      this.secondsInput = secondsInput;\n\n      secondsGroup.appendChild(secondsInput);\n      timeInputs.appendChild(secondsGroup);\n    }\n\n    timePickerSection.appendChild(timeInputs);\n    this.dropdown.appendChild(timePickerSection);\n\n    // Setup time input events\n    this._setupTimeInputEvents();\n  }\n\n  _setupTimeInputEvents() {\n    const validateAndFormat = (input, max) => {\n      let value = parseInt(input.value) || 0;\n      if (value < 0) value = 0;\n      if (value > max) value = max;\n      input.value = _pad(value);\n    };\n\n    if (this.hoursInput) {\n      this.hoursInput.addEventListener('input', (e) => {\n        if (e.target.value.length >= 2) {\n          validateAndFormat(e.target, 23);\n          if (this.minutesInput) this.minutesInput.focus();\n        }\n      });\n\n      this.hoursInput.addEventListener('blur', (e) => {\n        validateAndFormat(e.target, 23);\n      });\n    }\n\n    if (this.minutesInput) {\n      this.minutesInput.addEventListener('input', (e) => {\n        if (e.target.value.length >= 2) {\n          validateAndFormat(e.target, 59);\n          if (this.secondsInput) this.secondsInput.focus();\n        }\n      });\n\n      this.minutesInput.addEventListener('blur', (e) => {\n        validateAndFormat(e.target, 59);\n      });\n    }\n\n    if (this.secondsInput) {\n      this.secondsInput.addEventListener('input', (e) => {\n        if (e.target.value.length >= 2) {\n          validateAndFormat(e.target, 59);\n        }\n      });\n\n      this.secondsInput.addEventListener('blur', (e) => {\n        validateAndFormat(e.target, 59);\n      });\n    }\n  }\n\n  _setupEventListeners() {\n    // Display button click\n    this.displayButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      if (this.disabled || this.readonly) return;\n      this.toggle();\n    });\n\n    // Month display click - go to month picker\n    this.monthDisplay.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.currentView = 'month';\n      this._renderCurrentView();\n    });\n\n    // Year display click - go to year picker\n    this.yearDisplay.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation(); // Prevent dropdown from closing\n      this.currentView = 'year';\n      this._renderCurrentView();\n    });\n\n    // Navigation buttons\n    this.prevButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation(); // Prevent dropdown from closing\n      this._navigatePrevious();\n    });\n\n    this.nextButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation(); // Prevent dropdown from closing\n      this._navigateNext();\n    });\n\n    // Keyboard navigation\n    this.wrapper.addEventListener('keydown', (e) => {\n      if (this.disabled || this.readonly) return;\n\n      switch (e.key) {\n        case 'Enter':\n        case ' ':\n          e.preventDefault();\n          this.toggle();\n          break;\n        case 'Escape':\n          e.preventDefault();\n          this.close();\n          break;\n      }\n    });\n\n    // Copy/Paste support\n    this.wrapper.addEventListener('copy', (e) => {\n      if (this.hiddenInput.value) {\n        e.preventDefault();\n        e.clipboardData.setData('text/plain', this.hiddenInput.value);\n      }\n    });\n\n    this.wrapper.addEventListener('paste', (e) => {\n      if (this.disabled || this.readonly) return;\n      e.preventDefault();\n      const pastedText = e.clipboardData.getData('text/plain').trim();\n      if (pastedText) {\n        this.setValue(pastedText);\n      }\n    });\n\n    // Listen for locale changes to re-render with new language\n    this._localeChangeHandler = () => {\n      this._updateLocale();\n    };\n    if (window.EventManager?.on) {\n      EventManager.on('locale:changed', this._localeChangeHandler);\n    }\n  }\n\n  /**\n   * Update locale and re-render UI when language changes\n   */\n  _updateLocale() {\n    // Update locale\n    const newLocale = _getCurrentLocale();\n    if (newLocale === this.locale) return;\n\n    this.locale = newLocale;\n    this.outputLocale = this.locale.startsWith('th') ? 'th-CE' : 'en';\n    this.displayLocale = this.locale;\n\n    // Update days header\n    this.daysHeader.innerHTML = '';\n    _getDayNames(this.locale).forEach(day => {\n      const dayElement = document.createElement('div');\n      dayElement.className = 'day-name';\n      dayElement.textContent = day;\n      this.daysHeader.appendChild(dayElement);\n    });\n\n    // Update display value if date is selected\n    if (this.selectedDate) {\n      const displayValue = Utils.date.format(this.selectedDate, this.displayFormat, this.displayLocale);\n      if (this.type === 'datetime-local' && this.hoursInput && this.minutesInput) {\n        const hours = parseInt(this.hoursInput.value) || 0;\n        const minutes = parseInt(this.minutesInput.value) || 0;\n        this.displayButton.firstChild.textContent = displayValue + ' ' + _pad(hours) + ':' + _pad(minutes);\n      } else {\n        this.displayButton.firstChild.textContent = displayValue;\n      }\n    }\n\n    // Re-render current view if open\n    if (this.isOpen) {\n      this._renderCurrentView();\n    }\n  }\n\n  _navigatePrevious() {\n    switch (this.currentView) {\n      case 'day':\n        this.previousMonth();\n        break;\n      case 'month':\n        this.currentYear--;\n        this._renderCurrentView();\n        break;\n      case 'year':\n        this.currentYear -= 12;\n        this._renderCurrentView();\n        break;\n    }\n  }\n\n  _navigateNext() {\n    switch (this.currentView) {\n      case 'day':\n        this.nextMonth();\n        break;\n      case 'month':\n        this.currentYear++;\n        this._renderCurrentView();\n        break;\n      case 'year':\n        this.currentYear += 12;\n        this._renderCurrentView();\n        break;\n    }\n  }\n\n  _renderCurrentView() {\n    switch (this.currentView) {\n      case 'year':\n        this._renderYearPicker();\n        break;\n      case 'month':\n        this._renderMonthPicker();\n        break;\n      case 'day':\n      default:\n        this._renderCalendar();\n        break;\n    }\n  }\n\n  _renderYearPicker() {\n    const startYear = this.currentYear - (this.currentYear % 12);\n    const endYear = startYear + 11;\n\n    // Use BE for Thai locale, CE for others\n    const useBE = this.displayLocale === 'th';\n    const displayStartYear = useBE ? startYear + 543 : startYear;\n    const displayEndYear = useBE ? endYear + 543 : endYear;\n\n    this.yearDisplay.textContent = `${displayStartYear} - ${displayEndYear}`;\n    this.yearDisplay.style.flex = '1';\n    this.yearDisplay.style.display = null;\n    this.monthDisplay.textContent = '';\n    this.monthDisplay.style.display = 'none';\n\n    // Hide days header\n    this.daysHeader.style.display = 'none';\n\n    // Clear and setup grid for years\n    this.calendarGrid.innerHTML = '';\n    this.calendarGrid.className = 'calendar-grid year-grid';\n\n    // Create year buttons (12 years)\n    for (let i = 0; i < 12; i++) {\n      const year = startYear + i;\n      const yearButton = document.createElement('button');\n      yearButton.type = 'button';\n      yearButton.className = 'calendar-year';\n\n      // Show year BE or CE according to locale\n      const displayYear = useBE ? year + 543 : year;\n      yearButton.textContent = displayYear;\n\n      // Highlight current year\n      if (year === new Date().getFullYear()) {\n        yearButton.classList.add('today');\n      }\n\n      if (year === this.currentYear) {\n        yearButton.classList.add('selected');\n      }\n\n      yearButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation(); // Prevent dropdown from closing\n        this.currentYear = year;\n        this.currentView = 'month'; // Go to month view\n        this._renderCurrentView();\n      });\n\n      this.calendarGrid.appendChild(yearButton);\n    }\n  }\n\n  _renderMonthPicker() {\n    // Use BE for Thai locale, CE for others\n    const useBE = this.displayLocale === 'th';\n    const displayYear = useBE ? this.currentYear + 543 : this.currentYear;\n\n    this.yearDisplay.textContent = displayYear;\n    this.yearDisplay.style.flex = '1';\n    this.monthDisplay.textContent = '';\n    this.monthDisplay.style.display = 'none';\n\n    // Hide days header\n    this.daysHeader.style.display = 'none';\n\n    // Clear and setup grid for months\n    this.calendarGrid.innerHTML = '';\n    this.calendarGrid.className = 'calendar-grid month-grid';\n\n    // Create month buttons (12 months)\n    for (let i = 0; i < 12; i++) {\n      const monthButton = document.createElement('button');\n      monthButton.type = 'button';\n      monthButton.className = 'calendar-month';\n      monthButton.textContent = _getMonthNamesShort(this.locale)[i];\n\n      // Highlight current month\n      const now = new Date();\n      if (i === now.getMonth() && this.currentYear === now.getFullYear()) {\n        monthButton.classList.add('today');\n      }\n\n      if (i === this.currentMonth) {\n        monthButton.classList.add('selected');\n      }\n\n      monthButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation(); // Prevent dropdown from closing\n        this.currentMonth = i;\n        this.currentView = 'day'; // Go to day view\n        this._renderCurrentView();\n      });\n\n      this.calendarGrid.appendChild(monthButton);\n    }\n  }\n\n  _renderCalendar() {\n    // Use BE for Thai locale, CE for others\n    const useBE = this.displayLocale === 'th';\n    const displayYear = useBE ? this.currentYear + 543 : this.currentYear;\n\n    this.monthDisplay.textContent = _getMonthNames(this.locale)[this.currentMonth];\n    this.monthDisplay.style.display = '';\n    this.yearDisplay.textContent = displayYear;\n    this.monthDisplay.style.flex = '';\n    this.yearDisplay.style.flex = '';\n\n    // Show days header\n    this.daysHeader.style.display = 'grid';\n\n    // Reset grid class\n    this.calendarGrid.className = 'calendar-grid';\n\n    // Clear calendar grid\n    this.calendarGrid.innerHTML = '';\n\n    // Get first day of month and number of days\n    const firstDay = new Date(this.currentYear, this.currentMonth, 1);\n    const lastDay = new Date(this.currentYear, this.currentMonth + 1, 0);\n    const startDate = new Date(firstDay);\n    startDate.setDate(startDate.getDate() - firstDay.getDay());\n\n    // Create 6 weeks of days (42 days total)\n    for (let i = 0; i < 42; i++) {\n      const currentDate = new Date(startDate);\n      currentDate.setDate(startDate.getDate() + i);\n\n      const dayElement = document.createElement('button');\n      dayElement.type = 'button';\n      dayElement.className = 'calendar-day';\n      dayElement.textContent = currentDate.getDate();\n\n      // Add classes for styling\n      if (currentDate.getMonth() !== this.currentMonth) {\n        dayElement.classList.add('other-month');\n      }\n\n      if (this._isSameDate(currentDate, new Date())) {\n        dayElement.classList.add('today');\n      }\n\n      if (this.selectedDate && this._isSameDate(currentDate, this.selectedDate)) {\n        dayElement.classList.add('selected');\n      }\n\n      // Check if date is disabled\n      if (this._isDateDisabled(currentDate)) {\n        dayElement.disabled = true;\n        dayElement.classList.add('disabled');\n      } else {\n        dayElement.addEventListener('click', (e) => {\n          e.preventDefault();\n          e.stopPropagation(); // Prevent dropdown from closing\n          this.selectDate(currentDate);\n        });\n      }\n\n      this.calendarGrid.appendChild(dayElement);\n    }\n  }\n\n  _isSameDate(date1, date2) {\n    return date1.getFullYear() === date2.getFullYear() &&\n      date1.getMonth() === date2.getMonth() &&\n      date1.getDate() === date2.getDate();\n  }\n\n  _isDateDisabled(date) {\n    if (this.min) {\n      const minDate = new Date(this.min);\n      if (date < minDate) return true;\n    }\n\n    if (this.max) {\n      const maxDate = new Date(this.max);\n      if (date > maxDate) return true;\n    }\n\n    return false;\n  }\n\n  // Public methods\n  open() {\n    if (this.disabled || this.readonly || this.isOpen) return;\n\n    this.isOpen = true;\n\n    // Hide/show calendar elements based on type\n    if (this.type === 'time') {\n      // For time picker, hide calendar elements\n      this.calendarHeader.style.display = 'none';\n      this.daysHeader.style.display = 'none';\n      this.calendarGrid.style.display = 'none';\n    } else {\n      // Show calendar elements for date/datetime-local\n      this.calendarHeader.style.display = '';\n      this.daysHeader.style.display = '';\n      this.calendarGrid.style.display = '';\n      this.currentView = 'day'; // Start at day view\n      this._renderCurrentView();\n    }\n\n    // Show dropdown in DropdownPanel\n    this.dropdownPanel.show(this.wrapper, this.dropdown, {\n      align: 'left',\n      offsetY: 5,\n      onClose: () => {\n        this.isOpen = false;\n        // Dispatch close event\n        this.wrapper.dispatchEvent(new CustomEvent('gdatetime:close', {\n          detail: {type: this.type, value: this.selectedDate}\n        }));\n      }\n    });\n\n    // Focus time input if time type\n    if (this.type === 'time' && this.hoursInput) {\n      setTimeout(() => {\n        this.hoursInput.focus();\n        this.hoursInput.select();\n      }, 50);\n    }\n\n    // Dispatch event\n    this.wrapper.dispatchEvent(new CustomEvent('gdatetime:open', {\n      detail: {type: this.type, value: this.selectedDate}\n    }));\n  }\n\n  close() {\n    if (!this.isOpen) return;\n\n    // Hide the DropdownPanel (will trigger onClose callback)\n    this.dropdownPanel.hide();\n  }\n\n  toggle() {\n    if (this.isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  selectDate(date) {\n    this.selectedDate = new Date(date);\n\n    let outputValue, displayValue;\n\n    if (this.type === 'datetime-local') {\n      // Get time from inputs or use current time\n      const hours = this.hoursInput ? parseInt(this.hoursInput.value) || 0 : this.selectedDate.getHours();\n      const minutes = this.minutesInput ? parseInt(this.minutesInput.value) || 0 : this.selectedDate.getMinutes();\n      const seconds = this.secondsInput ? parseInt(this.secondsInput.value) || 0 : 0;\n\n      this.selectedDate.setHours(hours, minutes, seconds, 0);\n\n      // Format: YYYY-MM-DDTHH:MM:SS or YYYY-MM-DDTHH:MM\n      outputValue = _toLocalDateTime(this.selectedDate);\n      if (this.secondsInput) {\n        outputValue += ':' + _pad(seconds);\n      }\n\n      // Display format\n      displayValue = Utils.date.format(this.selectedDate, this.displayFormat, this.displayLocale) + ' ' +\n        _pad(hours) + ':' + _pad(minutes);\n      if (this.secondsInput) {\n        displayValue += ':' + _pad(seconds);\n      }\n\n    } else if (this.type === 'time') {\n      // Time only\n      const hours = this.hoursInput ? parseInt(this.hoursInput.value) || 0 : 0;\n      const minutes = this.minutesInput ? parseInt(this.minutesInput.value) || 0 : 0;\n      const seconds = this.secondsInput ? parseInt(this.secondsInput.value) || 0 : 0;\n\n      outputValue = _pad(hours) + ':' + _pad(minutes);\n      if (this.secondsInput) {\n        outputValue += ':' + _pad(seconds);\n      }\n      displayValue = outputValue;\n\n    } else {\n      // Date only - output uses CE year for database, display uses locale (BE/CE)\n      outputValue = Utils.date.format(this.selectedDate, this.outputFormat, this.outputLocale);\n      displayValue = Utils.date.format(this.selectedDate, this.displayFormat, this.displayLocale);\n    }\n\n    this.hiddenInput.value = outputValue;\n    this.hiddenInput.setAttribute('value', outputValue);\n    this.displayButton.firstChild.textContent = displayValue;\n\n    // Don't auto-close for datetime-local (let user set time)\n    if (this.type !== 'datetime-local') {\n      this.close();\n    }\n\n    // Focus to wrapper\n    setTimeout(() => {\n      this.wrapper.focus();\n    }, 0);\n\n    // Dispatch events\n    const changeEvent = new Event('change', {bubbles: true});\n    this.hiddenInput.dispatchEvent(changeEvent);\n\n    this.wrapper.dispatchEvent(new CustomEvent('gdatetime:change', {\n      detail: {\n        type: this.type,\n        value: this.hiddenInput.value,\n        date: this.selectedDate\n      }\n    }));\n  }\n\n  previousMonth() {\n    this.currentMonth--;\n    if (this.currentMonth < 0) {\n      this.currentMonth = 11;\n      this.currentYear--;\n    }\n    this._renderCurrentView();\n  }\n\n  nextMonth() {\n    this.currentMonth++;\n    if (this.currentMonth > 11) {\n      this.currentMonth = 0;\n      this.currentYear++;\n    }\n    this._renderCurrentView();\n  }\n\n  setValue(value) {\n    if (!value || value === '') {\n      this.selectedDate = null;\n      this.selectedTime = null;\n      this.hiddenInput.value = '';\n      this.hiddenInput.setAttribute('value', '');\n\n      const placeholder = this.type === 'time' ? 'Choose time' :\n        this.type === 'datetime-local' ? 'Choose date and time' :\n          'Choose a date';\n      this.displayButton.firstChild.textContent = Now.translate(this._original.placeholder || placeholder);\n\n      // Reset time inputs\n      if (this.hoursInput) this.hoursInput.value = '00';\n      if (this.minutesInput) this.minutesInput.value = '00';\n      if (this.secondsInput) this.secondsInput.value = '00';\n      return;\n    }\n\n    if (this.type === 'time') {\n      // Parse time value (HH:MM or HH:MM:SS)\n      const timeParts = value.split(':');\n      if (timeParts.length >= 2) {\n        const hours = parseInt(timeParts[0]) || 0;\n        const minutes = parseInt(timeParts[1]) || 0;\n        const seconds = timeParts[2] ? parseInt(timeParts[2]) || 0 : 0;\n\n        if (this.hoursInput) this.hoursInput.value = _pad(hours);\n        if (this.minutesInput) this.minutesInput.value = _pad(minutes);\n        if (this.secondsInput) this.secondsInput.value = _pad(seconds);\n\n        this.hiddenInput.value = value;\n        this.hiddenInput.setAttribute('value', value);\n        this.displayButton.firstChild.textContent = value;\n        return;\n      }\n    }\n\n    // Parse date or datetime-local value\n    const date = new Date(value);\n    if (isNaN(date.getTime())) {\n      console.warn('Invalid date value:', value);\n      return;\n    }\n\n    this.selectedDate = date;\n    this.currentMonth = date.getMonth();\n    this.currentYear = date.getFullYear();\n\n    if (this.type === 'datetime-local') {\n      // Extract time components\n      const hours = date.getHours();\n      const minutes = date.getMinutes();\n      const seconds = date.getSeconds();\n\n      if (this.hoursInput) this.hoursInput.value = _pad(hours);\n      if (this.minutesInput) this.minutesInput.value = _pad(minutes);\n      if (this.secondsInput) this.secondsInput.value = _pad(seconds);\n\n      // Format output\n      let outputValue = _toLocalDateTime(date);\n      if (this.secondsInput) {\n        outputValue += ':' + _pad(seconds);\n      }\n      this.hiddenInput.value = outputValue;\n      this.hiddenInput.setAttribute('value', outputValue);\n\n      // Format display using current locale\n      const displayValue = Utils.date.format(date, this.displayFormat, this.displayLocale) + ' ' +\n        _pad(hours) + ':' + _pad(minutes);\n      this.displayButton.firstChild.textContent = displayValue + (this.secondsInput ? ':' + _pad(seconds) : '');\n\n    } else {\n      // Date only - output uses CE year for database, display uses locale (BE/CE)\n      const outputValue = Utils.date.format(this.selectedDate, this.outputFormat, this.outputLocale);\n      this.hiddenInput.value = outputValue;\n      this.hiddenInput.setAttribute('value', outputValue);\n\n      const displayValue = Utils.date.format(this.selectedDate, this.displayFormat, this.displayLocale);\n      this.displayButton.firstChild.textContent = displayValue;\n    }\n  }\n\n  getValue() {\n    return this.hiddenInput.value || null;\n  }\n\n  getDate() {\n    return this.selectedDate;\n  }\n\n  destroy() {\n    // Close dropdown if open\n    if (this.isOpen) {\n      this.close();\n    }\n\n    // Remove locale change listener\n    if (this._localeChangeHandler && window.EventManager?.off) {\n      EventManager.off('locale:changed', this._localeChangeHandler);\n    }\n\n    if (this.wrapper && this.wrapper.parentNode) {\n      this.wrapper.parentNode.removeChild(this.wrapper);\n    }\n  }\n\n  getElement() {\n    return this.wrapper;\n  }\n\n  _replaceOriginalElement() {\n    if (this._original.parentNode) {\n      // Hide original element but don't remove it, so form can still read value\n      this._original.type = 'hidden';\n      this._original.style.display = 'none';\n\n      // Use original element as hiddenInput\n      this.hiddenInput = this._original;\n\n      // Insert wrapper before original element only if wrapper is not already the parent\n      if (this._original.parentNode !== this.wrapper) {\n        this._original.parentNode.insertBefore(this.wrapper, this._original);\n      }\n    }\n  }\n}\n\n/**\n * DateElementFactory - Factory for creating custom date picker elements\n */\nclass DateElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    type: 'date'\n  };\n\n  static createInstance(element, config = {}) {\n    const instance = super.createInstance(element, config);\n    return instance;\n  }\n\n  static setupElement(instance) {\n    const {element} = instance;\n\n    try {\n      const gdatetime = new EmbeddedDateTime(element);\n\n      instance.wrapper = gdatetime.getElement();\n      instance.gdatetime = gdatetime;\n\n      // Bind methods\n      instance.getValue = () => gdatetime.getValue();\n      instance.setValue = (value) => gdatetime.setValue(value);\n      instance.getDate = () => gdatetime.getDate();\n      instance.open = () => gdatetime.open();\n      instance.close = () => gdatetime.close();\n      instance.toggle = () => gdatetime.toggle();\n\n      // Update element reference\n      element.wrapper = instance.wrapper;\n\n      // Setup event forwarding\n      if (gdatetime.hiddenInput) {\n        gdatetime.hiddenInput.addEventListener('change', (e) => {\n          // Prevent infinite loop: don't re-dispatch if event came from element itself\n          if (e.target === element) return;\n\n          // Dispatch standard change event\n          const changeEvent = new Event('change', {bubbles: true});\n          element.dispatchEvent(changeEvent);\n\n          // Emit to event system\n          EventManager.emit('element:change', {\n            elementId: element.id,\n            value: gdatetime.getValue(),\n            type: 'date'\n          });\n        });\n      }\n\n      // Cleanup override\n      const originalCleanup = instance.cleanup;\n      instance.cleanup = function() {\n        if (this.gdatetime) {\n          this.gdatetime.destroy();\n          this.gdatetime = null;\n        }\n        if (originalCleanup) {\n          originalCleanup.call(this);\n        }\n        return this;\n      };\n\n      return instance;\n\n    } catch (error) {\n      console.error('DateElementFactory: Failed to setup element:', error);\n      return instance;\n    }\n  }\n}\n\n// Register with ElementManager\nElementManager.registerElement('date', DateElementFactory);\nElementManager.registerElement('datetime-local', DateElementFactory);\n\n// Expose globally\nwindow.DateElementFactory = DateElementFactory;","/**\n * Custom Color Picker Component - No Native Input Dependencies\n * Creates a complete color picker UI with dropdown functionality\n */\n\n// Predefined color palette\nconst COLOR_PALETTE = [\n  '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',\n  '#FFA500', '#800080', '#008000', '#800000', '#000080', '#808000',\n  '#008080', '#808080', '#A52A2A', '#FA8072', '#4682B4', '#D2691E',\n  '#2E8B57', '#FFD700', '#DA70D6', '#C71585', '#40E0D0', '#F0E68C',\n  '#ADD8E6', '#90EE90', '#FF69B4', '#B0C4DE', '#EEE8AA', '#98FB98',\n  '#F5F5DC', '#FFE4E1', '#F08080', '#E0FFFF', '#D8BFD8', '#F4A460',\n  '#BC8F8F', '#CD5C5C', '#6B8E23', '#556B2F', '#8FBC8F', '#483D8B',\n  '#B8860B', '#A9A9A9', '#3CB371', '#BA55D3', '#9370DB', '#66CDAA',\n  '#7B68EE', '#708090', '#FFFFFF', '#000000'\n];\n\n/**\n * Enhanced Color Picker implementation\n */\nclass EmbeddedColorPicker {\n  constructor(originalElement) {\n    this._original = originalElement;\n    if (!this._original) {\n      throw new Error('ColorPicker: Original element is required');\n    }\n\n    this.name = this._original.getAttribute('name') || '';\n    this.id = this._original.id || ('colorpicker-' + Math.random().toString(36).slice(2, 8));\n\n    // Initialize state\n    this.selectedColor = '';\n    this.isOpen = false;\n    this.disabled = this._original.hasAttribute('disabled');\n    this.readonly = this._original.hasAttribute('readonly');\n\n    // Set initial value if exists\n    const initialValue = this._original.getAttribute('value');\n    const currentValue = this._original.value;\n\n    this._initializeElements();\n    this._setupEventListeners();\n    this._replaceOriginalElement();\n\n    // Only set color if there's an explicit value attribute or non-default value\n    if (initialValue && initialValue !== '') {\n      this.setColor(initialValue);\n    } else if (currentValue && currentValue !== '' && this._original.hasAttribute('value')) {\n      this.setColor(currentValue);\n    } else {\n      // Clear any default value - leave empty\n      this.selectedColor = '';\n      window.setTimeout(() => {\n        this.hiddenInput.value = '';\n        this.hiddenInput.removeAttribute('value');\n      }, 0);\n    }\n  }\n\n  _initializeElements() {\n    // Create main wrapper\n    const existingFormControl = this._original.closest('.form-control');\n    if (existingFormControl) {\n      this.wrapper = existingFormControl;\n    } else {\n      this.wrapper = document.createElement('div');\n    }\n    this.wrapper.classList.add('custom-colorpicker');\n    this.wrapper.id = this.id + '_wrapper';\n\n    // Create display button\n    this.displayButton = document.createElement('button');\n    this.displayButton.type = 'button';\n    this.displayButton.className = 'dropdown-button';\n    this.displayButton.innerHTML = `\n      <span class=\"dropdown-display\">${Now.translate(this._original.placeholder || 'Choose a color')}</span>\n      <span class=\"dropdown-arrow\"></span>\n    `;\n    this.wrapper.appendChild(this.displayButton);\n\n    // Get references to child elements\n    this.colorText = this.displayButton.querySelector('.dropdown-display');\n\n    this.hiddenInput = null;\n\n    // Create color picker dropdown (will be moved to DropdownPanel)\n    this.dropdown = document.createElement('div');\n    this.dropdown.className = 'colorpicker-dropdown';\n\n    // Get DropdownPanel singleton\n    this.dropdownPanel = DropdownPanel.getInstance();\n\n    this._createColorPalette();\n  }\n\n  _createColorPalette() {\n    // Create color input section\n    const inputSection = document.createElement('div');\n    inputSection.className = 'color-input-section';\n\n    const hexInput = document.createElement('input');\n    hexInput.type = 'text';\n    hexInput.className = 'hex-input';\n    hexInput.placeholder = '#000000';\n    hexInput.maxLength = 7;\n    this.hexInput = hexInput;\n\n    const clearButton = document.createElement('button');\n    clearButton.type = 'button';\n    clearButton.className = 'clear-color-btn';\n    clearButton.textContent = Now.translate('Clear');\n\n    inputSection.appendChild(hexInput);\n    inputSection.appendChild(clearButton);\n    this.dropdown.appendChild(inputSection);\n\n    // Create palette sections\n    this._createPaletteSection('Basic Colors', COLOR_PALETTE, 'basic-colors');\n\n    // Setup input section events\n    hexInput.addEventListener('input', (e) => {\n      let value = e.target.value;\n      if (!value.startsWith('#') && value.length > 0) {\n        value = '#' + value;\n        e.target.value = value;\n      }\n\n      if (this._isValidColor(value)) {\n        this._previewColor(value);\n      }\n    });\n\n    hexInput.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        const color = e.target.value;\n        if (this._isValidColor(color)) {\n          this.selectColor(color);\n        }\n      }\n    });\n\n    // Select all text on focus\n    hexInput.addEventListener('focus', (e) => {\n      e.target.select();\n    });\n\n    // Copy/Paste support for hex input\n    hexInput.addEventListener('paste', (e) => {\n      e.stopPropagation(); // Prevent triggering dropdown paste event\n      setTimeout(() => {\n        let value = e.target.value.trim();\n        // Add # if missing\n        if (value && !value.startsWith('#') && /^[A-Fa-f0-9]{3,6}$/.test(value)) {\n          value = '#' + value;\n          e.target.value = value;\n        }\n        if (this._isValidColor(value)) {\n          this._previewColor(value);\n        }\n      }, 0);\n    });\n\n    clearButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.selectColor('');\n    });\n  }\n\n  _createPaletteSection(title, colors, className) {\n    const section = document.createElement('div');\n    section.className = `palette-section ${className}`;\n\n    const palette = document.createElement('div');\n    palette.className = 'color-palette';\n\n    colors.forEach((color, index) => {\n      const colorButton = document.createElement('button');\n      colorButton.type = 'button';\n      colorButton.className = 'color-swatch';\n      colorButton.style.backgroundColor = color;\n      colorButton.title = color;\n      colorButton.setAttribute('data-color', color);\n\n      // Add accessibility\n      colorButton.setAttribute('aria-label', `Select color ${color}`);\n\n      colorButton.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.selectColor(color);\n      });\n\n      colorButton.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          this.selectColor(color);\n        }\n      });\n\n      palette.appendChild(colorButton);\n    });\n\n    section.appendChild(palette);\n    this.dropdown.appendChild(section);\n  }\n\n  _setupEventListeners() {\n    // Display button click\n    this.displayButton.addEventListener('click', (e) => {\n      e.preventDefault();\n      if (this.disabled || this.readonly) return;\n      this.toggle();\n    });\n\n    // Keyboard navigation\n    this.wrapper.addEventListener('keydown', (e) => {\n      if (this.disabled || this.readonly) return;\n\n      switch (e.key) {\n        case 'Enter':\n        case ' ':\n          e.preventDefault();\n          this.toggle();\n          break;\n        case 'Escape':\n          e.preventDefault();\n          this.close();\n          break;\n      }\n    });\n\n    // Copy/Paste support - works on wrapper, button, and dropdown\n    const setupCopyPaste = (element) => {\n      element.addEventListener('copy', (e) => {\n        if (this.hiddenInput.value) {\n          e.preventDefault();\n          e.stopPropagation();\n          e.clipboardData.setData('text/plain', this.hiddenInput.value);\n        }\n      });\n\n      element.addEventListener('paste', (e) => {\n        if (this.disabled || this.readonly) return;\n        e.preventDefault();\n        e.stopPropagation();\n        let pastedText = e.clipboardData.getData('text/plain').trim();\n\n        // Add # if missing\n        if (pastedText && !pastedText.startsWith('#') && /^[A-Fa-f0-9]{3,6}$/.test(pastedText)) {\n          pastedText = '#' + pastedText;\n        }\n\n        if (pastedText && this._isValidColor(pastedText)) {\n          this.setColor(pastedText);\n          // Close dropdown after paste\n          if (this.isOpen) {\n            this.close();\n          }\n        }\n      });\n    };\n\n    setupCopyPaste(this.wrapper);\n    setupCopyPaste(this.displayButton);\n    setupCopyPaste(this.dropdown);\n  }\n\n  _isValidColor(color) {\n    if (!color) return true; // Empty is valid (means no color)\n\n    // Check hex color format\n    const hexPattern = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\n    return hexPattern.test(color);\n  }\n\n  _previewColor(color) {\n    if (color) {\n      this.wrapper.style.backgroundColor = color;\n      this.wrapper.style.color = this._getContrastColor(color);\n      this.colorText.textContent = color.toUpperCase();\n    }\n  }\n\n  _getContrastColor(hexColor) {\n    // Convert hex to RGB\n    const r = parseInt(hexColor.slice(1, 3), 16);\n    const g = parseInt(hexColor.slice(3, 5), 16);\n    const b = parseInt(hexColor.slice(5, 7), 16);\n\n    // Calculate luminance\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n\n    return luminance > 0.5 ? '#000000' : '#FFFFFF';\n  }\n\n  // Public methods\n  open() {\n    if (this.disabled || this.readonly || this.isOpen) return;\n\n    this.isOpen = true;\n    this.wrapper.classList.add('open');\n\n    // Update hex input with current color\n    if (this.selectedColor) {\n      this.hexInput.value = this.selectedColor;\n    } else {\n      this.hexInput.value = '';\n    }\n\n    // Show dropdown in DropdownPanel\n    this.dropdownPanel.show(this.wrapper, this.dropdown, {\n      align: 'left',\n      offsetY: 5,\n      onClose: () => {\n        this.isOpen = false;\n        this.wrapper.classList.remove('open');\n        // Dispatch close event\n        this.wrapper.dispatchEvent(new CustomEvent('colorpicker:close', {\n          detail: {color: this.selectedColor}\n        }));\n      }\n    });\n\n    // Focus hex input after panel is shown and select all text\n    if (this.hexInput) {\n      setTimeout(() => {\n        this.hexInput.focus();\n        this.hexInput.select();\n      }, 50);\n    }\n\n    // Dispatch event\n    this.wrapper.dispatchEvent(new CustomEvent('colorpicker:open', {\n      detail: {color: this.selectedColor}\n    }));\n  }\n\n  close() {\n    if (!this.isOpen) return;\n\n    // Hide the DropdownPanel (will trigger onClose callback)\n    this.dropdownPanel.hide();\n  }\n\n  toggle() {\n    if (this.isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  selectColor(color) {\n    this.selectedColor = color;\n    this.hiddenInput.value = color;\n    this.hiddenInput.setAttribute('value', color);\n\n    if (color) {\n      this.wrapper.style.backgroundColor = color;\n      this.wrapper.style.color = this._getContrastColor(color);\n      this.colorText.textContent = color.toUpperCase();\n      this.colorText.style.color = this._getContrastColor(color);\n    } else {\n      this.wrapper.style.backgroundColor = '';\n      this.wrapper.style.color = '';\n      this.colorText.textContent = Now.translate(this._original.placeholder || 'Choose a color');\n      this.colorText.style.color = '';\n    }\n\n    // Update selected state in palette\n    this.dropdown.querySelectorAll('.color-swatch').forEach(swatch => {\n      swatch.classList.remove('selected');\n      if (swatch.getAttribute('data-color') === color) {\n        swatch.classList.add('selected');\n      }\n    });\n\n    this.close();\n\n    // Focus to wrapper\n    setTimeout(() => {\n      this.wrapper.focus();\n    }, 0);\n\n    // Dispatch events\n    const changeEvent = new Event('change', {bubbles: true});\n    this.hiddenInput.dispatchEvent(changeEvent);\n\n    this.wrapper.dispatchEvent(new CustomEvent('colorpicker:change', {\n      detail: {\n        color: color,\n        rgb: color ? this._hexToRgb(color) : null\n      }\n    }));\n  }\n\n  _hexToRgb(hex) {\n    if (!hex) return null;\n\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16)\n    } : null;\n  }\n\n  setColor(color) {\n    if (this._isValidColor(color)) {\n      this.selectColor(color);\n    }\n  }\n\n  getColor() {\n    return this.hiddenInput.value || null;\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.wrapper.classList.toggle('disabled', disabled);\n    this.displayButton.disabled = disabled;\n    if (disabled) {\n      this.close();\n    }\n  }\n\n  setReadonly(readonly) {\n    this.readonly = readonly;\n    this.wrapper.classList.toggle('readonly', readonly);\n    if (readonly) {\n      this.close();\n    }\n  }\n\n  destroy() {\n    if (this.wrapper && this.wrapper.parentNode) {\n      this.wrapper.parentNode.removeChild(this.wrapper);\n    }\n  }\n\n  getElement() {\n    return this.wrapper;\n  }\n\n  _replaceOriginalElement() {\n    if (this._original.parentNode) {\n      // Hide original element but keep it in the DOM for form submission\n      this._original.type = 'hidden';\n      this._original.style.display = 'none';\n\n      // Use original element as hiddenInput\n      this.hiddenInput = this._original;\n\n      // Insert wrapper before original element only if wrapper is not already the parent\n      if (this._original.parentNode !== this.wrapper) {\n        this._original.parentNode.insertBefore(this.wrapper, this._original);\n      }\n    }\n  }\n}\n\n// Expose globally\nwindow.EmbeddedColorPicker = EmbeddedColorPicker;\n\n/**\n * ColorElementFactory - Factory for creating custom color picker elements\n */\nclass ColorElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    type: 'color'\n  };\n\n  static createInstance(element, config = {}) {\n    const instance = super.createInstance(element, config);\n    return instance;\n  }\n\n  static setupElement(instance) {\n    const {element} = instance;\n\n    try {\n      const colorPicker = new EmbeddedColorPicker(element);\n\n      instance.wrapper = colorPicker.getElement();\n      instance.colorPicker = colorPicker;\n\n      // Bind methods\n      instance.getColor = () => colorPicker.getColor();\n      instance.setColor = (color) => colorPicker.setColor(color);\n      instance.setValue = (color) => colorPicker.setColor(color); // Alias for FormManager compatibility\n      instance.getValue = () => colorPicker.getColor(); // Alias for consistency\n      instance.open = () => colorPicker.open();\n      instance.close = () => colorPicker.close();\n      instance.toggle = () => colorPicker.toggle();\n      instance.setDisabled = (disabled) => colorPicker.setDisabled(disabled);\n      instance.setReadonly = (readonly) => colorPicker.setReadonly(readonly);\n\n      // Update element reference\n      element.wrapper = instance.wrapper;\n\n      // Setup event forwarding\n      if (colorPicker.hiddenInput) {\n        colorPicker.hiddenInput.addEventListener('change', (e) => {\n          // Prevent infinite loop: don't re-dispatch if event came from element itself\n          if (e.target === element) return;\n\n          // Dispatch standard change event\n          const changeEvent = new Event('change', {bubbles: true});\n          element.dispatchEvent(changeEvent);\n\n          // Emit to event system\n          EventManager.emit('element:change', {\n            elementId: element.id,\n            value: colorPicker.getColor(),\n            type: 'color'\n          });\n        });\n      }\n\n      // Forward custom events\n      colorPicker.wrapper.addEventListener('colorpicker:change', (e) => {\n        element.dispatchEvent(new CustomEvent('colorpicker:change', {\n          detail: e.detail\n        }));\n      });\n\n      colorPicker.wrapper.addEventListener('colorpicker:open', (e) => {\n        element.dispatchEvent(new CustomEvent('colorpicker:open', {\n          detail: e.detail\n        }));\n      });\n\n      colorPicker.wrapper.addEventListener('colorpicker:close', (e) => {\n        element.dispatchEvent(new CustomEvent('colorpicker:close', {\n          detail: e.detail\n        }));\n      });\n\n      // Cleanup override\n      const originalCleanup = instance.cleanup;\n      instance.cleanup = function() {\n        if (this.colorPicker) {\n          this.colorPicker.destroy();\n          this.colorPicker = null;\n        }\n        if (originalCleanup) {\n          originalCleanup.call(this);\n        }\n        return this;\n      };\n\n      return instance;\n\n    } catch (error) {\n      console.error('ColorElementFactory: Failed to setup element:', error);\n      return instance;\n    }\n  }\n}\n\n// Register with ElementManager\nElementManager.registerElement('color', ColorElementFactory);\n\n// Expose globally\nwindow.ColorElementFactory = ColorElementFactory;","/**\n * TagsElementFactory - Factory for creating tags/chips input elements\n *\n * Converts a text input into a tags input with:\n * - Multiple value support as visual tags/chips\n * - Keyboard navigation (Enter to add, Backspace to remove)\n * - Autocomplete integration\n * - Hidden inputs for form submission\n * - Click to focus behavior\n */\n\nclass TagsElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    type: 'text',\n    placeholder: 'Add tags...',\n    separator: ',', // Character to split pasted values\n    maxTags: null, // Maximum number of tags (null = unlimited)\n    duplicates: false, // Allow duplicate tags\n    autocomplete: {\n      enabled: false,\n      source: null,\n      minLength: 2,\n      maxResults: 10,\n      delay: 300\n    },\n    validationMessages: {\n      maxTags: 'Maximum number of tags reached',\n      duplicate: 'This tag already exists'\n    }\n  };\n\n  static propertyHandlers = {\n    value: {\n      get(element) {\n        // Read from hidden inputs container\n        const wrapper = element.closest('.tags-input-wrapper');\n        if (!wrapper) return [];\n\n        const hiddenContainer = wrapper.querySelector('.tags-hidden-inputs');\n        if (!hiddenContainer) return [];\n\n        return Array.from(hiddenContainer.querySelectorAll('input[type=\"hidden\"]')).map(input => input.value);\n      },\n      set(instance, newValue) {\n        // Handle array values (e.g. from API)\n        if (Array.isArray(newValue)) {\n          this.clearTags(instance);\n          newValue.forEach(val => {\n            if (typeof val === 'object' && val.key && val.value) {\n              this.addTag(instance, val.key, val.value);\n            } else {\n              this.addTag(instance, val, val);\n            }\n          });\n        } else if (typeof newValue === 'string') {\n          // Try to parse JSON array string\n          try {\n            const parsed = JSON.parse(newValue);\n            if (Array.isArray(parsed)) {\n              this.clearTags(instance);\n              parsed.forEach(val => {\n                if (typeof val === 'object' && val.key && val.value) {\n                  this.addTag(instance, val.key, val.value);\n                } else {\n                  this.addTag(instance, val, val);\n                }\n              });\n              return;\n            }\n          } catch (e) {\n            // Not a JSON array, treat as single value or split by separator\n          }\n\n          // Treat as single value or split by separator\n          const values = newValue.split(instance.config.separator).map(v => v.trim()).filter(v => v);\n          this.clearTags(instance);\n          values.forEach(val => this.addTag(instance, val, val));\n        }\n      }\n    }\n  };\n\n  static extractCustomConfig(element, def, dataset) {\n    return {\n      separator: dataset.separator || def.separator,\n      maxTags: dataset.maxTags ? parseInt(dataset.maxTags) : def.maxTags,\n      duplicates: dataset.duplicates === 'true' || def.duplicates,\n      autocomplete: {\n        enabled: dataset.autocomplete !== undefined ? dataset.autocomplete === 'true' : def.autocomplete?.enabled,\n        source: dataset.source || def.autocomplete?.source,\n        minLength: this.parseNumeric('minLength', element, def.autocomplete, dataset) || def.autocomplete?.minLength,\n        maxResults: this.parseNumeric('maxResults', element, def.autocomplete, dataset) || def.autocomplete?.maxResults,\n        delay: this.parseNumeric('delay', element, def.autocomplete, dataset) || def.autocomplete?.delay\n      }\n    };\n  }\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    // Store original name before modifying\n    const originalName = element.getAttribute('name') || '';\n    instance.originalName = originalName;\n\n    // Store parent before moving element\n    const originalParent = element.parentNode;\n\n    // Store reference to original input before modifications\n    instance.originalInput = element;\n\n    // Change original input name to {name}_text for typing\n    element.setAttribute('name', `${originalName}_text`);\n    element.className = 'tags-input';\n\n    // Store reference to original input (now used for typing)\n    instance.input = element;\n\n    // Create wrapper container\n    const wrapper = document.createElement('div');\n    wrapper.className = 'tags-input-wrapper';\n\n    // Create tags container (ul)\n    const tagsContainer = document.createElement('ul');\n    tagsContainer.className = 'tags-container';\n\n    // Create input li wrapper and move element into it\n    const inputLi = document.createElement('li');\n    inputLi.className = 'tags-input-li';\n    inputLi.appendChild(element);\n\n    tagsContainer.appendChild(inputLi);\n    wrapper.appendChild(tagsContainer);\n\n    // Create hidden inputs container\n    const hiddenInputsContainer = document.createElement('div');\n    hiddenInputsContainer.className = 'tags-hidden-inputs';\n    hiddenInputsContainer.style.display = 'none';\n    wrapper.appendChild(hiddenInputsContainer);\n\n    // Insert wrapper in place of original element\n    originalParent.appendChild(wrapper);\n\n    // Store references\n    instance.wrapper = wrapper;\n    instance.tagsContainer = tagsContainer;\n    instance.inputLi = inputLi;\n    instance.hiddenInputsContainer = hiddenInputsContainer;\n    instance.tags = []; // Array of {key, value} objects\n    instance.tagElements = new Map(); // Map of key -> li element\n\n    // Setup locale change handler to re-translate existing tags when locale changes\n    instance._localeChangeHandler = () => {\n      try {\n        const i18n = (window.Now && Now.getManager) ? Now.getManager('i18n') : null;\n        instance.tagElements.forEach((li, key) => {\n          const tag = instance.tags.find(t => t.key === key);\n          if (!tag) return;\n          let displayValue = tag.value;\n\n          try {\n            if ((displayValue === key || !displayValue) && instance && instance.config && instance.config.autocomplete && instance.config.autocomplete.source) {\n              const normalized = TextElementFactory.normalizeSource(instance.config.autocomplete.source);\n              if (normalized && Array.isArray(normalized)) {\n                const found = normalized.find(item => String(item.value) === String(key));\n                if (found) displayValue = found.text;\n              }\n            }\n          } catch (e) {\n            displayValue = tag.value;\n          }\n\n          try {\n            if (i18n && typeof i18n.interpolate === 'function') {\n              displayValue = i18n.interpolate(displayValue, {});\n            }\n          } catch (e) {\n            // ignore\n          }\n\n          const span = li.querySelector('.tag-text');\n          if (span) span.textContent = displayValue;\n        });\n      } catch (e) {\n        // best-effort\n      }\n    };\n\n    try {\n      EventManager.on && EventManager.on('locale:changed', instance._localeChangeHandler);\n    } catch (e) {}\n\n    // Setup autocomplete if enabled\n    const acConfig = config.autocomplete;\n    if (acConfig?.enabled || acConfig?.source) {\n      acConfig.enabled = true;\n      this.setupAutocomplete(instance);\n    }\n\n    // Setup event handlers\n    this.setupEventHandlers(instance);\n\n    // Load initial values from original input\n    // Support both string and array values\n    const initialValue = element.value; // Use 'element' which is now instance.input\n    if (initialValue) {\n      let values = [];\n\n      // Try to parse as JSON array first\n      try {\n        const parsed = JSON.parse(initialValue);\n        if (Array.isArray(parsed)) {\n          values = parsed;\n        } else {\n          // Single value\n          values = [initialValue];\n        }\n      } catch (e) {\n        // Not JSON, split by separator\n        values = initialValue.split(config.separator).map(v => v.trim()).filter(v => v);\n      }\n\n      values.forEach(value => {\n        if (typeof value === 'object' && value.key && value.value) {\n          // Object format: {key, value}\n          this.addTag(instance, value.key, value.value);\n        } else {\n          // String format\n          this.addTag(instance, value, value);\n        }\n      });\n    }\n\n    // Add instance methods\n    instance.addTag = (key, value) => this.addTag(instance, key, value);\n    instance.removeTag = (key) => this.removeTag(instance, key);\n    instance.clear = () => this.clearTags(instance);\n    instance.getTags = () => this.getTags(instance);\n    instance.setTags = (tags) => this.setTags(instance, tags);\n    instance.updateOptions = (options) => this.updateOptions(instance, options);\n\n    // Add setValue for FormManager compatibility\n    instance.setValue = (value) => {\n      if (this.propertyHandlers && this.propertyHandlers.value && this.propertyHandlers.value.set) {\n        this.propertyHandlers.value.set.call(this, instance, value);\n      }\n    };\n\n    return instance;\n  }\n\n  static setupAutocomplete(instance) {\n    const {input, config} = instance;\n    const acConfig = config.autocomplete;\n\n    // Use DropdownPanel\n    instance.dropdownPanel = DropdownPanel.getInstance();\n    instance.dropdown = document.createElement('ul');\n    instance.dropdown.className = 'autocomplete-list';\n\n    instance.list = [];\n    instance.listIndex = 0;\n\n    // Read from datalist if exists\n    const dataFromDatalist = this.readFromDatalist(instance.originalInput);\n    if (dataFromDatalist) {\n      acConfig.source = dataFromDatalist;\n    }\n\n    instance.populate = (data) => {\n      if (document.activeElement !== input && !instance._isActive) return;\n\n      instance.dropdown.innerHTML = '';\n      instance.list = [];\n      const search = input.value.trim();\n      const filter = new RegExp(`(${this.escapeRegExp(search)})`, 'gi');\n      let count = 0;\n\n      // Normalize data\n      const normalized = TextElementFactory.normalizeSource(data);\n      if (!normalized) return;\n\n      // Filter and create list items\n      for (const item of normalized) {\n        if (count >= acConfig.maxResults) break;\n\n        if (!search || filter.test(item.text)) {\n          const li = this.createListItem(instance, item.value, item.text, search);\n          instance.list.push(li);\n          instance.dropdown.appendChild(li);\n          count++;\n        }\n      }\n\n      instance.highlightItem(0);\n      if (instance.list.length) {\n        instance.show();\n      } else {\n        instance.hide();\n      }\n    };\n\n    instance.show = () => {\n      instance.dropdownPanel.show(input, instance.dropdown, {\n        align: 'left',\n        offsetY: 2,\n        onClose: () => {}\n      });\n    };\n\n    instance.hide = () => {\n      if (instance.dropdownPanel.isOpen() && instance.dropdownPanel.currentTarget === input) {\n        instance.dropdownPanel.hide();\n      }\n    };\n\n    instance.highlightItem = (index) => {\n      instance.listIndex = Math.max(0, Math.min(instance.list.length - 1, index));\n      instance.list.forEach((item, i) => item.classList.toggle('active', i === instance.listIndex));\n      instance.scrollToItem();\n    };\n\n    instance.scrollToItem = () => {\n      const item = instance.list[instance.listIndex];\n      if (item) {\n        const dropdownRect = instance.dropdown.getBoundingClientRect();\n        const itemRect = item.getBoundingClientRect();\n        if (itemRect.top < dropdownRect.top) {\n          instance.dropdown.scrollTop = item.offsetTop;\n        } else if (itemRect.bottom > dropdownRect.bottom) {\n          instance.dropdown.scrollTop = item.offsetTop - dropdownRect.height + itemRect.height;\n        }\n      }\n    };\n\n    instance.selectItem = (key, value) => {\n      this.addTag(instance, key, value);\n      input.value = '';\n      // Show dropdown again with all options for quick multi-select\n      instance.populate(acConfig.source);\n    };\n  }\n\n  static createListItem(instance, key, value, search) {\n    const {config} = instance;\n    const acConfig = config.autocomplete;\n\n    const li = document.createElement('li');\n    li.dataset.key = key;\n\n    const span = document.createElement('span');\n    // translate {LNG_...} tokens if i18n manager is available\n    let displayText = value;\n    try {\n      if (window.Now && Now.getManager) {\n        const i18n = Now.getManager('i18n');\n        if (i18n && typeof i18n.interpolate === 'function') {\n          displayText = i18n.interpolate(value, {});\n        }\n      }\n    } catch (e) {\n      // ignore translation errors and fall back to raw value\n      displayText = value;\n    }\n\n    if (!search) {\n      span.textContent = displayText;\n    } else {\n      const splitRegex = new RegExp(this.escapeRegExp(search), 'gi');\n      const parts = displayText.split(splitRegex);\n      const matches = displayText.match(splitRegex) || [];\n\n      parts.forEach((part, index) => {\n        if (part) span.appendChild(document.createTextNode(part));\n        if (index < matches.length) {\n          const em = document.createElement('em');\n          em.textContent = matches[index];\n          span.appendChild(em);\n        }\n      });\n    }\n\n    li.appendChild(span);\n    li.addEventListener('mousedown', () => instance.selectItem(key, value));\n    li.addEventListener('mousemove', () => instance.highlightItem(instance.list.indexOf(li)));\n\n    return li;\n  }\n\n  static readFromDatalist(element) {\n    const listId = element.getAttribute('list');\n    if (!listId) return null;\n\n    const datalist = document.getElementById(listId);\n    if (!datalist) return null;\n\n    const options = Array.from(datalist.querySelectorAll('option'));\n    const data = [];\n    options.forEach(option => {\n      const text = option.label || option.textContent;\n      const key = option.value || text;\n      data.push({value: key, text});\n    });\n\n    element.removeAttribute('list');\n    datalist.remove();\n    return data.length > 0 ? data : null;\n  }\n\n  static escapeRegExp(str) {\n    return str.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\n  }\n\n  static setupEventHandlers(instance) {\n    const {input, tagsContainer, config} = instance;\n    const acConfig = config.autocomplete;\n\n    // Prevent duplicate event registration\n    if (instance._eventHandlersSetup) {\n      return;\n    }\n    instance._eventHandlersSetup = true;\n\n    // Click on container to focus input\n    EventSystemManager.addHandler(tagsContainer, 'click', (e) => {\n      // Don't steal clicks from remove buttons.\n      if (e.target && e.target.closest && e.target.closest('button.tag-remove')) return;\n      input.focus();\n    });\n\n    // Enter key to add tag\n    input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n\n        // Check if autocomplete is open\n        const currentAcConfig = instance.config.autocomplete;\n        if (currentAcConfig?.enabled && instance.dropdownPanel?.isOpen() && instance.dropdownPanel.currentTarget === input) {\n          const item = instance.list[instance.listIndex];\n          if (item) {\n            const text = item.textContent || item.innerText;\n            const key = item.dataset.key;\n            instance.selectItem(key, text);\n          }\n        } else {\n          // Add tag from input value\n          const value = input.value.trim();\n          if (value) {\n            this.addTag(instance, value, value);\n            input.value = '';\n            // Show dropdown if autocomplete is enabled\n            if (currentAcConfig?.enabled && currentAcConfig?.source) {\n              instance.populate(currentAcConfig.source);\n            }\n          }\n        }\n      } else if (e.key === 'Backspace' && input.value === '') {\n        // Remove last tag on backspace when input is empty\n        e.preventDefault();\n        if (instance.tags.length > 0 && !input.readOnly && !input.disabled) {\n          const lastTag = instance.tags[instance.tags.length - 1];\n          this.removeTag(instance, lastTag.key);\n        }\n      } else if (instance.config.autocomplete?.enabled && instance.dropdownPanel?.isOpen() && instance.dropdownPanel.currentTarget === input) {\n        // Autocomplete keyboard navigation\n        if (e.key === 'ArrowDown') {\n          instance.highlightItem(instance.listIndex + 1);\n          e.preventDefault();\n        } else if (e.key === 'ArrowUp') {\n          instance.highlightItem(instance.listIndex - 1);\n          e.preventDefault();\n        } else if (e.key === 'Escape') {\n          instance.hide();\n          e.preventDefault();\n        }\n      }\n    });\n\n    // Autocomplete support - Always bind events, check config dynamically\n    const debounce = Utils.function.debounce((value) => {\n      const currentAcConfig = instance.config.autocomplete;\n      if (!currentAcConfig?.enabled || !currentAcConfig?.source) return;\n\n      if (value.length < (currentAcConfig.minLength || 2)) {\n        instance.hide();\n        return;\n      }\n      instance.populate(currentAcConfig.source);\n    }, acConfig?.delay || 300);\n\n    input.addEventListener('input', (e) => {\n      const value = e.target.value.trim();\n      const currentAcConfig = instance.config.autocomplete;\n\n      if (currentAcConfig?.enabled) {\n        debounce(value);\n      }\n    });\n\n    const handleFocus = () => {\n      instance._isActive = true;\n      const currentAcConfig = instance.config.autocomplete;\n\n      // Show all options on focus if autocomplete is enabled\n      if (currentAcConfig?.enabled && currentAcConfig?.source && typeof instance.populate === 'function') {\n        // Force show-all on focus (ignore minLength / current input value)\n        const prev = input.value;\n        input.value = '';\n        try {\n          instance.populate(currentAcConfig.source);\n        } finally {\n          input.value = prev;\n        }\n      }\n    };\n\n    const handleBlur = () => {\n      instance._isActive = false;\n      setTimeout(() => {\n        const panel = instance.dropdownPanel?.panel;\n        if (!instance._isActive && (!panel || !panel.contains(document.activeElement))) {\n          instance.hide();\n        }\n      }, 200);\n    };\n\n    // Use EventSystemManager for focus/blur (cleanup handled automatically)\n    EventSystemManager.addHandler(input, 'focus', handleFocus, {capture: true});\n    EventSystemManager.addHandler(input, 'blur', handleBlur, {capture: true});\n\n    // Handle paste with separator\n    EventSystemManager.addHandler(input, 'paste', (e) => {\n      setTimeout(() => {\n        const value = input.value;\n        if (value.includes(config.separator)) {\n          const values = value.split(config.separator).map(v => v.trim()).filter(v => v);\n          values.forEach(v => this.addTag(instance, v, v));\n          input.value = '';\n        }\n      }, 0);\n    });\n\n    return super.setupEventListeners?.(instance) || {};\n  }\n\n  static addTag(instance, key, value) {\n    const {config, tags, tagElements, tagsContainer, inputLi, hiddenInputsContainer, originalName} = instance;\n\n    // Check max tags\n    if (config.maxTags && tags.length >= config.maxTags) {\n      NotificationManager.warning(config.validationMessages.maxTags);\n      return false;\n    }\n\n    // Check duplicates\n    if (!config.duplicates && tags.some(tag => tag.key === key)) {\n      NotificationManager.warning(config.validationMessages.duplicate);\n      return false;\n    }\n\n    // Check readonly/disabled\n    if (instance.input.readOnly || instance.input.disabled) {\n      return false;\n    }\n\n    // Create tag element\n    const li = document.createElement('li');\n    li.className = 'tag-item';\n    li.dataset.key = key;\n\n    const span = document.createElement('span');\n    span.className = 'tag-text';\n    // If value equals key (no readable text provided), try to resolve from options source\n    let displayValue = value;\n    try {\n      if ((value === key || !value) && instance && instance.config && instance.config.autocomplete && instance.config.autocomplete.source) {\n        // Normalize source to standard format -> Array of {value, text}\n        const normalized = TextElementFactory.normalizeSource(instance.config.autocomplete.source);\n        if (normalized && Array.isArray(normalized)) {\n          const found = normalized.find(item => String(item.value) === String(key));\n          if (found) {\n            displayValue = found.text;\n          }\n        }\n      }\n    } catch (e) {\n      // ignore and fallback to raw value\n      displayValue = value;\n    }\n\n    // translate display value (if contains {LNG_...}) using i18n manager\n    try {\n      if (window.Now && Now.getManager) {\n        const i18n = Now.getManager('i18n');\n        if (i18n && typeof i18n.interpolate === 'function') {\n          displayValue = i18n.interpolate(displayValue, {});\n        }\n      }\n    } catch (e) {\n      // ignore translation errors and fall back to raw value\n      displayValue = displayValue;\n    }\n\n    span.textContent = displayValue;\n    li.appendChild(span);\n\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'tag-remove';\n    button.innerHTML = '×';\n    button.setAttribute('aria-label', `Remove ${value}`);\n    li.appendChild(button);\n\n    // Create hidden input in hiddenInputsContainer\n    const hidden = document.createElement('input');\n    hidden.type = 'hidden';\n    hidden.name = `${originalName}[]`;\n    hidden.value = key;\n    hidden.dataset.tagKey = key;\n    hiddenInputsContainer.appendChild(hidden);\n\n    // Add tag to container before input\n    tagsContainer.insertBefore(li, inputLi);\n\n    // Store references\n    tags.push({key, value});\n    tagElements.set(key, li);\n\n    // Add remove handler\n    EventSystemManager.addHandler(button, 'click', (e) => {\n      e.stopPropagation();\n      this.removeTag(instance, key);\n    });\n\n    // Dispatch change event\n    instance.input.dispatchEvent(new Event('change', {bubbles: true}));\n\n    return true;\n  }\n\n  static removeTag(instance, key) {\n    const {tags, tagElements, hiddenInputsContainer, input} = instance;\n\n    // Check readonly/disabled\n    if (input.readOnly || input.disabled) {\n      return false;\n    }\n\n    const index = tags.findIndex(tag => tag.key === key);\n    if (index === -1) return false;\n\n    // Remove tag element\n    const li = tagElements.get(key);\n    if (li && li.parentNode) {\n      li.parentNode.removeChild(li);\n    }\n\n    // Remove hidden input\n    const hidden = hiddenInputsContainer.querySelector(`[data-tag-key=\"${key}\"]`);\n    if (hidden) {\n      hidden.remove();\n    }\n\n    tags.splice(index, 1);\n    tagElements.delete(key);\n\n    // Dispatch change event\n    input.dispatchEvent(new Event('change', {bubbles: true}));\n\n    return true;\n  }\n\n  static clearTags(instance) {\n    const {tags} = instance;\n    const keys = tags.map(tag => tag.key);\n    keys.forEach(key => this.removeTag(instance, key));\n  }\n\n  static getTags(instance) {\n    return instance.tags.map(tag => ({...tag}));\n  }\n\n  static setTags(instance, tags) {\n    this.clearTags(instance);\n    if (Array.isArray(tags)) {\n      tags.forEach(tag => {\n        if (typeof tag === 'string') {\n          this.addTag(instance, tag, tag);\n        } else if (tag.key && tag.value) {\n          this.addTag(instance, tag.key, tag.value);\n        }\n      });\n    }\n  }\n\n  static updateOptions(instance, options) {\n    const {config} = instance;\n\n    // Update autocomplete source\n    if (config.autocomplete) {\n      config.autocomplete.source = options;\n      config.autocomplete.enabled = true;\n\n      // If autocomplete not setup yet, set it up\n      if (!instance.dropdownPanel) {\n        this.setupAutocomplete(instance);\n      }\n    }\n  }\n\n  /**\n   * Populate tags input from provided options object\n   * @param {HTMLElement} element - Input element\n   * @param {Object} optionsData - Options data object\n   * @param {String} optionsKey - Key to extract from optionsData\n   */\n  static populateFromOptions(element, optionsData, optionsKey) {\n    if (!element || !optionsData || !optionsKey) return;\n\n    const options = optionsData[optionsKey];\n\n    if (!options || !Array.isArray(options)) return;\n\n    // Get instance\n    let instance = ElementManager?.getInstanceByElement(element);\n\n    // If not enhanced yet, try to enhance it\n    if (!instance && window.ElementManager) {\n      instance = ElementManager.enhance(element);\n    }\n\n    if (!instance) {\n      console.warn('[TagsElementFactory] Element not enhanced yet');\n      return;\n    }\n\n    // Update autocomplete options\n    this.updateOptions(instance, options);\n  }\n\n  /**\n   * Populate all tags inputs with data-options-key attribute\n   * @param {HTMLElement} container - Container element\n   * @param {Object} optionsData - Options data object\n   */\n  static populateFromOptionsInContainer(container, optionsData) {\n    if (!container || !optionsData) return;\n\n    const inputsWithOptionsKey = container.querySelectorAll('input[data-options-key][data-element=\"tags\"]');\n\n    inputsWithOptionsKey.forEach(input => {\n      const optionsKey = input.dataset.optionsKey;\n      this.populateFromOptions(input, optionsData, optionsKey);\n    });\n  }\n\n  static cleanup(instance) {\n    if (!instance) return;\n\n    // Hide dropdown if open\n    if (instance.dropdownPanel?.isOpen() && instance.dropdownPanel.currentTarget === instance.input) {\n      instance.dropdownPanel.hide();\n    }\n\n    // Remove wrapper and restore original input\n    if (instance.wrapper && instance.wrapper.parentNode) {\n      instance.wrapper.parentNode.removeChild(instance.wrapper);\n    }\n\n    if (instance.originalInput) {\n      instance.originalInput.style.display = '';\n      instance.originalInput.removeAttribute('aria-hidden');\n    }\n\n    // Remove locale change listener to prevent leaks/double-handling\n    try {\n      if (instance._localeChangeHandler && EventManager.off) {\n        EventManager.off('locale:changed', instance._localeChangeHandler);\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    super.cleanup?.(instance);\n  }\n}\n\n// Register with ElementManager\nElementManager.registerElement('tags', TagsElementFactory);\n\n// Expose globally\nwindow.TagsElementFactory = TagsElementFactory;\n","/**\n * MultiSelectElementFactory - Factory for creating custom multiple select elements\n *\n * Converts <select multiple> into a custom DIV-based UI with:\n * - Custom trigger showing selected items (max 2, then \"+n items\")\n * - DropdownPanel for options list with check/uncheck icons\n */\n\nclass MultiSelectElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    maxDisplayItems: 2,\n    emptyMessage: 'No options available',\n    validationMessages: {\n      required: 'Please select at least one option'\n    }\n  };\n\n  static propertyHandlers = {\n    value: {\n      get(element) {\n        // Get values from select element's selectedOptions\n        if (!element || element.tagName !== 'SELECT') return [];\n        return Array.from(element.selectedOptions).map(opt => opt.value);\n      },\n      set(instance, newValue) {\n        // Support both array and single value\n        if (!Array.isArray(newValue)) {\n          // Try to parse as JSON array\n          if (typeof newValue === 'string' && newValue.startsWith('[')) {\n            try {\n              newValue = JSON.parse(newValue);\n            } catch (e) {\n              // Not JSON, treat as single value\n              newValue = newValue ? [newValue] : [];\n            }\n          } else {\n            newValue = newValue ? [newValue] : [];\n          }\n        }\n\n        this.setSelectedValues(instance.element, newValue);\n      }\n    },\n\n    selectedOptions: {\n      get(element) {\n        if (!element || element.tagName !== 'SELECT') return [];\n\n        return Array.from(element.selectedOptions).map(opt => ({\n          value: opt.value,\n          text: opt.textContent,\n          data: opt.dataset\n        }));\n      }\n    }\n  };\n\n  static setupElement(instance) {\n    const {element, config} = instance;\n\n    // Verify this is a select[multiple]\n    if (element.tagName !== 'SELECT' || !element.multiple) {\n      console.error('MultiSelectElementFactory: Element must be a <select multiple>');\n      return instance;\n    }\n\n    // Preserve original option text for locale re-translation\n    Array.from(element.options).forEach(opt => {\n      if (!opt.dataset.i18n) {\n        opt.dataset.i18n = opt.textContent;\n      }\n    });\n\n    // Get placeholder\n    const placeholder = element.dataset.placeholder ||\n      element.getAttribute('placeholder') ||\n      config.placeholder || '';\n\n    // Hide original select\n    element.style.display = 'none';\n    element.style.height = '100px';\n    element.style.width = '100px';\n    element.setAttribute('aria-hidden', 'true');\n\n    const trigger = document.createElement('button');\n    trigger.type = 'button';\n    trigger.className = 'dropdown-button';\n    if (element.required) trigger.dataset.required = 'true';\n    if (element.disabled) trigger.classList.add('disabled');\n    trigger.setAttribute('role', 'button');\n    trigger.setAttribute('aria-haspopup', 'listbox');\n    trigger.setAttribute('aria-expanded', 'false');\n    element.parentNode.insertBefore(trigger, element.nextSibling);\n\n    // Create selected items display\n    const selectedDisplay = document.createElement('span');\n    selectedDisplay.className = 'dropdown-display';\n    selectedDisplay.textContent = placeholder;\n    if (placeholder) {\n      selectedDisplay.classList.add('placeholder');\n    }\n    trigger.appendChild(selectedDisplay);\n\n    // Create dropdown icon\n    const icon = document.createElement('span');\n    icon.className = 'dropdown-arrow';\n    trigger.appendChild(icon);\n\n    // Update instance - keep element as original select\n    instance.element = element;\n    instance.trigger = trigger;\n    instance.selectedDisplay = selectedDisplay;\n    instance.placeholder = placeholder;\n\n    // Use DropdownPanel instead of creating dropdown element\n    instance.dropdownPanel = DropdownPanel.getInstance();\n    instance.dropdown = document.createElement('ul');\n    instance.dropdown.className = 'autocomplete-list';\n    instance.dropdown.setAttribute('tabindex', '0');\n\n    // Initialize keyboard navigation state\n    instance.highlightedIndex = -1;\n\n    // Setup dropdown keyboard navigation (once only)\n    this.setupDropdownKeyboardNavigation(instance);\n\n    // Setup event handlers\n    this.setupEventHandlers(instance);\n\n    // Setup locale change handler to retranslate options and display text\n    instance._localeChangeHandler = () => {\n      try {\n        this.retranslate(instance);\n      } catch (e) {\n        // best-effort\n      }\n    };\n\n    try {\n      EventManager.on && EventManager.on('locale:changed', instance._localeChangeHandler);\n    } catch (e) {}\n\n    // Initial translation pass to ensure tokens render in current locale\n    this.retranslate(instance);\n\n    // Initialize display\n    this.updateDisplay(instance);\n\n    // Add instance methods\n    instance.updateOptions = (options) => {\n      this.updateOptions(element, options);\n      this.updateDisplay(instance);\n    };\n\n    instance.setValue = (values) => {\n      this.setSelectedValues(element, values);\n    };\n\n    instance.getValue = () => {\n      return this.getSelectedValues(element);\n    };\n\n    instance.clear = () => {\n      this.clearSelection(instance);\n    };\n\n    return instance;\n  }\n\n  static setupDropdownKeyboardNavigation(instance) {\n    if (instance._dropdownKeyboardSetup) return;\n    instance._dropdownKeyboardSetup = true;\n\n    const {dropdown, element} = instance;\n\n    // Setup keyboard navigation on dropdown\n    const handleDropdownKeydown = (e) => {\n      const items = Array.from(dropdown.querySelectorAll('li[data-index]'));\n      if (items.length === 0) return;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          instance.highlightedIndex = Math.min(instance.highlightedIndex + 1, items.length - 1);\n          this.updateHighlight(instance, items);\n          break;\n\n        case 'ArrowUp':\n          e.preventDefault();\n          instance.highlightedIndex = Math.max(instance.highlightedIndex - 1, 0);\n          this.updateHighlight(instance, items);\n          break;\n\n        case ' ':\n        case 'Spacebar':\n          e.preventDefault();\n          if (instance.highlightedIndex >= 0 && instance.highlightedIndex < items.length) {\n            const highlightedItem = items[instance.highlightedIndex];\n            const value = highlightedItem.dataset.value;\n            const icon = highlightedItem.querySelector('span');\n\n            const currentlySelected = this.getSelectedValues(element);\n            const isCurrentlySelected = currentlySelected.includes(value);\n\n            if (isCurrentlySelected) {\n              this.removeValue(element, value);\n              highlightedItem.setAttribute('aria-selected', 'false');\n              icon.className = 'icon-uncheck';\n            } else {\n              this.addValue(element, value, highlightedItem.querySelector('span:last-child').textContent);\n              highlightedItem.setAttribute('aria-selected', 'true');\n              icon.className = 'icon-check';\n            }\n\n            this.updateDisplay(instance);\n            this.triggerChange(instance);\n          }\n          break;\n\n        case 'Tab':\n        case 'Escape':\n          e.preventDefault();\n          const escPanel = instance.dropdownPanel;\n          if (escPanel && escPanel.isOpen() && escPanel.currentTarget === instance.trigger) {\n            escPanel.hide();\n            instance.trigger.setAttribute('aria-expanded', 'false');\n            instance.highlightedIndex = -1;\n            instance.trigger.focus();\n          }\n          break;\n      }\n    };\n\n    // Handle blur on dropdown\n    const handleDropdownBlur = (e) => {\n      setTimeout(() => {\n        const panel = instance.dropdownPanel;\n        if (!panel) return;\n\n        const activeElement = document.activeElement;\n        const isDropdownFocused = dropdown.contains(activeElement) || activeElement === dropdown;\n        const isTriggerFocused = activeElement === instance.trigger;\n\n        if (!isDropdownFocused && !isTriggerFocused && panel.isOpen() && panel.currentTarget === instance.trigger) {\n          panel.hide();\n          instance.trigger.setAttribute('aria-expanded', 'false');\n          instance.highlightedIndex = -1;\n        }\n      }, 100);\n    };\n\n    dropdown.addEventListener('keydown', handleDropdownKeydown);\n    dropdown.addEventListener('blur', handleDropdownBlur);\n\n    // Store cleanup for dropdown listeners\n    instance._dropdownCleanup = () => {\n      dropdown.removeEventListener('keydown', handleDropdownKeydown);\n      dropdown.removeEventListener('blur', handleDropdownBlur);\n    };\n  }\n\n  static setupEventHandlers(instance) {\n    const {trigger} = instance;\n\n    // Handle trigger click\n    const handleTriggerClick = (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (trigger.classList.contains('disabled')) return;\n\n      const panel = instance.dropdownPanel;\n      if (!panel) return;\n\n      if (panel.isOpen() && panel.currentTarget === trigger) {\n        panel.hide();\n        trigger.setAttribute('aria-expanded', 'false');\n        instance.highlightedIndex = -1;\n      } else {\n        // populate dropdown with options\n        this.createOptionsList(instance);\n\n        // Show dropdown in DropdownPanel\n        panel.show(trigger, instance.dropdown, {\n          align: 'left',\n          offsetY: 5,\n          onClose: () => {\n            trigger.setAttribute('aria-expanded', 'false');\n            instance.highlightedIndex = -1;\n          }\n        });\n\n        trigger.setAttribute('aria-expanded', 'true');\n        instance.highlightedIndex = -1;\n\n        // Focus on dropdown for keyboard navigation\n        setTimeout(() => {\n          instance.dropdown.focus();\n        }, 50);\n      }\n    };\n\n    trigger.addEventListener('click', handleTriggerClick);\n\n    // Keyboard navigation on trigger\n    const handleTriggerKeydown = (e) => {\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        handleTriggerClick(e);\n      }\n    };\n\n    trigger.addEventListener('keydown', handleTriggerKeydown);\n\n    // Handle blur on trigger to close dropdown\n    const handleTriggerBlur = (e) => {\n      // Delay to check if focus moved to dropdown\n      setTimeout(() => {\n        const panel = instance.dropdownPanel;\n        if (!panel) return;\n\n        const activeElement = document.activeElement;\n        const isDropdownFocused = instance.dropdown.contains(activeElement) ||\n          activeElement === instance.dropdown;\n        const isTriggerFocused = activeElement === trigger;\n\n        if (!isDropdownFocused && !isTriggerFocused && panel.isOpen() && panel.currentTarget === trigger) {\n          panel.hide();\n          trigger.setAttribute('aria-expanded', 'false');\n          instance.highlightedIndex = -1;\n        }\n      }, 100);\n    };\n\n    trigger.addEventListener('blur', handleTriggerBlur);\n\n    // Store cleanup\n    instance._cleanup = () => {\n      trigger.removeEventListener('click', handleTriggerClick);\n      trigger.removeEventListener('keydown', handleTriggerKeydown);\n      trigger.removeEventListener('blur', handleTriggerBlur);\n    };\n\n    return super.setupEventListeners?.(instance) || {};\n  }\n\n  static createOptionsList(instance) {\n    const {element, dropdown, config} = instance;\n\n    // clear dropdown\n    dropdown.innerHTML = '';\n\n    const options = Array.from(element.options).filter(opt =>\n      opt.value !== '' && !opt.disabled\n    );\n\n    if (options.length === 0) {\n      const emptyMsg = document.createElement('li');\n      emptyMsg.className = 'multi-select-empty';\n      emptyMsg.textContent = Now.translate(config.emptyMessage);\n      dropdown.appendChild(emptyMsg);\n      return;\n    }\n\n    // Get current selected values\n    const selectedValues = this.getSelectedValues(element);\n\n    options.forEach((option, index) => {\n      const item = document.createElement('li');\n      item.dataset.value = option.value;\n      item.dataset.index = index;\n      item.setAttribute('role', 'option');\n      item.setAttribute('tabindex', '-1');\n\n      const icon = document.createElement('span');\n      item.appendChild(icon);\n\n      const isSelected = selectedValues.includes(option.value);\n\n      if (isSelected) {\n        icon.className = 'icon-check';\n        item.setAttribute('aria-selected', 'true');\n      } else {\n        icon.className = 'icon-uncheck';\n      }\n\n      const label = document.createElement('span');\n      // option.textContent already translated when options were created/updated\n      label.textContent = option.textContent;\n      if (option.dataset.i18n) {\n        label.setAttribute('data-i18n', option.dataset.i18n);\n      }\n      item.appendChild(label);\n\n      // Handle selection\n      const handleSelect = (e) => {\n        e.stopPropagation();\n\n        const currentlySelected = this.getSelectedValues(element);\n        const isCurrentlySelected = currentlySelected.includes(option.value);\n\n        if (isCurrentlySelected) {\n          // Unselect\n          this.removeValue(element, option.value);\n          item.setAttribute('aria-selected', 'false');\n          icon.className = 'icon-uncheck';\n        } else {\n          // Select\n          this.addValue(element, option.value, option.textContent);\n          item.setAttribute('aria-selected', 'true');\n          icon.className = 'icon-check';\n        }\n\n        this.updateDisplay(instance);\n        this.triggerChange(instance);\n      };\n\n      item.addEventListener('click', handleSelect);\n\n      dropdown.appendChild(item);\n    });\n\n    // Make dropdown focusable\n    dropdown.setAttribute('tabindex', '0');\n  }\n\n  static updateHighlight(instance, items) {\n    // Remove previous highlight\n    items.forEach(item => item.classList.remove('active'));\n\n    // Add highlight to current item\n    if (instance.highlightedIndex >= 0 && instance.highlightedIndex < items.length) {\n      const highlightedItem = items[instance.highlightedIndex];\n      highlightedItem.classList.add('active');\n\n      // Scroll into view if needed\n      highlightedItem.scrollIntoView({\n        block: 'nearest',\n        behavior: 'smooth'\n      });\n    }\n  }\n\n  static getSelectedValues(element) {\n    // Get values from original select element\n    if (!element || element.tagName !== 'SELECT') return [];\n\n    return Array.from(element.selectedOptions).map(opt => opt.value);\n  }\n\n  static addValue(element, value, text) {\n    if (!element || element.tagName !== 'SELECT') return;\n\n    // Find option and select it - use loose equality for type coercion\n    const option = Array.from(element.options).find(opt =>\n      opt.value == value || String(opt.value) === String(value)\n    );\n    if (option) {\n      option.selected = true;\n    }\n  }\n\n  static removeValue(element, value) {\n    if (!element || element.tagName !== 'SELECT') return;\n\n    // Find option and deselect it - use loose equality for type coercion\n    const option = Array.from(element.options).find(opt =>\n      opt.value == value || String(opt.value) === String(value)\n    );\n    if (option) {\n      option.selected = false;\n    }\n  }\n\n  static setSelectedValues(element, values) {\n    if (!Array.isArray(values)) values = [];\n    if (!element || element.tagName !== 'SELECT') return;\n\n    // Convert values to strings for comparison (handles number/string mismatch)\n    const valueStrings = values.map(v => String(v));\n\n    // Clear all selections\n    Array.from(element.options).forEach(opt => opt.selected = false);\n\n    // Set new selections\n    Array.from(element.options).forEach(opt => {\n      if (valueStrings.includes(opt.value)) {\n        opt.selected = true;\n      }\n    });\n\n    // Update display\n    const instance = ElementManager.getInstanceByElement(element);\n    if (instance) {\n      this.updateDisplay(instance);\n    }\n  }\n\n  static updateDisplay(instance) {\n    const {element, selectedDisplay, placeholder, config} = instance;\n    if (!element || element.tagName !== 'SELECT') return;\n\n    const selectedOptions = Array.from(element.selectedOptions);\n    const selectedCount = selectedOptions.length;\n\n    if (selectedCount === 0) {\n      let translatedPlaceholder = placeholder || '';\n      try {\n        translatedPlaceholder = Now.translate ? Now.translate(placeholder || '') : (placeholder || '');\n      } catch (e) {\n        translatedPlaceholder = placeholder || '';\n      }\n      selectedDisplay.textContent = translatedPlaceholder;\n      selectedDisplay.classList.add('placeholder');\n      return;\n    }\n\n    selectedDisplay.classList.remove('placeholder');\n\n    const maxDisplay = config.maxDisplayItems || 2;\n\n    if (selectedCount <= maxDisplay) {\n      const texts = selectedOptions.map(opt => opt.textContent);\n      selectedDisplay.textContent = texts.join(', ');\n    } else {\n      const firstItems = selectedOptions\n        .slice(0, maxDisplay)\n        .map(opt => opt.textContent);\n      const remaining = selectedCount - maxDisplay;\n      selectedDisplay.textContent = `${firstItems.join(', ')} +${remaining} ${Now.translate('items')}`;\n    }\n  }\n\n  static triggerChange(instance) {\n    const {element} = instance;\n\n    // Trigger change on original select\n    if (element && element.tagName === 'SELECT') {\n      element.dispatchEvent(new Event('change', {bubbles: true}));\n    }\n\n    // Call onChange callback if exists\n    if (instance.config && typeof instance.config.onChange === 'function') {\n      const values = this.getSelectedValues(element);\n      instance.config.onChange(element, values);\n    }\n  }\n\n  static retranslate(instance) {\n    if (!instance || !instance.element || instance.element.tagName !== 'SELECT') return;\n\n    const translate = (text) => {\n      try {\n        return Now.translate ? Now.translate(text || '') : (text || '');\n      } catch (e) {\n        return text || '';\n      }\n    };\n\n    Array.from(instance.element.options).forEach(opt => {\n      const sourceText = (opt.dataset && opt.dataset.i18n) ? opt.dataset.i18n : opt.textContent;\n      if (sourceText !== undefined) {\n        opt.textContent = translate(sourceText);\n      }\n    });\n\n    this.updateDisplay(instance);\n  }\n\n  static clearSelection(instance) {\n    const {element} = instance;\n\n    // Clear all selections in original select\n    if (element && element.tagName === 'SELECT') {\n      Array.from(element.options).forEach(opt => opt.selected = false);\n    }\n\n    this.updateDisplay(instance);\n    this.triggerChange(instance);\n  }\n\n  static updateOptions(selectElement, options) {\n    if (!selectElement || selectElement.tagName !== 'SELECT') return;\n\n    // Store current selected values\n    const currentValues = Array.from(selectElement.selectedOptions).map(opt => opt.value);\n\n    // Clear existing options (except placeholder)\n    const placeholder = selectElement.querySelector('option[value=\"\"][disabled]');\n    selectElement.innerHTML = '';\n    if (placeholder) {\n      selectElement.appendChild(placeholder);\n    }\n\n    // Add new options (translate text and preserve i18n key)\n    if (Array.isArray(options)) {\n      options.forEach(opt => {\n        const option = document.createElement('option');\n        option.value = opt.value || '';\n        option.textContent = Now.translate(opt.text || opt.label || opt.value || '');\n        if (opt.text || opt.label) option.dataset.i18n = opt.text || opt.label;\n        if (opt.disabled) option.disabled = true;\n        if (opt.data) {\n          Object.entries(opt.data).forEach(([key, value]) => {\n            option.dataset[key] = value;\n          });\n        }\n        selectElement.appendChild(option);\n      });\n    }\n\n    // Restore selected values if they still exist\n    const currentValueStrings = currentValues.map(v => String(v));\n\n    Array.from(selectElement.options).forEach(option => {\n      if (currentValueStrings.includes(option.value)) {\n        option.selected = true;\n      }\n    });\n  }\n\n  static customValidateValue(value) {\n    const element = this.element;\n    const isRequired = element.required || element.dataset.required === 'true';\n\n    if (isRequired) {\n      const selectedOptions = element.selectedOptions;\n      if (!selectedOptions || selectedOptions.length === 0) {\n        return {\n          validatedValue: value,\n          error: Now.translate(this.config.validationMessages.required)\n        };\n      }\n    }\n\n    return {\n      validatedValue: value,\n      error: null\n    };\n  }\n\n  static cleanup(instance) {\n    if (!instance) return;\n\n    if (instance._cleanup) {\n      instance._cleanup();\n    }\n\n    // Cleanup dropdown listeners\n    if (instance._dropdownCleanup) {\n      instance._dropdownCleanup();\n    }\n\n    // Remove locale change handler\n    if (instance._localeChangeHandler && window.EventManager) {\n      EventManager.off('locale:changed', instance._localeChangeHandler);\n      delete instance._localeChangeHandler;\n    }\n\n    // Close dropdown if open\n    const panel = window.DropdownPanel?.getInstance();\n    if (panel && panel.currentTarget === instance.trigger) {\n      panel.hide();\n    }\n\n    // Remove trigger button\n    if (instance.trigger && instance.trigger.parentNode) {\n      instance.trigger.parentNode.removeChild(instance.trigger);\n    }\n\n    // Restore original select\n    if (instance.element && instance.element.tagName === 'SELECT') {\n      instance.element.style.display = '';\n      instance.element.removeAttribute('aria-hidden');\n    }\n\n    super.cleanup?.(instance);\n  }\n\n  static create(def) {\n    // This factory doesn't create from scratch, it transforms existing select-multiple\n    console.warn('MultiSelectElementFactory.create() is not supported. Use existing <select multiple> element.');\n    return null;\n  }\n\n  /**\n   * Populate select element from provided options object\n   * Used when options are provided by modal response or parent context\n   * @param {HTMLSelectElement} element - Select element\n   * @param {Object} optionsData - Options data object (e.g., {provinces: [...], genders: [...]})\n   * @param {String} optionsKey - Key to extract from optionsData (e.g., 'provinces')\n   * @static\n   */\n  static populateFromOptions(element, optionsData, optionsKey) {\n    if (!element || !optionsData || !optionsKey) return;\n\n    let options = optionsData[optionsKey];\n    if (!options) return;\n\n    // Validate options format (must be Array)\n    if (!Array.isArray(options)) {\n      console.warn('Please update your API to return options in format: [{value: \"1\", text: \"Option 1\"}, ...]');\n      return;\n    }\n\n    // Validate array items have correct format\n    const hasInvalidItems = options.some(opt =>\n      typeof opt !== 'object' || !('value' in opt) || !('text' in opt)\n    );\n\n    if (hasInvalidItems) return;\n\n    // Save current selected values before updating options\n    const currentSelectedValues = Array.from(element.selectedOptions).map(opt => opt.value);\n\n    // Update element's options using existing updateOptions method\n    this.updateOptions(element, options, element.dataset.useOptGroups === 'true');\n\n    // Restore selected values after populating options\n    if (currentSelectedValues.length > 0) {\n      this.setSelectedValues(element, currentSelectedValues);\n    }\n  }\n\n  /**\n * Populate all select elements with data-options-key attribute from provided options object\n * @param {HTMLElement} container - Container element (form, modal, etc.)\n * @param {Object} optionsData - Options data object\n * @static\n */\n  static populateFromOptionsInContainer(container, optionsData) {\n    if (!container || !optionsData) return;\n\n    const selectsWithOptionsKey = container.querySelectorAll('select[data-options-key][multiple]');\n\n    selectsWithOptionsKey.forEach(select => {\n      const optionsKey = select.dataset.optionsKey;\n      this.populateFromOptions(select, optionsData, optionsKey);\n    });\n  }\n}\n\n// Register with ElementManager\nElementManager.registerElement('select-multiple', MultiSelectElementFactory);\n\n// Expose globally\nwindow.MultiSelectElementFactory = MultiSelectElementFactory;","/**\n * Enhanced Range Slider Component - Single & Dual Range Support\n * Creates custom range sliders with better UX than native input[type=\"range\"]\n */\nclass EmbeddedRangeSlider {\n  constructor(originalElement) {\n    this._original = originalElement;\n    if (!this._original) {\n      throw new Error('RangeSlider: Original element is required');\n    }\n\n    this.name = this._original.getAttribute('name') || '';\n    this.id = this._original.id || ('rangeslider-' + Math.random().toString(36).slice(2, 8));\n    this._original.closest('.form-control').classList.add('form-control-range');\n\n    // Parse configuration\n    this.min = parseFloat(this._original.getAttribute('min')) || 0;\n    this.max = parseFloat(this._original.getAttribute('max')) || 100;\n    this.step = parseFloat(this._original.getAttribute('step')) || this._calculateStep();\n    this.isDualRange = this._original.hasAttribute('range') || this._original.hasAttribute('data-range');\n    this.showLabels = this._original.hasAttribute('data-show-labels');\n    this.showTooltips = this._original.hasAttribute('data-show-tooltips');\n    this.prefix = this._original.getAttribute('data-prefix') || '';\n    this.suffix = this._original.getAttribute('data-suffix') || '';\n\n    // Initialize state\n    this.disabled = this._original.hasAttribute('disabled');\n    this.readonly = this._original.hasAttribute('readonly');\n    this.isDragging = false;\n    this.activeHandle = null;\n\n    // Parse initial values\n    this._parseInitialValues();\n\n    this._initializeElements();\n    this._setupEventListeners();\n    this._replaceOriginalElement();\n    this._updateDisplay();\n  }\n\n  _calculateStep() {\n    const range = this.max - this.min;\n    if (range < 1) return 0.01;\n    if (range < 100) return 1;\n    return Math.floor((range / 100) * 1000) / 1000;\n  }\n\n  _parseInitialValues() {\n    const value = this._original.value || this._original.getAttribute('value') || '';\n\n    if (this.isDualRange) {\n      if (value.includes(',')) {\n        const values = value.split(',').map(v => parseFloat(v.trim()));\n        this.values = [\n          Math.max(this.min, Math.min(this.max, values[0] || this.min)),\n          Math.max(this.min, Math.min(this.max, values[1] || this.max))\n        ];\n      } else {\n        this.values = [this.min, this.max];\n      }\n\n      // Ensure proper order\n      if (this.values[0] > this.values[1]) {\n        [this.values[0], this.values[1]] = [this.values[1], this.values[0]];\n      }\n    } else {\n      this.values = Math.max(this.min, Math.min(this.max, parseFloat(value) || this.min));\n    }\n  }\n\n  _initializeElements() {\n    // Create main wrapper\n    this.wrapper = document.createElement('div');\n    this.wrapper.className = 'custom-range-slider';\n    this.wrapper.id = this.id + '_wrapper';\n\n    // Create labels container if needed\n    if (this.showLabels) {\n      this.labelsContainer = document.createElement('div');\n      this.labelsContainer.className = 'range-labels';\n\n      this.minLabel = document.createElement('span');\n      this.minLabel.className = 'range-label min';\n      this.minLabel.textContent = this._formatValue(this.min);\n\n      this.maxLabel = document.createElement('span');\n      this.maxLabel.className = 'range-label max';\n      this.maxLabel.textContent = this._formatValue(this.max);\n\n      this.labelsContainer.appendChild(this.minLabel);\n      this.labelsContainer.appendChild(this.maxLabel);\n      this.wrapper.appendChild(this.labelsContainer);\n    }\n\n    // Create slider container\n    this.sliderContainer = document.createElement('div');\n    this.sliderContainer.className = 'slider-container';\n    this.wrapper.appendChild(this.sliderContainer);\n\n    // Create track\n    this.track = document.createElement('div');\n    this.track.className = 'slider-track';\n    this.sliderContainer.appendChild(this.track);\n\n    // Create range (filled area)\n    this.range = document.createElement('div');\n    this.range.className = 'slider-range';\n    this.track.appendChild(this.range);\n\n    // Create handles\n    this.leftHandle = document.createElement('div');\n    this.leftHandle.className = 'slider-handle left';\n    this.leftHandle.tabIndex = 0;\n    this.leftHandle.setAttribute('role', 'slider');\n    this.leftHandle.setAttribute('aria-valuemin', this.min);\n    this.leftHandle.setAttribute('aria-valuemax', this.max);\n    this.sliderContainer.appendChild(this.leftHandle);\n\n    if (this.isDualRange) {\n      this.rightHandle = document.createElement('div');\n      this.rightHandle.className = 'slider-handle right';\n      this.rightHandle.tabIndex = 0;\n      this.rightHandle.setAttribute('role', 'slider');\n      this.rightHandle.setAttribute('aria-valuemin', this.min);\n      this.rightHandle.setAttribute('aria-valuemax', this.max);\n      this.sliderContainer.appendChild(this.rightHandle);\n    }\n\n    // Create tooltips if needed\n    if (this.showTooltips) {\n      this.leftTooltip = document.createElement('div');\n      this.leftTooltip.className = 'slider-tooltip left';\n      this.leftHandle.appendChild(this.leftTooltip);\n\n      if (this.isDualRange) {\n        this.rightTooltip = document.createElement('div');\n        this.rightTooltip.className = 'slider-tooltip right';\n        this.rightHandle.appendChild(this.rightTooltip);\n      }\n    }\n\n    // Create value display\n    this.valueDisplay = document.createElement('div');\n    this.valueDisplay.className = 'range-value-display';\n    this.wrapper.appendChild(this.valueDisplay);\n\n    // Create hidden input for form submission\n    this.hiddenInput = document.createElement('input');\n    this.hiddenInput.type = 'hidden';\n    this.hiddenInput.name = this.name;\n    this.hiddenInput.id = this.id + '_hidden';\n    this.wrapper.appendChild(this.hiddenInput);\n  }\n\n  _setupEventListeners() {\n    // Handle mouse events\n    this._setupMouseEvents();\n\n    // Handle keyboard events\n    this._setupKeyboardEvents();\n\n    // Handle touch events for mobile\n    this._setupTouchEvents();\n\n    // Handle resize\n    this._setupResizeObserver();\n  }\n\n  _setupMouseEvents() {\n    // Track click to jump to position\n    this.track.addEventListener('mousedown', (e) => {\n      if (this.disabled || this.readonly) return;\n\n      const rect = this.track.getBoundingClientRect();\n      const clickX = e.clientX - rect.left;\n      const percentage = clickX / rect.width;\n      const value = this.min + (percentage * (this.max - this.min));\n\n      if (this.isDualRange) {\n        // Determine which handle is closer\n        const leftDistance = Math.abs(value - this.values[0]);\n        const rightDistance = Math.abs(value - this.values[1]);\n\n        if (leftDistance <= rightDistance) {\n          this.values[0] = this._snapToStep(value);\n          this.activeHandle = this.leftHandle;\n        } else {\n          this.values[1] = this._snapToStep(value);\n          this.activeHandle = this.rightHandle;\n        }\n\n        this._ensureValidRange();\n      } else {\n        this.values = this._snapToStep(value);\n        this.activeHandle = this.leftHandle;\n      }\n\n      this._updateDisplay();\n      this._dispatchChangeEvent();\n\n      // Start dragging\n      this._startDrag(e);\n    });\n\n    // Handle dragging\n    this.leftHandle.addEventListener('mousedown', (e) => {\n      if (this.disabled || this.readonly) return;\n      e.preventDefault();\n      this.activeHandle = this.leftHandle;\n      this._startDrag(e);\n    });\n\n    if (this.rightHandle) {\n      this.rightHandle.addEventListener('mousedown', (e) => {\n        if (this.disabled || this.readonly) return;\n        e.preventDefault();\n        this.activeHandle = this.rightHandle;\n        this._startDrag(e);\n      });\n    }\n  }\n\n  _setupKeyboardEvents() {\n    const handleKeydown = (e, isRight = false) => {\n      if (this.disabled || this.readonly) return;\n\n      let handled = false;\n      const currentValue = this.isDualRange ?\n        (isRight ? this.values[1] : this.values[0]) : this.values;\n\n      switch (e.key) {\n        case 'ArrowLeft':\n        case 'ArrowDown':\n          e.preventDefault();\n          this._adjustValue(isRight, -this.step);\n          handled = true;\n          break;\n        case 'ArrowRight':\n        case 'ArrowUp':\n          e.preventDefault();\n          this._adjustValue(isRight, this.step);\n          handled = true;\n          break;\n        case 'PageDown':\n          e.preventDefault();\n          this._adjustValue(isRight, -this.step * 10);\n          handled = true;\n          break;\n        case 'PageUp':\n          e.preventDefault();\n          this._adjustValue(isRight, this.step * 10);\n          handled = true;\n          break;\n        case 'Home':\n          e.preventDefault();\n          if (this.isDualRange) {\n            if (isRight) {\n              this.values[1] = this.values[0];\n            } else {\n              this.values[0] = this.min;\n            }\n          } else {\n            this.values = this.min;\n          }\n          this._updateDisplay();\n          this._dispatchChangeEvent();\n          handled = true;\n          break;\n        case 'End':\n          e.preventDefault();\n          if (this.isDualRange) {\n            if (isRight) {\n              this.values[1] = this.max;\n            } else {\n              this.values[0] = this.values[1];\n            }\n          } else {\n            this.values = this.max;\n          }\n          this._updateDisplay();\n          this._dispatchChangeEvent();\n          handled = true;\n          break;\n      }\n\n      if (handled) {\n        e.stopPropagation();\n      }\n    };\n\n    this.leftHandle.addEventListener('keydown', (e) => handleKeydown(e, false));\n    if (this.rightHandle) {\n      this.rightHandle.addEventListener('keydown', (e) => handleKeydown(e, true));\n    }\n  }\n\n  _setupTouchEvents() {\n    // Touch support for mobile\n    this.leftHandle.addEventListener('touchstart', (e) => {\n      if (this.disabled || this.readonly) return;\n      e.preventDefault();\n      this.activeHandle = this.leftHandle;\n      this._startDrag(e.touches[0]);\n    });\n\n    if (this.rightHandle) {\n      this.rightHandle.addEventListener('touchstart', (e) => {\n        if (this.disabled || this.readonly) return;\n        e.preventDefault();\n        this.activeHandle = this.rightHandle;\n        this._startDrag(e.touches[0]);\n      });\n    }\n  }\n\n  _setupResizeObserver() {\n    // Update display when container resizes\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(() => {\n        this._updateDisplay();\n      });\n      this.resizeObserver.observe(this.sliderContainer);\n    }\n  }\n\n  _startDrag(e) {\n    this.isDragging = true;\n    this.wrapper.classList.add('dragging');\n\n    const handleMouseMove = (e) => {\n      if (!this.isDragging) return;\n\n      const clientX = e.clientX || (e.touches && e.touches[0].clientX);\n      if (!clientX) return;\n\n      const rect = this.track.getBoundingClientRect();\n      const percentage = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));\n      const value = this.min + (percentage * (this.max - this.min));\n\n      if (this.isDualRange) {\n        if (this.activeHandle === this.leftHandle) {\n          this.values[0] = this._snapToStep(value);\n        } else {\n          this.values[1] = this._snapToStep(value);\n        }\n        this._ensureValidRange();\n      } else {\n        this.values = this._snapToStep(value);\n      }\n\n      this._updateDisplay();\n      this._dispatchInputEvent();\n    };\n\n    const handleMouseUp = () => {\n      if (this.isDragging) {\n        this.isDragging = false;\n        this.wrapper.classList.remove('dragging');\n        this.activeHandle = null;\n        this._dispatchChangeEvent();\n      }\n\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n      document.removeEventListener('touchmove', handleMouseMove);\n      document.removeEventListener('touchend', handleMouseUp);\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n    document.addEventListener('touchmove', handleMouseMove);\n    document.addEventListener('touchend', handleMouseUp);\n  }\n\n  _adjustValue(isRight, delta) {\n    if (this.isDualRange) {\n      if (isRight) {\n        this.values[1] = this._snapToStep(this.values[1] + delta);\n      } else {\n        this.values[0] = this._snapToStep(this.values[0] + delta);\n      }\n      this._ensureValidRange();\n    } else {\n      this.values = this._snapToStep(this.values + delta);\n    }\n\n    this._updateDisplay();\n    this._dispatchChangeEvent();\n  }\n\n  _snapToStep(value) {\n    const snapped = Math.round((value - this.min) / this.step) * this.step + this.min;\n    return Math.max(this.min, Math.min(this.max, snapped));\n  }\n\n  _ensureValidRange() {\n    if (this.isDualRange) {\n      if (this.values[0] > this.values[1]) {\n        [this.values[0], this.values[1]] = [this.values[1], this.values[0]];\n      }\n    }\n  }\n\n  _updateDisplay() {\n    const range = this.max - this.min;\n\n    if (this.isDualRange) {\n      const leftPercent = ((this.values[0] - this.min) / range) * 100;\n      const rightPercent = ((this.values[1] - this.min) / range) * 100;\n\n      this.leftHandle.style.left = `${leftPercent}%`;\n      this.rightHandle.style.left = `${rightPercent}%`;\n      this.range.style.left = `${leftPercent}%`;\n      this.range.style.width = `${rightPercent - leftPercent}%`;\n\n      // Update ARIA values\n      this.leftHandle.setAttribute('aria-valuenow', this.values[0]);\n      this.rightHandle.setAttribute('aria-valuenow', this.values[1]);\n\n      // Update tooltips\n      if (this.showTooltips) {\n        this.leftTooltip.textContent = this._formatValue(this.values[0]);\n        this.rightTooltip.textContent = this._formatValue(this.values[1]);\n      }\n\n      // Update value display\n      this.valueDisplay.textContent = `${this._formatValue(this.values[0])} - ${this._formatValue(this.values[1])}`;\n\n      // Update hidden input\n      this.hiddenInput.value = `${this.values[0]},${this.values[1]}`;\n    } else {\n      const percent = ((this.values - this.min) / range) * 100;\n\n      this.leftHandle.style.left = `${percent}%`;\n      this.range.style.width = `${percent}%`;\n\n      // Update ARIA values\n      this.leftHandle.setAttribute('aria-valuenow', this.values);\n\n      // Update tooltip\n      if (this.showTooltips) {\n        this.leftTooltip.textContent = this._formatValue(this.values);\n      }\n\n      // Update value display\n      this.valueDisplay.textContent = this._formatValue(this.values);\n\n      // Update hidden input\n      this.hiddenInput.value = this.values.toString();\n    }\n  }\n\n  _formatValue(value) {\n    const decimals = this.step < 1 ? 2 : 0;\n    const formatted = Utils.number.format(value, decimals);\n    return `${this.prefix}${formatted}${this.suffix}`;\n  }\n\n  _dispatchInputEvent() {\n    const inputEvent = new Event('input', {bubbles: true});\n    this.hiddenInput.dispatchEvent(inputEvent);\n\n    this.wrapper.dispatchEvent(new CustomEvent('rangeslider:input', {\n      detail: {\n        values: this.isDualRange ? [...this.values] : this.values,\n        min: this.min,\n        max: this.max\n      }\n    }));\n  }\n\n  _dispatchChangeEvent() {\n    const changeEvent = new Event('change', {bubbles: true});\n    this.hiddenInput.dispatchEvent(changeEvent);\n\n    this.wrapper.dispatchEvent(new CustomEvent('rangeslider:change', {\n      detail: {\n        values: this.isDualRange ? [...this.values] : this.values,\n        min: this.min,\n        max: this.max\n      }\n    }));\n  }\n\n  // Public methods\n  getValue() {\n    return this.isDualRange ? [...this.values] : this.values;\n  }\n\n  setValue(value) {\n    if (this.isDualRange) {\n      if (Array.isArray(value) && value.length >= 2) {\n        this.values = [\n          this._snapToStep(value[0]),\n          this._snapToStep(value[1])\n        ];\n        this._ensureValidRange();\n      }\n    } else {\n      this.values = this._snapToStep(value);\n    }\n\n    this._updateDisplay();\n  }\n\n  setMin(min) {\n    this.min = min;\n    this.leftHandle.setAttribute('aria-valuemin', min);\n    if (this.rightHandle) {\n      this.rightHandle.setAttribute('aria-valuemin', min);\n    }\n    if (this.showLabels) {\n      this.minLabel.textContent = this._formatValue(min);\n    }\n    this._updateDisplay();\n  }\n\n  setMax(max) {\n    this.max = max;\n    this.leftHandle.setAttribute('aria-valuemax', max);\n    if (this.rightHandle) {\n      this.rightHandle.setAttribute('aria-valuemax', max);\n    }\n    if (this.showLabels) {\n      this.maxLabel.textContent = this._formatValue(max);\n    }\n    this._updateDisplay();\n  }\n\n  setStep(step) {\n    this.step = step;\n    this._updateDisplay();\n  }\n\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.wrapper.classList.toggle('disabled', disabled);\n    this.leftHandle.tabIndex = disabled ? -1 : 0;\n    if (this.rightHandle) {\n      this.rightHandle.tabIndex = disabled ? -1 : 0;\n    }\n  }\n\n  setReadonly(readonly) {\n    this.readonly = readonly;\n    this.wrapper.classList.toggle('readonly', readonly);\n  }\n\n  destroy() {\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n\n    if (this.wrapper && this.wrapper.parentNode) {\n      this.wrapper.parentNode.removeChild(this.wrapper);\n    }\n  }\n\n  getElement() {\n    return this.wrapper;\n  }\n\n  _replaceOriginalElement() {\n    if (this._original.parentNode) {\n      this._original.parentNode.insertBefore(this.wrapper, this._original);\n      this._original.parentNode.removeChild(this._original);\n    }\n  }\n}\n\n// Expose for backward compatibility\nif (!window.GRange) {\n  window.GRange = EmbeddedRangeSlider;\n}\n\n/**\n * RangeElementFactory - Factory for creating range slider elements\n */\nclass RangeElementFactory extends ElementFactory {\n  static config = {\n    ...ElementFactory.config,\n    type: 'range'\n  };\n\n  static createInstance(element, config = {}) {\n    const instance = super.createInstance(element, config);\n    return instance;\n  }\n\n  static setupElement(instance) {\n    const {element} = instance;\n\n    try {\n      const rangeSlider = new EmbeddedRangeSlider(element);\n\n      instance.wrapper = rangeSlider.getElement();\n      instance.rangeSlider = rangeSlider;\n\n      // Bind methods\n      instance.getValue = () => rangeSlider.getValue();\n      instance.setValue = (value) => rangeSlider.setValue(value);\n      instance.setMin = (min) => rangeSlider.setMin(min);\n      instance.setMax = (max) => rangeSlider.setMax(max);\n      instance.setStep = (step) => rangeSlider.setStep(step);\n      instance.setDisabled = (disabled) => rangeSlider.setDisabled(disabled);\n      instance.setReadonly = (readonly) => rangeSlider.setReadonly(readonly);\n\n      // Update element reference\n      element.wrapper = instance.wrapper;\n\n      // Setup event forwarding\n      if (rangeSlider.hiddenInput) {\n        rangeSlider.hiddenInput.addEventListener('change', () => {\n          // Dispatch standard change event\n          const changeEvent = new Event('change', {bubbles: true});\n          element.dispatchEvent(changeEvent);\n\n          // Emit to event system\n          EventManager.emit('element:change', {\n            elementId: element.id,\n            values: rangeSlider.getValue(),\n            type: 'range'\n          });\n        });\n\n        rangeSlider.hiddenInput.addEventListener('input', () => {\n          // Dispatch standard input event\n          const inputEvent = new Event('input', {bubbles: true});\n          element.dispatchEvent(inputEvent);\n        });\n      }\n\n      // Forward custom events\n      rangeSlider.wrapper.addEventListener('rangeslider:change', (e) => {\n        element.dispatchEvent(new CustomEvent('rangeslider:change', {\n          detail: e.detail\n        }));\n      });\n\n      rangeSlider.wrapper.addEventListener('rangeslider:input', (e) => {\n        element.dispatchEvent(new CustomEvent('rangeslider:input', {\n          detail: e.detail\n        }));\n      });\n\n      // Cleanup override\n      const originalCleanup = instance.cleanup;\n      instance.cleanup = function() {\n        if (this.rangeSlider) {\n          this.rangeSlider.destroy();\n          this.rangeSlider = null;\n        }\n        if (originalCleanup) {\n          originalCleanup.call(this);\n        }\n        return this;\n      };\n\n      return instance;\n\n    } catch (error) {\n      console.error('RangeElementFactory: Failed to setup element:', error);\n      return instance;\n    }\n  }\n}\n\n// Register with ElementManager\nif (typeof ElementManager !== 'undefined') {\n  ElementManager.registerElement('range', RangeElementFactory);\n} else {\n  console.warn('RangeElementFactory: ElementManager not found');\n}\n","class PasswordElementFactory extends TextElementFactory {\n  static config = {\n    ...TextElementFactory.config,\n    type: 'password',\n    showPasswordToggle: true,\n    minLength: 8,\n    maxLength: 50,\n    passwordCriteriaList: false,\n    criteriaListClass: 'password-criteria-list',\n    passwordCriteria: {\n      minLength: {enabled: true, value: 8, label: 'At least {value} characters'},\n      uppercase: {enabled: true, label: 'At least one uppercase letter'},\n      lowercase: {enabled: true, label: 'At least one lowercase letter'},\n      numbers: {enabled: false, label: 'At least one number'},\n      special: {enabled: false, label: 'At least one special character'},\n      match: {enabled: false, label: 'Passwords match'}\n    }\n  };\n\n  // Helper: try to locate an already-created strength container for this element\n  static locateStrengthContainer(element) {\n    if (!element) return null;\n\n    // 1) Immediate next sibling\n    try {\n      const next = element.nextElementSibling;\n      if (next && next.classList && next.classList.contains('password-strength')) return next;\n    } catch (e) {}\n\n    // 2) wrapper or container siblings\n    try {\n      if (element.wrapper) {\n        const found = element.wrapper.querySelector('.password-strength');\n        if (found) return found;\n      }\n    } catch (e) {}\n\n    try {\n      if (element.container && element.container.parentNode) {\n        const parent = element.container.parentNode;\n        const found = parent.querySelector('.password-strength');\n        if (found) return found;\n      }\n    } catch (e) {}\n\n    // 3) comment-based result id\n    try {\n      const commentId = 'result_' + (element.id || '');\n      const commentEl = commentId ? document.getElementById(commentId) : null;\n      if (commentEl) {\n        const found = commentEl.nextElementSibling;\n        if (found && found.classList && found.classList.contains('password-strength')) return found;\n      }\n    } catch (e) {}\n\n    // 4) form-level search fallback (limited scope)\n    try {\n      const form = element.form || (element.closest ? element.closest('form') : null);\n      if (form) {\n        const found = form.querySelector('.password-strength');\n        if (found) return found;\n      }\n    } catch (e) {}\n\n    return null;\n  }\n\n  static setupElement(instance) {\n    super.setupElement(instance);\n    const {element, config} = instance;\n\n    element.setAttribute('autocomplete', 'new-password');\n    element.dataset.customPasswordField = 'true';\n\n    if (config.showPasswordToggle) {\n      this.setupPasswordToggle(instance);\n    }\n\n    instance.checkMatch = function(targetElement) {\n      if (!targetElement) return false;\n      return element.value === targetElement.value;\n    };\n\n    // Helper on instance: check single criterion pass/fail\n    instance.passesCriterion = function(key, password) {\n      if (!password) return false;\n      switch (key) {\n        case 'minLength':\n          return password.length >= (config.passwordCriteria.minLength?.value || config.minLength || 8);\n        case 'uppercase':\n          return /[A-Z]/.test(password);\n        case 'lowercase':\n          return /[a-z]/.test(password);\n        case 'numbers':\n          return /[0-9]/.test(password);\n        case 'special':\n          return /[^A-Za-z0-9]/.test(password);\n        case 'match':\n          // match is handled separately\n          return true;\n        default:\n          return true;\n      }\n    };\n\n    instance.validateSpecific = function(value) {\n      const parentValidation = TextElementFactory.prototype.validateSpecific ?\n        TextElementFactory.prototype.validateSpecific.call(this, value) : null;\n\n      if (parentValidation) return parentValidation;\n\n      if (!value && !element.required) return null;\n\n      for (const rule of this.validationRules || []) {\n        const ruleName = typeof rule === 'string' ? rule : rule.name;\n\n        if (ruleName === 'password') {\n          const failedCriteria = this.getFailedCriteria(value);\n          if (failedCriteria.length > 0) {\n            return Now.translate('Password must include: {criteria}', {criteria: failedCriteria.join(', ')});\n          }\n        }\n      }\n\n      return null;\n    };\n\n    instance.getFailedCriteria = function(password) {\n      if (!password || element.dataset.targetPassword) return [];\n      const failedCriteria = [];\n\n      Object.entries(config.passwordCriteria).forEach(([key, criterion]) => {\n        if (!criterion.enabled || key === 'match') return;\n        const passed = instance.passesCriterion(key, password);\n        if (!passed) {\n          failedCriteria.push(criterion.label.replace('{value}', criterion.value));\n        }\n      });\n\n      return failedCriteria;\n    };\n\n    instance.updateCriteriaList = function() {\n      if (!instance.criteriaListElement) return;\n\n      const password = element.value;\n      const failedCriteria = this.getFailedCriteria(password);\n      const criteriaItems = instance.criteriaListElement.querySelectorAll('li');\n\n      if (!password) {\n        instance.criteriaListElement.classList.remove('validating');\n        criteriaItems.forEach(item => {\n          item.className = 'icon-invalid';\n          item.setAttribute('aria-label', Now.translate('Criteria not checked'));\n        });\n        return;\n      }\n\n      criteriaItems.forEach(item => {\n        const criteriaLabel = item.textContent;\n        const isFailed = failedCriteria.includes(criteriaLabel);\n        item.className = isFailed ? 'icon-invalid' : 'icon-valid';\n        item.setAttribute('aria-label', Now.translate(!isFailed ? 'Criteria met' : 'Criteria not met'));\n      });\n    };\n\n    instance.updateMatchStatus = function() {\n      const targetId = element.dataset.targetPassword;\n      const targetElement = targetId ? document.getElementById(targetId) : null;\n      const isConfirmField = !!targetId;\n      const mainElement = isConfirmField ? targetElement : element;\n      const confirmElement = isConfirmField ? element : null;\n\n      if (!mainElement) return;\n\n      const mainValue = mainElement.value;\n      const hasMainValue = mainValue.length > 0;\n      const confirmValue = confirmElement?.value || '';\n      const isMatch = mainValue === confirmValue && hasMainValue;\n      mainElement.classList.toggle('valid', isMatch && hasMainValue);\n      mainElement.classList.toggle('invalid', !isMatch && hasMainValue);\n      mainElement.container?.classList.toggle('valid', isMatch && hasMainValue);\n      mainElement.container?.classList.toggle('invalid', !isMatch && hasMainValue);\n      if (confirmElement) {\n        const hasConfirmValue = confirmValue.length > 0;\n        confirmElement.classList.toggle('valid', isMatch && hasConfirmValue);\n        confirmElement.classList.toggle('invalid', !isMatch && hasConfirmValue);\n        confirmElement.container?.classList.toggle('valid', isMatch && hasConfirmValue);\n        confirmElement.container?.classList.toggle('invalid', !isMatch && hasConfirmValue);\n      }\n    };\n\n    // If a strength flag or register form indicates strength UI, render a strength bar\n    try {\n      const form = element.form || (element.closest ? element.closest('form') : null);\n      const isRegisterForm = form && (form.dataset?.form === 'register' || form.getAttribute && form.getAttribute('data-form') === 'register');\n      // treat explicit 'bar' value or any truthy value as a request for a strength bar\n      const wantsStrength = (element.dataset.passwordStrength === 'bar' || element.dataset.passwordStrength === 'true' || Boolean(element.dataset.passwordStrength)) || isRegisterForm;\n\n      if (wantsStrength && !element.dataset.targetPassword) {\n        // Avoid duplicate strength UI: check if one already exists\n        let existing = PasswordElementFactory.locateStrengthContainer(element);\n        if (!existing) {\n          // create strength container and bar synchronously so it's present immediately\n          const strengthContainer = document.createElement('div');\n          strengthContainer.className = 'password-strength';\n          const strengthBar = document.createElement('div');\n          strengthBar.className = 'password-strength-bar';\n          strengthBar.setAttribute('role', 'progressbar');\n          strengthBar.setAttribute('aria-valuemin', '0');\n          strengthBar.setAttribute('aria-valuemax', '100');\n          strengthBar.style.width = '0%';\n          strengthContainer.appendChild(strengthBar);\n\n          // Insert strength bar - priority order: commentId > element.comment > wrapper > container\n          let inserted = false;\n\n          // Priority 1: Find comment element by ID (result_{element_id})\n          // Use form.querySelector for modal support (element may not be in DOM yet)\n          try {\n            const commentId = 'result_' + (element.id || '');\n            if (commentId) {\n              const form = element.form || (element.closest ? element.closest('form') : null);\n              const commentEl = form ? form.querySelector('#' + commentId) : document.getElementById(commentId);\n              if (commentEl && commentEl.parentNode) {\n                commentEl.parentNode.insertBefore(strengthContainer, commentEl.nextSibling);\n                inserted = true;\n              }\n            }\n          } catch (e) {}\n\n          // Priority 2: Use element.comment property if available\n          if (!inserted) {\n            try {\n              if (element.comment && element.comment.parentNode) {\n                element.comment.parentNode.insertBefore(strengthContainer, element.comment.nextSibling);\n                inserted = true;\n              }\n            } catch (e) {}\n          }\n\n          // Priority 3: Append to wrapper\n          if (!inserted) {\n            try {\n              if (element.wrapper) {\n                element.wrapper.appendChild(strengthContainer);\n                inserted = true;\n              }\n            } catch (e) {}\n          }\n\n          // Priority 4: Insert after container\n          if (!inserted) {\n            try {\n              if (element.container && element.container.parentNode) {\n                const parent = element.container.parentNode;\n                parent.insertBefore(strengthContainer, element.container.nextSibling);\n                inserted = true;\n              }\n            } catch (e) {}\n          }\n\n          if (!inserted) {\n            try {\n              // try to insert after the immediate parent (span.form-control) if possible\n              if (element.parentNode && element.parentNode.parentNode) {\n                const parent = element.parentNode;\n                parent.parentNode.insertBefore(strengthContainer, parent.nextSibling);\n                inserted = true;\n              }\n            } catch (e) {}\n          }\n\n          if (!inserted) {\n            // deterministic fallback: insert immediately after the input element if possible\n            try {\n              if (element.insertAdjacentElement) {\n                element.insertAdjacentElement('afterend', strengthContainer);\n                inserted = true;\n              }\n            } catch (e) {}\n          }\n\n          if (!inserted) {\n            // fallback: append to form or document body\n            try {\n              const formEl = element.form || (element.closest ? element.closest('form') : null);\n              if (formEl) formEl.appendChild(strengthContainer);\n              else document.body.appendChild(strengthContainer);\n            } catch (e) {\n              try {document.body.appendChild(strengthContainer);} catch (er) {}\n            }\n          }\n\n          instance.strengthBarElement = strengthBar;\n          try {element.dataset.passwordStrength = 'true';} catch (e) {}\n        } else {\n          // reuse existing bar\n          instance.strengthBarElement = existing.querySelector('.password-strength-bar') || null;\n          try {element.dataset.passwordStrength = 'true';} catch (e) {}\n        }\n\n        instance.updateStrengthBar = function() {\n          if (!instance.strengthBarElement) return;\n          const password = element.value || '';\n          const allCriteria = Object.entries(config.passwordCriteria).filter(([k, c]) => c.enabled && k !== 'match');\n          const total = allCriteria.length || 1;\n          let passed = 0;\n          allCriteria.forEach(([k]) => {\n            if (instance.passesCriterion(k, password)) passed += 1;\n          });\n          const pct = Math.round((passed / total) * 100);\n          instance.strengthBarElement.style.width = pct + '%';\n          instance.strengthBarElement.classList.remove('weak', 'medium', 'strong');\n          if (pct < 40) instance.strengthBarElement.classList.add('weak');\n          else if (pct < 80) instance.strengthBarElement.classList.add('medium');\n          else instance.strengthBarElement.classList.add('strong');\n          instance.strengthBarElement.setAttribute('aria-valuenow', String(pct));\n        };\n\n        // initialize\n        instance.updateStrengthBar();\n      }\n    } catch (e) {\n      // ignore DOM availability errors in non-browser environments\n    }\n\n    if (config.passwordCriteriaList && !element.dataset.targetPassword) {\n      this.setupCriteriaList(instance);\n    }\n\n    return instance;\n  }\n\n  static setupPasswordToggle(instance) {\n    const {element} = instance;\n\n    const toggleButton = document.createElement('button');\n    toggleButton.type = 'button';\n    toggleButton.className = 'password-toggle icon-published0';\n    toggleButton.setAttribute('aria-label', Now.translate('Show password'));\n    toggleButton.setAttribute('tabindex', '-1');\n    toggleButton.setAttribute('aria-description', Now.translate('Press Alt + S to toggle password visibility'));\n\n    if (element.container) {\n      element.container.classList.add('has-password-toggle');\n      element.container.appendChild(toggleButton);\n    } else if (element.wrapper) {\n      const container = document.createElement('div');\n      container.className = 'form-control has-password-toggle';\n      element.parentNode.insertBefore(container, element);\n      container.appendChild(element);\n      container.appendChild(toggleButton);\n      element.container = container;\n    }\n\n    const togglePasswordVisibility = () => {\n      if (element.type === 'password') {\n        element.type = 'text';\n        toggleButton.setAttribute('aria-label', Now.translate('Hide password'));\n        toggleButton.className = 'password-toggle icon-published1';\n      } else {\n        element.type = 'password';\n        toggleButton.setAttribute('aria-label', Now.translate('Show password'));\n        toggleButton.className = 'password-toggle icon-published0';\n      }\n      element.focus();\n    };\n\n    EventSystemManager.addHandler(toggleButton, 'click', togglePasswordVisibility);\n    EventSystemManager.addHandler(element, 'keydown', (event) => {\n      if (event.altKey && event.key === 's') {\n        event.preventDefault();\n        togglePasswordVisibility();\n      }\n    });\n\n    EventSystemManager.addHandler(element, 'focus', () => {\n      toggleButton.classList.remove('hidden');\n    });\n\n    instance.toggleButton = toggleButton;\n  }\n\n  static setupCriteriaList(instance) {\n    const {element, config} = instance;\n\n    const criteriaListElement = document.createElement('ul');\n    criteriaListElement.className = config.criteriaListClass;\n    criteriaListElement.setAttribute('aria-live', 'polite');\n\n    Object.entries(config.passwordCriteria).forEach(([key, criterion]) => {\n      if (!criterion.enabled || key === 'match') return;\n\n      const listItem = document.createElement('li');\n      listItem.dataset.criteria = key;\n      listItem.className = 'icon-invalid';\n      listItem.setAttribute('aria-label', Now.translate('Criteria not met'));\n      listItem.textContent = Now.translate(criterion.label.replace('{value}', criterion.value));\n      criteriaListElement.appendChild(listItem);\n    });\n\n    if (element.comment) {\n      element.comment.parentNode.insertBefore(criteriaListElement, element.comment.nextSibling);\n    } else if (element.wrapper) {\n      element.wrapper.appendChild(criteriaListElement);\n    } else if (element.container) {\n      const parent = element.container.parentNode;\n      parent.insertBefore(criteriaListElement, element.container.nextSibling);\n    }\n\n    instance.criteriaListElement = criteriaListElement;\n    instance.updateCriteriaList = function() {\n      if (!instance.criteriaListElement) return;\n\n      const password = element.value;\n      const failedCriteria = this.getFailedCriteria(password);\n      const criteriaItems = instance.criteriaListElement.querySelectorAll('li');\n\n      if (!password) {\n        instance.criteriaListElement.classList.remove('validating');\n        criteriaItems.forEach(item => {\n          item.className = 'icon-invalid';\n          item.setAttribute('aria-label', Now.translate('Criteria not checked'));\n        });\n        return;\n      }\n\n      criteriaItems.forEach(item => {\n        const criteriaLabel = item.textContent;\n        const isFailed = failedCriteria.includes(criteriaLabel);\n        item.className = isFailed ? 'icon-invalid' : 'icon-valid';\n        item.setAttribute('aria-label', Now.translate(!isFailed ? 'Criteria met' : 'Criteria not met'));\n      });\n    };\n\n    instance.updateCriteriaList();\n  }\n\n  static setupEventListeners(instance) {\n    super.setupEventListeners(instance);\n    const {element, config} = instance;\n\n    // Helper to create strength bar synchronously if the element belongs to the register form\n    const ensureStrengthBar = () => {\n      try {\n        const form = element.form || (element.closest ? element.closest('form') : null);\n        const isRegisterForm = form && (form.dataset?.form === 'register' || (form.getAttribute && form.getAttribute('data-form') === 'register'));\n        // only create for register form or explicit bar request\n        const wantsStrengthLocal = (element.dataset.passwordStrength === 'bar' || element.dataset.passwordStrength === 'true' || Boolean(element.dataset.passwordStrength));\n        if (!isRegisterForm && !wantsStrengthLocal) return;\n        if (element.dataset.targetPassword) return;\n        if (instance.strengthBarElement) return; // already created\n\n        // avoid duplicate bars\n        let existing = PasswordElementFactory.locateStrengthContainer(element);\n        let strengthContainer = existing;\n        let strengthBar = existing ? existing.querySelector('.password-strength-bar') : null;\n        if (!existing) {\n          strengthContainer = document.createElement('div');\n          strengthContainer.className = 'password-strength';\n          strengthBar = document.createElement('div');\n          strengthBar.className = 'password-strength-bar';\n          strengthBar.setAttribute('role', 'progressbar');\n          strengthBar.setAttribute('aria-valuemin', '0');\n          strengthBar.setAttribute('aria-valuemax', '100');\n          strengthBar.style.width = '0%';\n          strengthContainer.appendChild(strengthBar);\n        }\n\n        // try multiple insertion strategies similar to the synchronous creation above\n        let inserted = false;\n        try {\n          const commentId = 'result_' + (element.id || '');\n          if (commentId) {\n            const form = element.form || (element.closest ? element.closest('form') : null);\n            const commentEl = form ? form.querySelector('#' + commentId) : document.getElementById(commentId);\n            if (commentEl && commentEl.parentNode) {\n              commentEl.parentNode.insertBefore(strengthContainer, commentEl.nextSibling);\n              inserted = true;\n            }\n          }\n        } catch (e) {}\n\n        if (!inserted) {\n          try {\n            if (element.parentNode && element.parentNode.parentNode) {\n              const parent = element.parentNode;\n              parent.parentNode.insertBefore(strengthContainer, parent.nextSibling);\n              inserted = true;\n            }\n          } catch (e) {}\n        }\n\n        if (!inserted) {\n          // deterministic fallback: insert immediately after the input element if possible\n          try {\n            if (element.insertAdjacentElement) {\n              element.insertAdjacentElement('afterend', strengthContainer);\n              inserted = true;\n            }\n          } catch (e) {}\n        }\n\n        if (!inserted) {\n          try {\n            const formEl = element.form || (element.closest ? element.closest('form') : null);\n            if (formEl) formEl.appendChild(strengthContainer);\n            else document.body.appendChild(strengthContainer);\n            inserted = true;\n          } catch (e) {}\n        }\n\n        instance.strengthBarElement = strengthBar;\n        try {element.dataset.passwordStrength = 'true';} catch (e) {}\n\n        instance.updateStrengthBar = function() {\n          if (!instance.strengthBarElement) return;\n          const password = element.value.trim() || '';\n          if (password === '') {\n            instance.strengthBarElement.style.width = '0%';\n            instance.strengthBarElement.classList.remove('weak', 'medium', 'strong');\n            instance.strengthBarElement.setAttribute('aria-valuenow', '0');\n            return;\n          }\n          const allCriteria = Object.entries(config.passwordCriteria).filter(([k, c]) => c.enabled && k !== 'match');\n          const total = allCriteria.length || 1;\n          const failed = instance.getFailedCriteria(password).length;\n          const passed = Math.max(0, total - failed);\n          const pct = Math.round((passed / total) * 100);\n          instance.strengthBarElement.style.width = pct + '%';\n          instance.strengthBarElement.classList.remove('weak', 'medium', 'strong');\n          if (pct < 40) instance.strengthBarElement.classList.add('weak');\n          else if (pct < 80) instance.strengthBarElement.classList.add('medium');\n          else instance.strengthBarElement.classList.add('strong');\n          instance.strengthBarElement.setAttribute('aria-valuenow', String(pct));\n        };\n      } catch (err) {\n        // swallow\n      }\n    };\n\n    const inputHandler = () => {\n      if (!element.dataset.targetPassword && config.passwordCriteriaList) {\n        instance.updateCriteriaList();\n      }\n      // ensure strength bar exists for register form and update it\n      ensureStrengthBar();\n      if (instance.updateStrengthBar) {\n        instance.updateStrengthBar();\n      }\n      instance.updateMatchStatus();\n    };\n\n    EventSystemManager.addHandler(element, 'input', inputHandler);\n    // Try to create the strength bar immediately during setup so templates that are enhanced\n    // after insertion will get the strength UI without waiting for user input.\n    try {\n      ensureStrengthBar();\n    } catch (e) {}\n    if (instance.updateStrengthBar) {\n      try {instance.updateStrengthBar();} catch (e) {}\n    }\n    // Also schedule a deferred creation to handle enhancement order/race conditions\n    try {\n      if (typeof requestAnimationFrame !== 'undefined') {\n        requestAnimationFrame(() => {\n          try {ensureStrengthBar(); if (instance.updateStrengthBar) instance.updateStrengthBar();} catch (e) {}\n        });\n      } else {\n        setTimeout(() => {\n          try {ensureStrengthBar(); if (instance.updateStrengthBar) instance.updateStrengthBar();} catch (e) {}\n        }, 0);\n      }\n    } catch (e) {}\n\n    // Bind form reset to clear strength UI\n    try {\n      const form = element.form || (element.closest ? element.closest('form') : null);\n      if (form) {\n        instance._formResetHandler = function() {\n          try {\n            if (instance.strengthBarElement) {\n              instance.strengthBarElement.style.width = '0%';\n              instance.strengthBarElement.classList.remove('weak', 'medium', 'strong');\n              instance.strengthBarElement.setAttribute('aria-valuenow', '0');\n            }\n            if (instance.criteriaListElement) {\n              instance.criteriaListElement.querySelectorAll('li').forEach(li => {\n                li.className = 'icon-invalid';\n                li.setAttribute('aria-label', Now.translate('Criteria not checked'));\n              });\n            }\n            try {delete element.dataset.passwordStrength;} catch (er) {}\n          } catch (er) {}\n        };\n        EventSystemManager.addHandler(form, 'reset', instance._formResetHandler);\n      }\n    } catch (er) {}\n\n    // Provide destroy/cleanup for this instance\n    const originalDestroy = instance.destroy;\n    instance.destroy = function() {\n      try {\n        if (instance.strengthBarElement && instance.strengthBarElement.parentNode) {\n          const container = instance.strengthBarElement.closest('.password-strength');\n          if (container && container.parentNode) container.parentNode.removeChild(container);\n        }\n        if (instance.criteriaListElement && instance.criteriaListElement.parentNode) {\n          instance.criteriaListElement.parentNode.removeChild(instance.criteriaListElement);\n        }\n        if (instance._formResetHandler) {\n          const form = element.form || (element.closest ? element.closest('form') : null);\n          try {EventSystemManager.removeHandler(form, 'reset', instance._formResetHandler);} catch (e) {}\n          instance._formResetHandler = null;\n        }\n        try {delete element.dataset.passwordStrength;} catch (e) {}\n      } catch (e) {\n        // swallow\n      }\n      if (typeof originalDestroy === 'function') {\n        try {originalDestroy.call(instance);} catch (e) {}\n      }\n    };\n  }\n}\n\nElementManager.registerElement('password', PasswordElementFactory);\n","/**\n * CalendarManager - Advanced Calendar Component\n * Supports multiple view modes: month, week, day, timeline\n * Features continuous timeline view and modern UI\n */\nconst CalendarManager = {\n  config: {\n    defaultView: 'month', // 'month', 'week', 'day', 'timeline'\n    locale: 'auto', // 'auto' = detect from I18nManager, or specific locale like 'th', 'en'\n    timezone: 'Asia/Bangkok',\n    firstDayOfWeek: 0, // 0 = Sunday, 1 = Monday\n    showWeekNumbers: false,\n    showToday: true,\n    allowViewChange: true,\n    eventHeight: 20,\n    timelineHeight: 60,\n    workingHours: {start: 8, end: 18},\n    weekends: [0, 6], // Sunday, Saturday\n    minDate: null,\n    maxDate: null,\n    events: [],\n    // Date format patterns (uses Utils.date.format tokens)\n    dateFormats: {\n      day: 'D MMMM YYYY',        // Day view header\n      week: 'D - ',              // Week view range (partial)\n      month: 'MMMM YYYY',        // Month view header\n      cell: 'YYYY-MM-DD'         // Cell data attribute (ISO format)\n    },\n    callbacks: {\n      onDateClick: null,\n      onEventClick: null,\n      onViewChange: null,\n      onDateChange: null\n    }\n  },\n\n  state: {\n    calendars: new Map(),\n    currentDate: new Date(),\n    currentView: 'month',\n    initialized: false\n  },\n\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n    this.state.currentDate = new Date();\n    this.state.currentView = this.config.defaultView;\n\n    // Initialize any existing elements with data-calendar attribute\n    document.querySelectorAll('[data-calendar]').forEach(element => {\n      this.create(element);\n    });\n\n    // Listen for locale changes to re-render all calendars\n    if (window.EventManager?.on) {\n      EventManager.on('locale:changed', () => {\n        this.state.calendars.forEach((instance) => {\n          this.render(instance);\n        });\n      });\n    }\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  create(element, options = {}) {\n    if (typeof element === 'string') {\n      element = document.getElementById(element);\n    }\n\n    if (!element) return null;\n\n    if (element.calendarInstance) {\n      return element.calendarInstance;\n    }\n\n    const dataOptions = this.extractDataOptions(element);\n    const config = {...this.config, ...dataOptions, ...options};\n\n    const instance = {\n      element,\n      config,\n      currentDate: new Date(),\n      currentView: config.defaultView,\n      events: [...config.events],\n      isRendering: false\n    };\n\n    element.calendarInstance = instance;\n    this.state.calendars.set(element, instance);\n\n    this.setupCalendar(instance);\n    this.render(instance);\n\n    return instance;\n  },\n\n  extractDataOptions(element) {\n    const options = {};\n    const dataset = element.dataset;\n\n    if (dataset.calendar) {\n      options.defaultView = dataset.calendar;\n    }\n\n    if (dataset.calendarLocale) {\n      options.locale = dataset.calendarLocale;\n    }\n\n    if (dataset.calendarFirstDay) {\n      options.firstDayOfWeek = parseInt(dataset.calendarFirstDay);\n    }\n\n    if (dataset.calendarEvents) {\n      try {\n        options.events = JSON.parse(dataset.calendarEvents);\n      } catch (e) {\n        console.warn('Invalid events JSON:', dataset.calendarEvents);\n      }\n    }\n\n    return options;\n  },\n\n  setupCalendar(instance) {\n    const {element, config} = instance;\n\n    element.className = `calendar-container ${element.className}`.trim();\n    element.innerHTML = '';\n\n    // Create header\n    const header = document.createElement('div');\n    header.className = 'calendar-header';\n    element.appendChild(header);\n\n    // Create navigation\n    this.createNavigation(instance, header);\n\n    // Create view switcher\n    if (config.allowViewChange) {\n      this.createViewSwitcher(instance, header);\n    }\n\n    // Create main content area\n    const content = document.createElement('div');\n    content.className = 'calendar-content';\n    element.appendChild(content);\n\n    instance.headerElement = header;\n    instance.contentElement = content;\n  },\n\n  createNavigation(instance, container) {\n    const nav = document.createElement('div');\n    nav.className = 'calendar-nav';\n\n    // Previous button\n    const prevBtn = document.createElement('button');\n    prevBtn.className = 'nav-btn prev';\n    prevBtn.innerHTML = '‹';\n    prevBtn.title = 'Previous';\n    prevBtn.addEventListener('click', () => this.navigate(instance, -1));\n\n    // Current date/period display\n    const current = document.createElement('div');\n    current.className = 'current-period';\n    instance.currentPeriodElement = current;\n\n    // Next button\n    const nextBtn = document.createElement('button');\n    nextBtn.className = 'nav-btn next';\n    nextBtn.innerHTML = '›';\n    nextBtn.title = 'Next';\n    nextBtn.addEventListener('click', () => this.navigate(instance, 1));\n\n    // Today button\n    const todayBtn = document.createElement('button');\n    todayBtn.className = 'nav-btn today';\n    todayBtn.textContent = 'Today';\n    todayBtn.addEventListener('click', () => this.goToToday(instance));\n\n    nav.appendChild(prevBtn);\n    nav.appendChild(current);\n    nav.appendChild(nextBtn);\n    if (instance.config.showToday) {\n      nav.appendChild(todayBtn);\n    }\n\n    container.appendChild(nav);\n  },\n\n  createViewSwitcher(instance, container) {\n    const switcher = document.createElement('div');\n    switcher.className = 'view-switcher';\n\n    const views = [\n      {key: 'day', label: 'Day', icon: '📅'},\n      {key: 'week', label: 'Week', icon: '📊'},\n      {key: 'month', label: 'Month', icon: '🗓️'},\n      {key: 'timeline', label: 'Timeline', icon: '📈'}\n    ];\n\n    views.forEach(view => {\n      const btn = document.createElement('button');\n      btn.className = `view-btn ${view.key}`;\n      btn.innerHTML = `${view.icon} ${view.label}`;\n      btn.addEventListener('click', () => this.changeView(instance, view.key));\n      switcher.appendChild(btn);\n    });\n\n    container.appendChild(switcher);\n    instance.viewSwitcherElement = switcher;\n  },\n\n  render(instance) {\n    if (instance.isRendering) return;\n    instance.isRendering = true;\n\n    try {\n      this.updateCurrentPeriod(instance);\n      this.updateViewSwitcher(instance);\n\n      switch (instance.currentView) {\n        case 'day':\n          this.renderDayView(instance);\n          break;\n        case 'week':\n          this.renderWeekView(instance);\n          break;\n        case 'month':\n          this.renderMonthView(instance);\n          break;\n        case 'timeline':\n          this.renderTimelineView(instance);\n          break;\n      }\n\n      this.renderEvents(instance);\n    } finally {\n      instance.isRendering = false;\n    }\n  },\n\n  renderMonthView(instance) {\n    const {contentElement, currentDate, config} = instance;\n    contentElement.innerHTML = '';\n    contentElement.className = 'calendar-content month-view';\n\n    const table = document.createElement('table');\n    table.className = 'month-table';\n\n    // Create header row with day names\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n\n    const dayNames = this.getDayNames(config);\n    for (let i = 0; i < 7; i++) {\n      const dayIndex = (config.firstDayOfWeek + i) % 7;\n      const th = document.createElement('th');\n      th.textContent = dayNames[dayIndex];\n      th.className = config.weekends.includes(dayIndex) ? 'weekend' : '';\n      headerRow.appendChild(th);\n    }\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    // Create calendar grid\n    const tbody = document.createElement('tbody');\n    const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n    const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n\n    // Calculate start date (might be from previous month)\n    const startDate = new Date(startOfMonth);\n    const dayOfWeek = (startOfMonth.getDay() - config.firstDayOfWeek + 7) % 7;\n    startDate.setDate(startDate.getDate() - dayOfWeek);\n\n    // Create 6 weeks\n    for (let week = 0; week < 6; week++) {\n      const row = document.createElement('tr');\n\n      for (let day = 0; day < 7; day++) {\n        const cellDate = new Date(startDate);\n        cellDate.setDate(startDate.getDate() + (week * 7) + day);\n\n        const cell = document.createElement('td');\n        cell.className = this.getCellClasses(cellDate, currentDate, config);\n        cell.setAttribute('data-date', this.formatDate(cellDate, 'YYYY-MM-DD'));\n\n        const dayNumber = document.createElement('div');\n        dayNumber.className = 'day-number';\n        dayNumber.textContent = cellDate.getDate();\n\n        const eventsContainer = document.createElement('div');\n        eventsContainer.className = 'day-events';\n\n        cell.appendChild(dayNumber);\n        cell.appendChild(eventsContainer);\n\n        // Add click handler\n        cell.addEventListener('click', (e) => {\n          this.handleDateClick(instance, cellDate, e);\n        });\n\n        row.appendChild(cell);\n      }\n\n      tbody.appendChild(row);\n    }\n\n    table.appendChild(tbody);\n    contentElement.appendChild(table);\n  },\n\n  renderWeekView(instance) {\n    const {contentElement, currentDate, config} = instance;\n    contentElement.innerHTML = '';\n    contentElement.className = 'calendar-content week-view';\n\n    const weekStart = this.getWeekStart(currentDate, config.firstDayOfWeek);\n\n    // Create week header\n    const weekHeader = document.createElement('div');\n    weekHeader.className = 'week-header';\n\n    for (let i = 0; i < 7; i++) {\n      const date = new Date(weekStart);\n      date.setDate(weekStart.getDate() + i);\n\n      const dayCol = document.createElement('div');\n      dayCol.className = `day-column ${this.getCellClasses(date, currentDate, config)}`;\n      dayCol.setAttribute('data-date', this.formatDate(date, 'YYYY-MM-DD'));\n\n      const dayName = document.createElement('div');\n      dayName.className = 'day-name';\n      dayName.textContent = this.getDayNames(config)[date.getDay()];\n\n      const dayNumber = document.createElement('div');\n      dayNumber.className = 'day-number';\n      dayNumber.textContent = date.getDate();\n\n      dayCol.appendChild(dayName);\n      dayCol.appendChild(dayNumber);\n\n      // Add click handler\n      dayCol.addEventListener('click', (e) => {\n        this.handleDateClick(instance, date, e);\n      });\n\n      weekHeader.appendChild(dayCol);\n    }\n\n    contentElement.appendChild(weekHeader);\n\n    // Create time slots\n    const timeGrid = document.createElement('div');\n    timeGrid.className = 'time-grid';\n\n    for (let hour = 0; hour < 24; hour++) {\n      const timeSlot = document.createElement('div');\n      timeSlot.className = 'time-slot';\n      timeSlot.setAttribute('data-hour', hour);\n\n      const timeLabel = document.createElement('div');\n      timeLabel.className = 'time-label';\n      timeLabel.textContent = `${hour.toString().padStart(2, '0')}:00`;\n\n      const daySlots = document.createElement('div');\n      daySlots.className = 'day-slots';\n\n      for (let i = 0; i < 7; i++) {\n        const daySlot = document.createElement('div');\n        daySlot.className = 'day-slot';\n        daySlots.appendChild(daySlot);\n      }\n\n      timeSlot.appendChild(timeLabel);\n      timeSlot.appendChild(daySlots);\n      timeGrid.appendChild(timeSlot);\n    }\n\n    contentElement.appendChild(timeGrid);\n  },\n\n  renderDayView(instance) {\n    const {contentElement, currentDate, config} = instance;\n    contentElement.innerHTML = '';\n    contentElement.className = 'calendar-content day-view';\n\n    // Create day header\n    const dayHeader = document.createElement('div');\n    dayHeader.className = 'day-header';\n\n    const dayName = document.createElement('h2');\n    dayName.textContent = this.formatDate(currentDate, 'EEEE, MMMM d, yyyy', config.locale);\n    dayHeader.appendChild(dayName);\n\n    contentElement.appendChild(dayHeader);\n\n    // Create hourly time slots\n    const timeGrid = document.createElement('div');\n    timeGrid.className = 'day-time-grid';\n\n    for (let hour = 0; hour < 24; hour++) {\n      const timeSlot = document.createElement('div');\n      timeSlot.className = 'hour-slot';\n      timeSlot.setAttribute('data-hour', hour);\n\n      const timeLabel = document.createElement('div');\n      timeLabel.className = 'time-label';\n      timeLabel.textContent = `${hour.toString().padStart(2, '0')}:00`;\n\n      const eventArea = document.createElement('div');\n      eventArea.className = 'event-area';\n\n      timeSlot.appendChild(timeLabel);\n      timeSlot.appendChild(eventArea);\n      timeGrid.appendChild(timeSlot);\n    }\n\n    contentElement.appendChild(timeGrid);\n  },\n\n  renderTimelineView(instance) {\n    const {contentElement, currentDate, config} = instance;\n    contentElement.innerHTML = '';\n    contentElement.className = 'calendar-content timeline-view';\n\n    // Create timeline container\n    const timeline = document.createElement('div');\n    timeline.className = 'timeline-container';\n\n    // Calculate date range (show 30 days)\n    const startDate = new Date(currentDate);\n    startDate.setDate(currentDate.getDate() - 15);\n\n    const endDate = new Date(currentDate);\n    endDate.setDate(currentDate.getDate() + 15);\n\n    // Create continuous timeline bar\n    const timelineBar = document.createElement('div');\n    timelineBar.className = 'timeline-bar';\n\n    const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));\n\n    for (let i = 0; i < totalDays; i++) {\n      const date = new Date(startDate);\n      date.setDate(startDate.getDate() + i);\n\n      const daySegment = document.createElement('div');\n      daySegment.className = `timeline-day ${this.getCellClasses(date, currentDate, config)}`;\n      daySegment.setAttribute('data-date', this.formatDate(date, 'YYYY-MM-DD'));\n      daySegment.style.width = `${100 / totalDays}%`;\n\n      const dayLabel = document.createElement('div');\n      dayLabel.className = 'day-label';\n      dayLabel.innerHTML = `\n        <div class=\"day-number\">${date.getDate()}</div>\n        <div class=\"day-name\">${this.getDayNames(config)[date.getDay()].substr(0, 3)}</div>\n      `;\n\n      const eventTrack = document.createElement('div');\n      eventTrack.className = 'event-track';\n\n      daySegment.appendChild(dayLabel);\n      daySegment.appendChild(eventTrack);\n\n      // Add click handler\n      daySegment.addEventListener('click', (e) => {\n        this.handleDateClick(instance, date, e);\n      });\n\n      timelineBar.appendChild(daySegment);\n    }\n\n    timeline.appendChild(timelineBar);\n    contentElement.appendChild(timeline);\n\n    // Add scroll to center current date\n    setTimeout(() => {\n      const currentDayElement = timelineBar.querySelector('.current-day');\n      if (currentDayElement) {\n        currentDayElement.scrollIntoView({behavior: 'smooth', block: 'center', inline: 'center'});\n      }\n    }, 100);\n  },\n\n  renderEvents(instance) {\n    const {events, currentView, contentElement} = instance;\n\n    events.forEach(event => {\n      this.renderEvent(instance, event);\n    });\n  },\n\n  renderEvent(instance, event) {\n    const {currentView, contentElement} = instance;\n    const eventDate = new Date(event.date);\n    const dateStr = this.formatDate(eventDate, 'YYYY-MM-DD');\n\n    let targetElement;\n\n    switch (currentView) {\n      case 'month':\n        targetElement = contentElement.querySelector(`[data-date=\"${dateStr}\"] .day-events`);\n        if (targetElement) {\n          const eventEl = this.createEventElement(event, 'month');\n          targetElement.appendChild(eventEl);\n        }\n        break;\n\n      case 'week':\n      case 'day':\n        // Find appropriate time slot\n        const hour = eventDate.getHours();\n        targetElement = contentElement.querySelector(`[data-hour=\"${hour}\"] .event-area`);\n        if (targetElement) {\n          const eventEl = this.createEventElement(event, currentView);\n          targetElement.appendChild(eventEl);\n        }\n        break;\n\n      case 'timeline':\n        targetElement = contentElement.querySelector(`[data-date=\"${dateStr}\"] .event-track`);\n        if (targetElement) {\n          const eventEl = this.createEventElement(event, 'timeline');\n          targetElement.appendChild(eventEl);\n        }\n        break;\n    }\n  },\n\n  createEventElement(event, viewType) {\n    const eventEl = document.createElement('div');\n    eventEl.className = `calendar-event ${event.type || ''} ${viewType}-event`;\n\n    if (event.color) {\n      eventEl.style.backgroundColor = event.color;\n      eventEl.style.borderColor = event.color;\n    }\n\n    const title = document.createElement('div');\n    title.className = 'event-title';\n    title.textContent = event.title;\n\n    if (viewType !== 'timeline') {\n      const time = document.createElement('div');\n      time.className = 'event-time';\n      if (event.time) {\n        time.textContent = event.time;\n      }\n      eventEl.appendChild(time);\n    }\n\n    eventEl.appendChild(title);\n\n    // Add click handler\n    eventEl.addEventListener('click', (e) => {\n      e.stopPropagation();\n      this.handleEventClick(event, e);\n    });\n\n    return eventEl;\n  },\n\n  // Navigation methods\n  navigate(instance, direction) {\n    const {currentView, currentDate} = instance;\n\n    switch (currentView) {\n      case 'day':\n        currentDate.setDate(currentDate.getDate() + direction);\n        break;\n      case 'week':\n        currentDate.setDate(currentDate.getDate() + (direction * 7));\n        break;\n      case 'month':\n        currentDate.setMonth(currentDate.getMonth() + direction);\n        break;\n      case 'timeline':\n        currentDate.setDate(currentDate.getDate() + (direction * 15));\n        break;\n    }\n\n    this.render(instance);\n    this.emitEvent('calendar:dateChange', {instance, date: new Date(currentDate)});\n  },\n\n  goToToday(instance) {\n    instance.currentDate = new Date();\n    this.render(instance);\n    this.emitEvent('calendar:dateChange', {instance, date: new Date(instance.currentDate)});\n  },\n\n  changeView(instance, view) {\n    instance.currentView = view;\n    this.render(instance);\n    this.emitEvent('calendar:viewChange', {instance, view});\n  },\n\n  // Utility methods\n  getCellClasses(date, currentDate, config) {\n    const classes = [];\n    const today = new Date();\n\n    if (this.isSameDay(date, today)) {\n      classes.push('today');\n    }\n\n    if (this.isSameDay(date, currentDate)) {\n      classes.push('current-day');\n    }\n\n    if (date.getMonth() !== currentDate.getMonth()) {\n      classes.push('other-month');\n    }\n\n    if (config.weekends.includes(date.getDay())) {\n      classes.push('weekend');\n    }\n\n    return classes.join(' ');\n  },\n\n  getDayNames(config) {\n    const locale = this.getLocale(config);\n    // Use Utils.date if available\n    if (window.Utils?.date?.getDayNames) {\n      return Utils.date.getDayNames(locale);\n    }\n    // Fallback to browser\n    const names = [];\n    const date = new Date(2024, 0, 7); // Start with Sunday\n    for (let i = 0; i < 7; i++) {\n      names.push(date.toLocaleDateString(locale, {weekday: 'short'}));\n      date.setDate(date.getDate() + 1);\n    }\n    return names;\n  },\n\n  getWeekStart(date, firstDayOfWeek) {\n    const start = new Date(date);\n    const day = start.getDay();\n    const diff = (day - firstDayOfWeek + 7) % 7;\n    start.setDate(start.getDate() - diff);\n    return start;\n  },\n\n  isSameDay(date1, date2) {\n    return date1.getFullYear() === date2.getFullYear() &&\n      date1.getMonth() === date2.getMonth() &&\n      date1.getDate() === date2.getDate();\n  },\n\n  /**\n   * Get current locale - auto-detects from I18nManager if set to 'auto'\n   */\n  getLocale(config) {\n    if (config.locale && config.locale !== 'auto') {\n      return config.locale;\n    }\n    // Auto-detect from I18nManager\n    const i18n = window.Now?.getManager?.('i18n') || window.I18nManager;\n    if (i18n?.getCurrentLocale) {\n      return i18n.getCurrentLocale();\n    }\n    // Fallback to browser language\n    const browserLang = navigator.language || navigator.userLanguage || 'en';\n    return browserLang.split('-')[0];\n  },\n\n  /**\n   * Format date using Utils.date.format with locale support\n   * @param {Date} date - Date to format\n   * @param {string} format - Format pattern (Utils.date tokens)\n   * @param {string} locale - Locale override (optional)\n   */\n  formatDate(date, format = 'YYYY-MM-DD', locale = null) {\n    // Use Utils.date.format if available\n    if (window.Utils?.date?.format) {\n      return Utils.date.format(date, format, locale);\n    }\n    // Fallback for ISO format\n    if (format === 'YYYY-MM-DD') {\n      const y = date.getFullYear();\n      const m = String(date.getMonth() + 1).padStart(2, '0');\n      const d = String(date.getDate()).padStart(2, '0');\n      return `${y}-${m}-${d}`;\n    }\n    // Fallback to browser formatting\n    return date.toLocaleDateString(locale || 'en', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  },\n\n  updateCurrentPeriod(instance) {\n    const {currentDate, currentView, config} = instance;\n    const locale = this.getLocale(config);\n    const formats = config.dateFormats || this.config.dateFormats;\n    let text = '';\n\n    switch (currentView) {\n      case 'day':\n        text = this.formatDate(currentDate, formats.day || 'D MMMM YYYY', locale);\n        break;\n      case 'week':\n        const weekStart = this.getWeekStart(currentDate, config.firstDayOfWeek);\n        const weekEnd = new Date(weekStart);\n        weekEnd.setDate(weekStart.getDate() + 6);\n        // Format: \"1 - 7 มกราคม 2569\" or \"1 - 7 January 2026\"\n        text = `${weekStart.getDate()} - ${weekEnd.getDate()} ${this.formatDate(weekEnd, 'MMMM YYYY', locale)}`;\n        break;\n      case 'month':\n        text = this.formatDate(currentDate, formats.month || 'MMMM YYYY', locale);\n        break;\n      case 'timeline':\n        text = `Timeline - ${this.formatDate(currentDate, formats.month || 'MMMM YYYY', locale)}`;\n        break;\n    }\n\n    if (instance.currentPeriodElement) {\n      instance.currentPeriodElement.textContent = text;\n    }\n  },\n\n  updateViewSwitcher(instance) {\n    if (!instance.viewSwitcherElement) return;\n\n    const buttons = instance.viewSwitcherElement.querySelectorAll('.view-btn');\n    buttons.forEach(btn => {\n      btn.classList.toggle('active', btn.classList.contains(instance.currentView));\n    });\n  },\n\n  // Event handlers\n  handleDateClick(instance, date, event) {\n    if (instance.config.callbacks.onDateClick) {\n      instance.config.callbacks.onDateClick.call(instance.element, date, event);\n    }\n\n    this.emitEvent('calendar:dateClick', {instance, date, event});\n  },\n\n  handleEventClick(eventData, event) {\n    if (this.config.callbacks.onEventClick) {\n      this.config.callbacks.onEventClick.call(null, eventData, event);\n    }\n\n    this.emitEvent('calendar:eventClick', {event: eventData, domEvent: event});\n  },\n\n  // Public API\n  addEvent(elementOrInstance, event) {\n    const instance = typeof elementOrInstance === 'string' ?\n      this.getInstance(elementOrInstance) : elementOrInstance;\n\n    if (instance) {\n      instance.events.push(event);\n      this.render(instance);\n    }\n  },\n\n  removeEvent(elementOrInstance, eventId) {\n    const instance = typeof elementOrInstance === 'string' ?\n      this.getInstance(elementOrInstance) : elementOrInstance;\n\n    if (instance) {\n      instance.events = instance.events.filter(e => e.id !== eventId);\n      this.render(instance);\n    }\n  },\n\n  getInstance(element) {\n    if (typeof element === 'string') {\n      element = document.getElementById(element);\n    }\n    return element ? this.state.calendars.get(element) : null;\n  },\n\n  emitEvent(eventName, data) {\n    EventManager.emit(eventName, data);\n  },\n\n  destroy(instance) {\n    if (typeof instance === 'string') {\n      instance = this.getInstance(instance);\n    }\n\n    if (!instance) return;\n\n    const {element} = instance;\n    element.innerHTML = '';\n    element.className = element.className.replace('calendar-container', '').trim();\n\n    delete element.calendarInstance;\n    this.state.calendars.delete(element);\n  }\n};\n\n// Register with Now framework if available\nif (window.Now?.registerManager) {\n  Now.registerManager('calendar', CalendarManager);\n}\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    CalendarManager.init();\n  });\n} else {\n  CalendarManager.init();\n}\n\n// Expose for backward compatibility\nif (!window.Calendar) {\n  window.Calendar = CalendarManager;\n}\n","/**\n * FilterManager\n * Manages filtering and sorting of template-rendered items\n *\n * Features:\n * - Generic filtering by any attribute\n * - Multi-criteria filtering\n * - Sorting by field (string, number, date)\n * - Animated transitions\n * - Works with TemplateManager\n *\n * @requires AnimationManager\n */\nconst FilterManager = {\n  config: {\n    defaultAnimation: 'fade',\n    defaultDuration: 300,\n    defaultFilterAttr: 'data-category',\n    debounceDelay: 150,\n    debug: true // Enable debug by default\n  },\n\n  state: {\n    activeFilters: new Map(), // scope => {attr: value}\n    activeSorts: new Map(),   // scope => {by, order, type}\n    debounceTimers: new Map(),\n    initialized: false\n  },\n\n  /**\n   * Initialize FilterManager\n   */\n  init() {\n    if (this.state.initialized) return;\n\n    this.bindFilterControls();\n    this.bindSortControls();\n\n    // Listen for template render completion from EventManager\n    if (window.EventManager) {\n      EventManager.on('template:render', (data) => {\n        setTimeout(() => {\n          this.refreshFilters();\n        }, 100);\n      });\n    }\n\n    this.state.initialized = true;\n  },\n\n  /**\n   * Refresh all active filters after template render\n   */\n  refreshFilters() {\n    this.state.activeFilters.forEach((filter, scope) => {\n      const container = document.querySelector(scope);\n      if (container) {\n        const controlContainer = document.querySelector(`[data-filter-scope=\"${scope}\"]`);\n        if (controlContainer) {\n          const options = this.getFilterOptions(controlContainer);\n          this.performFilter(container, filter.value, options);\n        }\n      }\n    });\n  },  /**\n   * Bind filter control elements\n   */\n  bindFilterControls() {\n    document.addEventListener('click', (e) => {\n      // Support both data-on and data-filter-value\n      const trigger = e.target.closest('[data-filter-value]');\n      if (!trigger) return;\n\n      e.preventDefault();\n      this.handleFilterClick(trigger);\n    });\n  },\n\n  /**\n   * Bind sort control elements\n   */\n  bindSortControls() {\n    document.addEventListener('click', (e) => {\n      // Support both data-on and data-sort-by\n      const trigger = e.target.closest('[data-sort-by]');\n      if (!trigger) return;\n\n      e.preventDefault();\n      this.handleSortClick(trigger);\n    });\n  },\n\n  /**\n   * Handle filter button click\n   */\n  handleFilterClick(trigger) {\n    const value = trigger.dataset.filterValue;\n    if (!value) return;\n\n    // Find control container\n    const controlContainer = trigger.closest('[data-filter-scope]');\n    if (!controlContainer) return;\n\n\n    const options = this.getFilterOptions(controlContainer);\n    const scope = controlContainer.dataset.filterScope;\n\n    // Check if target container exists\n    const targetContainer = document.querySelector(scope);\n    if (!targetContainer) return;\n\n    // Update active button state\n    this.updateActiveButton(controlContainer, trigger);\n\n    // Apply filter\n    this.filter(value, scope, options);\n  },\n\n  /**\n   * Handle sort button click\n   */\n  handleSortClick(trigger) {\n    const sortBy = trigger.dataset.sortBy;\n    const sortOrder = trigger.dataset.sortOrder || 'asc';\n    const sortType = trigger.dataset.sortType || 'string';\n\n    if (!sortBy) return;\n\n    // Find control container\n    const controlContainer = trigger.closest('[data-sort-scope]');\n    if (!controlContainer) return;\n\n    const scope = controlContainer.dataset.sortScope;\n\n    // Toggle sort order if clicking same button\n    const lastSort = this.state.activeSorts.get(scope);\n    const newOrder = (lastSort?.by === sortBy && lastSort?.order === 'asc') ? 'desc' : sortOrder;\n\n    // Update active button state\n    this.updateActiveButton(controlContainer, trigger);\n\n    // Apply sort\n    this.sort({\n      scope,\n      by: sortBy,\n      order: newOrder,\n      type: sortType\n    });\n  },\n\n  /**\n   * Get filter options from control container\n   */\n  getFilterOptions(container) {\n    return {\n      attr: container.dataset.filterAttr || this.config.defaultFilterAttr,\n      animation: container.dataset.filterAnimation || this.config.defaultAnimation,\n      duration: parseInt(container.dataset.filterDuration) || this.config.defaultDuration\n    };\n  },\n\n  /**\n   * Update active button state\n   */\n  updateActiveButton(container, activeButton) {\n    // Remove active class from siblings\n    const buttons = container.querySelectorAll('[data-filter-value], [data-sort-by]');\n    buttons.forEach(btn => btn.classList.remove('active'));\n\n    // Add active class to clicked button\n    activeButton.classList.add('active');\n  },\n\n  /**\n   * Apply filter to items\n   */\n  filter(value, scope, options) {\n    const container = document.querySelector(scope);\n    if (!container) return;\n\n    // Store active filter\n    this.state.activeFilters.set(scope, {\n      value,\n      attr: options.attr\n    });\n\n    // Debounce filter operation\n    this.debounce(`filter-${scope}`, () => {\n      this.performFilter(container, value, options);\n    }, this.config.debounceDelay);\n  },\n\n  /**\n   * Perform filter operation\n   */\n  async performFilter(container, value, options) {\n    // Find all items with the filter attribute (support nested structure)\n    const items = Array.from(container.querySelectorAll(`[${options.attr}]`)).filter(el =>\n      !el.matches('template, script, style')\n    );\n\n    if (items.length === 0) return;\n\n    const showAll = value === '*' || value === 'all';\n\n    for (const item of items) {\n      const itemValue = item.getAttribute(options.attr);\n      const shouldShow = showAll || itemValue === value;\n\n      // Check if item is currently hidden (style.display === 'none' or has 'hidden' class)\n      const isHidden = item.style.display === 'none' || item.classList.contains('hidden');\n\n      if (shouldShow && isHidden) {\n        // Show item\n        await this.animateItem(item, 'show', options.animation, options.duration);\n      } else if (!shouldShow && !isHidden) {\n        // Hide item now\n        this.animateItem(item, 'hide', options.animation, options.duration);\n      }\n    }\n  },\n\n  /**\n   * Apply sort to items\n   */\n  sort(options) {\n    const container = document.querySelector(options.scope);\n    if (!container) return;\n\n    // Store active sort\n    this.state.activeSorts.set(options.scope, {\n      by: options.by,\n      order: options.order,\n      type: options.type\n    });\n\n    // Debounce sort operation\n    this.debounce(`sort-${options.scope}`, () => {\n      this.performSort(container, options);\n    }, this.config.debounceDelay);\n  },\n\n  /**\n   * Perform sort operation\n   */\n  performSort(container, options) {\n    // Find all items with sortable attributes (support nested structure)\n    const items = Array.from(container.querySelectorAll(`[data-${options.by}]`)).filter(el =>\n      !el.matches('template, script, style')\n    );\n\n    if (items.length === 0) return;\n\n    // Sort items\n    items.sort((a, b) => {\n      const aValue = this.getSortValue(a, options.by, options.type);\n      const bValue = this.getSortValue(b, options.by, options.type);\n\n      return this.compare(aValue, bValue, options.type, options.order);\n    });\n\n    // Reorder DOM\n    const parent = items[0].parentElement;\n    items.forEach(item => parent.appendChild(item));\n  },\n\n  /**\n   * Get sort value from element\n   */\n  getSortValue(element, field, type) {\n    // Try dataset first\n    let value = element.dataset[field];\n\n    // Try attribute\n    if (!value) {\n      value = element.getAttribute(`data-${field}`);\n    }\n\n    // Try text content of child element\n    if (!value) {\n      const childEl = element.querySelector(`[data-${field}]`);\n      if (childEl) {\n        value = childEl.textContent.trim();\n      }\n    }\n\n    // Convert based on type\n    switch (type) {\n      case 'number':\n        return parseFloat(value) || 0;\n      case 'date':\n        return new Date(value).getTime() || 0;\n      default:\n        return String(value || '').toLowerCase();\n    }\n  },\n\n  /**\n   * Compare two values\n   */\n  compare(a, b, type, order) {\n    let result = 0;\n\n    switch (type) {\n      case 'number':\n      case 'date':\n        result = a - b;\n        break;\n      default:\n        result = a.localeCompare(b);\n    }\n\n    return order === 'desc' ? -result : result;\n  },\n\n  /**\n   * Animate item show/hide\n   */\n  async animateItem(item, action, animation, duration) {\n    const isShow = action === 'show';\n\n    // No animation - instant show/hide\n    if (animation === 'none' || duration === 0) {\n      item.style.display = isShow ? '' : 'none';\n      return;\n    }\n\n    switch (animation) {\n      case 'fade':\n        if (isShow) {\n          item.style.display = '';\n          item.style.opacity = '0';\n          item.style.transition = `opacity ${duration}ms`;\n          await this.nextFrame();\n          item.style.opacity = '1';\n          await this.wait(duration);\n          item.style.transition = '';\n          item.style.opacity = ''; // Reset to default\n        } else {\n          item.style.transition = `opacity ${duration}ms`;\n          item.style.opacity = '0';\n          await this.wait(duration);\n          item.style.display = 'none';\n          item.style.transition = '';\n        }\n        break;\n\n      case 'slide':\n        if (isShow) {\n          item.style.display = '';\n          item.style.maxHeight = '0';\n          item.style.overflow = 'hidden';\n          item.style.transition = `max-height ${duration}ms`;\n          await this.nextFrame();\n          item.style.maxHeight = item.scrollHeight + 'px';\n          await this.wait(duration);\n          item.style.maxHeight = '';\n          item.style.overflow = '';\n          item.style.transition = '';\n        } else {\n          item.style.maxHeight = item.scrollHeight + 'px';\n          item.style.overflow = 'hidden';\n          item.style.transition = `max-height ${duration}ms`;\n          await this.nextFrame();\n          item.style.maxHeight = '0';\n          await this.wait(duration);\n          item.style.display = 'none';\n          item.style.maxHeight = '';\n          item.style.overflow = '';\n          item.style.transition = '';\n        }\n        break;\n\n      case 'scale':\n        if (isShow) {\n          item.style.display = '';\n          item.style.transform = 'scale(0)';\n          item.style.opacity = '0';\n          item.style.transition = `transform ${duration}ms, opacity ${duration}ms`;\n          await this.nextFrame();\n          item.style.transform = 'scale(1)';\n          item.style.opacity = '1';\n          await this.wait(duration);\n          item.style.transform = '';\n          item.style.opacity = '';\n          item.style.transition = '';\n        } else {\n          item.style.transition = `transform ${duration}ms, opacity ${duration}ms`;\n          item.style.transform = 'scale(0)';\n          item.style.opacity = '0';\n          await this.wait(duration);\n          item.style.display = 'none';\n          item.style.transform = '';\n          item.style.opacity = '';\n          item.style.transition = '';\n        }\n        break;\n\n      default:\n        // No animation\n        item.style.display = isShow ? '' : 'none';\n    }\n  },\n\n  /**\n   * Debounce function execution\n   */\n  debounce(key, fn, delay) {\n    if (this.state.debounceTimers.has(key)) {\n      clearTimeout(this.state.debounceTimers.get(key));\n    }\n\n    const timer = setTimeout(() => {\n      fn();\n      this.state.debounceTimers.delete(key);\n    }, delay);\n\n    this.state.debounceTimers.set(key, timer);\n  },\n\n  /**\n   * Wait for next animation frame\n   */\n  nextFrame() {\n    return new Promise(resolve => requestAnimationFrame(resolve));\n  },\n\n  /**\n   * Wait for specified duration\n   */\n  wait(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  },\n\n  /**\n   * Get filtered items\n   */\n  getFilteredItems(scope) {\n    const container = document.querySelector(scope);\n    if (!container) return [];\n\n    // Get the filter attribute from active filter\n    const activeFilter = this.state.activeFilters.get(scope);\n    const attr = activeFilter?.attr || this.config.defaultFilterAttr;\n\n    // Find all items with the filter attribute\n    return Array.from(container.querySelectorAll(`[${attr}]`)).filter(el =>\n      !el.matches('template, script, style') &&\n      el.style.display !== 'none'\n    );\n  },\n\n  /**\n   * Clear all filters in scope\n   */\n  clearFilters(scope) {\n    const container = document.querySelector(scope);\n    if (!container) return;\n\n    // Get the filter attribute\n    const activeFilter = this.state.activeFilters.get(scope);\n    const attr = activeFilter?.attr || this.config.defaultFilterAttr;\n\n    // Find and show all items\n    const items = Array.from(container.querySelectorAll(`[${attr}]`));\n    items.forEach(item => {\n      item.style.display = '';\n    });\n\n    this.state.activeFilters.delete(scope);\n  },\n\n  /**\n   * Clear all sorts in scope\n   */\n  clearSorts(scope) {\n    this.state.activeSorts.delete(scope);\n  },\n\n  /**\n   * Get active filter\n   */\n  getActiveFilter(scope) {\n    return this.state.activeFilters.get(scope);\n  },\n\n  /**\n   * Get active sort\n   */\n  getActiveSort(scope) {\n    return this.state.activeSorts.get(scope);\n  },\n\n  /**\n   * Destroy manager\n   */\n  destroy() {\n    // Clear all timers\n    this.state.debounceTimers.forEach(timer => clearTimeout(timer));\n    this.state.debounceTimers.clear();\n\n    // Clear state\n    this.state.activeFilters.clear();\n    this.state.activeSorts.clear();\n    this.state.initialized = false;\n  }\n};\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => FilterManager.init());\n} else {\n  FilterManager.init();\n}\n\n// Expose globally\nwindow.FilterManager = FilterManager;\n","const MenuManager = {\n  config: {\n    breakpoint: 768,\n    animationDuration: 100,\n    touchThreshold: 100,\n\n    accessibility: {\n      enabled: true,\n      announceChanges: true,\n      smoothFocus: true,\n      focusableSelectors: 'a[href], button:not([disabled]), [tabindex]:not([tabindex=\"-1\"])',\n      focusFirstItemOnOpen: true,\n      returnFocusOnClose: true,\n      horizontalNavigation: {\n        arrowKeysOpenSubmenu: true,\n        arrowKeysNavigateSiblings: true\n      }\n    },\n\n    performance: {\n      useRequestAnimationFrame: true,\n      touchOptimization: true,\n    },\n\n    observerOptions: {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['class', 'style']\n    },\n\n    hover: {\n      openDelay: 100,\n      closeDelay: 300\n    }\n  },\n\n  state: {\n    initialized: false,\n    menus: new Map(),\n    handlers: new Map(),\n    observer: null,\n    announcer: null\n  },\n\n  async init(options = {}) {\n    try {\n      if (this.state.initialized) return this;\n\n      this.config = Now.mergeConfig(this.config, options);\n\n      this.state = {\n        initialized: false,\n        menus: new Map(),\n        handlers: new Map(),\n        observer: null,\n        announcer: null\n      };\n\n      this.initializeExistingMenus();\n      this.setupMutationObserver();\n      this.setupToggleListeners();\n      this.setupApiDataListener();\n      this.setupI18nListeners();\n\n      EventManager.on('route:changed', () => {\n        try {\n          this.updateActiveMenu();\n          this.setupAutoExpand();\n\n          // Close all submenus and mobile menus on route change\n          this.state.menus.forEach(menu => {\n            // Close all submenus first (clears sidemenu-sub-expanded)\n            this.closeAllSubmenus(menu);\n\n            // Close mobile menus\n            if (menu.isMobile && this.isMenuOpen(menu)) {\n              this.closeMenu(menu);\n            }\n          });\n        } catch (error) {\n          ErrorManager.handle('Route change handler failed', {\n            context: 'MenuManager.routeHandler',\n            data: {error}\n          })\n        }\n      });\n\n      this.state.initialized = true;\n      return this;\n    } catch (error) {\n      throw ErrorManager.handle('MenuManager initialization failed', {\n        context: 'MenuManager.init',\n        data: {error}\n      })\n    }\n  },\n\n  /**\n   * Setup i18n listeners for automatic translation updates\n   * Menus will automatically re-translate when:\n   * - Translations are loaded for the first time\n   * - User changes locale\n   */\n  setupI18nListeners() {\n    // Listen for locale changes\n    EventManager.on('locale:changed', () => {\n      this.updateAllMenuTranslations();\n    });\n  },\n\n  /**\n   * Update translations for all menu text elements\n   * This translates static text in toggle buttons and menu labels\n   */\n  updateAllMenuTranslations() {\n    this.state.menus.forEach(menu => {\n      // Update toggle button labels\n      if (menu.elements.toggleButtons) {\n        const isOpen = this.isMenuOpen(menu);\n        menu.elements.toggleButtons.forEach(toggle => {\n          const label = isOpen ? 'Close menu' : 'Open menu';\n          toggle.setAttribute('aria-label', I18nManager.translate(label));\n        });\n      }\n\n      // Update submenu labels\n      if (menu.elements.submenus) {\n        menu.elements.submenus.forEach(submenu => {\n          if (submenu.content) {\n            submenu.content.setAttribute('aria-label', I18nManager.translate('Submenu'));\n          }\n        });\n      }\n\n      // Update container label\n      if (menu.elements.container) {\n        menu.elements.container.setAttribute('aria-label', I18nManager.translate('Main navigation'));\n      }\n\n      // Translate menu item text with data-i18n attributes\n      if (menu.element) {\n        I18nManager.updateElements(menu.element);\n      }\n    });\n  },\n\n  /**\n   * Setup listener for API data to render menus with data-source attribute\n   * Menus with data-component=\"menu\" and data-source=\"path.to.menus\" will auto-render\n   */\n  setupApiDataListener() {\n    // Listen for api:loaded events from ApiComponent\n    document.addEventListener('api:loaded', (e) => {\n      // Use e.detail.element as fallback when event is dispatched directly on document\n      // (happens when API element is disconnected from DOM during SPA navigation)\n      const apiElement = e.target === document ? e.detail?.element : e.target;\n      const actualData = e.detail?.data;\n\n      if (!apiElement || !actualData) return;\n\n      // Wrap data as {data: actualData} for consistency with TemplateManager\n      // This allows using data.menus format which matches data-text=\"data.xxx\"\n      const data = {data: actualData};\n\n      // Use requestAnimationFrame to ensure DOM is ready\n      requestAnimationFrame(() => {\n        // Find menu elements with data-source inside this API container\n        const menuElements = apiElement.querySelectorAll('[data-component=\"menu\"][data-source]');\n\n        menuElements.forEach(menuEl => {\n          const sourcePath = menuEl.dataset.source;\n          if (!sourcePath) return;\n\n          // Get data from stored data using path (e.g., \"data.menus\")\n          const menuData = this.getValueByPath(data, sourcePath);\n\n          if (menuData && Array.isArray(menuData)) {\n            // Always re-render - destroy existing menu first if it exists\n            if (menuEl.dataset.menuId) {\n              this.destroyMenu(menuEl.dataset.menuId);\n              delete menuEl.dataset.menuId;\n            }\n            this.renderFromData(menuEl, menuData);\n          }\n        });\n      });\n    });\n  },\n\n  /**\n   * Get value from object by dot-notation path\n   * @param {Object} obj - Source object\n   * @param {string} path - Dot-notation path\n   * @returns {*} Value at path\n   */\n  getValueByPath(obj, path) {\n    if (!path || !obj) return undefined;\n    return path.split('.').reduce((o, p) => o?.[p], obj);\n  },\n\n  /**\n   * Check if a menu is open by reading DOM state (single source of truth)\n   * @param {Object} menu - Menu instance\n   * @returns {boolean}\n   */\n  isMenuOpen(menu) {\n    if (menu.element.classList.contains('sidemenu')) {\n      return document.body.classList.contains('sidemenu-close');\n    }\n    return document.body.classList.contains('topmenu-open');\n  },\n\n  /**\n   * Check if a submenu button is open by reading aria-expanded (single source of truth)\n   * @param {HTMLElement} button - Submenu toggle button\n   * @returns {boolean}\n   */\n  isSubmenuOpen(button) {\n    return button.getAttribute('aria-expanded') === 'true';\n  },\n\n  initializeExistingMenus() {\n    // Only initialize elements explicitly marked as menu components\n    document.querySelectorAll('[data-component=\"menu\"]').forEach(element => {\n      this.createMenu(element);\n    });\n    this.updateActiveMenu();\n    this.setupAutoExpand();\n  },\n\n  setupMutationObserver() {\n    // Observer only watches for menu components, not toggle buttons\n    this.observer = new MutationObserver((mutations) => {\n      let hasMenuComponent = false;\n\n      mutations.forEach((mutation) => {\n        // Handle removed nodes\n        mutation.removedNodes.forEach(node => {\n          if (node.nodeType === 1) {\n            // Check if the node itself is a menu\n            const menuId = node.dataset?.menuId;\n            if (menuId && this.state.menus.has(menuId)) {\n              setTimeout(() => {\n                if (!node.isConnected) {\n                  this.destroyMenu(menuId);\n                }\n              }, 0);\n            }\n\n            // Also check for menu elements nested inside the removed node\n            // Only search if there are menus to clean up\n            if (node.querySelectorAll && this.state.menus.size > 0) {\n              const nestedMenus = node.querySelectorAll('[data-menu-id]');\n              nestedMenus.forEach(menuEl => {\n                const nestedMenuId = menuEl.dataset?.menuId;\n                if (nestedMenuId && this.state.menus.has(nestedMenuId)) {\n                  setTimeout(() => {\n                    if (!menuEl.isConnected) {\n                      this.destroyMenu(nestedMenuId);\n                    }\n                  }, 0);\n                }\n              });\n            }\n          }\n        });\n\n        // Check for new menu components\n        mutation.addedNodes.forEach(node => {\n          if (node.nodeType !== 1) return;\n          if (!hasMenuComponent) {\n            if (node.matches?.('[data-component=\"menu\"]') ||\n              node.querySelector?.('[data-component=\"menu\"]')) {\n              hasMenuComponent = true;\n            }\n          }\n        });\n      });\n\n      if (hasMenuComponent) {\n        this.initializeExistingMenus();\n      }\n    });\n\n    this.observer.observe(document.body, this.config.observerOptions);\n  },\n\n  /**\n   * Setup event delegation for toggle buttons\n   * This handles all toggle buttons regardless of when they're added to DOM\n   */\n  setupToggleListeners() {\n    // Use event delegation - listen once at document level\n    document.addEventListener('click', (e) => {\n      const toggle = e.target.closest('.menu-toggle');\n      if (!toggle) return;\n\n      // Prevent default button behavior\n      e.stopPropagation();\n\n      // Determine which menu type this toggle controls\n      let menuLevel = null;\n      if (toggle.classList.contains('topmenu-toggle')) {\n        menuLevel = 'topmenu';\n      } else if (toggle.classList.contains('sidemenu-toggle')) {\n        menuLevel = 'sidemenu';\n      }\n\n      if (!menuLevel) return;\n\n      // Find and toggle the corresponding menu\n      this.state.menus.forEach(menu => {\n        if ((menuLevel === 'topmenu' && menu.element.classList.contains('topmenu')) ||\n          (menuLevel === 'sidemenu' && menu.element.classList.contains('sidemenu'))) {\n          // Skip if sidemenu submenu is expanded\n          if (\n            !document.body.classList.contains('mobile-menu') &&\n            menu.element.classList.contains('sidemenu') &&\n            document.body.classList.contains('sidemenu-sub-expanded')\n          ) {\n            return;\n          }\n          this.toggleMenu(menu);\n        }\n      });\n    });\n  },\n\n  updateActiveMenu(path) {\n    // If path not specified, check for menuPath in current route config, then fall back to pathname\n    const currentRoute = window.RouterManager?.state?.current;\n    let currentPath = path || currentRoute?.menuPath || window.location.pathname;\n    const currentHash = window.location.hash;\n\n    // Strip base path from current path if RouterManager is available\n    const basePath = window.RouterManager?.config?.base || '';\n    if (basePath && basePath !== '/' && currentPath.startsWith(basePath)) {\n      currentPath = currentPath.slice(basePath.length) || '/';\n    }\n\n    // Keep the original state for comparison\n    const previousActive = document.querySelectorAll('.sidemenu .active, .topmenu .active');\n    let activeChanged = false;\n\n    const utils = {\n      cleanUrl: (url) => {\n        let clean = url.split('?')[0].split('#')[0];\n        clean = clean.replace(/\\/+$/, '');\n        return clean;\n      },\n\n      comparePaths: (linkPath, currentPath) => {\n        const cleanLinkPath = utils.cleanUrl(linkPath);\n        const cleanCurrentPath = utils.cleanUrl(currentPath);\n        return cleanLinkPath === cleanCurrentPath;\n      },\n\n      setActiveState: (link, isActive = true) => {\n        const wasActive = link.classList.contains('active');\n\n        if (isActive) {\n          if (!wasActive) activeChanged = true;\n          link.classList.add('active');\n          link.setAttribute('aria-current', 'page');\n\n          //Open Parent Submenus\n          let parent = link.parentElement;\n          while (parent && parent !== document.body) {\n            if (parent.tagName === 'UL') {\n              // Expand the submenu\n              parent.setAttribute('aria-hidden', 'false');\n\n              // If this is a sidemenu submenu, add sidemenu-sub-expanded\n              const sidemenu = parent.closest('.sidemenu');\n              if (sidemenu && parent !== sidemenu.querySelector(':scope > ul')) {\n                document.body.classList.add('sidemenu-sub-expanded');\n              }\n\n              // If this is a topmenu submenu, add topmenu-sub-expanded\n              const topmenu = parent.closest('.topmenu');\n              if (topmenu && parent !== topmenu.querySelector(':scope > ul')) {\n                document.body.classList.add('topmenu-sub-expanded');\n              }\n\n              // If this is a submenu, find its toggle button\n              const toggle = parent.toggle || parent.parentElement?.querySelector(':scope > button[aria-haspopup=\"true\"]');\n              if (toggle) {\n                toggle.setAttribute('aria-expanded', 'true');\n              }\n            }\n            parent = parent.parentElement;\n          }\n        } else {\n          if (wasActive) activeChanged = true;\n          link.classList.remove('active');\n          link.removeAttribute('aria-current');\n        }\n\n        return isActive;\n      }\n    };\n\n    // Wash all the original Active State\n    previousActive.forEach(link => {\n      utils.setActiveState(link, false);\n    });\n\n    // Find a links that match the current path.\n    const activeLinks = [];\n    document.querySelectorAll('.sidemenu a[href], .topmenu a[href]').forEach(link => {\n      const href = link.getAttribute('href');\n      if (!href) return;\n\n      // Check the hash first.\n      if (currentHash && href.includes('#')) {\n        const linkHash = href.split('#')[1];\n        const currentHashValue = currentHash.substring(1);\n        if (linkHash === currentHashValue) {\n          if (utils.setActiveState(link)) {\n            activeLinks.push(link);\n          }\n          return;\n        }\n      }\n\n      // Check the path\n      if (utils.comparePaths(href, currentPath)) {\n        if (utils.setActiveState(link)) {\n          activeLinks.push(link);\n        }\n      }\n    });\n\n    // If no exact match is found, find the best match\n    if (activeLinks.length === 0) {\n      let bestMatch = null;\n      let bestMatchLength = 0;\n\n      document.querySelectorAll('.sidemenu a[href], .topmenu a[href]').forEach(link => {\n        const href = link.getAttribute('href');\n        if (!href) return;\n\n        const cleanHref = utils.cleanUrl(href);\n        const cleanCurrentPath = utils.cleanUrl(currentPath);\n\n        if (cleanCurrentPath.startsWith(cleanHref) && cleanHref.length > bestMatchLength) {\n          bestMatch = link;\n          bestMatchLength = cleanHref.length;\n        }\n      });\n\n      if (bestMatch) {\n        utils.setActiveState(bestMatch);\n        activeLinks.push(bestMatch);\n      }\n    }\n\n    // Notify Event when there is a change.\n    if (activeChanged) {\n      Now.emit('menu:activeChanged', {\n        path: currentPath,\n        hash: currentHash,\n        activeLinks,\n        previousActive: Array.from(previousActive)\n      });\n    }\n\n    return activeLinks;\n  },\n\n  setupAutoExpand() {\n    if (window.innerWidth >= this.config.breakpoint) {\n      document.querySelectorAll('.sidemenu [aria-haspopup=\"true\"], .topmenu [aria-haspopup=\"true\"]').forEach(button => {\n        // The button is inside li, submenu is sibling of button (also inside li)\n        const parentLi = button.closest('li');\n        if (!parentLi) return;\n\n        const submenu = parentLi.querySelector(':scope > ul');\n        if (!submenu) return;\n\n        button.addEventListener('mouseenter', () => {\n          if (!button.hasAttribute('aria-expanded') || button.getAttribute('aria-expanded') === 'false') {\n            button.setAttribute('aria-expanded', 'true');\n            this.checkAndAdjustPosition(submenu);\n          }\n        });\n\n        button.addEventListener('mouseleave', () => {\n          setTimeout(() => {\n            // Check if the parent li contains an active link\n            if (!parentLi.querySelector('.active')) {\n              button.setAttribute('aria-expanded', 'false');\n            }\n          }, this.config.animationDuration);\n        });\n      });\n    }\n  },\n\n  async createMenu(element) {\n    try {\n      if (element.dataset.menuId) return null;\n\n      // Skip elements with data-source that don't have content yet\n      // These will be rendered by setupApiDataListener when data arrives\n      if (element.dataset.source && !element.querySelector('ul')) {\n        return null;\n      }\n\n      // Also skip if no ul exists at all (empty menu)\n      if (!element.querySelector('ul')) {\n        return null;\n      }\n\n      const menuId = Utils.generateUUID();\n      element.dataset.menuId = menuId;\n      const menu = this.initializeMenuInstance(element, menuId);\n      this.setupMenuElements(menu);\n\n      // Only continue if container was found\n      if (menu.elements.container) {\n        this.setupAriaForNestedMenu(menu, menu.elements.container);\n        this.setupMenuHandlers(menu);\n        this.setupAccessibility(menu);\n        this.checkResponsiveState(menu, true);\n      }\n\n      this.state.menus.set(menuId, menu);\n\n      return menu;\n\n    } catch (error) {\n      this.handleError('Menu creation failed', error, 'error:menu');\n      return null;\n    }\n  },\n\n  // In MenuManager\n  handleClick(event) {\n    const menuItem = event.target.closest('.menu-item');\n    if (!menuItem) return;\n\n    // If it's a link with href, let RouterManager handle it\n    if (menuItem.tagName === 'A' && menuItem.hasAttribute('href')) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    // Handle menu click as normal\n    this.toggleMenu(menu);\n  },\n\n  initializeMenuInstance(element, menuId) {\n    return {\n      id: menuId,\n      element: element,\n      isMobile: false,\n      position: element.classList.contains('menu-left') ? 'left' : 'right',\n      isSidebar: element.classList.contains('sidemenu'),\n      touchData: null,\n      elements: {},\n      handlers: {}\n    };\n  },\n\n  setupMenuElements(menu) {\n    const container = menu.element.querySelector('ul');\n    const menuParent = menu.element.parentNode;\n\n    // Check if container exists\n    if (!container) {\n      menu.elements.container = null;\n      menu.elements.submenus = [];\n      return;\n    }\n\n    menu.elements.container = container;\n    menu.elements.submenus = [];\n    container.setAttribute('role', 'menubar');\n\n    let menuLevel = null;\n    if (menu.element.classList.contains('topmenu')) {\n      menuLevel = menu.element.classList.contains('responsive-menu') ? 'topmenu' : null;\n    } else if (menu.element.classList.contains('sidemenu')) {\n      menuLevel = 'sidemenu';\n    }\n\n    if (menuLevel) {\n      container.setAttribute('aria-label', I18nManager.translate('Main navigation'));\n\n      const nav = document.querySelector(`.${menuLevel}`);\n      if (nav) {\n        // Find toggle buttons for ARIA setup only (event handling via delegation)\n        let toggleButtons = document.querySelectorAll(`.${menuLevel}-toggle`);\n\n        // If no toggle buttons found and it's topmenu, create one\n        if (toggleButtons.length === 0 && menuLevel === 'topmenu') {\n          const close = document.createElement('button');\n          close.type = 'button';\n          close.className = `menu-toggle ${menuLevel}-toggle runtime`;\n          close.innerHTML = `\n          <span class=\"toggle-icon\">\n            <span class=\"toggle-bar\"></span>\n            <span class=\"toggle-bar\"></span>\n            <span class=\"toggle-bar\"></span>\n          </span>`;\n          container.parentElement.parentElement.insertBefore(close, menu.element);\n          toggleButtons = [close];\n        }\n\n        // Set ARIA attributes for all toggle buttons\n        if (toggleButtons.length > 0) {\n          menu.elements.toggleButtons = Array.from(toggleButtons);\n\n          const isOpen = this.isMenuOpen(menu);\n\n          toggleButtons.forEach(toggle => {\n            toggle.setAttribute('aria-haspopup', 'true');\n            toggle.setAttribute('aria-controls', menu.element.id || `menu-${menu.id}`);\n            toggle.setAttribute('role', 'menuitem');\n            toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');\n            toggle.setAttribute('aria-label', I18nManager.translate(isOpen ? 'Close menu' : 'Open menu'));\n          });\n\n          // Keep first one as primary toggle for ARIA updates\n          menu.elements.toggle = toggleButtons[0];\n        }\n      }\n\n      const backdrop = document.createElement('div');\n      backdrop.className = 'menu-backdrop';\n      menuParent.insertBefore(backdrop, menu.element);\n      menu.elements.backdrop = backdrop;\n    }\n\n    if (!menu.element.id) {\n      menu.element.id = `menu-${menu.id}`;\n    }\n  },\n\n  setupAriaForNestedMenu(menu, ul) {\n    const menuItems = ul.querySelectorAll(':scope > li');\n    menuItems.forEach((menuItem) => {\n      menuItem.setAttribute('role', 'none');\n\n      const submenu = menuItem.querySelector(':scope > ul');\n      if (submenu) {\n        const menuId = submenu.id || `submenu-${Utils.generateUUID()}`;\n        submenu.id = menuId;\n        submenu.setAttribute('role', 'menu');\n        submenu.setAttribute('aria-label', I18nManager.translate('Submenu'));\n        submenu.setAttribute('aria-orientation', 'vertical');\n        submenu.setAttribute('aria-hidden', 'true');\n\n        const button = menuItem.querySelector('button');\n        if (button) {\n          button.setAttribute('role', 'menuitem');\n          button.setAttribute('aria-haspopup', 'true');\n          button.setAttribute('aria-expanded', 'false');\n          button.setAttribute('aria-controls', menuId);\n          button.content = submenu;\n          menu.elements.submenus.push(button);\n          submenu.toggle = button;\n        }\n\n        this.setupAriaForNestedMenu(menu, submenu);\n      } else {\n        const link = menuItem.querySelector('a');\n        if (link) {\n          link.setAttribute('role', 'menuitem');\n        }\n      }\n    });\n  },\n\n  checkAndAdjustPosition(submenu) {\n    const rect = submenu.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    if (rect.right > viewportWidth) {\n      submenu.style.left = 'auto';\n      submenu.style.right = '100%';\n    } else {\n      submenu.style.left = '';\n      submenu.style.right = '';\n    }\n\n    if (rect.bottom > viewportHeight) {\n      const overflowAmount = rect.bottom - viewportHeight;\n      submenu.style.top = `${-overflowAmount}px`;\n    } else {\n      submenu.style.top = '';\n    }\n  },\n\n  setupMenuHandlers(menu) {\n    // Use event delegation: attach a small set of handlers on the menu root\n    try {\n      menu.handlers.toggle = (e) => {\n        e.stopPropagation();\n        // Prevent toggling the main sidemenu if a submenu is expanded\n        if (menu.element.classList.contains('sidemenu') && document.body.classList.contains('sidemenu-sub-expanded')) {\n          return;\n        }\n        this.toggleMenu(menu);\n      };\n\n      if (menu.elements) {\n        // Toggle buttons use event delegation in setupToggleListeners()\n        // Only backdrop needs direct binding here\n        if (menu.elements.backdrop) {\n          menu.elements.backdrop.addEventListener('click', menu.handlers.toggle);\n        }\n\n        menu.elements.submenus.forEach(submenu => {\n          submenu.addEventListener('click', (e) => {\n            const btn = e.target.closest('button');\n            if (btn && btn.getAttribute('aria-haspopup') === 'true') {\n              e.preventDefault();\n              e.stopPropagation();\n              if (menu.elements.container.getAttribute('aria-orientation') === 'vertical') {\n                this.toggleSubmenu(menu, submenu, false);\n              }\n            }\n          });\n        });\n      }\n\n      const touchHandlers = {\n        start: (e) => {\n          menu.touchData = {\n            startX: e.touches[0].clientX,\n            startY: e.touches[0].clientY,\n            startTime: Date.now(),\n            isScrolling: null\n          };\n        },\n\n        move: (e) => {\n          if (!menu.touchData || !this.isMenuOpen(menu)) return;\n\n          const touchData = menu.touchData;\n          const touch = e.touches[0];\n          const deltaX = touch.clientX - touchData.startX;\n          const deltaY = touch.clientY - touchData.startY;\n\n          if (touchData.isScrolling === null) {\n            touchData.isScrolling = Math.abs(deltaY) > Math.abs(deltaX);\n          }\n\n          if (touchData.isScrolling) return;\n\n          if ((menu.position === 'right' && deltaX > 0) ||\n            (menu.position === 'left' && deltaX < 0)) {\n            requestAnimationFrame(() => {\n              menu.elements.container.style.transform = `translateX(${deltaX}px)`;\n            });\n          }\n        },\n\n        end: (e) => {\n          if (!menu.touchData) return;\n\n          const touchData = menu.touchData;\n          const touch = e.changedTouches[0];\n          const deltaX = touch.clientX - touchData.startX;\n          const deltaTime = Date.now() - touchData.startTime;\n          const velocity = Math.abs(deltaX) / deltaTime;\n\n          menu.element.style.transform = '';\n\n          if (!touchData.isScrolling &&\n            (Math.abs(deltaX) > this.config.touchThreshold ||\n              velocity > 0.3)) {\n            this.closeMenu(menu);\n          }\n\n          menu.touchData = null;\n        },\n\n        cancel: () => {\n          if (menu.touchData) {\n            menu.elements.element.style.transform = '';\n            menu.touchData = null;\n          }\n        }\n      };\n\n      menu.element.addEventListener('touchstart', touchHandlers.start, {\n        passive: true\n      });\n\n      menu.element.addEventListener('touchmove', touchHandlers.move, {\n        passive: true\n      });\n\n      menu.element.addEventListener('touchend', touchHandlers.end, {\n        passive: true\n      });\n\n      menu.element.addEventListener('touchcancel', touchHandlers.cancel, {\n        passive: true\n      });\n\n      menu.handlers.touch = touchHandlers;\n\n      menu.handlers.keydown = (e) => this.handleKeyboardNavigation(menu, e);\n      document.addEventListener('keydown', menu.handlers.keydown);\n\n      if (!menu.isMobile && menu.element.classList.contains('topmenu')) {\n        this.setupHoverHandlers(menu);\n      }\n\n      menu.handlers.resize = () => this.checkResponsiveState(menu);\n      window.addEventListener('resize', menu.handlers.resize);\n\n      if (menu.element.classList.contains('topmenu')) {\n        menu.handlers.focusout = (e) => {\n          requestAnimationFrame(() => {\n            const currentFocus = document.activeElement;\n            const currentTopLi = currentFocus?.closest('.topmenu > ul > li');\n            const originalTopLi = e.target?.closest('.topmenu > ul > li');\n            if (!currentTopLi || currentTopLi !== originalTopLi) {\n              this.closeAllSubmenus(menu);\n            }\n          });\n        };\n\n        menu.element.addEventListener('focusout', menu.handlers.focusout);\n      }\n    } catch (error) {\n      ErrorManager.handle('Failed to setup menu handlers', {\n        context: 'MenuManager.setupMenuHandlers',\n        data: {\n          menuId: menu.id,\n          error\n        },\n      });\n    }\n  },\n\n  toggleMenu(menu) {\n    if (this.isMenuOpen(menu)) {\n      this.closeMenu(menu);\n    } else {\n      this.openMenu(menu);\n    }\n  },\n\n  async openMenu(menu) {\n    if (this.isMenuOpen(menu)) return;\n\n    const focusableElements = menu.element.querySelectorAll(this.config.accessibility.focusableSelectors);\n    focusableElements.forEach(el => {\n      el.removeAttribute('tabindex');\n    });\n\n    if (menu.element.classList.contains('sidemenu')) {\n      document.body.classList.add('sidemenu-close');\n    } else {\n      document.body.classList.add('topmenu-open');\n    }\n    if (menu.elements?.toggle) {\n      menu.elements.toggle.setAttribute('aria-expanded', 'true');\n      menu.elements.toggle.setAttribute('aria-label', I18nManager.translate('Close menu'));\n    }\n\n    if (this.config.accessibility.announceChanges) {\n      const topLevelItems = menu.element.querySelector(':scope > ul')\n        ?.querySelectorAll(':scope > li > [role=\"menuitem\"]').length || 0;\n      this.announce('{Open menu}, There are {count} items in total', {count: topLevelItems});\n    }\n\n    if (menu.touchData) {\n      menu.touchData = null;\n      menu.element.style.transform = '';\n    }\n\n    EventManager.emit('menu:opened', {menu});\n  },\n\n  async closeMenu(menu) {\n    if (!this.isMenuOpen(menu)) return;\n\n    // Only close submenus when NOT in mobile-menu mode\n    // In mobile-menu mode, we just hide/show without changing submenu state\n    const isMobileMenuMode = document.body.classList.contains('mobile-menu');\n\n    if (menu.elements && !isMobileMenuMode) {\n      for (const submenu of menu.elements.submenus) {\n        await this.closeSubmenu(menu, submenu);\n      }\n    }\n\n    if (menu.element && !isMobileMenuMode) {\n      const focusableElements = menu.element.querySelectorAll(this.config.accessibility.focusableSelectors);\n      focusableElements.forEach(el => {\n        el.setAttribute('tabindex', '-1');\n      });\n    }\n\n    if (menu.elements?.toggle) {\n      menu.elements.toggle.focus();\n    }\n\n    await new Promise(resolve => requestAnimationFrame(resolve));\n\n    if (menu.element?.classList.contains('sidemenu')) {\n      document.body.classList.remove('sidemenu-close');\n    } else if (menu.element?.classList.contains('topmenu')) {\n      document.body.classList.remove('topmenu-open');\n    }\n\n    if (menu.elements?.toggle) {\n      menu.elements.toggle.setAttribute('aria-expanded', 'false');\n      menu.elements.toggle.setAttribute('aria-label', I18nManager.translate('Open menu'));\n    }\n\n    if (menu.touchData) {\n      menu.element.style.transform = '';\n      menu.touchData = null;\n    }\n\n    if (this.config.accessibility.announceChanges) {\n      this.announce('Close menu');\n    }\n\n    Now.emit('menu:closed', {menu});\n  },\n\n  toggleSubmenu(menu, submenu) {\n    if (this.isSubmenuOpen(submenu)) {\n      this.closeSubmenu(menu, submenu);\n    } else {\n      this.openSubmenu(menu, submenu);\n    }\n  },\n\n  async openSubmenu(menu, button, options = {}) {\n    if (!button.content) return;\n\n    const currentLevel = button.parentElement.parentElement;\n    menu.elements.submenus.forEach(other => {\n      if (other !== button && other.parentElement.parentElement === currentLevel) {\n        this.closeSubmenu(menu, other);\n      }\n    });\n\n    // State is set via aria-expanded attribute below\n    button.setAttribute('aria-expanded', 'true');\n    button.content.setAttribute('aria-hidden', 'false');\n\n    if (menu.element.classList.contains('sidemenu')) {\n      // Only temporarily expand sidemenu when NOT in mobile-menu mode\n      // On mobile, sidemenu-close keeps the menu visible, so we must not remove it\n      const isMobileMenuMode = document.body.classList.contains('mobile-menu');\n\n      if (!isMobileMenuMode && document.body.classList.contains('sidemenu-close')) {\n        document.body.classList.remove('sidemenu-close');\n        // Mark that we temporarily expanded it, so we can collapse it back later\n        button.dataset.tempExpanded = 'true';\n      }\n      document.body.classList.add('sidemenu-sub-expanded');\n    } else if (menu.element.classList.contains('topmenu')) {\n      document.body.classList.add('topmenu-sub-expanded');\n    }\n\n    const focusableElements = button.content.querySelectorAll(this.config.accessibility.focusableSelectors);\n    focusableElements.forEach(el => {\n      el.removeAttribute('tabindex');\n    });\n\n    if (!menu.isMobile) {\n      requestAnimationFrame(() => {\n        this.checkAndAdjustPosition(button.content);\n      });\n    }\n\n    if (options.useKeyboard) {\n      const firstItem = button.content.querySelector('[role=\"menuitem\"]');\n      if (firstItem) {\n        await new Promise(resolve => setTimeout(resolve, 50));\n        firstItem.focus();\n      }\n    }\n\n    if (this.config.accessibility.announceChanges) {\n      const submenuItems = button.content.querySelectorAll(':scope > li > [role=\"menuitem\"]').length;\n      this.announce('{Open submenu}, There are {count} items in total', {count: submenuItems});\n    }\n\n    Now.emit('submenu:opened', {\n      menu,\n      button,\n      submenu: button.content,\n      previousFocus: document.activeElement\n    });\n  },\n\n  async closeSubmenu(menu, button) {\n    if (!button.content) return;\n\n    const currentFocus = document.activeElement;\n    let shouldFocusButton = false;\n\n    const childSubmenus = button.content.querySelectorAll('[aria-expanded=\"true\"]');\n    for (const child of childSubmenus) {\n      await this.closeSubmenu(menu, child);\n    }\n\n    const focusableElements = button.content.querySelectorAll(this.config.accessibility.focusableSelectors);\n    focusableElements.forEach(el => {\n      el.setAttribute('tabindex', '-1');\n    });\n\n    // Move focus to button BEFORE hiding to avoid aria-hidden focus warning\n    if (currentFocus && button.content.contains(currentFocus)) {\n      shouldFocusButton = true;\n      // Move focus immediately before any state changes\n      button.focus();\n      // Wait for focus to actually move before setting aria-hidden\n      await new Promise(resolve => requestAnimationFrame(resolve));\n    }\n\n    // State is set via aria-expanded attribute above\n    button.setAttribute('aria-expanded', 'false');\n    button.content.setAttribute('aria-hidden', 'true');\n\n    // If this submenu caused a temporary expansion, check if we should collapse it back\n    if (button.dataset.tempExpanded === 'true') {\n      // Check if any other submenus are still open\n      const hasOtherOpenSubmenus = menu.elements.submenus.some(submenu => this.isSubmenuOpen(submenu));\n      if (!hasOtherOpenSubmenus) {\n        document.body.classList.add('sidemenu-close');\n      }\n      // Clean up the dataset attribute\n      delete button.dataset.tempExpanded;\n    }\n\n    // Check if any other submenus are open before removing the class\n    const hasOpenSubmenu = menu.elements.submenus.some(submenu => this.isSubmenuOpen(submenu));\n    if (!hasOpenSubmenu) {\n      if (menu.element.classList.contains('sidemenu')) {\n        document.body.classList.remove('sidemenu-sub-expanded');\n      } else if (menu.element.classList.contains('topmenu')) {\n        document.body.classList.remove('topmenu-sub-expanded');\n      }\n    }\n\n\n    // Focus already moved before aria-hidden was set\n\n    if (!menu.isMobile) {\n      button.content.style.left = '';\n      button.content.style.right = '';\n      button.content.style.top = '';\n    }\n\n    if (this.config.accessibility.announceChanges) {\n      this.announce('Close submenu');\n    }\n\n    Now.emit('submenu:closed', {\n      menu,\n      button,\n      submenu: button.content,\n      currentFocus\n    });\n  },\n\n  closeAllSubmenus(menu) {\n    menu.elements?.submenus.forEach(submenu => {\n      if (submenu.getAttribute('aria-expanded') === 'true') {\n        this.closeSubmenu(menu, submenu);\n      }\n    });\n  },\n\n  hasMenu(menuId) {\n    return this.state.menus.has(menuId);\n  },\n\n  getMenu(menuId) {\n    return this.state.menus.get(menuId) || null;\n  },\n\n  setupTouchHandlers(menu) {\n    let touchIdentifier;\n\n    const handlers = {\n      start: (e) => {\n        if (touchIdentifier === undefined) {\n          touchIdentifier = e.changedTouches[0].identifier;\n          menu.touchData = {\n            startX: e.touches[0].clientX,\n            startY: e.touches[0].clientY,\n            startTime: Date.now(),\n            isScrolling: null\n          };\n        }\n      },\n\n      move: (e) => {\n        if (!menu.touchData) return;\n\n        const touch = Array.from(e.changedTouches)\n          .find(t => t.identifier === touchIdentifier);\n\n        if (!touch) return;\n\n        const deltaX = touch.clientX - menu.touchData.startX;\n        const deltaY = touch.clientY - menu.touchData.startY;\n\n        if (menu.touchData.isScrolling === null) {\n          menu.touchData.isScrolling = Math.abs(deltaY) > Math.abs(deltaX);\n        }\n\n        if (menu.touchData.isScrolling) return;\n\n        if (this.config.performance.useRequestAnimationFrame) {\n          requestAnimationFrame(() => {\n            this.handleTouchMove(menu, deltaX);\n          });\n        } else {\n          this.handleTouchMove(menu, deltaX);\n        }\n      },\n\n      end: (e) => {\n        const touch = Array.from(e.changedTouches)\n          .find(t => t.identifier === touchIdentifier);\n\n        if (!touch || !menu.touchData) return;\n\n        const deltaX = touch.clientX - menu.touchData.startX;\n        const deltaTime = Date.now() - menu.touchData.startTime;\n        const velocity = Math.abs(deltaX) / deltaTime;\n\n        this.handleTouchEnd(menu, deltaX, velocity);\n\n        touchIdentifier = undefined;\n        menu.touchData = null;\n      },\n\n      cancel: () => {\n        if (menu.touchData) {\n          menu.element.style.transform = '';\n          touchIdentifier = undefined;\n          menu.touchData = null;\n        }\n      }\n    };\n\n    Object.entries(handlers).forEach(([event, handler]) => {\n      menu.element.addEventListener(`touch${event}`, handler, {\n        passive: true\n      });\n      menu.handlers[`touch${event}`] = handler;\n    });\n  },\n\n  setupAccessibility(menu) {\n    const liveRegion = document.createElement('div');\n    liveRegion.setAttribute('aria-live', 'polite');\n    liveRegion.setAttribute('aria-atomic', 'true');\n    liveRegion.className = 'sr-only';\n    menu.element.appendChild(liveRegion);\n    menu.liveRegion = liveRegion;\n\n    menu.element.setAttribute('role', 'navigation');\n    menu.element.setAttribute('aria-label', I18nManager.translate('Main navigation'));\n\n    const keyboardHint = document.createElement('div');\n    keyboardHint.className = 'sr-only';\n    keyboardHint.textContent = I18nManager.translate('Keyboard navigation instructions');\n    menu.element.insertBefore(keyboardHint, menu.element.firstChild);\n  },\n\n  setupHoverHandlers(menu) {\n    menu.hoverTimeouts = new Map();\n\n    menu.elements.submenus.forEach(submenu => {\n\n      const mouseEnterHandler = () => {\n        const menuItem = submenu.closest('li');\n\n        if (!menu.isMobile && menu.element.classList.contains('topmenu') && !this.isSubmenuOpen(submenu) && menuItem) {\n          if (menu.hoverTimeouts?.has(submenu)) {\n            clearTimeout(menu.hoverTimeouts.get(submenu));\n          }\n\n          menu.hoverTimeouts.set(submenu, setTimeout(() => {\n            this.closeOtherSubmenus(menu, submenu);\n            this.openSubmenu(menu, submenu);\n          }, this.config.hover.openDelay));\n        }\n      };\n\n      const mouseLeaveHandler = (e) => {\n        if (!submenu.isConnected) return;\n\n        if (menu.hoverTimeouts?.has(submenu)) {\n          clearTimeout(menu.hoverTimeouts.get(submenu));\n        }\n\n        menu.hoverTimeouts?.set(submenu, setTimeout(() => {\n          if (submenu.isConnected &&\n            !menu.isMobile &&\n            menu.element.classList.contains('topmenu')) {\n            this.closeSubmenu(menu, submenu);\n          }\n        }, this.config.hover.closeDelay));\n      };\n\n      const menuItem = submenu.closest('li');\n      menuItem.addEventListener('mouseenter', mouseEnterHandler);\n      menuItem.addEventListener('mouseleave', mouseLeaveHandler);\n\n      submenu.hoverHandlers = {\n        enter: mouseEnterHandler,\n        leave: mouseLeaveHandler\n      };\n    });\n  },\n\n  checkResponsiveState(menu, initial = false) {\n    const wasMobile = menu.isMobile;\n    const isMobile = window.innerWidth < this.config.breakpoint;\n    menu.elements.container.setAttribute('aria-orientation', isMobile || menu.isSidebar ? 'vertical' : 'horizontal');\n\n    menu.elements.submenus.forEach(submenu => {\n      if (submenu.content) {\n        this.checkAndAdjustPosition(submenu.content);\n      }\n    });\n\n    let stateChanged = initial;\n    if (isMobile !== wasMobile) {\n      stateChanged = true;\n      menu.isMobile = isMobile;\n\n      if (!isMobile && this.isMenuOpen(menu) && !menu.isSidebar) {\n        this.closeMenu(menu);\n      }\n\n      if (isMobile) {\n        document.body.classList.add('mobile-menu');\n      } else {\n        document.body.classList.remove('mobile-menu');\n      }\n    }\n\n    if (stateChanged && menu.element.classList.contains('topmenu')) {\n      if (!isMobile) {\n        this.setupHoverHandlers(menu);\n      } else if (!initial) {\n        this.removeHoverHandlers(menu);\n      }\n    }\n  },\n\n  isHoveringSubmenu(submenu, e) {\n    const currentItem = submenu.closest('li');\n    const relatedTarget = e.relatedTarget;\n\n    if (!relatedTarget) return false;\n\n    if (currentItem.contains(relatedTarget)) {\n      return true;\n    }\n\n    const parentUl = currentItem.closest('ul');\n    if (parentUl && parentUl.contains(relatedTarget)) {\n      return true;\n    }\n\n    let parent = parentUl?.parentElement;\n    while (parent) {\n      if (parent.contains(relatedTarget)) {\n        return true;\n      }\n      parent = parent.closest('li')?.parentElement;\n    }\n\n    return false;\n  },\n\n  findTopLevelMenuItem(current) {\n    let parent = current.closest('li');\n    while (parent) {\n      const parentUl = parent.parentElement;\n      if (!parentUl || !parentUl.closest('li')) {\n        return parent.querySelector(':scope > [role=\"menuitem\"]');\n      }\n      parent = parentUl.closest('li');\n    }\n    return null;\n  },\n\n  getTopLevelMenuItems(menu) {\n    return menu.elements.container.querySelectorAll(':scope > li > a, :scope > li:not(.menu-close) > button');\n  },\n\n  handleKeyboardNavigation(menu, e) {\n    if (!menu.element.contains(e.target)) return;\n\n    const current = document.activeElement;\n    const isTopLevel = current.closest('ul') === menu.elements.container;\n    const submenu = current.closest('[aria-haspopup=\"true\"]');\n    const isHorizontalMenu = menu.elements.container.getAttribute('aria-orientation') === 'horizontal';\n\n    switch (e.key) {\n      case 'Escape':\n        e.preventDefault();\n        if (!isTopLevel) {\n          const parentButton = current.closest('ul').parentElement.querySelector('[aria-haspopup=\"true\"]');\n          if (parentButton) {\n            this.closeSubmenu(menu, parentButton);\n            parentButton.focus();\n          }\n        } else if (this.isMenuOpen(menu)) {\n          this.closeAllSubmenus(menu);\n          this.closeMenu(menu);\n          if (menu.elements?.toggle) {\n            menu.elements.toggle.focus();\n          }\n        }\n        break;\n\n      case 'Tab':\n        if (!isTopLevel) {\n          const topLevelItem = this.findTopLevelMenuItem(current);\n          const topLevelItems = this.getTopLevelMenuItems(menu);\n          const index = Array.from(topLevelItems).indexOf(topLevelItem);\n\n          let nextItem;\n          if (e.shiftKey) {\n            nextItem = topLevelItems[index - 1];\n          } else {\n            nextItem = topLevelItems[index + 1];\n          }\n\n          if (!nextItem) {\n            this.closeMenu(menu);\n            if (menu.elements?.toggle) {\n              menu.elements.toggle.focus();\n            }\n            return;\n          }\n          e.preventDefault();\n          nextItem.focus();\n          if (nextItem.hasAttribute('aria-haspopup')) {\n            this.openSubmenu(menu, nextItem, {useKeyboard: true});\n          }\n        }\n        break;\n\n      case 'Enter':\n      case ' ':\n        if (current.hasAttribute('aria-haspopup')) {\n          e.preventDefault();\n          this.openSubmenu(menu, current, {useKeyboard: true});\n        }\n        break;\n\n      case 'Escape':\n        e.preventDefault();\n        if (submenu) {\n          this.closeSubmenu(menu, submenu);\n          submenu.focus();\n        } else if (this.isMenuOpen(menu)) {\n          this.closeMenu(menu);\n          menu.elements.toggle?.focus();\n        }\n        break;\n\n      case 'ArrowDown':\n        e.preventDefault();\n        if (current.hasAttribute('aria-haspopup') &&\n          current.getAttribute('aria-expanded') === 'false') {\n          this.openSubmenu(menu, current, {useKeyboard: true});\n        } else {\n          const items = Array.from(current.closest('ul').querySelectorAll(':scope > li > [role=\"menuitem\"]'));\n          const nextItem = this.getNextFocusableItem(items, current);\n          if (nextItem) nextItem.focus();\n        }\n        break;\n\n      case 'ArrowUp':\n        e.preventDefault();\n        const items = Array.from(current.closest('ul').querySelectorAll(':scope > li > [role=\"menuitem\"]'));\n        const prevItem = this.getPreviousFocusableItem(items, current);\n        if (prevItem) prevItem.focus();\n        break;\n\n      case 'ArrowRight':\n        if (isHorizontalMenu && isTopLevel) {\n          e.preventDefault();\n          const items = this.getTopLevelMenuItems(menu);\n          const nextItem = this.getNextFocusableItem(items, current);\n          if (nextItem) {\n            nextItem.focus();\n            if (nextItem.hasAttribute('aria-haspopup')) {\n              this.openSubmenu(menu, nextItem, {useKeyboard: true});\n            }\n          }\n        } else if (current.hasAttribute('aria-haspopup')) {\n          e.preventDefault();\n          this.openSubmenu(menu, current, {useKeyboard: true});\n        }\n        break;\n\n      case 'ArrowLeft':\n        if (isHorizontalMenu && isTopLevel) {\n          e.preventDefault();\n          const items = this.getTopLevelMenuItems(menu);\n          const prevItem = this.getPreviousFocusableItem(items, current);\n          if (prevItem) {\n            prevItem.focus();\n            if (prevItem.hasAttribute('aria-haspopup')) {\n              this.openSubmenu(menu, prevItem);\n            }\n          }\n        } else {\n          e.preventDefault();\n          const parentButton = current.closest('ul')?.parentElement?.querySelector('[aria-haspopup=\"true\"]');\n          if (parentButton) {\n            this.closeSubmenu(menu, parentButton);\n            parentButton.focus();\n          }\n        }\n        break;\n\n      case 'Home':\n        e.preventDefault();\n        const firstItem = this.getFirstFocusableItem(menu);\n        if (firstItem) firstItem.focus();\n        break;\n\n      case 'End':\n        e.preventDefault();\n        const lastItem = this.getLastFocusableItem(menu);\n        if (lastItem) lastItem.focus();\n        break;\n    }\n  },\n\n  getFirstFocusableItem(menu) {\n    return menu.elements.container.querySelector('[role=\"menuitem\"]:not([disabled])');\n  },\n\n  getLastFocusableItem(menu) {\n    const items = menu.elements.container.querySelectorAll('[role=\"menuitem\"]:not([disabled])');\n    return items[items.length - 1];\n  },\n\n  findSubmenuByToggle(menu, toggle) {\n    return menu.elements.submenus.find(\n      submenu => submenu.toggle === toggle\n    );\n  },\n\n  getNextFocusableItem(items, current) {\n    const currentIndex = Array.from(items).indexOf(current);\n    return items[currentIndex + 1] || items[0];\n  },\n\n  getPreviousFocusableItem(items, current) {\n    const currentIndex = Array.from(items).indexOf(current);\n    return items[currentIndex - 1] || items[items.length - 1];\n  },\n\n  announce(message, params = {}) {\n    if (!this.announcer) {\n      this.announcer = document.createElement('div');\n      this.announcer.setAttribute('aria-live', 'polite');\n      this.announcer.setAttribute('role', 'status');\n      this.announcer.setAttribute('aria-atomic', 'true');\n      this.announcer.className = 'sr-only';\n      document.body.appendChild(this.announcer);\n    }\n\n    this.announcer.setAttribute('lang', window.I18nManager?.getCurrentLocale() || 'en');\n\n    this.announcer.textContent = I18nManager.translate(message, params);\n  },\n\n  handleError(message, error, type, canRecover = true) {\n    if (error.isRecoveryError) {\n      ErrorManager.handle(error, {\n        context: `MenuManager.${type}`,\n        type: 'error:menu',\n        notify: true\n      });\n      return;\n    }\n\n    ErrorManager.handle(message, {\n      context: `MenuManager.${type}`,\n      type: 'error:menu',\n      data: {canRecover},\n      notify: true\n    });\n\n    if (canRecover) {\n      try {\n        this.recoverFromError();\n      } catch (recoveryError) {\n        recoveryError.isRecoveryError = true;\n\n        ErrorManager.handle(recoveryError, {\n          context: `MenuManager.recovery.${type}`,\n          type: 'error:menu',\n          notify: true\n        });\n\n        this.forceCleanup();\n      }\n    }\n  },\n\n  recoverFromError() {\n    this.state.menus.forEach(menu => {\n      if (this.isMenuOpen(menu)) {\n        this.closeMenu(menu);\n      }\n      this.closeAllSubmenus(menu);\n      this.resetMenuState(menu);\n    });\n\n    this.checkResponsiveState();\n  },\n\n  forceCleanup() {\n    try {\n      this.state.menus.forEach(menu => {\n        menu.touchData = null;\n        menu.element.style.transform = '';\n\n        if (menu.elements?.toggle) {\n          menu.elements.toggle.setAttribute('aria-expanded', 'false');\n        }\n      });\n\n      if (menu.element && menu.element.classList.contains('sidemenu')) {\n        document.body.classList.remove('sidemenu-close');\n      } else {\n        document.body.classList.remove('topmenu-open');\n      }\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'MenuManager.forceCleanup'\n      });\n    }\n  },\n\n  resetMenuState(menu) {\n    menu.touchData = null;\n    menu.element.style.transform = '';\n    if (menu.element && menu.element.classList.contains('sidemenu')) {\n      document.body.classList.remove('sidemenu-close');\n    } else {\n      document.body.classList.remove('topmenu-open');\n    }\n  },\n\n  destroyMenu(menuId) {\n    const menu = this.state.menus.get(menuId);\n    if (!menu) return;\n\n    this.cleanup(menu);\n\n    if (menu.element) {\n      delete menu.element.dataset.menuId;\n    }\n\n    this.state.menus.delete(menuId);\n  },\n\n  cleanup(menu) {\n    if (!menu) return;\n\n    if (menu.handlers) {\n      if (menu.handlers.toggle) {\n        menu.elements.toggle?.removeEventListener('click', menu.handlers.toggle);\n      }\n      if (menu.handlers.close) {\n        menu.elements.close?.removeEventListener('click', menu.handlers.close);\n      }\n      if (menu.handlers.backdrop) {\n        menu.elements.backdrop?.removeEventListener('click', menu.handlers.backdrop);\n      }\n      if (menu.handlers.keydown) {\n        document.removeEventListener('keydown', menu.handlers.keydown);\n      }\n      if (menu.handlers.resize) {\n        window.removeEventListener('resize', menu.handlers.resize);\n      }\n      if (menu.handlers.focusout) {\n        menu.element.removeEventListener('focusout', menu.handlers.focusout);\n      }\n\n      if (menu.handlers.touch) {\n        menu.element.removeEventListener('touchstart', menu.handlers.touch.start);\n        menu.element.removeEventListener('touchmove', menu.handlers.touch.move);\n        menu.element.removeEventListener('touchend', menu.handlers.touch.end);\n        menu.element.removeEventListener('touchcancel', menu.handlers.touch.cancel);\n      }\n    }\n\n    this.removeHoverHandlers(menu);\n\n    if (menu.hoverTimeouts) {\n      menu.hoverTimeouts.forEach(timeout => clearTimeout(timeout));\n      menu.hoverTimeouts.clear();\n    }\n\n    if (menu.elements) {\n      if (menu.elements.backdrop) {\n        menu.elements.backdrop.remove();\n      }\n      if (menu.elements.close) {\n        menu.elements.close.remove();\n      }\n      if (menu.elements.toggle?.classList.contains('runtime')) {\n        menu.elements.toggle.remove();\n      }\n    }\n\n    menu.touchData = null;\n    menu.element.style.transform = '';\n    if (menu.element && menu.element.classList.contains('sidemenu')) {\n      document.body.classList.remove('sidemenu-close');\n    } else {\n      document.body.classList.remove('topmenu-open');\n    }\n\n    menu.element = null;\n    menu.elements = null;\n    menu.handlers = null;\n    menu.hoverTimeouts = null;\n    menu.touchData = null;\n  },\n\n  removeHoverHandlers(menu) {\n    if (!menu?.elements?.submenus) return;\n\n    menu.elements.submenus.forEach(submenu => {\n      if (submenu?.hoverHandlers) {\n        const menuItem = submenu.closest('li');\n        if (menuItem) {\n          menuItem.removeEventListener('mouseenter', submenu.hoverHandlers.enter);\n          menuItem.removeEventListener('mouseleave', submenu.hoverHandlers.leave);\n        }\n        delete submenu.hoverHandlers;\n      }\n    });\n\n    if (menu.hoverTimeouts) {\n      menu.hoverTimeouts.forEach(clearTimeout);\n      menu.hoverTimeouts.clear();\n      delete menu.hoverTimeouts;\n    }\n  },\n\n  destroy() {\n    this.state.menus.forEach((menu) => {\n      this.destroyMenu(menu.id);\n    });\n\n    this.state.menus.clear();\n\n    if (this.observer) {\n      this.observer.disconnect();\n      this.observer = null;\n    }\n\n    if (this.announcer) {\n      this.announcer.remove();\n      this.announcer = null;\n    }\n\n    if (menu.elements) {\n      if (menu.elements.backdrop) {\n        menu.elements.backdrop.remove();\n      }\n      if (menu.elements.close) {\n        menu.elements.close.remove();\n      }\n      if (menu.elements.toggle?.classList.contains('runtime')) {\n        menu.elements.toggle.remove();\n      }\n    }\n\n    this.state.initialized = false;\n\n    Now.emit('menumanager:destroyed');\n  },\n\n  handleTouchMove(menu, deltaX) {\n    if (!this.config.performance.touchOptimization) {\n      menu.element.style.transform = `translateX(${deltaX}px)`;\n      return;\n    }\n\n    menu.element.style.transform = `translate3d(${deltaX}px, 0, 0)`;\n  },\n\n  findMenuByElement(element) {\n    for (const menu of this.state.menus.values()) {\n      if (menu.element === element) {\n        return menu;\n      }\n    }\n    return null;\n  },\n\n  closeOtherSubmenus(menu, currentSubmenu) {\n    const currentItem = currentSubmenu.closest('li');\n    const parentUl = currentItem?.closest('ul');\n\n    if (parentUl) {\n      menu.elements.submenus.forEach(other => {\n        const otherItem = other.closest('li');\n        if (other !== currentSubmenu &&\n          otherItem &&\n          otherItem.closest('ul') === parentUl) {\n          this.closeSubmenu(menu, other);\n        }\n      });\n    }\n  },\n\n  isSubmenuReady(submenu) {\n    return submenu &&\n      submenu.isConnected &&\n      submenu.content &&\n      submenu.content.isConnected;\n  },\n\n  /**\n   * Render menu from data array\n   * @param {HTMLElement|string} container - Menu container element or selector\n   * @param {Array} data - Menu items array\n   * @param {Object} options - Render options\n   * @returns {HTMLElement} The rendered menu container\n   *\n   * @example\n   * MenuManager.renderFromData(nav, [\n   *   {title: 'Dashboard', url: '/', icon: 'icon-dashboard'},\n   *   {title: 'Settings', icon: 'icon-settings', children: [\n   *     {title: 'Profile', url: '/settings/profile'},\n   *     {title: 'Security', url: '/settings/security'}\n   *   ]}\n   * ]);\n   */\n  renderFromData(container, data, options = {}) {\n    // Resolve container\n    if (typeof container === 'string') {\n      container = document.querySelector(container);\n    }\n\n    if (!container) {\n      ErrorManager.handle('MenuManager.renderFromData: Container not found', {\n        context: 'MenuManager.renderFromData',\n        data: {container, options}\n      });\n      return null;\n    }\n\n    if (!Array.isArray(data)) {\n      ErrorManager.handle('MenuManager.renderFromData: Data must be an array', {\n        context: 'MenuManager.renderFromData',\n        data: {data}\n      });\n      return container;\n    }\n\n    // Destroy existing menu if already initialized\n    const existingMenuId = container.dataset.menuId;\n    if (existingMenuId && this.state.menus.has(existingMenuId)) {\n      this.destroyMenu(existingMenuId);\n    }\n\n    // Create ul container\n    const ul = document.createElement('ul');\n\n    // Render each menu item\n    data.forEach((item, index) => {\n      const li = this.createMenuItem(item, 0, options);\n      ul.appendChild(li);\n    });\n\n    // Clear and append\n    container.innerHTML = '';\n    container.appendChild(ul);\n\n    // Ensure data-component=\"menu\" is set for initialization\n    if (!container.hasAttribute('data-component')) {\n      container.setAttribute('data-component', 'menu');\n    }\n\n    // Initialize the menu\n    this.createMenu(container);\n\n    // Update active state\n    this.updateActiveMenu();\n\n    // Emit event\n    Now.emit('menu:rendered', {\n      container,\n      itemCount: data.length\n    });\n\n    return container;\n  },\n\n  /**\n   * Create a single menu item element\n   * @param {Object} item - Menu item data\n   * @param {number} level - Nesting level (0 = top level)\n   * @param {Object} options - Render options\n   * @returns {HTMLElement} The li element\n   */\n  createMenuItem(item, level = 0, options = {}) {\n    const li = document.createElement('li');\n    li.setAttribute('role', 'none');\n\n    // Check if has children\n    const hasChildren = item.children && Array.isArray(item.children) && item.children.length > 0;\n\n    if (hasChildren) {\n      // Create submenu toggle button\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.setAttribute('role', 'menuitem');\n      button.setAttribute('aria-haspopup', 'true');\n      button.setAttribute('aria-expanded', 'false');\n\n      // Icon\n      if (item.icon) {\n        const icon = document.createElement('i');\n        icon.className = item.icon;\n        button.appendChild(icon);\n      }\n\n      // Title\n      const title = item.title || '';\n      const span = document.createElement('span');\n      span.textContent = I18nManager.translate(title);\n      span.setAttribute('data-i18n', title);\n      button.appendChild(span);\n\n      li.appendChild(button);\n\n      // Create submenu\n      const submenuId = `submenu-${Utils.generateUUID()}`;\n      const submenu = document.createElement('ul');\n      submenu.id = submenuId;\n      submenu.setAttribute('role', 'menu');\n      submenu.setAttribute('aria-label', I18nManager.translate('Submenu'));\n      submenu.setAttribute('aria-hidden', 'true');\n\n      button.setAttribute('aria-controls', submenuId);\n\n      // Recursively add children (max 2 levels)\n      if (level < 1) {\n        item.children.forEach(child => {\n          const childLi = this.createMenuItem(child, level + 1, options);\n          submenu.appendChild(childLi);\n        });\n      }\n\n      li.appendChild(submenu);\n\n    } else {\n      // Create link\n      const link = document.createElement('a');\n      link.href = item.url || '#';\n      link.setAttribute('role', 'menuitem');\n\n      // Icon\n      if (item.icon) {\n        const icon = document.createElement('i');\n        icon.className = item.icon;\n        link.appendChild(icon);\n      }\n\n      // Title\n      const title = item.title || '';\n      const span = document.createElement('span');\n      span.textContent = I18nManager.translate(title);\n      span.setAttribute('data-i18n', title);\n      link.appendChild(span);\n\n      // Badge (optional)\n      if (item.badge) {\n        const badge = document.createElement('span');\n        badge.className = item.badgeClass || 'badge';\n        badge.textContent = item.badge;\n        badge.setAttribute('data-i18n', item.badge || '');\n        link.appendChild(badge);\n      }\n\n      li.appendChild(link);\n    }\n\n    // Additional attributes\n    if (item.id) {\n      li.id = item.id;\n    }\n    if (item.class) {\n      li.className = item.class;\n    }\n    if (item.data) {\n      Object.entries(item.data).forEach(([key, value]) => {\n        li.dataset[key] = value;\n      });\n    }\n\n    return li;\n  },\n\n  /**\n   * Set menu data and render (alias for renderFromData)\n   * @param {HTMLElement|string} container - Menu container\n   * @param {Array} data - Menu data\n   * @param {Object} options - Options\n   */\n  setData(container, data, options = {}) {\n    return this.renderFromData(container, data, options);\n  }\n};\n\nif (window.Now?.registerManager) {\n  Now.registerManager('menu', MenuManager);\n}\n\nwindow.MenuManager = MenuManager;\n","/**\n * Sortable - Drag and drop sorting component\n *\n * @class Sortable\n * @description Enables drag-and-drop sorting for lists and grids with optional API integration\n *\n * @example\n * // HTML-based initialization\n * <div data-component=\"sortable\" data-group=\"tasks\">\n *   <div draggable=\"true\" data-id=\"1\">Item 1</div>\n *   <div draggable=\"true\" data-id=\"2\">Item 2</div>\n * </div>\n *\n * @example\n * // JavaScript initialization\n * const sortable = new Sortable(element, {\n *   draggable: '.item',\n *   handle: '.drag-handle',\n *   group: 'shared-group',\n *   onEnd: (evt) => console.log('Dropped', evt)\n * });\n */\nclass Sortable {\n  /**\n   * Create a Sortable instance\n   * @param {HTMLElement} element - Container element for sortable items\n   * @param {Object} options - Configuration options\n   * @param {string} [options.draggable='[draggable=\"true\"]'] - Selector for draggable items\n   * @param {string} [options.handle=null] - Selector for drag handle (if null, entire item is draggable)\n   * @param {number} [options.animation=150] - Animation duration in ms\n   * @param {string} [options.ghostClass='sortable-ghost'] - CSS class for ghost element\n   * @param {string} [options.dragClass='sortable-drag'] - CSS class for dragging element\n   * @param {string} [options.dataIdAttr='data-id'] - Attribute name for item ID\n   * @param {string} [options.group=null] - Group name for cross-container dragging\n   * @param {string} [options.apiEndpoint] - API endpoint for auto-save\n   * @param {string} [options.apiMethod='PUT'] - HTTP method for API calls\n   * @param {string} [options.apiIdAttr='data-id'] - Attribute to read item ID from\n   * @param {string} [options.apiStageAttr='data-category'] - Attribute to read category/stage from container\n   * @param {string} [options.apiUpdateField='category'] - Field name to send in API payload\n   * @param {Object} [options.apiExtraData] - Additional data to send with API requests\n   * @param {Function} [options.onStart] - Callback when drag starts\n   * @param {Function} [options.onEnd] - Callback when drag ends\n   */\n  constructor(element, options = {}) {\n    this.element = element;\n\n    // Read declarative API configuration from data attributes\n    const apiEndpoint = element.dataset.sortableApi || element.dataset.apiEndpoint;\n    const apiMethod = element.dataset.sortableMethod || element.dataset.apiMethod || 'PUT';\n    const apiIdAttr = element.dataset.sortableIdAttr || 'data-id';\n    const apiStageAttr = element.dataset.sortableStageAttr || 'data-category';\n    const apiUpdateField = element.dataset.sortableUpdateField || 'category';\n    const apiExtraData = element.dataset.sortableExtraData;\n\n    this.options = {\n      draggable: '[draggable=\"true\"]',\n      handle: null,\n      animation: 150,\n      ghostClass: 'sortable-ghost',\n      dragClass: 'sortable-drag',\n      dataIdAttr: 'data-id',\n      forceFallback: false,\n      fallbackTolerance: 0,\n      scroll: true,\n      scrollSensitivity: 30,\n      scrollSpeed: 10,\n      rtl: document.dir === 'rtl',\n      disabled: false,\n      group: null, // Support cross-container drag with shared group name\n      // Declarative API configuration\n      apiEndpoint: apiEndpoint,\n      apiMethod: apiMethod,\n      apiIdAttr: apiIdAttr,\n      apiStageAttr: apiStageAttr,\n      apiUpdateField: apiUpdateField,\n      apiExtraData: apiExtraData ? JSON.parse(apiExtraData) : null,\n      ...options\n    };\n\n    this.state = {\n      dragging: null,\n      ghost: null,\n      placeholder: null,\n      initialIndex: -1,\n      scrollInterval: null,\n      dragStartEvent: null,\n      sourceContainer: null\n    };\n\n    // Register to group if specified\n    if (this.options.group) {\n      if (!Sortable.groups) {\n        Sortable.groups = {};\n      }\n      if (!Sortable.groups[this.options.group]) {\n        Sortable.groups[this.options.group] = [];\n      }\n      Sortable.groups[this.options.group].push(this);\n    }\n\n    this.init();\n  }\n\n  init() {\n    if (this.options.disabled) return;\n\n    this.handlers = {\n      dragStart: this.handleDragStart.bind(this),\n      dragOver: this.handleDragOver.bind(this),\n      dragEnd: this.handleDragEnd.bind(this),\n      keyDown: this.handleKeyDown.bind(this)\n    };\n\n    this.addEventListeners();\n  }\n\n  addEventListeners() {\n    const options = {passive: false};\n\n    this.element.addEventListener('mousedown', this.handlers.dragStart);\n    this.element.addEventListener('touchstart', this.handlers.dragStart, options);\n    this.element.addEventListener('keydown', this.handlers.keyDown);\n\n    if (this.options.scroll) {\n      window.addEventListener('scroll', this.handleScroll.bind(this), {passive: true});\n    }\n  }\n\n  handleDragStart(e) {\n    try {\n      if (this.options.disabled || (e.button !== undefined && e.button !== 0)) {\n        return;\n      }\n\n      // Allow clicks on interactive elements (links, buttons) inside draggable items\n      const target = e.target;\n      if (target.closest('a, button, input, select, textarea, [data-no-drag]')) {\n        return;\n      }\n\n      const dragEl = this.getDragElement(e);\n      if (!dragEl) return;\n\n      e.preventDefault();\n\n      this.state.dragging = dragEl;\n      this.state.initialIndex = this.getIndex(dragEl);\n      this.state.dragStartEvent = e;\n      this.state.sourceContainer = this.element;\n\n      this.createGhost(dragEl, e);\n      this.createPlaceholder(dragEl);\n\n      dragEl.classList.add(this.options.dragClass);\n\n      // Hide the original element while dragging\n      dragEl.style.opacity = '0';\n\n      document.addEventListener('mousemove', this.handlers.dragOver);\n      document.addEventListener('touchmove', this.handlers.dragOver);\n      document.addEventListener('mouseup', this.handlers.dragEnd);\n      document.addEventListener('touchend', this.handlers.dragEnd);\n\n      if (typeof this.options.onStart === 'function') {\n        this.options.onStart({\n          item: dragEl,\n          startIndex: this.state.initialIndex,\n          event: e\n        });\n      }\n\n      this.dispatchEvent('start', {\n        item: dragEl,\n        startIndex: this.state.initialIndex\n      });\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'Sortable.dragStart',\n        type: 'error:sortable',\n      });\n      this.handleDragEnd();\n    }\n  }\n\n  handleDragOver(e) {\n    if (!this.state.dragging) return;\n    e.preventDefault();\n\n    requestAnimationFrame(() => {\n      try {\n        const point = e.touches ? e.touches[0] : e;\n\n        this.moveGhost(point.pageX, point.pageY);\n\n        if (this.options.scroll) {\n          this.handleScrolling(point);\n        }\n\n        // Find target container and element\n        const targetInfo = this.findTargetContainer(point.pageX, point.pageY);\n\n        if (targetInfo && targetInfo.element && targetInfo.element !== this.state.dragging && targetInfo.element !== this.state.placeholder) {\n          const targetContainer = targetInfo.container;\n          const overEl = targetInfo.element;\n\n          // Move placeholder (not the actual element) to show drop position\n          const rect = overEl.getBoundingClientRect();\n          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          const isAfter = point.pageY > rect.top + scrollTop + (rect.height / 2);\n\n          if (isAfter) {\n            targetContainer.insertBefore(this.state.placeholder, overEl.nextSibling);\n          } else {\n            targetContainer.insertBefore(this.state.placeholder, overEl);\n          }\n\n        } else if (targetInfo && targetInfo.container && !targetInfo.element) {\n          // Empty container - show placeholder at end\n          const targetContainer = targetInfo.container;\n          if (targetContainer.children.length === 0 || !targetContainer.contains(this.state.placeholder)) {\n            targetContainer.appendChild(this.state.placeholder);\n          }\n        }\n\n      } catch (error) {\n        ErrorManager.handle(error, {\n          context: 'Sortable.dragOver',\n          type: 'error:sortable',\n        });\n        this.handleDragEnd();\n      }\n    });\n  }\n\n  handleDragEnd() {\n    if (!this.state.dragging) return;\n\n    try {\n      const dragEl = this.state.dragging;\n      const oldIndex = this.state.initialIndex;\n      const sourceContainer = this.state.sourceContainer;\n\n      // Move the actual element to where the placeholder is\n      if (this.state.placeholder && this.state.placeholder.parentNode) {\n        const targetContainer = this.state.placeholder.parentNode;\n        targetContainer.insertBefore(dragEl, this.state.placeholder);\n\n        // Restore original element visibility\n        dragEl.style.opacity = '';\n\n        const newIndex = this.getIndex(dragEl);\n\n        // Remove placeholder\n        this.state.placeholder.remove();\n        this.state.placeholder = null;\n\n        if (typeof this.options.onEnd === 'function') {\n          this.options.onEnd({\n            item: dragEl,\n            newIndex,\n            oldIndex,\n            to: targetContainer,\n            from: sourceContainer,\n            event: this.state.dragStartEvent\n          });\n        }\n\n        this.dispatchEvent('end', {\n          item: dragEl,\n          newIndex,\n          oldIndex,\n          to: targetContainer,\n          from: sourceContainer\n        });\n\n        // Trigger auto-save if configured\n        if (this.options.apiEndpoint && (newIndex !== oldIndex || targetContainer !== sourceContainer)) {\n          this.autoSavePosition(dragEl, targetContainer);\n        }\n      } else {\n        // No placeholder - restore visibility\n        dragEl.style.opacity = '';\n      }\n\n      dragEl.classList.remove(this.options.dragClass);\n\n      if (this.state.ghost) {\n        this.state.ghost.remove();\n        this.state.ghost = null;\n      }\n\n      if (this.state.scrollInterval) {\n        clearInterval(this.state.scrollInterval);\n      }\n\n      document.removeEventListener('mousemove', this.handlers.dragOver);\n      document.removeEventListener('touchmove', this.handlers.dragOver);\n      document.removeEventListener('mouseup', this.handlers.dragEnd);\n      document.removeEventListener('touchend', this.handlers.dragEnd);\n\n      this.state = {\n        dragging: null,\n        ghost: null,\n        placeholder: null,\n        initialIndex: -1,\n        scrollInterval: null,\n        dragStartEvent: null,\n        sourceContainer: null\n      };\n\n    } catch (error) {\n      ErrorManager.handle(error, {\n        context: 'Sortable.dragEnd',\n        type: 'error:sortable',\n      });\n    }\n  }\n\n  handleKeyDown(e) {\n    if (this.options.disabled) return;\n\n    const target = e.target;\n    if (!target.matches(this.options.draggable)) return;\n\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        this.moveElement(target, -1);\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        this.moveElement(target, 1);\n        break;\n      case 'Space':\n        e.preventDefault();\n        this.toggleSelection(target);\n        break;\n    }\n  }\n\n  handleScrolling(point) {\n    const sensitivity = this.options.scrollSensitivity;\n    const speed = this.options.scrollSpeed;\n\n    const scrollTop = window.pageYOffset;\n    let scrolling = false;\n    let direction = 0;\n\n    if (point.pageY - scrollTop < sensitivity) {\n      direction = -1;\n      scrolling = true;\n    } else if ((window.innerHeight + scrollTop) - point.pageY < sensitivity) {\n      direction = 1;\n      scrolling = true;\n    }\n\n    if (scrolling && !this.state.scrollInterval) {\n      this.state.scrollInterval = setInterval(() => {\n        window.scrollBy(0, speed * direction);\n      }, 16);\n    } else if (!scrolling && this.state.scrollInterval) {\n      clearInterval(this.state.scrollInterval);\n      this.state.scrollInterval = null;\n    }\n  }\n\n  handleScroll(e) {\n    if (!this.state.dragging) return;\n\n    const point = e.touches ? e.touches[0] : e;\n    const sensitivity = this.options.scrollSensitivity;\n    const speed = this.options.scrollSpeed;\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    const windowHeight = window.innerHeight;\n\n    let scrolling = false;\n    let direction = 0;\n\n    const topDist = point.pageY - scrollTop;\n    const bottomDist = windowHeight - (point.pageY - scrollTop);\n\n    if (topDist < sensitivity) {\n      direction = -1;\n      scrolling = true;\n    } else if (bottomDist < sensitivity) {\n      direction = 1;\n      scrolling = true;\n    }\n\n    if (scrolling && !this.state.scrollInterval) {\n      this.state.scrollInterval = setInterval(() => {\n        window.scrollBy({\n          top: speed * direction,\n          behavior: 'smooth'\n        });\n\n        if (this.state.ghost) {\n          this.moveGhost(\n            point.pageX,\n            point.pageY + (speed * direction)\n          );\n        }\n      }, 16);\n    }\n    else if (!scrolling && this.state.scrollInterval) {\n      clearInterval(this.state.scrollInterval);\n      this.state.scrollInterval = null;\n    }\n  }\n\n  getDragElement(e) {\n    const target = e.target;\n\n    if (this.options.handle) {\n      const handle = target.closest(this.options.handle);\n      return handle ? handle.closest(this.options.draggable) : null;\n    }\n\n    return target.closest(this.options.draggable);\n  }\n\n  createGhost(dragEl, e) {\n    const pageX = e.pageX || (e.touches && e.touches[0] ? e.touches[0].pageX : 0);\n    const pageY = e.pageY || (e.touches && e.touches[0] ? e.touches[0].pageY : 0);\n\n    // Table rows: keep lightweight icon ghost and horizontal lock to avoid layout distortion\n    if (dragEl.tagName === 'TR') {\n      const icon = document.createElement('div');\n      icon.className = this.options.ghostClass || 'sortable-ghost';\n      icon.textContent = '⋮⋮';\n      icon.style.display = 'inline-flex';\n      icon.style.alignItems = 'center';\n      icon.style.justifyContent = 'center';\n      icon.style.width = '28px';\n      icon.style.height = '28px';\n      icon.style.background = 'rgba(0,0,0,0.65)';\n      icon.style.color = '#fff';\n      icon.style.borderRadius = '6px';\n      icon.style.fontSize = '18px';\n      icon.style.boxShadow = '0 4px 8px rgba(0,0,0,0.25)';\n      icon.style.cursor = 'grabbing';\n\n      const iconHalf = 14; // half of 28px\n      this.state.mouseOffset = {x: iconHalf, y: iconHalf};\n      this.state.lockedX = pageX - iconHalf;\n\n      Object.assign(icon.style, {\n        position: 'absolute',\n        top: (pageY - this.state.mouseOffset.y) + 'px',\n        left: this.state.lockedX + 'px',\n        zIndex: '9999',\n        pointerEvents: 'none',\n        transition: 'none',\n        transform: 'none'\n      });\n\n      document.body.appendChild(icon);\n      this.state.ghost = icon;\n      return;\n    }\n\n    // Default ghost: clone element to preserve original visuals for non-table use cases\n    const rect = dragEl.getBoundingClientRect();\n    const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n    const offsetX = pageX - (rect.left + scrollLeft);\n    const offsetY = pageY - (rect.top + scrollTop);\n\n    const ghost = dragEl.cloneNode(true);\n    ghost.classList.add(this.options.ghostClass || 'sortable-ghost');\n    Object.assign(ghost.style, {\n      position: 'absolute',\n      width: rect.width + 'px',\n      height: rect.height + 'px',\n      left: (pageX - offsetX) + 'px',\n      top: (pageY - offsetY) + 'px',\n      pointerEvents: 'none',\n      opacity: '0.8',\n      zIndex: '9999',\n      transition: 'none',\n      transform: 'none'\n    });\n\n    document.body.appendChild(ghost);\n    this.state.mouseOffset = {x: offsetX, y: offsetY};\n    this.state.lockedX = undefined; // allow free movement for non-table use\n    this.state.ghost = ghost;\n  }\n\n  createPlaceholder(dragEl) {\n    const rect = dragEl.getBoundingClientRect();\n\n    // Special handling for table rows: use a minimal dashed indicator row without altering layout\n    if (dragEl.tagName === 'TR') {\n      const placeholder = document.createElement('tr');\n      placeholder.className = 'sortable-placeholder';\n      placeholder.style.pointerEvents = 'none';\n\n      const td = document.createElement('td');\n      td.colSpan = dragEl.children.length || 1;\n      td.style.padding = '0';\n      td.style.border = 'none';\n      td.style.height = '0';\n      td.style.borderTop = '2px dashed rgba(0,0,0,0.35)';\n\n      placeholder.appendChild(td);\n      dragEl.parentNode.insertBefore(placeholder, dragEl.nextSibling);\n      this.state.placeholder = placeholder;\n      return;\n    }\n\n    const placeholder = document.createElement('div');\n    placeholder.className = 'sortable-placeholder';\n\n    // Copy dimensions from dragged element\n    placeholder.style.height = rect.height + 'px';\n    placeholder.style.width = rect.width + 'px';\n\n    // Insert placeholder in place of dragged element\n    dragEl.parentNode.insertBefore(placeholder, dragEl.nextSibling);\n\n    this.state.placeholder = placeholder;\n  }\n\n  moveGhost(pageX, pageY) {\n    // Capture state needed for animation frame\n    const ghost = this.state.ghost;\n    const mouseOffset = this.state.mouseOffset;\n\n    if (!ghost || !mouseOffset) return;\n\n    requestAnimationFrame(() => {\n      // Re-check if ghost still exists and matches current state\n      // This prevents animating a ghost that has been removed or replaced\n      if (!ghost || ghost !== this.state.ghost) return;\n\n      // pageX/pageY already include scroll, so we just subtract the mouse offset\n      // Lock horizontal movement to initial X to emphasize vertical reordering\n      const lockedX = this.state.lockedX;\n      let left = lockedX !== undefined ? lockedX : (pageX - mouseOffset.x);\n      let top = pageY - mouseOffset.y;\n\n      if (this.options.rtl) {\n        left = window.innerWidth - left - ghost.offsetWidth;\n      }\n\n      Object.assign(ghost.style, {\n        top: top + 'px',\n        left: left + 'px'\n      });\n    });\n  }\n\n  findElementUnderPoint(x, y) {\n    const elements = Array.from(this.element.querySelectorAll(this.options.draggable));\n\n    for (const el of elements) {\n      if (el === this.state.dragging) continue;\n\n      const rect = el.getBoundingClientRect();\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n      const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n      if (x >= rect.left + scrollLeft &&\n        x <= rect.right + scrollLeft &&\n        y >= rect.top + scrollTop &&\n        y <= rect.bottom + scrollTop) {\n        return el;\n      }\n    }\n\n    return null;\n  }\n\n  findTargetContainer(x, y) {\n    // If no group, only check current container\n    if (!this.options.group) {\n      const element = this.findElementUnderPoint(x, y);\n      return element ? {container: this.element, element} : null;\n    }\n\n    // Check all containers in the group\n    const groupContainers = Sortable.groups[this.options.group] || [];\n\n    for (const sortableInstance of groupContainers) {\n      const container = sortableInstance.element;\n      const rect = container.getBoundingClientRect();\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n      const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;\n\n      // Check if point is inside container\n      if (x >= rect.left + scrollLeft &&\n        x <= rect.right + scrollLeft &&\n        y >= rect.top + scrollTop &&\n        y <= rect.bottom + scrollTop) {\n\n        // Find element inside this container\n        const elements = Array.from(container.querySelectorAll(sortableInstance.options.draggable));\n\n        for (const el of elements) {\n          if (el === this.state.dragging) continue;\n\n          const elRect = el.getBoundingClientRect();\n          if (x >= elRect.left + scrollLeft &&\n            x <= elRect.right + scrollLeft &&\n            y >= elRect.top + scrollTop &&\n            y <= elRect.bottom + scrollTop) {\n            return {container, element: el};\n          }\n        }\n\n        // Point is in container but not on any element (empty area)\n        return {container, element: null};\n      }\n    }\n\n    return null;\n  }\n\n  getIndex(el) {\n    return Array.from(this.element.querySelectorAll(this.options.draggable))\n      .indexOf(el);\n  }\n\n  swapElements(el1, el2) {\n    const rect1 = el1.getBoundingClientRect();\n    const rect2 = el2.getBoundingClientRect();\n\n    el1.style.transition = 'none';\n    el2.style.transition = 'none';\n\n    el1.style.transform = `translate(${rect2.left - rect1.left}px, ${rect2.top - rect1.top}px)`;\n    el2.style.transform = `translate(${rect1.left - rect2.left}px, ${rect1.top - rect2.top}px)`;\n\n    requestAnimationFrame(() => {\n      el1.style.transform = '';\n      el2.style.transform = '';\n\n      el1.style.transition = '';\n      el2.style.transition = '';\n\n      const next2 = el2.nextSibling;\n      const parent2 = el2.parentNode;\n\n      el1.parentNode.insertBefore(el2, el1);\n      parent2.insertBefore(el1, next2);\n    });\n  }\n\n  moveElement(el, direction) {\n    const elements = Array.from(this.element.querySelectorAll(this.options.draggable));\n    const index = elements.indexOf(el);\n    const newIndex = index + direction;\n\n    if (newIndex >= 0 && newIndex < elements.length) {\n      const target = elements[newIndex];\n      this.swapElements(el, target);\n\n      el.focus();\n\n      this.dispatchEvent('change', {\n        item: el,\n        newIndex,\n        oldIndex: index\n      });\n    }\n  }\n\n  toggleSelection(el) {\n    el.classList.toggle('selected');\n\n    this.dispatchEvent('select', {\n      item: el,\n      selected: el.classList.contains('selected')\n    });\n  }\n\n  dispatchEvent(name, detail) {\n    this.element.dispatchEvent(new CustomEvent('sortable:' + name, {\n      bubbles: true,\n      cancelable: true,\n      detail\n    }));\n  }\n\n  /**\n   * Auto-save position using declarative API configuration\n   *\n   * This method is called automatically when an item is dropped in a different container\n   * and API integration is enabled via data-sortable-api attribute.\n   *\n   * @param {HTMLElement} draggedItem - The item that was dragged\n   * @param {HTMLElement} targetContainer - The container where item was dropped\n   *\n   * @example\n   * // HTML setup for API integration\n   * <div data-component=\"sortable\"\n   *      data-sortable-api=\"/api/items/update\"\n   *      data-sortable-id-attr=\"data-id\"\n   *      data-sortable-stage-attr=\"data-status\"\n   *      data-sortable-update-field=\"status\">\n   *   <!-- Items will auto-save when moved -->\n   * </div>\n   */\n  async autoSavePosition(draggedItem, targetContainer) {\n    try {\n      // Extract item ID\n      const itemId = draggedItem.getAttribute(this.options.apiIdAttr);\n      if (!itemId) {\n        console.warn('Sortable: No ID found on dragged item', this.options.apiIdAttr);\n        return;\n      }\n\n      // Extract new value (e.g., stage) from target container\n      const newValue = targetContainer.getAttribute(this.options.apiStageAttr);\n      if (!newValue) {\n        console.warn('Sortable: No value found on target container', this.options.apiStageAttr);\n        return;\n      }\n\n      // Build request payload\n      const payload = {\n        id: itemId,\n        [this.options.apiUpdateField]: newValue,\n        update_stage_only: true, // Flag for minimal update\n        ...(this.options.apiExtraData || {})\n      };\n\n      // Use http client which handles CSRF token and auth headers automatically\n      const resp = await window.http.post(this.options.apiEndpoint, payload);\n\n      // Extract response data (handle nested structure)\n      const responseData = resp?.data?.data ?? resp?.data ?? resp;\n\n      // Handle 401 Unauthorized\n      if (resp?.status === 401) {\n        console.warn('Sortable: Unauthorized (401)');\n        if (window.AuthErrorHandler) {\n          const error = new Error(resp.statusText || 'Unauthorized');\n          error.status = 401;\n          error.response = resp;\n          await AuthErrorHandler.handleError(error, {\n            currentPath: window.location.pathname\n          });\n        }\n        return;\n      }\n\n      // Handle 403 Forbidden\n      if (resp?.status === 403) {\n        if (window.NotificationManager) {\n          NotificationManager.error(responseData?.message || 'Access forbidden');\n        }\n        this.dispatchEvent('api-error', {\n          item: draggedItem,\n          error: {message: responseData?.message || 'Access forbidden', status: 403}\n        });\n        return;\n      }\n\n      // Use ResponseHandler to process API response (consistent with TableManager/FormManager)\n      if (window.ResponseHandler && responseData) {\n        await ResponseHandler.process(responseData, {\n          data: responseData,\n          reload: null // Sortable doesn't need reload\n        });\n      }\n\n      // Dispatch success event\n      if (responseData?.success !== false) {\n        this.dispatchEvent('api-success', {\n          item: draggedItem,\n          response: responseData,\n          payload: payload\n        });\n      } else {\n        throw new Error(responseData?.message || 'API request failed');\n      }\n\n    } catch (error) {\n      console.error('Sortable: Auto-save failed', error);\n\n      // Show error notification if NotificationManager available\n      if (window.NotificationManager) {\n        NotificationManager.error(error.message || 'Status update failed');\n      }\n\n      // Dispatch error event\n      this.dispatchEvent('api-error', {\n        item: draggedItem,\n        error: error\n      });\n\n      // Optionally handle with ErrorManager\n      if (window.ErrorManager) {\n        ErrorManager.handle(error, {\n          context: 'Sortable.autoSavePosition',\n          type: 'error:api'\n        });\n      }\n    }\n  }\n\n  enable() {\n    this.options.disabled = false;\n  }\n\n  disable() {\n    this.options.disabled = true;\n\n    if (this.state.dragging) {\n      this.handleDragEnd();\n    }\n  }\n\n  destroy() {\n    this.element.removeEventListener('mousedown', this.handlers.dragStart);\n    this.element.removeEventListener('touchstart', this.handlers.dragStart);\n    this.element.removeEventListener('keydown', this.handlers.keyDown);\n\n    if (this.options.scroll) {\n      window.removeEventListener('scroll', this.handleScroll);\n    }\n\n    // Remove from group\n    if (this.options.group && Sortable.groups[this.options.group]) {\n      const index = Sortable.groups[this.options.group].indexOf(this);\n      if (index > -1) {\n        Sortable.groups[this.options.group].splice(index, 1);\n      }\n    }\n\n    this.state = {\n      dragging: null,\n      ghost: null,\n      placeholder: null,\n      initialIndex: -1,\n      scrollInterval: null,\n      dragStartEvent: null,\n      sourceContainer: null\n    };\n\n    this.element = null;\n    this.options = null;\n    this.handlers = null;\n  }\n}\n\n// Static property for groups\nSortable.groups = {};\n\n// Component state for managing instances\nSortable.state = {\n  instances: new Map(),\n  initialized: false,\n  observer: null\n};\n\n/**\n * Initialize Sortable component - scan DOM and create instances\n * @param {Object} options - Global configuration options\n */\nSortable.init = function(options = {}) {\n  if (this.state.initialized) return;\n\n  // Initialize all existing sortable elements\n  this.initElements();\n\n  // Set up MutationObserver to auto-initialize new sortable elements\n  this.setupGlobalObserver();\n\n  this.state.initialized = true;\n};\n\n/**\n * Set up global MutationObserver to watch for new sortable elements\n * This automatically initializes Sortable on dynamically added elements\n */\nSortable.setupGlobalObserver = function() {\n  // Don't set up multiple observers\n  if (this.state.observer) return;\n\n  this.state.observer = new MutationObserver((mutations) => {\n    let hasNewSortables = false;\n\n    mutations.forEach((mutation) => {\n      mutation.addedNodes.forEach((node) => {\n        if (node.nodeType !== 1) return; // Only element nodes\n\n        // Check if the added node is a sortable container\n        if (node.matches && node.matches('[data-component=\"sortable\"]')) {\n          hasNewSortables = true;\n        }\n        // Check if the added node contains sortable containers\n        else if (node.querySelectorAll) {\n          const sortables = node.querySelectorAll('[data-component=\"sortable\"]');\n          if (sortables.length > 0) {\n            hasNewSortables = true;\n          }\n        }\n      });\n    });\n\n    // Initialize new sortable containers\n    if (hasNewSortables) {\n      // Small delay to ensure DOM is stable\n      setTimeout(() => {\n        this.initElements();\n      }, 50);\n    }\n  });\n\n  // Observe the entire document for changes\n  this.state.observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n};\n\n/**\n * Initialize all elements with data-component=\"sortable\"\n */\nSortable.initElements = function() {\n  const elements = document.querySelectorAll('[data-component=\"sortable\"]');\n\n  elements.forEach(element => {\n    if (!this.state.instances.has(element)) {\n      this.create(element);\n    }\n  });\n};\n\n/**\n * Create a new Sortable instance\n * @param {HTMLElement} element - The sortable container element\n * @param {Object} options - Instance-specific options\n * @returns {Sortable} The sortable instance\n */\nSortable.create = function(element, options = {}) {\n  if (!element) {\n    console.error('[Sortable] Element is required');\n    return null;\n  }\n\n  // Check if already initialized\n  if (this.state.instances.has(element)) {\n    return this.state.instances.get(element);\n  }\n\n  // Extract options from data attributes\n  const dataOptions = {\n    group: element.dataset.group,\n    animation: parseInt(element.dataset.animation) || 150,\n    draggable: element.dataset.draggable || '[draggable=\"true\"]',\n    handle: element.dataset.handle,\n    ghostClass: element.dataset.ghostClass || 'sortable-ghost',\n    chosenClass: element.dataset.chosenClass || 'sortable-chosen',\n    dragClass: element.dataset.dragClass || 'sortable-drag',\n    disabled: element.dataset.disabled === 'true',\n\n    // API options\n    apiUrl: element.dataset.apiUrl,\n    apiMethod: element.dataset.apiMethod || 'POST',\n    apiIdAttr: element.dataset.sortableIdAttr || 'data-id',\n    apiStageAttr: element.dataset.sortableStageAttr || 'data-category',\n    apiUpdateField: element.dataset.sortableUpdateField || 'category'\n  };\n\n  // Merge options: data attributes override passed options\n  const mergedOptions = {...options, ...dataOptions};\n\n  // Create new Sortable instance\n  const instance = new Sortable(element, mergedOptions);\n\n  // Store instance\n  this.state.instances.set(element, instance);\n  element._sortableInstance = instance;\n\n  return instance;\n};\n\n/**\n * Get instance from element\n * @param {HTMLElement} element - The sortable container element\n * @returns {Sortable|null} The sortable instance or null\n */\nSortable.getInstance = function(element) {\n  return this.state.instances.get(element) || null;\n};\n\n/**\n * Destroy all instances\n */\nSortable.destroyAll = function() {\n  this.state.instances.forEach((instance, element) => {\n    instance.destroy();\n  });\n  this.state.instances.clear();\n  this.state.initialized = false;\n};\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    Sortable.init();\n  });\n} else {\n  // DOM already loaded, initialize immediately\n  Sortable.init();\n}\n\n// Expose globally\nwindow.Sortable = Sortable;\n","/**\n * TabsComponent - Production-ready tabs component for Now.js\n *\n * Features:\n * - Automatic initialization via data-component=\"tabs\"\n * - Full ARIA accessibility support\n * - Keyboard navigation (Arrow keys, Home, End)\n * - Configurable through data attributes\n * - Event callbacks for lifecycle hooks\n * - Animation support\n * - Dynamic tab management\n * - URL hash navigation (deep linking, back/forward support)\n *\n * @example\n * // HTML Usage\n * <div data-component=\"tabs\" data-default-tab=\"tab2\">\n *   <div class=\"tab-buttons\" role=\"tablist\">\n *     <button class=\"tab-button\" data-tab=\"tab1\" role=\"tab\">Tab 1</button>\n *     <button class=\"tab-button\" data-tab=\"tab2\" role=\"tab\">Tab 2</button>\n *   </div>\n *   <div class=\"tab-content\">\n *     <div class=\"tab-pane\" data-tab=\"tab1\" role=\"tabpanel\">Content 1</div>\n *     <div class=\"tab-pane\" data-tab=\"tab2\" role=\"tabpanel\">Content 2</div>\n *   </div>\n * </div>\n *\n * @example\n * // JavaScript API\n * const tabs = TabsComponent.create(element, {\n *   defaultTab: 'tab2',\n *   keyboard: true,\n *   onTabChange: (tabId) => console.log('Changed to:', tabId)\n * });\n */\nconst TabsComponent = {\n  /**\n   * Default configuration options\n   */\n  config: {\n    // Basic settings\n    defaultTab: null,        // Default active tab (null = first tab)\n    keyboard: true,          // Enable keyboard navigation\n    animation: true,         // Enable transition animations\n    animationDuration: 300,  // Animation duration in ms\n\n    // Selectors (customizable for different CSS styles)\n    buttonSelector: '.tab-button',  // Selector for tab buttons\n    panelSelector: '.tab-pane',     // Selector for tab panels\n\n    // Behavior\n    hash: true,             // Sync active tab with URL hash\n    hashPrefix: '',          // Prefix for hash (e.g., 'tab-' for #tab-settings)\n    destroyOnHidden: false,  // Destroy instance when element is removed\n    lazy: false,             // Lazy load tab content\n\n    // Accessibility\n    ariaLabel: 'Tabs',       // ARIA label for tablist\n\n    // Event callbacks\n    onInit: null,            // Called when initialized\n    onTabChange: null,       // Called when tab changes (after)\n    beforeTabChange: null,   // Called before tab changes (can cancel)\n    onDestroy: null,         // Called when destroyed\n\n    // Advanced\n    orientation: 'horizontal', // 'horizontal' or 'vertical'\n\n    // Debug\n    debug: false\n  },\n\n  /**\n   * Component state\n   */\n  state: {\n    instances: new Map(),    // All tab instances\n    initialized: false,      // Whether component is initialized\n    observer: null           // MutationObserver for dynamic tabs\n  },\n\n  /**\n   * Initialize the TabsComponent\n   * @param {Object} options - Global configuration options\n   */\n  init(options = {}) {\n    if (this.state.initialized) {\n      if (this.config.debug) console.warn('TabsComponent already initialized');\n      return;\n    }\n\n    // Merge options with defaults\n    Object.assign(this.config, options);\n\n    // Initialize existing elements\n    this.initElements();\n\n    // Setup MutationObserver for dynamically added tabs\n    this.setupObserver();\n\n    this.state.initialized = true;\n  },\n\n  /**\n   * Initialize all elements with data-component=\"tabs\"\n   */\n  initElements() {\n    document.querySelectorAll('[data-component=\"tabs\"]').forEach(element => {\n      if (!this.state.instances.has(element)) {\n        this.create(element);\n      }\n    });\n  },\n\n  /**\n   * Create a new tabs instance\n   * @param {HTMLElement} element - The tabs container element\n   * @param {Object} options - Instance-specific options\n   * @returns {Object} The tabs instance\n   */\n  create(element, options = {}) {\n    if (!element) {\n      console.error('TabsComponent.create: element is required');\n      return null;\n    }\n\n    // Check if already initialized\n    if (this.state.instances.has(element)) {\n      if (this.config.debug) console.warn('Tabs already initialized on element:', element);\n      return this.state.instances.get(element);\n    }\n\n    // Extract options from data attributes\n    const dataOptions = this.extractOptionsFromElement(element);\n\n    // Merge options: defaults < data attributes < passed options\n    const instanceConfig = {\n      ...this.config,\n      ...dataOptions,\n      ...options\n    };\n\n    // Find tab buttons and panels using configurable selectors\n    const buttonSelector = instanceConfig.buttonSelector;\n    const panelSelector = instanceConfig.panelSelector;\n    const buttons = element.querySelectorAll(buttonSelector);\n    const panels = element.querySelectorAll(panelSelector);\n\n    if (buttons.length === 0) {\n      console.error(`TabsComponent: No tab buttons found (${buttonSelector})`);\n      return null;\n    }\n\n    if (panels.length === 0) {\n      console.error(`TabsComponent: No tab panels found (${panelSelector})`);\n      return null;\n    }\n\n    // Create instance\n    const instance = {\n      element,\n      config: instanceConfig,\n      buttons: Array.from(buttons),\n      panels: Array.from(panels),\n      activeTab: null,\n      tabIds: [],\n      destroyed: false\n    };\n\n    // Setup the instance\n    this.setup(instance);\n\n    // Store instance\n    this.state.instances.set(element, instance);\n\n    // Call onInit callback\n    if (typeof instance.config.onInit === 'function') {\n      instance.config.onInit.call(instance);\n    }\n\n    return instance;\n  },\n\n  /**\n   * Setup a tabs instance\n   * @param {Object} instance - The tabs instance\n   */\n  setup(instance) {\n    // Extract tab IDs\n    instance.tabIds = instance.buttons.map(btn => btn.dataset.tab).filter(Boolean);\n\n    if (instance.tabIds.length === 0) {\n      console.error('TabsComponent: No valid tab IDs found (data-tab attribute)');\n      return;\n    }\n\n    // Setup ARIA attributes\n    this.setupAccessibility(instance);\n\n    // Setup event handlers\n    this.setupEventHandlers(instance);\n\n    // Setup hash navigation if enabled\n    if (instance.config.hash) {\n      this.setupHashNavigation(instance);\n    }\n\n    // Determine initial active tab\n    let initialTab = this.getInitialTab(instance);\n\n    // Activate initial tab\n    this.switchTab(instance, initialTab, true);\n\n    // Add public methods to instance\n    instance.switchTab = (tabId) => this.switchTab(instance, tabId);\n    instance.getActiveTab = () => instance.activeTab;\n    instance.destroy = () => this.destroy(instance);\n    instance.refresh = () => this.refresh(instance);\n  },\n\n  /**\n   * Setup accessibility (ARIA) attributes\n   * @param {Object} instance - The tabs instance\n   */\n  setupAccessibility(instance) {\n    const {element, buttons, panels, config} = instance;\n\n    // Find or create tablist container\n    let tablist = element.querySelector('[role=\"tablist\"]');\n    if (!tablist) {\n      tablist = buttons[0].parentElement;\n      tablist.setAttribute('role', 'tablist');\n    }\n\n    // Set orientation\n    tablist.setAttribute('aria-orientation', config.orientation);\n\n    if (config.ariaLabel) {\n      tablist.setAttribute('aria-label', config.ariaLabel);\n    }\n\n    // Setup each tab button\n    buttons.forEach((button, index) => {\n      const tabId = button.dataset.tab;\n      const panel = panels.find(p => p.dataset.tab === tabId);\n\n      if (!panel) {\n        console.warn(`TabsComponent: No panel found for tab \"${tabId}\"`);\n        return;\n      }\n\n      // Generate unique IDs if not present\n      const buttonId = button.id || `tab-${tabId}-${Date.now()}-${index}`;\n      const panelId = panel.id || `panel-${tabId}-${Date.now()}-${index}`;\n\n      button.id = buttonId;\n      panel.id = panelId;\n\n      // Set ARIA attributes on button\n      button.setAttribute('role', 'tab');\n      button.setAttribute('aria-controls', panelId);\n      button.setAttribute('aria-selected', 'false');\n      button.setAttribute('tabindex', '-1');\n\n      // Set ARIA attributes on panel\n      panel.setAttribute('role', 'tabpanel');\n      panel.setAttribute('aria-labelledby', buttonId);\n      panel.setAttribute('tabindex', '0');\n      panel.hidden = true;\n    });\n  },\n\n  /**\n   * Setup event handlers\n   * @param {Object} instance - The tabs instance\n   */\n  setupEventHandlers(instance) {\n    const {buttons, config} = instance;\n\n    buttons.forEach(button => {\n      // Click handler\n      button.addEventListener('click', (e) => {\n        e.preventDefault();\n        const tabId = button.dataset.tab;\n        this.switchTab(instance, tabId);\n      });\n\n      // Keyboard navigation\n      if (config.keyboard) {\n        button.addEventListener('keydown', (e) => {\n          this.handleKeydown(instance, e, button);\n        });\n      }\n    });\n  },\n\n  /**\n   * Handle keyboard navigation\n   * @param {Object} instance - The tabs instance\n   * @param {KeyboardEvent} event - The keyboard event\n   * @param {HTMLElement} currentButton - Current focused button\n   */\n  handleKeydown(instance, event, currentButton) {\n    const {buttons, config} = instance;\n    const currentIndex = buttons.indexOf(currentButton);\n    let targetIndex = currentIndex;\n\n    const isHorizontal = config.orientation === 'horizontal';\n\n    switch (event.key) {\n      case 'ArrowLeft':\n      case 'ArrowUp':\n        event.preventDefault();\n        targetIndex = currentIndex > 0 ? currentIndex - 1 : buttons.length - 1;\n        break;\n\n      case 'ArrowRight':\n      case 'ArrowDown':\n        event.preventDefault();\n        targetIndex = currentIndex < buttons.length - 1 ? currentIndex + 1 : 0;\n        break;\n\n      case 'Home':\n        event.preventDefault();\n        targetIndex = 0;\n        break;\n\n      case 'End':\n        event.preventDefault();\n        targetIndex = buttons.length - 1;\n        break;\n\n      default:\n        return; // Don't handle other keys\n    }\n\n    // Switch to target tab and focus\n    const targetButton = buttons[targetIndex];\n    const tabId = targetButton.dataset.tab;\n    this.switchTab(instance, tabId);\n    targetButton.focus();\n  },\n\n  /**\n   * Switch to a specific tab\n   * @param {Object} instance - The tabs instance\n   * @param {string} tabId - The tab ID to switch to\n   * @param {boolean} initial - Whether this is the initial activation\n   * @returns {boolean} Whether the switch was successful\n   */\n  switchTab(instance, tabId, initial = false) {\n    if (instance.destroyed) {\n      console.warn('TabsComponent: Cannot switch tab on destroyed instance');\n      return false;\n    }\n\n    // Check if tab exists\n    if (!instance.tabIds.includes(tabId)) {\n      console.error(`TabsComponent: Tab \"${tabId}\" not found`);\n      return false;\n    }\n\n    // Don't switch if already active (unless initial)\n    if (!initial && instance.activeTab === tabId) {\n      return false;\n    }\n\n    // Call beforeTabChange callback (can cancel)\n    if (!initial && typeof instance.config.beforeTabChange === 'function') {\n      const result = instance.config.beforeTabChange.call(instance, tabId, instance.activeTab);\n      if (result === false) return false;\n    }\n\n    const previousTab = instance.activeTab;\n\n    // Deactivate all tabs\n    instance.buttons.forEach(button => {\n      button.classList.remove('active');\n      button.setAttribute('aria-selected', 'false');\n      button.setAttribute('tabindex', '-1');\n    });\n\n    instance.panels.forEach(panel => {\n      panel.classList.remove('active');\n      panel.hidden = true;\n    });\n\n    // Activate target tab\n    const targetButton = instance.buttons.find(btn => btn.dataset.tab === tabId);\n    const targetPanel = instance.panels.find(panel => panel.dataset.tab === tabId);\n\n    if (targetButton && targetPanel) {\n      targetButton.classList.add('active');\n      targetButton.setAttribute('aria-selected', 'true');\n      targetButton.setAttribute('tabindex', '0');\n\n      targetPanel.classList.add('active');\n      targetPanel.hidden = false;\n\n      instance.activeTab = tabId;\n\n      // Update URL hash if enabled\n      if (!initial && instance.config.hash) {\n        this.updateHash(instance, tabId);\n      }\n\n      // Dispatch custom event\n      this.dispatchEvent(instance, 'tabchange', {\n        tabId,\n        previousTab,\n        button: targetButton,\n        panel: targetPanel\n      });\n\n      // Call onTabChange callback\n      if (!initial && typeof instance.config.onTabChange === 'function') {\n        instance.config.onTabChange.call(instance, tabId, previousTab);\n      }\n\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Refresh the tabs instance (re-scan buttons and panels)\n   * @param {Object} instance - The tabs instance\n   */\n  refresh(instance) {\n    if (instance.destroyed) return;\n\n    // Re-query buttons and panels using instance config selectors\n    const buttonSelector = instance.config.buttonSelector;\n    const panelSelector = instance.config.panelSelector;\n    instance.buttons = Array.from(instance.element.querySelectorAll(buttonSelector));\n    instance.panels = Array.from(instance.element.querySelectorAll(panelSelector));\n    instance.tabIds = instance.buttons.map(btn => btn.dataset.tab).filter(Boolean);\n\n    // Re-setup\n    this.setupAccessibility(instance);\n    this.setupEventHandlers(instance);\n  },\n\n  /**\n   * Destroy a tabs instance\n   * @param {Object} instance - The tabs instance\n   */\n  destroy(instance) {\n    if (instance.destroyed) return;\n\n    // Remove hash navigation event listeners\n    if (instance._hashHandler) {\n      window.removeEventListener('popstate', instance._hashHandler);\n      window.removeEventListener('hashchange', instance._hashHandler);\n      delete instance._hashHandler;\n    }\n\n    // Clean up ARIA attributes\n    instance.buttons.forEach(button => {\n      button.removeAttribute('role');\n      button.removeAttribute('aria-controls');\n      button.removeAttribute('aria-selected');\n      button.removeAttribute('tabindex');\n    });\n\n    instance.panels.forEach(panel => {\n      panel.removeAttribute('role');\n      panel.removeAttribute('aria-labelledby');\n      panel.removeAttribute('tabindex');\n      panel.hidden = false;\n    });\n\n    // Call onDestroy callback\n    if (typeof instance.config.onDestroy === 'function') {\n      instance.config.onDestroy.call(instance);\n    }\n\n    // Remove from instances map\n    this.state.instances.delete(instance.element);\n\n    // Mark as destroyed\n    instance.destroyed = true;\n  },\n\n  /**\n   * Setup MutationObserver for dynamically added tabs\n   */\n  setupObserver() {\n    if (this.state.observer) return;\n\n    this.state.observer = new MutationObserver((mutations) => {\n      mutations.forEach(mutation => {\n        mutation.addedNodes.forEach(node => {\n          if (node.nodeType === 1) { // Element node\n            // Check if the node itself is a tabs component\n            if (node.matches && node.matches('[data-component=\"tabs\"]')) {\n              this.create(node);\n            }\n            // Check for tabs components within the added node\n            if (node.querySelectorAll) {\n              node.querySelectorAll('[data-component=\"tabs\"]').forEach(element => {\n                this.create(element);\n              });\n            }\n          }\n        });\n\n        // Handle removed nodes\n        mutation.removedNodes.forEach(node => {\n          if (node.nodeType === 1) {\n            const instance = this.state.instances.get(node);\n            if (instance && instance.config.destroyOnHidden) {\n              // Wait for DOM operations to settle before cleanup\n              // This prevents premature cleanup when nodes are moved in DOM\n              setTimeout(() => {\n                if (!node.isConnected) {\n                  this.destroy(instance);\n                }\n              }, 0);\n            }\n          }\n        });\n      });\n    });\n\n    this.state.observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n  },\n\n  /**\n   * Extract configuration options from element's data attributes\n   * @param {HTMLElement} element - The element to extract options from\n   * @returns {Object} Extracted options\n   */\n  extractOptionsFromElement(element) {\n    const options = {};\n\n    // String options\n    if (element.dataset.defaultTab) options.defaultTab = element.dataset.defaultTab;\n    if (element.dataset.orientation) options.orientation = element.dataset.orientation;\n    if (element.dataset.ariaLabel) options.ariaLabel = element.dataset.ariaLabel;\n\n    // Boolean options\n    if (element.dataset.keyboard !== undefined) {\n      options.keyboard = element.dataset.keyboard !== 'false';\n    }\n    if (element.dataset.animation !== undefined) {\n      options.animation = element.dataset.animation !== 'false';\n    }\n    if (element.dataset.hash !== undefined) {\n      options.hash = element.dataset.hash === 'true';\n    }\n    if (element.dataset.lazy !== undefined) {\n      options.lazy = element.dataset.lazy === 'true';\n    }\n    if (element.dataset.debug !== undefined) {\n      options.debug = element.dataset.debug === 'true';\n    }\n\n    // String options from data attributes\n    if (element.dataset.hashPrefix) options.hashPrefix = element.dataset.hashPrefix;\n\n    // Selector options\n    if (element.dataset.buttonSelector) options.buttonSelector = element.dataset.buttonSelector;\n    if (element.dataset.panelSelector) options.panelSelector = element.dataset.panelSelector;\n\n    // Number options\n    if (element.dataset.animationDuration) {\n      options.animationDuration = parseInt(element.dataset.animationDuration, 10);\n    }\n\n    return options;\n  },\n\n  /**\n   * Get instance from element\n   * @param {HTMLElement} element - The tabs container element\n   * @returns {Object|null} The tabs instance or null\n   */\n  getInstance(element) {\n    return this.state.instances.get(element) || null;\n  },\n\n  /**\n   * Dispatch custom event\n   * @param {Object} instance - The tabs instance\n   * @param {string} eventName - Event name\n   * @param {Object} detail - Event detail data\n   */\n  dispatchEvent(instance, eventName, detail = {}) {\n    const event = new CustomEvent(`tabs:${eventName}`, {\n      detail: {\n        instance,\n        ...detail\n      },\n      bubbles: true,\n      cancelable: true\n    });\n\n    instance.element.dispatchEvent(event);\n  },\n\n  /**\n   * Get initial tab based on URL hash or default configuration\n   * @param {Object} instance - The tabs instance\n   * @returns {string} The initial tab ID\n   */\n  getInitialTab(instance) {\n    const {config, tabIds} = instance;\n    let initialTab = config.defaultTab || tabIds[0];\n\n    // Check URL hash if hash navigation is enabled\n    if (config.hash) {\n      const hashTab = this.getTabFromHash(instance);\n      if (hashTab && tabIds.includes(hashTab)) {\n        initialTab = hashTab;\n      }\n    }\n\n    // Validate tab exists\n    if (!tabIds.includes(initialTab)) {\n      if (config.debug) {\n        console.warn(`TabsComponent: Tab \"${initialTab}\" not found, using first tab`);\n      }\n      initialTab = tabIds[0];\n    }\n\n    return initialTab;\n  },\n\n  /**\n   * Extract tab ID from URL hash\n   * @param {Object} instance - The tabs instance\n   * @returns {string|null} The tab ID or null\n   */\n  getTabFromHash(instance) {\n    const hash = window.location.hash.slice(1); // Remove #\n    if (!hash) return null;\n\n    const prefix = instance.config.hashPrefix || '';\n    if (prefix && hash.startsWith(prefix)) {\n      return hash.slice(prefix.length);\n    }\n\n    return prefix ? null : hash;\n  },\n\n  /**\n   * Update URL hash when tab changes\n   * @param {Object} instance - The tabs instance\n   * @param {string} tabId - The new tab ID\n   */\n  updateHash(instance, tabId) {\n    const prefix = instance.config.hashPrefix || '';\n    const newHash = `#${prefix}${tabId}`;\n\n    // Use replaceState to avoid creating history entry for every tab click\n    // Use pushState only if hash actually changed (for back button support)\n    if (window.location.hash !== newHash) {\n      history.pushState({tabId, component: 'tabs'}, '', newHash);\n    }\n  },\n\n  /**\n   * Setup hash navigation listeners\n   * @param {Object} instance - The tabs instance\n   */\n  setupHashNavigation(instance) {\n    // Store handler reference for cleanup\n    instance._hashHandler = () => {\n      const tabId = this.getTabFromHash(instance);\n      if (tabId && instance.tabIds.includes(tabId) && instance.activeTab !== tabId) {\n        this.switchTab(instance, tabId);\n      }\n    };\n\n    // Listen to popstate for back/forward button\n    window.addEventListener('popstate', instance._hashHandler);\n\n    // Also listen to hashchange for direct URL changes\n    window.addEventListener('hashchange', instance._hashHandler);\n\n    // Update hash on initial load if not already set\n    if (instance.config.hash && !window.location.hash) {\n      const initialTab = this.getInitialTab(instance);\n      if (initialTab) {\n        // Use replaceState to set initial hash without creating history entry\n        const prefix = instance.config.hashPrefix || '';\n        history.replaceState({tabId: initialTab, component: 'tabs'}, '', `#${prefix}${initialTab}`);\n      }\n    }\n  }\n};\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    TabsComponent.init();\n  });\n} else {\n  TabsComponent.init();\n}\n\n// Expose globally\nwindow.TabsComponent = TabsComponent;\n","/**\n * Animation Management System\n * Handles CSS animations and transitions with JavaScript control\n *\n * Features:\n * - Predefined animations (fade, slide, scale etc)\n * - Custom animation support\n * - Animation queueing and chaining\n * - Stagger animations for lists\n * - Parallel animations\n * - Pause/Resume support\n * - Performance optimization\n * - Cross-browser compatibility\n * - Cleanup and memory management\n */\nconst AnimationManager = {\n  /**\n   * Configuration\n   */\n  config: {\n    debug: false,\n    defaultDuration: 300,\n    defaultEasing: 'ease',\n    // Default animations\n    animations: {\n      fade: {\n        in: {\n          from: {opacity: 0},\n          to: {opacity: 1}\n        },\n        out: {\n          from: {opacity: 1},\n          to: {opacity: 0}\n        }\n      },\n      // Aliases for common naming conventions\n      'fade-up': {\n        in: {\n          from: {transform: 'translateY(20px)', opacity: 0},\n          to: {transform: 'translateY(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateY(0)', opacity: 1},\n          to: {transform: 'translateY(-20px)', opacity: 0}\n        }\n      },\n      'fade-down': {\n        in: {\n          from: {transform: 'translateY(-20px)', opacity: 0},\n          to: {transform: 'translateY(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateY(0)', opacity: 1},\n          to: {transform: 'translateY(20px)', opacity: 0}\n        }\n      },\n      'fade-left': {\n        in: {\n          from: {transform: 'translateX(20px)', opacity: 0},\n          to: {transform: 'translateX(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateX(0)', opacity: 1},\n          to: {transform: 'translateX(20px)', opacity: 0}\n        }\n      },\n      'fade-right': {\n        in: {\n          from: {transform: 'translateX(-20px)', opacity: 0},\n          to: {transform: 'translateX(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateX(0)', opacity: 1},\n          to: {transform: 'translateX(-20px)', opacity: 0}\n        }\n      },\n      slideUp: {\n        in: {\n          from: {transform: 'translateY(20px)', opacity: 0},\n          to: {transform: 'translateY(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateY(0)', opacity: 1},\n          to: {transform: 'translateY(-20px)', opacity: 0}\n        }\n      },\n      slideDown: {\n        in: {\n          from: {transform: 'translateY(-20px)', opacity: 0},\n          to: {transform: 'translateY(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateY(0)', opacity: 1},\n          to: {transform: 'translateY(20px)', opacity: 0}\n        }\n      },\n      slideLeft: {\n        in: {\n          from: {transform: 'translateX(-20px)', opacity: 0},\n          to: {transform: 'translateX(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateX(0)', opacity: 1},\n          to: {transform: 'translateX(-20px)', opacity: 0}\n        }\n      },\n      slideRight: {\n        in: {\n          from: {transform: 'translateX(20px)', opacity: 0},\n          to: {transform: 'translateX(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'translateX(0)', opacity: 1},\n          to: {transform: 'translateX(20px)', opacity: 0}\n        }\n      },\n      scale: {\n        in: {\n          from: {transform: 'scale(0.95)', opacity: 0},\n          to: {transform: 'scale(1)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'scale(1)', opacity: 1},\n          to: {transform: 'scale(0.95)', opacity: 0}\n        }\n      },\n      scaleUp: {\n        in: {\n          from: {transform: 'scale(0.5)', opacity: 0},\n          to: {transform: 'scale(1)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'scale(1)', opacity: 1},\n          to: {transform: 'scale(1.5)', opacity: 0}\n        }\n      },\n      rotate: {\n        in: {\n          from: {transform: 'rotate(-180deg)', opacity: 0},\n          to: {transform: 'rotate(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'rotate(0)', opacity: 1},\n          to: {transform: 'rotate(180deg)', opacity: 0}\n        }\n      },\n      bounce: {\n        in: {\n          from: {transform: 'scale(0.3)', opacity: 0},\n          steps: [\n            {transform: 'scale(1.05)', opacity: 0.8, offset: 0.5},\n            {transform: 'scale(0.95)', opacity: 0.9, offset: 0.7},\n            {transform: 'scale(1.02)', opacity: 1, offset: 0.85}\n          ],\n          to: {transform: 'scale(1)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'scale(1)', opacity: 1},\n          steps: [\n            {transform: 'scale(1.05)', opacity: 0.9, offset: 0.2},\n            {transform: 'scale(0.95)', opacity: 0.7, offset: 0.5}\n          ],\n          to: {transform: 'scale(0.3)', opacity: 0}\n        }\n      },\n      shake: {\n        in: {\n          from: {transform: 'translateX(-10px)'},\n          steps: [\n            {transform: 'translateX(10px)', offset: 0.2},\n            {transform: 'translateX(-10px)', offset: 0.4},\n            {transform: 'translateX(10px)', offset: 0.6},\n            {transform: 'translateX(-5px)', offset: 0.8}\n          ],\n          to: {transform: 'translateX(0)'}\n        },\n        out: {\n          from: {transform: 'translateX(0)'},\n          steps: [\n            {transform: 'translateX(-10px)', offset: 0.2},\n            {transform: 'translateX(10px)', offset: 0.4},\n            {transform: 'translateX(-10px)', offset: 0.6},\n            {transform: 'translateX(5px)', offset: 0.8}\n          ],\n          to: {transform: 'translateX(0)', opacity: 0}\n        }\n      },\n      pulse: {\n        in: {\n          from: {transform: 'scale(1)', opacity: 1},\n          steps: [\n            {transform: 'scale(1.05)', opacity: 1, offset: 0.5}\n          ],\n          to: {transform: 'scale(1)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'scale(1)', opacity: 1},\n          steps: [\n            {transform: 'scale(1.1)', opacity: 0.8, offset: 0.5}\n          ],\n          to: {transform: 'scale(1)', opacity: 0}\n        }\n      },\n      flip: {\n        in: {\n          from: {transform: 'perspective(400px) rotateY(90deg)', opacity: 0},\n          to: {transform: 'perspective(400px) rotateY(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'perspective(400px) rotateY(0)', opacity: 1},\n          to: {transform: 'perspective(400px) rotateY(90deg)', opacity: 0}\n        }\n      },\n      flipX: {\n        in: {\n          from: {transform: 'perspective(400px) rotateX(90deg)', opacity: 0},\n          to: {transform: 'perspective(400px) rotateX(0)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'perspective(400px) rotateX(0)', opacity: 1},\n          to: {transform: 'perspective(400px) rotateX(90deg)', opacity: 0}\n        }\n      },\n      zoomIn: {\n        in: {\n          from: {transform: 'scale(0)', opacity: 0},\n          to: {transform: 'scale(1)', opacity: 1}\n        },\n        out: {\n          from: {transform: 'scale(1)', opacity: 1},\n          to: {transform: 'scale(0)', opacity: 0}\n        }\n      },\n      swing: {\n        in: {\n          from: {transform: 'rotate(-10deg)'},\n          steps: [\n            {transform: 'rotate(10deg)', offset: 0.25},\n            {transform: 'rotate(-5deg)', offset: 0.5},\n            {transform: 'rotate(5deg)', offset: 0.75}\n          ],\n          to: {transform: 'rotate(0)'}\n        },\n        out: {\n          from: {transform: 'rotate(0)', opacity: 1},\n          steps: [\n            {transform: 'rotate(10deg)', opacity: 0.8, offset: 0.25},\n            {transform: 'rotate(-10deg)', opacity: 0.6, offset: 0.5}\n          ],\n          to: {transform: 'rotate(0)', opacity: 0}\n        }\n      }\n    },\n    // Easing presets\n    easings: {\n      linear: 'linear',\n      ease: 'ease',\n      easeIn: 'ease-in',\n      easeOut: 'ease-out',\n      easeInOut: 'ease-in-out',\n      // Cubic bezier presets\n      easeInQuad: 'cubic-bezier(0.55, 0.085, 0.68, 0.53)',\n      easeOutQuad: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',\n      easeInOutQuad: 'cubic-bezier(0.455, 0.03, 0.515, 0.955)',\n      easeInCubic: 'cubic-bezier(0.55, 0.055, 0.675, 0.19)',\n      easeOutCubic: 'cubic-bezier(0.215, 0.61, 0.355, 1)',\n      easeInOutCubic: 'cubic-bezier(0.645, 0.045, 0.355, 1)',\n      easeInQuart: 'cubic-bezier(0.895, 0.03, 0.685, 0.22)',\n      easeOutQuart: 'cubic-bezier(0.165, 0.84, 0.44, 1)',\n      easeInOutQuart: 'cubic-bezier(0.77, 0, 0.175, 1)',\n      easeInBack: 'cubic-bezier(0.6, -0.28, 0.735, 0.045)',\n      easeOutBack: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)',\n      easeInOutBack: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',\n      easeInElastic: 'cubic-bezier(0.5, -0.5, 0.75, 1.5)',\n      easeOutElastic: 'cubic-bezier(0.25, -0.5, 0.5, 1.5)',\n      easeInBounce: 'cubic-bezier(0.6, 0.04, 0.98, 0.335)',\n      easeOutBounce: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)',\n      spring: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'\n    },\n    // Performance options\n    performance: {\n      useRAF: true,\n      batchSize: 100,\n      debounceInterval: 100\n    }\n  },\n\n  /**\n   * Animation state\n   */\n  state: {\n    running: new Map(),\n    queue: new Map(),\n    cache: new Map(),\n    paused: new Map()\n  },\n\n  /**\n   * Initialize animation manager\n   */\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    // Setup performance monitoring\n    if (window.PerformanceObserver) {\n      this.setupPerformanceObserver();\n    }\n\n    return this;\n  },\n\n  /**\n   * Animate element\n   * @param {HTMLElement} element Element to animate\n   * @param {string|Object} animation Animation name or custom keyframes\n   * @param {Object} options Animation options\n   * @returns {Promise} Animation promise\n   */\n  animate(element, animation, options = {}) {\n    return new Promise((resolve, reject) => {\n      try {\n        if (!element) {\n          throw new Error('Element is required');\n        }\n\n        // Get animation config\n        const config = this.getAnimationConfig(animation, options);\n\n        // Check cache first\n        const cacheKey = this.getCacheKey(animation, options);\n        let keyframes = this.state.cache.get(cacheKey);\n\n        if (!keyframes) {\n          keyframes = this.createKeyframes(config);\n          // Cache keyframes for reuse\n          this.state.cache.set(cacheKey, keyframes);\n        }\n\n        // Setup animation\n        const animationId = Utils.generateUUID();\n        const timing = this.createTiming(options);\n\n        // Start animation\n        const anim = element.animate(keyframes, timing);\n\n        // Store running animation\n        const cleanup = () => {\n          this.state.running.delete(animationId);\n          this.state.paused.delete(animationId);\n          element.style.animation = '';\n        };\n\n        this.state.running.set(animationId, {\n          id: animationId,\n          element,\n          animation: anim,\n          cleanup,\n          options\n        });\n\n        // Handle events\n        anim.onfinish = () => {\n          cleanup();\n          // Call onComplete callback if provided\n          if (typeof options.onComplete === 'function') {\n            options.onComplete(element);\n          }\n          resolve(element);\n        };\n\n        anim.oncancel = () => {\n          cleanup();\n          reject(new Error('Animation cancelled'));\n        };\n\n        // Handle errors\n        anim.onerror = (error) => {\n          cleanup();\n          reject(error);\n        };\n\n      } catch (error) {\n        reject(error);\n      }\n    });\n  },\n\n  /**\n   * Chain multiple animations sequentially\n   * @param {HTMLElement} element Element to animate\n   * @param {Array} animations Array of animations to chain\n   * @returns {Promise} Animation chain promise\n   */\n  chain(element, animations) {\n    return animations.reduce((promise, animation) => {\n      return promise.then(() => {\n        const name = typeof animation === 'string' ? animation : animation.name;\n        const opts = typeof animation === 'object' ? animation.options || {} : {};\n        return this.animate(element, name, opts);\n      });\n    }, Promise.resolve());\n  },\n\n  /**\n   * Run multiple animations in parallel on the same element\n   * @param {HTMLElement} element Element to animate\n   * @param {Array} animations Array of animation names or configs\n   * @param {Object} options Shared options\n   * @returns {Promise} Promise that resolves when all animations complete\n   */\n  parallel(element, animations, options = {}) {\n    const promises = animations.map(animation => {\n      const name = typeof animation === 'string' ? animation : animation.name;\n      const opts = typeof animation === 'object'\n        ? {...options, ...animation.options}\n        : options;\n      return this.animate(element, name, opts);\n    });\n    return Promise.all(promises);\n  },\n\n  /**\n   * Animate multiple elements with staggered delay\n   * @param {NodeList|Array} elements Elements to animate\n   * @param {string|Object} animation Animation name or config\n   * @param {Object} options Animation options with stagger property\n   * @returns {Promise} Promise that resolves when all animations complete\n   */\n  stagger(elements, animation, options = {}) {\n    const staggerDelay = options.stagger || 50;\n    const elementsArray = Array.from(elements);\n\n    const promises = elementsArray.map((element, index) => {\n      const staggeredOptions = {\n        ...options,\n        delay: (options.delay || 0) + (index * staggerDelay)\n      };\n      return this.animate(element, animation, staggeredOptions);\n    });\n\n    return Promise.all(promises);\n  },\n\n  /**\n   * Queue animation to run after current animations complete\n   * @param {HTMLElement} element Element to animate\n   * @param {string|Object} animation Animation name or config\n   * @param {Object} options Animation options\n   * @returns {Promise} Promise that resolves when animation completes\n   */\n  queue(element, animation, options = {}) {\n    return new Promise((resolve, reject) => {\n      // Get or create queue for this element\n      if (!this.state.queue.has(element)) {\n        this.state.queue.set(element, []);\n      }\n\n      const elementQueue = this.state.queue.get(element);\n\n      // Add to queue\n      elementQueue.push({\n        animation,\n        options,\n        resolve,\n        reject\n      });\n\n      // Process queue if this is the first item\n      if (elementQueue.length === 1) {\n        this.processQueue(element);\n      }\n    });\n  },\n\n  /**\n   * Process animation queue for an element\n   * @private\n   */\n  async processQueue(element) {\n    const elementQueue = this.state.queue.get(element);\n    if (!elementQueue || elementQueue.length === 0) {\n      this.state.queue.delete(element);\n      return;\n    }\n\n    const {animation, options, resolve, reject} = elementQueue[0];\n\n    try {\n      await this.animate(element, animation, options);\n      resolve(element);\n    } catch (error) {\n      reject(error);\n    }\n\n    // Remove processed item and continue\n    elementQueue.shift();\n    this.processQueue(element);\n  },\n\n  /**\n   * Clear animation queue for an element\n   * @param {HTMLElement} element Element to clear queue for (or null for all)\n   */\n  clearQueue(element = null) {\n    if (element) {\n      const queue = this.state.queue.get(element);\n      if (queue) {\n        queue.forEach(item => item.reject(new Error('Queue cleared')));\n        this.state.queue.delete(element);\n      }\n    } else {\n      for (const [el, queue] of this.state.queue) {\n        queue.forEach(item => item.reject(new Error('Queue cleared')));\n      }\n      this.state.queue.clear();\n    }\n  },\n\n  /**\n   * Pause running animations on an element\n   * @param {HTMLElement} element Element to pause (or null for all)\n   */\n  pause(element = null) {\n    for (const [id, data] of this.state.running) {\n      if (!element || data.element === element) {\n        if (data.animation.playState === 'running') {\n          data.animation.pause();\n          this.state.paused.set(id, data);\n        }\n      }\n    }\n  },\n\n  /**\n   * Resume paused animations on an element\n   * @param {HTMLElement} element Element to resume (or null for all)\n   */\n  resume(element = null) {\n    for (const [id, data] of this.state.paused) {\n      if (!element || data.element === element) {\n        if (data.animation.playState === 'paused') {\n          data.animation.play();\n          this.state.paused.delete(id);\n        }\n      }\n    }\n  },\n\n  /**\n   * Reverse running animations on an element\n   * @param {HTMLElement} element Element to reverse (or null for all)\n   */\n  reverse(element = null) {\n    for (const [id, data] of this.state.running) {\n      if (!element || data.element === element) {\n        data.animation.reverse();\n      }\n    }\n  },\n\n  /**\n   * Get animation configuration\n   * @private\n   */\n  getAnimationConfig(animation, options) {\n    // Handle predefined animations\n    if (typeof animation === 'string') {\n      const preset = this.config.animations[animation];\n      if (!preset) {\n        throw new Error(`Animation \"${animation}\" not found`);\n      }\n      return preset[options.direction || 'in'];\n    }\n\n    // Handle custom keyframes\n    return animation;\n  },\n\n  /**\n   * Get cache key for animation\n   * @private\n   */\n  getCacheKey(animation, options) {\n    const name = typeof animation === 'string' ? animation : JSON.stringify(animation);\n    const direction = options.direction || 'in';\n    return `${name}_${direction}`;\n  },\n\n  /**\n   * Create keyframes from config\n   * @private\n   */\n  createKeyframes(config) {\n    const keyframes = [];\n\n    // Add 'from' state\n    if (config.from) {\n      keyframes.push({...config.from, offset: 0});\n    }\n\n    // Add intermediate steps\n    if (config.steps && Array.isArray(config.steps)) {\n      config.steps.forEach(step => {\n        keyframes.push(step);\n      });\n    }\n\n    // Add 'to' state\n    if (config.to) {\n      keyframes.push({...config.to, offset: 1});\n    }\n\n    return keyframes;\n  },\n\n  /**\n   * Create timing options\n   * @private\n   */\n  createTiming(options) {\n    // Resolve easing preset if needed\n    let easing = options.easing || this.config.defaultEasing;\n    if (this.config.easings[easing]) {\n      easing = this.config.easings[easing];\n    }\n\n    return {\n      duration: options.duration || this.config.defaultDuration,\n      easing: easing,\n      delay: options.delay || 0,\n      iterations: options.iterations || 1,\n      direction: options.animationDirection || 'normal',\n      fill: options.fill || 'both'\n    };\n  },\n\n  /**\n   * Monitor animation performance\n   * @private\n   */\n  setupPerformanceObserver() {\n    try {\n      // Check if 'animation' entry type is supported\n      if (typeof PerformanceObserver === 'undefined') return;\n\n      const supportedTypes = PerformanceObserver.supportedEntryTypes || [];\n      if (!supportedTypes.includes('animation')) {\n        if (this.config.debug) {\n          console.log('Animation performance observer not supported in this browser');\n        }\n        return;\n      }\n\n      const observer = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          // Report metrics\n          EventManager.emit('animation:performance', {\n            animation: entry.name,\n            duration: entry.duration,\n            startTime: entry.startTime\n          });\n        }\n      });\n\n      observer.observe({entryTypes: ['animation']});\n    } catch (e) {\n      // Animation entry type may not be supported\n      if (this.config.debug) {\n        console.warn('Animation performance observer error:', e.message);\n      }\n    }\n  },\n\n  /**\n   * Stop running animations\n   * @param {HTMLElement} element Optional element to stop animations for\n   */\n  stop(element = null) {\n    for (const [id, data] of this.state.running) {\n      if (!element || data.element === element) {\n        data.animation.cancel();\n        data.cleanup();\n        this.state.running.delete(id);\n      }\n    }\n  },\n\n  /**\n   * Finish running animations immediately\n   * @param {HTMLElement} element Optional element to finish animations for\n   */\n  finish(element = null) {\n    for (const [id, data] of this.state.running) {\n      if (!element || data.element === element) {\n        data.animation.finish();\n      }\n    }\n  },\n\n  /**\n   * Check if element has running animations\n   * @param {HTMLElement} element Element to check\n   * @returns {boolean} True if element has running animations\n   */\n  isAnimating(element) {\n    for (const [id, data] of this.state.running) {\n      if (data.element === element && data.animation.playState === 'running') {\n        return true;\n      }\n    }\n    return false;\n  },\n\n  /**\n   * Get running animations count\n   * @param {HTMLElement} element Optional element to check\n   * @returns {number} Number of running animations\n   */\n  getRunningCount(element = null) {\n    if (!element) {\n      return this.state.running.size;\n    }\n    let count = 0;\n    for (const [id, data] of this.state.running) {\n      if (data.element === element) count++;\n    }\n    return count;\n  },\n\n  /**\n   * Register a custom animation preset\n   * @param {string} name Animation name\n   * @param {Object} config Animation configuration with 'in' and/or 'out' states\n   */\n  registerAnimation(name, config) {\n    if (!name || !config) {\n      throw new Error('Animation name and config are required');\n    }\n    this.config.animations[name] = config;\n  },\n\n  /**\n   * Register a custom easing preset\n   * @param {string} name Easing name\n   * @param {string} value CSS easing value\n   */\n  registerEasing(name, value) {\n    if (!name || !value) {\n      throw new Error('Easing name and value are required');\n    }\n    this.config.easings[name] = value;\n  },\n\n  /**\n   * Clear animation cache\n   */\n  clearCache() {\n    this.state.cache.clear();\n  },\n\n  /**\n   * Destroy animation manager\n   */\n  destroy() {\n    this.stop();\n    this.clearQueue();\n    this.clearCache();\n    this.state.paused.clear();\n    this.stopAutoInit();\n  },\n\n  // ============================================\n  // Auto-Initialization System\n  // ============================================\n\n  /**\n   * Auto-init state\n   */\n  _autoInit: {\n    initialized: false,\n    enterObserver: null,\n    leaveObserver: null,\n    mutationObserver: null,\n    animateHandlers: new WeakMap()\n  },\n\n  /**\n   * Initialize all animation data attributes automatically\n   * Call this to enable declarative animations without JavaScript\n   */\n  autoInit(container = document) {\n    if (this._autoInit.initialized && container === document) return;\n\n    // Initialize enter animations (scroll reveal)\n    this._initEnterAnimations(container);\n\n    // Initialize leave animations\n    this._initLeaveAnimations(container);\n\n    // Initialize click-triggered animations\n    this._initAnimateTriggers(container);\n\n    // Setup mutation observer for dynamic content (only once for document)\n    if (container === document && !this._autoInit.mutationObserver) {\n      this._setupMutationObserver();\n    }\n\n    if (container === document) {\n      this._autoInit.initialized = true;\n    }\n  },\n\n  /**\n   * Initialize data-enter animations (scroll reveal)\n   */\n  _initEnterAnimations(container) {\n    // Create single shared observer if not exists\n    if (!this._autoInit.enterObserver) {\n      this._autoInit.enterObserver = new IntersectionObserver((entries) => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            const el = entry.target;\n            const animation = el.dataset.enter;\n            const duration = parseInt(el.dataset.enterDuration) || this.config.defaultDuration;\n\n            this.animate(el, animation, {\n              direction: 'in',\n              duration: duration,\n              onComplete: () => {\n                EventManager.emit('animation:enter:complete', {element: el, animation});\n              }\n            });\n\n            // Unobserve unless repeat is set\n            if (!el.dataset.enterRepeat) {\n              this._autoInit.enterObserver.unobserve(el);\n            }\n          }\n        });\n      }, {\n        threshold: 0.1,\n        rootMargin: '0px'\n      });\n    }\n\n    // Find and observe elements\n    const elements = container.querySelectorAll('[data-enter]:not([data-anim-initialized])');\n    elements.forEach(el => {\n      // Skip if already processed by TemplateManager\n      if (el._animBinding) return;\n\n      el.dataset.animInitialized = 'true';\n      this._autoInit.enterObserver.observe(el);\n    });\n  },\n\n  /**\n   * Initialize data-leave animations\n   */\n  _initLeaveAnimations(container) {\n    if (!this._autoInit.leaveObserver) {\n      this._autoInit.leaveObserver = new IntersectionObserver((entries) => {\n        entries.forEach(entry => {\n          if (!entry.isIntersecting) {\n            const el = entry.target;\n            // Only trigger if element was previously visible\n            if (el._wasVisible) {\n              const animation = el.dataset.leave;\n              const duration = parseInt(el.dataset.leaveDuration) || this.config.defaultDuration;\n\n              this.animate(el, animation, {\n                direction: 'out',\n                duration: duration,\n                onComplete: () => {\n                  EventManager.emit('animation:leave:complete', {element: el, animation});\n                }\n              });\n            }\n          } else {\n            entry.target._wasVisible = true;\n          }\n        });\n      }, {\n        threshold: 0.1\n      });\n    }\n\n    const elements = container.querySelectorAll('[data-leave]:not([data-anim-initialized])');\n    elements.forEach(el => {\n      if (el._animBinding) return;\n      el.dataset.animInitialized = 'true';\n      this._autoInit.leaveObserver.observe(el);\n    });\n  },\n\n  /**\n   * Initialize data-animate click triggers\n   * Usage: <button data-animate=\"targetId\" data-animation=\"bounce\">\n   */\n  _initAnimateTriggers(container) {\n    const triggers = container.querySelectorAll('[data-animate]:not([data-anim-trigger-initialized])');\n\n    triggers.forEach(trigger => {\n      trigger.dataset.animTriggerInitialized = 'true';\n\n      const handler = () => {\n        const targetId = trigger.dataset.animate;\n        const animation = trigger.dataset.animation || 'fade';\n        const duration = parseInt(trigger.dataset.animationDuration) || this.config.defaultDuration;\n        const direction = trigger.dataset.animationDirection || 'in';\n        const target = document.getElementById(targetId);\n\n        if (target) {\n          this.animate(target, animation, {\n            direction: direction,\n            duration: duration\n          });\n        }\n      };\n\n      trigger.addEventListener('click', handler);\n      this._autoInit.animateHandlers.set(trigger, handler);\n    });\n  },\n\n  /**\n   * Setup MutationObserver for dynamic content\n   */\n  _setupMutationObserver() {\n    this._autoInit.mutationObserver = new MutationObserver((mutations) => {\n      let hasNewElements = false;\n\n      mutations.forEach(mutation => {\n        mutation.addedNodes.forEach(node => {\n          if (node.nodeType === 1) { // Element node\n            // Check if node itself has animation attributes\n            if (node.dataset?.enter || node.dataset?.leave || node.dataset?.animate) {\n              hasNewElements = true;\n            }\n            // Check children\n            if (node.querySelectorAll) {\n              const animElements = node.querySelectorAll('[data-enter], [data-leave], [data-animate]');\n              if (animElements.length > 0) {\n                hasNewElements = true;\n              }\n            }\n          }\n        });\n      });\n\n      // Re-init if new elements found\n      if (hasNewElements) {\n        // Debounce to avoid excessive calls\n        clearTimeout(this._autoInit.reinitTimeout);\n        this._autoInit.reinitTimeout = setTimeout(() => {\n          this.autoInit(document);\n        }, 50);\n      }\n    });\n\n    this._autoInit.mutationObserver.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n  },\n\n  /**\n   * Stop auto-initialization and cleanup\n   */\n  stopAutoInit() {\n    if (this._autoInit.enterObserver) {\n      this._autoInit.enterObserver.disconnect();\n      this._autoInit.enterObserver = null;\n    }\n    if (this._autoInit.leaveObserver) {\n      this._autoInit.leaveObserver.disconnect();\n      this._autoInit.leaveObserver = null;\n    }\n    if (this._autoInit.mutationObserver) {\n      this._autoInit.mutationObserver.disconnect();\n      this._autoInit.mutationObserver = null;\n    }\n    this._autoInit.initialized = false;\n  }\n};\n\n// Auto-register with Now framework\nif (window.Now?.registerManager) {\n  Now.registerManager('animation', AnimationManager);\n}\n\n// Auto-init when DOM is ready (opt-in via data-animation-auto on body or html)\ndocument.addEventListener('DOMContentLoaded', () => {\n  // Check if auto-init is enabled\n  const autoInitEnabled = document.body.dataset.animationAuto !== undefined ||\n    document.documentElement.dataset.animationAuto !== undefined;\n\n  if (autoInitEnabled) {\n    AnimationManager.autoInit();\n  }\n});\n\n// Expose globally\nwindow.AnimationManager = AnimationManager;\n\n/**\n * Animation directive system\n * Adds animation support via data attributes and properties\n */\nObject.assign(TemplateManager, {\n  /**\n   * Process animation directives\n   * @param {HTMLElement} element Element to process\n   * @param {Object} context Component context\n   */\n  processDataAnimation(element, context) {\n    if (!element || !context) return;\n\n    // Store initial animation binding if not exists\n    if (!element._animBinding) {\n      element._animBinding = {\n        animations: new Map(),\n        originalState: this.deepClone(context.state),\n        originalContext: {...context},\n        originalDisplay: element.style.display\n      };\n    }\n\n    // Process animation directives\n    this.processAnimationShow(element, context);\n    this.processAnimationEnter(element, context);\n    this.processAnimationLeave(element, context);\n    this.processAnimationTransition(element, context);\n  },\n\n  /**\n   * Process data-show animation\n   * Shows/hides element with animation\n   */\n  processAnimationShow(element, context) {\n    const value = element.dataset.show;\n    if (!value) return;\n\n    try {\n      const updateShow = () => {\n        // Get current value\n        let isVisible = ExpressionEvaluator.evaluate(value, {...context.state, ...context.computed}, context);\n\n        // Default to original state if undefined\n        if (isVisible === undefined && element._animBinding.originalState) {\n          isVisible = ExpressionEvaluator.evaluate(value, element._animBinding.originalState, context);\n        }\n\n        // Get animation options\n        const animation = element.dataset.showAnimation || 'fade';\n        const duration = parseInt(element.dataset.showDuration) || 300;\n\n        // Stop any running animations on this element\n        AnimationManager.stop(element);\n\n        if (isVisible) {\n          // Show: Remove display: none first\n          if (element.style.display === 'none') {\n            element.style.display = element._animBinding.originalDisplay || '';\n          }\n\n          // Animate in\n          AnimationManager.animate(element, animation, {\n            direction: 'in',\n            duration\n          });\n        } else {\n          // Hide: Animate out, then set display: none\n          AnimationManager.animate(element, animation, {\n            direction: 'out',\n            duration,\n            onComplete: () => {\n              element.style.display = 'none';\n            }\n          }).catch(() => {\n            // If cancelled (e.g. by quick toggle), don't hide\n          });\n        }\n      };\n\n      // Initial check - if false, hide immediately without animation\n      let initialVisible = ExpressionEvaluator.evaluate(value, {...context.state, ...context.computed}, context);\n      if (initialVisible === undefined && element._animBinding.originalState) {\n        initialVisible = ExpressionEvaluator.evaluate(value, element._animBinding.originalState, context);\n      }\n\n      if (!initialVisible) {\n        element.style.display = 'none';\n      }\n\n      // Setup reactive update\n      this.setupReactiveUpdate(element, context, 'Show', updateShow);\n\n    } catch (error) {\n      console.error('Error processing animation show:', error);\n    }\n  },\n\n  /**\n   * Process data-enter animation\n   * Animates element when entering view\n   */\n  processAnimationEnter(element, context) {\n    const animation = element.dataset.enter;\n    if (!animation) return;\n\n    try {\n      // Create intersection observer\n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            // Animate when entering view\n            AnimationManager.animate(element, animation, {\n              duration: parseInt(element.dataset.enterDuration) || 300,\n              onComplete: () => {\n                // Emit event when enter animation completes\n                EventManager.emit('animation:enter:complete', {element, animation});\n              }\n            });\n            // Only animate once unless data-enter-repeat is set\n            if (!element.dataset.enterRepeat) {\n              observer.unobserve(element);\n            }\n          }\n        });\n      }, {\n        threshold: parseFloat(element.dataset.enterThreshold) || 0.1\n      });\n\n      // Start observing\n      observer.observe(element);\n\n      // Store for cleanup\n      element._animBinding.observers = element._animBinding.observers || new Set();\n      element._animBinding.observers.add(observer);\n\n    } catch (error) {\n      console.error('Error processing animation enter:', error);\n    }\n  },\n\n  /**\n   * Process data-leave animation\n   * Animates element when leaving view\n   */\n  processAnimationLeave(element, context) {\n    const animation = element.dataset.leave;\n    if (!animation) return;\n\n    try {\n      // Create intersection observer\n      const observer = new IntersectionObserver((entries) => {\n        entries.forEach(entry => {\n          if (!entry.isIntersecting) {\n            // Animate when leaving view\n            AnimationManager.animate(element, animation, {\n              duration: parseInt(element.dataset.leaveDuration) || 300,\n              onComplete: () => {\n                // Emit event when leave animation completes\n\n                EventManager.emit('animation:leave:complete', {element, animation});\n              }\n            });\n          }\n        });\n      }, {\n        threshold: parseFloat(element.dataset.leaveThreshold) || 0.1\n      });\n\n      // Start observing\n      observer.observe(element);\n\n      // Store for cleanup\n      element._animBinding.observers = element._animBinding.observers || new Set();\n      element._animBinding.observers.add(observer);\n\n    } catch (error) {\n      console.error('Error processing animation leave:', error);\n    }\n  },\n\n  /**\n   * Process data-transition animation\n   * Animates between states\n   */\n  processAnimationTransition(element, context) {\n    const value = element.dataset.transition;\n    if (!value) return;\n\n    try {\n      const updateTransition = () => {\n        // Get new value\n        let newValue = ExpressionEvaluator.evaluate(value, {...context.state, ...context.computed}, context);\n\n        // Use original state if undefined\n        if (newValue === undefined && element._animBinding.originalState) {\n          newValue = ExpressionEvaluator.evaluate(value, element._animBinding.originalState, context);\n        }\n\n        // Get previous value\n        const prevValue = element._animBinding.prevValue;\n\n        // Skip if no change\n        if (newValue === prevValue) return;\n\n        // Get animation options\n        const animation = element.dataset.transitionAnimation || 'fade';\n        const duration = parseInt(element.dataset.transitionDuration) || 300;\n\n        // Animate transition\n        AnimationManager.animate(element, animation, {\n          duration,\n          onComplete: () => {\n            // Update previous value after animation completes\n            element._animBinding.prevValue = newValue;\n            // Emit event\n            EventManager.emit('animation:transition:complete', {\n              element,\n              animation,\n              prevValue,\n              newValue\n            });\n          }\n        });\n      };\n\n      // Initial update\n      updateTransition();\n\n      // Setup reactive update\n      this.setupReactiveUpdate(element, context, 'Transition', updateTransition);\n\n    } catch (error) {\n      console.error('Error processing animation transition:', error);\n    }\n  },\n\n  /**\n   * Clean up animation bindings\n   */\n  cleanupAnimationBinding(element) {\n    if (!element._animBinding) return;\n\n    // Stop running animations\n    AnimationManager.stop(element);\n\n    // Disconnect observers\n    element._animBinding.observers?.forEach(observer => {\n      observer.disconnect();\n    });\n\n    // Remove binding\n    delete element._animBinding;\n  }\n});","/**\n * MediaViewer Component\n * Unified media viewer with slideshow, zoom and fullscreen capabilities\n * Supports images, videos, YouTube, and custom content\n *\n * Features:\n * - Slideshow with thumbnails\n * - Image zoom and pan\n * - YouTube video embedding\n * - Responsive design\n * - Touch gestures\n * - Keyboard controls\n * - Accessibility support\n */\nclass MediaViewer {\n  /**\n   * Create MediaViewer instance\n   * @param {Object} options Configuration options\n   */\n  constructor(options = {}) {\n    this.options = {\n      showThumbnails: false,\n      showControls: true,\n\n      autoplay: false,\n      interval: 5000,\n      loop: true,\n\n      enableZoom: true,\n      maxZoom: 3,\n      zoomStep: 0.5,\n\n      renderers: {\n        image: this.renderImage.bind(this),\n        video: this.renderVideo.bind(this),\n        youtube: this.renderYouTube.bind(this),\n        iframe: this.renderIframe.bind(this),\n        text: this.renderText.bind(this),\n        html: this.renderHtml.bind(this)\n      },\n\n      onShow: null,\n      onHide: null,\n      onChange: null,\n\n      ...options\n    };\n\n    this.state = {\n      visible: false,\n      currentIndex: 0,\n      items: [],\n      zoom: 1,\n      pan: {x: 0, y: 0},\n      isDragging: false,\n      startPos: {x: 0, y: 0},\n      isPlaying: false,\n      playTimer: null\n    };\n\n    this.setupDOM();\n    this.bindEvents();\n  }\n\n  /**\n   * Set up DOM structure\n   * @private\n   */\n  setupDOM() {\n    this.container = document.createElement('div');\n    this.container.className = 'media-viewer';\n    this.container.setAttribute('role', 'dialog');\n    this.container.setAttribute('aria-modal', 'true');\n    this.container.setAttribute('aria-hidden', 'true');\n\n    this.container.innerHTML = `\n      <div class=\"media-counter\"></div>\n\n      <div class=\"media-viewer-header\">\n        <div class=\"media-viewer-controls\">\n          ${this.options.showControls ? `\n            <button class=\"zoom-out icon-zoom-out\" aria-label=\"Zoom out\"></button>\n            <button class=\"zoom-reset icon-zoom-reset\" aria-label=\"Reset zoom\"></button>\n            <button class=\"zoom-in icon-zoom-in\" aria-label=\"Zoom in\"></button>\n          ` : ''}\n          <button class=\"close-button\" aria-label=\"Close\"></button>\n        </div>\n      </div>\n\n      <div class=\"media-viewer-content\">\n        <button class=\"nav-button icon-prev prev\" aria-label=\"Previous\"></button>\n        <div class=\"media-stage\"></div>\n        <button class=\"nav-button icon-next next\" aria-label=\"Next\"></button>\n        <div class=\"media-caption\"></div>\n      </div>\n\n      ${this.options.showThumbnails ? `\n        <div class=\"media-viewer-thumbnails\">\n          <div class=\"thumbnail-track\"></div>\n        </div>\n      ` : ''}\n    `;\n\n    this.stage = this.container.querySelector('.media-stage');\n    this.thumbnailTrack = this.container.querySelector('.thumbnail-track');\n    this.captionEl = this.container.querySelector('.media-caption');\n    this.counterEl = this.container.querySelector('.media-counter');\n\n    document.body.appendChild(this.container);\n  }\n\n  /**\n   * Bind event listeners\n   * @private\n   */\n  bindEvents() {\n    this.container.querySelector('.close-button').onclick = () => this.hide();\n    this.container.querySelector('.nav-button.prev').onclick = () => this.prev();\n    this.container.querySelector('.nav-button.next').onclick = () => this.next();\n\n    if (this.options.showControls) {\n      this.container.querySelector('.zoom-in').onclick = () => this.zoomIn();\n      this.container.querySelector('.zoom-out').onclick = () => this.zoomOut();\n      this.container.querySelector('.zoom-reset').onclick = () => this.resetZoom();\n    }\n\n    document.addEventListener('keydown', (e) => {\n      if (!this.state.visible) return;\n\n      switch (e.key) {\n        case 'Escape': this.hide(); break;\n        case 'ArrowLeft': this.prev(); break;\n        case 'ArrowRight': this.next(); break;\n        case '+': this.zoomIn(); break;\n        case '-': this.zoomOut(); break;\n        case '0': this.resetZoom(); break;\n      }\n    });\n\n    let touchStartX = 0;\n    let touchStartY = 0;\n\n    this.stage.addEventListener('touchstart', (e) => {\n      touchStartX = e.touches[0].clientX;\n      touchStartY = e.touches[0].clientY;\n    });\n\n    this.stage.addEventListener('touchmove', (e) => {\n      if (!this.state.visible) return;\n\n      const deltaX = touchStartX - e.touches[0].clientX;\n      const deltaY = touchStartY - e.touches[0].clientY;\n\n      if (Math.abs(deltaX) > Math.abs(deltaY)) {\n        e.preventDefault();\n        if (deltaX > 50) this.next();\n        if (deltaX < -50) this.prev();\n      }\n    });\n\n    this.stage.addEventListener('wheel', (e) => {\n      if (!this.options.enableZoom) return;\n\n      e.preventDefault();\n      if (e.deltaY < 0) this.zoomIn();\n      if (e.deltaY > 0) this.zoomOut();\n    });\n\n    this.stage.addEventListener('mousedown', this.startDrag.bind(this));\n    document.addEventListener('mousemove', this.doDrag.bind(this));\n    document.addEventListener('mouseup', this.stopDrag.bind(this));\n  }\n\n  /**\n   * Show viewer with media items\n   * @param {Array} items Media items to display\n   * @param {number} startIndex Starting item index\n   */\n  show(items, startIndex = 0) {\n    this.state.items = items.map(item => this.normalizeItem(item));\n    this.state.currentIndex = startIndex;\n    this.state.visible = true;\n\n    this.container.classList.add('visible');\n    this.container.setAttribute('aria-hidden', 'false');\n    document.body.style.overflow = 'hidden';\n\n    this.loadCurrentItem();\n\n    if (this.options.showThumbnails) {\n      this.renderThumbnails();\n    }\n\n    if (this.options.autoplay) {\n      this.play();\n    }\n\n    if (this.options.onShow) {\n      this.options.onShow(this.getCurrentItem());\n    }\n  }\n\n  /**\n   * Hide viewer\n   */\n  hide() {\n    this.stop();\n    this.resetZoom();\n\n    this.state.visible = false;\n    this.container.classList.remove('visible');\n    this.container.setAttribute('aria-hidden', 'true');\n    document.body.style.overflow = '';\n\n    if (this.options.onHide) {\n      this.options.onHide();\n    }\n  }\n\n  /**\n   * Load and render current item\n   * @private\n   */\n  loadCurrentItem() {\n    const item = this.getCurrentItem();\n    if (!item) return;\n\n    // Show loading state\n    this.stage.classList.add('loading');\n    this.stage.innerHTML = '';\n\n    this.resetZoom();\n\n    // Update counter\n    this.updateCounter();\n\n    // Update caption\n    this.updateCaption(item);\n\n    const renderer = this.options.renderers[item.type];\n    if (renderer) {\n      renderer(item);\n    }\n\n    if (this.options.showThumbnails) {\n      this.updateThumbnails();\n    }\n\n    if (this.options.onChange) {\n      this.options.onChange(item, this.state.currentIndex);\n    }\n  }\n\n  /**\n   * Render image item\n   * @private\n   */\n  renderImage(item) {\n    const img = document.createElement('img');\n    img.className = 'media-item';\n    img.src = item.url;\n    img.alt = item.caption || '';\n\n    img.onload = () => {\n      this.stage.classList.remove('loading');\n      this.resetZoom();\n      img.classList.add('loaded');\n    };\n\n    img.onerror = () => {\n      this.stage.classList.remove('loading');\n    };\n\n    this.stage.appendChild(img);\n  }\n\n  /**\n   * Render video item\n   * @private\n   */\n  renderVideo(item) {\n    const video = document.createElement('video');\n    video.className = 'media-item';\n    video.src = item.url;\n    video.controls = true;\n\n    if (item.poster) {\n      video.poster = item.poster;\n    }\n\n    // Remove loading state when video can play\n    video.oncanplay = () => {\n      this.stage.classList.remove('loading');\n    };\n\n    video.onerror = () => {\n      this.stage.classList.remove('loading');\n    };\n\n    this.stage.appendChild(video);\n  }\n\n  /**\n   * Render YouTube video\n   * @private\n   */\n  renderYouTube(item) {\n    const iframe = document.createElement('iframe');\n    iframe.className = 'media-item iframe';\n    iframe.src = `https://www.youtube.com/embed/${this.sanitizeVideoId(item.videoId)}?rel=0&showinfo=0`;\n    iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';\n    iframe.allowFullscreen = true;\n\n    // Remove loading state when iframe loads\n    iframe.onload = () => {\n      this.stage.classList.remove('loading');\n    };\n\n    this.stage.appendChild(iframe);\n  }\n\n  /**\n   * Sanitize YouTube video ID\n   * @private\n   */\n  sanitizeVideoId(videoId) {\n    if (typeof videoId !== 'string') return '';\n    // Verify that videoId is 11 characters long and contains only valid characters\n    const validId = /^[a-zA-Z0-9_-]{11}$/.test(videoId);\n    return validId ? videoId : '';\n  }\n\n  /**\n   * Render iframe content\n   * @private\n   */\n  renderIframe(item) {\n    const iframe = document.createElement('iframe');\n    iframe.className = 'media-item iframe';\n    iframe.src = item.url;\n    iframe.allowFullscreen = true;\n\n    // Remove loading state when iframe loads\n    iframe.onload = () => {\n      this.stage.classList.remove('loading');\n    };\n\n    this.stage.appendChild(iframe);\n  }\n\n  /**\n   * Render text content\n   * @private\n   */\n  renderText(item) {\n    this.stage.classList.remove('loading');\n\n    const textContainer = document.createElement('div');\n    textContainer.className = 'media-item media-text';\n    textContainer.textContent = item.content || item.text || '';\n\n    if (item.title) {\n      const title = document.createElement('h2');\n      title.className = 'media-text-title';\n      title.textContent = item.title;\n      textContainer.insertBefore(title, textContainer.firstChild);\n    }\n\n    this.stage.appendChild(textContainer);\n  }\n\n  /**\n   * Render HTML content\n   * @private\n   */\n  renderHtml(item) {\n    this.stage.classList.remove('loading');\n\n    const htmlContainer = document.createElement('div');\n    htmlContainer.className = 'media-item media-html';\n\n    // Sanitize HTML if SecurityManager is available\n    if (window.SecurityManager && SecurityManager.sanitize) {\n      htmlContainer.innerHTML = SecurityManager.sanitize(item.content || item.html || '');\n    } else {\n      htmlContainer.innerHTML = item.content || item.html || '';\n    }\n\n    this.stage.appendChild(htmlContainer);\n  }\n\n  /**\n   * Render error state\n   * @private\n   */\n  renderError(message) {\n    this.stage.classList.remove('loading');\n    this.stage.innerHTML = '';\n\n    const errorContainer = document.createElement('div');\n    errorContainer.className = 'media-error';\n    errorContainer.innerHTML = `\n      <div class=\"media-error-icon\">⚠️</div>\n      <div class=\"media-error-message\">${message || 'Failed to load media'}</div>\n    `;\n\n    this.stage.appendChild(errorContainer);\n  }\n\n  /**\n   * Render thumbnail strip\n   * @private\n   */\n  renderThumbnails() {\n    this.thumbnailTrack.innerHTML = '';\n\n    this.state.items.forEach((item, index) => {\n      const thumb = document.createElement('div');\n      thumb.className = 'thumbnail';\n      if (index === this.state.currentIndex) {\n        thumb.classList.add('active');\n      }\n\n      if (item.type === 'image') {\n        const img = document.createElement('img');\n        img.src = item.thumbnail || item.url;\n        img.alt = item.caption || '';\n        thumb.appendChild(img);\n      } else {\n        const icon = document.createElement('span');\n        icon.className = `icon-${item.type}`;\n        thumb.appendChild(icon);\n      }\n\n      thumb.onclick = () => {\n        this.goTo(index);\n      };\n\n      this.thumbnailTrack.appendChild(thumb);\n    });\n  }\n\n  /**\n   * Update thumbnail selection\n   * @private\n   */\n  updateThumbnails() {\n    if (!this.thumbnailTrack) return;\n\n    const thumbs = this.thumbnailTrack.children;\n    for (let i = 0; i < thumbs.length; i++) {\n      thumbs[i].classList.toggle('active', i === this.state.currentIndex);\n    }\n  }\n\n  /**\n   * Update counter display\n   * @private\n   */\n  updateCounter() {\n    if (!this.counterEl) return;\n\n    const current = this.state.currentIndex + 1;\n    const total = this.state.items.length;\n    this.counterEl.textContent = `${current} / ${total}`;\n  }\n\n  /**\n   * Update caption display\n   * @param {Object} item - Current media item\n   * @private\n   */\n  updateCaption(item) {\n    if (!this.captionEl) return;\n\n    if (item && item.caption) {\n      this.captionEl.textContent = item.caption;\n      this.captionEl.style.display = '';\n    } else {\n      this.captionEl.textContent = '';\n      this.captionEl.style.display = 'none';\n    }\n  }\n\n  /**\n   * Start slideshow playback\n   */\n  play() {\n    if (this.state.isPlaying) return;\n\n    this.state.isPlaying = true;\n    this.state.playTimer = setInterval(() => {\n      this.next();\n    }, this.options.interval);\n  }\n\n  /**\n   * Stop slideshow playback\n   */\n  stop() {\n    if (!this.state.isPlaying) return;\n\n    this.state.isPlaying = false;\n    clearInterval(this.state.playTimer);\n  }\n\n  /**\n   * Go to next item\n   */\n  next() {\n    if (this.state.currentIndex < this.state.items.length - 1) {\n      this.goTo(this.state.currentIndex + 1);\n    } else if (this.options.loop) {\n      this.goTo(0);\n    }\n  }\n\n  /**\n   * Go to previous item\n   */\n  prev() {\n    if (this.state.currentIndex > 0) {\n      this.goTo(this.state.currentIndex - 1);\n    } else if (this.options.loop) {\n      this.goTo(this.state.items.length - 1);\n    }\n  }\n\n  /**\n   * Go to specific item\n   * @param {number} index Item index\n   */\n  goTo(index) {\n    if (index === this.state.currentIndex) return;\n\n    this.state.currentIndex = index;\n    this.loadCurrentItem();\n  }\n\n  /**\n   * Get current item\n   * @returns {Object} Current media item\n   */\n  getCurrentItem() {\n    return this.state.items[this.state.currentIndex];\n  }\n\n  /**\n   * Normalize media item object\n   * @private\n   */\n  normalizeItem(item) {\n    if (typeof item === 'string') {\n      return {\n        type: 'image',\n        url: item\n      };\n    }\n\n    if (item.url && item.url.includes('youtube.com')) {\n      const videoId = this.getYouTubeId(item.url);\n      return {\n        type: 'youtube',\n        videoId,\n        thumbnail: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`,\n        ...item\n      };\n    }\n\n    return {\n      type: 'image',\n      ...item\n    };\n  }\n\n  /**\n   * Extract YouTube video ID from URL\n   * @private\n   */\n  getYouTubeId(url) {\n    const regExp = /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n    const match = url.match(regExp);\n    return (match && match[2].length === 11) ? match[2] : null;\n  }\n\n  /**\n   * Start drag operation\n   * @private\n   */\n  startDrag(e) {\n    if (!this.options.enableZoom || this.state.zoom === 1) return;\n\n    this.state.isDragging = true;\n    this.state.startPos = {\n      x: e.clientX - this.state.pan.x,\n      y: e.clientY - this.state.pan.y\n    };\n\n    this.stage.style.cursor = 'grabbing';\n  }\n\n  /**\n   * Handle drag operation\n   * @private\n   */\n  doDrag(e) {\n    if (!this.state.isDragging) return;\n\n    e.preventDefault();\n\n    const mediaItem = this.stage.querySelector('.media-item');\n    if (!mediaItem) return;\n\n    const rect = mediaItem.getBoundingClientRect();\n    const containerRect = this.stage.getBoundingClientRect();\n\n    const maxX = (rect.width * this.state.zoom - containerRect.width) / 2;\n    const maxY = (rect.height * this.state.zoom - containerRect.height) / 2;\n\n    this.state.pan = {\n      x: Math.min(maxX, Math.max(-maxX, e.clientX - this.state.startPos.x)),\n      y: Math.min(maxY, Math.max(-maxY, e.clientY - this.state.startPos.y))\n    };\n\n    this.updateTransform();\n  }\n\n  /**\n   * End drag operation\n   * @private\n   */\n  stopDrag() {\n    if (!this.state.isDragging) return;\n\n    this.state.isDragging = false;\n    this.stage.style.cursor = 'grab';\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    if (!this.options.enableZoom) return;\n\n    const newZoom = Math.min(\n      this.state.zoom + this.options.zoomStep,\n      this.options.maxZoom\n    );\n    this.setZoom(newZoom);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    if (!this.options.enableZoom) return;\n\n    const newZoom = Math.max(\n      this.state.zoom - this.options.zoomStep,\n      1\n    );\n    this.setZoom(newZoom);\n  }\n\n  /**\n   * Reset zoom level\n   */\n  resetZoom() {\n    this.setZoom(1);\n    this.state.pan = {x: 0, y: 0};\n    this.updateTransform();\n  }\n\n  /**\n   * Set zoom level\n   * @param {number} zoom Zoom level\n   * @private\n   */\n  setZoom(zoom) {\n    this.state.zoom = zoom;\n    this.updateTransform();\n\n    const mediaItem = this.stage.querySelector('.media-item');\n    if (mediaItem) {\n      mediaItem.style.cursor = zoom > 1 ? 'grab' : 'default';\n    }\n  }\n\n  /**\n   * Update transform\n   * @private\n   */\n  updateTransform() {\n    const mediaItem = this.stage.querySelector('.media-item');\n    if (!mediaItem) return;\n\n    const transform = `\n      translate(${this.state.pan.x}px, ${this.state.pan.y}px)\n      scale(${this.state.zoom})\n    `;\n\n    mediaItem.style.transform = transform;\n  }\n\n  /**\n   * Set viewer options\n   * @param {Object} options New options\n   */\n  setOptions(options) {\n    this.options = {\n      ...this.options,\n      ...options\n    };\n\n    if (this.container) {\n      this.container.classList.toggle('show-thumbnails', this.options.showThumbnails);\n      this.container.classList.toggle('show-controls', this.options.showControls);\n    }\n  }\n\n  /**\n   * Clean up viewer\n   */\n  destroy() {\n    this.stop();\n\n    if (this.container && this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n    }\n\n    this.state = {\n      visible: false,\n      currentIndex: 0,\n      items: [],\n      zoom: 1,\n      pan: {x: 0, y: 0},\n      isDragging: false,\n      startPos: {x: 0, y: 0},\n      isPlaying: false,\n      playTimer: null\n    };\n  }\n\n  /**\n   * Initialize MediaViewer instances from data attributes\n   * @static\n   */\n  static init() {\n    document.querySelectorAll('[data-media-viewer]').forEach(container => {\n      MediaViewer.initFromElement(container);\n    });\n  }\n\n  /**\n   * Initialize MediaViewer from a container element\n   * @param {HTMLElement} container - Container element with data-media-viewer attribute\n   * @returns {MediaViewer|Promise<MediaViewer>} The created MediaViewer instance\n   * @static\n   */\n  static initFromElement(container) {\n    // Parse options from data attributes\n    const options = MediaViewer.parseOptionsFromElement(container);\n\n    // Create viewer instance\n    const viewer = new MediaViewer(options);\n\n    // Store viewer instance on container\n    container._mediaViewer = viewer;\n\n    // Check for API endpoint\n    const apiUrl = container.dataset.api;\n    if (apiUrl) {\n      // Load items from API\n      MediaViewer.loadFromApi(container, viewer, apiUrl);\n    } else {\n      // Collect media items from child elements\n      const items = MediaViewer.collectMediaItems(container);\n      container._mediaItems = items;\n      MediaViewer.bindItemEvents(container, viewer, items);\n    }\n\n    return viewer;\n  }\n\n  /**\n   * Load items from API endpoint\n   * @param {HTMLElement} container - Container element\n   * @param {MediaViewer} viewer - MediaViewer instance\n   * @param {string} apiUrl - API endpoint URL\n   * @static\n   */\n  static async loadFromApi(container, viewer, apiUrl) {\n    try {\n      const method = container.dataset.apiMethod || 'GET';\n      const headers = {'Content-Type': 'application/json'};\n\n      // Add auth token if AuthManager is available\n      if (window.AuthManager && AuthManager.getToken) {\n        const token = AuthManager.getToken();\n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n      }\n\n      const response = await fetch(apiUrl, {method, headers});\n\n      if (!response.ok) {\n        throw new Error(`API request failed: ${response.status}`);\n      }\n\n      const data = await response.json();\n\n      // Support different API response formats\n      let items = [];\n      if (Array.isArray(data)) {\n        items = data;\n      } else if (data.items) {\n        items = data.items;\n      } else if (data.data) {\n        items = data.data;\n      } else if (data.media) {\n        items = data.media;\n      }\n\n      // Normalize items\n      items = items.map(item => {\n        if (typeof item === 'string') {\n          return {type: 'image', url: item};\n        }\n        return {\n          type: item.type || 'image',\n          url: item.url || item.src || item.path,\n          thumbnail: item.thumbnail || item.thumb,\n          caption: item.caption || item.title || item.description,\n          ...item\n        };\n      });\n\n      container._mediaItems = items;\n      MediaViewer.bindItemEvents(container, viewer, items);\n\n      // Dispatch loaded event\n      container.dispatchEvent(new CustomEvent('mediaviewer:loaded', {\n        detail: {items, viewer}\n      }));\n\n    } catch (error) {\n      console.error('MediaViewer API load error:', error);\n\n      // Show error in viewer if opened\n      container._mediaItems = [];\n      container._apiError = error.message;\n\n      // Dispatch error event\n      container.dispatchEvent(new CustomEvent('mediaviewer:error', {\n        detail: {error: error.message, viewer}\n      }));\n    }\n  }\n\n  /**\n   * Bind click events to media items\n   * @param {HTMLElement} container - Container element\n   * @param {MediaViewer} viewer - MediaViewer instance\n   * @param {Array} items - Media items array\n   * @static\n   */\n  static bindItemEvents(container, viewer, items) {\n    const clickableItems = container.querySelectorAll('img, a[data-media-item], [data-media-item]');\n    clickableItems.forEach((item, index) => {\n      item.style.cursor = 'pointer';\n      item.addEventListener('click', (e) => {\n        e.preventDefault();\n        if (container._apiError) {\n          viewer.renderError(container._apiError);\n          viewer.container.classList.add('visible');\n        } else {\n          viewer.show(items, index);\n        }\n      });\n    });\n\n    // If no clickable items but has items from API, add click to container\n    if (clickableItems.length === 0 && items.length > 0) {\n      container.style.cursor = 'pointer';\n      container.addEventListener('click', () => {\n        viewer.show(items, 0);\n      });\n    }\n  }\n\n  /**\n   * Parse MediaViewer options from element's data attributes\n   * @param {HTMLElement} element - Element with data attributes\n   * @returns {Object} Parsed options object\n   * @static\n   */\n  static parseOptionsFromElement(element) {\n    const options = {};\n\n    // Boolean options\n    if (element.dataset.showThumbnails !== undefined) {\n      options.showThumbnails = element.dataset.showThumbnails === 'true';\n    }\n    if (element.dataset.showControls !== undefined) {\n      options.showControls = element.dataset.showControls === 'true';\n    }\n    if (element.dataset.autoplay !== undefined) {\n      options.autoplay = element.dataset.autoplay === 'true';\n    }\n    if (element.dataset.loop !== undefined) {\n      options.loop = element.dataset.loop === 'true';\n    }\n    if (element.dataset.enableZoom !== undefined) {\n      options.enableZoom = element.dataset.enableZoom === 'true';\n    }\n\n    // Numeric options\n    if (element.dataset.interval) {\n      options.interval = parseInt(element.dataset.interval, 10);\n    }\n    if (element.dataset.maxZoom) {\n      options.maxZoom = parseFloat(element.dataset.maxZoom);\n    }\n    if (element.dataset.zoomStep) {\n      options.zoomStep = parseFloat(element.dataset.zoomStep);\n    }\n\n    return options;\n  }\n\n  /**\n   * Collect media items from container's child elements\n   * @param {HTMLElement} container - Container element\n   * @returns {Array} Array of media item objects\n   * @static\n   */\n  static collectMediaItems(container) {\n    const items = [];\n\n    // Collect from img elements\n    container.querySelectorAll('img').forEach(img => {\n      // Use data-src for full-size image, fallback to src\n      const url = img.dataset.src || img.src;\n\n      items.push({\n        type: img.dataset.type || 'image',\n        url: url,\n        caption: img.dataset.caption || img.alt || '',\n        thumbnail: img.src\n      });\n    });\n\n    // Collect from anchor elements with data-media-item\n    container.querySelectorAll('a[data-media-item]').forEach(anchor => {\n      const url = anchor.href;\n      const type = anchor.dataset.type || 'image';\n\n      // Check if it's a YouTube URL\n      if (url.includes('youtube.com') || url.includes('youtu.be')) {\n        items.push({\n          type: 'youtube',\n          url: url,\n          caption: anchor.dataset.caption || anchor.textContent || ''\n        });\n      } else {\n        items.push({\n          type: type,\n          url: url,\n          caption: anchor.dataset.caption || anchor.textContent || '',\n          thumbnail: anchor.dataset.thumbnail || anchor.querySelector('img')?.src\n        });\n      }\n    });\n\n    // Collect from elements with data-media-item (non-anchor)\n    container.querySelectorAll('[data-media-item]:not(a):not(img)').forEach(el => {\n      const url = el.dataset.src || el.dataset.url;\n      if (!url) return;\n\n      items.push({\n        type: el.dataset.type || 'image',\n        url: url,\n        caption: el.dataset.caption || '',\n        thumbnail: el.dataset.thumbnail\n      });\n    });\n\n    return items;\n  }\n}\n\n// Auto-initialize on DOM ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => MediaViewer.init());\n} else {\n  MediaViewer.init();\n}\n\n// Expose globally\nwindow.MediaViewer = MediaViewer;\n","/**\n * EditInPlaceManager - Simplified Inline Editing\n *\n * Features:\n * - Click to edit text inline\n * - Only saves when value actually changes\n * - Auto-restore on error or use server value\n * - Simple text input only (no complex types)\n * - Blur to save, Escape to cancel\n *\n * Security Features:\n * - Uses HttpClient with automatic CSRF protection (via SecurityManager)\n * - Rate limiting through HttpClient interceptors\n * - XSS protection: uses textContent (not innerHTML)\n * - Sanitizes error messages to prevent information disclosure\n * - Input validation on field/id parameters\n * - Event listener cleanup to prevent memory leaks\n */\nconst EditInPlaceManager = {\n  config: {\n    className: 'edit-in-place',\n    activeClass: 'editing',\n    selectOnEdit: true,\n    callbacks: {}\n  },\n\n  state: {\n    instances: new Map(),\n    activeEditor: null,\n    initialized: false\n  },\n\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n\n    // Initialize any existing elements with data-component=\"editinplace\"\n    document.querySelectorAll('[data-component=\"editinplace\"]').forEach(element => {\n      this.create(element);\n    });\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  create(element, options = {}) {\n    if (typeof element === 'string') {\n      element = document.getElementById(element);\n    }\n\n    if (!element || element.editInPlace) return element?.editInPlace;\n\n    // Extract config from data attributes\n    const ajaxUrl = element.dataset.editAjaxUrl || options.ajaxUrl || null;\n    const callbackName = element.dataset.callback || options.callback || null;\n\n    // Validate field and id to prevent injection\n    const field = (element.dataset.field || element.id || '').replace(/[^a-zA-Z0-9_-]/g, '');\n\n    if (ajaxUrl && !field) {\n      console.warn('EditInPlace: field is required when using AJAX save');\n    }\n\n    const config = {\n      ...this.config,\n      ajaxUrl: ajaxUrl,\n      callback: callbackName,\n      // Auto-enable AJAX if URL is provided, unless explicitly disabled\n      ajaxSave: element.dataset.editAjaxSave === 'false'\n        ? false\n        : (element.dataset.editAjaxSave === 'true' || !!ajaxUrl),\n      field: field,\n      ...options\n    };\n\n    const instance = {\n      element,\n      config,\n      originalValue: element.textContent.trim(),\n      editor: null,\n      isEditing: false\n    };\n\n    element.editInPlace = instance;\n    this.state.instances.set(element, instance);\n    this.setupElement(instance);\n\n    return instance;\n  },\n\n  setupElement(instance) {\n    const {element, config} = instance;\n\n    element.classList.add(config.className);\n    element.style.cursor = 'pointer';\n    element.tabIndex = 0;\n\n    // Store event handlers for cleanup\n    instance.handlers = {\n      click: (e) => {\n        e.stopPropagation();\n        this.startEdit(instance);\n      },\n      keydown: (e) => {\n        if (!instance.isEditing && (e.key === 'Enter' || e.key === ' ')) {\n          e.preventDefault();\n          this.startEdit(instance);\n        }\n      }\n    };\n\n    // Attach event listeners\n    element.addEventListener('click', instance.handlers.click);\n    element.addEventListener('keydown', instance.handlers.keydown);\n\n    // Accessibility\n    element.setAttribute('role', 'button');\n  },\n\n  startEdit(instance) {\n    if (instance.isEditing) return;\n\n    // Cancel any other active editing\n    if (this.state.activeEditor && this.state.activeEditor !== instance) {\n      this.endEdit(this.state.activeEditor, false);\n    }\n\n    const {element, config} = instance;\n\n    // Store current value as original\n    instance.originalValue = element.textContent.trim();\n\n    // Store validation rules that need manual checking\n    instance.validation = {\n      required: element.hasAttribute('data-required'),\n      pattern: element.getAttribute('data-pattern') || null\n    };\n\n    // Create simple text input\n    const editor = document.createElement('input');\n    editor.type = 'text';\n    editor.value = instance.originalValue;\n    editor.className = `${config.className}-editor`;\n\n    // Set HTML5 attributes that browser can handle\n    const placeholder = element.getAttribute('data-placeholder');\n    const minlength = element.getAttribute('data-minlength');\n    const maxlength = element.getAttribute('data-maxlength');\n\n    if (placeholder) editor.placeholder = placeholder;\n    if (minlength) editor.minLength = parseInt(minlength);\n    if (maxlength) editor.maxLength = parseInt(maxlength);\n\n    // Match element's styling\n    const computedStyle = window.getComputedStyle(element);\n    editor.style.fontSize = computedStyle.fontSize;\n    editor.style.fontFamily = computedStyle.fontFamily;\n\n    // Replace element with editor (with safety check)\n    if (!element.parentNode) {\n      console.error('EditInPlace: Element has no parent node');\n      return;\n    }\n\n    element.style.display = 'none';\n    element.parentNode.insertBefore(editor, element);\n\n    // Set state\n    instance.isEditing = true;\n    instance.editor = editor;\n    this.state.activeEditor = instance;\n\n    // Focus and select\n    editor.focus();\n    if (config.selectOnEdit) {\n      editor.select();\n    }\n\n    // Event handlers\n    const handleBlur = () => {\n      if (instance.isEditing) {\n        this.finishEdit(instance);\n      }\n    };\n\n    const handleKeydown = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        this.endEdit(instance, false); // Cancel - restore original\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        editor.blur(); // Trigger blur which will save\n      }\n    };\n\n    // Store handlers for cleanup\n    instance.editorHandlers = {blur: handleBlur, keydown: handleKeydown};\n\n    editor.addEventListener('blur', handleBlur);\n    editor.addEventListener('keydown', handleKeydown);\n\n    // Emit start event\n    this.emitEvent('edit:start', {instance, element, editor});\n  },\n\n  async finishEdit(instance) {\n    if (!instance.isEditing) return;\n\n    const {element, config, editor, originalValue} = instance;\n    const newValue = editor.value.trim();\n\n    // Check if value actually changed\n    if (newValue === originalValue) {\n      // No change, just close editor silently (no cancel event)\n      this.endEdit(instance, {restore: false, emitCancel: false});\n      return;\n    }\n\n    // Validate before saving\n    const validationError = this.validateValue(newValue, instance.validation);\n    if (validationError) {\n      // Show error and restore original value\n      if (window.NotificationManager) {\n        NotificationManager.error(validationError);\n      } else {\n        alert(validationError);\n      }\n      this.endEdit(instance, {restore: true, emitCancel: true});\n      return;\n    }\n\n    // Value changed - prepare to save\n    let success = true;\n    let finalValue = newValue;\n    let savedViaAjax = false;\n\n    // Call callback before save if configured\n    if (config.callback) {\n      try {\n        const callbackFn = typeof config.callback === 'function'\n          ? config.callback\n          : window[config.callback];\n\n        if (typeof callbackFn === 'function') {\n          const result = callbackFn(newValue, instance);\n\n          // If callback returns false, cancel the save\n          if (result === false) {\n            this.endEdit(instance, {restore: true, emitCancel: true});\n            return;\n          }\n\n          // If callback returns a string, use it as the new value\n          if (typeof result === 'string') {\n            finalValue = result;\n          }\n        }\n      } catch (error) {\n        console.error('EditInPlace: Callback error:', error);\n      }\n    }\n\n    // AJAX save if configured\n    if (config.ajaxSave && config.ajaxUrl) {\n      try {\n        const formData = new FormData();\n        formData.append('value', newValue);\n        formData.append('field', config.field);\n\n        let response;\n\n        // Prefer HttpClient (with CSRF + Rate Limiting via SecurityManager)\n        if (window.http?.post) {\n          response = await http.post(config.ajaxUrl, formData);\n        } else if (window.simpleFetch?.post) {\n          response = await simpleFetch.post(config.ajaxUrl, formData);\n        } else {\n          // Fallback to raw fetch (no CSRF protection)\n          const fetchResponse = await fetch(config.ajaxUrl, {\n            method: 'POST',\n            body: formData,\n            headers: {'X-Requested-With': 'XMLHttpRequest'}\n          });\n          response = await fetchResponse.json();\n        }\n\n        if (response.success === false || response.error) {\n          throw new Error(response.message || 'Save failed');\n        }\n\n        savedViaAjax = true;\n\n        // Use server-returned value if provided (for formatting)\n        // HttpClient might wrap response in data.data\n        let serverValue = response.data?.value || response.data?.data?.value;\n\n        if (serverValue !== undefined) {\n          finalValue = serverValue;\n        }\n      } catch (error) {\n        console.error('EditInPlace save error:', error);\n\n        // Show user-friendly error message (don't expose system details)\n        const userMessage = error.status === 429\n          ? 'Too many requests. Please wait a moment.'\n          : error.status === 403\n            ? 'Access denied. Please refresh the page.'\n            : 'Failed to save changes.';\n\n        if (window.NotificationManager) {\n          NotificationManager.error(userMessage);\n        }\n\n        success = false;\n        finalValue = originalValue; // Restore original on error\n      }\n    }\n\n    // Update element with final value\n    element.textContent = finalValue;\n\n    // Close editor (value already updated, no need to restore)\n    this.endEdit(instance, {restore: false, emitCancel: false});\n\n    // Emit save event if value changed (whether via AJAX or local)\n    if (success && newValue !== originalValue) {\n      this.emitEvent('edit:save', {\n        instance,\n        element,\n        value: finalValue,\n        previousValue: originalValue,\n        savedViaAjax: savedViaAjax\n      });\n    }\n  },\n\n  endEdit(instance, options = {}) {\n    if (!instance.isEditing) return;\n\n    const {restore = false, emitCancel = false} = options;\n\n    instance.isEditing = false;\n\n    const {element, editor} = instance;\n\n    // Restore element visibility\n    element.style.display = '';\n\n    // Remove editor event listeners before removing element\n    if (editor && instance.editorHandlers) {\n      editor.removeEventListener('blur', instance.editorHandlers.blur);\n      editor.removeEventListener('keydown', instance.editorHandlers.keydown);\n      delete instance.editorHandlers;\n    }\n\n    // Remove editor safely\n    if (editor && editor.parentNode) {\n      try {\n        editor.parentNode.removeChild(editor);\n      } catch (e) {\n        // Already removed\n      }\n    }\n\n    instance.editor = null;\n\n    if (this.state.activeEditor === instance) {\n      this.state.activeEditor = null;\n    }\n\n    // Restore original value if requested\n    if (restore) {\n      element.textContent = instance.originalValue;\n    }\n\n    // Emit cancel only if explicitly cancelled\n    if (emitCancel) {\n      this.emitEvent('edit:cancel', {instance, element});\n    }\n\n    // Return focus to element\n    element.focus();\n  },\n\n  validateValue(value, rules) {\n    if (!rules) return null;\n\n    // Check required (manual validation)\n    if (rules.required && !value) {\n      return 'This field is required';\n    }\n\n    // Check pattern (manual validation)\n    if (rules.pattern && value) {\n      try {\n        const regex = new RegExp(`^${rules.pattern}$`);\n        if (!regex.test(value)) {\n          return 'Invalid format';\n        }\n      } catch (e) {\n        console.error('EditInPlace: Invalid pattern regex:', e);\n      }\n    }\n\n    return null; // No validation errors\n  },\n\n  cancelEdit(instance) {\n    this.endEdit(instance, {restore: true, emitCancel: true});\n  },\n\n  emitEvent(eventName, data) {\n    EventManager.emit(eventName, data);\n  },\n\n  getInstance(element) {\n    if (typeof element === 'string') {\n      element = document.getElementById(element);\n    }\n    return element?.editInPlace || null;\n  },\n\n  destroy(instance) {\n    if (typeof instance === 'string') {\n      instance = this.getInstance(instance);\n    }\n    if (!instance) return;\n\n    const {element} = instance;\n\n    if (instance.isEditing) {\n      this.endEdit(instance, false);\n    }\n\n    // Remove event listeners\n    if (instance.handlers) {\n      element.removeEventListener('click', instance.handlers.click);\n      element.removeEventListener('keydown', instance.handlers.keydown);\n      delete instance.handlers;\n    }\n\n    element.classList.remove(this.config.className);\n    element.style.cursor = '';\n    element.removeAttribute('tabIndex');\n    element.removeAttribute('role');\n\n    delete element.editInPlace;\n    this.state.instances.delete(element);\n  }\n};\n\n// Register with Now framework\nif (window.Now?.registerManager) {\n  Now.registerManager('editInPlace', EditInPlaceManager);\n}\n\nwindow.EditInPlaceManager = EditInPlaceManager;\n\n// Auto-initialize on DOM ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => EditInPlaceManager.init());\n} else {\n  EditInPlaceManager.init();\n}","/**\n * Theme Management System\n * Handles theme switching, system preference synchronization, and Backend API integration\n *\n * Features:\n * - Light/Dark theme support\n * - System preference detection\n * - Theme persistence (localStorage)\n * - Backend API integration for theme configuration\n * - CSS Variables management with security sanitization\n * - Auto registration with Now framework\n * - Component mode: data-component=\"theme\" for auto-init toggle buttons\n *\n * @version 1.0.0\n * @requires EventManager\n */\nconst ThemeManager = {\n  /**\n   * Default configuration\n   * @type {Object}\n   */\n  config: {\n    enabled: false,\n    /** @type {string} Default theme to use when no preference is set */\n    defaultTheme: 'light',\n\n    /** @type {string} LocalStorage key for theme persistence */\n    storageKey: 'app_theme',\n\n    /** @type {boolean} Whether to use system color scheme preference */\n    systemPreference: false,\n\n    /** @type {Object} Backend API configuration for loading theme config */\n    api: {\n      /** @type {boolean} Whether to load theme config from backend API on init */\n      enabled: false,\n      /** @type {string|null} URL to load theme configuration from */\n      configUrl: null,\n      /** @type {Object} Custom headers for API requests */\n      headers: {},\n      /** @type {number} Request timeout in milliseconds */\n      timeout: 5000,\n      /** @type {boolean} Cache API responses (per URL) */\n      cacheResponse: true\n    },\n\n    /** @type {Object} Transition/Animation configuration */\n    transition: {\n      /** @type {boolean} Enable smooth transitions */\n      enabled: true,\n      /** @type {number} Transition duration in milliseconds */\n      duration: 300,\n      /** @type {boolean} Hide content during theme switch (anti-FOUC) */\n      hideOnSwitch: true,\n      /** @type {string} CSS class added to body when theme is loading */\n      loadingClass: 'theme-loading',\n      /** @type {string} CSS class added to body when theme is ready */\n      readyClass: 'theme-ready',\n      /** @type {string} CSS class added during theme transition */\n      transitionClass: 'theme-transitioning'\n    }\n  },\n\n  /**\n   * Security configuration for CSS variable validation\n   * @type {Object}\n   */\n  security: {\n    /** @type {RegExp} Only allow CSS custom properties (--variable-name) */\n    allowedPropertyPattern: /^--[\\w-]+$/,\n\n    /** @type {RegExp[]} Dangerous patterns to remove from values (XSS prevention) */\n    dangerousPatterns: [\n      /url\\s*\\([^)]*\\)/gi,             // url() - block pre-wrapped urls (we wrap safe ones ourselves)\n      /expression\\s*\\([^)]*\\)/gi,      // expression() - IE specific, can execute JS\n      /@import/gi,                      // @import - can load external stylesheets\n      /javascript\\s*:/gi,              // javascript: protocol\n      /data\\s*:/gi,                     // data: protocol (can embed scripts)\n      /<script/gi,                      // <script tags\n      /<\\/script/gi,                    // </script closing tags\n      /on\\w+\\s*=/gi,                    // event handlers (onclick, onerror, etc.)\n      /behavior\\s*:/gi,                // behavior: - IE specific\n      /-moz-binding/gi                 // -moz-binding - Firefox specific XBL\n    ],\n\n    /** @type {number} Maximum value length to prevent DoS */\n    maxValueLength: 500,\n\n    /** @type {Object} URL/Image security settings */\n    url: {\n      /** @type {boolean} Enable URL detection and auto-wrapping with url() */\n      enabled: true,\n      /** @type {string[]} Allowed image extensions (lowercase, with dot) */\n      allowedExtensions: ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.avif', '.ico'],\n      /** @type {boolean} Block path traversal (../) */\n      blockPathTraversal: true,\n      /** @type {boolean} Remove query strings from URLs */\n      stripQueryString: true,\n      /** @type {string[]} Allowed origins for absolute URLs (default: same origin) */\n      allowedOrigins: [window.location.origin]\n    }\n  },\n\n  /**\n   * Manager state\n   * @type {Object}\n   */\n  state: {\n    /** @type {string|null} Current active theme */\n    current: null,\n\n    /** @type {boolean} Whether manager is initialized */\n    initialized: false,\n\n    /** @type {boolean} Whether theme is ready (for anti-FOUC) */\n    ready: false,\n\n    /** @type {boolean} Whether theme is currently transitioning */\n    transitioning: false,\n\n    /** @type {Set} Registered toggle elements */\n    toggles: new Set(),\n\n    /** @type {{mediaQuery: MediaQueryList, handleChange: Function}|null} System preference listener */\n    systemPreference: null,\n\n    /** @type {Object} Cached API responses (keyed by URL) */\n    apiCache: {},\n\n    /** @type {Object} Applied CSS variables */\n    appliedVariables: {}\n  },\n\n  /**\n   * Safe emitter wrapper to avoid runtime errors when EventManager is absent\n   * @private\n   */\n  emit(event, payload) {\n    if (window.EventManager?.emit) {\n      EventManager.emit(event, payload);\n    }\n  },\n\n  /**\n   * Initialize theme manager\n   * @async\n   * @param {Object} options - Configuration options\n   * @param {string} [options.defaultTheme='light'] - Default theme\n   * @param {string} [options.storageKey='app_theme'] - Storage key\n   * @param {boolean} [options.systemPreference=true] - Use system preference\n   * @returns {Promise<ThemeManager>} This instance\n   */\n  async init(options = {}) {\n    this.config = {...this.config, ...options};\n\n    // Validate API config early to avoid unsafe fetch targets\n    if (this.config.api?.configUrl) {\n      const urlIsSafe = this.isSafeApiUrl(this.config.api.configUrl);\n      if (!urlIsSafe) {\n        console.warn(`ThemeManager: configUrl \"${this.config.api.configUrl}\" rejected (only HTTPS same-origin allowed by default)`);\n        this.config.api.enabled = false;\n      }\n    }\n\n    if (!this.config.enabled) {\n      this.state.disabled = true;\n      return this;\n    }\n\n    document.body.classList.add(this.config.transition.loadingClass);\n\n    if (this.config.systemPreference) {\n      this.setupSystemPreference();\n    }\n\n    await this.loadInitialTheme();\n\n    this.state.initialized = true;\n\n    // Mark theme as ready (anti-FOUC)\n    this.markReady();\n\n    this.emit('theme:initialized', {theme: this.state.current});\n\n    return this;\n  },\n\n  /**\n   * Enhance a theme toggle element (called by ComponentManager)\n   * @param {HTMLElement} element - Element to enhance\n   */\n  enhance(element) {\n    if (!element || this.state.toggles.has(element)) return element;\n\n    // Add click handler\n    element.addEventListener('click', () => this.toggle());\n\n    // Update state attribute\n    this.updateElementState(element);\n\n    // Store reference\n    this.state.toggles.add(element);\n    element._themeToggle = true;\n\n    return element;\n  },\n\n  /**\n   * Update element's data-theme-state attribute\n   * @param {HTMLElement} element\n   */\n  updateElementState(element) {\n    if (element && this.state.current) {\n      element.setAttribute('data-theme-state', this.state.current);\n    }\n  },\n\n  /**\n   * Update all toggle elements state\n   */\n  updateAllToggles() {\n    this.state.toggles.forEach(element => {\n      this.updateElementState(element);\n    });\n  },\n\n  /**\n   * Setup system color scheme preference listener\n   * @private\n   */\n  setupSystemPreference() {\n    // Clean any existing listener to avoid duplicates on re-init\n    this.cleanupSystemPreferenceListener();\n\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n    const handleChange = (e) => {\n      if (!this.getStoredTheme()) {\n        this.setTheme(e.matches ? 'dark' : 'light');\n      }\n    };\n\n    mediaQuery.addEventListener('change', handleChange);\n    this.state.systemPreference = {mediaQuery, handleChange};\n    handleChange(mediaQuery);\n  },\n\n  /**\n   * Remove system preference listener if registered\n   */\n  cleanupSystemPreferenceListener() {\n    const watcher = this.state.systemPreference;\n    if (watcher?.mediaQuery && watcher.handleChange) {\n      watcher.mediaQuery.removeEventListener('change', watcher.handleChange);\n    }\n    this.state.systemPreference = null;\n  },\n\n  /**\n   * Toggle between light and dark theme\n   */\n  toggle() {\n    const newTheme = this.state.current === 'dark' ? 'light' : 'dark';\n    this.setTheme(newTheme);\n  },\n\n  /**\n   * Set active theme with optional transition animation\n   * @async\n   * @param {string} theme - Theme to set ('light' or 'dark' or custom)\n   * @param {Object} [options] - Options for this theme change\n   * @param {boolean} [options.transition=true] - Whether to animate the transition\n   * @fires theme:changed\n   */\n  async setTheme(theme, options = {}) {\n    const shouldTransition = options.transition !== false &&\n      this.config.transition.enabled &&\n      this.config.transition.hideOnSwitch &&\n      this.state.ready; // Only transition if already ready\n\n    if (shouldTransition) {\n      await this.startTransition();\n    }\n\n    // Apply theme\n    document.documentElement.setAttribute('data-theme', theme);\n    this.state.current = theme;\n\n    if (this.config.storageKey) {\n      this.setStoredTheme(theme);\n    }\n\n    // Update all toggle elements\n    this.updateAllToggles();\n\n    if (shouldTransition) {\n      await this.endTransition();\n    }\n\n    this.emit('theme:changed', {theme});\n  },\n\n  /**\n   * Get current active theme\n   * @returns {string} Current theme\n   */\n  getCurrentTheme() {\n    return this.state.current;\n  },\n\n  // ============ Transition Methods (Anti-FOUC) ============\n\n  /**\n   * Mark theme as ready - adds ready class to body (used for anti-FOUC)\n   * Call this after theme is fully loaded and applied\n   */\n  markReady() {\n    if (this.state.ready) return;\n\n    // Ensure body exists before adding class\n    const addReadyClass = () => {\n      if (document.body) {\n        this.state.ready = true;\n        document.body.classList.add(this.config.transition.readyClass);\n        document.body.classList.remove(this.config.transition.transitionClass);\n        document.body.classList.remove(this.config.transition.loadingClass);\n        this.emit('theme:ready');\n      } else {\n        // Body not ready yet, try again\n        requestAnimationFrame(addReadyClass);\n      }\n    };\n\n    addReadyClass();\n  },\n\n  /**\n   * Start theme transition (fade out)\n   * @private\n   * @returns {Promise<void>}\n   */\n  async startTransition() {\n    if (!this.config.transition.enabled) return;\n\n    this.state.transitioning = true;\n    document.body.classList.add(this.config.transition.transitionClass);\n    document.body.classList.remove(this.config.transition.readyClass);\n    document.body.classList.remove(this.config.transition.loadingClass);\n\n    // Wait for fade out\n    await this.wait(this.config.transition.duration);\n  },\n\n  /**\n   * End theme transition (fade in)\n   * @private\n   * @returns {Promise<void>}\n   */\n  async endTransition() {\n    if (!this.config.transition.enabled) return;\n\n    document.body.classList.remove(this.config.transition.transitionClass);\n    document.body.classList.add(this.config.transition.readyClass);\n    document.body.classList.remove(this.config.transition.loadingClass);\n    this.state.transitioning = false;\n\n    // Wait for fade in\n    await this.wait(this.config.transition.duration);\n  },\n\n  /**\n   * Utility: wait for specified milliseconds\n   * @private\n   * @param {number} ms - Milliseconds to wait\n   * @returns {Promise<void>}\n   */\n  wait(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  },\n\n  /**\n   * Load and apply initial theme\n   * @private\n   * @async\n   */\n  async loadInitialTheme() {\n    // Load config from API if enabled (variables and stylesheet only)\n    if (this.config.api.enabled && this.config.api.configUrl) {\n      try {\n        await this.loadFromAPI();\n      } catch (error) {\n        console.warn('ThemeManager: Failed to load from API', error);\n      }\n    }\n\n    // Determine theme mode (light/dark) from user preference\n    let theme = this.config.defaultTheme;\n\n    const stored = this.getStoredTheme();\n    if (stored) {\n      theme = stored;\n    } else if (this.config.systemPreference) {\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n      theme = prefersDark ? 'dark' : 'light';\n    }\n\n    await this.setTheme(theme);\n  },\n\n  // ============ Security Methods ============\n\n  /**\n   * Validate if a CSS property name is allowed (security whitelist)\n   * Only CSS custom properties (--*) are allowed to prevent style injection\n   * @param {string} property - CSS property name to validate\n   * @returns {boolean} True if property is allowed\n   */\n  isValidProperty(property) {\n    if (typeof property !== 'string') return false;\n    return this.security.allowedPropertyPattern.test(property);\n  },\n\n  /**\n   * Check if a value looks like a URL/image path\n   * @param {string} value - Value to check\n   * @returns {boolean} True if value appears to be a URL path\n   */\n  isUrlValue(value) {\n    if (typeof value !== 'string') return false;\n    // Allow local-ish paths (/, ./, or bare relative without protocol)\n    const trimmed = value.split('?')[0];\n    return /^(https?:\\/\\/|\\/|\\.\\/)?[\\w\\-\\.\\/]+$/.test(trimmed);\n  },\n\n  /**\n   * Sanitize and validate a URL for use in CSS url()\n   * Only allows local paths with valid image extensions\n   * @param {string} url - URL to sanitize\n   * @returns {string|null} Sanitized URL wrapped in url(), or null if invalid\n   */\n  sanitizeUrl(url) {\n    if (typeof url !== 'string') return null;\n\n    const config = this.security.url;\n    let sanitized = url.trim();\n\n    // Handle absolute URLs with protocol\n    if (/^[a-z]+:/i.test(sanitized)) {\n      try {\n        const urlObj = new URL(sanitized);\n        const isAllowed = config.allowedOrigins?.some(\n          origin => urlObj.origin === origin\n        );\n        if (!isAllowed) {\n          console.warn(`ThemeManager: Rejected URL \"${url}\" - origin \"${urlObj.origin}\" not in allowedOrigins`);\n          return null;\n        }\n        // Use only pathname for allowed origins\n        sanitized = urlObj.pathname;\n      } catch (e) {\n        console.warn(`ThemeManager: Rejected URL \"${url}\" - invalid URL format`);\n        return null;\n      }\n    }\n\n    // Normalize bare relative paths to ./\n    if (!/^(\\/|\\.\\/)/i.test(sanitized)) {\n      sanitized = `./${sanitized}`;\n    }\n\n    // Strip query string if configured\n    if (config.stripQueryString) {\n      sanitized = sanitized.split('?')[0].split('#')[0];\n    }\n\n    // Block path traversal (..)\n    if (config.blockPathTraversal && sanitized.includes('..')) {\n      console.warn(`ThemeManager: Rejected URL \"${url}\" - path traversal not allowed`);\n      return null;\n    }\n\n    // Check file extension\n    const ext = sanitized.substring(sanitized.lastIndexOf('.')).toLowerCase();\n    if (!config.allowedExtensions.includes(ext)) {\n      console.warn(`ThemeManager: Rejected URL \"${url}\" - extension \"${ext}\" not allowed. Allowed: ${config.allowedExtensions.join(', ')}`);\n      return null;\n    }\n\n    // Wrap in url() and return\n    return `url('${sanitized}')`;\n  },\n\n  /**\n   * Sanitize a CSS value to prevent XSS attacks\n   * Removes dangerous patterns like expression(), javascript:, etc.\n   * Auto-detects image URLs and wraps them with url()\n   * @param {*} value - Value to sanitize\n   * @returns {string} Sanitized value\n   */\n  sanitizeValue(value) {\n    // Convert to string if not already\n    if (value === null || value === undefined) return '';\n    if (typeof value !== 'string') value = String(value);\n\n    let sanitized = value.trim();\n\n    // Check if this looks like an image URL path\n    if (this.security.url.enabled && this.isUrlValue(sanitized)) {\n      const urlResult = this.sanitizeUrl(sanitized);\n      if (urlResult) {\n        return urlResult;  // Returns url('/path/to/image.jpg')\n      }\n      // If URL validation failed, return empty to prevent invalid value\n      return '';\n    }\n\n    // For non-URL values, apply standard sanitization\n    // Remove all dangerous patterns\n    for (const pattern of this.security.dangerousPatterns) {\n      sanitized = sanitized.replace(pattern, '');\n    }\n\n    // Trim to max length to prevent DoS\n    if (sanitized.length > this.security.maxValueLength) {\n      sanitized = sanitized.substring(0, this.security.maxValueLength);\n    }\n\n    return sanitized.trim();\n  },\n\n  /**\n   * Validate API response format\n   * @param {*} response - API response to validate\n   * @throws {Error} If response format is invalid\n   * @returns {boolean} True if valid\n   */\n  validateApiResponse(response) {\n    if (!response || typeof response !== 'object') {\n      throw new Error('ThemeManager: Invalid API response format - expected object');\n    }\n\n    // Validate variables if present\n    if (response.variables !== undefined) {\n      if (typeof response.variables !== 'object' || Array.isArray(response.variables)) {\n        throw new Error('ThemeManager: Invalid variables format - expected object');\n      }\n    }\n\n    return true;\n  },\n\n  // ============ CSS Variables Methods ============\n\n  /**\n   * Apply CSS variables to document root with security validation\n   * Only applies CSS custom properties (--*) to prevent style injection\n   * @param {Object} variables - Object of CSS variable name -> value pairs\n   * @returns {Object} Applied variables (after sanitization)\n   */\n  applyVariables(variables) {\n    if (!variables || typeof variables !== 'object') {\n      console.warn('ThemeManager: applyVariables requires an object');\n      return {};\n    }\n\n    const MAX_KEYS = 200;\n    const entries = Object.entries(variables);\n    if (entries.length > MAX_KEYS) {\n      console.warn(`ThemeManager: Too many variables (${entries.length}). Applying first ${MAX_KEYS} only.`);\n    }\n\n    const limitedEntries = entries.slice(0, MAX_KEYS);\n\n    const applied = {};\n    const root = document.documentElement;\n    let rejectedCount = 0;\n\n    for (const [property, value] of limitedEntries) {\n      // Security: Only allow CSS custom properties\n      if (!this.isValidProperty(property)) {\n        rejectedCount++;\n        console.warn(`ThemeManager: Rejected invalid property \"${property}\" - only CSS custom properties (--*) are allowed`);\n        continue;\n      }\n\n      // Security: Sanitize value\n      const sanitizedValue = this.sanitizeValue(value);\n\n      // Skip setting empty/cleared values to avoid overwriting safe existing values\n      if (!sanitizedValue) {\n        console.warn(`ThemeManager: Skipped empty/unsafe value for \"${property}\"`);\n        continue;\n      }\n\n      // Apply to document root\n      root.style.setProperty(property, sanitizedValue);\n      applied[property] = sanitizedValue;\n    }\n\n    // Store applied variables\n    this.state.appliedVariables = {...this.state.appliedVariables, ...applied};\n\n    if (rejectedCount > 0) {\n      console.warn(`ThemeManager: Rejected ${rejectedCount} invalid properties`);\n    }\n\n    this.emit('theme:variables-applied', {variables: applied});\n\n    return applied;\n  },\n\n  /**\n   * Clear all applied CSS variables\n   */\n  clearVariables() {\n    const root = document.documentElement;\n\n    for (const property of Object.keys(this.state.appliedVariables)) {\n      root.style.removeProperty(property);\n    }\n\n    this.state.appliedVariables = {};\n    this.emit('theme:variables-cleared');\n  },\n\n  /**\n   * Get all currently applied CSS variables\n   * @returns {Object} Applied variables\n   */\n  getAppliedVariables() {\n    return {...this.state.appliedVariables};\n  },\n\n  // ============ API Methods ============\n\n  /**\n   * Load theme configuration from Backend API\n   * Applies CSS variables and optionally loads a stylesheet\n   * Note: Does NOT affect light/dark mode (user controls that via toggle)\n   * @param {string} [url] - Optional URL override (uses config.api.configUrl if not provided)\n   * @returns {Promise<Object>} Theme configuration from API\n   * @throws {Error} If request fails or response is invalid\n   */\n  async loadFromAPI(url) {\n    const configUrl = url || this.config.api.configUrl;\n\n    if (!configUrl) {\n      throw new Error('ThemeManager: No API config URL specified');\n    }\n\n    if (!this.isSafeApiUrl(configUrl)) {\n      throw new Error('ThemeManager: Unsafe API config URL');\n    }\n\n    // Return cached response if available and caching is enabled\n    // But still apply variables and stylesheet (cache saves HTTP request only)\n    if (this.config.api.cacheResponse && this.state.apiCache[configUrl]) {\n      const cached = this.state.apiCache[configUrl];\n      await this.applyApiConfig(cached);\n      this.emit('theme:api-loaded', {config: cached, fromCache: true});\n      return cached;\n    }\n\n    try {\n      // Use HttpClient if available (includes security features)\n      const httpClient = window.http || window.HttpClient;\n\n      let response = await httpClient.get(configUrl, {\n        timeout: this.config.api.timeout,\n        headers: this.config.api.headers\n      });\n\n      // Handle HttpClient response format\n      if (response.success === false) {\n        throw new Error(response.error || 'API request failed');\n      }\n\n      response = response.data?.data || response.data || response;\n\n      // Validate response format\n      this.validateApiResponse(response);\n\n      // Cache the response (per URL)\n      if (this.config.api.cacheResponse) {\n        this.state.apiCache[configUrl] = response;\n      }\n\n      // Apply the configuration\n      await this.applyApiConfig(response);\n\n      this.emit('theme:api-loaded', {config: response});\n\n      return response;\n\n    } catch (error) {\n      this.emit('theme:api-error', {error: error.message, url: configUrl});\n      throw error;\n    }\n  },\n\n  /**\n   * Apply configuration from API response\n   * @private\n   * @param {Object} config - API response with variables\n   */\n  applyApiConfig(config) {\n    // Apply CSS variables if present\n    if (config.variables) {\n      this.applyVariables(config.variables);\n    }\n  },\n\n  isSafeApiUrl(configUrl) {\n    try {\n      const urlObj = new URL(configUrl, window.location.origin);\n      const isHttp = urlObj.protocol === 'https:' || urlObj.protocol === 'http:';\n      const isSameOrigin = urlObj.origin === window.location.origin;\n\n      // Default policy: allow only https same-origin; allow http only if same-origin and current origin is http\n      const originProtocol = window.location.protocol;\n      const httpAllowed = originProtocol === 'http:' && urlObj.origin === window.location.origin;\n\n      if (!isHttp) return false;\n      if (urlObj.protocol === 'https:' && isSameOrigin) return true;\n      if (httpAllowed) return true;\n      return false;\n    } catch (e) {\n      return false;\n    }\n  },\n\n  /**\n   * Reload theme configuration from API (clears cache first)\n   * @returns {Promise<Object>} Fresh theme configuration\n   */\n  async refreshFromAPI() {\n    this.state.apiCache = {};\n    return this.loadFromAPI();\n  },\n\n  // ============ Cleanup ============\n\n  /**\n   * Destroy the ThemeManager instance and clean up all resources\n   * Call this when unmounting the app or cleaning up\n   */\n  destroy() {\n    // Remove system preference listener\n    this.cleanupSystemPreferenceListener();\n\n    // Remove all toggle event listeners\n    this.state.toggles.forEach(element => {\n      if (element._themeToggle) {\n        // Clone to remove all listeners (simple approach)\n        const parent = element.parentNode;\n        if (parent) {\n          const clone = element.cloneNode(true);\n          delete clone._themeToggle;\n          parent.replaceChild(clone, element);\n        }\n      }\n    });\n    this.state.toggles.clear();\n\n    // Clear applied CSS variables\n    this.clearVariables();\n\n    // Remove ready/transition classes from body\n    document.body.classList.remove(this.config.transition.readyClass);\n    document.body.classList.remove(this.config.transition.transitionClass);\n    document.body.classList.remove(this.config.transition.loadingClass);\n\n    // Clear cache\n    this.state.apiCache = {};\n\n    // Reset state\n    this.state.current = null;\n    this.state.initialized = false;\n    this.state.ready = false;\n    this.state.transitioning = false;\n    this.state.appliedVariables = {};\n\n    this.emit('theme:destroyed');\n  },\n\n  /**\n   * Reset ThemeManager to default state without full destroy\n   * Useful for re-initialization with different config\n   */\n  reset() {\n    // Remove system preference listener\n    this.cleanupSystemPreferenceListener();\n\n    // Clear variables but don't remove listeners\n    this.clearVariables();\n\n    // Clear cache\n    this.state.apiCache = {};\n\n    // Reset state flags\n    this.state.current = null;\n    this.state.initialized = false;\n    this.state.ready = false;\n\n    // Remove ready class\n    document.body.classList.remove(this.config.transition.readyClass);\n    document.body.classList.remove(this.config.transition.loadingClass);\n\n    this.emit('theme:reset');\n  }\n};\n\n// LocalStorage helpers with safety (quota/blocked storage)\nThemeManager.getStoredTheme = function() {\n  if (!this.config.storageKey) return null;\n  try {\n    return localStorage.getItem(this.config.storageKey);\n  } catch (e) {\n    console.warn('ThemeManager: Unable to read from localStorage', e);\n    return null;\n  }\n};\n\nThemeManager.setStoredTheme = function(theme) {\n  if (!this.config.storageKey) return;\n  try {\n    localStorage.setItem(this.config.storageKey, theme);\n  } catch (e) {\n    console.warn('ThemeManager: Unable to write to localStorage', e);\n  }\n};\n\n// Register with Now framework\nif (window.Now?.registerManager) {\n  Now.registerManager('theme', ThemeManager);\n}\n\n// Register with ComponentManager for data-component=\"theme\" support\nif (window.ComponentManager) {\n  ComponentManager.define('theme', {\n    template: null,\n\n    // Called when component is mounted\n    mounted() {\n      ThemeManager.enhance(this.element);\n    },\n\n    // Called when component is destroyed\n    destroyed() {\n      if (this.element?._themeToggle) {\n        ThemeManager.state.toggles.delete(this.element);\n      }\n    }\n  });\n}\n\n// Auto-initialize theme components on DOM ready (fallback if ComponentManager didn't init during load)\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    document.querySelectorAll('[data-component=\"theme\"]').forEach(el => {\n      if (!el._themeToggle) {\n        ThemeManager.enhance(el);\n      }\n    });\n  });\n}\n\nwindow.ThemeManager = ThemeManager;\n"],"names":["Now","version","managers","Map","plugins","paths","framework","application","components","templates","translations","resources","core","DEFAULT_CONFIG","debug","environment","strictMode","mainSelector","auth","enabled","type","autoInit","endpoints","login","logout","verify","refresh","redirects","afterLogin","afterLogout","unauthorized","forbidden","router","mode","base","autoGuard","defaultRequireAuth","publicPaths","guestOnlyPaths","conventions","public","roles","skipRouter","errorHandling","action","target","preservePath","message","template","notify","notFound","title","component","reactive","autoRender","batchUpdates","batchDelay","devTools","logStateChanges","stateManager","persistent","storage","security","csrf","tokenName","headerName","xss","csp","validateInput","sanitizeOutput","performance","logger","inspector","monitoring","metrics","warnings","errorReporting","i18n","defaultLocale","availableLocales","fallbackLocale","serviceWorker","serviceWorkerPath","scope","http","baseURL","timeout","retries","retryDelay","name","app","description","author","homepage","state","initialized","loading","error","loadedResources","Set","activeApp","startTime","init","options","this","setupErrorHandling","config","mergeConfig","detectedBasePath","detectBasePath","startsWith","length","endsWith","slice","basePath","e","console","warn","setupDevTools","loadResources","initializeManagers","_b","_a","initializePlugins","_d","_c","initializeComponents","_e","_f","_g","authTemplate","_h","_i","AuthTemplateManager","window","_j","registerManager","endPerformanceTracking","handleError","createApp","Error","startPerformanceTracking","mount","async","el","mountApp","has","get","initializeAppPlugins","publicRoute","path","RouterManager","register","requireAuth","isPublic","protectedRoute","adminRoute","AuthGuards","beforeEnter","adminOnly","roleRoute","Array","isArray","requireRole","guestRoute","requireGuest","updateAuthTemplates","container","document","body","authTemplateManager","getManager","processContainer","refreshAuthTemplates","forceUpdate","translate","key","params","emit","event","data","eventManager","timestamp","Date","now","mountEl","querySelector","innerHTML","use","plugin","set","instance","manager","componentManager","filename","split","pop","replace","registrationName","toLowerCase","maxRetries","Promise","resolve","setTimeout","errorMsg","from","keys","join","resource","resolvePath","loadResource","add","match","url","ext","element","createElement","rel","href","src","reject","onload","onerror","head","appendChild","endTime","recordPerformance","duration","failed","remove","String","pathMap","typeBase","parts","trim","push","tb","res","getBasePath","resolveUrl","u","test","buildUrl","cleanParts","filter","part","map","allParts","getCurrentPath","location","pathname","getCurrentDir","getCurrentRelativePath","currentPath","relativePath","substring","scripts","getElementsByTagName","nowScript","find","script","includes","scriptSrc","URL","isBundleAvailable","bundlePath","fetch","method","ok","handleEvent","componentId","closest","dataset","instances","methods","call","source","line","column","onunhandledrejection","reason","context","errorData","stack","notification","notificationError","eventError","logErrorMetrics","__NOW_DEV__","inspect","getManagers","getPlugins","getResources","getConfig","getState","getPerformance","getPerformanceMetrics","reload","clearCache","clear","log","label","metric","start","end","checkPerformanceWarning","threshold","initialization","warning","toFixed","forEach","Object","override","merged","value","entries","getPlugin","cleanup","reset","Utils","string","random","crypto","getRandomValues","Uint8Array","b","toString","padStart","escape","unsafe","sanitizeFilename","capitalize","str","charAt","toUpperCase","humanize","s","hasUnderscore","result","c","truncate","ending","slugify","normalize","stripTags","html","div","textContent","innerText","applyFormatters","formatters","reduce","val","formatter","args","isNaN","format","filters","builtinFormatters","number","decimals","Number","toLocaleString","minimumFractionDigits","parseInt","maximumFractionDigits","currency","style","percent","lowercase","uppercase","date","toLocaleDateString","dateStyle","time","toLocaleTimeString","timeStyle","default","defaultValue","num","amount","locale","Intl","NumberFormat","percentage","fileSize","bytes","i","Math","floor","round","pow","precision","factor","ceil","trunc","d","getTime","I18nManager","getCurrentLocale","LanguageManager","getCurrentLanguage","navigator","language","userLanguage","useBE","baseLocale","year","getFullYear","displayYear","month","getMonth","monthFull","monthShort","tokens","YYYY","YY","MMMM","MMM","MM","M","DD","getDate","D","HH","getHours","H","hh","h","mm","getMinutes","ss","getSeconds","A","a","fromTimestamp","toTimestamp","unit","setFullYear","setMonth","setDate","setHours","setMinutes","setSeconds","moveDate","days","moveMonth","months","moveYear","years","timeToMinute","timeStr","hours","minutes","timeToSecond","seconds","isLeapYear","daysInMonth","compare","date1","date2","d1","d2","diffTime","getLocale","getMonthNames","getMonthNamesShort","getDayNames","getDayNamesNarrow","object","deepClone","obj","item","clone","merge","sources","shift","isObject","assign","travel","regexp","prototype","Boolean","array","chunk","arr","size","v","unique","seen","k","shuffle","j","groupBy","grouped","flatten","depth","flat","concat","findBy","validate","email","phone","digitsOnly","password","score","isStrong","dom","create","tag","attributes","children","className","dataKey","dataValue","setAttribute","child","createTextNode","toggleClass","classNames","classList","toggle","selector","isVisible","offsetWidth","offsetHeight","getClientRects","copyToClipboard","text","clipboard","isSecureContext","writeText","textArea","position","left","top","focus","select","successful","execCommand","removeChild","browser","info","ua","userAgent","tem","exec","appName","appVersion","splice","isMobile","orientation","innerHeight","innerWidth","session","ttl","expires","sessionStorage","setItem","JSON","stringify","getItem","parsed","parse","removeItem","generateUUID","randomUUID","r","function","debounce","func","wait","executedFunction","clearTimeout","throttle","limit","inThrottle","debounceAsync","cookie","opts","domain","secure","sameSite","cookieStr","encodeURIComponent","setTime","toUTCString","escapedName","regex","RegExp","decodeURIComponent","removeOptions","isEnabled","indexOf","getQueryParams","searchParams","addQueryParams","urlObj","append","basename","dirname","extname","lastDotIndex","lastIndexOf","keyboard","isKey","modifiers","shiftKey","ctrl","ctrlKey","alt","altKey","meta","metaKey","isEnter","isShiftEnter","isCtrlEnter","isEscape","isTab","isShiftTab","isArrow","NotificationManager","maxVisible","animation","dismissible","rtl","dir","progressBar","pauseOnHover","closeButton","icons","aria","notifications","queue","isProcessing","createContainer","setupEventListeners","setPosition","validPositions","pos","show","createNotification","existingOfSameType","n","dismiss","id","renderNotification","content","messageClass","icon","closeBtn","onclick","addProgressBar","requestAnimationFrame","setupAutoDismiss","progress","paused","width","transition","timeLeft","lastUpdate","checkDismiss","getElementById","removed","cleanUp","delete","processQueue","addEventListener","once","notificationObj","destroy","success","ErrorManager","notificationDuration","lastError","createError","additional","param","index","normalizeError","handle","normalizedError","logLevel","level","EventManager","ErrorRenderer","renderError","containerId","showStack","showDetails","actions","errorHtml","generateErrorHtml","attachEventListeners","errorMessage","errorStack","button","escapeHtml","toggleBtn","display","transform","reloadBtn","homeBtn","querySelectorAll","btn","customHandlers","render404","renderNetworkError","retry","renderAuthError","module","exports","storageKey","useBrowserLocale","noTranslateEnglish","current","loadInitialLocale","disabled","setLocale","force","loadTranslations","documentElement","setStoredLocale","updateTranslations","forced","attempt","response","headers","Accept","credentials","status","statusText","json","translationCount","isLastAttempt","attempts","errorType","delay","min","elements","dataI18n","getAttribute","translation","getTranslation","interpolate","translateAttributes","elementsUpdated","translateAttributesIn","htmlLang","stored","getStoredLocale","browserLocale","updateElements","lngPattern","attrs","attr","currentLocale","getFallbackTranslation","defaultTranslations","trans","getTranslations","getTranslator","targetLocale","getKeyTranslations","hasTranslation","localStorage","registerLangToggle","_langToggleRegistered","compManager","ComponentManager","define","mounted","avail","locales","themeMapAttr","themeMap","p","pair","labelEl","menuEl","menuItems","menuLocales","updateLabel","cur","lang","removeAttribute","clickHandler","link","preventDefault","next","themeMgr","setTheme","err","idx","nextLocale","__langToggleClick","__langToggleUpdate","on","destroyed","removeEventListener","off","readyState","BackdropManager","baseZIndex","background","opacity","useTransition","preventScroll","backdrops","activeBackdrops","nextId","isInitialized","handleKeydown","bind","createBackdropElement","targetElement","backdrop","styles","height","pointerEvents","zIndex","parentNode","insertBefore","onClick","backdropOptions","backdropData","overflow","hide","update","newOptions","hideAll","lastId","getBackdropById","values","isActive","Modal$1","Modal","constructor","maxWidth","maxHeight","onShow","onShown","onHide","onHidden","backdropOpacity","backdropColor","substr","backdropId","visible","boundData","createModal","bindEvents","modal","inert","dialog","header","_bindCloseButtons","focusable","firstFocusable","lastFocusable","activeElement","focusedElement","blur","_cleanupModalElements","FormManager","destroyContainer","ElementManager","setContent","DocumentFragment","Node","_scanModalElements","elementManager","formManager","scan","setTitle","titleEl","bindData","_setElementContent","updateData","getData","tagName","sanitizedValue","_sanitizeValue","hasAttribute","_sanitizeHTML","strValue","_sanitizeURL","_sanitizeText","DOMPurify","sanitize","origin","protocol","newBtn","cloneNode","replaceChild","ModalDataBinder","galleryClass","bindAttribute","targetAttribute","contentAttribute","defaultEffect","effectDuration","swipeThreshold","modalInstances","galleryData","bindModalTriggers","bindGalleryNavigation","bindTouchNavigation","trigger","handleModalTrigger","navBtn","direction","modalNav","navigateGallery","touchStartX","touchStartY","touchEndX","touchEndY","currentModal","changedTouches","screenX","screenY","passive","deltaX","deltaY","abs","modalId","parseBindData","modalBind","evaluateBindData","isGallery","modalGallery","setupGallery","openModalWithData","gallery","bindStr","pairs","expr","templateContext","findTemplateContext","evaluateExpression","category","parentElement","getElementIndex","prop","attrName","items","currentIndex","loop","modalGalleryLoop","effect","modalEffect","newIndex","applyGalleryEffect","modalRef","modalElement","isPreExisting","exitClass","enterClass","updateModalData","contains","_bindDataToElement","_showPreExistingModal","existingContent","existingTitle","modalInitialized","_bindPreExistingModalEvents","_backdropId","closeModal","escHandler","_escHandler","getModalData","asyncTimeout","maxListeners","traceEvents","interval","maxAge","batchSize","events","groups","patterns","listenerCounts","middleware","history","cleanupTimer","lastCleanup","startCleanup","removePatternListener","pattern","identifier","callback","getEventPath","processPromises","promises","allSettled","results","handleListenerError","handleAsyncError","runMiddleware","eventPath","stopPropagation","stopImmediatePropagation","addToHistory","currentEvent","emitPatternMatches","listeners","listener","updateListenerCount","handleAsyncListener","groupName","groupEvents","groupListeners","handleEmitError","createPattern","listenerOptions","priority","group","onError","isPattern","patternListener","retryCount","active","cleanupStaleListeners","addToGroup","sortListeners","count","asyncResults","race","all","_","addPatternListener","removeFromGroup","emitGroup","hook","handleMiddlewareError","clearInterval","setInterval","visibilityState","processed","delta","newCount","max","sorted","sort","getParentEvent","promise","errorObj","listenerId","getEventInfo","listenerCount","getDebugInfo","eventCount","fromEntries","hasData","prevented","propagationStopped","types","m","historyLength","system","memoryUsage","memory","usedJSHeapSize","totalJSHeapSize","EventSystemManager","cleanupInterval","maxMemoryUsage","delegation","matchingStrategy","maxDelegationDepth","optimizeSelectors","rootElement","memoryManagement","checkInterval","maxHandlersPerElement","maxCacheSize","gcThreshold","detailedTracking","filtering","maxThrottleRate","debounceWait","highFrequencyEvents","handlers","elementHandlers","idCounter","eventPaths","WeakMap","delegationCache","selectorCache","delegatedEvents","selectorsByType","selectorMatchCache","uiEventQueue","rafScheduled","memoryStats","handlerCount","cacheSize","weakMapSize","lastGC","peakMemoryUsage","memoryWarnings","elementStats","gcTimer","throttleTimers","debounceTimers","lastEventTimes","filteredCount","windowEvents","nonPassiveEvents","supportedEvents","uiEvents","setupGlobalHandlers","setupCleanup","observeDOM","setupMemoryMonitoring","capture","handleWindowEvent","addHandler","handler","isWindowEvent","isDocumentEvent","Element","entry","typeSelectors","removeHandler","typeHandlers","shouldProcessEvent","enhancedKeyEvent","handleKeyboardEvent","_enhanced","queueUIEvent","processEvent","originalEvent","code","keyCode","isAltEnter","isArrowKey","stopped","immediateStopped","currentTarget","processedHandlers","executeHandler","processUIEventQueue","processElementHandlers","staleIds","shouldHandleEvent","delegateTarget","findDelegateTarget","cacheKey","cache","targetCache","wrappedEvent","matches","handlerContext","boundHandler","handlerId","composedPath","MutationObserver","mutations","mutation","removedNodes","node","nodeType","isConnected","removeElementHandlers","observe","childList","subtree","removeComponentHandlers","handlersToRemove","performGC","checkMemoryUsage","stats","gatherMemoryStats","updateMemoryStats","shouldTriggerGC","logMemoryWarnings","estimateWeakMapSize","sampleSize","sample","step","sampleCount","estimatedSize","maxHandlers","some","handlersRemoved","cachesCleared","isHandlerStale","clearUnusedCaches","age","isElementVisible","isRapidFire","StateManager","persistence","blacklist","encrypt","maxSize","include","batch","strict","modules","computed","watchers","subscriptions","subscriberCount","activeSubscriptions","historyIndex","isTimeTraveling","batchQueue","batchTimeout","restoreState","setupReactivity","Proxy","property","notifyWatchers","hasModule","registerModule","oldModule","subs","sub","unsubscribe","newEntry","initialState","registeredModule","getter","registerComputed","watch","getModuleContext","processModule","processMutations","processActions","getters","acc","payload","getModuleGetters","commit","dispatch","defineProperty","moduleName","mutationName","actionName","deps","currentComputed","isValidPath","getStateValue","dep","dependent","snapshot","subscribe","subId","subscription","immediate","deep","subscriptionId","found","notifySubscribers","oldValue","cleanupSubscriptions","maxSubscriptionAge","timeTravel","historyEntry","persistState","decrypt","task","toISOString","moduleStates","batchQueueSize","hasState","getModuleSubscriberCount","every","ScrollManager","offset","easing","selectors","tracked","anchors","waypoints","ignore","reveal","nav","sections","parallax","linear","t","easeInOutCubic","easeOutQuart","easeInQuad","observer","maxFPS","skipThreshold","maxQueue","restoration","mobile","touchAction","momentumScroll","pullToRefresh","touchThreshold","accessibility","announceChanges","smoothFocus","ariaLabels","focusableSelectors","scroll","infinite","loadMore","speed","color","snap","stop","align","section","highlight","activeClass","updateHash","highlightClass","smoothScroll","autoScroll","excludeSelector","hashChangeEnabled","isScrolling","isLoading","activeAnimation","positions","observers","lastPosition","scrollRestoration","rafId","lastFrameTime","scrollQueue","activeSection","scrollDirection","scrollQueueLock","setupSmoothScroll","IntersectionObserver","initializeCore","initializeObservers","setupScrollTracking","setupWaypoints","initializeMobileSupport","initializeAccessibility","initScrollRestoration","initializeScrollFeatures","contentArea","initializeAnimationSystem","anchor","targetId","scrollTo","hash","initInfiniteScroll","initParallax","initProgressBar","initScrollSnap","initSectionHighlight","initScrollNav","handleIntersection","rootMargin","handleMutations","ResizeObserver","handleResize","startObservers","waypoint","isIntersecting","triggered","replaceState","shouldUpdateWaypoints","addedNodes","attributeFilter","intersection","resize","navigation","handleRouteChange","scrollToTop","scrollToBottom","scrollBy","behavior","removeAllListeners","eventName","cancelScroll","disconnect","timer","isProcessingEvents","announcer","cleanSelector","HTMLElement","finalOptions","elementRect","getBoundingClientRect","scrollTop","pageYOffset","targetY","queueScroll","animateScroll","processScrollQueue","updateScrollPosition","getScrollPosition","cancelAnimationFrame","scrollToContent","finalElement","addWaypoint","removeWaypoint","unobserve","handleScrollDirection","y","x","pageXOffset","easingFunctions","easeOutBack","c1","startY","lastFrame","easingFn","framesToSkip","animate","currentTime","elapsed","eased","currentY","onVirtualDOMUpdate","virtualDOMHooks","notifyVirtualDOM","requestIdleCallback","apply","handleScroll","updateScrollState","handleScrollEnd","scrollWaypoint","scrollOffset","scrollCallback","touches","clientY","clientX","touchY","touchX","diffY","diffX","scrollHeight","clientHeight","WebkitOverflowScrolling","overscrollBehavior","cssText","rect","bottom","right","scrolled","scrollY","parallaxSpeed","yPos","handleInfinite","finally","contentEl","handleScrollProgress","docHeight","total","DialogManager","draggable","closeOnEscape","closeOnBackdrop","focusTrap","alert","confirm","prompt","dialogs","activeDialogs","previousFocus","errorHandlers","backdropManager","setupKeyboardEvents","createDialog","buttons","class","cancel","input","custom","onClose","customClass","bodyEl","close","setupButtons","setupDraggable","setupFocusTrap","focusableElements","cursor","isDragging","startX","startLeft","startTop","startDrag","doDrag","newLeft","newTop","maxX","maxY","stopDrag","footer","dialogData","primaryButton","dispatchEvent","CustomEvent","detail","bringToFront","maxZ","newZ","closeAll","topDialogId","topDialog","cleanupDialog","_startDrag","_keyHandler","_dragHandlers","cleanupError","TemplateManager","cacheDuration","allowedOrigins","allowedExtensions","maxContentSize","validateMarkup","allowedTags","allowedAttributes","img","option","textarea","form","iframe","maxCacheAge","maxHandlerAge","serverPaths","itemTimestamps","performanceObserver","activeScripts","setupPerformanceMonitoring","cleanupHandlers","cleanupCache","startCleanupInterval","cleanupScripts","loadFromServer","cached","validateRequest","throwOnError","contentType","contentLength","processedContent","processContent","getContextForPath","processDataDirectives","processInterpolation","sanitizeElement","root","ALLOWED_TAGS","ALLOWED_ATTR","IN_PLACE","elementsToRemove","attributesToRemove","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","currentNode","isGlobalAllowed","isTagAllowed","isUrlAttr","isStyleAttr","safe","sanitizeUrlAttribute","safeStyle","sanitizeInlineStyle","nextNode","trimmed","lower","proto","styleText","colonIndex","sanitizeStyles","safeEntries","parser","DOMParser","parseError","parseFromString","pathLower","normalizePath","isValidUrl","PerformanceObserver","list","getEntries","entryType","entryTypes","getEntriesByType","recordError","processDataScript","scriptFn","fn","cleanupFn","scriptInfo","processTemplate","_apiComponent","skipScan","processTemplateString","SHOW_TEXT","ExpressionEvaluator","evaluate","hasOperators","_updateQueue","parentId","cleanupComponentHandlers","dataForElements","directive","processDataText","processDataHtml","processDataIf","processDataClass","processDataAttr","processDataStyle","processDataOn","processDataContainer","processDataModel","processDataChecked","processDataAnimation","processDataFor","parentContext","expression","_textBinding","existingHasData","originalState","originalContext","lastValue","updateText","currentText","ctx","newText","valueToString","setupReactiveUpdate","_htmlBinding","lastHtml","updateDataHtml","sanitized","updateHtml","getHtmlContent","_ifBinding","parent","nextSibling","comment","createComment","condition","isAnimating","originalStyles","getComputedStyle","animationName","animated","binding","evaluateCondition","cleanupElement","_eventBinding","cleanupReactiveUpdate","destroyComponent","handleAnimation","showing","animationClasses","onAnimationEnd","updateVisibility","shouldShow","initializeExistingElements","_classBinding","hasTernaryClassSwitch","hasBindingColon","ternary","updateClassTernary","updateClass","updateClassExpression","classValue","addedClasses","cls","classes","_Binding","updateAttr","attrValue","getInstanceByElement","propertyHandlers","isBooleanAttr","_styleBinding","cloneState","lastStyles","updateStyles","styleObj","safeStyles","allowedProperties","urlValue","sanitizeUrlValue","urlMatch","dangerousProtocols","lowerUrl","mime","base64Part","itemName","arrayExpr","_forBinding","lastHash","updateList","currentHash","templateElement","childNodes","childContext","prevent","self","trusted","isTrusted","enter","tab","esc","space","middle","lastTriggered","eventInfo","handlerExpr","eventType","modifierList","oldHandler","methodMatch","methodName","argsStr","isGlobalFunction","arg","$event","lastTrigger","modifier","modifierFn","evaluatedArgs","_containerBinding","updateContainer","loadComponent","componentRef","renderComponent","_modelBinding","initialValue","selectionStart","selectionEnd","lazy","mod","updateModel","newValue","_modelHandlers","change","checked","files","selected","selectedOptions","opt","keydown","modelValue","getModelValue","_checkedBinding","updateChecked","currentChecked","isChecked","hasOwnProperty","cleanupComponent","currentComputation","pendingUpdates","setStateValue","processTemplateContent","render","processedTemplate","tempDiv","firstChild","registerEventHandler","argsString","activeIds","stopCleanupInterval","performCleanup","onComponentDestroy","maxBatch","ReactiveHelpers","updateType","updateFn","wrappedUpdate","updateKey","updateFnKey","_context","cleanupAllReactiveUpdates","templateCache","setupI18nListeners","updateAllComponents","_mounted","_destroyed","_updating","renderInstance","definition","existing","_registeredFrom","_getCurrentScriptSource","renderStrategy","processedDefinition","processDefinition","lines","validElement","beforeCreate","created","beforeMount","beforeUpdate","updated","beforeDestroy","errorCaptured","errorBoundary","setupElement","componentName","existingInstance","props","extractProps","catch","ApiComponent","initElements","propName","parseFloat","initializeComponent","_definition","refs","parseEventSelector","setupEvents","eventSystem","_events","targetSelector","isDOMEvent","wrappedHandler","originalHandler","cleanupEvents","eventConfig","ReactiveManager","createComponentState","bindComponentEvents","isValidComponentElement","setupExistingElement","getTemplate","newElement","firstElementChild","destroyByElement","destroyFormByElement","setupElementAttributes","inlineTemplate","templateId","templateEl","createDefaultElement","processor","createVNode","elementToVNode","vnode","getElementProps","processTextContent","patch","oldVNode","newVNode","createRealNode","shouldReplace","updateProps","oldChildren","newChildren","oldProps","newProps","childNode","templatePath","_destroying","_destroyedCalled","templateManager","componentElements","isComponentInitialized","getInitializedComponents","getComponentStatus","_vnode","renders","totalRenderTime","lastRenderTime","averageRenderTime","slowRenderThreshold","recordRender","renderTime","_performance","handleComponentError","phase","_errorBoundary","fallback","loadTemplate","_parentComponent","scheduleUpdate","updates","timeSpan","_updateScheduled","processUpdate","_childComponents","waitForElement","deepCompare","obj1","obj2","keys1","Reflect","ownKeys","keys2","desc1","getOwnPropertyDescriptor","desc2","compareObjects","obj1Keys","obj2Keys","_compareObjects","thisKeys","instanceKeys","sameKeys","diffKeys","isEqual","stateCounts","inst","totalInstances","_k","currentEffect","effects","dependencies","updateQueued","rawToProxy","proxyToRaw","cleanedEffects","WeakSet","track","__reactiveId","depsMap","triggerEffects","runEffects","runEffect","queueMicrotask","flushUpdates","generateId","enumerable","configurable","createArrayProxy","prevEffect","isEffect","cleanupEffect","isReactive","__isReactive","dirty","arg1","arg2","arg3","watchEffect","watchProp","currentValue","isProxy","findComponentForTarget","componentStates","isStateTarget","queueEffect","reactiveState","watchDeep","clonedValue","lastKey","_eventHandlers","unbindComponentEvents","createStateProxy","notifyArrayChange","notifyChange","watcherSet","getWatchers","watcher","runWithTracking","activeWatchers","isWatcherValid","computedCache","validateState","createComputation","computation","isComputing","runComputation","_skipReactive","previousEffect","_bindComponentEvents","watchComputation","_addDependency","addDependency","triggerUpdate","_triggerUpdate","cleanupDependencies","isIterable","Symbol","iterator","getDependenciesArray","isValidComputation","dependencySet","_track","_createComponentState","validateConfig","oldLength","newLength","enableDebug","DEBUG","disableDebug","handleLifecycle","setupComponentReactivity","cleanupComponentReactivity","updateComponentReactivity","isComponentDependency","keyWatchers","batchDepth","_l","ExpressionEvaluator$1","__publicField","_m","stringMatch","ternaryMatch","trueExpr","falseExpr","conditionResult","getPropertyPath","tokenize","postfix","toPostfix","evaluatePostfix","pushToken","char","quote","operator","output","operators","precedence","token","arity","WatchManager","setupWatchers","_watchers","watchConfig","getDeepValue","finalHandler","newVal","oldVal","newError","arrayKey","deepEqual","keysA","keysB","triggerWatchers","cleanupWatchers","timeoutId","debouncedFn","StorageManager","defaultDB","defaultVersion","defaultStoreConfig","keyPath","autoIncrement","indexes","storeSizeWarningThreshold","cacheLookups","cacheMaxAge","defaultAdapter","statistics","trackOperations","trackTiming","stores","databases","databaseSchemas","operations","reads","writes","deletes","queries","timing","totalTime","operationCount","errors","storeSize","isSupported","dbConfig","createDatabase","indexedDB","db","currentVersion","request","open","onsuccess","onupgradeneeded","oldVersion","newVersion","storeName","storeConfig","objectStoreNames","store","transaction","objectStore","existingIndexNames","indexNames","indexConfig","createIndex","createObjectStore","dbName","executeOperation","getDatabase","oncomplete","invalidateStoreCache","counter","addNext","abort","innerError","transactionError","updateStoreStats","updateNext","put","getById","getAll","skipped","Infinity","limitParam","getAllRequest","range","openCursor","continue","query","IDBKeyRange","only","cursorRequest","countRequest","invalidateItemCache","deleteByQuery","exists","createKeyRange","value2","lowerOpen","upperOpen","bound","upperBound","lowerBound","schema","totalSize","formatSize","units","unitIndex","getStorageUsage","formatted","totalFormatted","getStatistics","averageOperationTime","storeNames","averageTime","deleteDatabase","operation","completed","adapters","indexeddb","_data","adapterType","adapter","local","addWithSync","syncOptions","syncManager","sync","itemToSync","addPendingOperation","updateWithSync","deleteWithSync","closeAllConnections","_n","SyncManager","autoSync","syncInterval","retryStrategy","pendingOperationsStore","onSyncComplete","onSyncError","debounceInterval","concurrentRequests","priorityMapping","high","medium","low","minRetryDelay","maxRetryDelay","defaultIdField","defaultHeaders","prefix","tokenKey","online","onLine","syncing","pendingSync","lastSyncTime","syncTimerId","syncPromise","debounceTimer","activeRequests","operationsProcessed","syncQueue","failedOperations","storageManager","storageError","dbError","handleOnline","handleOffline","hidden","debouncedSync","enable","startAutoSync","disable","stopAutoSync","_storePendingOperation","pendingOp","nextRetry","syncAll","pendingOps","workers","fill","processOperationsWorker","offline","processOperation","endpoint","getEndpoint","apiMethod","apiService","httpClient","simpleFetch","handleSyncError","getFailedOperations","getPendingCount","getPendingOperations","resetFailedOperations","op","clearPendingOperations","deletePendingOperation","updateOperation","getSyncStatus","autoSyncEnabled","_o","TokenService$1","TokenService","storageMethod","cookieName","refreshCookieName","localStorageKey","cookieOptions","parseToken","decoded","_base64UrlDecode","isTokenExpired","exp","getTokenExpiry","getUserId","getUserRoles","base64","atob","charCodeAt","getToken","additionalData","tokenData","setCookie","cookieString","getCookie","cookies","cookieValue","clearOptions","getUser","user","isAuthenticated","tokenService","AuthManager","me","social","csrfIncludeSafeMethods","rateLimiting","maxLoginAttempts","lockoutTime","autoRefresh","refreshBeforeExpiry","clearAllCachesOnLogout","cookieMaxAge","authenticated","loginAttempts","lockedUntil","refreshTimer","rateLimitData","ensureTokenService","baseCookieOptions","hostname","buildTokenCookieOptions","configuredMaxAge","service","expiry","secondsRemaining","rehydrateAccessToken","ApiService","clearAccessToken","setAccessToken","getAuthStrategy","strategy","authStrategy","resolveTokenFromData","resolveUserFromData","username","extractTokenFromHeaders","authorization","Authorization","getRefreshToken","refresh_token","buildRefreshRequestOptions","sendCredentials","csrfToken","getCSRFToken","fetchAccessToken","fallbackUser","preferRefresh","preferVerifyFallback","includeCreds","refreshToken","post","tokenFromData","tokenFromHeaders","ensureAccessToken","tokenCandidate","sharedAuthConfig","mergedEndpoints","bearerAuth","SecurityManager","setupSecurityIntegration","setupHttpInterceptors","setupRateLimiting","checkAuthStatus","setupAutoRefresh","addRequestInterceptor","existingHeaders","Headers","addResponseInterceptor","newCsrfToken","updateCSRFToken","originalRequest","_retry","redirectTo","resetTime","checkRateLimit","recordLoginAttempt","rehydratedToken","resolvedUser","clearAuthData","clearAllCaches","authGuard","ServiceWorkerManager","caches","cacheNames","handleAuthCheckError","handleJWTRefresh","handleSecurityError","authenticate","rateLimitResult","allowed","retryAfter","fetchOptions","headerToken","resolvedToken","setAuthenticatedUser","userData","ensuredToken","userDataToStore","authResult","setUserResult","ensureOptions","preventRedirect","getIntendedUrl","callServer","allowFallback","refreshInterval","hasPermission","permission","userPermissions","permissions","hasRole","role","userRoles","saveIntendedUrl","normalizedPath","routerBase","normalized","intendedRoute","search","intendedUrl","currentUrl","separator","navigate","metaToken","bubbles","cancelable","getError","clearError","socialLogin","provider","endpointTemplate","popup","handleSocialPopup","checkClosed","closed","messageHandler","then","handleAuthCallback","callbackData","error_description","loginWithToken","_p","MODES","HISTORY","HASH","autoDetectBase","preserveUrl","preserveQuery","customHandler","trailingSlash","redirect","ignorePaths","showLoadingNotification","initialLoad","preserveContent","skipIfContent","contentSelector","forceRoute","routes","globalGuards","beforeEach","afterEach","previous","guard","runBeforeEachGuards","to","runAfterEachGuards","nowBase","detectedBase","initAuthIntegration","storeInitialContent","applyAuthConventions","getPath","shouldHandleInitialRoute","isInitialLoad","matchRoute","route","translateTitle","authManager","authProcessed","authRequired","isGuestOnly","matchConvention","regexPattern","cleanPath","queryString","hashFragment","queryParams","URLSearchParams","mergedParams","handleTrailingSlash","hashPart","newUrl","pushState","HashChangeEvent","handleNotFound","globalGuardResult","guardResult","checkRouteAuth","handleAuthRedirect","beforeLeave","shouldContinue","hideLoading","finalQueryString","fullUrl","showLoading","resolveTemplate","extractText","mainContent","shouldScroll","isNotFoundPage","executePageScripts","scriptElement","unauthenticated","originalPath","RedirectManager","storeIntendedRoute","authentication_required","already_authenticated","insufficient_role","insufficient_permission","createRoutePattern","ignoreTrailingSlash","routePath","paramNames","extractParamNames","childPath","childConfig","fullChildPath","segment","baseEl","scriptTags","includeQuery","hashPath","pathToConvert","getQuery","hasHash","pathToCheck","baseUrl","hashUrl","initialContent","handleClick","handlePopState","handleHashChange","ensureHashModeUrl","extractRouteFromHref","paramName","resolvedUrl","processRoute","resolvedPath","paramPattern","basePart","applyBaseToTemplate","fetchPath","main","f","cloned","currentQuery","targetPath","isError","renderDefault404Page","mainElement","errorPageHTML","getParams","getParam","hasRoute","getRoute","getRoutes","_q","SecurityConfig","development","validateOnSubmit","jwt","rateLimit","globalLimit","windowMs","validation","sanitizeInput","maxInputLength","production","tokenLength","validateSignature","perEndpoint","validateOutput","directives","testing","getMergedConfig","overrides","baseConfig","mergeDeep","targetValue","sourceValue","tokenUrl","metaName","requireForMethods","excludePaths","refreshEndpoint","algorithm","issuer","audience","skipSuccessfulRequests","skipFailedRequests","keyGenerator","onLimitReached","sanitization","removeScripts","removeEvents","reportUri","jwtToken","rateLimits","requestCounts","lastTokenRefresh","securityHeaders","violations","initCSRF","initJWT","initRateLimit","initCSP","refreshCSRFToken","startCSRFRefresh","injectCSRFIntoForms","csrf_token","updateCSRFMeta","updateCSRFInForms","injectCSRFIntoForm","isPathExcluded","csrfSetting","csrfInput","csrfRefreshTimer","getJWTToken","validateJWTToken","clearJWTToken","startJWTRefresh","iss","aud","jwtRefreshTimer","timeUntilRefresh","refreshJWTToken","refreshUrl","loadRateLimits","cleanupExpiredLimits","generateRateLimitKey","endpointConfig","checkLimit","remaining","saveRateLimits","btoa","addCSPMeta","handleCSPViolation","violation","violatedDirective","uri","blockedURI","sourceFile","lineNumber","reportCSPViolation","shouldAddCSRF","sanitizeRequestData","newToken","handleCSRFError","handleRateLimitError","sanitizeObject","FormData","setupFormInterceptors","enhanceForm","securityEnhanced","extractFormSecurityConfig","applyFormRateLimit","getDataBool","rateLimitEndpoint","rateLimitLimit","rateLimitWindow","originalSubmit","onsubmit","rateLimitConfig","showRateLimitError","showNotification","messageContainer","attribute","customEvent","getCSRFTokenForForm","refreshTokens","isRateLimited","getRateLimitStatus","addCSRFToRequest","_r","ResponseHandler","defaultRedirectDelay","defaultNotificationDuration","allowEval","autoHandleFormResponses","actionHandlers","registerStandardHandlers","registerHandler","onConfirm","executeCallback","modalAction","handleModalShow","performRedirect","back","insertAdjacentHTML","Function","templateUrl","templateContent","templateData","$G","fadeOut","targetEl","arguments","download","click","block","scrollIntoView","focusFirst","FormError","errorMessages","firstField","field","messages","showFieldError","combinedMessage","executeAction","process","modalConfig","showModal","loadModalTemplate","loadTemplateFromUrl","modalData","extractModalData","modalOptions","extractModalOptions","registerModalState","renderedContent","renderModalContent","showErrorModal","templateName","getValue","extractedValue","optionsKey","_currentModalData","_currentModalOptions","modalState","formData","hasErrors","setFormData","setField","setLoading","setError","clearErrors","updateField","fragment","createDocumentFragment","_s","HttpClient","responseHandler","interceptors","required","csrfHeaderName","csrfCookieName","csrfTokenSelector","setupCsrfToken","setupSecurity","HttpError","onFulfilled","onRejected","findIndex","runRequestInterceptors","resultConfig","interceptor","runResponseInterceptors","controller","AbortController","finalUrl","signal","ensureCsrf","processRequestBody","normalizeRequestOptions","handleResponse","errorResponse","interceptorError","Blob","ArrayBuffer","_token","isJSON","isText","isBlob","blob","getHeadersObject","createHttpError","createErrorResponse","isTimeout","upload","file","getSafe","postSafe","putSafe","deleteSafe","setBaseURL","setDefaultHeader","setDefaultHeaders","setCsrfToken","super","requestId","httpThrow","getCsrfToken","csrfSelector","postJson","setHeaders","setHeader","removeHeader","resetConfig","pendingRequests","abortControllers","_accessToken","deduplicate","csrfProtection","bearerTokenKey","bearerPrefix","basicAuth","basicUsername","basicPassword","oauth","oauthTokenKey","contentSecurityPolicy","jwtRefresh","jwtRefreshEndpoint","jwtExpireKey","jwtRefreshBeforeExpirySec","connection","retryOnNetworkError","maxNetworkRetries","backoffFactor","retryStatusCodes","exponentialBackoff","storageType","keyGeneratorFn","responsePredicate","tracking","errorTracking","performanceTracking","analyticsCallback","logging","includeRequest","includeResponse","logToConsole","customLogger","_mergeDeep","setupCsrfProtection","setupBearerAuth","setupBasicAuth","setupJwtRefresh","setupInterceptors","setupCache","setupTracking","_shouldAttachCsrf","_applyCsrfHeader","normalizedMethod","_resolveCsrfToken","metaTag","metaValue","checkAndRefreshToken","payloadBase64","expTimestamp","expireDate","__startTime","shouldRetryRequest","retryRequest","cacheData","clearExpiredCache","persistCache","cacheEntries","expiresAt","createCacheKey","_normalizeOptionsForHttpClient","normalizedOptions","buildUrlWithParams","hasParams","urlWithoutHash","pathOnly","existingQuery","appendValue","isFile","File","processParams","hashSuffix","delayMs","hasParamValues","combinedParams","requestUrl","normalizeForCache","isBlobForCache","isFileForCache","fromCache","requestPromise","adjustedOptions","_ignoredParams","externalSignal","sanitizedOptions","aborted","simpleFetchOptions","_sendNonGetRequest","logPayload","optionParams","fallbackOptions","fetchArgs","invalidateCacheByUrl","invalidateCache","deleted","requests","poll","maxPolls","timerId","execute","sequence","paginate","pageParam","startPage","maxPages","dataPath","totalPath","stopCondition","allData","currentPage","hasMore","pageParams","rawPageData","getValueByPath","pageData","pages","o","logLevels","logData","_t","autoload","cacheTime","onSuccess","onEmpty","translatedMsg","getInstance","extractOptionsFromElement","page","totalPages","pageSize","totalItems","polling","abortController","setup","apiComponentId","apiInstance","externalTemplate","loadData","pollingInterval","startPolling","refreshEvent","eventHandlers","renderLoading","renderContent","urlParams","urlParamsData","collectUrlParams","urlParamsRequired","fields","urlParamsFields","missing","missingParams","pagination","reqOptions","updateDataFromResponse","hashQueryIndex","hashParams","allowedFields","filtered","responseData","responseBody","metaPath","last_page","applySimpleTemplate","stopPolling","submit","formatDate","formatNumber","formatCurrency","apiComponentDefinition","apiComponent","_u","elementIndex","containerMap","privateStates","ElementFactory","_privateState","registerElement","implementation","unRegisterElement","elementClass","elementType","wasCreated","enhance","byElement","instEl","isSameNode","removeInstance","hasElement","shouldEnhance","elementIds","_v","Autocomplete","minLength","listClass","loadingClass","listId","datalist","hideSuggestions","filterDatalist","showSuggestions","fetchSuggestions","nextElementSibling","previousElementSibling","selectItem","q","li","Event","autocomplete","FormError$1","_w","configure","getFormConfig","formInstance","showSuccess","successContainer","defaultSuccessContainer","originalGeneralMessages","autoClearErrors","autoClearErrorsDelay","clearGeneralError","showGeneralError","errorContainer","defaultErrorContainer","errorClass","errorMessageClass","resultId","originalMessages","hasI18n","i18nValue","i18nKey","hasI18nAttr","wrapper","formControlParent","clearFieldError","elementId","original","lastFocusedElement","containerOrForm","containers","clearSuccess","clearAll","clearFormMessages","formElement","fieldName","showErrors","scrollToElement","windowHeight","visibleThreshold","getErrors","getErrorsCount","autoFocus","showErrorsInline","showErrorsInNotification","ajaxSubmit","autoValidate","resetAfterSubmit","autoEnhance","autoInitialize","autoGenerateFormId","submitButtonSelector","resetButtonSelector","fieldSelector","preventDoubleSubmit","doubleSubmitTimeout","showLoadingOnSubmit","validateOnInput","validateOnBlur","validateOnlyDirty","validatorRegistry","formatterRegistry","validClass","invalidClass","dirtyClass","successMessage","actionAttribute","methodAttribute","redirectAttribute","uploadProgressTemplate","observerConfig","observerDelay","observeRoot","autoStartObserver","forms","activeSubmit","validators","setupFormObserver","initForm","registerStandardValidators","registerValidator","maxLength","getElementsByName","defaultMessage","registerFormatter","formId","existingByElement","existingById","destroyForm","modified","valid","submitting","originalData","submitCount","lastSubmitTime","resetTimeout","formConfig","extractFormConfig","autoFillIntendedUrl","restorePersistedValues","enctype","populateSelectsFromModalOptions","loadFormOptionsIfNeeded","loadFormDataIfNeeded","initFormElements","CascadingSelectManager","initInContainer","restoreRememberedCredentials","populateFromUrlParams","setupFormEvents","getFormData","loadApi","loadQueryParams","paramObj","queryStr","LocationManager","AuthErrorHandler","formOptions","SelectElementFactory","populateFromOptionsInContainer","MultiSelectElementFactory","TagsElementFactory","tagsInstance","setValue","tags","TextElementFactory","loadOptionsApi","maxWaitTime","optionsData","setFormOptions","storedOptions","storedData","multiple","valueStrings","selectedOption","hiddenInput","loadUrlParams","submitBtn","requiredParams","urlParamsRequiredFields","emitEvent","updateFormsWithNewCSRF","ee","dataAttrs","csrfHeader","autoFocusError","autoScrollToError","showSuccessInline","showSuccessInNotification","successRedirect","loadingText","fieldType","getFieldType","baseName","confirmMessage","submitButton","_originalText","validateForm","handleInvalidSubmit","jsonData","isDevelopment","submitAjax","handleSuccessfulSubmit","savePersistedValues","handleFailedSubmit","handleSubmitError","resetForm","getCheckboxGroupValues","cascadeSource","handleCascade","validateField","forceValidate","elementInstance","em","isValid","getFieldValue","errorRequired","errorPattern","numValue","errorMin","errorMax","errorMinlength","minlength","errorMaxlength","maxlength","validator","numParam","validateFn","validationFn","invalidFields","checkedRadio","checkboxes","cb","processedNames","nativeElements","nativeEl","vals","inputs","existingCsrfInput","csrfEndpoint","getValues","HTMLFormElement","domField","setFieldValue","dataFieldName","hiddenName","textInstance","selectedValue","dataFilesAttr","fieldData","table","tableData","TableManager","tableId","columns","setData","silent","FileElementFactory","existingFiles","previewContainer","preview","showExistingFiles","hasFiles","submitWithProgress","methodLower","requestOptions","buildHeaders","apiResponse","xhr","XMLHttpRequest","progressContainer","createProgressElement","lengthComputable","updateProgress","loaded","responseText","rawResponse","statusCode","setRequestHeader","send","bar","loadedSize","formatFileSize","redirectParam","sessionIntended","isValidRedirectUrl","intendedInput","redirectAfterLogin","usernameInput","rememberCheckbox","persistAttr","persist","persistKey","persistAllowPassword","_getCookie","raw","persistOn","ttlDays","persistTtlDays","persistTtl","_setCookie","rest","formEl","redirectAction","redirectUrl","determineRedirectUrl","useIntendedUrl","roleRedirect","sourceField","cascadeApi","cascading","cascadeFields","fieldValue","sourceName","processCascadeResponse","actualData","optionsArray","updateOptions","cachedOptions","updateSelectOptions","hasPlaceholder","placeholderHTML","outerHTML","startObserver","stopObserver","_stopFormObserver","_formObserver","_addedQueue","_removedQueue","_processTimeout","processQueues","maybe","added","hit","_x","ElementFactory$1","_y","extractConfig","def","parseBool","parseString","readOnly","placeholder","parseNumeric","extractCustomConfig","createWrapper","createInstance","parseExistingWrapper","isMultipleSelect","formatting","initValue","validating","originalValue","originalConfig","recursionGuard","isModified","validatedValue","validateValue","valueChange","checkValue","customValidateValue","validateSpecific","customValidate","rules","parseValidationRules","validationRules","rule","ruleName","validationMessages","setupProperties","extendedProperties","coreProperties","originalDescriptor","descriptor","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","selectedIndex","getDescriptorOrFallback","mergedHandlers","writable","debouncedValidate","grandParent","htmlFor","commentId","originalAppend","wrapperClass","decimal","negative","fileType","datetime","postcode","generic","DropdownPanel$1","_z","panel","contentContainer","closeCallback","_createPanel","_setupEventListeners","_updatePosition","offsetY","offsetX","targetRect","panelRect","viewportWidth","viewportHeight","oldTarget","isOpen","getContentContainer","DropdownPanel","_A","maxResults","hierarchy","searchApi","searchField","acConfig","pendingOptions","dataFromDatalist","readFromDatalist","originalName","setInitialValue","highlightItem","populate","escapeRegExp","setupAutocomplete","HierarchicalTextFactory","originalDestroy","dropdownPanel","dropdown","unregister","normalizeSource","listIndex","_isActive","createListItem","appendStringSafely","cbErr","spanFallback","span","splitRegex","scrollToItem","dropdownRect","itemRect","offsetTop","selectedLi","hierarchicalData","selectHierarchicalItem","isReverseSearchSelection","handleReverseSelection","onChange","onSelectionChange","loadFromAjax","resp","searchHierarchical","_hierarchicalData","populateHierarchical","province","selectedItem","relatedFieldName","relatedData","relatedHiddenName","relatedHidden","zipcode","zipcodeInput","_autocompleteListenersSetup","populateFromOptions","matchedOption","applyInitialValuesInContainer","integer","alpha","alphanumeric","usernameOrEmail","getGroup","dataCache","syncDataToGroups","getInstancesInGroup","getLevelInGroup","getInstanceByLevelInGroup","changedInstance","totalLevels","allParentsSelected","parentValue","reverseSearch","targetLevel","traverse","isLeaf","flatResults","parents","reverse","displayValue","uniqueKey","_pendingReverseData","_pendingReverseLevel","_pendingReverseTotalLevels","matchedResult","itemKey","pathValue","EmailElementFactory","inputMode","UrlElementFactory","UsernameElementFactory","MaskElementFactory","setupMask","mask","cursorPosition","maskOnChange","privateState","hasPreservedCursor","preserveCursorPos","previousValue","previousCursor","formatValue","finalCursorPos","setSelectionRange","newCursorPos","groupSizes","separators","totalChars","currentPrivateState","placeholderChar","maskOnBlur","curPos","selEnd","charBeforeCursor","sep","targetCursorPos","charAfterCursor","charCount","maskCharPos","nonSepCount","maskChar","inputPatterns","maskConfig","masks","structure","calculateMaskStructure","allowPartial","maskPattern","inputCharacters","currentGroup","inputCursorPos","cleanValue","charsBeforeCursor","markPosition","cleanPos","maskOnInit","unmaskOnSubmit","tel","creditcard","ip","idcard","X","TelElementFactory","_NumberElementFactory","decimalSeparator","groupingSeparator","useGrouping","allowNegative","roundValues","padToPrecision","originalType","parseNumber","applyFormatting","parsedValue","handleSpecialKeys","isAllowedKey","paste","handlePaste","pastedText","clipboardData","decimalSeparatorCount","minusCount","isNegative","numStr","intPart","decPart","padEnd","formattedIntPart","showSymbol","symbol","symbolPosition","negativeWithParentheses","NaN","NumberElementFactory","CurrencyElementFactory","_B","ariaLabelledBy","ariaI18n","allowPlaceholderSelection","useOptGroups","loadOptions","typeToFilter","setupTypeToFilter","selectByValue","selectByIndex","setupChangeHandler","updateOptionAt","properties","searchTimeout","searchTerm","searchStatusElement","showSearchStatus","handleSearch","searchMethod","matchingOption","searchResetDelay","_typeToFilterHandler","loadingMessage","loadingOption","originalHTML","_originalOptions","requestConfig","isMultiple","emptyOption","emptyEntry","nonInt","ints","normalizeToArray","hasOptGroups","createOptGroups","createOption","keepPlaceholder","optgroup","parentHandlers","_localeChangeHandler","optimizeRendering","emptyMessage","customTemplate","syncCustomDropdown","ajaxDelay","defaultOption","defaultOptionText","autoLoad","autoDisable","placeholders","cascadeGroup","selects","cascadeOrder","firstWithUrl","cascadeUrl","cascadeAction","dataOptions","extractDataOptions","chainedSelects","childNames","parentNames","parentName","cascadeParent","rootName","chain","rootSelect","currentName","safetyCounter","selectElements","groupId","storeOriginalOptions","cascadeIndex","cascadeInstance","setupSelectEvents","firstSelect","cascadeParam","cascadeMethod","cascadeDefault","cascadeDefaultText","cascadeAutoLoad","cascadeDisable","cascadeCallback","onchange","_changeHandler","changeHandler","nextIndex","nextSelect","subsequentSelect","previousRequest","targetParamName","processResponse","selectId","targetSelect","storedValue","defaultSelection","getInstanceForElement","instanceId","_C","TextareaElementFactory","cfg","autoResize","minRows","maxRows","wordCount","enableTabIndent","tabToSpaces","enterBehavior","debounceDelay","enterCallback","countWords","minWords","maxWords","setupAutoResize","setupCounter","originalCleanup","_originalResize","_originalOverflow","overflowY","adjustHeight","lineHeight","fontSize","padding","paddingTop","paddingBottom","minHeight","newHeight","counterWrapper","textAlign","charCounter","charCountClass","wordCounter","wordCountClass","updateCounters","used","charCountFormat","wordCountFormat","debouncedUpdate","indent","repeat","rows","cols","_D","downloadEnabled","allowDownload","fileReference","maxFileSize","dragDrop","actionUrl","sortable","allowRemoveExisting","parseExistingFiles","accept","dropZone","initDragDrop","initPlaceholder","initSortable","clearFiles","validateFiles","validateFormField","processFiles","dragHandlers","dragEnter","dragLeave","dragOver","drop","handleFileDrop","dropContent","dropMessage","placeholderElement","updatePlaceholderVisibility","filesArray","contextData","filesData","jsonError","resolveFieldData","fieldRef","searchTargets","unshift","setExistingFilesFromContext","dataTransfer","dt","DataTransfer","newFiles","validateFile","showPreviews","maxsize","accepts","isValidFileType","allowedMimeTypes","acceptedTypes","mainType","existingPreviews","fileName","reader","FileReader","backgroundImage","readAsDataURL","getFileIcon","removeFile","referenceKey","referenceValue","camelCase","dragHandle","imageContainer","getImageModal","deleteFile","fileInfo","Sortable","ghostClass","chosenClass","dragClass","onStart","evt","onEnd","order","revertOrder","oldIndex","onRemoveExisting","updateProgressBar","g","pdf","doc","docx","xls","xlsx","zip","rar","_imageModal","MediaViewer","thumbnails","_SearchElementFactory","setupClearButton","onSearch","setupResultsContainer","useAutocomplete","searchDelay","formIntegration","registerWithFormManager","createSuggestionList","showResults","clearButton","resultsContainer","unregisterValidator","setLoadingState","clearClass","resultsClass","safeQuery","re","highlightMatches","inputClass","selectKeys","closeKeys","navigateUpKeys","navigateDownKeys","SearchElementFactory","_pad","_toLocalDateTime","_toDateISO","_toTimeHM","_getCurrentLocale","_getDayNames","loc","_getMonthNamesShort","EmbeddedDateTime","originalElement","_original","outputFormat","displayFormat","outputLocale","displayLocale","selectedDate","selectedTime","currentMonth","currentYear","currentView","readonly","_initializeElements","_replaceOriginalElement","existingFormControl","displayButton","arrow","_createCalendarStructure","calendarHeader","prevButton","displayContainer","monthDisplay","yearDisplay","nextButton","daysHeader","day","dayElement","calendarGrid","_createTimePicker","timePickerSection","timeInputs","hoursGroup","hoursInput","separator1","minutesGroup","minutesInput","separator2","secondsGroup","secondsInput","_setupTimeInputEvents","validateAndFormat","_renderCurrentView","_navigatePrevious","_navigateNext","_updateLocale","newLocale","previousMonth","nextMonth","_renderYearPicker","_renderMonthPicker","_renderCalendar","startYear","endYear","displayStartYear","displayEndYear","flex","yearButton","monthButton","_getMonthNames","firstDay","startDate","getDay","currentDate","_isSameDate","_isDateDisabled","selectDate","outputValue","changeEvent","timeParts","getElement","DateElementFactory","gdatetime","COLOR_PALETTE","EmbeddedColorPicker","selectedColor","setColor","colorText","_createColorPalette","inputSection","hexInput","_createPaletteSection","_isValidColor","_previewColor","selectColor","colors","palette","colorButton","backgroundColor","setupCopyPaste","_getContrastColor","hexColor","swatch","rgb","_hexToRgb","hex","getColor","setDisabled","setReadonly","ColorElementFactory","colorPicker","_E","maxTags","duplicates","originalParent","originalInput","tagsContainer","inputLi","hiddenInputsContainer","tagElements","setupEventHandlers","addTag","removeTag","clearTags","getTags","setTags","displayText","_eventHandlersSetup","currentAcConfig","lastTag","prev","duplicate","tagKey","hiddenContainer","_F","selectedDisplay","highlightedIndex","setupDropdownKeyboardNavigation","retranslate","updateDisplay","setSelectedValues","getSelectedValues","clearSelection","_dropdownKeyboardSetup","handleDropdownKeydown","updateHighlight","highlightedItem","removeValue","addValue","triggerChange","escPanel","handleDropdownBlur","isDropdownFocused","isTriggerFocused","_dropdownCleanup","handleTriggerClick","createOptionsList","handleTriggerKeydown","handleTriggerBlur","_cleanup","emptyMsg","selectedValues","selectedCount","translatedPlaceholder","maxDisplay","maxDisplayItems","texts","firstItems","sourceText","selectElement","currentValues","currentValueStrings","currentSelectedValues","EmbeddedRangeSlider","_calculateStep","isDualRange","showLabels","showTooltips","suffix","activeHandle","_parseInitialValues","_updateDisplay","labelsContainer","minLabel","_formatValue","maxLabel","sliderContainer","leftHandle","tabIndex","rightHandle","leftTooltip","rightTooltip","valueDisplay","_setupMouseEvents","_setupKeyboardEvents","_setupTouchEvents","_setupResizeObserver","_snapToStep","_ensureValidRange","_dispatchChangeEvent","isRight","handled","_adjustValue","resizeObserver","handleMouseMove","_dispatchInputEvent","handleMouseUp","snapped","leftPercent","rightPercent","inputEvent","setMin","setMax","setStep","GRange","RangeElementFactory","rangeSlider","_PasswordElementFactory","locateStrengthContainer","commentEl","customPasswordField","showPasswordToggle","setupPasswordToggle","checkMatch","passesCriterion","passwordCriteria","parentValidation","failedCriteria","getFailedCriteria","criteria","targetPassword","criterion","updateCriteriaList","criteriaListElement","criteriaItems","criteriaLabel","isFailed","updateMatchStatus","isConfirmField","confirmElement","mainValue","hasMainValue","confirmValue","isMatch","hasConfirmValue","isRegisterForm","passwordStrength","strengthBarElement","strengthContainer","strengthBar","inserted","insertAdjacentElement","er","updateStrengthBar","allCriteria","passed","pct","passwordCriteriaList","setupCriteriaList","toggleButton","togglePasswordVisibility","criteriaListClass","listItem","ensureStrengthBar","wantsStrengthLocal","_formResetHandler","numbers","special","PasswordElementFactory","CalendarManager","defaultView","timezone","firstDayOfWeek","showWeekNumbers","showToday","allowViewChange","eventHeight","timelineHeight","workingHours","weekends","minDate","maxDate","dateFormats","week","cell","callbacks","onDateClick","onEventClick","onViewChange","onDateChange","calendars","calendarInstance","isRendering","setupCalendar","calendar","calendarLocale","calendarFirstDay","calendarEvents","createNavigation","createViewSwitcher","headerElement","contentElement","prevBtn","currentPeriodElement","nextBtn","todayBtn","goToToday","switcher","view","changeView","viewSwitcherElement","updateCurrentPeriod","updateViewSwitcher","renderDayView","renderWeekView","renderMonthView","renderTimelineView","renderEvents","thead","headerRow","dayNames","dayIndex","th","tbody","startOfMonth","dayOfWeek","row","cellDate","getCellClasses","dayNumber","eventsContainer","handleDateClick","weekStart","getWeekStart","weekHeader","dayCol","dayName","timeGrid","hour","timeSlot","timeLabel","daySlots","daySlot","dayHeader","eventArea","timeline","endDate","timelineBar","totalDays","daySegment","dayLabel","eventTrack","currentDayElement","inline","renderEvent","eventDate","dateStr","eventEl","createEventElement","viewType","borderColor","handleEventClick","today","isSameDay","names","weekday","diff","formats","weekEnd","eventData","domEvent","addEvent","elementOrInstance","removeEvent","eventId","_G","Calendar","FilterManager","defaultAnimation","defaultDuration","defaultFilterAttr","activeFilters","activeSorts","bindFilterControls","bindSortControls","refreshFilters","controlContainer","getFilterOptions","performFilter","handleFilterClick","handleSortClick","filterValue","filterScope","updateActiveButton","sortBy","sortOrder","sortType","sortScope","lastSort","newOrder","by","filterAttr","filterAnimation","filterDuration","activeButton","showAll","itemValue","isHidden","animateItem","performSort","aValue","getSortValue","bValue","childEl","localeCompare","isShow","nextFrame","ms","getFilteredItems","activeFilter","clearFilters","clearSorts","getActiveFilter","getActiveSort","MenuManager","breakpoint","animationDuration","focusFirstItemOnOpen","returnFocusOnClose","horizontalNavigation","arrowKeysOpenSubmenu","arrowKeysNavigateSiblings","useRequestAnimationFrame","touchOptimization","observerOptions","hover","openDelay","closeDelay","menus","initializeExistingMenus","setupMutationObserver","setupToggleListeners","setupApiDataListener","updateActiveMenu","setupAutoExpand","menu","closeAllSubmenus","isMenuOpen","closeMenu","updateAllMenuTranslations","toggleButtons","submenus","submenu","apiElement","sourcePath","menuData","menuId","destroyMenu","renderFromData","isSubmenuOpen","createMenu","hasMenuComponent","nestedMenuId","menuLevel","toggleMenu","currentRoute","menuPath","previousActive","activeChanged","utils","cleanUrl","clean","comparePaths","linkPath","setActiveState","wasActive","sidemenu","topmenu","activeLinks","bestMatch","bestMatchLength","cleanHref","parentLi","checkAndAdjustPosition","initializeMenuInstance","setupMenuElements","setupAriaForNestedMenu","setupMenuHandlers","setupAccessibility","checkResponsiveState","menuItem","isSidebar","touchData","menuParent","ul","overflowAmount","toggleSubmenu","touchHandlers","move","touch","deltaTime","velocity","handleKeyboardNavigation","setupHoverHandlers","focusout","currentFocus","currentTopLi","originalTopLi","openMenu","topLevelItems","announce","isMobileMenuMode","closeSubmenu","openSubmenu","currentLevel","other","tempExpanded","useKeyboard","firstItem","submenuItems","childSubmenus","hasMenu","getMenu","setupTouchHandlers","touchIdentifier","handleTouchMove","handleTouchEnd","liveRegion","keyboardHint","hoverTimeouts","mouseEnterHandler","closeOtherSubmenus","mouseLeaveHandler","hoverHandlers","leave","initial","wasMobile","stateChanged","removeHoverHandlers","isHoveringSubmenu","currentItem","relatedTarget","parentUl","findTopLevelMenuItem","getTopLevelMenuItems","isTopLevel","isHorizontalMenu","parentButton","topLevelItem","nextItem","getNextFocusableItem","prevItem","getPreviousFocusableItem","getFirstFocusableItem","lastItem","getLastFocusableItem","findSubmenuByToggle","canRecover","isRecoveryError","recoverFromError","recoveryError","forceCleanup","resetMenuState","findMenuByElement","currentSubmenu","otherItem","isSubmenuReady","existingMenuId","createMenuItem","itemCount","submenuId","childLi","badge","badgeClass","_H","Sortable$1","apiEndpoint","sortableApi","sortableMethod","apiIdAttr","sortableIdAttr","apiStageAttr","sortableStageAttr","apiUpdateField","sortableUpdateField","apiExtraData","sortableExtraData","dataIdAttr","forceFallback","fallbackTolerance","scrollSensitivity","scrollSpeed","dragging","ghost","initialIndex","scrollInterval","dragStartEvent","sourceContainer","dragStart","handleDragStart","handleDragOver","dragEnd","handleDragEnd","keyDown","handleKeyDown","addEventListeners","dragEl","getDragElement","getIndex","createGhost","createPlaceholder","startIndex","point","moveGhost","pageX","pageY","handleScrolling","targetInfo","findTargetContainer","targetContainer","overEl","autoSavePosition","moveElement","toggleSelection","sensitivity","scrolling","topDist","bottomDist","alignItems","justifyContent","borderRadius","boxShadow","iconHalf","mouseOffset","lockedX","scrollLeft","td","colSpan","border","borderTop","findElementUnderPoint","groupContainers","sortableInstance","elRect","swapElements","el1","el2","rect1","rect2","next2","parent2","draggedItem","itemId","update_stage_only","setupGlobalObserver","hasNewSortables","mergedOptions","apiUrl","_sortableInstance","destroyAll","TabsComponent","defaultTab","buttonSelector","panelSelector","hashPrefix","destroyOnHidden","ariaLabel","onInit","onTabChange","beforeTabChange","onDestroy","setupObserver","instanceConfig","panels","activeTab","tabIds","setupHashNavigation","initialTab","getInitialTab","switchTab","tabId","getActiveTab","tablist","buttonId","panelId","currentButton","targetIndex","targetButton","previousTab","targetPanel","_hashHandler","hashTab","getTabFromHash","newHash","AnimationManager","defaultEasing","animations","fade","in","out","slideUp","slideDown","slideLeft","slideRight","scale","scaleUp","rotate","bounce","steps","shake","pulse","flip","flipX","zoomIn","swing","easings","ease","easeIn","easeOut","easeInOut","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInQuart","easeInOutQuart","easeInBack","easeInOutBack","easeInElastic","easeOutElastic","easeInBounce","easeOutBounce","spring","useRAF","running","setupPerformanceObserver","getAnimationConfig","getCacheKey","keyframes","createKeyframes","animationId","createTiming","anim","onfinish","onComplete","oncancel","parallel","stagger","staggerDelay","staggeredOptions","elementQueue","clearQueue","pause","playState","resume","play","preset","iterations","animationDirection","supportedEntryTypes","finish","getRunningCount","registerAnimation","registerEasing","stopAutoInit","_autoInit","enterObserver","leaveObserver","mutationObserver","animateHandlers","_initEnterAnimations","_initLeaveAnimations","_initAnimateTriggers","_setupMutationObserver","enterDuration","enterRepeat","_animBinding","animInitialized","_wasVisible","leaveDuration","animTriggerInitialized","hasNewElements","reinitTimeout","_I","animationAuto","originalDisplay","processAnimationShow","processAnimationEnter","processAnimationLeave","processAnimationTransition","updateShow","showAnimation","showDuration","initialVisible","enterThreshold","leaveThreshold","updateTransition","prevValue","transitionAnimation","transitionDuration","cleanupAnimationBinding","MediaViewer$1","showThumbnails","showControls","autoplay","enableZoom","maxZoom","zoomStep","renderers","image","renderImage","video","renderVideo","youtube","renderYouTube","renderIframe","renderText","renderHtml","zoom","pan","startPos","isPlaying","playTimer","setupDOM","stage","thumbnailTrack","captionEl","counterEl","zoomOut","resetZoom","normalizeItem","loadCurrentItem","renderThumbnails","getCurrentItem","updateCounter","updateCaption","renderer","updateThumbnails","caption","controls","poster","oncanplay","sanitizeVideoId","videoId","allow","allowFullscreen","textContainer","htmlContainer","thumb","thumbnail","goTo","thumbs","getYouTubeId","mediaItem","containerRect","updateTransform","newZoom","setZoom","setOptions","initFromElement","parseOptionsFromElement","viewer","_mediaViewer","api","loadFromApi","collectMediaItems","_mediaItems","bindItemEvents","media","_apiError","clickableItems","EditInPlaceManager","selectOnEdit","activeEditor","editInPlace","ajaxUrl","editAjaxUrl","callbackName","ajaxSave","editAjaxSave","editor","isEditing","startEdit","endEdit","computedStyle","fontFamily","handleBlur","finishEdit","editorHandlers","restore","emitCancel","validationError","finalValue","savedViaAjax","callbackFn","fetchResponse","serverValue","userMessage","cancelEdit","_J","ThemeManager","defaultTheme","systemPreference","configUrl","cacheResponse","hideOnSwitch","readyClass","transitionClass","allowedPropertyPattern","dangerousPatterns","maxValueLength","blockPathTraversal","stripQueryString","ready","transitioning","toggles","apiCache","appliedVariables","isSafeApiUrl","setupSystemPreference","loadInitialTheme","markReady","theme","updateElementState","_themeToggle","updateAllToggles","cleanupSystemPreferenceListener","mediaQuery","matchMedia","handleChange","getStoredTheme","newTheme","shouldTransition","startTransition","setStoredTheme","endTransition","getCurrentTheme","addReadyClass","loadFromAPI","isValidProperty","isUrlValue","sanitizeUrl","sanitizeValue","urlResult","validateApiResponse","variables","applyVariables","limitedEntries","applied","rejectedCount","setProperty","clearVariables","removeProperty","getAppliedVariables","applyApiConfig","isHttp","isSameOrigin","httpAllowed","refreshFromAPI","_K"],"mappings":"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"}