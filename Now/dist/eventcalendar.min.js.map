{"version":3,"file":"eventcalendar.min.js","sources":["../../js/components/EventCalendar.js"],"sourcesContent":["/**\n * EventCalendar - Full-featured Event Calendar Component\n *\n * Features:\n * - Multi-day/week/month spanning events displayed as continuous bars\n * - Month, Week, Day views\n * - Max 3 events per day cell with \"+N more\" overflow\n * - Mobile-friendly with tap-to-view modals\n * - API integration for loading events\n * - ResponseHandler integration for event actions\n * - i18n support (Thai/English)\n *\n * @requires Utils\n * @requires Modal\n * @requires ResponseHandler\n * @requires I18nManager (optional)\n * @requires ApiService (optional)\n */\nconst EventCalendar = {\n  config: {\n    defaultView: 'month',\n    locale: 'auto',\n    timezone: 'local', // 'local' or 'UTC' or specific timezone (future)\n    firstDayOfWeek: 0, // 0=Sunday, 1=Monday\n    maxEventsPerDay: 3,\n    showNavigation: true,\n    showToday: true,\n    showViewSwitcher: true,\n    views: ['month', 'week', 'day'],\n    api: null,\n    apiMethod: 'GET',\n    eventDataPath: 'data',\n    eventColors: [\n      '#4285F4', // Blue\n      '#EA4335', // Red\n      '#FBBC04', // Yellow\n      '#34A853', // Green\n      '#8E24AA', // Purple\n      '#E91E63', // Pink\n      '#00ACC1', // Cyan\n      '#FF7043'  // Orange\n    ],\n    onDateClick: null,\n    onEventClick: null,\n    onEventClickApi: null\n  },\n\n  state: {\n    instances: new Map(),\n    initialized: false,\n    cleanupHandlers: new WeakMap() // Store cleanup functions for each instance\n  },\n\n  // i18n strings\n  i18n: {\n    th: {\n      today: 'วันนี้',\n      month: 'เดือน',\n      week: 'สัปดาห์',\n      day: 'วัน',\n      moreEvents: '+{count} เพิ่มเติม',\n      noEvents: 'ไม่มีกิจกรรม',\n      allDay: 'ทั้งวัน',\n      loading: 'กำลังโหลด...',\n      error: 'เกิดข้อผิดพลาด',\n      retry: 'ลองใหม่',\n      previous: 'ก่อนหน้า',\n      next: 'ถัดไป',\n      monthNames: [\n        'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน',\n        'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม',\n        'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'\n      ],\n      monthNamesShort: [\n        'ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.',\n        'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.',\n        'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'\n      ],\n      dayNames: ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'],\n      dayNamesShort: ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส']\n    },\n    en: {\n      today: 'Today',\n      month: 'Month',\n      week: 'Week',\n      day: 'Day',\n      moreEvents: '+{count} more',\n      noEvents: 'No events',\n      allDay: 'All day',\n      loading: 'Loading...',\n      error: 'Error occurred',\n      retry: 'Retry',\n      previous: 'Previous',\n      next: 'Next',\n      monthNames: [\n        'January', 'February', 'March', 'April',\n        'May', 'June', 'July', 'August',\n        'September', 'October', 'November', 'December'\n      ],\n      monthNamesShort: [\n        'Jan', 'Feb', 'Mar', 'Apr',\n        'May', 'Jun', 'Jul', 'Aug',\n        'Sep', 'Oct', 'Nov', 'Dec'\n      ],\n      dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n      dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\n    }\n  },\n\n  /**\n   * Initialize EventCalendar\n   */\n  init(options = {}) {\n    if (this.state.initialized) return this;\n\n    this.config = {...this.config, ...options};\n\n    // Auto-init elements with data-event-calendar\n    document.querySelectorAll('[data-event-calendar]').forEach(element => {\n      this.create(element);\n    });\n\n    this.state.initialized = true;\n    return this;\n  },\n\n  /**\n   * Validate configuration\n   */\n  validateConfig(config) {\n    const errors = [];\n\n    // Validate views\n    if (!Array.isArray(config.views) || config.views.length === 0) {\n      errors.push('views must be a non-empty array');\n    } else {\n      const validViews = ['month', 'week', 'day'];\n      const invalidViews = config.views.filter(v => !validViews.includes(v));\n      if (invalidViews.length > 0) {\n        errors.push(`Invalid view(s): ${invalidViews.join(', ')}. Valid views are: ${validViews.join(', ')}`);\n      }\n    }\n\n    // Validate defaultView\n    if (!config.views.includes(config.defaultView)) {\n      errors.push(`defaultView '${config.defaultView}' is not in views array`);\n    }\n\n    // Validate maxEventsPerDay\n    if (typeof config.maxEventsPerDay !== 'number' || config.maxEventsPerDay < 1) {\n      errors.push('maxEventsPerDay must be a positive number');\n    }\n\n    // Validate firstDayOfWeek\n    if (typeof config.firstDayOfWeek !== 'number' || config.firstDayOfWeek < 0 || config.firstDayOfWeek > 6) {\n      errors.push('firstDayOfWeek must be a number between 0 (Sunday) and 6 (Saturday)');\n    }\n\n    // Validate API URL if provided\n    if (config.api && typeof config.api !== 'string') {\n      errors.push('api must be a string URL');\n    }\n\n    // Validate apiMethod\n    const validMethods = ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'];\n    if (config.apiMethod && !validMethods.includes(config.apiMethod.toUpperCase())) {\n      errors.push(`apiMethod must be one of: ${validMethods.join(', ')}`);\n    }\n\n    // Validate event colors\n    if (!Array.isArray(config.eventColors) || config.eventColors.length === 0) {\n      errors.push('eventColors must be a non-empty array');\n    }\n\n    // Log errors\n    if (errors.length > 0) {\n      console.error('[EventCalendar] Configuration errors:', errors);\n      return false;\n    }\n\n    return true;\n  },\n\n  /**\n   * Create calendar instance\n   */\n  create(element, options = {}) {\n    if (typeof element === 'string') {\n      element = document.querySelector(element);\n    }\n\n    if (!element) {\n      console.error('[EventCalendar] Element not found');\n      return null;\n    }\n\n    // Return existing instance\n    if (element._eventCalendar) {\n      return element._eventCalendar;\n    }\n\n    // Extract data attributes\n    const dataOptions = this.extractDataOptions(element);\n    const config = {...this.config, ...dataOptions, ...options};\n\n    // Validate configuration\n    if (!this.validateConfig(config)) {\n      console.error('[EventCalendar] Failed to create calendar due to invalid configuration');\n      return null;\n    }\n\n    // Determine locale\n    if (config.locale === 'auto') {\n      config.locale = window.I18nManager?.getCurrentLanguage?.() ||\n        document.documentElement.lang ||\n        'en';\n    }\n\n    // Normalize locale to 'th' or 'en'\n    config.locale = config.locale.startsWith('th') ? 'th' : 'en';\n\n    const instance = {\n      element,\n      config,\n      currentDate: new Date(),\n      currentView: config.defaultView,\n      events: [],\n      eventSegments: [],\n      isLoading: false,\n      error: null,\n      // Event listeners cleanup tracking\n      eventListeners: [],\n      // Performance caching\n      segmentCache: new Map()\n    };\n\n    element._eventCalendar = instance;\n    this.state.instances.set(element, instance);\n\n    // Setup DOM structure\n    this.setupCalendar(instance);\n\n    // Load events if API configured\n    if (config.api) {\n      this.loadEvents(instance);\n    } else {\n      this.render(instance);\n    }\n\n    return instance;\n  },\n\n  /**\n   * Extract options from data attributes\n   */\n  extractDataOptions(element) {\n    const dataset = element.dataset;\n    const options = {};\n\n    if (dataset.view) options.defaultView = dataset.view;\n    if (dataset.locale) options.locale = dataset.locale;\n    if (dataset.firstDay) options.firstDayOfWeek = parseInt(dataset.firstDay);\n    if (dataset.maxEvents) options.maxEventsPerDay = parseInt(dataset.maxEvents);\n    if (dataset.api) options.api = dataset.api;\n    if (dataset.apiMethod) options.apiMethod = dataset.apiMethod;\n    if (dataset.eventDataPath) options.eventDataPath = dataset.eventDataPath;\n    if (dataset.onDateClick) options.onDateClick = dataset.onDateClick;\n    if (dataset.onEventClick) options.onEventClick = dataset.onEventClick;\n    if (dataset.onEventClickApi) options.onEventClickApi = dataset.onEventClickApi;\n    if (dataset.showNavigation !== undefined) options.showNavigation = dataset.showNavigation !== 'false';\n    if (dataset.showToday !== undefined) options.showToday = dataset.showToday !== 'false';\n    if (dataset.showViewSwitcher !== undefined) options.showViewSwitcher = dataset.showViewSwitcher !== 'false';\n    if (dataset.views) options.views = dataset.views.split(',').map(v => v.trim());\n\n    // Parse inline events\n    if (dataset.events) {\n      try {\n        options.events = JSON.parse(dataset.events);\n      } catch (e) {\n        console.warn('[EventCalendar] Invalid events JSON');\n      }\n    }\n\n    return options;\n  },\n\n  /**\n   * Add event listener with cleanup tracking\n   */\n  addTrackedListener(instance, element, event, handler, options) {\n    element.addEventListener(event, handler, options);\n    instance.eventListeners.push({element, event, handler, options});\n  },\n\n  /**\n   * Setup event delegation for dynamic content\n   */\n  setupEventDelegation(instance) {\n    const {element} = instance;\n\n    // Delegate click events\n    const delegateHandler = (e) => {\n      const target = e.target;\n\n      // Event bar clicks\n      if (target.closest('.ec-event-bar')) {\n        e.stopPropagation();\n        const bar = target.closest('.ec-event-bar');\n        const eventId = bar.dataset.eventId;\n        if (eventId) {\n          const event = instance.events.find(ev => ev.id === eventId);\n          if (event) {\n            this.handleEventClick(instance, event, e);\n          }\n        }\n        return;\n      }\n\n      // Timed event clicks\n      if (target.closest('.ec-timed-event')) {\n        e.stopPropagation();\n        const eventEl = target.closest('.ec-timed-event');\n        const eventId = eventEl.dataset.eventId;\n        if (eventId) {\n          const event = instance.events.find(ev => ev.id === eventId);\n          if (event) {\n            this.handleEventClick(instance, event, e);\n          }\n        }\n        return;\n      }\n\n      // All-day event clicks\n      if (target.closest('.ec-allday-event')) {\n        const eventEl = target.closest('.ec-allday-event');\n        const eventId = eventEl.dataset.eventId;\n        if (eventId) {\n          const event = instance.events.find(ev => ev.id === eventId);\n          if (event) {\n            this.handleEventClick(instance, event, e);\n          }\n        }\n        return;\n      }\n\n      // Hour slot clicks (for week/day view)\n      if (target.closest('.ec-hour-slot')) {\n        const slot = target.closest('.ec-hour-slot');\n        const hour = parseInt(slot.dataset.hour);\n        const column = slot.closest('.ec-day-column');\n        if (column) {\n          const dateStr = column.dataset.date;\n          const clickDate = new Date(dateStr);\n          clickDate.setHours(hour);\n          this.handleDateClick(instance, clickDate, e);\n        }\n        return;\n      }\n\n      // Hour area clicks (day view)\n      if (target.closest('.ec-hour-area')) {\n        const area = target.closest('.ec-hour-area');\n        const slot = area.closest('.ec-hour-slot');\n        const hour = parseInt(slot.dataset.hour);\n        const clickDate = new Date(instance.currentDate);\n        clickDate.setHours(hour);\n        this.handleDateClick(instance, clickDate, e);\n        return;\n      }\n    };\n\n    this.addTrackedListener(instance, element, 'click', delegateHandler);\n  },\n\n  /**\n   * Setup keyboard navigation\n   */\n  setupKeyboardNavigation(instance) {\n    const {element} = instance;\n\n    // Make calendar focusable\n    if (!element.hasAttribute('tabindex')) {\n      element.setAttribute('tabindex', '0');\n    }\n\n    const keyboardHandler = (e) => {\n      const {currentDate, currentView} = instance;\n\n      switch (e.key) {\n        case 'ArrowLeft':\n          e.preventDefault();\n          this.navigate(instance, -1);\n          break;\n\n        case 'ArrowRight':\n          e.preventDefault();\n          this.navigate(instance, 1);\n          break;\n\n        case 'Home':\n          e.preventDefault();\n          this.goToToday(instance);\n          break;\n\n        case 't':\n        case 'T':\n          if (!e.ctrlKey && !e.metaKey) {\n            e.preventDefault();\n            this.goToToday(instance);\n          }\n          break;\n\n        case 'm':\n        case 'M':\n          if (!e.ctrlKey && !e.metaKey && instance.config.views.includes('month')) {\n            e.preventDefault();\n            this.changeView(instance, 'month');\n          }\n          break;\n\n        case 'w':\n        case 'W':\n          if (!e.ctrlKey && !e.metaKey && instance.config.views.includes('week')) {\n            e.preventDefault();\n            this.changeView(instance, 'week');\n          }\n          break;\n\n        case 'd':\n        case 'D':\n          if (!e.ctrlKey && !e.metaKey && instance.config.views.includes('day')) {\n            e.preventDefault();\n            this.changeView(instance, 'day');\n          }\n          break;\n      }\n    };\n\n    this.addTrackedListener(instance, element, 'keydown', keyboardHandler);\n  },\n\n  /**\n   * Setup calendar DOM structure\n   */\n  setupCalendar(instance) {\n    const {element, config} = instance;\n\n    element.classList.add('event-calendar');\n    element.setAttribute('role', 'application');\n    element.setAttribute('aria-label', 'Event Calendar');\n    element.innerHTML = '';\n\n    // Setup event delegation for dynamically created elements\n    this.setupEventDelegation(instance);\n\n    // Setup keyboard navigation\n    this.setupKeyboardNavigation(instance);\n\n    // Create header\n    const header = document.createElement('div');\n    header.className = 'ec-header';\n\n    // Navigation\n    if (config.showNavigation) {\n      const nav = this.createNavigation(instance);\n      header.appendChild(nav);\n    }\n\n    // View switcher\n    if (config.showViewSwitcher && config.views.length > 1) {\n      const switcher = this.createViewSwitcher(instance);\n      header.appendChild(switcher);\n    }\n\n    element.appendChild(header);\n    instance.headerElement = header;\n\n    // Content area\n    const content = document.createElement('div');\n    content.className = 'ec-content';\n    element.appendChild(content);\n    instance.contentElement = content;\n  },\n\n  /**\n   * Create navigation controls\n   */\n  createNavigation(instance) {\n    const {config} = instance;\n    const strings = this.i18n[config.locale];\n\n    const nav = document.createElement('div');\n    nav.className = 'ec-nav';\n\n    // Previous button\n    const prevBtn = document.createElement('button');\n    prevBtn.className = 'ec-nav-btn ec-prev';\n    prevBtn.setAttribute('aria-label', strings.previous || 'Previous');\n    prevBtn.setAttribute('type', 'button');\n    prevBtn.innerHTML = '<svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\"><path fill=\"currentColor\" d=\"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z\"/></svg>';\n    this.addTrackedListener(instance, prevBtn, 'click', () => this.navigate(instance, -1));\n\n    // Current period display\n    const current = document.createElement('div');\n    current.className = 'ec-current-period';\n    current.setAttribute('role', 'status');\n    current.setAttribute('aria-live', 'polite');\n    instance.currentPeriodElement = current;\n\n    // Next button\n    const nextBtn = document.createElement('button');\n    nextBtn.className = 'ec-nav-btn ec-next';\n    nextBtn.setAttribute('aria-label', strings.next || 'Next');\n    nextBtn.setAttribute('type', 'button');\n    nextBtn.innerHTML = '<svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\"><path fill=\"currentColor\" d=\"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z\"/></svg>';\n    this.addTrackedListener(instance, nextBtn, 'click', () => this.navigate(instance, 1));\n\n    nav.appendChild(prevBtn);\n    nav.appendChild(current);\n    nav.appendChild(nextBtn);\n\n    // Today button\n    if (config.showToday) {\n      const todayBtn = document.createElement('button');\n      todayBtn.className = 'ec-today-btn';\n      todayBtn.setAttribute('type', 'button');\n      todayBtn.setAttribute('aria-label', strings.today);\n      todayBtn.textContent = strings.today;\n      this.addTrackedListener(instance, todayBtn, 'click', () => this.goToToday(instance));\n      nav.appendChild(todayBtn);\n    }\n\n    return nav;\n  },\n\n  /**\n   * Create view switcher\n   */\n  createViewSwitcher(instance) {\n    const {config} = instance;\n    const strings = this.i18n[config.locale];\n\n    const switcher = document.createElement('div');\n    switcher.className = 'ec-view-switcher';\n\n    const viewLabels = {\n      month: strings.month,\n      week: strings.week,\n      day: strings.day\n    };\n\n    config.views.forEach(view => {\n      const btn = document.createElement('button');\n      btn.className = `ec-view-btn ${view === instance.currentView ? 'active' : ''}`;\n      btn.dataset.view = view;\n      btn.textContent = viewLabels[view] || view;\n      this.addTrackedListener(instance, btn, 'click', () => this.changeView(instance, view));\n      switcher.appendChild(btn);\n    });\n\n    instance.viewSwitcherElement = switcher;\n    return switcher;\n  },\n\n  /**\n   * Load events from API\n   */\n  async loadEvents(instance) {\n    const {config} = instance;\n\n    if (!config.api) return;\n\n    instance.isLoading = true;\n    this.renderLoading(instance);\n\n    try {\n      const viewRange = this.getViewDateRange(instance);\n      const params = new URLSearchParams({\n        start: this.formatDateISO(viewRange.start),\n        end: this.formatDateISO(viewRange.end)\n      });\n\n      const url = config.api.includes('?')\n        ? `${config.api}&${params}`\n        : `${config.api}?${params}`;\n\n      let response;\n\n      if (window.ApiService && typeof ApiService.get === 'function') {\n        response = await ApiService.get(url);\n      } else {\n        const res = await fetch(url, {method: config.apiMethod});\n        response = await res.json();\n      }\n\n      // Extract events from response\n      const events = window.Utils?.object?.get?.(response?.data, config.eventDataPath, []) ??\n        (response?.data?.[config.eventDataPath] || response?.data?.data || response?.data || []);\n      instance.events = this.normalizeEvents(events);\n      instance.error = null;\n\n    } catch (error) {\n      console.error('[EventCalendar] Failed to load events:', error);\n      instance.error = error.message;\n      instance.events = [];\n    } finally {\n      instance.isLoading = false;\n      this.render(instance);\n    }\n  },\n\n  /**\n   * Parse date with timezone awareness\n   */\n  parseDate(dateString, config) {\n    if (!dateString) return new Date();\n\n    const date = new Date(dateString);\n\n    // If timezone is UTC and date string doesn't include timezone info\n    if (config.timezone === 'UTC' && !dateString.includes('Z') && !dateString.includes('+')) {\n      // Treat as UTC\n      return new Date(date.getTime() + (date.getTimezoneOffset() * 60000));\n    }\n\n    return date;\n  },\n\n  /**\n   * Format date for API (ISO format)\n   */\n  formatDateForAPI(date, config) {\n    if (config.timezone === 'UTC') {\n      return date.toISOString();\n    }\n    return this.formatDateISO(date);\n  },\n\n  /**\n   * Normalize events data\n   */\n  normalizeEvents(events) {\n    // Handle non-array input\n    if (!Array.isArray(events)) {\n      console.warn('[EventCalendar] Events data is not an array, received:', typeof events);\n      return [];\n    }\n\n    return events.map((event, index) => {\n      // Validate required fields\n      if (!event) {\n        console.warn('[EventCalendar] Null event at index', index);\n        return null;\n      }\n\n      // Parse dates safely with timezone awareness\n      let startDate, endDate;\n      try {\n        startDate = event.start ? this.parseDate(event.start, this.config) : new Date();\n        if (isNaN(startDate.getTime())) {\n          console.warn('[EventCalendar] Invalid start date for event:', event);\n          startDate = new Date();\n        }\n      } catch (e) {\n        console.warn('[EventCalendar] Error parsing start date:', e);\n        startDate = new Date();\n      }\n\n      try {\n        endDate = event.end ? this.parseDate(event.end, this.config) : new Date(startDate);\n        if (isNaN(endDate.getTime())) {\n          console.warn('[EventCalendar] Invalid end date for event:', event);\n          endDate = new Date(startDate);\n        }\n      } catch (e) {\n        console.warn('[EventCalendar] Error parsing end date:', e);\n        endDate = new Date(startDate);\n      }\n\n      // Ensure end is not before start\n      if (endDate < startDate) {\n        console.warn('[EventCalendar] End date is before start date, swapping');\n        [startDate, endDate] = [endDate, startDate];\n      }\n\n      return {\n        id: event.id || `event-${index}-${Date.now()}`,\n        title: event.title || 'Untitled',\n        start: startDate,\n        end: endDate,\n        allDay: event.allDay !== false,\n        color: event.color || this.config.eventColors[index % this.config.eventColors.length],\n        category: event.category || null,\n        description: event.description || null,\n        location: event.location || null,\n        data: event // Keep original data\n      };\n    }).filter(event => event !== null); // Remove null events\n  },\n\n  /**\n   * Main render function\n   */\n  render(instance) {\n    // Show error state if any\n    if (instance.error) {\n      this.renderError(instance);\n      return;\n    }\n\n    // Show loading state\n    if (instance.isLoading) {\n      this.renderLoading(instance);\n      return;\n    }\n\n    this.updateCurrentPeriod(instance);\n    this.updateViewSwitcher(instance);\n\n    switch (instance.currentView) {\n      case 'month':\n        this.renderMonthView(instance);\n        break;\n      case 'week':\n        this.renderWeekView(instance);\n        break;\n      case 'day':\n        this.renderDayView(instance);\n        break;\n    }\n  },\n\n  /**\n   * Render error state\n   */\n  renderError(instance) {\n    const {contentElement, config, error} = instance;\n    const strings = this.i18n[config.locale];\n\n    contentElement.innerHTML = `\n      <div class=\"ec-error\" role=\"alert\">\n        <div class=\"ec-error-icon\">⚠️</div>\n        <div class=\"ec-error-title\">${strings.error}</div>\n        <div class=\"ec-error-message\">${this.escapeHtml(error)}</div>\n        <button type=\"button\" class=\"ec-retry-btn\">${strings.retry || 'Retry'}</button>\n      </div>\n    `;\n\n    // Add retry handler\n    const retryBtn = contentElement.querySelector('.ec-retry-btn');\n    if (retryBtn) {\n      this.addTrackedListener(instance, retryBtn, 'click', () => {\n        instance.error = null;\n        if (instance.config.api) {\n          this.loadEvents(instance);\n        } else {\n          this.render(instance);\n        }\n      });\n    }\n  },\n\n  /**\n   * Render loading state\n   */\n  renderLoading(instance) {\n    const {contentElement, config} = instance;\n    const strings = this.i18n[config.locale];\n\n    contentElement.innerHTML = `\n      <div class=\"ec-loading\">\n        <div class=\"ec-spinner\"></div>\n        <span>${strings.loading}</span>\n      </div>\n    `;\n  },\n\n  /**\n   * Render month view\n   */\n  renderMonthView(instance) {\n    const {contentElement, currentDate, config, events} = instance;\n    const strings = this.i18n[config.locale];\n\n    // Use DocumentFragment for better performance\n    const fragment = document.createDocumentFragment();\n    contentElement.className = 'ec-content ec-month-view';\n\n    // Create grid container\n    const grid = document.createElement('div');\n    grid.className = 'ec-month-grid';\n    grid.setAttribute('role', 'grid');\n    grid.setAttribute('aria-label', 'Calendar month view');\n\n    // Day headers - use DocumentFragment\n    const headerRow = document.createElement('div');\n    headerRow.className = 'ec-weekday-header';\n    const headerFragment = document.createDocumentFragment();\n\n    for (let i = 0; i < 7; i++) {\n      const dayIndex = (config.firstDayOfWeek + i) % 7;\n      const header = document.createElement('div');\n      header.className = 'ec-weekday';\n      header.textContent = strings.dayNamesShort[dayIndex];\n      headerFragment.appendChild(header);\n    }\n    headerRow.appendChild(headerFragment);\n    grid.appendChild(headerRow);\n\n    // Calculate grid dates\n    const monthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n    const monthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n\n    // Grid start (might be previous month)\n    const gridStart = new Date(monthStart);\n    const startDayOffset = (monthStart.getDay() - config.firstDayOfWeek + 7) % 7;\n    gridStart.setDate(gridStart.getDate() - startDayOffset);\n\n    // Get spanning event segments for this view\n    const segments = this.calculateSpanningSegments(instance, gridStart, 42);\n\n    // Create 6 week rows\n    for (let week = 0; week < 6; week++) {\n      const weekRow = document.createElement('div');\n      weekRow.className = 'ec-week-row';\n\n      // Event container for spanning events\n      const eventLayer = document.createElement('div');\n      eventLayer.className = 'ec-event-layer';\n\n      // Day cells\n      // Day cells - use DocumentFragment\n      const dayLayer = document.createElement('div');\n      dayLayer.className = 'ec-day-layer';\n      const dayFragment = document.createDocumentFragment();\n\n      for (let day = 0; day < 7; day++) {\n        const cellDate = new Date(gridStart);\n        cellDate.setDate(gridStart.getDate() + (week * 7) + day);\n\n        const cell = this.createDayCell(instance, cellDate, monthStart.getMonth());\n        dayFragment.appendChild(cell);\n      }\n      dayLayer.appendChild(dayFragment);\n\n      // Render spanning events for this week\n      const weekStart = new Date(gridStart);\n      weekStart.setDate(gridStart.getDate() + (week * 7));\n      const weekSegments = this.getWeekSegments(segments, weekStart);\n      this.renderWeekEventBars(instance, eventLayer, weekSegments, weekStart);\n\n      weekRow.appendChild(eventLayer);\n      weekRow.appendChild(dayLayer);\n      grid.appendChild(weekRow);\n    }\n\n    fragment.appendChild(grid);\n\n    // Clear and update DOM once\n    contentElement.innerHTML = '';\n    contentElement.appendChild(fragment);\n  },\n\n  /**\n   * Create a day cell for month view\n   */\n  createDayCell(instance, date, currentMonth) {\n    const {config, events} = instance;\n    const strings = this.i18n[config.locale];\n    const today = new Date();\n\n    const cell = document.createElement('div');\n    cell.className = 'ec-day-cell';\n    cell.dataset.date = this.formatDateISO(date);\n    cell.setAttribute('role', 'gridcell');\n    cell.setAttribute('aria-label', this.formatDate(date, config.locale));\n    cell.setAttribute('tabindex', '-1');\n\n    // Add classes\n    if (this.isSameDay(date, today)) {\n      cell.classList.add('ec-today');\n    }\n    if (date.getMonth() !== currentMonth) {\n      cell.classList.add('ec-other-month');\n    }\n    if (date.getDay() === 0 || date.getDay() === 6) {\n      cell.classList.add('ec-weekend');\n    }\n\n    // Day number\n    const dayNum = document.createElement('div');\n    dayNum.className = 'ec-day-number';\n    dayNum.textContent = date.getDate();\n    cell.appendChild(dayNum);\n\n    // Count events for this day\n    const dayEvents = this.getEventsForDate(events, date);\n    const overflowCount = Math.max(0, dayEvents.length - config.maxEventsPerDay);\n\n    if (overflowCount > 0) {\n      const moreIndicator = document.createElement('div');\n      moreIndicator.className = 'ec-more-events';\n      moreIndicator.textContent = strings.moreEvents.replace('{count}', overflowCount);\n      const moreHandler = (e) => {\n        e.stopPropagation();\n        this.showEventsModal(instance, date, dayEvents);\n      };\n      this.addTrackedListener(instance, moreIndicator, 'click', moreHandler);\n      cell.appendChild(moreIndicator);\n    }\n\n    // Click handler\n    const cellClickHandler = (e) => {\n      this.handleDateClick(instance, date, e);\n    };\n    this.addTrackedListener(instance, cell, 'click', cellClickHandler);\n\n    // Mobile: tap to show day detail\n    const isMobile = window.Utils?.browser?.isMobile?.() ||\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n    if (isMobile) {\n      const mobileClickHandler = (e) => {\n        if (dayEvents.length > 0) {\n          e.stopPropagation();\n          this.showDayDetailModal(instance, date, dayEvents);\n        }\n      };\n      this.addTrackedListener(instance, cell, 'click', mobileClickHandler);\n    }\n\n    return cell;\n  },\n\n  /**\n   * Calculate spanning event segments\n   */\n  calculateSpanningSegments(instance, gridStart, totalDays) {\n    const {events, config, segmentCache} = instance;\n\n    // Create cache key based on events and date range\n    const cacheKey = `${this.formatDateISO(gridStart)}-${totalDays}-${events.length}`;\n\n    // Check cache\n    if (segmentCache.has(cacheKey)) {\n      return segmentCache.get(cacheKey);\n    }\n\n    const segments = [];\n\n    const gridEnd = new Date(gridStart);\n    gridEnd.setDate(gridStart.getDate() + totalDays - 1);\n\n    events.forEach(event => {\n      // Skip events outside view range\n      if (event.end < gridStart || event.start > gridEnd) return;\n\n      // Split into week segments\n      const eventSegments = this.splitEventIntoWeekSegments(\n        event,\n        gridStart,\n        gridEnd,\n        config.firstDayOfWeek\n      );\n      segments.push(...eventSegments);\n    });\n\n    // Assign row positions\n    const result = this.assignRowPositions(segments, config.firstDayOfWeek);\n\n    // Cache result (limit cache size)\n    if (segmentCache.size > 10) {\n      const firstKey = segmentCache.keys().next().value;\n      segmentCache.delete(firstKey);\n    }\n    segmentCache.set(cacheKey, result);\n\n    return result;\n  },\n\n  /**\n   * Split event into weekly segments\n   */\n  splitEventIntoWeekSegments(event, viewStart, viewEnd, firstDayOfWeek) {\n    const segments = [];\n\n    // Clamp to view range\n    const eventStart = new Date(Math.max(event.start.getTime(), viewStart.getTime()));\n    const eventEnd = new Date(Math.min(event.end.getTime(), viewEnd.getTime()));\n\n    let current = new Date(eventStart);\n\n    while (current <= eventEnd) {\n      // Find end of week\n      const weekEnd = this.getEndOfWeek(current, firstDayOfWeek);\n      const segmentEnd = new Date(Math.min(weekEnd.getTime(), eventEnd.getTime()));\n\n      // Calculate span in days\n      const spanDays = Math.floor((segmentEnd - current) / (1000 * 60 * 60 * 24)) + 1;\n\n      // Calculate day offset within week\n      const dayOffset = (current.getDay() - firstDayOfWeek + 7) % 7;\n\n      segments.push({\n        event: event,\n        eventId: event.id,\n        start: new Date(current),\n        end: new Date(segmentEnd),\n        isStart: this.isSameDay(current, event.start),\n        isEnd: this.isSameDay(segmentEnd, event.end),\n        spanDays: spanDays,\n        dayOffset: dayOffset,\n        row: -1 // Will be assigned later\n      });\n\n      // Move to next week\n      current = new Date(weekEnd);\n      current.setDate(current.getDate() + 1);\n    }\n\n    return segments;\n  },\n\n  /**\n   * Get end of week for a given date\n   */\n  getEndOfWeek(date, firstDayOfWeek) {\n    const result = new Date(date);\n    const dayOfWeek = result.getDay();\n    const daysUntilEnd = (6 - dayOfWeek + firstDayOfWeek) % 7;\n    result.setDate(result.getDate() + daysUntilEnd);\n    return result;\n  },\n\n  /**\n   * Assign row positions to avoid overlapping\n   */\n  assignRowPositions(segments, firstDayOfWeek) {\n    // Group by week\n    const weekGroups = new Map();\n\n    segments.forEach(segment => {\n      const weekKey = this.getWeekKey(segment.start, firstDayOfWeek);\n      if (!weekGroups.has(weekKey)) {\n        weekGroups.set(weekKey, []);\n      }\n      weekGroups.get(weekKey).push(segment);\n    });\n\n    // Assign rows within each week\n    weekGroups.forEach(weekSegments => {\n      // Sort by start date, then by duration (longer first)\n      weekSegments.sort((a, b) => {\n        if (a.dayOffset !== b.dayOffset) return a.dayOffset - b.dayOffset;\n        return b.spanDays - a.spanDays;\n      });\n\n      const rows = []; // Each row is an array of occupied day ranges\n\n      weekSegments.forEach(segment => {\n        let rowIndex = 0;\n        let placed = false;\n\n        while (!placed) {\n          if (!rows[rowIndex]) {\n            rows[rowIndex] = [];\n          }\n\n          // Check if this row has space for the segment\n          const hasConflict = rows[rowIndex].some(occupied => {\n            const occStart = occupied.dayOffset;\n            const occEnd = occupied.dayOffset + occupied.spanDays - 1;\n            const segStart = segment.dayOffset;\n            const segEnd = segment.dayOffset + segment.spanDays - 1;\n\n            return !(segEnd < occStart || segStart > occEnd);\n          });\n\n          if (!hasConflict) {\n            rows[rowIndex].push(segment);\n            segment.row = rowIndex;\n            placed = true;\n          } else {\n            rowIndex++;\n          }\n        }\n      });\n    });\n\n    return segments;\n  },\n\n  /**\n   * Get week key for grouping\n   */\n  getWeekKey(date, firstDayOfWeek) {\n    const weekStart = this.getStartOfWeek(date, firstDayOfWeek);\n    return this.formatDateISO(weekStart);\n  },\n\n  /**\n   * Get start of week\n   */\n  getStartOfWeek(date, firstDayOfWeek) {\n    const result = new Date(date);\n    const dayOfWeek = result.getDay();\n    const diff = (dayOfWeek - firstDayOfWeek + 7) % 7;\n    result.setDate(result.getDate() - diff);\n    return result;\n  },\n\n  /**\n   * Get segments for a specific week\n   */\n  getWeekSegments(segments, weekStart) {\n    const weekEnd = new Date(weekStart);\n    weekEnd.setDate(weekStart.getDate() + 6);\n\n    return segments.filter(segment => {\n      return segment.start >= weekStart && segment.start <= weekEnd;\n    });\n  },\n\n  /**\n   * Render spanning event bars for a week\n   */\n  renderWeekEventBars(instance, container, segments, weekStart) {\n    const {config} = instance;\n    const maxRows = config.maxEventsPerDay;\n\n    // Sort by row\n    segments.sort((a, b) => a.row - b.row);\n\n    segments.forEach(segment => {\n      if (segment.row >= maxRows) return; // Hide if exceeds max\n\n      const bar = document.createElement('div');\n      bar.className = 'ec-event-bar';\n      bar.dataset.eventId = segment.event.id; // Add event ID for delegation\n      bar.style.left = `${(segment.dayOffset / 7) * 100}%`;\n      bar.style.width = `${(segment.spanDays / 7) * 100}%`;\n      bar.style.top = `${segment.row * 24 + 22}px`; // 22px offset for day number\n      bar.style.backgroundColor = segment.event.color;\n\n      // Add start/end classes\n      if (segment.isStart) bar.classList.add('ec-event-start');\n      if (segment.isEnd) bar.classList.add('ec-event-end');\n\n      // Title\n      const title = document.createElement('span');\n      title.className = 'ec-event-title';\n      title.textContent = segment.event.title;\n      bar.appendChild(title);\n\n      // Click handler now handled by delegation\n\n      container.appendChild(bar);\n    });\n  },\n\n  /**\n   * Render week view\n   */\n  renderWeekView(instance) {\n    const {contentElement, currentDate, config, events} = instance;\n    const strings = this.i18n[config.locale];\n\n    contentElement.innerHTML = '';\n    contentElement.className = 'ec-content ec-week-view';\n\n    const weekStart = this.getStartOfWeek(currentDate, config.firstDayOfWeek);\n\n    // Create week container\n    const weekContainer = document.createElement('div');\n    weekContainer.className = 'ec-week-container';\n\n    // All-day events section\n    const allDaySection = document.createElement('div');\n    allDaySection.className = 'ec-allday-section';\n\n    const allDayLabel = document.createElement('div');\n    allDayLabel.className = 'ec-allday-label';\n    allDayLabel.textContent = strings.allDay;\n    allDaySection.appendChild(allDayLabel);\n\n    const allDayGrid = document.createElement('div');\n    allDayGrid.className = 'ec-allday-grid';\n\n    // Day columns header\n    for (let i = 0; i < 7; i++) {\n      const dayDate = new Date(weekStart);\n      dayDate.setDate(weekStart.getDate() + i);\n\n      const header = document.createElement('div');\n      header.className = 'ec-week-day-header';\n      if (this.isSameDay(dayDate, new Date())) {\n        header.classList.add('ec-today');\n      }\n\n      header.innerHTML = `\n        <div class=\"ec-week-dayname\">${strings.dayNamesShort[dayDate.getDay()]}</div>\n        <div class=\"ec-week-daynum\">${dayDate.getDate()}</div>\n      `;\n      allDayGrid.appendChild(header);\n    }\n\n    allDaySection.appendChild(allDayGrid);\n\n    // Render all-day spanning events\n    const segments = this.calculateSpanningSegments(instance, weekStart, 7);\n    const allDayEvents = document.createElement('div');\n    allDayEvents.className = 'ec-allday-events';\n    this.renderWeekEventBars(instance, allDayEvents, segments, weekStart);\n    allDaySection.appendChild(allDayEvents);\n\n    weekContainer.appendChild(allDaySection);\n\n    // Time grid\n    const timeGrid = document.createElement('div');\n    timeGrid.className = 'ec-time-grid';\n\n    // Time labels column\n    const timeLabels = document.createElement('div');\n    timeLabels.className = 'ec-time-labels';\n\n    for (let hour = 0; hour < 24; hour++) {\n      const label = document.createElement('div');\n      label.className = 'ec-time-label';\n      label.textContent = `${hour.toString().padStart(2, '0')}:00`;\n      timeLabels.appendChild(label);\n    }\n    timeGrid.appendChild(timeLabels);\n\n    // Day columns\n    const dayColumns = document.createElement('div');\n    dayColumns.className = 'ec-day-columns';\n\n    for (let i = 0; i < 7; i++) {\n      const dayDate = new Date(weekStart);\n      dayDate.setDate(weekStart.getDate() + i);\n\n      const column = document.createElement('div');\n      column.className = 'ec-day-column';\n      column.dataset.date = this.formatDateISO(dayDate);\n\n      // Hour slots\n      for (let hour = 0; hour < 24; hour++) {\n        const slot = document.createElement('div');\n        slot.className = 'ec-hour-slot';\n        slot.dataset.hour = hour;\n\n        // Click handler now handled by delegation\n\n        column.appendChild(slot);\n      }\n\n      // Render timed events\n      const dayEvents = this.getEventsForDate(events, dayDate).filter(e => !e.allDay);\n      this.renderTimedEvents(instance, column, dayEvents, dayDate);\n\n      dayColumns.appendChild(column);\n    }\n\n    timeGrid.appendChild(dayColumns);\n    weekContainer.appendChild(timeGrid);\n    contentElement.appendChild(weekContainer);\n  },\n\n  /**\n   * Render timed events in week/day view\n   */\n  renderTimedEvents(instance, container, events, date) {\n    events.forEach(event => {\n      const startHour = event.start.getHours() + event.start.getMinutes() / 60;\n      const endHour = event.end.getHours() + event.end.getMinutes() / 60;\n      const duration = Math.max(endHour - startHour, 0.5);\n\n      const eventEl = document.createElement('div');\n      eventEl.className = 'ec-timed-event';\n      eventEl.dataset.eventId = event.id; // Add event ID for delegation\n      eventEl.style.top = `${startHour * 48}px`; // 48px per hour\n      eventEl.style.height = `${duration * 48}px`;\n      eventEl.style.backgroundColor = event.color;\n\n      eventEl.innerHTML = `\n        <div class=\"ec-event-time\">${this.formatTime(event.start)}</div>\n        <div class=\"ec-event-title\">${this.escapeHtml(event.title)}</div>\n      `;\n\n      // Click handler now handled by delegation\n\n      container.appendChild(eventEl);\n    });\n  },\n\n  /**\n   * Render day view\n   */\n  renderDayView(instance) {\n    const {contentElement, currentDate, config, events} = instance;\n    const strings = this.i18n[config.locale];\n\n    contentElement.innerHTML = '';\n    contentElement.className = 'ec-content ec-day-view';\n\n    // Day header\n    const header = document.createElement('div');\n    header.className = 'ec-day-header';\n    header.innerHTML = `\n      <span class=\"ec-day-name\">${strings.dayNames[currentDate.getDay()]}</span>\n      <span class=\"ec-day-date\">${currentDate.getDate()}</span>\n      <span class=\"ec-day-month\">${strings.monthNames[currentDate.getMonth()]}</span>\n    `;\n    contentElement.appendChild(header);\n\n    // All-day events\n    const dayEvents = this.getEventsForDate(events, currentDate);\n    const allDayEvents = dayEvents.filter(e => e.allDay);\n    const timedEvents = dayEvents.filter(e => !e.allDay);\n\n    if (allDayEvents.length > 0) {\n      const allDaySection = document.createElement('div');\n      allDaySection.className = 'ec-day-allday';\n\n      allDayEvents.forEach(event => {\n        const eventEl = document.createElement('div');\n        eventEl.className = 'ec-allday-event';\n        eventEl.dataset.eventId = event.id; // Add event ID for delegation\n        eventEl.style.backgroundColor = event.color;\n        eventEl.textContent = event.title;\n        // Click handler now handled by delegation\n        allDaySection.appendChild(eventEl);\n      });\n\n      contentElement.appendChild(allDaySection);\n    }\n\n    // Time grid\n    const timeGrid = document.createElement('div');\n    timeGrid.className = 'ec-day-time-grid';\n\n    for (let hour = 0; hour < 24; hour++) {\n      const slot = document.createElement('div');\n      slot.className = 'ec-hour-slot';\n      slot.dataset.hour = hour;\n\n      const label = document.createElement('div');\n      label.className = 'ec-hour-label';\n      label.textContent = `${hour.toString().padStart(2, '0')}:00`;\n\n      const area = document.createElement('div');\n      area.className = 'ec-hour-area';\n\n      // Click handler now handled by delegation\n\n      slot.appendChild(label);\n      slot.appendChild(area);\n      timeGrid.appendChild(slot);\n    }\n\n    // Render timed events\n    this.renderTimedEvents(instance, timeGrid, timedEvents, currentDate);\n\n    contentElement.appendChild(timeGrid);\n  },\n\n  // ========== Event Handlers ==========\n\n  /**\n   * Handle date click\n   */\n  handleDateClick(instance, date, domEvent) {\n    const {config} = instance;\n\n    // Emit event\n    this.emitEvent('eventcalendar:dateClick', {\n      date,\n      instance,\n      element: instance.element\n    });\n\n    // Call callback if configured\n    if (config.onDateClick) {\n      if (typeof config.onDateClick === 'function') {\n        config.onDateClick(date, instance);\n      } else if (typeof config.onDateClick === 'string') {\n        // Look for function in window\n        const fn = window.Utils?.object?.get?.(window, config.onDateClick) ??\n          config.onDateClick.split('.').reduce((o, k) => o?.[k], window);\n        if (typeof fn === 'function') {\n          fn(date, instance);\n        }\n      }\n    }\n  },\n\n  /**\n   * Handle event click\n   */\n  handleEventClick(instance, eventData, domEvent) {\n    domEvent.stopPropagation();\n\n    const {config} = instance;\n\n    // Emit event\n    this.emitEvent('eventcalendar:eventClick', {\n      event: eventData,\n      instance,\n      element: instance.element\n    });\n\n    // API action\n    if (config.onEventClickApi) {\n      const url = config.onEventClickApi.replace('{id}', eventData.id);\n\n      const fetchEvent = async () => {\n        try {\n          let response;\n          if (window.ApiService && typeof ApiService.get === 'function') {\n            response = await ApiService.get(url);\n          } else {\n            const res = await fetch(url);\n            response = await res.json();\n          }\n\n          // Process through ResponseHandler\n          if (window.ResponseHandler) {\n            ResponseHandler.process(response, {\n              element: instance.element,\n              data: eventData\n            });\n          }\n        } catch (error) {\n          console.error('[EventCalendar] Event click API error:', error);\n        }\n      };\n\n      fetchEvent();\n    }\n\n    // Custom callback\n    if (config.onEventClick) {\n      if (typeof config.onEventClick === 'function') {\n        config.onEventClick(eventData, instance);\n      } else if (typeof config.onEventClick === 'string') {\n        const fn = window.Utils?.object?.get?.(window, config.onEventClick) ??\n          config.onEventClick.split('.').reduce((o, k) => o?.[k], window);\n        if (typeof fn === 'function') {\n          fn(eventData, instance);\n        }\n      }\n    }\n  },\n\n  /**\n   * Show day detail modal (for mobile)\n   */\n  showDayDetailModal(instance, date, events) {\n    const {config} = instance;\n    const strings = this.i18n[config.locale];\n\n    const eventListHtml = events.map(event => `\n      <div class=\"ec-modal-event\" data-event-id=\"${event.id}\" style=\"border-left-color: ${event.color}\">\n        <div class=\"ec-modal-event-title\">${this.escapeHtml(event.title)}</div>\n        ${event.allDay ? `<div class=\"ec-modal-event-time\">${strings.allDay}</div>` :\n        `<div class=\"ec-modal-event-time\">${this.formatTime(event.start)} - ${this.formatTime(event.end)}</div>`}\n        ${event.location ? `<div class=\"ec-modal-event-location\">${this.escapeHtml(event.location)}</div>` : ''}\n      </div>\n    `).join('');\n\n    const content = `\n      <div class=\"ec-day-modal\">\n        <div class=\"ec-day-modal-date\">\n          <span class=\"ec-day-name\">${strings.dayNames[date.getDay()]}</span>\n          <span class=\"ec-day-num\">${date.getDate()}</span>\n          <span class=\"ec-month-name\">${strings.monthNames[date.getMonth()]}</span>\n        </div>\n        <div class=\"ec-modal-events\">\n          ${events.length > 0 ? eventListHtml : `<div class=\"ec-no-events\">${strings.noEvents}</div>`}\n        </div>\n      </div>\n    `;\n\n    this.showModal(content, {\n      title: this.formatDate(date, config.locale),\n      onEventClick: (eventId) => {\n        const event = events.find(e => e.id === eventId);\n        if (event) {\n          this.handleEventClick(instance, event, {stopPropagation: () => {}});\n        }\n      }\n    });\n  },\n\n  /**\n   * Show events modal (for \"+more\" click)\n   */\n  showEventsModal(instance, date, events) {\n    this.showDayDetailModal(instance, date, events);\n  },\n\n  /**\n   * Show modal using Modal component\n   */\n  showModal(content, options = {}) {\n    if (window.Modal) {\n      const modal = new Modal({\n        title: options.title || '',\n        content: content,\n        size: 'medium',\n        backdrop: true,\n        closeOnBackdrop: true\n      });\n      modal.show();\n\n      // Bind event click handlers\n      if (options.onEventClick) {\n        modal.element.querySelectorAll('.ec-modal-event').forEach(el => {\n          el.addEventListener('click', () => {\n            options.onEventClick(el.dataset.eventId);\n            modal.hide();\n          });\n        });\n      }\n    } else {\n      // Fallback: simple dialog\n      if (window.DialogManager) {\n        DialogManager.show({\n          title: options.title || '',\n          content: content,\n          buttons: [{text: 'Close', primary: true}]\n        });\n      }\n    }\n  },\n\n  // ========== Navigation ==========\n\n  /**\n   * Navigate calendar\n   */\n  navigate(instance, direction) {\n    const {currentView, currentDate} = instance;\n\n    switch (currentView) {\n      case 'day':\n        currentDate.setDate(currentDate.getDate() + direction);\n        break;\n      case 'week':\n        currentDate.setDate(currentDate.getDate() + (direction * 7));\n        break;\n      case 'month':\n        currentDate.setMonth(currentDate.getMonth() + direction);\n        break;\n    }\n\n    // Reload events if API configured\n    if (instance.config.api) {\n      this.loadEvents(instance);\n    } else {\n      this.render(instance);\n    }\n\n    this.emitEvent('eventcalendar:navigate', {\n      date: new Date(currentDate),\n      view: currentView,\n      instance\n    });\n  },\n\n  /**\n   * Go to today\n   */\n  goToToday(instance) {\n    instance.currentDate = new Date();\n\n    if (instance.config.api) {\n      this.loadEvents(instance);\n    } else {\n      this.render(instance);\n    }\n\n    this.emitEvent('eventcalendar:today', {\n      date: new Date(),\n      instance\n    });\n  },\n\n  /**\n   * Change view\n   */\n  changeView(instance, view) {\n    if (!instance.config.views.includes(view)) return;\n\n    instance.currentView = view;\n    this.render(instance);\n\n    this.emitEvent('eventcalendar:viewChange', {\n      view,\n      instance\n    });\n  },\n\n  /**\n   * Update current period display\n   */\n  updateCurrentPeriod(instance) {\n    const {currentDate, currentView, config} = instance;\n    const strings = this.i18n[config.locale];\n    let text = '';\n\n    switch (currentView) {\n      case 'day':\n        text = `${currentDate.getDate()} ${strings.monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;\n        break;\n      case 'week':\n        const weekStart = this.getStartOfWeek(currentDate, config.firstDayOfWeek);\n        const weekEnd = new Date(weekStart);\n        weekEnd.setDate(weekStart.getDate() + 6);\n        text = `${weekStart.getDate()} - ${weekEnd.getDate()} ${strings.monthNames[weekEnd.getMonth()]} ${weekEnd.getFullYear()}`;\n        break;\n      case 'month':\n        text = `${strings.monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;\n        break;\n    }\n\n    if (instance.currentPeriodElement) {\n      instance.currentPeriodElement.textContent = text;\n    }\n  },\n\n  /**\n   * Update view switcher\n   */\n  updateViewSwitcher(instance) {\n    if (!instance.viewSwitcherElement) return;\n\n    instance.viewSwitcherElement.querySelectorAll('.ec-view-btn').forEach(btn => {\n      btn.classList.toggle('active', btn.dataset.view === instance.currentView);\n    });\n  },\n\n  // ========== Utilities ==========\n\n  /**\n   * Get events for a specific date\n   */\n  getEventsForDate(events, date) {\n    return events.filter(event => {\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n\n      // Reset time for date comparison\n      const checkDate = new Date(date);\n      checkDate.setHours(0, 0, 0, 0);\n\n      const startDate = new Date(eventStart);\n      startDate.setHours(0, 0, 0, 0);\n\n      const endDate = new Date(eventEnd);\n      endDate.setHours(0, 0, 0, 0);\n\n      return checkDate >= startDate && checkDate <= endDate;\n    });\n  },\n\n  /**\n   * Get view date range\n   */\n  getViewDateRange(instance) {\n    const {currentDate, currentView, config} = instance;\n    let start, end;\n\n    switch (currentView) {\n      case 'day':\n        start = new Date(currentDate);\n        start.setHours(0, 0, 0, 0);\n        end = new Date(currentDate);\n        end.setHours(23, 59, 59, 999);\n        break;\n      case 'week':\n        start = this.getStartOfWeek(currentDate, config.firstDayOfWeek);\n        end = new Date(start);\n        end.setDate(start.getDate() + 6);\n        end.setHours(23, 59, 59, 999);\n        break;\n      case 'month':\n        start = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        end = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n        end.setHours(23, 59, 59, 999);\n        // Extend to include visible days from adjacent months\n        const startOffset = (start.getDay() - config.firstDayOfWeek + 7) % 7;\n        start.setDate(start.getDate() - startOffset);\n        const endOffset = (6 - end.getDay() + config.firstDayOfWeek) % 7;\n        end.setDate(end.getDate() + endOffset);\n        break;\n    }\n\n    return {start, end};\n  },\n\n  /**\n   * Check if two dates are the same day\n   */\n  isSameDay(date1, date2) {\n    return date1.getFullYear() === date2.getFullYear() &&\n      date1.getMonth() === date2.getMonth() &&\n      date1.getDate() === date2.getDate();\n  },\n\n  /**\n   * Format date as ISO string (YYYY-MM-DD)\n   */\n  formatDateISO(date) {\n    const d = new Date(date);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  },\n\n  /**\n   * Format date for display\n   */\n  formatDate(date, locale = 'en') {\n    const strings = this.i18n[locale] || this.i18n.en;\n    return `${date.getDate()} ${strings.monthNames[date.getMonth()]} ${date.getFullYear()}`;\n  },\n\n  /**\n   * Format time\n   */\n  formatTime(date) {\n    const hours = date.getHours().toString().padStart(2, '0');\n    const minutes = date.getMinutes().toString().padStart(2, '0');\n    return `${hours}:${minutes}`;\n  },\n\n  /**\n   * Escape HTML entities\n   */\n  escapeHtml(str) {\n    if (!str) return '';\n    const div = document.createElement('div');\n    div.textContent = str;\n    return div.innerHTML;\n  },\n\n  /**\n   * Emit event\n   */\n  emitEvent(eventName, data) {\n    EventManager.emit(eventName, data);\n\n    // Also dispatch DOM event\n    const event = new CustomEvent(eventName, {\n      detail: data,\n      bubbles: true\n    });\n    document.dispatchEvent(event);\n  },\n\n  // ========== Public API ==========\n\n  /**\n   * Add event\n   */\n  addEvent(elementOrInstance, event) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return;\n\n    const normalizedEvent = this.normalizeEvents([event])[0];\n    instance.events.push(normalizedEvent);\n    instance.segmentCache.clear(); // Clear cache when events change\n    this.render(instance);\n\n    this.emitEvent('eventcalendar:eventAdd', {\n      event: normalizedEvent,\n      instance\n    });\n  },\n\n  /**\n   * Remove event\n   */\n  removeEvent(elementOrInstance, eventId) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return;\n\n    instance.events = instance.events.filter(e => e.id !== eventId);\n    instance.segmentCache.clear(); // Clear cache when events change\n    this.render(instance);\n\n    this.emitEvent('eventcalendar:eventRemove', {\n      eventId,\n      instance\n    });\n  },\n\n  /**\n   * Update event\n   */\n  updateEvent(elementOrInstance, eventId, data) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return;\n\n    const index = instance.events.findIndex(e => e.id === eventId);\n    if (index !== -1) {\n      instance.events[index] = {...instance.events[index], ...data};\n      instance.segmentCache.clear(); // Clear cache when events change\n      this.render(instance);\n\n      this.emitEvent('eventcalendar:eventUpdate', {\n        event: instance.events[index],\n        instance\n      });\n    }\n  },\n\n  /**\n   * Get events\n   */\n  getEvents(elementOrInstance, start = null, end = null) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return [];\n\n    let events = [...instance.events];\n\n    if (start && end) {\n      events = events.filter(e =>\n        e.start <= end && e.end >= start\n      );\n    }\n\n    return events;\n  },\n\n  /**\n   * Refresh events from API\n   */\n  refreshEvents(elementOrInstance) {\n    const instance = this.getInstance(elementOrInstance);\n    if (instance && instance.config.api) {\n      this.loadEvents(instance);\n    }\n  },\n\n  /**\n   * Set events directly\n   */\n  setEvents(elementOrInstance, events) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return;\n\n    instance.events = this.normalizeEvents(events);\n    instance.segmentCache.clear(); // Clear cache when events change\n    this.render(instance);\n  },\n\n  /**\n   * Get instance\n   */\n  getInstance(elementOrInstance) {\n    if (elementOrInstance && elementOrInstance.element) {\n      return elementOrInstance; // Already an instance\n    }\n\n    if (typeof elementOrInstance === 'string') {\n      elementOrInstance = document.querySelector(elementOrInstance);\n    }\n\n    return elementOrInstance?._eventCalendar || null;\n  },\n\n  /**\n   * Destroy instance\n   */\n  destroy(elementOrInstance) {\n    const instance = this.getInstance(elementOrInstance);\n    if (!instance) return;\n\n    const {element} = instance;\n\n    // Remove all tracked event listeners\n    if (instance.eventListeners && instance.eventListeners.length > 0) {\n      instance.eventListeners.forEach(({element: el, event, handler, options}) => {\n        el.removeEventListener(event, handler, options);\n      });\n      instance.eventListeners = [];\n    }\n\n    // Clear intervals/timeouts if any\n    if (instance.updateTimer) {\n      clearInterval(instance.updateTimer);\n    }\n\n    // Clear DOM\n    element.innerHTML = '';\n    element.classList.remove('event-calendar');\n\n    // Remove references\n    delete element._eventCalendar;\n    this.state.instances.delete(element);\n\n    // Emit destroy event\n    this.emitEvent('eventcalendar:destroy', {element});\n  }\n};\n\n// Register with Now framework if available\nif (window.Now?.registerManager) {\n  Now.registerManager('eventCalendar', EventCalendar);\n}\n\n// Expose globally (but don't auto-init - let app decide)\nwindow.EventCalendar = EventCalendar;\n\n// Auto-initialize when DOM is ready (only if not already initialized)\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    if (!EventCalendar.state.initialized) {\n      EventCalendar.init();\n    }\n  });\n} else {\n  if (!EventCalendar.state.initialized) {\n    EventCalendar.init();\n  }\n}\n"],"names":["EventCalendar","config","defaultView","locale","timezone","firstDayOfWeek","maxEventsPerDay","showNavigation","showToday","showViewSwitcher","views","api","apiMethod","eventDataPath","eventColors","onDateClick","onEventClick","onEventClickApi","state","instances","Map","initialized","cleanupHandlers","WeakMap","i18n","th","today","month","week","day","moreEvents","noEvents","allDay","loading","error","retry","previous","next","monthNames","monthNamesShort","dayNames","dayNamesShort","en","init","options","this","document","querySelectorAll","forEach","element","create","validateConfig","errors","Array","isArray","length","validViews","invalidViews","filter","includes","v","push","join","validMethods","toUpperCase","console","querySelector","_eventCalendar","dataOptions","extractDataOptions","_b","_a","window","I18nManager","getCurrentLanguage","call","documentElement","lang","startsWith","instance","currentDate","Date","currentView","events","eventSegments","isLoading","eventListeners","segmentCache","set","setupCalendar","loadEvents","render","dataset","view","firstDay","parseInt","maxEvents","split","map","trim","JSON","parse","e","warn","addTrackedListener","event","handler","addEventListener","setupEventDelegation","target","closest","stopPropagation","eventId","find","ev","id","handleEventClick","slot","hour","column","dateStr","date","clickDate","setHours","handleDateClick","setupKeyboardNavigation","hasAttribute","setAttribute","key","preventDefault","navigate","goToToday","ctrlKey","metaKey","changeView","classList","add","innerHTML","header","createElement","className","nav","createNavigation","appendChild","switcher","createViewSwitcher","headerElement","content","contentElement","strings","prevBtn","current","currentPeriodElement","nextBtn","todayBtn","textContent","viewLabels","btn","viewSwitcherElement","renderLoading","viewRange","getViewDateRange","params","URLSearchParams","start","formatDateISO","end","url","response","ApiService","get","res","fetch","method","json","_c","Utils","object","data","_d","_e","normalizeEvents","message","parseDate","dateString","getTime","getTimezoneOffset","formatDateForAPI","toISOString","index","startDate","endDate","isNaN","now","title","color","category","description","location","renderError","updateCurrentPeriod","updateViewSwitcher","renderMonthView","renderWeekView","renderDayView","escapeHtml","retryBtn","fragment","createDocumentFragment","grid","headerRow","headerFragment","i","dayIndex","monthStart","getFullYear","getMonth","gridStart","startDayOffset","getDay","setDate","getDate","segments","calculateSpanningSegments","weekRow","eventLayer","dayLayer","dayFragment","cellDate","cell","createDayCell","weekStart","weekSegments","getWeekSegments","renderWeekEventBars","currentMonth","formatDate","isSameDay","dayNum","dayEvents","getEventsForDate","overflowCount","Math","max","moreIndicator","replace","moreHandler","showEventsModal","browser","isMobile","test","navigator","userAgent","mobileClickHandler","showDayDetailModal","totalDays","cacheKey","has","gridEnd","splitEventIntoWeekSegments","result","assignRowPositions","size","firstKey","keys","value","delete","viewStart","viewEnd","eventStart","eventEnd","min","weekEnd","getEndOfWeek","segmentEnd","spanDays","floor","dayOffset","isStart","isEnd","row","daysUntilEnd","weekGroups","segment","weekKey","getWeekKey","sort","a","b","rows","rowIndex","placed","some","occupied","occStart","occEnd","segStart","getStartOfWeek","diff","container","maxRows","bar","style","left","width","top","backgroundColor","weekContainer","allDaySection","allDayLabel","allDayGrid","dayDate","allDayEvents","timeGrid","timeLabels","label","toString","padStart","dayColumns","renderTimedEvents","startHour","getHours","getMinutes","endHour","duration","eventEl","height","formatTime","timedEvents","area","domEvent","emitEvent","fn","reduce","o","k","eventData","async","ResponseHandler","process","fetchEvent","eventListHtml","showModal","Modal","modal","backdrop","closeOnBackdrop","show","el","hide","DialogManager","buttons","text","primary","direction","setMonth","toggle","checkDate","startOffset","endOffset","date1","date2","d","String","str","div","eventName","EventManager","emit","CustomEvent","detail","bubbles","dispatchEvent","addEvent","elementOrInstance","getInstance","normalizedEvent","clear","removeEvent","updateEvent","findIndex","getEvents","refreshEvents","setEvents","destroy","removeEventListener","updateTimer","clearInterval","remove","Now","registerManager","readyState"],"mappings":"+BAkBA,MAAMA,EAAgB,CACpBC,OAAQ,CACNC,YAAa,QACbC,OAAQ,OACRC,SAAU,QACVC,eAAgB,EAChBC,gBAAiB,EACjBC,gBAAgB,EAChBC,WAAW,EACXC,kBAAkB,EAClBC,MAAO,CAAC,QAAS,OAAQ,OACzBC,IAAK,KACLC,UAAW,MACXC,cAAe,OACfC,YAAa,CACX,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEFC,YAAa,KACbC,aAAc,KACdC,gBAAiB,MAGnBC,MAAO,CACLC,cAAeC,IACfC,aAAa,EACbC,oBAAqBC,SAIvBC,KAAM,CACJC,GAAI,CACFC,MAAO,SACPC,MAAO,QACPC,KAAM,UACNC,IAAK,MACLC,WAAY,qBACZC,SAAU,eACVC,OAAQ,UACRC,QAAS,eACTC,MAAO,iBACPC,MAAO,UACPC,SAAU,WACVC,KAAM,QACNC,WAAY,CACV,SAAU,aAAc,SAAU,SAClC,UAAW,WAAY,UAAW,UAClC,UAAW,SAAU,YAAa,WAEpCC,gBAAiB,CACf,OAAQ,OAAQ,QAAS,QACzB,OAAQ,QAAS,OAAQ,OACzB,OAAQ,OAAQ,OAAQ,QAE1BC,SAAU,CAAC,UAAW,SAAU,SAAU,MAAO,WAAY,QAAS,SACtEC,cAAe,CAAC,KAAM,IAAK,IAAK,IAAK,KAAM,IAAK,MAElDC,GAAI,CACFhB,MAAO,QACPC,MAAO,QACPC,KAAM,OACNC,IAAK,MACLC,WAAY,gBACZC,SAAU,YACVC,OAAQ,UACRC,QAAS,aACTC,MAAO,iBACPC,MAAO,QACPC,SAAU,WACVC,KAAM,OACNC,WAAY,CACV,UAAW,WAAY,QAAS,QAChC,MAAO,OAAQ,OAAQ,SACvB,YAAa,UAAW,WAAY,YAEtCC,gBAAiB,CACf,MAAO,MAAO,MAAO,MACrB,MAAO,MAAO,MAAO,MACrB,MAAO,MAAO,MAAO,OAEvBC,SAAU,CAAC,SAAU,SAAU,UAAW,YAAa,WAAY,SAAU,YAC7EC,cAAe,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,SAO9D,IAAAE,CAAKC,EAAU,IACb,OAAIC,KAAK3B,MAAMG,cAEfwB,KAAK5C,OAAS,IAAI4C,KAAK5C,UAAW2C,GAGlCE,SAASC,iBAAiB,yBAAyBC,QAAQC,IACzDJ,KAAKK,OAAOD,KAGdJ,KAAK3B,MAAMG,aAAc,GATUwB,IAWrC,EAKA,cAAAM,CAAelD,GACb,MAAMmD,EAAS,GAGf,GAAKC,MAAMC,QAAQrD,EAAOS,QAAkC,IAAxBT,EAAOS,MAAM6C,OAE1C,CACL,MAAMC,EAAa,CAAC,QAAS,OAAQ,OAC/BC,EAAexD,EAAOS,MAAMgD,WAAaF,EAAWG,SAASC,IAC/DH,EAAaF,OAAS,GACxBH,EAAOS,KAAK,oBAAoBJ,EAAaK,KAAK,2BAA2BN,EAAWM,KAAK,QAEjG,MAPEV,EAAOS,KAAK,mCAUT5D,EAAOS,MAAMiD,SAAS1D,EAAOC,cAChCkD,EAAOS,KAAK,gBAAgB5D,EAAOC,uCAIC,iBAA3BD,EAAOK,iBAAgCL,EAAOK,gBAAkB,IACzE8C,EAAOS,KAAK,8CAIuB,iBAA1B5D,EAAOI,gBAA+BJ,EAAOI,eAAiB,GAAKJ,EAAOI,eAAiB,IACpG+C,EAAOS,KAAK,uEAIV5D,EAAOU,KAA6B,iBAAfV,EAAOU,KAC9ByC,EAAOS,KAAK,4BAId,MAAME,EAAe,CAAC,MAAO,OAAQ,MAAO,SAAU,SAWtD,OAVI9D,EAAOW,YAAcmD,EAAaJ,SAAS1D,EAAOW,UAAUoD,gBAC9DZ,EAAOS,KAAK,6BAA6BE,EAAaD,KAAK,SAIxDT,MAAMC,QAAQrD,EAAOa,cAA8C,IAA9Bb,EAAOa,YAAYyC,QAC3DH,EAAOS,KAAK,2CAIVT,EAAOG,OAAS,KAClBU,QAAQ/B,MAAM,wCAAyCkB,IAChD,EAIX,EAKA,MAAAF,CAAOD,EAASL,EAAU,YAKxB,GAJuB,iBAAZK,IACTA,EAAUH,SAASoB,cAAcjB,KAG9BA,EAEH,OADAgB,QAAQ/B,MAAM,qCACP,KAIT,GAAIe,EAAQkB,eACV,OAAOlB,EAAQkB,eAIjB,MAAMC,EAAcvB,KAAKwB,mBAAmBpB,GACtChD,EAAS,IAAI4C,KAAK5C,UAAWmE,KAAgBxB,GAGnD,IAAKC,KAAKM,eAAelD,GAEvB,OADAgE,QAAQ/B,MAAM,0EACP,KAIa,SAAlBjC,EAAOE,SACTF,EAAOE,QAAS,OAAAmE,EAAA,OAAAC,EAAAC,OAAOC,kBAAP,EAAAF,EAAoBG,yBAApB,EAAAJ,EAAAK,KAAAJ,KACdzB,SAAS8B,gBAAgBC,MACzB,MAIJ5E,EAAOE,OAASF,EAAOE,OAAO2E,WAAW,MAAQ,KAAO,KAExD,MAAMC,EAAW,CACf9B,UACAhD,SACA+E,gBAAiBC,KACjBC,YAAajF,EAAOC,YACpBiF,OAAQ,GACRC,cAAe,GACfC,WAAW,EACXnD,MAAO,KAEPoD,eAAgB,GAEhBC,iBAAkBnE,KAgBpB,OAbA6B,EAAQkB,eAAiBY,EACzBlC,KAAK3B,MAAMC,UAAUqE,IAAIvC,EAAS8B,GAGlClC,KAAK4C,cAAcV,GAGf9E,EAAOU,IACTkC,KAAK6C,WAAWX,GAEhBlC,KAAK8C,OAAOZ,GAGPA,CACT,EAKA,kBAAAV,CAAmBpB,GACjB,MAAM2C,EAAU3C,EAAQ2C,QAClBhD,EAAU,CAAA,EAkBhB,GAhBIgD,EAAQC,OAAMjD,EAAQ1C,YAAc0F,EAAQC,MAC5CD,EAAQzF,SAAQyC,EAAQzC,OAASyF,EAAQzF,QACzCyF,EAAQE,WAAUlD,EAAQvC,eAAiB0F,SAASH,EAAQE,WAC5DF,EAAQI,YAAWpD,EAAQtC,gBAAkByF,SAASH,EAAQI,YAC9DJ,EAAQjF,MAAKiC,EAAQjC,IAAMiF,EAAQjF,KACnCiF,EAAQhF,YAAWgC,EAAQhC,UAAYgF,EAAQhF,WAC/CgF,EAAQ/E,gBAAe+B,EAAQ/B,cAAgB+E,EAAQ/E,eACvD+E,EAAQ7E,cAAa6B,EAAQ7B,YAAc6E,EAAQ7E,aACnD6E,EAAQ5E,eAAc4B,EAAQ5B,aAAe4E,EAAQ5E,cACrD4E,EAAQ3E,kBAAiB2B,EAAQ3B,gBAAkB2E,EAAQ3E,sBAChC,IAA3B2E,EAAQrF,iBAA8BqC,EAAQrC,eAA4C,UAA3BqF,EAAQrF,qBACjD,IAAtBqF,EAAQpF,YAAyBoC,EAAQpC,UAAkC,UAAtBoF,EAAQpF,gBAChC,IAA7BoF,EAAQnF,mBAAgCmC,EAAQnC,iBAAgD,UAA7BmF,EAAQnF,kBAC3EmF,EAAQlF,QAAOkC,EAAQlC,MAAQkF,EAAQlF,MAAMuF,MAAM,KAAKC,IAAItC,GAAKA,EAAEuC,SAGnEP,EAAQT,OACV,IACEvC,EAAQuC,OAASiB,KAAKC,MAAMT,EAAQT,OACtC,OAASmB,GACPrC,QAAQsC,KAAK,sCACf,CAGF,OAAO3D,CACT,EAKA,kBAAA4D,CAAmBzB,EAAU9B,EAASwD,EAAOC,EAAS9D,GACpDK,EAAQ0D,iBAAiBF,EAAOC,EAAS9D,GACzCmC,EAASO,eAAezB,KAAK,CAACZ,UAASwD,QAAOC,UAAS9D,WACzD,EAKA,oBAAAgE,CAAqB7B,GACnB,MAAM9B,QAACA,GAAW8B,EAyElBlC,KAAK2D,mBAAmBzB,EAAU9B,EAAS,QAtElBqD,IACvB,MAAMO,EAASP,EAAEO,OAGjB,GAAIA,EAAOC,QAAQ,iBAAkB,CACnCR,EAAES,kBACF,MACMC,EADMH,EAAOC,QAAQ,iBACPlB,QAAQoB,QAC5B,GAAIA,EAAS,CACX,MAAMP,EAAQ1B,EAASI,OAAO8B,KAAKC,GAAMA,EAAGC,KAAOH,GAC/CP,GACF5D,KAAKuE,iBAAiBrC,EAAU0B,EAAOH,EAE3C,CACA,MACF,CAGA,GAAIO,EAAOC,QAAQ,mBAAoB,CACrCR,EAAES,kBACF,MACMC,EADUH,EAAOC,QAAQ,mBACPlB,QAAQoB,QAChC,GAAIA,EAAS,CACX,MAAMP,EAAQ1B,EAASI,OAAO8B,KAAKC,GAAMA,EAAGC,KAAOH,GAC/CP,GACF5D,KAAKuE,iBAAiBrC,EAAU0B,EAAOH,EAE3C,CACA,MACF,CAGA,GAAIO,EAAOC,QAAQ,oBAAqB,CACtC,MACME,EADUH,EAAOC,QAAQ,oBACPlB,QAAQoB,QAChC,GAAIA,EAAS,CACX,MAAMP,EAAQ1B,EAASI,OAAO8B,KAAKC,GAAMA,EAAGC,KAAOH,GAC/CP,GACF5D,KAAKuE,iBAAiBrC,EAAU0B,EAAOH,EAE3C,CACA,MACF,CAGA,GAAIO,EAAOC,QAAQ,iBAAkB,CACnC,MAAMO,EAAOR,EAAOC,QAAQ,iBACtBQ,EAAOvB,SAASsB,EAAKzB,QAAQ0B,MAC7BC,EAASF,EAAKP,QAAQ,kBAC5B,GAAIS,EAAQ,CACV,MAAMC,EAAUD,EAAO3B,QAAQ6B,KACzBC,EAAY,IAAIzC,KAAKuC,GAC3BE,EAAUC,SAASL,GACnBzE,KAAK+E,gBAAgB7C,EAAU2C,EAAWpB,EAC5C,CACA,MACF,CAGA,GAAIO,EAAOC,QAAQ,iBAAkB,CACnC,MACMO,EADOR,EAAOC,QAAQ,iBACVA,QAAQ,iBACpBQ,EAAOvB,SAASsB,EAAKzB,QAAQ0B,MAC7BI,EAAY,IAAIzC,KAAKF,EAASC,aAGpC,OAFA0C,EAAUC,SAASL,QACnBzE,KAAK+E,gBAAgB7C,EAAU2C,EAAWpB,EAE5C,GAIJ,EAKA,uBAAAuB,CAAwB9C,GACtB,MAAM9B,QAACA,GAAW8B,EAGb9B,EAAQ6E,aAAa,aACxB7E,EAAQ8E,aAAa,WAAY,KAwDnClF,KAAK2D,mBAAmBzB,EAAU9B,EAAS,UArDlBqD,IACvB,MAAMtB,YAACA,EAAAE,YAAaA,GAAeH,EAEnC,OAAQuB,EAAE0B,KACR,IAAK,YACH1B,EAAE2B,iBACFpF,KAAKqF,SAASnD,GAAU,GACxB,MAEF,IAAK,aACHuB,EAAE2B,iBACFpF,KAAKqF,SAASnD,EAAU,GACxB,MAEF,IAAK,OACHuB,EAAE2B,iBACFpF,KAAKsF,UAAUpD,GACf,MAEF,IAAK,IACL,IAAK,IACEuB,EAAE8B,SAAY9B,EAAE+B,UACnB/B,EAAE2B,iBACFpF,KAAKsF,UAAUpD,IAEjB,MAEF,IAAK,IACL,IAAK,IACEuB,EAAE8B,SAAY9B,EAAE+B,UAAWtD,EAAS9E,OAAOS,MAAMiD,SAAS,WAC7D2C,EAAE2B,iBACFpF,KAAKyF,WAAWvD,EAAU,UAE5B,MAEF,IAAK,IACL,IAAK,IACEuB,EAAE8B,SAAY9B,EAAE+B,UAAWtD,EAAS9E,OAAOS,MAAMiD,SAAS,UAC7D2C,EAAE2B,iBACFpF,KAAKyF,WAAWvD,EAAU,SAE5B,MAEF,IAAK,IACL,IAAK,IACEuB,EAAE8B,SAAY9B,EAAE+B,UAAWtD,EAAS9E,OAAOS,MAAMiD,SAAS,SAC7D2C,EAAE2B,iBACFpF,KAAKyF,WAAWvD,EAAU,UAOpC,EAKA,aAAAU,CAAcV,GACZ,MAAM9B,QAACA,EAAAhD,OAASA,GAAU8E,EAE1B9B,EAAQsF,UAAUC,IAAI,kBACtBvF,EAAQ8E,aAAa,OAAQ,eAC7B9E,EAAQ8E,aAAa,aAAc,kBACnC9E,EAAQwF,UAAY,GAGpB5F,KAAK+D,qBAAqB7B,GAG1BlC,KAAKgF,wBAAwB9C,GAG7B,MAAM2D,EAAS5F,SAAS6F,cAAc,OAItC,GAHAD,EAAOE,UAAY,YAGf3I,EAAOM,eAAgB,CACzB,MAAMsI,EAAMhG,KAAKiG,iBAAiB/D,GAClC2D,EAAOK,YAAYF,EACrB,CAGA,GAAI5I,EAAOQ,kBAAoBR,EAAOS,MAAM6C,OAAS,EAAG,CACtD,MAAMyF,EAAWnG,KAAKoG,mBAAmBlE,GACzC2D,EAAOK,YAAYC,EACrB,CAEA/F,EAAQ8F,YAAYL,GACpB3D,EAASmE,cAAgBR,EAGzB,MAAMS,EAAUrG,SAAS6F,cAAc,OACvCQ,EAAQP,UAAY,aACpB3F,EAAQ8F,YAAYI,GACpBpE,EAASqE,eAAiBD,CAC5B,EAKA,gBAAAL,CAAiB/D,GACf,MAAM9E,OAACA,GAAU8E,EACXsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAE3B0I,EAAM/F,SAAS6F,cAAc,OACnCE,EAAID,UAAY,SAGhB,MAAMU,EAAUxG,SAAS6F,cAAc,UACvCW,EAAQV,UAAY,qBACpBU,EAAQvB,aAAa,aAAcsB,EAAQjH,UAAY,YACvDkH,EAAQvB,aAAa,OAAQ,UAC7BuB,EAAQb,UAAY,sIACpB5F,KAAK2D,mBAAmBzB,EAAUuE,EAAS,QAAS,IAAMzG,KAAKqF,SAASnD,GAAU,IAGlF,MAAMwE,EAAUzG,SAAS6F,cAAc,OACvCY,EAAQX,UAAY,oBACpBW,EAAQxB,aAAa,OAAQ,UAC7BwB,EAAQxB,aAAa,YAAa,UAClChD,EAASyE,qBAAuBD,EAGhC,MAAME,EAAU3G,SAAS6F,cAAc,UAYvC,GAXAc,EAAQb,UAAY,qBACpBa,EAAQ1B,aAAa,aAAcsB,EAAQhH,MAAQ,QACnDoH,EAAQ1B,aAAa,OAAQ,UAC7B0B,EAAQhB,UAAY,sIACpB5F,KAAK2D,mBAAmBzB,EAAU0E,EAAS,QAAS,IAAM5G,KAAKqF,SAASnD,EAAU,IAElF8D,EAAIE,YAAYO,GAChBT,EAAIE,YAAYQ,GAChBV,EAAIE,YAAYU,GAGZxJ,EAAOO,UAAW,CACpB,MAAMkJ,EAAW5G,SAAS6F,cAAc,UACxCe,EAASd,UAAY,eACrBc,EAAS3B,aAAa,OAAQ,UAC9B2B,EAAS3B,aAAa,aAAcsB,EAAQ3H,OAC5CgI,EAASC,YAAcN,EAAQ3H,MAC/BmB,KAAK2D,mBAAmBzB,EAAU2E,EAAU,QAAS,IAAM7G,KAAKsF,UAAUpD,IAC1E8D,EAAIE,YAAYW,EAClB,CAEA,OAAOb,CACT,EAKA,kBAAAI,CAAmBlE,GACjB,MAAM9E,OAACA,GAAU8E,EACXsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAE3B6I,EAAWlG,SAAS6F,cAAc,OACxCK,EAASJ,UAAY,mBAErB,MAAMgB,EAAa,CACjBjI,MAAO0H,EAAQ1H,MACfC,KAAMyH,EAAQzH,KACdC,IAAKwH,EAAQxH,KAaf,OAVA5B,EAAOS,MAAMsC,QAAQ6C,IACnB,MAAMgE,EAAM/G,SAAS6F,cAAc,UACnCkB,EAAIjB,UAAY,gBAAe/C,IAASd,EAASG,YAAc,SAAW,IAC1E2E,EAAIjE,QAAQC,KAAOA,EACnBgE,EAAIF,YAAcC,EAAW/D,IAASA,EACtChD,KAAK2D,mBAAmBzB,EAAU8E,EAAK,QAAS,IAAMhH,KAAKyF,WAAWvD,EAAUc,IAChFmD,EAASD,YAAYc,KAGvB9E,EAAS+E,oBAAsBd,EACxBA,CACT,EAKA,gBAAMtD,CAAWX,iBACf,MAAM9E,OAACA,GAAU8E,EAEjB,GAAK9E,EAAOU,IAAZ,CAEAoE,EAASM,WAAY,EACrBxC,KAAKkH,cAAchF,GAEnB,IACE,MAAMiF,EAAYnH,KAAKoH,iBAAiBlF,GAClCmF,EAAS,IAAIC,gBAAgB,CACjCC,MAAOvH,KAAKwH,cAAcL,EAAUI,OACpCE,IAAKzH,KAAKwH,cAAcL,EAAUM,OAG9BC,EAAMtK,EAAOU,IAAIgD,SAAS,KAC5B,GAAG1D,EAAOU,OAAOuJ,IACjB,GAAGjK,EAAOU,OAAOuJ,IAErB,IAAIM,EAEJ,GAAIhG,OAAOiG,YAAwC,mBAAnBA,WAAWC,IACzCF,QAAiBC,WAAWC,IAAIH,OAC3B,CACL,MAAMI,QAAYC,MAAML,EAAK,CAACM,OAAQ5K,EAAOW,YAC7C4J,QAAiBG,EAAIG,MACvB,CAGA,MAAM3F,GAAS,OAAA4F,EAAA,OAAAzG,EAAA,OAAAC,EAAAC,OAAOwG,YAAP,EAAAzG,EAAc0G,aAAd,EAAA3G,EAAsBoG,UAAtB,EAAAK,EAAApG,KAAAL,EAA4B,MAAAkG,OAAA,EAAAA,EAAUU,KAAMjL,EAAOY,cAAe,QAC9E,OAAAsK,EAAA,MAAAX,OAAA,EAAAA,EAAUU,WAAV,EAAAC,EAAiBlL,EAAOY,kBAAkB,OAAAuK,EAAA,MAAAZ,OAAA,EAAAA,EAAUU,WAAV,EAAAE,EAAgBF,QAAQ,MAAAV,OAAA,EAAAA,EAAUU,OAAQ,IACvFnG,EAASI,OAAStC,KAAKwI,gBAAgBlG,GACvCJ,EAAS7C,MAAQ,IAEnB,OAASA,GACP+B,QAAQ/B,MAAM,yCAA0CA,GACxD6C,EAAS7C,MAAQA,EAAMoJ,QACvBvG,EAASI,OAAS,EACpB,CAAA,QACEJ,EAASM,WAAY,EACrBxC,KAAK8C,OAAOZ,EACd,CAtCiB,CAuCnB,EAKA,SAAAwG,CAAUC,EAAYvL,GACpB,IAAKuL,EAAY,OAAO,IAAIvG,KAE5B,MAAMwC,EAAO,IAAIxC,KAAKuG,GAGtB,MAAwB,QAApBvL,EAAOG,UAAuBoL,EAAW7H,SAAS,MAAS6H,EAAW7H,SAAS,KAK5E8D,EAHE,IAAIxC,KAAKwC,EAAKgE,UAAwC,IAA3BhE,EAAKiE,oBAI3C,EAKA,gBAAAC,CAAiBlE,EAAMxH,GACrB,MAAwB,QAApBA,EAAOG,SACFqH,EAAKmE,cAEP/I,KAAKwH,cAAc5C,EAC5B,EAKA,eAAA4D,CAAgBlG,GAEd,OAAK9B,MAAMC,QAAQ6B,GAKZA,EAAOe,IAAI,CAACO,EAAOoF,KAExB,IAAKpF,EAEH,OADAxC,QAAQsC,KAAK,sCAAuCsF,GAC7C,KAIT,IAAIC,EAAWC,EACf,IACED,EAAYrF,EAAM2D,MAAQvH,KAAK0I,UAAU9E,EAAM2D,MAAOvH,KAAK5C,QAAU,IAAIgF,KACrE+G,MAAMF,EAAUL,aAClBxH,QAAQsC,KAAK,gDAAiDE,GAC9DqF,MAAgB7G,KAEpB,OAASqB,GACPrC,QAAQsC,KAAK,4CAA6CD,GAC1DwF,MAAgB7G,IAClB,CAEA,IACE8G,EAAUtF,EAAM6D,IAAMzH,KAAK0I,UAAU9E,EAAM6D,IAAKzH,KAAK5C,QAAU,IAAIgF,KAAK6G,GACpEE,MAAMD,EAAQN,aAChBxH,QAAQsC,KAAK,8CAA+CE,GAC5DsF,EAAU,IAAI9G,KAAK6G,GAEvB,OAASxF,GACPrC,QAAQsC,KAAK,0CAA2CD,GACxDyF,EAAU,IAAI9G,KAAK6G,EACrB,CAQA,OALIC,EAAUD,IACZ7H,QAAQsC,KAAK,4DACZuF,EAAWC,GAAW,CAACA,EAASD,IAG5B,CACL3E,GAAIV,EAAMU,IAAM,SAAS0E,KAAS5G,KAAKgH,QACvCC,MAAOzF,EAAMyF,OAAS,WACtB9B,MAAO0B,EACPxB,IAAKyB,EACL/J,QAAyB,IAAjByE,EAAMzE,OACdmK,MAAO1F,EAAM0F,OAAStJ,KAAK5C,OAAOa,YAAY+K,EAAQhJ,KAAK5C,OAAOa,YAAYyC,QAC9E6I,SAAU3F,EAAM2F,UAAY,KAC5BC,YAAa5F,EAAM4F,aAAe,KAClCC,SAAU7F,EAAM6F,UAAY,KAC5BpB,KAAMzE,KAEP/C,OAAO+C,GAAmB,OAAVA,IArDjBxC,QAAQsC,KAAK,gEAAiEpB,GACvE,GAqDX,EAKA,MAAAQ,CAAOZ,GAEL,GAAIA,EAAS7C,MACXW,KAAK0J,YAAYxH,QAKnB,GAAIA,EAASM,UACXxC,KAAKkH,cAAchF,QAOrB,OAHAlC,KAAK2J,oBAAoBzH,GACzBlC,KAAK4J,mBAAmB1H,GAEhBA,EAASG,aACf,IAAK,QACHrC,KAAK6J,gBAAgB3H,GACrB,MACF,IAAK,OACHlC,KAAK8J,eAAe5H,GACpB,MACF,IAAK,MACHlC,KAAK+J,cAAc7H,GAGzB,EAKA,WAAAwH,CAAYxH,GACV,MAAMqE,eAACA,EAAAnJ,OAAgBA,EAAAiC,MAAQA,GAAS6C,EAClCsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAEjCiJ,EAAeX,UAAY,iIAGOY,EAAQnH,sDACNW,KAAKgK,WAAW3K,gEACHmH,EAAQlH,OAAS,uCAKlE,MAAM2K,EAAW1D,EAAelF,cAAc,iBAC1C4I,GACFjK,KAAK2D,mBAAmBzB,EAAU+H,EAAU,QAAS,KACnD/H,EAAS7C,MAAQ,KACb6C,EAAS9E,OAAOU,IAClBkC,KAAK6C,WAAWX,GAEhBlC,KAAK8C,OAAOZ,IAIpB,EAKA,aAAAgF,CAAchF,GACZ,MAAMqE,eAACA,EAAAnJ,OAAgBA,GAAU8E,EAC3BsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAEjCiJ,EAAeX,UAAY,2FAGfY,EAAQpH,oCAGtB,EAKA,eAAAyK,CAAgB3H,GACd,MAAMqE,eAACA,EAAApE,YAAgBA,EAAA/E,OAAaA,EAAAkF,OAAQA,GAAUJ,EAChDsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAG3B4M,EAAWjK,SAASkK,yBAC1B5D,EAAeR,UAAY,2BAG3B,MAAMqE,EAAOnK,SAAS6F,cAAc,OACpCsE,EAAKrE,UAAY,gBACjBqE,EAAKlF,aAAa,OAAQ,QAC1BkF,EAAKlF,aAAa,aAAc,uBAGhC,MAAMmF,EAAYpK,SAAS6F,cAAc,OACzCuE,EAAUtE,UAAY,oBACtB,MAAMuE,EAAiBrK,SAASkK,yBAEhC,IAAA,IAASI,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMC,GAAYpN,EAAOI,eAAiB+M,GAAK,EACzC1E,EAAS5F,SAAS6F,cAAc,OACtCD,EAAOE,UAAY,aACnBF,EAAOiB,YAAcN,EAAQ5G,cAAc4K,GAC3CF,EAAepE,YAAYL,EAC7B,CACAwE,EAAUnE,YAAYoE,GACtBF,EAAKlE,YAAYmE,GAGjB,MAAMI,EAAa,IAAIrI,KAAKD,EAAYuI,cAAevI,EAAYwI,WAAY,GAC9D,IAAIvI,KAAKD,EAAYuI,cAAevI,EAAYwI,WAAa,EAAG,GAGjF,MAAMC,EAAY,IAAIxI,KAAKqI,GACrBI,GAAkBJ,EAAWK,SAAW1N,EAAOI,eAAiB,GAAK,EAC3EoN,EAAUG,QAAQH,EAAUI,UAAYH,GAGxC,MAAMI,EAAWjL,KAAKkL,0BAA0BhJ,EAAU0I,EAAW,IAGrE,IAAA,IAAS7L,EAAO,EAAGA,EAAO,EAAGA,IAAQ,CACnC,MAAMoM,EAAUlL,SAAS6F,cAAc,OACvCqF,EAAQpF,UAAY,cAGpB,MAAMqF,EAAanL,SAAS6F,cAAc,OAC1CsF,EAAWrF,UAAY,iBAIvB,MAAMsF,EAAWpL,SAAS6F,cAAc,OACxCuF,EAAStF,UAAY,eACrB,MAAMuF,EAAcrL,SAASkK,yBAE7B,IAAA,IAASnL,EAAM,EAAGA,EAAM,EAAGA,IAAO,CAChC,MAAMuM,EAAW,IAAInJ,KAAKwI,GAC1BW,EAASR,QAAQH,EAAUI,UAAoB,EAAPjM,EAAYC,GAEpD,MAAMwM,EAAOxL,KAAKyL,cAAcvJ,EAAUqJ,EAAUd,EAAWE,YAC/DW,EAAYpF,YAAYsF,EAC1B,CACAH,EAASnF,YAAYoF,GAGrB,MAAMI,EAAY,IAAItJ,KAAKwI,GAC3Bc,EAAUX,QAAQH,EAAUI,UAAoB,EAAPjM,GACzC,MAAM4M,EAAe3L,KAAK4L,gBAAgBX,EAAUS,GACpD1L,KAAK6L,oBAAoB3J,EAAUkJ,EAAYO,EAAcD,GAE7DP,EAAQjF,YAAYkF,GACpBD,EAAQjF,YAAYmF,GACpBjB,EAAKlE,YAAYiF,EACnB,CAEAjB,EAAShE,YAAYkE,GAGrB7D,EAAeX,UAAY,GAC3BW,EAAeL,YAAYgE,EAC7B,EAKA,aAAAuB,CAAcvJ,EAAU0C,EAAMkH,aAC5B,MAAM1O,OAACA,EAAAkF,OAAQA,GAAUJ,EACnBsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAC3BuB,MAAYuD,KAEZoJ,EAAOvL,SAAS6F,cAAc,OACpC0F,EAAKzF,UAAY,cACjByF,EAAKzI,QAAQ6B,KAAO5E,KAAKwH,cAAc5C,GACvC4G,EAAKtG,aAAa,OAAQ,YAC1BsG,EAAKtG,aAAa,aAAclF,KAAK+L,WAAWnH,EAAMxH,EAAOE,SAC7DkO,EAAKtG,aAAa,WAAY,MAG1BlF,KAAKgM,UAAUpH,EAAM/F,IACvB2M,EAAK9F,UAAUC,IAAI,YAEjBf,EAAK+F,aAAemB,GACtBN,EAAK9F,UAAUC,IAAI,kBAEC,IAAlBf,EAAKkG,UAAoC,IAAlBlG,EAAKkG,UAC9BU,EAAK9F,UAAUC,IAAI,cAIrB,MAAMsG,EAAShM,SAAS6F,cAAc,OACtCmG,EAAOlG,UAAY,gBACnBkG,EAAOnF,YAAclC,EAAKoG,UAC1BQ,EAAKtF,YAAY+F,GAGjB,MAAMC,EAAYlM,KAAKmM,iBAAiB7J,EAAQsC,GAC1CwH,EAAgBC,KAAKC,IAAI,EAAGJ,EAAUxL,OAAStD,EAAOK,iBAE5D,GAAI2O,EAAgB,EAAG,CACrB,MAAMG,EAAgBtM,SAAS6F,cAAc,OAC7CyG,EAAcxG,UAAY,iBAC1BwG,EAAczF,YAAcN,EAAQvH,WAAWuN,QAAQ,UAAWJ,GAClE,MAAMK,YAAehJ,IACnBA,EAAES,kBACFlE,KAAK0M,gBAAgBxK,EAAU0C,EAAMsH,IAEvClM,KAAK2D,mBAAmBzB,EAAUqK,EAAe,QAASE,aAC1DjB,EAAKtF,YAAYqG,EACnB,CAMAvM,KAAK2D,mBAAmBzB,EAAUsJ,EAAM,QAHd/H,IACxBzD,KAAK+E,gBAAgB7C,EAAU0C,EAAMnB,KAOvC,IAFiB,OAAAyE,EAAA,OAAAzG,EAAA,OAAAC,EAAAC,OAAOwG,YAAP,EAAAzG,EAAciL,cAAd,EAAAlL,EAAuBmL,eAAvB,EAAA1E,EAAApG,KAAAL,KACf,iEAAiEoL,KAAKC,UAAUC,WACpE,CACZ,MAAMC,mBAAsBvJ,IACtByI,EAAUxL,OAAS,IACrB+C,EAAES,kBACFlE,KAAKiN,mBAAmB/K,EAAU0C,EAAMsH,KAG5ClM,KAAK2D,mBAAmBzB,EAAUsJ,EAAM,QAASwB,mBACnD,CAEA,OAAOxB,CACT,EAKA,yBAAAN,CAA0BhJ,EAAU0I,EAAWsC,GAC7C,MAAM5K,OAACA,EAAAlF,OAAQA,EAAAsF,aAAQA,GAAgBR,EAGjCiL,EAAW,GAAGnN,KAAKwH,cAAcoD,MAAcsC,KAAa5K,EAAO5B,SAGzE,GAAIgC,EAAa0K,IAAID,GACnB,OAAOzK,EAAamF,IAAIsF,GAG1B,MAAMlC,EAAW,GAEXoC,EAAU,IAAIjL,KAAKwI,GACzByC,EAAQtC,QAAQH,EAAUI,UAAYkC,EAAY,GAElD5K,EAAOnC,QAAQyD,IAEb,GAAIA,EAAM6D,IAAMmD,GAAahH,EAAM2D,MAAQ8F,EAAS,OAGpD,MAAM9K,EAAgBvC,KAAKsN,2BACzB1J,EACAgH,EACAyC,EACAjQ,EAAOI,gBAETyN,EAASjK,QAAQuB,KAInB,MAAMgL,EAASvN,KAAKwN,mBAAmBvC,EAAU7N,EAAOI,gBAGxD,GAAIkF,EAAa+K,KAAO,GAAI,CAC1B,MAAMC,EAAWhL,EAAaiL,OAAOnO,OAAOoO,MAC5ClL,EAAamL,OAAOH,EACtB,CAGA,OAFAhL,EAAaC,IAAIwK,EAAUI,GAEpBA,CACT,EAKA,0BAAAD,CAA2B1J,EAAOkK,EAAWC,EAASvQ,GACpD,MAAMyN,EAAW,GAGX+C,EAAa,IAAI5L,KAAKiK,KAAKC,IAAI1I,EAAM2D,MAAMqB,UAAWkF,EAAUlF,YAChEqF,EAAW,IAAI7L,KAAKiK,KAAK6B,IAAItK,EAAM6D,IAAImB,UAAWmF,EAAQnF,YAEhE,IAAIlC,EAAU,IAAItE,KAAK4L,GAEvB,KAAOtH,GAAWuH,GAAU,CAE1B,MAAME,EAAUnO,KAAKoO,aAAa1H,EAASlJ,GACrC6Q,EAAa,IAAIjM,KAAKiK,KAAK6B,IAAIC,EAAQvF,UAAWqF,EAASrF,YAG3D0F,EAAWjC,KAAKkC,OAAOF,EAAa3H,UAAoC,EAGxE8H,GAAa9H,EAAQoE,SAAWtN,EAAiB,GAAK,EAE5DyN,EAASjK,KAAK,CACZ4C,QACAO,QAASP,EAAMU,GACfiD,MAAO,IAAInF,KAAKsE,GAChBe,IAAK,IAAIrF,KAAKiM,GACdI,QAASzO,KAAKgM,UAAUtF,EAAS9C,EAAM2D,OACvCmH,MAAO1O,KAAKgM,UAAUqC,EAAYzK,EAAM6D,KACxC6G,WACAE,YACAG,KAAK,IAIPjI,EAAU,IAAItE,KAAK+L,GACnBzH,EAAQqE,QAAQrE,EAAQsE,UAAY,EACtC,CAEA,OAAOC,CACT,EAKA,YAAAmD,CAAaxJ,EAAMpH,GACjB,MAAM+P,EAAS,IAAInL,KAAKwC,GAElBgK,GAAgB,EADJrB,EAAOzC,SACatN,GAAkB,EAExD,OADA+P,EAAOxC,QAAQwC,EAAOvC,UAAY4D,GAC3BrB,CACT,EAKA,kBAAAC,CAAmBvC,EAAUzN,GAE3B,MAAMqR,MAAiBtQ,IAkDvB,OAhDA0M,EAAS9K,QAAQ2O,IACf,MAAMC,EAAU/O,KAAKgP,WAAWF,EAAQvH,MAAO/J,GAC1CqR,EAAWzB,IAAI2B,IAClBF,EAAWlM,IAAIoM,EAAS,IAE1BF,EAAWhH,IAAIkH,GAAS/N,KAAK8N,KAI/BD,EAAW1O,QAAQwL,IAEjBA,EAAasD,KAAK,CAACC,EAAGC,IAChBD,EAAEV,YAAcW,EAAEX,UAAkBU,EAAEV,UAAYW,EAAEX,UACjDW,EAAEb,SAAWY,EAAEZ,UAGxB,MAAMc,EAAO,GAEbzD,EAAaxL,QAAQ2O,IACnB,IAAIO,EAAW,EACXC,GAAS,EAEb,MAAQA,GAAQ,CACTF,EAAKC,KACRD,EAAKC,GAAY,IAICD,EAAKC,GAAUE,KAAKC,IACtC,MAAMC,EAAWD,EAAShB,UACpBkB,EAASF,EAAShB,UAAYgB,EAASlB,SAAW,EAClDqB,EAAWb,EAAQN,UAGzB,QAFeM,EAAQN,UAAYM,EAAQR,SAAW,EAEpCmB,GAAYE,EAAWD,KAQzCL,KAJAD,EAAKC,GAAUrO,KAAK8N,GACpBA,EAAQH,IAAMU,EACdC,GAAS,EAIb,MAIGrE,CACT,EAKA,UAAA+D,CAAWpK,EAAMpH,GACf,MAAMkO,EAAY1L,KAAK4P,eAAehL,EAAMpH,GAC5C,OAAOwC,KAAKwH,cAAckE,EAC5B,EAKA,cAAAkE,CAAehL,EAAMpH,GACnB,MAAM+P,EAAS,IAAInL,KAAKwC,GAElBiL,GADYtC,EAAOzC,SACCtN,EAAiB,GAAK,EAEhD,OADA+P,EAAOxC,QAAQwC,EAAOvC,UAAY6E,GAC3BtC,CACT,EAKA,eAAA3B,CAAgBX,EAAUS,GACxB,MAAMyC,EAAU,IAAI/L,KAAKsJ,GAGzB,OAFAyC,EAAQpD,QAAQW,EAAUV,UAAY,GAE/BC,EAASpK,OAAOiO,GACdA,EAAQvH,OAASmE,GAAaoD,EAAQvH,OAAS4G,EAE1D,EAKA,mBAAAtC,CAAoB3J,EAAU4N,EAAW7E,EAAUS,GACjD,MAAMtO,OAACA,GAAU8E,EACX6N,EAAU3S,EAAOK,gBAGvBwN,EAASgE,KAAK,CAACC,EAAGC,IAAMD,EAAEP,IAAMQ,EAAER,KAElC1D,EAAS9K,QAAQ2O,IACf,GAAIA,EAAQH,KAAOoB,EAAS,OAE5B,MAAMC,EAAM/P,SAAS6F,cAAc,OACnCkK,EAAIjK,UAAY,eAChBiK,EAAIjN,QAAQoB,QAAU2K,EAAQlL,MAAMU,GACpC0L,EAAIC,MAAMC,KAAWpB,EAAQN,UAAY,EAAK,IAA7B,IACjBwB,EAAIC,MAAME,MAAYrB,EAAQR,SAAW,EAAK,IAA5B,IAClB0B,EAAIC,MAAMG,IAAuB,GAAdtB,EAAQH,IAAW,GAAtB,KAChBqB,EAAIC,MAAMI,gBAAkBvB,EAAQlL,MAAM0F,MAGtCwF,EAAQL,SAASuB,EAAItK,UAAUC,IAAI,kBACnCmJ,EAAQJ,OAAOsB,EAAItK,UAAUC,IAAI,gBAGrC,MAAM0D,EAAQpJ,SAAS6F,cAAc,QACrCuD,EAAMtD,UAAY,iBAClBsD,EAAMvC,YAAcgI,EAAQlL,MAAMyF,MAClC2G,EAAI9J,YAAYmD,GAIhByG,EAAU5J,YAAY8J,IAE1B,EAKA,cAAAlG,CAAe5H,GACb,MAAMqE,eAACA,EAAApE,YAAgBA,EAAA/E,OAAaA,EAAAkF,OAAQA,GAAUJ,EAChDsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAEjCiJ,EAAeX,UAAY,GAC3BW,EAAeR,UAAY,0BAE3B,MAAM2F,EAAY1L,KAAK4P,eAAezN,EAAa/E,EAAOI,gBAGpD8S,EAAgBrQ,SAAS6F,cAAc,OAC7CwK,EAAcvK,UAAY,oBAG1B,MAAMwK,EAAgBtQ,SAAS6F,cAAc,OAC7CyK,EAAcxK,UAAY,oBAE1B,MAAMyK,EAAcvQ,SAAS6F,cAAc,OAC3C0K,EAAYzK,UAAY,kBACxByK,EAAY1J,YAAcN,EAAQrH,OAClCoR,EAAcrK,YAAYsK,GAE1B,MAAMC,EAAaxQ,SAAS6F,cAAc,OAC1C2K,EAAW1K,UAAY,iBAGvB,IAAA,IAASwE,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMmG,EAAU,IAAItO,KAAKsJ,GACzBgF,EAAQ3F,QAAQW,EAAUV,UAAYT,GAEtC,MAAM1E,EAAS5F,SAAS6F,cAAc,OACtCD,EAAOE,UAAY,qBACf/F,KAAKgM,UAAU0E,EAAS,IAAItO,OAC9ByD,EAAOH,UAAUC,IAAI,YAGvBE,EAAOD,UAAY,0CACcY,EAAQ5G,cAAc8Q,EAAQ5F,wDAC/B4F,EAAQ1F,0BAExCyF,EAAWvK,YAAYL,EACzB,CAEA0K,EAAcrK,YAAYuK,GAG1B,MAAMxF,EAAWjL,KAAKkL,0BAA0BhJ,EAAUwJ,EAAW,GAC/DiF,EAAe1Q,SAAS6F,cAAc,OAC5C6K,EAAa5K,UAAY,mBACzB/F,KAAK6L,oBAAoB3J,EAAUyO,EAAc1F,EAAUS,GAC3D6E,EAAcrK,YAAYyK,GAE1BL,EAAcpK,YAAYqK,GAG1B,MAAMK,EAAW3Q,SAAS6F,cAAc,OACxC8K,EAAS7K,UAAY,eAGrB,MAAM8K,EAAa5Q,SAAS6F,cAAc,OAC1C+K,EAAW9K,UAAY,iBAEvB,IAAA,IAAStB,EAAO,EAAGA,EAAO,GAAIA,IAAQ,CACpC,MAAMqM,EAAQ7Q,SAAS6F,cAAc,OACrCgL,EAAM/K,UAAY,gBAClB+K,EAAMhK,YAAc,GAAGrC,EAAKsM,WAAWC,SAAS,EAAG,UACnDH,EAAW3K,YAAY4K,EACzB,CACAF,EAAS1K,YAAY2K,GAGrB,MAAMI,EAAahR,SAAS6F,cAAc,OAC1CmL,EAAWlL,UAAY,iBAEvB,IAAA,IAASwE,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMmG,EAAU,IAAItO,KAAKsJ,GACzBgF,EAAQ3F,QAAQW,EAAUV,UAAYT,GAEtC,MAAM7F,EAASzE,SAAS6F,cAAc,OACtCpB,EAAOqB,UAAY,gBACnBrB,EAAO3B,QAAQ6B,KAAO5E,KAAKwH,cAAckJ,GAGzC,IAAA,IAASjM,EAAO,EAAGA,EAAO,GAAIA,IAAQ,CACpC,MAAMD,EAAOvE,SAAS6F,cAAc,OACpCtB,EAAKuB,UAAY,eACjBvB,EAAKzB,QAAQ0B,KAAOA,EAIpBC,EAAOwB,YAAY1B,EACrB,CAGA,MAAM0H,EAAYlM,KAAKmM,iBAAiB7J,EAAQoO,GAAS7P,OAAO4C,IAAMA,EAAEtE,QACxEa,KAAKkR,kBAAkBhP,EAAUwC,EAAQwH,EAAWwE,GAEpDO,EAAW/K,YAAYxB,EACzB,CAEAkM,EAAS1K,YAAY+K,GACrBX,EAAcpK,YAAY0K,GAC1BrK,EAAeL,YAAYoK,EAC7B,EAKA,iBAAAY,CAAkBhP,EAAU4N,EAAWxN,EAAQsC,GAC7CtC,EAAOnC,QAAQyD,IACb,MAAMuN,EAAYvN,EAAM2D,MAAM6J,WAAaxN,EAAM2D,MAAM8J,aAAe,GAChEC,EAAU1N,EAAM6D,IAAI2J,WAAaxN,EAAM6D,IAAI4J,aAAe,GAC1DE,EAAWlF,KAAKC,IAAIgF,EAAUH,EAAW,IAEzCK,EAAUvR,SAAS6F,cAAc,OACvC0L,EAAQzL,UAAY,iBACpByL,EAAQzO,QAAQoB,QAAUP,EAAMU,GAChCkN,EAAQvB,MAAMG,IAAqB,GAAZe,EAAH,KACpBK,EAAQvB,MAAMwB,OAAuB,GAAXF,EAAH,KACvBC,EAAQvB,MAAMI,gBAAkBzM,EAAM0F,MAEtCkI,EAAQ5L,UAAY,wCACW5F,KAAK0R,WAAW9N,EAAM2D,qDACrBvH,KAAKgK,WAAWpG,EAAMyF,uBAKtDyG,EAAU5J,YAAYsL,IAE1B,EAKA,aAAAzH,CAAc7H,GACZ,MAAMqE,eAACA,EAAApE,YAAgBA,EAAA/E,OAAaA,EAAAkF,OAAQA,GAAUJ,EAChDsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAEjCiJ,EAAeX,UAAY,GAC3BW,EAAeR,UAAY,yBAG3B,MAAMF,EAAS5F,SAAS6F,cAAc,OACtCD,EAAOE,UAAY,gBACnBF,EAAOD,UAAY,qCACWY,EAAQ7G,SAASwC,EAAY2I,qDAC7B3I,EAAY6I,sDACXxE,EAAQ/G,WAAW0C,EAAYwI,2BAE9DpE,EAAeL,YAAYL,GAG3B,MAAMqG,EAAYlM,KAAKmM,iBAAiB7J,EAAQH,GAC1CwO,EAAezE,EAAUrL,OAAO4C,GAAKA,EAAEtE,QACvCwS,EAAczF,EAAUrL,OAAO4C,IAAMA,EAAEtE,QAE7C,GAAIwR,EAAajQ,OAAS,EAAG,CAC3B,MAAM6P,EAAgBtQ,SAAS6F,cAAc,OAC7CyK,EAAcxK,UAAY,gBAE1B4K,EAAaxQ,QAAQyD,IACnB,MAAM4N,EAAUvR,SAAS6F,cAAc,OACvC0L,EAAQzL,UAAY,kBACpByL,EAAQzO,QAAQoB,QAAUP,EAAMU,GAChCkN,EAAQvB,MAAMI,gBAAkBzM,EAAM0F,MACtCkI,EAAQ1K,YAAclD,EAAMyF,MAE5BkH,EAAcrK,YAAYsL,KAG5BjL,EAAeL,YAAYqK,EAC7B,CAGA,MAAMK,EAAW3Q,SAAS6F,cAAc,OACxC8K,EAAS7K,UAAY,mBAErB,IAAA,IAAStB,EAAO,EAAGA,EAAO,GAAIA,IAAQ,CACpC,MAAMD,EAAOvE,SAAS6F,cAAc,OACpCtB,EAAKuB,UAAY,eACjBvB,EAAKzB,QAAQ0B,KAAOA,EAEpB,MAAMqM,EAAQ7Q,SAAS6F,cAAc,OACrCgL,EAAM/K,UAAY,gBAClB+K,EAAMhK,YAAc,GAAGrC,EAAKsM,WAAWC,SAAS,EAAG,UAEnD,MAAMY,EAAO3R,SAAS6F,cAAc,OACpC8L,EAAK7L,UAAY,eAIjBvB,EAAK0B,YAAY4K,GACjBtM,EAAK0B,YAAY0L,GACjBhB,EAAS1K,YAAY1B,EACvB,CAGAxE,KAAKkR,kBAAkBhP,EAAU0O,EAAUe,EAAaxP,GAExDoE,EAAeL,YAAY0K,EAC7B,EAOA,eAAA7L,CAAgB7C,EAAU0C,EAAMiN,aAC9B,MAAMzU,OAACA,GAAU8E,EAUjB,GAPAlC,KAAK8R,UAAU,0BAA2B,CACxClN,OACA1C,WACA9B,QAAS8B,EAAS9B,UAIhBhD,EAAOc,YACT,GAAkC,mBAAvBd,EAAOc,YAChBd,EAAOc,YAAY0G,EAAM1C,QAC3B,GAAyC,iBAAvB9E,EAAOc,YAA0B,CAEjD,MAAM6T,GAAK,OAAA7J,EAAA,OAAAzG,EAAA,OAAAC,EAAAC,OAAOwG,cAAPzG,EAAc0G,aAAd,EAAA3G,EAAsBoG,UAAtB,EAAAK,EAAApG,KAAAL,EAA4BE,OAAQvE,EAAOc,eACpDd,EAAOc,YAAYkF,MAAM,KAAK4O,OAAO,CAACC,EAAGC,IAAM,MAAAD,OAAA,EAAAA,EAAIC,GAAIvQ,QACvC,mBAAPoQ,GACTA,EAAGnN,EAAM1C,EAEb,CAEJ,EAKA,gBAAAqC,CAAiBrC,EAAUiQ,EAAWN,aACpCA,EAAS3N,kBAET,MAAM9G,OAACA,GAAU8E,EAUjB,GAPAlC,KAAK8R,UAAU,2BAA4B,CACzClO,MAAOuO,EACPjQ,WACA9B,QAAS8B,EAAS9B,UAIhBhD,EAAOgB,gBAAiB,CAC1B,MAAMsJ,EAAMtK,EAAOgB,gBAAgBoO,QAAQ,OAAQ2F,EAAU7N,IAE1C8N,WACjB,IACE,IAAIzK,EACJ,GAAIhG,OAAOiG,YAAwC,mBAAnBA,WAAWC,IACzCF,QAAiBC,WAAWC,IAAIH,OAC3B,CACL,MAAMI,QAAYC,MAAML,GACxBC,QAAiBG,EAAIG,MACvB,CAGItG,OAAO0Q,iBACTA,gBAAgBC,QAAQ3K,EAAU,CAChCvH,QAAS8B,EAAS9B,QAClBiI,KAAM8J,GAGZ,OAAS9S,GACP+B,QAAQ/B,MAAM,yCAA0CA,EAC1D,GAGFkT,EACF,CAGA,GAAInV,EAAOe,aACT,GAAmC,mBAAxBf,EAAOe,aAChBf,EAAOe,aAAagU,EAAWjQ,QACjC,GAA0C,iBAAxB9E,EAAOe,aAA2B,CAClD,MAAM4T,GAAK,OAAA7J,EAAA,OAAAzG,EAAA,OAAAC,EAAAC,OAAOwG,cAAPzG,EAAc0G,aAAd,EAAA3G,EAAsBoG,UAAtB,EAAAK,EAAApG,KAAAL,EAA4BE,OAAQvE,EAAOe,gBACpDf,EAAOe,aAAaiF,MAAM,KAAK4O,OAAO,CAACC,EAAGC,IAAM,MAAAD,OAAA,EAAAA,EAAIC,GAAIvQ,QACxC,mBAAPoQ,GACTA,EAAGI,EAAWjQ,EAElB,CAEJ,EAKA,kBAAA+K,CAAmB/K,EAAU0C,EAAMtC,GACjC,MAAMlF,OAACA,GAAU8E,EACXsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QAE3BkV,EAAgBlQ,EAAOe,IAAIO,GAAS,sDACKA,EAAMU,iCAAiCV,EAAM0F,sDACpDtJ,KAAKgK,WAAWpG,EAAMyF,yBACxDzF,EAAMzE,OAAS,oCAAoCqH,EAAQrH,eAC7D,oCAAoCa,KAAK0R,WAAW9N,EAAM2D,YAAYvH,KAAK0R,WAAW9N,EAAM6D,yBAC1F7D,EAAM6F,SAAW,wCAAwCzJ,KAAKgK,WAAWpG,EAAM6F,kBAAoB,0BAEtGxI,KAAK,IAEFqF,EAAU,oHAGkBE,EAAQ7G,SAASiF,EAAKkG,wDACvBlG,EAAKoG,2DACFxE,EAAQ/G,WAAWmF,EAAK+F,wFAGpDrI,EAAO5B,OAAS,EAAI8R,EAAgB,6BAA6BhM,EAAQtH,uDAKjFc,KAAKyS,UAAUnM,EAAS,CACtB+C,MAAOrJ,KAAK+L,WAAWnH,EAAMxH,EAAOE,QACpCa,aAAegG,IACb,MAAMP,EAAQtB,EAAO8B,KAAKX,GAAKA,EAAEa,KAAOH,GACpCP,GACF5D,KAAKuE,iBAAiBrC,EAAU0B,EAAO,CAACM,gBAAiB,WAIjE,EAKA,eAAAwI,CAAgBxK,EAAU0C,EAAMtC,GAC9BtC,KAAKiN,mBAAmB/K,EAAU0C,EAAMtC,EAC1C,EAKA,SAAAmQ,CAAUnM,EAASvG,EAAU,IAC3B,GAAI4B,OAAO+Q,MAAO,CAChB,MAAMC,EAAQ,IAAID,MAAM,CACtBrJ,MAAOtJ,EAAQsJ,OAAS,GACxB/C,UACAmH,KAAM,SACNmF,UAAU,EACVC,iBAAiB,IAEnBF,EAAMG,OAGF/S,EAAQ5B,cACVwU,EAAMvS,QAAQF,iBAAiB,mBAAmBC,QAAQ4S,IACxDA,EAAGjP,iBAAiB,QAAS,KAC3B/D,EAAQ5B,aAAa4U,EAAGhQ,QAAQoB,SAChCwO,EAAMK,UAId,MAEMrR,OAAOsR,eACTA,cAAcH,KAAK,CACjBzJ,MAAOtJ,EAAQsJ,OAAS,GACxB/C,UACA4M,QAAS,CAAC,CAACC,KAAM,QAASC,SAAS,KAI3C,EAOA,QAAA/N,CAASnD,EAAUmR,GACjB,MAAMhR,YAACA,EAAAF,YAAaA,GAAeD,EAEnC,OAAQG,GACN,IAAK,MACHF,EAAY4I,QAAQ5I,EAAY6I,UAAYqI,GAC5C,MACF,IAAK,OACHlR,EAAY4I,QAAQ5I,EAAY6I,UAAyB,EAAZqI,GAC7C,MACF,IAAK,QACHlR,EAAYmR,SAASnR,EAAYwI,WAAa0I,GAK9CnR,EAAS9E,OAAOU,IAClBkC,KAAK6C,WAAWX,GAEhBlC,KAAK8C,OAAOZ,GAGdlC,KAAK8R,UAAU,yBAA0B,CACvClN,KAAM,IAAIxC,KAAKD,GACfa,KAAMX,EACNH,YAEJ,EAKA,SAAAoD,CAAUpD,GACRA,EAASC,gBAAkBC,KAEvBF,EAAS9E,OAAOU,IAClBkC,KAAK6C,WAAWX,GAEhBlC,KAAK8C,OAAOZ,GAGdlC,KAAK8R,UAAU,sBAAuB,CACpClN,SAAUxC,KACVF,YAEJ,EAKA,UAAAuD,CAAWvD,EAAUc,GACdd,EAAS9E,OAAOS,MAAMiD,SAASkC,KAEpCd,EAASG,YAAcW,EACvBhD,KAAK8C,OAAOZ,GAEZlC,KAAK8R,UAAU,2BAA4B,CACzC9O,OACAd,aAEJ,EAKA,mBAAAyH,CAAoBzH,GAClB,MAAMC,YAACA,EAAAE,YAAaA,EAAAjF,OAAaA,GAAU8E,EACrCsE,EAAUxG,KAAKrB,KAAKvB,EAAOE,QACjC,IAAI6V,EAAO,GAEX,OAAQ9Q,GACN,IAAK,MACH8Q,EAAO,GAAGhR,EAAY6I,aAAaxE,EAAQ/G,WAAW0C,EAAYwI,eAAexI,EAAYuI,gBAC7F,MACF,IAAK,OACH,MAAMgB,EAAY1L,KAAK4P,eAAezN,EAAa/E,EAAOI,gBACpD2Q,EAAU,IAAI/L,KAAKsJ,GACzByC,EAAQpD,QAAQW,EAAUV,UAAY,GACtCmI,EAAO,GAAGzH,EAAUV,eAAemD,EAAQnD,aAAaxE,EAAQ/G,WAAW0O,EAAQxD,eAAewD,EAAQzD,gBAC1G,MACF,IAAK,QACHyI,EAAO,GAAG3M,EAAQ/G,WAAW0C,EAAYwI,eAAexI,EAAYuI,gBAIpExI,EAASyE,uBACXzE,EAASyE,qBAAqBG,YAAcqM,EAEhD,EAKA,kBAAAvJ,CAAmB1H,GACZA,EAAS+E,qBAEd/E,EAAS+E,oBAAoB/G,iBAAiB,gBAAgBC,QAAQ6G,IACpEA,EAAItB,UAAU6N,OAAO,SAAUvM,EAAIjE,QAAQC,OAASd,EAASG,cAEjE,EAOA8J,iBAAA,CAAiB7J,EAAQsC,IAChBtC,EAAOzB,OAAO+C,IACnB,MAAMoK,EAAa,IAAI5L,KAAKwB,EAAM2D,OAC5B0G,EAAW,IAAI7L,KAAKwB,EAAM6D,KAG1B+L,EAAY,IAAIpR,KAAKwC,GAC3B4O,EAAU1O,SAAS,EAAG,EAAG,EAAG,GAE5B,MAAMmE,EAAY,IAAI7G,KAAK4L,GAC3B/E,EAAUnE,SAAS,EAAG,EAAG,EAAG,GAE5B,MAAMoE,EAAU,IAAI9G,KAAK6L,GAGzB,OAFA/E,EAAQpE,SAAS,EAAG,EAAG,EAAG,GAEnB0O,GAAavK,GAAauK,GAAatK,IAOlD,gBAAA9B,CAAiBlF,GACf,MAAMC,YAACA,EAAAE,YAAaA,EAAAjF,OAAaA,GAAU8E,EAC3C,IAAIqF,EAAOE,EAEX,OAAQpF,GACN,IAAK,MACHkF,EAAQ,IAAInF,KAAKD,GACjBoF,EAAMzC,SAAS,EAAG,EAAG,EAAG,GACxB2C,EAAM,IAAIrF,KAAKD,GACfsF,EAAI3C,SAAS,GAAI,GAAI,GAAI,KACzB,MACF,IAAK,OACHyC,EAAQvH,KAAK4P,eAAezN,EAAa/E,EAAOI,gBAChDiK,EAAM,IAAIrF,KAAKmF,GACfE,EAAIsD,QAAQxD,EAAMyD,UAAY,GAC9BvD,EAAI3C,SAAS,GAAI,GAAI,GAAI,KACzB,MACF,IAAK,QACHyC,EAAQ,IAAInF,KAAKD,EAAYuI,cAAevI,EAAYwI,WAAY,GACpElD,EAAM,IAAIrF,KAAKD,EAAYuI,cAAevI,EAAYwI,WAAa,EAAG,GACtElD,EAAI3C,SAAS,GAAI,GAAI,GAAI,KAEzB,MAAM2O,GAAelM,EAAMuD,SAAW1N,EAAOI,eAAiB,GAAK,EACnE+J,EAAMwD,QAAQxD,EAAMyD,UAAYyI,GAChC,MAAMC,GAAa,EAAIjM,EAAIqD,SAAW1N,EAAOI,gBAAkB,EAC/DiK,EAAIsD,QAAQtD,EAAIuD,UAAY0I,GAIhC,MAAO,CAACnM,QAAOE,MACjB,EAKAuE,UAAA,CAAU2H,EAAOC,IACRD,EAAMjJ,gBAAkBkJ,EAAMlJ,eACnCiJ,EAAMhJ,aAAeiJ,EAAMjJ,YAC3BgJ,EAAM3I,YAAc4I,EAAM5I,UAM9B,aAAAxD,CAAc5C,GACZ,MAAMiP,EAAI,IAAIzR,KAAKwC,GAInB,MAAO,GAHMiP,EAAEnJ,iBACDoJ,OAAOD,EAAElJ,WAAa,GAAGqG,SAAS,EAAG,QACvC8C,OAAOD,EAAE7I,WAAWgG,SAAS,EAAG,MAE9C,EAKA,UAAAjF,CAAWnH,EAAMtH,EAAS,MACxB,MAAMkJ,EAAUxG,KAAKrB,KAAKrB,IAAW0C,KAAKrB,KAAKkB,GAC/C,MAAO,GAAG+E,EAAKoG,aAAaxE,EAAQ/G,WAAWmF,EAAK+F,eAAe/F,EAAK8F,eAC1E,EAKAgH,WAAW9M,GAGF,GAFOA,EAAKwM,WAAWL,WAAWC,SAAS,EAAG,QACrCpM,EAAKyM,aAAaN,WAAWC,SAAS,EAAG,OAO3D,UAAAhH,CAAW+J,GACT,IAAKA,EAAK,MAAO,GACjB,MAAMC,EAAM/T,SAAS6F,cAAc,OAEnC,OADAkO,EAAIlN,YAAciN,EACXC,EAAIpO,SACb,EAKA,SAAAkM,CAAUmC,EAAW5L,GACnB6L,aAAaC,KAAKF,EAAW5L,GAG7B,MAAMzE,EAAQ,IAAIwQ,YAAYH,EAAW,CACvCI,OAAQhM,EACRiM,SAAS,IAEXrU,SAASsU,cAAc3Q,EACzB,EAOA,QAAA4Q,CAASC,EAAmB7Q,GAC1B,MAAM1B,EAAWlC,KAAK0U,YAAYD,GAClC,IAAKvS,EAAU,OAEf,MAAMyS,EAAkB3U,KAAKwI,gBAAgB,CAAC5E,IAAQ,GACtD1B,EAASI,OAAOtB,KAAK2T,GACrBzS,EAASQ,aAAakS,QACtB5U,KAAK8C,OAAOZ,GAEZlC,KAAK8R,UAAU,yBAA0B,CACvClO,MAAO+Q,EACPzS,YAEJ,EAKA,WAAA2S,CAAYJ,EAAmBtQ,GAC7B,MAAMjC,EAAWlC,KAAK0U,YAAYD,GAC7BvS,IAELA,EAASI,OAASJ,EAASI,OAAOzB,OAAO4C,GAAKA,EAAEa,KAAOH,GACvDjC,EAASQ,aAAakS,QACtB5U,KAAK8C,OAAOZ,GAEZlC,KAAK8R,UAAU,4BAA6B,CAC1C3N,UACAjC,aAEJ,EAKA,WAAA4S,CAAYL,EAAmBtQ,EAASkE,GACtC,MAAMnG,EAAWlC,KAAK0U,YAAYD,GAClC,IAAKvS,EAAU,OAEf,MAAM8G,EAAQ9G,EAASI,OAAOyS,UAAUtR,GAAKA,EAAEa,KAAOH,IACxC,IAAV6E,IACF9G,EAASI,OAAO0G,GAAS,IAAI9G,EAASI,OAAO0G,MAAWX,GACxDnG,EAASQ,aAAakS,QACtB5U,KAAK8C,OAAOZ,GAEZlC,KAAK8R,UAAU,4BAA6B,CAC1ClO,MAAO1B,EAASI,OAAO0G,GACvB9G,aAGN,EAKA,SAAA8S,CAAUP,EAAmBlN,EAAQ,KAAME,EAAM,MAC/C,MAAMvF,EAAWlC,KAAK0U,YAAYD,GAClC,IAAKvS,EAAU,MAAO,GAEtB,IAAII,EAAS,IAAIJ,EAASI,QAQ1B,OANIiF,GAASE,IACXnF,EAASA,EAAOzB,OAAO4C,GACrBA,EAAE8D,OAASE,GAAOhE,EAAEgE,KAAOF,IAIxBjF,CACT,EAKA,aAAA2S,CAAcR,GACZ,MAAMvS,EAAWlC,KAAK0U,YAAYD,GAC9BvS,GAAYA,EAAS9E,OAAOU,KAC9BkC,KAAK6C,WAAWX,EAEpB,EAKA,SAAAgT,CAAUT,EAAmBnS,GAC3B,MAAMJ,EAAWlC,KAAK0U,YAAYD,GAC7BvS,IAELA,EAASI,OAAStC,KAAKwI,gBAAgBlG,GACvCJ,EAASQ,aAAakS,QACtB5U,KAAK8C,OAAOZ,GACd,EAKAwS,YAAYD,GACNA,GAAqBA,EAAkBrU,QAClCqU,GAGwB,iBAAtBA,IACTA,EAAoBxU,SAASoB,cAAcoT,WAGtCA,WAAmBnT,iBAAkB,MAM9C,OAAA6T,CAAQV,GACN,MAAMvS,EAAWlC,KAAK0U,YAAYD,GAClC,IAAKvS,EAAU,OAEf,MAAM9B,QAACA,GAAW8B,EAGdA,EAASO,gBAAkBP,EAASO,eAAe/B,OAAS,IAC9DwB,EAASO,eAAetC,QAAQ,EAAEC,QAAS2S,EAAInP,QAAOC,UAAS9D,cAC7DgT,EAAGqC,oBAAoBxR,EAAOC,EAAS9D,KAEzCmC,EAASO,eAAiB,IAIxBP,EAASmT,aACXC,cAAcpT,EAASmT,aAIzBjV,EAAQwF,UAAY,GACpBxF,EAAQsF,UAAU6P,OAAO,yBAGlBnV,EAAQkB,eACftB,KAAK3B,MAAMC,UAAUuP,OAAOzN,GAG5BJ,KAAK8R,UAAU,wBAAyB,CAAC1R,WAC3C,IAIE,OAAAsB,EAAAC,OAAO6T,UAAP,EAAA9T,EAAY+T,kBACdD,IAAIC,gBAAgB,gBAAiBtY,GAIvCwE,OAAOxE,cAAgBA,EAGK,YAAxB8C,SAASyV,WACXzV,SAAS6D,iBAAiB,mBAAoB,KACvC3G,EAAckB,MAAMG,aACvBrB,EAAc2C,SAIb3C,EAAckB,MAAMG,aACvBrB,EAAc2C"}